var td=Object.defineProperty;var nd=(t,e,n)=>e in t?td(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ft=(t,e,n)=>(nd(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))c(p);new MutationObserver(p=>{for(const v of p)if(v.type==="childList")for(const S of v.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&c(S)}).observe(document,{childList:!0,subtree:!0});function n(p){const v={};return p.integrity&&(v.integrity=p.integrity),p.referrerPolicy&&(v.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?v.credentials="include":p.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function c(p){if(p.ep)return;p.ep=!0;const v=n(p);fetch(p.href,v)}})();function _c(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function id(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function c(){return this instanceof c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(c){var p=Object.getOwnPropertyDescriptor(t,c);Object.defineProperty(n,c,p.get?p:{enumerable:!0,get:function(){return t[c]}})}),n}var Tc={exports:{}},os={},kc={exports:{}},ve={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ki=Symbol.for("react.element"),rd=Symbol.for("react.portal"),sd=Symbol.for("react.fragment"),ad=Symbol.for("react.strict_mode"),od=Symbol.for("react.profiler"),ld=Symbol.for("react.provider"),cd=Symbol.for("react.context"),ud=Symbol.for("react.forward_ref"),hd=Symbol.for("react.suspense"),dd=Symbol.for("react.memo"),fd=Symbol.for("react.lazy"),tl=Symbol.iterator;function gd(t){return t===null||typeof t!="object"?null:(t=tl&&t[tl]||t["@@iterator"],typeof t=="function"?t:null)}var Pc={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ec=Object.assign,Oc={};function ii(t,e,n){this.props=t,this.context=e,this.refs=Oc,this.updater=n||Pc}ii.prototype.isReactComponent={};ii.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ii.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function jc(){}jc.prototype=ii.prototype;function to(t,e,n){this.props=t,this.context=e,this.refs=Oc,this.updater=n||Pc}var no=to.prototype=new jc;no.constructor=to;Ec(no,ii.prototype);no.isPureReactComponent=!0;var nl=Array.isArray,Ic=Object.prototype.hasOwnProperty,io={current:null},Ac={key:!0,ref:!0,__self:!0,__source:!0};function Mc(t,e,n){var c,p={},v=null,S=null;if(e!=null)for(c in e.ref!==void 0&&(S=e.ref),e.key!==void 0&&(v=""+e.key),e)Ic.call(e,c)&&!Ac.hasOwnProperty(c)&&(p[c]=e[c]);var h=arguments.length-2;if(h===1)p.children=n;else if(1<h){for(var s=Array(h),u=0;u<h;u++)s[u]=arguments[u+2];p.children=s}if(t&&t.defaultProps)for(c in h=t.defaultProps,h)p[c]===void 0&&(p[c]=h[c]);return{$$typeof:Ki,type:t,key:v,ref:S,props:p,_owner:io.current}}function md(t,e){return{$$typeof:Ki,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function ro(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ki}function pd(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var il=/\/+/g;function Es(t,e){return typeof t=="object"&&t!==null&&t.key!=null?pd(""+t.key):e.toString(36)}function Cr(t,e,n,c,p){var v=typeof t;(v==="undefined"||v==="boolean")&&(t=null);var S=!1;if(t===null)S=!0;else switch(v){case"string":case"number":S=!0;break;case"object":switch(t.$$typeof){case Ki:case rd:S=!0}}if(S)return S=t,p=p(S),t=c===""?"."+Es(S,0):c,nl(p)?(n="",t!=null&&(n=t.replace(il,"$&/")+"/"),Cr(p,e,n,"",function(u){return u})):p!=null&&(ro(p)&&(p=md(p,n+(!p.key||S&&S.key===p.key?"":(""+p.key).replace(il,"$&/")+"/")+t)),e.push(p)),1;if(S=0,c=c===""?".":c+":",nl(t))for(var h=0;h<t.length;h++){v=t[h];var s=c+Es(v,h);S+=Cr(v,e,n,s,p)}else if(s=gd(t),typeof s=="function")for(t=s.call(t),h=0;!(v=t.next()).done;)v=v.value,s=c+Es(v,h++),S+=Cr(v,e,n,s,p);else if(v==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return S}function rr(t,e,n){if(t==null)return t;var c=[],p=0;return Cr(t,c,"","",function(v){return e.call(n,v,p++)}),c}function vd(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Xe={current:null},br={transition:null},yd={ReactCurrentDispatcher:Xe,ReactCurrentBatchConfig:br,ReactCurrentOwner:io};function Dc(){throw Error("act(...) is not supported in production builds of React.")}ve.Children={map:rr,forEach:function(t,e,n){rr(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return rr(t,function(){e++}),e},toArray:function(t){return rr(t,function(e){return e})||[]},only:function(t){if(!ro(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ve.Component=ii;ve.Fragment=sd;ve.Profiler=od;ve.PureComponent=to;ve.StrictMode=ad;ve.Suspense=hd;ve.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yd;ve.act=Dc;ve.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var c=Ec({},t.props),p=t.key,v=t.ref,S=t._owner;if(e!=null){if(e.ref!==void 0&&(v=e.ref,S=io.current),e.key!==void 0&&(p=""+e.key),t.type&&t.type.defaultProps)var h=t.type.defaultProps;for(s in e)Ic.call(e,s)&&!Ac.hasOwnProperty(s)&&(c[s]=e[s]===void 0&&h!==void 0?h[s]:e[s])}var s=arguments.length-2;if(s===1)c.children=n;else if(1<s){h=Array(s);for(var u=0;u<s;u++)h[u]=arguments[u+2];c.children=h}return{$$typeof:Ki,type:t.type,key:p,ref:v,props:c,_owner:S}};ve.createContext=function(t){return t={$$typeof:cd,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:ld,_context:t},t.Consumer=t};ve.createElement=Mc;ve.createFactory=function(t){var e=Mc.bind(null,t);return e.type=t,e};ve.createRef=function(){return{current:null}};ve.forwardRef=function(t){return{$$typeof:ud,render:t}};ve.isValidElement=ro;ve.lazy=function(t){return{$$typeof:fd,_payload:{_status:-1,_result:t},_init:vd}};ve.memo=function(t,e){return{$$typeof:dd,type:t,compare:e===void 0?null:e}};ve.startTransition=function(t){var e=br.transition;br.transition={};try{t()}finally{br.transition=e}};ve.unstable_act=Dc;ve.useCallback=function(t,e){return Xe.current.useCallback(t,e)};ve.useContext=function(t){return Xe.current.useContext(t)};ve.useDebugValue=function(){};ve.useDeferredValue=function(t){return Xe.current.useDeferredValue(t)};ve.useEffect=function(t,e){return Xe.current.useEffect(t,e)};ve.useId=function(){return Xe.current.useId()};ve.useImperativeHandle=function(t,e,n){return Xe.current.useImperativeHandle(t,e,n)};ve.useInsertionEffect=function(t,e){return Xe.current.useInsertionEffect(t,e)};ve.useLayoutEffect=function(t,e){return Xe.current.useLayoutEffect(t,e)};ve.useMemo=function(t,e){return Xe.current.useMemo(t,e)};ve.useReducer=function(t,e,n){return Xe.current.useReducer(t,e,n)};ve.useRef=function(t){return Xe.current.useRef(t)};ve.useState=function(t){return Xe.current.useState(t)};ve.useSyncExternalStore=function(t,e,n){return Xe.current.useSyncExternalStore(t,e,n)};ve.useTransition=function(){return Xe.current.useTransition()};ve.version="18.3.1";kc.exports=ve;var le=kc.exports;const Nc=_c(le);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xd=le,wd=Symbol.for("react.element"),Sd=Symbol.for("react.fragment"),Cd=Object.prototype.hasOwnProperty,bd=xd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_d={key:!0,ref:!0,__self:!0,__source:!0};function Fc(t,e,n){var c,p={},v=null,S=null;n!==void 0&&(v=""+n),e.key!==void 0&&(v=""+e.key),e.ref!==void 0&&(S=e.ref);for(c in e)Cd.call(e,c)&&!_d.hasOwnProperty(c)&&(p[c]=e[c]);if(t&&t.defaultProps)for(c in e=t.defaultProps,e)p[c]===void 0&&(p[c]=e[c]);return{$$typeof:wd,type:t,key:v,ref:S,props:p,_owner:bd.current}}os.Fragment=Sd;os.jsx=Fc;os.jsxs=Fc;Tc.exports=os;var w=Tc.exports,sa={},Lc={exports:{}},rt={},Rc={exports:{}},zc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(X,_){var j=X.length;X.push(_);e:for(;0<j;){var A=j-1>>>1,O=X[A];if(0<p(O,_))X[A]=_,X[j]=O,j=A;else break e}}function n(X){return X.length===0?null:X[0]}function c(X){if(X.length===0)return null;var _=X[0],j=X.pop();if(j!==_){X[0]=j;e:for(var A=0,O=X.length,z=O>>>1;A<z;){var P=2*(A+1)-1,k=X[P],D=P+1,R=X[D];if(0>p(k,j))D<O&&0>p(R,k)?(X[A]=R,X[D]=j,A=D):(X[A]=k,X[P]=j,A=P);else if(D<O&&0>p(R,j))X[A]=R,X[D]=j,A=D;else break e}}return _}function p(X,_){var j=X.sortIndex-_.sortIndex;return j!==0?j:X.id-_.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;t.unstable_now=function(){return v.now()}}else{var S=Date,h=S.now();t.unstable_now=function(){return S.now()-h}}var s=[],u=[],d=1,r=null,a=3,i=!1,l=!1,g=!1,o=typeof setTimeout=="function"?setTimeout:null,f=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(X){for(var _=n(u);_!==null;){if(_.callback===null)c(u);else if(_.startTime<=X)c(u),_.sortIndex=_.expirationTime,e(s,_);else break;_=n(u)}}function x(X){if(g=!1,y(X),!l)if(n(s)!==null)l=!0,oe(C);else{var _=n(u);_!==null&&ce(x,_.startTime-X)}}function C(X,_){l=!1,g&&(g=!1,f(E),E=-1),i=!0;var j=a;try{for(y(_),r=n(s);r!==null&&(!(r.expirationTime>_)||X&&!H());){var A=r.callback;if(typeof A=="function"){r.callback=null,a=r.priorityLevel;var O=A(r.expirationTime<=_);_=t.unstable_now(),typeof O=="function"?r.callback=O:r===n(s)&&c(s),y(_)}else c(s);r=n(s)}if(r!==null)var z=!0;else{var P=n(u);P!==null&&ce(x,P.startTime-_),z=!1}return z}finally{r=null,a=j,i=!1}}var b=!1,T=null,E=-1,L=5,F=-1;function H(){return!(t.unstable_now()-F<L)}function J(){if(T!==null){var X=t.unstable_now();F=X;var _=!0;try{_=T(!0,X)}finally{_?q():(b=!1,T=null)}}else b=!1}var q;if(typeof m=="function")q=function(){m(J)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,te=Q.port2;Q.port1.onmessage=J,q=function(){te.postMessage(null)}}else q=function(){o(J,0)};function oe(X){T=X,b||(b=!0,q())}function ce(X,_){E=o(function(){X(t.unstable_now())},_)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(X){X.callback=null},t.unstable_continueExecution=function(){l||i||(l=!0,oe(C))},t.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<X?Math.floor(1e3/X):5},t.unstable_getCurrentPriorityLevel=function(){return a},t.unstable_getFirstCallbackNode=function(){return n(s)},t.unstable_next=function(X){switch(a){case 1:case 2:case 3:var _=3;break;default:_=a}var j=a;a=_;try{return X()}finally{a=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(X,_){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var j=a;a=X;try{return _()}finally{a=j}},t.unstable_scheduleCallback=function(X,_,j){var A=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?A+j:A):j=A,X){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=j+O,X={id:d++,callback:_,priorityLevel:X,startTime:j,expirationTime:O,sortIndex:-1},j>A?(X.sortIndex=j,e(u,X),n(s)===null&&X===n(u)&&(g?(f(E),E=-1):g=!0,ce(x,j-A))):(X.sortIndex=O,e(s,X),l||i||(l=!0,oe(C))),X},t.unstable_shouldYield=H,t.unstable_wrapCallback=function(X){var _=a;return function(){var j=a;a=_;try{return X.apply(this,arguments)}finally{a=j}}}})(zc);Rc.exports=zc;var Td=Rc.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kd=le,it=Td;function ne(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Bc=new Set,ji={};function Cn(t,e){Yn(t,e),Yn(t+"Capture",e)}function Yn(t,e){for(ji[t]=e,t=0;t<e.length;t++)Bc.add(e[t])}var Dt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aa=Object.prototype.hasOwnProperty,Pd=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,rl={},sl={};function Ed(t){return aa.call(sl,t)?!0:aa.call(rl,t)?!1:Pd.test(t)?sl[t]=!0:(rl[t]=!0,!1)}function Od(t,e,n,c){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return c?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function jd(t,e,n,c){if(e===null||typeof e>"u"||Od(t,e,n,c))return!0;if(c)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ye(t,e,n,c,p,v,S){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=c,this.attributeNamespace=p,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=v,this.removeEmptyString=S}var Le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Le[t]=new Ye(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Le[e]=new Ye(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Le[t]=new Ye(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Le[t]=new Ye(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Le[t]=new Ye(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Le[t]=new Ye(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Le[t]=new Ye(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Le[t]=new Ye(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Le[t]=new Ye(t,5,!1,t.toLowerCase(),null,!1,!1)});var so=/[\-:]([a-z])/g;function ao(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(so,ao);Le[e]=new Ye(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(so,ao);Le[e]=new Ye(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(so,ao);Le[e]=new Ye(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Le[t]=new Ye(t,1,!1,t.toLowerCase(),null,!1,!1)});Le.xlinkHref=new Ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Le[t]=new Ye(t,1,!1,t.toLowerCase(),null,!0,!0)});function oo(t,e,n,c){var p=Le.hasOwnProperty(e)?Le[e]:null;(p!==null?p.type!==0:c||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(jd(e,n,p,c)&&(n=null),c||p===null?Ed(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):p.mustUseProperty?t[p.propertyName]=n===null?p.type===3?!1:"":n:(e=p.attributeName,c=p.attributeNamespace,n===null?t.removeAttribute(e):(p=p.type,n=p===3||p===4&&n===!0?"":""+n,c?t.setAttributeNS(c,e,n):t.setAttribute(e,n))))}var zt=kd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,sr=Symbol.for("react.element"),En=Symbol.for("react.portal"),On=Symbol.for("react.fragment"),lo=Symbol.for("react.strict_mode"),oa=Symbol.for("react.profiler"),Uc=Symbol.for("react.provider"),Gc=Symbol.for("react.context"),co=Symbol.for("react.forward_ref"),la=Symbol.for("react.suspense"),ca=Symbol.for("react.suspense_list"),uo=Symbol.for("react.memo"),Ut=Symbol.for("react.lazy"),Wc=Symbol.for("react.offscreen"),al=Symbol.iterator;function oi(t){return t===null||typeof t!="object"?null:(t=al&&t[al]||t["@@iterator"],typeof t=="function"?t:null)}var Pe=Object.assign,Os;function pi(t){if(Os===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Os=e&&e[1]||""}return`
`+Os+t}var js=!1;function Is(t,e){if(!t||js)return"";js=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var c=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){c=u}t.call(e.prototype)}else{try{throw Error()}catch(u){c=u}t()}}catch(u){if(u&&c&&typeof u.stack=="string"){for(var p=u.stack.split(`
`),v=c.stack.split(`
`),S=p.length-1,h=v.length-1;1<=S&&0<=h&&p[S]!==v[h];)h--;for(;1<=S&&0<=h;S--,h--)if(p[S]!==v[h]){if(S!==1||h!==1)do if(S--,h--,0>h||p[S]!==v[h]){var s=`
`+p[S].replace(" at new "," at ");return t.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",t.displayName)),s}while(1<=S&&0<=h);break}}}finally{js=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?pi(t):""}function Id(t){switch(t.tag){case 5:return pi(t.type);case 16:return pi("Lazy");case 13:return pi("Suspense");case 19:return pi("SuspenseList");case 0:case 2:case 15:return t=Is(t.type,!1),t;case 11:return t=Is(t.type.render,!1),t;case 1:return t=Is(t.type,!0),t;default:return""}}function ua(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case On:return"Fragment";case En:return"Portal";case oa:return"Profiler";case lo:return"StrictMode";case la:return"Suspense";case ca:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Gc:return(t.displayName||"Context")+".Consumer";case Uc:return(t._context.displayName||"Context")+".Provider";case co:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case uo:return e=t.displayName||null,e!==null?e:ua(t.type)||"Memo";case Ut:e=t._payload,t=t._init;try{return ua(t(e))}catch{}}return null}function Ad(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ua(e);case 8:return e===lo?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function tn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Hc(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Md(t){var e=Hc(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),c=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var p=n.get,v=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return p.call(this)},set:function(S){c=""+S,v.call(this,S)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return c},setValue:function(S){c=""+S},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ar(t){t._valueTracker||(t._valueTracker=Md(t))}function Vc(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),c="";return t&&(c=Hc(t)?t.checked?"true":"false":t.value),t=c,t!==n?(e.setValue(t),!0):!1}function Dr(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ha(t,e){var n=e.checked;return Pe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ol(t,e){var n=e.defaultValue==null?"":e.defaultValue,c=e.checked!=null?e.checked:e.defaultChecked;n=tn(e.value!=null?e.value:n),t._wrapperState={initialChecked:c,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Xc(t,e){e=e.checked,e!=null&&oo(t,"checked",e,!1)}function da(t,e){Xc(t,e);var n=tn(e.value),c=e.type;if(n!=null)c==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(c==="submit"||c==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?fa(t,e.type,n):e.hasOwnProperty("defaultValue")&&fa(t,e.type,tn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ll(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var c=e.type;if(!(c!=="submit"&&c!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function fa(t,e,n){(e!=="number"||Dr(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var vi=Array.isArray;function Bn(t,e,n,c){if(t=t.options,e){e={};for(var p=0;p<n.length;p++)e["$"+n[p]]=!0;for(n=0;n<t.length;n++)p=e.hasOwnProperty("$"+t[n].value),t[n].selected!==p&&(t[n].selected=p),p&&c&&(t[n].defaultSelected=!0)}else{for(n=""+tn(n),e=null,p=0;p<t.length;p++){if(t[p].value===n){t[p].selected=!0,c&&(t[p].defaultSelected=!0);return}e!==null||t[p].disabled||(e=t[p])}e!==null&&(e.selected=!0)}}function ga(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ne(91));return Pe({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function cl(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ne(92));if(vi(n)){if(1<n.length)throw Error(ne(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:tn(n)}}function Yc(t,e){var n=tn(e.value),c=tn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),c!=null&&(t.defaultValue=""+c)}function ul(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $c(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ma(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$c(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var or,Kc=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,c,p){MSApp.execUnsafeLocalFunction(function(){return t(e,n,c,p)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(or=or||document.createElement("div"),or.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=or.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ii(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var wi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dd=["Webkit","ms","Moz","O"];Object.keys(wi).forEach(function(t){Dd.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),wi[e]=wi[t]})});function qc(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||wi.hasOwnProperty(t)&&wi[t]?(""+e).trim():e+"px"}function Qc(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var c=n.indexOf("--")===0,p=qc(n,e[n],c);n==="float"&&(n="cssFloat"),c?t.setProperty(n,p):t[n]=p}}var Nd=Pe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function pa(t,e){if(e){if(Nd[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ne(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ne(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ne(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ne(62))}}function va(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ya=null;function ho(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var xa=null,Un=null,Gn=null;function hl(t){if(t=Ji(t)){if(typeof xa!="function")throw Error(ne(280));var e=t.stateNode;e&&(e=ds(e),xa(t.stateNode,t.type,e))}}function Jc(t){Un?Gn?Gn.push(t):Gn=[t]:Un=t}function Zc(){if(Un){var t=Un,e=Gn;if(Gn=Un=null,hl(t),e)for(t=0;t<e.length;t++)hl(e[t])}}function eu(t,e){return t(e)}function tu(){}var As=!1;function nu(t,e,n){if(As)return t(e,n);As=!0;try{return eu(t,e,n)}finally{As=!1,(Un!==null||Gn!==null)&&(tu(),Zc())}}function Ai(t,e){var n=t.stateNode;if(n===null)return null;var c=ds(n);if(c===null)return null;n=c[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ne(231,e,typeof n));return n}var wa=!1;if(Dt)try{var li={};Object.defineProperty(li,"passive",{get:function(){wa=!0}}),window.addEventListener("test",li,li),window.removeEventListener("test",li,li)}catch{wa=!1}function Fd(t,e,n,c,p,v,S,h,s){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(d){this.onError(d)}}var Si=!1,Nr=null,Fr=!1,Sa=null,Ld={onError:function(t){Si=!0,Nr=t}};function Rd(t,e,n,c,p,v,S,h,s){Si=!1,Nr=null,Fd.apply(Ld,arguments)}function zd(t,e,n,c,p,v,S,h,s){if(Rd.apply(this,arguments),Si){if(Si){var u=Nr;Si=!1,Nr=null}else throw Error(ne(198));Fr||(Fr=!0,Sa=u)}}function bn(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function iu(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function dl(t){if(bn(t)!==t)throw Error(ne(188))}function Bd(t){var e=t.alternate;if(!e){if(e=bn(t),e===null)throw Error(ne(188));return e!==t?null:t}for(var n=t,c=e;;){var p=n.return;if(p===null)break;var v=p.alternate;if(v===null){if(c=p.return,c!==null){n=c;continue}break}if(p.child===v.child){for(v=p.child;v;){if(v===n)return dl(p),t;if(v===c)return dl(p),e;v=v.sibling}throw Error(ne(188))}if(n.return!==c.return)n=p,c=v;else{for(var S=!1,h=p.child;h;){if(h===n){S=!0,n=p,c=v;break}if(h===c){S=!0,c=p,n=v;break}h=h.sibling}if(!S){for(h=v.child;h;){if(h===n){S=!0,n=v,c=p;break}if(h===c){S=!0,c=v,n=p;break}h=h.sibling}if(!S)throw Error(ne(189))}}if(n.alternate!==c)throw Error(ne(190))}if(n.tag!==3)throw Error(ne(188));return n.stateNode.current===n?t:e}function ru(t){return t=Bd(t),t!==null?su(t):null}function su(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=su(t);if(e!==null)return e;t=t.sibling}return null}var au=it.unstable_scheduleCallback,fl=it.unstable_cancelCallback,Ud=it.unstable_shouldYield,Gd=it.unstable_requestPaint,Oe=it.unstable_now,Wd=it.unstable_getCurrentPriorityLevel,fo=it.unstable_ImmediatePriority,ou=it.unstable_UserBlockingPriority,Lr=it.unstable_NormalPriority,Hd=it.unstable_LowPriority,lu=it.unstable_IdlePriority,ls=null,Tt=null;function Vd(t){if(Tt&&typeof Tt.onCommitFiberRoot=="function")try{Tt.onCommitFiberRoot(ls,t,void 0,(t.current.flags&128)===128)}catch{}}var yt=Math.clz32?Math.clz32:$d,Xd=Math.log,Yd=Math.LN2;function $d(t){return t>>>=0,t===0?32:31-(Xd(t)/Yd|0)|0}var lr=64,cr=4194304;function yi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Rr(t,e){var n=t.pendingLanes;if(n===0)return 0;var c=0,p=t.suspendedLanes,v=t.pingedLanes,S=n&268435455;if(S!==0){var h=S&~p;h!==0?c=yi(h):(v&=S,v!==0&&(c=yi(v)))}else S=n&~p,S!==0?c=yi(S):v!==0&&(c=yi(v));if(c===0)return 0;if(e!==0&&e!==c&&!(e&p)&&(p=c&-c,v=e&-e,p>=v||p===16&&(v&4194240)!==0))return e;if(c&4&&(c|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=c;0<e;)n=31-yt(e),p=1<<n,c|=t[n],e&=~p;return c}function Kd(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qd(t,e){for(var n=t.suspendedLanes,c=t.pingedLanes,p=t.expirationTimes,v=t.pendingLanes;0<v;){var S=31-yt(v),h=1<<S,s=p[S];s===-1?(!(h&n)||h&c)&&(p[S]=Kd(h,e)):s<=e&&(t.expiredLanes|=h),v&=~h}}function Ca(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function cu(){var t=lr;return lr<<=1,!(lr&4194240)&&(lr=64),t}function Ms(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function qi(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-yt(e),t[e]=n}function Qd(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var c=t.eventTimes;for(t=t.expirationTimes;0<n;){var p=31-yt(n),v=1<<p;e[p]=0,c[p]=-1,t[p]=-1,n&=~v}}function go(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var c=31-yt(n),p=1<<c;p&e|t[c]&e&&(t[c]|=e),n&=~p}}var xe=0;function uu(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var hu,mo,du,fu,gu,ba=!1,ur=[],Yt=null,$t=null,Kt=null,Mi=new Map,Di=new Map,Wt=[],Jd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gl(t,e){switch(t){case"focusin":case"focusout":Yt=null;break;case"dragenter":case"dragleave":$t=null;break;case"mouseover":case"mouseout":Kt=null;break;case"pointerover":case"pointerout":Mi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Di.delete(e.pointerId)}}function ci(t,e,n,c,p,v){return t===null||t.nativeEvent!==v?(t={blockedOn:e,domEventName:n,eventSystemFlags:c,nativeEvent:v,targetContainers:[p]},e!==null&&(e=Ji(e),e!==null&&mo(e)),t):(t.eventSystemFlags|=c,e=t.targetContainers,p!==null&&e.indexOf(p)===-1&&e.push(p),t)}function Zd(t,e,n,c,p){switch(e){case"focusin":return Yt=ci(Yt,t,e,n,c,p),!0;case"dragenter":return $t=ci($t,t,e,n,c,p),!0;case"mouseover":return Kt=ci(Kt,t,e,n,c,p),!0;case"pointerover":var v=p.pointerId;return Mi.set(v,ci(Mi.get(v)||null,t,e,n,c,p)),!0;case"gotpointercapture":return v=p.pointerId,Di.set(v,ci(Di.get(v)||null,t,e,n,c,p)),!0}return!1}function mu(t){var e=hn(t.target);if(e!==null){var n=bn(e);if(n!==null){if(e=n.tag,e===13){if(e=iu(n),e!==null){t.blockedOn=e,gu(t.priority,function(){du(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function _r(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=_a(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var c=new n.constructor(n.type,n);ya=c,n.target.dispatchEvent(c),ya=null}else return e=Ji(n),e!==null&&mo(e),t.blockedOn=n,!1;e.shift()}return!0}function ml(t,e,n){_r(t)&&n.delete(e)}function ef(){ba=!1,Yt!==null&&_r(Yt)&&(Yt=null),$t!==null&&_r($t)&&($t=null),Kt!==null&&_r(Kt)&&(Kt=null),Mi.forEach(ml),Di.forEach(ml)}function ui(t,e){t.blockedOn===e&&(t.blockedOn=null,ba||(ba=!0,it.unstable_scheduleCallback(it.unstable_NormalPriority,ef)))}function Ni(t){function e(p){return ui(p,t)}if(0<ur.length){ui(ur[0],t);for(var n=1;n<ur.length;n++){var c=ur[n];c.blockedOn===t&&(c.blockedOn=null)}}for(Yt!==null&&ui(Yt,t),$t!==null&&ui($t,t),Kt!==null&&ui(Kt,t),Mi.forEach(e),Di.forEach(e),n=0;n<Wt.length;n++)c=Wt[n],c.blockedOn===t&&(c.blockedOn=null);for(;0<Wt.length&&(n=Wt[0],n.blockedOn===null);)mu(n),n.blockedOn===null&&Wt.shift()}var Wn=zt.ReactCurrentBatchConfig,zr=!0;function tf(t,e,n,c){var p=xe,v=Wn.transition;Wn.transition=null;try{xe=1,po(t,e,n,c)}finally{xe=p,Wn.transition=v}}function nf(t,e,n,c){var p=xe,v=Wn.transition;Wn.transition=null;try{xe=4,po(t,e,n,c)}finally{xe=p,Wn.transition=v}}function po(t,e,n,c){if(zr){var p=_a(t,e,n,c);if(p===null)Ws(t,e,c,Br,n),gl(t,c);else if(Zd(p,t,e,n,c))c.stopPropagation();else if(gl(t,c),e&4&&-1<Jd.indexOf(t)){for(;p!==null;){var v=Ji(p);if(v!==null&&hu(v),v=_a(t,e,n,c),v===null&&Ws(t,e,c,Br,n),v===p)break;p=v}p!==null&&c.stopPropagation()}else Ws(t,e,c,null,n)}}var Br=null;function _a(t,e,n,c){if(Br=null,t=ho(c),t=hn(t),t!==null)if(e=bn(t),e===null)t=null;else if(n=e.tag,n===13){if(t=iu(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Br=t,null}function pu(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Wd()){case fo:return 1;case ou:return 4;case Lr:case Hd:return 16;case lu:return 536870912;default:return 16}default:return 16}}var Vt=null,vo=null,Tr=null;function vu(){if(Tr)return Tr;var t,e=vo,n=e.length,c,p="value"in Vt?Vt.value:Vt.textContent,v=p.length;for(t=0;t<n&&e[t]===p[t];t++);var S=n-t;for(c=1;c<=S&&e[n-c]===p[v-c];c++);return Tr=p.slice(t,1<c?1-c:void 0)}function kr(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function hr(){return!0}function pl(){return!1}function st(t){function e(n,c,p,v,S){this._reactName=n,this._targetInst=p,this.type=c,this.nativeEvent=v,this.target=S,this.currentTarget=null;for(var h in t)t.hasOwnProperty(h)&&(n=t[h],this[h]=n?n(v):v[h]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?hr:pl,this.isPropagationStopped=pl,this}return Pe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=hr)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=hr)},persist:function(){},isPersistent:hr}),e}var ri={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yo=st(ri),Qi=Pe({},ri,{view:0,detail:0}),rf=st(Qi),Ds,Ns,hi,cs=Pe({},Qi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xo,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==hi&&(hi&&t.type==="mousemove"?(Ds=t.screenX-hi.screenX,Ns=t.screenY-hi.screenY):Ns=Ds=0,hi=t),Ds)},movementY:function(t){return"movementY"in t?t.movementY:Ns}}),vl=st(cs),sf=Pe({},cs,{dataTransfer:0}),af=st(sf),of=Pe({},Qi,{relatedTarget:0}),Fs=st(of),lf=Pe({},ri,{animationName:0,elapsedTime:0,pseudoElement:0}),cf=st(lf),uf=Pe({},ri,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),hf=st(uf),df=Pe({},ri,{data:0}),yl=st(df),ff={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function pf(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=mf[t])?!!e[t]:!1}function xo(){return pf}var vf=Pe({},Qi,{key:function(t){if(t.key){var e=ff[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=kr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?gf[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xo,charCode:function(t){return t.type==="keypress"?kr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?kr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),yf=st(vf),xf=Pe({},cs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xl=st(xf),wf=Pe({},Qi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xo}),Sf=st(wf),Cf=Pe({},ri,{propertyName:0,elapsedTime:0,pseudoElement:0}),bf=st(Cf),_f=Pe({},cs,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Tf=st(_f),kf=[9,13,27,32],wo=Dt&&"CompositionEvent"in window,Ci=null;Dt&&"documentMode"in document&&(Ci=document.documentMode);var Pf=Dt&&"TextEvent"in window&&!Ci,yu=Dt&&(!wo||Ci&&8<Ci&&11>=Ci),wl=String.fromCharCode(32),Sl=!1;function xu(t,e){switch(t){case"keyup":return kf.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wu(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var jn=!1;function Ef(t,e){switch(t){case"compositionend":return wu(e);case"keypress":return e.which!==32?null:(Sl=!0,wl);case"textInput":return t=e.data,t===wl&&Sl?null:t;default:return null}}function Of(t,e){if(jn)return t==="compositionend"||!wo&&xu(t,e)?(t=vu(),Tr=vo=Vt=null,jn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return yu&&e.locale!=="ko"?null:e.data;default:return null}}var jf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cl(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!jf[t.type]:e==="textarea"}function Su(t,e,n,c){Jc(c),e=Ur(e,"onChange"),0<e.length&&(n=new yo("onChange","change",null,n,c),t.push({event:n,listeners:e}))}var bi=null,Fi=null;function If(t){Au(t,0)}function us(t){var e=Mn(t);if(Vc(e))return t}function Af(t,e){if(t==="change")return e}var Cu=!1;if(Dt){var Ls;if(Dt){var Rs="oninput"in document;if(!Rs){var bl=document.createElement("div");bl.setAttribute("oninput","return;"),Rs=typeof bl.oninput=="function"}Ls=Rs}else Ls=!1;Cu=Ls&&(!document.documentMode||9<document.documentMode)}function _l(){bi&&(bi.detachEvent("onpropertychange",bu),Fi=bi=null)}function bu(t){if(t.propertyName==="value"&&us(Fi)){var e=[];Su(e,Fi,t,ho(t)),nu(If,e)}}function Mf(t,e,n){t==="focusin"?(_l(),bi=e,Fi=n,bi.attachEvent("onpropertychange",bu)):t==="focusout"&&_l()}function Df(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return us(Fi)}function Nf(t,e){if(t==="click")return us(e)}function Ff(t,e){if(t==="input"||t==="change")return us(e)}function Lf(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var wt=typeof Object.is=="function"?Object.is:Lf;function Li(t,e){if(wt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),c=Object.keys(e);if(n.length!==c.length)return!1;for(c=0;c<n.length;c++){var p=n[c];if(!aa.call(e,p)||!wt(t[p],e[p]))return!1}return!0}function Tl(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function kl(t,e){var n=Tl(t);t=0;for(var c;n;){if(n.nodeType===3){if(c=t+n.textContent.length,t<=e&&c>=e)return{node:n,offset:e-t};t=c}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Tl(n)}}function _u(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?_u(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Tu(){for(var t=window,e=Dr();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Dr(t.document)}return e}function So(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Rf(t){var e=Tu(),n=t.focusedElem,c=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&_u(n.ownerDocument.documentElement,n)){if(c!==null&&So(n)){if(e=c.start,t=c.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var p=n.textContent.length,v=Math.min(c.start,p);c=c.end===void 0?v:Math.min(c.end,p),!t.extend&&v>c&&(p=c,c=v,v=p),p=kl(n,v);var S=kl(n,c);p&&S&&(t.rangeCount!==1||t.anchorNode!==p.node||t.anchorOffset!==p.offset||t.focusNode!==S.node||t.focusOffset!==S.offset)&&(e=e.createRange(),e.setStart(p.node,p.offset),t.removeAllRanges(),v>c?(t.addRange(e),t.extend(S.node,S.offset)):(e.setEnd(S.node,S.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var zf=Dt&&"documentMode"in document&&11>=document.documentMode,In=null,Ta=null,_i=null,ka=!1;function Pl(t,e,n){var c=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ka||In==null||In!==Dr(c)||(c=In,"selectionStart"in c&&So(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),_i&&Li(_i,c)||(_i=c,c=Ur(Ta,"onSelect"),0<c.length&&(e=new yo("onSelect","select",null,e,n),t.push({event:e,listeners:c}),e.target=In)))}function dr(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var An={animationend:dr("Animation","AnimationEnd"),animationiteration:dr("Animation","AnimationIteration"),animationstart:dr("Animation","AnimationStart"),transitionend:dr("Transition","TransitionEnd")},zs={},ku={};Dt&&(ku=document.createElement("div").style,"AnimationEvent"in window||(delete An.animationend.animation,delete An.animationiteration.animation,delete An.animationstart.animation),"TransitionEvent"in window||delete An.transitionend.transition);function hs(t){if(zs[t])return zs[t];if(!An[t])return t;var e=An[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in ku)return zs[t]=e[n];return t}var Pu=hs("animationend"),Eu=hs("animationiteration"),Ou=hs("animationstart"),ju=hs("transitionend"),Iu=new Map,El="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rn(t,e){Iu.set(t,e),Cn(e,[t])}for(var Bs=0;Bs<El.length;Bs++){var Us=El[Bs],Bf=Us.toLowerCase(),Uf=Us[0].toUpperCase()+Us.slice(1);rn(Bf,"on"+Uf)}rn(Pu,"onAnimationEnd");rn(Eu,"onAnimationIteration");rn(Ou,"onAnimationStart");rn("dblclick","onDoubleClick");rn("focusin","onFocus");rn("focusout","onBlur");rn(ju,"onTransitionEnd");Yn("onMouseEnter",["mouseout","mouseover"]);Yn("onMouseLeave",["mouseout","mouseover"]);Yn("onPointerEnter",["pointerout","pointerover"]);Yn("onPointerLeave",["pointerout","pointerover"]);Cn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Cn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Cn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Cn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Cn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Cn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gf=new Set("cancel close invalid load scroll toggle".split(" ").concat(xi));function Ol(t,e,n){var c=t.type||"unknown-event";t.currentTarget=n,zd(c,e,void 0,t),t.currentTarget=null}function Au(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var c=t[n],p=c.event;c=c.listeners;e:{var v=void 0;if(e)for(var S=c.length-1;0<=S;S--){var h=c[S],s=h.instance,u=h.currentTarget;if(h=h.listener,s!==v&&p.isPropagationStopped())break e;Ol(p,h,u),v=s}else for(S=0;S<c.length;S++){if(h=c[S],s=h.instance,u=h.currentTarget,h=h.listener,s!==v&&p.isPropagationStopped())break e;Ol(p,h,u),v=s}}}if(Fr)throw t=Sa,Fr=!1,Sa=null,t}function Se(t,e){var n=e[Ia];n===void 0&&(n=e[Ia]=new Set);var c=t+"__bubble";n.has(c)||(Mu(e,t,2,!1),n.add(c))}function Gs(t,e,n){var c=0;e&&(c|=4),Mu(n,t,c,e)}var fr="_reactListening"+Math.random().toString(36).slice(2);function Ri(t){if(!t[fr]){t[fr]=!0,Bc.forEach(function(n){n!=="selectionchange"&&(Gf.has(n)||Gs(n,!1,t),Gs(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[fr]||(e[fr]=!0,Gs("selectionchange",!1,e))}}function Mu(t,e,n,c){switch(pu(e)){case 1:var p=tf;break;case 4:p=nf;break;default:p=po}n=p.bind(null,e,n,t),p=void 0,!wa||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(p=!0),c?p!==void 0?t.addEventListener(e,n,{capture:!0,passive:p}):t.addEventListener(e,n,!0):p!==void 0?t.addEventListener(e,n,{passive:p}):t.addEventListener(e,n,!1)}function Ws(t,e,n,c,p){var v=c;if(!(e&1)&&!(e&2)&&c!==null)e:for(;;){if(c===null)return;var S=c.tag;if(S===3||S===4){var h=c.stateNode.containerInfo;if(h===p||h.nodeType===8&&h.parentNode===p)break;if(S===4)for(S=c.return;S!==null;){var s=S.tag;if((s===3||s===4)&&(s=S.stateNode.containerInfo,s===p||s.nodeType===8&&s.parentNode===p))return;S=S.return}for(;h!==null;){if(S=hn(h),S===null)return;if(s=S.tag,s===5||s===6){c=v=S;continue e}h=h.parentNode}}c=c.return}nu(function(){var u=v,d=ho(n),r=[];e:{var a=Iu.get(t);if(a!==void 0){var i=yo,l=t;switch(t){case"keypress":if(kr(n)===0)break e;case"keydown":case"keyup":i=yf;break;case"focusin":l="focus",i=Fs;break;case"focusout":l="blur",i=Fs;break;case"beforeblur":case"afterblur":i=Fs;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":i=vl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":i=af;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":i=Sf;break;case Pu:case Eu:case Ou:i=cf;break;case ju:i=bf;break;case"scroll":i=rf;break;case"wheel":i=Tf;break;case"copy":case"cut":case"paste":i=hf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":i=xl}var g=(e&4)!==0,o=!g&&t==="scroll",f=g?a!==null?a+"Capture":null:a;g=[];for(var m=u,y;m!==null;){y=m;var x=y.stateNode;if(y.tag===5&&x!==null&&(y=x,f!==null&&(x=Ai(m,f),x!=null&&g.push(zi(m,x,y)))),o)break;m=m.return}0<g.length&&(a=new i(a,l,null,n,d),r.push({event:a,listeners:g}))}}if(!(e&7)){e:{if(a=t==="mouseover"||t==="pointerover",i=t==="mouseout"||t==="pointerout",a&&n!==ya&&(l=n.relatedTarget||n.fromElement)&&(hn(l)||l[Nt]))break e;if((i||a)&&(a=d.window===d?d:(a=d.ownerDocument)?a.defaultView||a.parentWindow:window,i?(l=n.relatedTarget||n.toElement,i=u,l=l?hn(l):null,l!==null&&(o=bn(l),l!==o||l.tag!==5&&l.tag!==6)&&(l=null)):(i=null,l=u),i!==l)){if(g=vl,x="onMouseLeave",f="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(g=xl,x="onPointerLeave",f="onPointerEnter",m="pointer"),o=i==null?a:Mn(i),y=l==null?a:Mn(l),a=new g(x,m+"leave",i,n,d),a.target=o,a.relatedTarget=y,x=null,hn(d)===u&&(g=new g(f,m+"enter",l,n,d),g.target=y,g.relatedTarget=o,x=g),o=x,i&&l)t:{for(g=i,f=l,m=0,y=g;y;y=kn(y))m++;for(y=0,x=f;x;x=kn(x))y++;for(;0<m-y;)g=kn(g),m--;for(;0<y-m;)f=kn(f),y--;for(;m--;){if(g===f||f!==null&&g===f.alternate)break t;g=kn(g),f=kn(f)}g=null}else g=null;i!==null&&jl(r,a,i,g,!1),l!==null&&o!==null&&jl(r,o,l,g,!0)}}e:{if(a=u?Mn(u):window,i=a.nodeName&&a.nodeName.toLowerCase(),i==="select"||i==="input"&&a.type==="file")var C=Af;else if(Cl(a))if(Cu)C=Ff;else{C=Df;var b=Mf}else(i=a.nodeName)&&i.toLowerCase()==="input"&&(a.type==="checkbox"||a.type==="radio")&&(C=Nf);if(C&&(C=C(t,u))){Su(r,C,n,d);break e}b&&b(t,a,u),t==="focusout"&&(b=a._wrapperState)&&b.controlled&&a.type==="number"&&fa(a,"number",a.value)}switch(b=u?Mn(u):window,t){case"focusin":(Cl(b)||b.contentEditable==="true")&&(In=b,Ta=u,_i=null);break;case"focusout":_i=Ta=In=null;break;case"mousedown":ka=!0;break;case"contextmenu":case"mouseup":case"dragend":ka=!1,Pl(r,n,d);break;case"selectionchange":if(zf)break;case"keydown":case"keyup":Pl(r,n,d)}var T;if(wo)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else jn?xu(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(yu&&n.locale!=="ko"&&(jn||E!=="onCompositionStart"?E==="onCompositionEnd"&&jn&&(T=vu()):(Vt=d,vo="value"in Vt?Vt.value:Vt.textContent,jn=!0)),b=Ur(u,E),0<b.length&&(E=new yl(E,t,null,n,d),r.push({event:E,listeners:b}),T?E.data=T:(T=wu(n),T!==null&&(E.data=T)))),(T=Pf?Ef(t,n):Of(t,n))&&(u=Ur(u,"onBeforeInput"),0<u.length&&(d=new yl("onBeforeInput","beforeinput",null,n,d),r.push({event:d,listeners:u}),d.data=T))}Au(r,e)})}function zi(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ur(t,e){for(var n=e+"Capture",c=[];t!==null;){var p=t,v=p.stateNode;p.tag===5&&v!==null&&(p=v,v=Ai(t,n),v!=null&&c.unshift(zi(t,v,p)),v=Ai(t,e),v!=null&&c.push(zi(t,v,p))),t=t.return}return c}function kn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function jl(t,e,n,c,p){for(var v=e._reactName,S=[];n!==null&&n!==c;){var h=n,s=h.alternate,u=h.stateNode;if(s!==null&&s===c)break;h.tag===5&&u!==null&&(h=u,p?(s=Ai(n,v),s!=null&&S.unshift(zi(n,s,h))):p||(s=Ai(n,v),s!=null&&S.push(zi(n,s,h)))),n=n.return}S.length!==0&&t.push({event:e,listeners:S})}var Wf=/\r\n?/g,Hf=/\u0000|\uFFFD/g;function Il(t){return(typeof t=="string"?t:""+t).replace(Wf,`
`).replace(Hf,"")}function gr(t,e,n){if(e=Il(e),Il(t)!==e&&n)throw Error(ne(425))}function Gr(){}var Pa=null,Ea=null;function Oa(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ja=typeof setTimeout=="function"?setTimeout:void 0,Vf=typeof clearTimeout=="function"?clearTimeout:void 0,Al=typeof Promise=="function"?Promise:void 0,Xf=typeof queueMicrotask=="function"?queueMicrotask:typeof Al<"u"?function(t){return Al.resolve(null).then(t).catch(Yf)}:ja;function Yf(t){setTimeout(function(){throw t})}function Hs(t,e){var n=e,c=0;do{var p=n.nextSibling;if(t.removeChild(n),p&&p.nodeType===8)if(n=p.data,n==="/$"){if(c===0){t.removeChild(p),Ni(e);return}c--}else n!=="$"&&n!=="$?"&&n!=="$!"||c++;n=p}while(n);Ni(e)}function qt(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ml(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var si=Math.random().toString(36).slice(2),_t="__reactFiber$"+si,Bi="__reactProps$"+si,Nt="__reactContainer$"+si,Ia="__reactEvents$"+si,$f="__reactListeners$"+si,Kf="__reactHandles$"+si;function hn(t){var e=t[_t];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Nt]||n[_t]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ml(t);t!==null;){if(n=t[_t])return n;t=Ml(t)}return e}t=n,n=t.parentNode}return null}function Ji(t){return t=t[_t]||t[Nt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Mn(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ne(33))}function ds(t){return t[Bi]||null}var Aa=[],Dn=-1;function sn(t){return{current:t}}function Ce(t){0>Dn||(t.current=Aa[Dn],Aa[Dn]=null,Dn--)}function we(t,e){Dn++,Aa[Dn]=t.current,t.current=e}var nn={},Ge=sn(nn),qe=sn(!1),vn=nn;function $n(t,e){var n=t.type.contextTypes;if(!n)return nn;var c=t.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===e)return c.__reactInternalMemoizedMaskedChildContext;var p={},v;for(v in n)p[v]=e[v];return c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=p),p}function Qe(t){return t=t.childContextTypes,t!=null}function Wr(){Ce(qe),Ce(Ge)}function Dl(t,e,n){if(Ge.current!==nn)throw Error(ne(168));we(Ge,e),we(qe,n)}function Du(t,e,n){var c=t.stateNode;if(e=e.childContextTypes,typeof c.getChildContext!="function")return n;c=c.getChildContext();for(var p in c)if(!(p in e))throw Error(ne(108,Ad(t)||"Unknown",p));return Pe({},n,c)}function Hr(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||nn,vn=Ge.current,we(Ge,t),we(qe,qe.current),!0}function Nl(t,e,n){var c=t.stateNode;if(!c)throw Error(ne(169));n?(t=Du(t,e,vn),c.__reactInternalMemoizedMergedChildContext=t,Ce(qe),Ce(Ge),we(Ge,t)):Ce(qe),we(qe,n)}var jt=null,fs=!1,Vs=!1;function Nu(t){jt===null?jt=[t]:jt.push(t)}function qf(t){fs=!0,Nu(t)}function an(){if(!Vs&&jt!==null){Vs=!0;var t=0,e=xe;try{var n=jt;for(xe=1;t<n.length;t++){var c=n[t];do c=c(!0);while(c!==null)}jt=null,fs=!1}catch(p){throw jt!==null&&(jt=jt.slice(t+1)),au(fo,an),p}finally{xe=e,Vs=!1}}return null}var Nn=[],Fn=0,Vr=null,Xr=0,ot=[],lt=0,yn=null,It=1,At="";function on(t,e){Nn[Fn++]=Xr,Nn[Fn++]=Vr,Vr=t,Xr=e}function Fu(t,e,n){ot[lt++]=It,ot[lt++]=At,ot[lt++]=yn,yn=t;var c=It;t=At;var p=32-yt(c)-1;c&=~(1<<p),n+=1;var v=32-yt(e)+p;if(30<v){var S=p-p%5;v=(c&(1<<S)-1).toString(32),c>>=S,p-=S,It=1<<32-yt(e)+p|n<<p|c,At=v+t}else It=1<<v|n<<p|c,At=t}function Co(t){t.return!==null&&(on(t,1),Fu(t,1,0))}function bo(t){for(;t===Vr;)Vr=Nn[--Fn],Nn[Fn]=null,Xr=Nn[--Fn],Nn[Fn]=null;for(;t===yn;)yn=ot[--lt],ot[lt]=null,At=ot[--lt],ot[lt]=null,It=ot[--lt],ot[lt]=null}var nt=null,tt=null,_e=!1,vt=null;function Lu(t,e){var n=ct(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Fl(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,nt=t,tt=qt(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,nt=t,tt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=yn!==null?{id:It,overflow:At}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ct(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,nt=t,tt=null,!0):!1;default:return!1}}function Ma(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Da(t){if(_e){var e=tt;if(e){var n=e;if(!Fl(t,e)){if(Ma(t))throw Error(ne(418));e=qt(n.nextSibling);var c=nt;e&&Fl(t,e)?Lu(c,n):(t.flags=t.flags&-4097|2,_e=!1,nt=t)}}else{if(Ma(t))throw Error(ne(418));t.flags=t.flags&-4097|2,_e=!1,nt=t}}}function Ll(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;nt=t}function mr(t){if(t!==nt)return!1;if(!_e)return Ll(t),_e=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Oa(t.type,t.memoizedProps)),e&&(e=tt)){if(Ma(t))throw Ru(),Error(ne(418));for(;e;)Lu(t,e),e=qt(e.nextSibling)}if(Ll(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ne(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){tt=qt(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}tt=null}}else tt=nt?qt(t.stateNode.nextSibling):null;return!0}function Ru(){for(var t=tt;t;)t=qt(t.nextSibling)}function Kn(){tt=nt=null,_e=!1}function _o(t){vt===null?vt=[t]:vt.push(t)}var Qf=zt.ReactCurrentBatchConfig;function di(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ne(309));var c=n.stateNode}if(!c)throw Error(ne(147,t));var p=c,v=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===v?e.ref:(e=function(S){var h=p.refs;S===null?delete h[v]:h[v]=S},e._stringRef=v,e)}if(typeof t!="string")throw Error(ne(284));if(!n._owner)throw Error(ne(290,t))}return t}function pr(t,e){throw t=Object.prototype.toString.call(e),Error(ne(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Rl(t){var e=t._init;return e(t._payload)}function zu(t){function e(f,m){if(t){var y=f.deletions;y===null?(f.deletions=[m],f.flags|=16):y.push(m)}}function n(f,m){if(!t)return null;for(;m!==null;)e(f,m),m=m.sibling;return null}function c(f,m){for(f=new Map;m!==null;)m.key!==null?f.set(m.key,m):f.set(m.index,m),m=m.sibling;return f}function p(f,m){return f=en(f,m),f.index=0,f.sibling=null,f}function v(f,m,y){return f.index=y,t?(y=f.alternate,y!==null?(y=y.index,y<m?(f.flags|=2,m):y):(f.flags|=2,m)):(f.flags|=1048576,m)}function S(f){return t&&f.alternate===null&&(f.flags|=2),f}function h(f,m,y,x){return m===null||m.tag!==6?(m=Js(y,f.mode,x),m.return=f,m):(m=p(m,y),m.return=f,m)}function s(f,m,y,x){var C=y.type;return C===On?d(f,m,y.props.children,x,y.key):m!==null&&(m.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Ut&&Rl(C)===m.type)?(x=p(m,y.props),x.ref=di(f,m,y),x.return=f,x):(x=Mr(y.type,y.key,y.props,null,f.mode,x),x.ref=di(f,m,y),x.return=f,x)}function u(f,m,y,x){return m===null||m.tag!==4||m.stateNode.containerInfo!==y.containerInfo||m.stateNode.implementation!==y.implementation?(m=Zs(y,f.mode,x),m.return=f,m):(m=p(m,y.children||[]),m.return=f,m)}function d(f,m,y,x,C){return m===null||m.tag!==7?(m=mn(y,f.mode,x,C),m.return=f,m):(m=p(m,y),m.return=f,m)}function r(f,m,y){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Js(""+m,f.mode,y),m.return=f,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case sr:return y=Mr(m.type,m.key,m.props,null,f.mode,y),y.ref=di(f,null,m),y.return=f,y;case En:return m=Zs(m,f.mode,y),m.return=f,m;case Ut:var x=m._init;return r(f,x(m._payload),y)}if(vi(m)||oi(m))return m=mn(m,f.mode,y,null),m.return=f,m;pr(f,m)}return null}function a(f,m,y,x){var C=m!==null?m.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return C!==null?null:h(f,m,""+y,x);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case sr:return y.key===C?s(f,m,y,x):null;case En:return y.key===C?u(f,m,y,x):null;case Ut:return C=y._init,a(f,m,C(y._payload),x)}if(vi(y)||oi(y))return C!==null?null:d(f,m,y,x,null);pr(f,y)}return null}function i(f,m,y,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return f=f.get(y)||null,h(m,f,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case sr:return f=f.get(x.key===null?y:x.key)||null,s(m,f,x,C);case En:return f=f.get(x.key===null?y:x.key)||null,u(m,f,x,C);case Ut:var b=x._init;return i(f,m,y,b(x._payload),C)}if(vi(x)||oi(x))return f=f.get(y)||null,d(m,f,x,C,null);pr(m,x)}return null}function l(f,m,y,x){for(var C=null,b=null,T=m,E=m=0,L=null;T!==null&&E<y.length;E++){T.index>E?(L=T,T=null):L=T.sibling;var F=a(f,T,y[E],x);if(F===null){T===null&&(T=L);break}t&&T&&F.alternate===null&&e(f,T),m=v(F,m,E),b===null?C=F:b.sibling=F,b=F,T=L}if(E===y.length)return n(f,T),_e&&on(f,E),C;if(T===null){for(;E<y.length;E++)T=r(f,y[E],x),T!==null&&(m=v(T,m,E),b===null?C=T:b.sibling=T,b=T);return _e&&on(f,E),C}for(T=c(f,T);E<y.length;E++)L=i(T,f,E,y[E],x),L!==null&&(t&&L.alternate!==null&&T.delete(L.key===null?E:L.key),m=v(L,m,E),b===null?C=L:b.sibling=L,b=L);return t&&T.forEach(function(H){return e(f,H)}),_e&&on(f,E),C}function g(f,m,y,x){var C=oi(y);if(typeof C!="function")throw Error(ne(150));if(y=C.call(y),y==null)throw Error(ne(151));for(var b=C=null,T=m,E=m=0,L=null,F=y.next();T!==null&&!F.done;E++,F=y.next()){T.index>E?(L=T,T=null):L=T.sibling;var H=a(f,T,F.value,x);if(H===null){T===null&&(T=L);break}t&&T&&H.alternate===null&&e(f,T),m=v(H,m,E),b===null?C=H:b.sibling=H,b=H,T=L}if(F.done)return n(f,T),_e&&on(f,E),C;if(T===null){for(;!F.done;E++,F=y.next())F=r(f,F.value,x),F!==null&&(m=v(F,m,E),b===null?C=F:b.sibling=F,b=F);return _e&&on(f,E),C}for(T=c(f,T);!F.done;E++,F=y.next())F=i(T,f,E,F.value,x),F!==null&&(t&&F.alternate!==null&&T.delete(F.key===null?E:F.key),m=v(F,m,E),b===null?C=F:b.sibling=F,b=F);return t&&T.forEach(function(J){return e(f,J)}),_e&&on(f,E),C}function o(f,m,y,x){if(typeof y=="object"&&y!==null&&y.type===On&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case sr:e:{for(var C=y.key,b=m;b!==null;){if(b.key===C){if(C=y.type,C===On){if(b.tag===7){n(f,b.sibling),m=p(b,y.props.children),m.return=f,f=m;break e}}else if(b.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Ut&&Rl(C)===b.type){n(f,b.sibling),m=p(b,y.props),m.ref=di(f,b,y),m.return=f,f=m;break e}n(f,b);break}else e(f,b);b=b.sibling}y.type===On?(m=mn(y.props.children,f.mode,x,y.key),m.return=f,f=m):(x=Mr(y.type,y.key,y.props,null,f.mode,x),x.ref=di(f,m,y),x.return=f,f=x)}return S(f);case En:e:{for(b=y.key;m!==null;){if(m.key===b)if(m.tag===4&&m.stateNode.containerInfo===y.containerInfo&&m.stateNode.implementation===y.implementation){n(f,m.sibling),m=p(m,y.children||[]),m.return=f,f=m;break e}else{n(f,m);break}else e(f,m);m=m.sibling}m=Zs(y,f.mode,x),m.return=f,f=m}return S(f);case Ut:return b=y._init,o(f,m,b(y._payload),x)}if(vi(y))return l(f,m,y,x);if(oi(y))return g(f,m,y,x);pr(f,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,m!==null&&m.tag===6?(n(f,m.sibling),m=p(m,y),m.return=f,f=m):(n(f,m),m=Js(y,f.mode,x),m.return=f,f=m),S(f)):n(f,m)}return o}var qn=zu(!0),Bu=zu(!1),Yr=sn(null),$r=null,Ln=null,To=null;function ko(){To=Ln=$r=null}function Po(t){var e=Yr.current;Ce(Yr),t._currentValue=e}function Na(t,e,n){for(;t!==null;){var c=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,c!==null&&(c.childLanes|=e)):c!==null&&(c.childLanes&e)!==e&&(c.childLanes|=e),t===n)break;t=t.return}}function Hn(t,e){$r=t,To=Ln=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ke=!0),t.firstContext=null)}function ht(t){var e=t._currentValue;if(To!==t)if(t={context:t,memoizedValue:e,next:null},Ln===null){if($r===null)throw Error(ne(308));Ln=t,$r.dependencies={lanes:0,firstContext:t}}else Ln=Ln.next=t;return e}var dn=null;function Eo(t){dn===null?dn=[t]:dn.push(t)}function Uu(t,e,n,c){var p=e.interleaved;return p===null?(n.next=n,Eo(e)):(n.next=p.next,p.next=n),e.interleaved=n,Ft(t,c)}function Ft(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Gt=!1;function Oo(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Gu(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Mt(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Qt(t,e,n){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,ye&2){var p=c.pending;return p===null?e.next=e:(e.next=p.next,p.next=e),c.pending=e,Ft(t,n)}return p=c.interleaved,p===null?(e.next=e,Eo(c)):(e.next=p.next,p.next=e),c.interleaved=e,Ft(t,n)}function Pr(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,go(t,n)}}function zl(t,e){var n=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,n===c)){var p=null,v=null;if(n=n.firstBaseUpdate,n!==null){do{var S={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};v===null?p=v=S:v=v.next=S,n=n.next}while(n!==null);v===null?p=v=e:v=v.next=e}else p=v=e;n={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:v,shared:c.shared,effects:c.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Kr(t,e,n,c){var p=t.updateQueue;Gt=!1;var v=p.firstBaseUpdate,S=p.lastBaseUpdate,h=p.shared.pending;if(h!==null){p.shared.pending=null;var s=h,u=s.next;s.next=null,S===null?v=u:S.next=u,S=s;var d=t.alternate;d!==null&&(d=d.updateQueue,h=d.lastBaseUpdate,h!==S&&(h===null?d.firstBaseUpdate=u:h.next=u,d.lastBaseUpdate=s))}if(v!==null){var r=p.baseState;S=0,d=u=s=null,h=v;do{var a=h.lane,i=h.eventTime;if((c&a)===a){d!==null&&(d=d.next={eventTime:i,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var l=t,g=h;switch(a=e,i=n,g.tag){case 1:if(l=g.payload,typeof l=="function"){r=l.call(i,r,a);break e}r=l;break e;case 3:l.flags=l.flags&-65537|128;case 0:if(l=g.payload,a=typeof l=="function"?l.call(i,r,a):l,a==null)break e;r=Pe({},r,a);break e;case 2:Gt=!0}}h.callback!==null&&h.lane!==0&&(t.flags|=64,a=p.effects,a===null?p.effects=[h]:a.push(h))}else i={eventTime:i,lane:a,tag:h.tag,payload:h.payload,callback:h.callback,next:null},d===null?(u=d=i,s=r):d=d.next=i,S|=a;if(h=h.next,h===null){if(h=p.shared.pending,h===null)break;a=h,h=a.next,a.next=null,p.lastBaseUpdate=a,p.shared.pending=null}}while(1);if(d===null&&(s=r),p.baseState=s,p.firstBaseUpdate=u,p.lastBaseUpdate=d,e=p.shared.interleaved,e!==null){p=e;do S|=p.lane,p=p.next;while(p!==e)}else v===null&&(p.shared.lanes=0);wn|=S,t.lanes=S,t.memoizedState=r}}function Bl(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var c=t[e],p=c.callback;if(p!==null){if(c.callback=null,c=n,typeof p!="function")throw Error(ne(191,p));p.call(c)}}}var Zi={},kt=sn(Zi),Ui=sn(Zi),Gi=sn(Zi);function fn(t){if(t===Zi)throw Error(ne(174));return t}function jo(t,e){switch(we(Gi,e),we(Ui,t),we(kt,Zi),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ma(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ma(e,t)}Ce(kt),we(kt,e)}function Qn(){Ce(kt),Ce(Ui),Ce(Gi)}function Wu(t){fn(Gi.current);var e=fn(kt.current),n=ma(e,t.type);e!==n&&(we(Ui,t),we(kt,n))}function Io(t){Ui.current===t&&(Ce(kt),Ce(Ui))}var Te=sn(0);function qr(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Xs=[];function Ao(){for(var t=0;t<Xs.length;t++)Xs[t]._workInProgressVersionPrimary=null;Xs.length=0}var Er=zt.ReactCurrentDispatcher,Ys=zt.ReactCurrentBatchConfig,xn=0,ke=null,Ie=null,Me=null,Qr=!1,Ti=!1,Wi=0,Jf=0;function ze(){throw Error(ne(321))}function Mo(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!wt(t[n],e[n]))return!1;return!0}function Do(t,e,n,c,p,v){if(xn=v,ke=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Er.current=t===null||t.memoizedState===null?ng:ig,t=n(c,p),Ti){v=0;do{if(Ti=!1,Wi=0,25<=v)throw Error(ne(301));v+=1,Me=Ie=null,e.updateQueue=null,Er.current=rg,t=n(c,p)}while(Ti)}if(Er.current=Jr,e=Ie!==null&&Ie.next!==null,xn=0,Me=Ie=ke=null,Qr=!1,e)throw Error(ne(300));return t}function No(){var t=Wi!==0;return Wi=0,t}function bt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?ke.memoizedState=Me=t:Me=Me.next=t,Me}function dt(){if(Ie===null){var t=ke.alternate;t=t!==null?t.memoizedState:null}else t=Ie.next;var e=Me===null?ke.memoizedState:Me.next;if(e!==null)Me=e,Ie=t;else{if(t===null)throw Error(ne(310));Ie=t,t={memoizedState:Ie.memoizedState,baseState:Ie.baseState,baseQueue:Ie.baseQueue,queue:Ie.queue,next:null},Me===null?ke.memoizedState=Me=t:Me=Me.next=t}return Me}function Hi(t,e){return typeof e=="function"?e(t):e}function $s(t){var e=dt(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var c=Ie,p=c.baseQueue,v=n.pending;if(v!==null){if(p!==null){var S=p.next;p.next=v.next,v.next=S}c.baseQueue=p=v,n.pending=null}if(p!==null){v=p.next,c=c.baseState;var h=S=null,s=null,u=v;do{var d=u.lane;if((xn&d)===d)s!==null&&(s=s.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),c=u.hasEagerState?u.eagerState:t(c,u.action);else{var r={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};s===null?(h=s=r,S=c):s=s.next=r,ke.lanes|=d,wn|=d}u=u.next}while(u!==null&&u!==v);s===null?S=c:s.next=h,wt(c,e.memoizedState)||(Ke=!0),e.memoizedState=c,e.baseState=S,e.baseQueue=s,n.lastRenderedState=c}if(t=n.interleaved,t!==null){p=t;do v=p.lane,ke.lanes|=v,wn|=v,p=p.next;while(p!==t)}else p===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ks(t){var e=dt(),n=e.queue;if(n===null)throw Error(ne(311));n.lastRenderedReducer=t;var c=n.dispatch,p=n.pending,v=e.memoizedState;if(p!==null){n.pending=null;var S=p=p.next;do v=t(v,S.action),S=S.next;while(S!==p);wt(v,e.memoizedState)||(Ke=!0),e.memoizedState=v,e.baseQueue===null&&(e.baseState=v),n.lastRenderedState=v}return[v,c]}function Hu(){}function Vu(t,e){var n=ke,c=dt(),p=e(),v=!wt(c.memoizedState,p);if(v&&(c.memoizedState=p,Ke=!0),c=c.queue,Fo($u.bind(null,n,c,t),[t]),c.getSnapshot!==e||v||Me!==null&&Me.memoizedState.tag&1){if(n.flags|=2048,Vi(9,Yu.bind(null,n,c,p,e),void 0,null),De===null)throw Error(ne(349));xn&30||Xu(n,e,p)}return p}function Xu(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=ke.updateQueue,e===null?(e={lastEffect:null,stores:null},ke.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Yu(t,e,n,c){e.value=n,e.getSnapshot=c,Ku(e)&&qu(t)}function $u(t,e,n){return n(function(){Ku(e)&&qu(t)})}function Ku(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!wt(t,n)}catch{return!0}}function qu(t){var e=Ft(t,1);e!==null&&xt(e,t,1,-1)}function Ul(t){var e=bt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hi,lastRenderedState:t},e.queue=t,t=t.dispatch=tg.bind(null,ke,t),[e.memoizedState,t]}function Vi(t,e,n,c){return t={tag:t,create:e,destroy:n,deps:c,next:null},e=ke.updateQueue,e===null?(e={lastEffect:null,stores:null},ke.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(c=n.next,n.next=t,t.next=c,e.lastEffect=t)),t}function Qu(){return dt().memoizedState}function Or(t,e,n,c){var p=bt();ke.flags|=t,p.memoizedState=Vi(1|e,n,void 0,c===void 0?null:c)}function gs(t,e,n,c){var p=dt();c=c===void 0?null:c;var v=void 0;if(Ie!==null){var S=Ie.memoizedState;if(v=S.destroy,c!==null&&Mo(c,S.deps)){p.memoizedState=Vi(e,n,v,c);return}}ke.flags|=t,p.memoizedState=Vi(1|e,n,v,c)}function Gl(t,e){return Or(8390656,8,t,e)}function Fo(t,e){return gs(2048,8,t,e)}function Ju(t,e){return gs(4,2,t,e)}function Zu(t,e){return gs(4,4,t,e)}function eh(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function th(t,e,n){return n=n!=null?n.concat([t]):null,gs(4,4,eh.bind(null,e,t),n)}function Lo(){}function nh(t,e){var n=dt();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&Mo(e,c[1])?c[0]:(n.memoizedState=[t,e],t)}function ih(t,e){var n=dt();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&Mo(e,c[1])?c[0]:(t=t(),n.memoizedState=[t,e],t)}function rh(t,e,n){return xn&21?(wt(n,e)||(n=cu(),ke.lanes|=n,wn|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ke=!0),t.memoizedState=n)}function Zf(t,e){var n=xe;xe=n!==0&&4>n?n:4,t(!0);var c=Ys.transition;Ys.transition={};try{t(!1),e()}finally{xe=n,Ys.transition=c}}function sh(){return dt().memoizedState}function eg(t,e,n){var c=Zt(t);if(n={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null},ah(t))oh(e,n);else if(n=Uu(t,e,n,c),n!==null){var p=Ve();xt(n,t,c,p),lh(n,e,c)}}function tg(t,e,n){var c=Zt(t),p={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null};if(ah(t))oh(e,p);else{var v=t.alternate;if(t.lanes===0&&(v===null||v.lanes===0)&&(v=e.lastRenderedReducer,v!==null))try{var S=e.lastRenderedState,h=v(S,n);if(p.hasEagerState=!0,p.eagerState=h,wt(h,S)){var s=e.interleaved;s===null?(p.next=p,Eo(e)):(p.next=s.next,s.next=p),e.interleaved=p;return}}catch{}finally{}n=Uu(t,e,p,c),n!==null&&(p=Ve(),xt(n,t,c,p),lh(n,e,c))}}function ah(t){var e=t.alternate;return t===ke||e!==null&&e===ke}function oh(t,e){Ti=Qr=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function lh(t,e,n){if(n&4194240){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,go(t,n)}}var Jr={readContext:ht,useCallback:ze,useContext:ze,useEffect:ze,useImperativeHandle:ze,useInsertionEffect:ze,useLayoutEffect:ze,useMemo:ze,useReducer:ze,useRef:ze,useState:ze,useDebugValue:ze,useDeferredValue:ze,useTransition:ze,useMutableSource:ze,useSyncExternalStore:ze,useId:ze,unstable_isNewReconciler:!1},ng={readContext:ht,useCallback:function(t,e){return bt().memoizedState=[t,e===void 0?null:e],t},useContext:ht,useEffect:Gl,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Or(4194308,4,eh.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Or(4194308,4,t,e)},useInsertionEffect:function(t,e){return Or(4,2,t,e)},useMemo:function(t,e){var n=bt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var c=bt();return e=n!==void 0?n(e):e,c.memoizedState=c.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},c.queue=t,t=t.dispatch=eg.bind(null,ke,t),[c.memoizedState,t]},useRef:function(t){var e=bt();return t={current:t},e.memoizedState=t},useState:Ul,useDebugValue:Lo,useDeferredValue:function(t){return bt().memoizedState=t},useTransition:function(){var t=Ul(!1),e=t[0];return t=Zf.bind(null,t[1]),bt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var c=ke,p=bt();if(_e){if(n===void 0)throw Error(ne(407));n=n()}else{if(n=e(),De===null)throw Error(ne(349));xn&30||Xu(c,e,n)}p.memoizedState=n;var v={value:n,getSnapshot:e};return p.queue=v,Gl($u.bind(null,c,v,t),[t]),c.flags|=2048,Vi(9,Yu.bind(null,c,v,n,e),void 0,null),n},useId:function(){var t=bt(),e=De.identifierPrefix;if(_e){var n=At,c=It;n=(c&~(1<<32-yt(c)-1)).toString(32)+n,e=":"+e+"R"+n,n=Wi++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Jf++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},ig={readContext:ht,useCallback:nh,useContext:ht,useEffect:Fo,useImperativeHandle:th,useInsertionEffect:Ju,useLayoutEffect:Zu,useMemo:ih,useReducer:$s,useRef:Qu,useState:function(){return $s(Hi)},useDebugValue:Lo,useDeferredValue:function(t){var e=dt();return rh(e,Ie.memoizedState,t)},useTransition:function(){var t=$s(Hi)[0],e=dt().memoizedState;return[t,e]},useMutableSource:Hu,useSyncExternalStore:Vu,useId:sh,unstable_isNewReconciler:!1},rg={readContext:ht,useCallback:nh,useContext:ht,useEffect:Fo,useImperativeHandle:th,useInsertionEffect:Ju,useLayoutEffect:Zu,useMemo:ih,useReducer:Ks,useRef:Qu,useState:function(){return Ks(Hi)},useDebugValue:Lo,useDeferredValue:function(t){var e=dt();return Ie===null?e.memoizedState=t:rh(e,Ie.memoizedState,t)},useTransition:function(){var t=Ks(Hi)[0],e=dt().memoizedState;return[t,e]},useMutableSource:Hu,useSyncExternalStore:Vu,useId:sh,unstable_isNewReconciler:!1};function mt(t,e){if(t&&t.defaultProps){e=Pe({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Fa(t,e,n,c){e=t.memoizedState,n=n(c,e),n=n==null?e:Pe({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ms={isMounted:function(t){return(t=t._reactInternals)?bn(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var c=Ve(),p=Zt(t),v=Mt(c,p);v.payload=e,n!=null&&(v.callback=n),e=Qt(t,v,p),e!==null&&(xt(e,t,p,c),Pr(e,t,p))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var c=Ve(),p=Zt(t),v=Mt(c,p);v.tag=1,v.payload=e,n!=null&&(v.callback=n),e=Qt(t,v,p),e!==null&&(xt(e,t,p,c),Pr(e,t,p))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ve(),c=Zt(t),p=Mt(n,c);p.tag=2,e!=null&&(p.callback=e),e=Qt(t,p,c),e!==null&&(xt(e,t,c,n),Pr(e,t,c))}};function Wl(t,e,n,c,p,v,S){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,v,S):e.prototype&&e.prototype.isPureReactComponent?!Li(n,c)||!Li(p,v):!0}function ch(t,e,n){var c=!1,p=nn,v=e.contextType;return typeof v=="object"&&v!==null?v=ht(v):(p=Qe(e)?vn:Ge.current,c=e.contextTypes,v=(c=c!=null)?$n(t,p):nn),e=new e(n,v),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ms,t.stateNode=e,e._reactInternals=t,c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=p,t.__reactInternalMemoizedMaskedChildContext=v),e}function Hl(t,e,n,c){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,c),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,c),e.state!==t&&ms.enqueueReplaceState(e,e.state,null)}function La(t,e,n,c){var p=t.stateNode;p.props=n,p.state=t.memoizedState,p.refs={},Oo(t);var v=e.contextType;typeof v=="object"&&v!==null?p.context=ht(v):(v=Qe(e)?vn:Ge.current,p.context=$n(t,v)),p.state=t.memoizedState,v=e.getDerivedStateFromProps,typeof v=="function"&&(Fa(t,e,v,n),p.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(e=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),e!==p.state&&ms.enqueueReplaceState(p,p.state,null),Kr(t,n,p,c),p.state=t.memoizedState),typeof p.componentDidMount=="function"&&(t.flags|=4194308)}function Jn(t,e){try{var n="",c=e;do n+=Id(c),c=c.return;while(c);var p=n}catch(v){p=`
Error generating stack: `+v.message+`
`+v.stack}return{value:t,source:e,stack:p,digest:null}}function qs(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ra(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var sg=typeof WeakMap=="function"?WeakMap:Map;function uh(t,e,n){n=Mt(-1,n),n.tag=3,n.payload={element:null};var c=e.value;return n.callback=function(){es||(es=!0,$a=c),Ra(t,e)},n}function hh(t,e,n){n=Mt(-1,n),n.tag=3;var c=t.type.getDerivedStateFromError;if(typeof c=="function"){var p=e.value;n.payload=function(){return c(p)},n.callback=function(){Ra(t,e)}}var v=t.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(n.callback=function(){Ra(t,e),typeof c!="function"&&(Jt===null?Jt=new Set([this]):Jt.add(this));var S=e.stack;this.componentDidCatch(e.value,{componentStack:S!==null?S:""})}),n}function Vl(t,e,n){var c=t.pingCache;if(c===null){c=t.pingCache=new sg;var p=new Set;c.set(e,p)}else p=c.get(e),p===void 0&&(p=new Set,c.set(e,p));p.has(n)||(p.add(n),t=xg.bind(null,t,e,n),e.then(t,t))}function Xl(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Yl(t,e,n,c,p){return t.mode&1?(t.flags|=65536,t.lanes=p,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Mt(-1,1),e.tag=2,Qt(n,e,1))),n.lanes|=1),t)}var ag=zt.ReactCurrentOwner,Ke=!1;function We(t,e,n,c){e.child=t===null?Bu(e,null,n,c):qn(e,t.child,n,c)}function $l(t,e,n,c,p){n=n.render;var v=e.ref;return Hn(e,p),c=Do(t,e,n,c,v,p),n=No(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~p,Lt(t,e,p)):(_e&&n&&Co(e),e.flags|=1,We(t,e,c,p),e.child)}function Kl(t,e,n,c,p){if(t===null){var v=n.type;return typeof v=="function"&&!Vo(v)&&v.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=v,dh(t,e,v,c,p)):(t=Mr(n.type,null,c,e,e.mode,p),t.ref=e.ref,t.return=e,e.child=t)}if(v=t.child,!(t.lanes&p)){var S=v.memoizedProps;if(n=n.compare,n=n!==null?n:Li,n(S,c)&&t.ref===e.ref)return Lt(t,e,p)}return e.flags|=1,t=en(v,c),t.ref=e.ref,t.return=e,e.child=t}function dh(t,e,n,c,p){if(t!==null){var v=t.memoizedProps;if(Li(v,c)&&t.ref===e.ref)if(Ke=!1,e.pendingProps=c=v,(t.lanes&p)!==0)t.flags&131072&&(Ke=!0);else return e.lanes=t.lanes,Lt(t,e,p)}return za(t,e,n,c,p)}function fh(t,e,n){var c=e.pendingProps,p=c.children,v=t!==null?t.memoizedState:null;if(c.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},we(zn,et),et|=n;else{if(!(n&1073741824))return t=v!==null?v.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,we(zn,et),et|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=v!==null?v.baseLanes:n,we(zn,et),et|=c}else v!==null?(c=v.baseLanes|n,e.memoizedState=null):c=n,we(zn,et),et|=c;return We(t,e,p,n),e.child}function gh(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function za(t,e,n,c,p){var v=Qe(n)?vn:Ge.current;return v=$n(e,v),Hn(e,p),n=Do(t,e,n,c,v,p),c=No(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~p,Lt(t,e,p)):(_e&&c&&Co(e),e.flags|=1,We(t,e,n,p),e.child)}function ql(t,e,n,c,p){if(Qe(n)){var v=!0;Hr(e)}else v=!1;if(Hn(e,p),e.stateNode===null)jr(t,e),ch(e,n,c),La(e,n,c,p),c=!0;else if(t===null){var S=e.stateNode,h=e.memoizedProps;S.props=h;var s=S.context,u=n.contextType;typeof u=="object"&&u!==null?u=ht(u):(u=Qe(n)?vn:Ge.current,u=$n(e,u));var d=n.getDerivedStateFromProps,r=typeof d=="function"||typeof S.getSnapshotBeforeUpdate=="function";r||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(h!==c||s!==u)&&Hl(e,S,c,u),Gt=!1;var a=e.memoizedState;S.state=a,Kr(e,c,S,p),s=e.memoizedState,h!==c||a!==s||qe.current||Gt?(typeof d=="function"&&(Fa(e,n,d,c),s=e.memoizedState),(h=Gt||Wl(e,n,h,c,a,s,u))?(r||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(e.flags|=4194308)):(typeof S.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=c,e.memoizedState=s),S.props=c,S.state=s,S.context=u,c=h):(typeof S.componentDidMount=="function"&&(e.flags|=4194308),c=!1)}else{S=e.stateNode,Gu(t,e),h=e.memoizedProps,u=e.type===e.elementType?h:mt(e.type,h),S.props=u,r=e.pendingProps,a=S.context,s=n.contextType,typeof s=="object"&&s!==null?s=ht(s):(s=Qe(n)?vn:Ge.current,s=$n(e,s));var i=n.getDerivedStateFromProps;(d=typeof i=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(h!==r||a!==s)&&Hl(e,S,c,s),Gt=!1,a=e.memoizedState,S.state=a,Kr(e,c,S,p);var l=e.memoizedState;h!==r||a!==l||qe.current||Gt?(typeof i=="function"&&(Fa(e,n,i,c),l=e.memoizedState),(u=Gt||Wl(e,n,u,c,a,l,s)||!1)?(d||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(c,l,s),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(c,l,s)),typeof S.componentDidUpdate=="function"&&(e.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof S.componentDidUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=1024),e.memoizedProps=c,e.memoizedState=l),S.props=c,S.state=l,S.context=s,c=u):(typeof S.componentDidUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=1024),c=!1)}return Ba(t,e,n,c,v,p)}function Ba(t,e,n,c,p,v){gh(t,e);var S=(e.flags&128)!==0;if(!c&&!S)return p&&Nl(e,n,!1),Lt(t,e,v);c=e.stateNode,ag.current=e;var h=S&&typeof n.getDerivedStateFromError!="function"?null:c.render();return e.flags|=1,t!==null&&S?(e.child=qn(e,t.child,null,v),e.child=qn(e,null,h,v)):We(t,e,h,v),e.memoizedState=c.state,p&&Nl(e,n,!0),e.child}function mh(t){var e=t.stateNode;e.pendingContext?Dl(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Dl(t,e.context,!1),jo(t,e.containerInfo)}function Ql(t,e,n,c,p){return Kn(),_o(p),e.flags|=256,We(t,e,n,c),e.child}var Ua={dehydrated:null,treeContext:null,retryLane:0};function Ga(t){return{baseLanes:t,cachePool:null,transitions:null}}function ph(t,e,n){var c=e.pendingProps,p=Te.current,v=!1,S=(e.flags&128)!==0,h;if((h=S)||(h=t!==null&&t.memoizedState===null?!1:(p&2)!==0),h?(v=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(p|=1),we(Te,p&1),t===null)return Da(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(S=c.children,t=c.fallback,v?(c=e.mode,v=e.child,S={mode:"hidden",children:S},!(c&1)&&v!==null?(v.childLanes=0,v.pendingProps=S):v=ys(S,c,0,null),t=mn(t,c,n,null),v.return=e,t.return=e,v.sibling=t,e.child=v,e.child.memoizedState=Ga(n),e.memoizedState=Ua,t):Ro(e,S));if(p=t.memoizedState,p!==null&&(h=p.dehydrated,h!==null))return og(t,e,S,c,h,p,n);if(v){v=c.fallback,S=e.mode,p=t.child,h=p.sibling;var s={mode:"hidden",children:c.children};return!(S&1)&&e.child!==p?(c=e.child,c.childLanes=0,c.pendingProps=s,e.deletions=null):(c=en(p,s),c.subtreeFlags=p.subtreeFlags&14680064),h!==null?v=en(h,v):(v=mn(v,S,n,null),v.flags|=2),v.return=e,c.return=e,c.sibling=v,e.child=c,c=v,v=e.child,S=t.child.memoizedState,S=S===null?Ga(n):{baseLanes:S.baseLanes|n,cachePool:null,transitions:S.transitions},v.memoizedState=S,v.childLanes=t.childLanes&~n,e.memoizedState=Ua,c}return v=t.child,t=v.sibling,c=en(v,{mode:"visible",children:c.children}),!(e.mode&1)&&(c.lanes=n),c.return=e,c.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=c,e.memoizedState=null,c}function Ro(t,e){return e=ys({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function vr(t,e,n,c){return c!==null&&_o(c),qn(e,t.child,null,n),t=Ro(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function og(t,e,n,c,p,v,S){if(n)return e.flags&256?(e.flags&=-257,c=qs(Error(ne(422))),vr(t,e,S,c)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(v=c.fallback,p=e.mode,c=ys({mode:"visible",children:c.children},p,0,null),v=mn(v,p,S,null),v.flags|=2,c.return=e,v.return=e,c.sibling=v,e.child=c,e.mode&1&&qn(e,t.child,null,S),e.child.memoizedState=Ga(S),e.memoizedState=Ua,v);if(!(e.mode&1))return vr(t,e,S,null);if(p.data==="$!"){if(c=p.nextSibling&&p.nextSibling.dataset,c)var h=c.dgst;return c=h,v=Error(ne(419)),c=qs(v,c,void 0),vr(t,e,S,c)}if(h=(S&t.childLanes)!==0,Ke||h){if(c=De,c!==null){switch(S&-S){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(c.suspendedLanes|S)?0:p,p!==0&&p!==v.retryLane&&(v.retryLane=p,Ft(t,p),xt(c,t,p,-1))}return Ho(),c=qs(Error(ne(421))),vr(t,e,S,c)}return p.data==="$?"?(e.flags|=128,e.child=t.child,e=wg.bind(null,t),p._reactRetry=e,null):(t=v.treeContext,tt=qt(p.nextSibling),nt=e,_e=!0,vt=null,t!==null&&(ot[lt++]=It,ot[lt++]=At,ot[lt++]=yn,It=t.id,At=t.overflow,yn=e),e=Ro(e,c.children),e.flags|=4096,e)}function Jl(t,e,n){t.lanes|=e;var c=t.alternate;c!==null&&(c.lanes|=e),Na(t.return,e,n)}function Qs(t,e,n,c,p){var v=t.memoizedState;v===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:c,tail:n,tailMode:p}:(v.isBackwards=e,v.rendering=null,v.renderingStartTime=0,v.last=c,v.tail=n,v.tailMode=p)}function vh(t,e,n){var c=e.pendingProps,p=c.revealOrder,v=c.tail;if(We(t,e,c.children,n),c=Te.current,c&2)c=c&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Jl(t,n,e);else if(t.tag===19)Jl(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}if(we(Te,c),!(e.mode&1))e.memoizedState=null;else switch(p){case"forwards":for(n=e.child,p=null;n!==null;)t=n.alternate,t!==null&&qr(t)===null&&(p=n),n=n.sibling;n=p,n===null?(p=e.child,e.child=null):(p=n.sibling,n.sibling=null),Qs(e,!1,p,n,v);break;case"backwards":for(n=null,p=e.child,e.child=null;p!==null;){if(t=p.alternate,t!==null&&qr(t)===null){e.child=p;break}t=p.sibling,p.sibling=n,n=p,p=t}Qs(e,!0,n,null,v);break;case"together":Qs(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function jr(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Lt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),wn|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ne(153));if(e.child!==null){for(t=e.child,n=en(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=en(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function lg(t,e,n){switch(e.tag){case 3:mh(e),Kn();break;case 5:Wu(e);break;case 1:Qe(e.type)&&Hr(e);break;case 4:jo(e,e.stateNode.containerInfo);break;case 10:var c=e.type._context,p=e.memoizedProps.value;we(Yr,c._currentValue),c._currentValue=p;break;case 13:if(c=e.memoizedState,c!==null)return c.dehydrated!==null?(we(Te,Te.current&1),e.flags|=128,null):n&e.child.childLanes?ph(t,e,n):(we(Te,Te.current&1),t=Lt(t,e,n),t!==null?t.sibling:null);we(Te,Te.current&1);break;case 19:if(c=(n&e.childLanes)!==0,t.flags&128){if(c)return vh(t,e,n);e.flags|=128}if(p=e.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),we(Te,Te.current),c)break;return null;case 22:case 23:return e.lanes=0,fh(t,e,n)}return Lt(t,e,n)}var yh,Wa,xh,wh;yh=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Wa=function(){};xh=function(t,e,n,c){var p=t.memoizedProps;if(p!==c){t=e.stateNode,fn(kt.current);var v=null;switch(n){case"input":p=ha(t,p),c=ha(t,c),v=[];break;case"select":p=Pe({},p,{value:void 0}),c=Pe({},c,{value:void 0}),v=[];break;case"textarea":p=ga(t,p),c=ga(t,c),v=[];break;default:typeof p.onClick!="function"&&typeof c.onClick=="function"&&(t.onclick=Gr)}pa(n,c);var S;n=null;for(u in p)if(!c.hasOwnProperty(u)&&p.hasOwnProperty(u)&&p[u]!=null)if(u==="style"){var h=p[u];for(S in h)h.hasOwnProperty(S)&&(n||(n={}),n[S]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(ji.hasOwnProperty(u)?v||(v=[]):(v=v||[]).push(u,null));for(u in c){var s=c[u];if(h=p!=null?p[u]:void 0,c.hasOwnProperty(u)&&s!==h&&(s!=null||h!=null))if(u==="style")if(h){for(S in h)!h.hasOwnProperty(S)||s&&s.hasOwnProperty(S)||(n||(n={}),n[S]="");for(S in s)s.hasOwnProperty(S)&&h[S]!==s[S]&&(n||(n={}),n[S]=s[S])}else n||(v||(v=[]),v.push(u,n)),n=s;else u==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,h=h?h.__html:void 0,s!=null&&h!==s&&(v=v||[]).push(u,s)):u==="children"?typeof s!="string"&&typeof s!="number"||(v=v||[]).push(u,""+s):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(ji.hasOwnProperty(u)?(s!=null&&u==="onScroll"&&Se("scroll",t),v||h===s||(v=[])):(v=v||[]).push(u,s))}n&&(v=v||[]).push("style",n);var u=v;(e.updateQueue=u)&&(e.flags|=4)}};wh=function(t,e,n,c){n!==c&&(e.flags|=4)};function fi(t,e){if(!_e)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var c=null;n!==null;)n.alternate!==null&&(c=n),n=n.sibling;c===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function Be(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,c=0;if(e)for(var p=t.child;p!==null;)n|=p.lanes|p.childLanes,c|=p.subtreeFlags&14680064,c|=p.flags&14680064,p.return=t,p=p.sibling;else for(p=t.child;p!==null;)n|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=t,p=p.sibling;return t.subtreeFlags|=c,t.childLanes=n,e}function cg(t,e,n){var c=e.pendingProps;switch(bo(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Be(e),null;case 1:return Qe(e.type)&&Wr(),Be(e),null;case 3:return c=e.stateNode,Qn(),Ce(qe),Ce(Ge),Ao(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(t===null||t.child===null)&&(mr(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,vt!==null&&(Qa(vt),vt=null))),Wa(t,e),Be(e),null;case 5:Io(e);var p=fn(Gi.current);if(n=e.type,t!==null&&e.stateNode!=null)xh(t,e,n,c,p),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!c){if(e.stateNode===null)throw Error(ne(166));return Be(e),null}if(t=fn(kt.current),mr(e)){c=e.stateNode,n=e.type;var v=e.memoizedProps;switch(c[_t]=e,c[Bi]=v,t=(e.mode&1)!==0,n){case"dialog":Se("cancel",c),Se("close",c);break;case"iframe":case"object":case"embed":Se("load",c);break;case"video":case"audio":for(p=0;p<xi.length;p++)Se(xi[p],c);break;case"source":Se("error",c);break;case"img":case"image":case"link":Se("error",c),Se("load",c);break;case"details":Se("toggle",c);break;case"input":ol(c,v),Se("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!v.multiple},Se("invalid",c);break;case"textarea":cl(c,v),Se("invalid",c)}pa(n,v),p=null;for(var S in v)if(v.hasOwnProperty(S)){var h=v[S];S==="children"?typeof h=="string"?c.textContent!==h&&(v.suppressHydrationWarning!==!0&&gr(c.textContent,h,t),p=["children",h]):typeof h=="number"&&c.textContent!==""+h&&(v.suppressHydrationWarning!==!0&&gr(c.textContent,h,t),p=["children",""+h]):ji.hasOwnProperty(S)&&h!=null&&S==="onScroll"&&Se("scroll",c)}switch(n){case"input":ar(c),ll(c,v,!0);break;case"textarea":ar(c),ul(c);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(c.onclick=Gr)}c=p,e.updateQueue=c,c!==null&&(e.flags|=4)}else{S=p.nodeType===9?p:p.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$c(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=S.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof c.is=="string"?t=S.createElement(n,{is:c.is}):(t=S.createElement(n),n==="select"&&(S=t,c.multiple?S.multiple=!0:c.size&&(S.size=c.size))):t=S.createElementNS(t,n),t[_t]=e,t[Bi]=c,yh(t,e,!1,!1),e.stateNode=t;e:{switch(S=va(n,c),n){case"dialog":Se("cancel",t),Se("close",t),p=c;break;case"iframe":case"object":case"embed":Se("load",t),p=c;break;case"video":case"audio":for(p=0;p<xi.length;p++)Se(xi[p],t);p=c;break;case"source":Se("error",t),p=c;break;case"img":case"image":case"link":Se("error",t),Se("load",t),p=c;break;case"details":Se("toggle",t),p=c;break;case"input":ol(t,c),p=ha(t,c),Se("invalid",t);break;case"option":p=c;break;case"select":t._wrapperState={wasMultiple:!!c.multiple},p=Pe({},c,{value:void 0}),Se("invalid",t);break;case"textarea":cl(t,c),p=ga(t,c),Se("invalid",t);break;default:p=c}pa(n,p),h=p;for(v in h)if(h.hasOwnProperty(v)){var s=h[v];v==="style"?Qc(t,s):v==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,s!=null&&Kc(t,s)):v==="children"?typeof s=="string"?(n!=="textarea"||s!=="")&&Ii(t,s):typeof s=="number"&&Ii(t,""+s):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(ji.hasOwnProperty(v)?s!=null&&v==="onScroll"&&Se("scroll",t):s!=null&&oo(t,v,s,S))}switch(n){case"input":ar(t),ll(t,c,!1);break;case"textarea":ar(t),ul(t);break;case"option":c.value!=null&&t.setAttribute("value",""+tn(c.value));break;case"select":t.multiple=!!c.multiple,v=c.value,v!=null?Bn(t,!!c.multiple,v,!1):c.defaultValue!=null&&Bn(t,!!c.multiple,c.defaultValue,!0);break;default:typeof p.onClick=="function"&&(t.onclick=Gr)}switch(n){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Be(e),null;case 6:if(t&&e.stateNode!=null)wh(t,e,t.memoizedProps,c);else{if(typeof c!="string"&&e.stateNode===null)throw Error(ne(166));if(n=fn(Gi.current),fn(kt.current),mr(e)){if(c=e.stateNode,n=e.memoizedProps,c[_t]=e,(v=c.nodeValue!==n)&&(t=nt,t!==null))switch(t.tag){case 3:gr(c.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&gr(c.nodeValue,n,(t.mode&1)!==0)}v&&(e.flags|=4)}else c=(n.nodeType===9?n:n.ownerDocument).createTextNode(c),c[_t]=e,e.stateNode=c}return Be(e),null;case 13:if(Ce(Te),c=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(_e&&tt!==null&&e.mode&1&&!(e.flags&128))Ru(),Kn(),e.flags|=98560,v=!1;else if(v=mr(e),c!==null&&c.dehydrated!==null){if(t===null){if(!v)throw Error(ne(318));if(v=e.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(ne(317));v[_t]=e}else Kn(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Be(e),v=!1}else vt!==null&&(Qa(vt),vt=null),v=!0;if(!v)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(c=c!==null,c!==(t!==null&&t.memoizedState!==null)&&c&&(e.child.flags|=8192,e.mode&1&&(t===null||Te.current&1?Ae===0&&(Ae=3):Ho())),e.updateQueue!==null&&(e.flags|=4),Be(e),null);case 4:return Qn(),Wa(t,e),t===null&&Ri(e.stateNode.containerInfo),Be(e),null;case 10:return Po(e.type._context),Be(e),null;case 17:return Qe(e.type)&&Wr(),Be(e),null;case 19:if(Ce(Te),v=e.memoizedState,v===null)return Be(e),null;if(c=(e.flags&128)!==0,S=v.rendering,S===null)if(c)fi(v,!1);else{if(Ae!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(S=qr(t),S!==null){for(e.flags|=128,fi(v,!1),c=S.updateQueue,c!==null&&(e.updateQueue=c,e.flags|=4),e.subtreeFlags=0,c=n,n=e.child;n!==null;)v=n,t=c,v.flags&=14680066,S=v.alternate,S===null?(v.childLanes=0,v.lanes=t,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=S.childLanes,v.lanes=S.lanes,v.child=S.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=S.memoizedProps,v.memoizedState=S.memoizedState,v.updateQueue=S.updateQueue,v.type=S.type,t=S.dependencies,v.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return we(Te,Te.current&1|2),e.child}t=t.sibling}v.tail!==null&&Oe()>Zn&&(e.flags|=128,c=!0,fi(v,!1),e.lanes=4194304)}else{if(!c)if(t=qr(S),t!==null){if(e.flags|=128,c=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),fi(v,!0),v.tail===null&&v.tailMode==="hidden"&&!S.alternate&&!_e)return Be(e),null}else 2*Oe()-v.renderingStartTime>Zn&&n!==1073741824&&(e.flags|=128,c=!0,fi(v,!1),e.lanes=4194304);v.isBackwards?(S.sibling=e.child,e.child=S):(n=v.last,n!==null?n.sibling=S:e.child=S,v.last=S)}return v.tail!==null?(e=v.tail,v.rendering=e,v.tail=e.sibling,v.renderingStartTime=Oe(),e.sibling=null,n=Te.current,we(Te,c?n&1|2:n&1),e):(Be(e),null);case 22:case 23:return Wo(),c=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==c&&(e.flags|=8192),c&&e.mode&1?et&1073741824&&(Be(e),e.subtreeFlags&6&&(e.flags|=8192)):Be(e),null;case 24:return null;case 25:return null}throw Error(ne(156,e.tag))}function ug(t,e){switch(bo(e),e.tag){case 1:return Qe(e.type)&&Wr(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Qn(),Ce(qe),Ce(Ge),Ao(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Io(e),null;case 13:if(Ce(Te),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ne(340));Kn()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ce(Te),null;case 4:return Qn(),null;case 10:return Po(e.type._context),null;case 22:case 23:return Wo(),null;case 24:return null;default:return null}}var yr=!1,Ue=!1,hg=typeof WeakSet=="function"?WeakSet:Set,ue=null;function Rn(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(c){Ee(t,e,c)}else n.current=null}function Ha(t,e,n){try{n()}catch(c){Ee(t,e,c)}}var Zl=!1;function dg(t,e){if(Pa=zr,t=Tu(),So(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var c=n.getSelection&&n.getSelection();if(c&&c.rangeCount!==0){n=c.anchorNode;var p=c.anchorOffset,v=c.focusNode;c=c.focusOffset;try{n.nodeType,v.nodeType}catch{n=null;break e}var S=0,h=-1,s=-1,u=0,d=0,r=t,a=null;t:for(;;){for(var i;r!==n||p!==0&&r.nodeType!==3||(h=S+p),r!==v||c!==0&&r.nodeType!==3||(s=S+c),r.nodeType===3&&(S+=r.nodeValue.length),(i=r.firstChild)!==null;)a=r,r=i;for(;;){if(r===t)break t;if(a===n&&++u===p&&(h=S),a===v&&++d===c&&(s=S),(i=r.nextSibling)!==null)break;r=a,a=r.parentNode}r=i}n=h===-1||s===-1?null:{start:h,end:s}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ea={focusedElem:t,selectionRange:n},zr=!1,ue=e;ue!==null;)if(e=ue,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ue=t;else for(;ue!==null;){e=ue;try{var l=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(l!==null){var g=l.memoizedProps,o=l.memoizedState,f=e.stateNode,m=f.getSnapshotBeforeUpdate(e.elementType===e.type?g:mt(e.type,g),o);f.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ne(163))}}catch(x){Ee(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}return l=Zl,Zl=!1,l}function ki(t,e,n){var c=e.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var p=c=c.next;do{if((p.tag&t)===t){var v=p.destroy;p.destroy=void 0,v!==void 0&&Ha(e,n,v)}p=p.next}while(p!==c)}}function ps(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var c=n.create;n.destroy=c()}n=n.next}while(n!==e)}}function Va(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Sh(t){var e=t.alternate;e!==null&&(t.alternate=null,Sh(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[_t],delete e[Bi],delete e[Ia],delete e[$f],delete e[Kf])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Ch(t){return t.tag===5||t.tag===3||t.tag===4}function ec(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ch(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Xa(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Gr));else if(c!==4&&(t=t.child,t!==null))for(Xa(t,e,n),t=t.sibling;t!==null;)Xa(t,e,n),t=t.sibling}function Ya(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(c!==4&&(t=t.child,t!==null))for(Ya(t,e,n),t=t.sibling;t!==null;)Ya(t,e,n),t=t.sibling}var Ne=null,pt=!1;function Bt(t,e,n){for(n=n.child;n!==null;)bh(t,e,n),n=n.sibling}function bh(t,e,n){if(Tt&&typeof Tt.onCommitFiberUnmount=="function")try{Tt.onCommitFiberUnmount(ls,n)}catch{}switch(n.tag){case 5:Ue||Rn(n,e);case 6:var c=Ne,p=pt;Ne=null,Bt(t,e,n),Ne=c,pt=p,Ne!==null&&(pt?(t=Ne,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ne.removeChild(n.stateNode));break;case 18:Ne!==null&&(pt?(t=Ne,n=n.stateNode,t.nodeType===8?Hs(t.parentNode,n):t.nodeType===1&&Hs(t,n),Ni(t)):Hs(Ne,n.stateNode));break;case 4:c=Ne,p=pt,Ne=n.stateNode.containerInfo,pt=!0,Bt(t,e,n),Ne=c,pt=p;break;case 0:case 11:case 14:case 15:if(!Ue&&(c=n.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){p=c=c.next;do{var v=p,S=v.destroy;v=v.tag,S!==void 0&&(v&2||v&4)&&Ha(n,e,S),p=p.next}while(p!==c)}Bt(t,e,n);break;case 1:if(!Ue&&(Rn(n,e),c=n.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=n.memoizedProps,c.state=n.memoizedState,c.componentWillUnmount()}catch(h){Ee(n,e,h)}Bt(t,e,n);break;case 21:Bt(t,e,n);break;case 22:n.mode&1?(Ue=(c=Ue)||n.memoizedState!==null,Bt(t,e,n),Ue=c):Bt(t,e,n);break;default:Bt(t,e,n)}}function tc(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new hg),e.forEach(function(c){var p=Sg.bind(null,t,c);n.has(c)||(n.add(c),c.then(p,p))})}}function gt(t,e){var n=e.deletions;if(n!==null)for(var c=0;c<n.length;c++){var p=n[c];try{var v=t,S=e,h=S;e:for(;h!==null;){switch(h.tag){case 5:Ne=h.stateNode,pt=!1;break e;case 3:Ne=h.stateNode.containerInfo,pt=!0;break e;case 4:Ne=h.stateNode.containerInfo,pt=!0;break e}h=h.return}if(Ne===null)throw Error(ne(160));bh(v,S,p),Ne=null,pt=!1;var s=p.alternate;s!==null&&(s.return=null),p.return=null}catch(u){Ee(p,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)_h(e,t),e=e.sibling}function _h(t,e){var n=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(gt(e,t),Ct(t),c&4){try{ki(3,t,t.return),ps(3,t)}catch(g){Ee(t,t.return,g)}try{ki(5,t,t.return)}catch(g){Ee(t,t.return,g)}}break;case 1:gt(e,t),Ct(t),c&512&&n!==null&&Rn(n,n.return);break;case 5:if(gt(e,t),Ct(t),c&512&&n!==null&&Rn(n,n.return),t.flags&32){var p=t.stateNode;try{Ii(p,"")}catch(g){Ee(t,t.return,g)}}if(c&4&&(p=t.stateNode,p!=null)){var v=t.memoizedProps,S=n!==null?n.memoizedProps:v,h=t.type,s=t.updateQueue;if(t.updateQueue=null,s!==null)try{h==="input"&&v.type==="radio"&&v.name!=null&&Xc(p,v),va(h,S);var u=va(h,v);for(S=0;S<s.length;S+=2){var d=s[S],r=s[S+1];d==="style"?Qc(p,r):d==="dangerouslySetInnerHTML"?Kc(p,r):d==="children"?Ii(p,r):oo(p,d,r,u)}switch(h){case"input":da(p,v);break;case"textarea":Yc(p,v);break;case"select":var a=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!v.multiple;var i=v.value;i!=null?Bn(p,!!v.multiple,i,!1):a!==!!v.multiple&&(v.defaultValue!=null?Bn(p,!!v.multiple,v.defaultValue,!0):Bn(p,!!v.multiple,v.multiple?[]:"",!1))}p[Bi]=v}catch(g){Ee(t,t.return,g)}}break;case 6:if(gt(e,t),Ct(t),c&4){if(t.stateNode===null)throw Error(ne(162));p=t.stateNode,v=t.memoizedProps;try{p.nodeValue=v}catch(g){Ee(t,t.return,g)}}break;case 3:if(gt(e,t),Ct(t),c&4&&n!==null&&n.memoizedState.isDehydrated)try{Ni(e.containerInfo)}catch(g){Ee(t,t.return,g)}break;case 4:gt(e,t),Ct(t);break;case 13:gt(e,t),Ct(t),p=t.child,p.flags&8192&&(v=p.memoizedState!==null,p.stateNode.isHidden=v,!v||p.alternate!==null&&p.alternate.memoizedState!==null||(Uo=Oe())),c&4&&tc(t);break;case 22:if(d=n!==null&&n.memoizedState!==null,t.mode&1?(Ue=(u=Ue)||d,gt(e,t),Ue=u):gt(e,t),Ct(t),c&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(ue=t,d=t.child;d!==null;){for(r=ue=d;ue!==null;){switch(a=ue,i=a.child,a.tag){case 0:case 11:case 14:case 15:ki(4,a,a.return);break;case 1:Rn(a,a.return);var l=a.stateNode;if(typeof l.componentWillUnmount=="function"){c=a,n=a.return;try{e=c,l.props=e.memoizedProps,l.state=e.memoizedState,l.componentWillUnmount()}catch(g){Ee(c,n,g)}}break;case 5:Rn(a,a.return);break;case 22:if(a.memoizedState!==null){ic(r);continue}}i!==null?(i.return=a,ue=i):ic(r)}d=d.sibling}e:for(d=null,r=t;;){if(r.tag===5){if(d===null){d=r;try{p=r.stateNode,u?(v=p.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(h=r.stateNode,s=r.memoizedProps.style,S=s!=null&&s.hasOwnProperty("display")?s.display:null,h.style.display=qc("display",S))}catch(g){Ee(t,t.return,g)}}}else if(r.tag===6){if(d===null)try{r.stateNode.nodeValue=u?"":r.memoizedProps}catch(g){Ee(t,t.return,g)}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;d===r&&(d=null),r=r.return}d===r&&(d=null),r.sibling.return=r.return,r=r.sibling}}break;case 19:gt(e,t),Ct(t),c&4&&tc(t);break;case 21:break;default:gt(e,t),Ct(t)}}function Ct(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Ch(n)){var c=n;break e}n=n.return}throw Error(ne(160))}switch(c.tag){case 5:var p=c.stateNode;c.flags&32&&(Ii(p,""),c.flags&=-33);var v=ec(t);Ya(t,v,p);break;case 3:case 4:var S=c.stateNode.containerInfo,h=ec(t);Xa(t,h,S);break;default:throw Error(ne(161))}}catch(s){Ee(t,t.return,s)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function fg(t,e,n){ue=t,Th(t)}function Th(t,e,n){for(var c=(t.mode&1)!==0;ue!==null;){var p=ue,v=p.child;if(p.tag===22&&c){var S=p.memoizedState!==null||yr;if(!S){var h=p.alternate,s=h!==null&&h.memoizedState!==null||Ue;h=yr;var u=Ue;if(yr=S,(Ue=s)&&!u)for(ue=p;ue!==null;)S=ue,s=S.child,S.tag===22&&S.memoizedState!==null?rc(p):s!==null?(s.return=S,ue=s):rc(p);for(;v!==null;)ue=v,Th(v),v=v.sibling;ue=p,yr=h,Ue=u}nc(t)}else p.subtreeFlags&8772&&v!==null?(v.return=p,ue=v):nc(t)}}function nc(t){for(;ue!==null;){var e=ue;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ue||ps(5,e);break;case 1:var c=e.stateNode;if(e.flags&4&&!Ue)if(n===null)c.componentDidMount();else{var p=e.elementType===e.type?n.memoizedProps:mt(e.type,n.memoizedProps);c.componentDidUpdate(p,n.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var v=e.updateQueue;v!==null&&Bl(e,v,c);break;case 3:var S=e.updateQueue;if(S!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Bl(e,S,n)}break;case 5:var h=e.stateNode;if(n===null&&e.flags&4){n=h;var s=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break;case"img":s.src&&(n.src=s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var r=d.dehydrated;r!==null&&Ni(r)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ne(163))}Ue||e.flags&512&&Va(e)}catch(a){Ee(e,e.return,a)}}if(e===t){ue=null;break}if(n=e.sibling,n!==null){n.return=e.return,ue=n;break}ue=e.return}}function ic(t){for(;ue!==null;){var e=ue;if(e===t){ue=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ue=n;break}ue=e.return}}function rc(t){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ps(4,e)}catch(s){Ee(e,n,s)}break;case 1:var c=e.stateNode;if(typeof c.componentDidMount=="function"){var p=e.return;try{c.componentDidMount()}catch(s){Ee(e,p,s)}}var v=e.return;try{Va(e)}catch(s){Ee(e,v,s)}break;case 5:var S=e.return;try{Va(e)}catch(s){Ee(e,S,s)}}}catch(s){Ee(e,e.return,s)}if(e===t){ue=null;break}var h=e.sibling;if(h!==null){h.return=e.return,ue=h;break}ue=e.return}}var gg=Math.ceil,Zr=zt.ReactCurrentDispatcher,zo=zt.ReactCurrentOwner,ut=zt.ReactCurrentBatchConfig,ye=0,De=null,je=null,Fe=0,et=0,zn=sn(0),Ae=0,Xi=null,wn=0,vs=0,Bo=0,Pi=null,$e=null,Uo=0,Zn=1/0,Ot=null,es=!1,$a=null,Jt=null,xr=!1,Xt=null,ts=0,Ei=0,Ka=null,Ir=-1,Ar=0;function Ve(){return ye&6?Oe():Ir!==-1?Ir:Ir=Oe()}function Zt(t){return t.mode&1?ye&2&&Fe!==0?Fe&-Fe:Qf.transition!==null?(Ar===0&&(Ar=cu()),Ar):(t=xe,t!==0||(t=window.event,t=t===void 0?16:pu(t.type)),t):1}function xt(t,e,n,c){if(50<Ei)throw Ei=0,Ka=null,Error(ne(185));qi(t,n,c),(!(ye&2)||t!==De)&&(t===De&&(!(ye&2)&&(vs|=n),Ae===4&&Ht(t,Fe)),Je(t,c),n===1&&ye===0&&!(e.mode&1)&&(Zn=Oe()+500,fs&&an()))}function Je(t,e){var n=t.callbackNode;qd(t,e);var c=Rr(t,t===De?Fe:0);if(c===0)n!==null&&fl(n),t.callbackNode=null,t.callbackPriority=0;else if(e=c&-c,t.callbackPriority!==e){if(n!=null&&fl(n),e===1)t.tag===0?qf(sc.bind(null,t)):Nu(sc.bind(null,t)),Xf(function(){!(ye&6)&&an()}),n=null;else{switch(uu(c)){case 1:n=fo;break;case 4:n=ou;break;case 16:n=Lr;break;case 536870912:n=lu;break;default:n=Lr}n=Mh(n,kh.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function kh(t,e){if(Ir=-1,Ar=0,ye&6)throw Error(ne(327));var n=t.callbackNode;if(Vn()&&t.callbackNode!==n)return null;var c=Rr(t,t===De?Fe:0);if(c===0)return null;if(c&30||c&t.expiredLanes||e)e=ns(t,c);else{e=c;var p=ye;ye|=2;var v=Eh();(De!==t||Fe!==e)&&(Ot=null,Zn=Oe()+500,gn(t,e));do try{vg();break}catch(h){Ph(t,h)}while(1);ko(),Zr.current=v,ye=p,je!==null?e=0:(De=null,Fe=0,e=Ae)}if(e!==0){if(e===2&&(p=Ca(t),p!==0&&(c=p,e=qa(t,p))),e===1)throw n=Xi,gn(t,0),Ht(t,c),Je(t,Oe()),n;if(e===6)Ht(t,c);else{if(p=t.current.alternate,!(c&30)&&!mg(p)&&(e=ns(t,c),e===2&&(v=Ca(t),v!==0&&(c=v,e=qa(t,v))),e===1))throw n=Xi,gn(t,0),Ht(t,c),Je(t,Oe()),n;switch(t.finishedWork=p,t.finishedLanes=c,e){case 0:case 1:throw Error(ne(345));case 2:ln(t,$e,Ot);break;case 3:if(Ht(t,c),(c&130023424)===c&&(e=Uo+500-Oe(),10<e)){if(Rr(t,0)!==0)break;if(p=t.suspendedLanes,(p&c)!==c){Ve(),t.pingedLanes|=t.suspendedLanes&p;break}t.timeoutHandle=ja(ln.bind(null,t,$e,Ot),e);break}ln(t,$e,Ot);break;case 4:if(Ht(t,c),(c&4194240)===c)break;for(e=t.eventTimes,p=-1;0<c;){var S=31-yt(c);v=1<<S,S=e[S],S>p&&(p=S),c&=~v}if(c=p,c=Oe()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*gg(c/1960))-c,10<c){t.timeoutHandle=ja(ln.bind(null,t,$e,Ot),c);break}ln(t,$e,Ot);break;case 5:ln(t,$e,Ot);break;default:throw Error(ne(329))}}}return Je(t,Oe()),t.callbackNode===n?kh.bind(null,t):null}function qa(t,e){var n=Pi;return t.current.memoizedState.isDehydrated&&(gn(t,e).flags|=256),t=ns(t,e),t!==2&&(e=$e,$e=n,e!==null&&Qa(e)),t}function Qa(t){$e===null?$e=t:$e.push.apply($e,t)}function mg(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var c=0;c<n.length;c++){var p=n[c],v=p.getSnapshot;p=p.value;try{if(!wt(v(),p))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ht(t,e){for(e&=~Bo,e&=~vs,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-yt(e),c=1<<n;t[n]=-1,e&=~c}}function sc(t){if(ye&6)throw Error(ne(327));Vn();var e=Rr(t,0);if(!(e&1))return Je(t,Oe()),null;var n=ns(t,e);if(t.tag!==0&&n===2){var c=Ca(t);c!==0&&(e=c,n=qa(t,c))}if(n===1)throw n=Xi,gn(t,0),Ht(t,e),Je(t,Oe()),n;if(n===6)throw Error(ne(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ln(t,$e,Ot),Je(t,Oe()),null}function Go(t,e){var n=ye;ye|=1;try{return t(e)}finally{ye=n,ye===0&&(Zn=Oe()+500,fs&&an())}}function Sn(t){Xt!==null&&Xt.tag===0&&!(ye&6)&&Vn();var e=ye;ye|=1;var n=ut.transition,c=xe;try{if(ut.transition=null,xe=1,t)return t()}finally{xe=c,ut.transition=n,ye=e,!(ye&6)&&an()}}function Wo(){et=zn.current,Ce(zn)}function gn(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Vf(n)),je!==null)for(n=je.return;n!==null;){var c=n;switch(bo(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&Wr();break;case 3:Qn(),Ce(qe),Ce(Ge),Ao();break;case 5:Io(c);break;case 4:Qn();break;case 13:Ce(Te);break;case 19:Ce(Te);break;case 10:Po(c.type._context);break;case 22:case 23:Wo()}n=n.return}if(De=t,je=t=en(t.current,null),Fe=et=e,Ae=0,Xi=null,Bo=vs=wn=0,$e=Pi=null,dn!==null){for(e=0;e<dn.length;e++)if(n=dn[e],c=n.interleaved,c!==null){n.interleaved=null;var p=c.next,v=n.pending;if(v!==null){var S=v.next;v.next=p,c.next=S}n.pending=c}dn=null}return t}function Ph(t,e){do{var n=je;try{if(ko(),Er.current=Jr,Qr){for(var c=ke.memoizedState;c!==null;){var p=c.queue;p!==null&&(p.pending=null),c=c.next}Qr=!1}if(xn=0,Me=Ie=ke=null,Ti=!1,Wi=0,zo.current=null,n===null||n.return===null){Ae=1,Xi=e,je=null;break}e:{var v=t,S=n.return,h=n,s=e;if(e=Fe,h.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){var u=s,d=h,r=d.tag;if(!(d.mode&1)&&(r===0||r===11||r===15)){var a=d.alternate;a?(d.updateQueue=a.updateQueue,d.memoizedState=a.memoizedState,d.lanes=a.lanes):(d.updateQueue=null,d.memoizedState=null)}var i=Xl(S);if(i!==null){i.flags&=-257,Yl(i,S,h,v,e),i.mode&1&&Vl(v,u,e),e=i,s=u;var l=e.updateQueue;if(l===null){var g=new Set;g.add(s),e.updateQueue=g}else l.add(s);break e}else{if(!(e&1)){Vl(v,u,e),Ho();break e}s=Error(ne(426))}}else if(_e&&h.mode&1){var o=Xl(S);if(o!==null){!(o.flags&65536)&&(o.flags|=256),Yl(o,S,h,v,e),_o(Jn(s,h));break e}}v=s=Jn(s,h),Ae!==4&&(Ae=2),Pi===null?Pi=[v]:Pi.push(v),v=S;do{switch(v.tag){case 3:v.flags|=65536,e&=-e,v.lanes|=e;var f=uh(v,s,e);zl(v,f);break e;case 1:h=s;var m=v.type,y=v.stateNode;if(!(v.flags&128)&&(typeof m.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Jt===null||!Jt.has(y)))){v.flags|=65536,e&=-e,v.lanes|=e;var x=hh(v,h,e);zl(v,x);break e}}v=v.return}while(v!==null)}jh(n)}catch(C){e=C,je===n&&n!==null&&(je=n=n.return);continue}break}while(1)}function Eh(){var t=Zr.current;return Zr.current=Jr,t===null?Jr:t}function Ho(){(Ae===0||Ae===3||Ae===2)&&(Ae=4),De===null||!(wn&268435455)&&!(vs&268435455)||Ht(De,Fe)}function ns(t,e){var n=ye;ye|=2;var c=Eh();(De!==t||Fe!==e)&&(Ot=null,gn(t,e));do try{pg();break}catch(p){Ph(t,p)}while(1);if(ko(),ye=n,Zr.current=c,je!==null)throw Error(ne(261));return De=null,Fe=0,Ae}function pg(){for(;je!==null;)Oh(je)}function vg(){for(;je!==null&&!Ud();)Oh(je)}function Oh(t){var e=Ah(t.alternate,t,et);t.memoizedProps=t.pendingProps,e===null?jh(t):je=e,zo.current=null}function jh(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=ug(n,e),n!==null){n.flags&=32767,je=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ae=6,je=null;return}}else if(n=cg(n,e,et),n!==null){je=n;return}if(e=e.sibling,e!==null){je=e;return}je=e=t}while(e!==null);Ae===0&&(Ae=5)}function ln(t,e,n){var c=xe,p=ut.transition;try{ut.transition=null,xe=1,yg(t,e,n,c)}finally{ut.transition=p,xe=c}return null}function yg(t,e,n,c){do Vn();while(Xt!==null);if(ye&6)throw Error(ne(327));n=t.finishedWork;var p=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ne(177));t.callbackNode=null,t.callbackPriority=0;var v=n.lanes|n.childLanes;if(Qd(t,v),t===De&&(je=De=null,Fe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||xr||(xr=!0,Mh(Lr,function(){return Vn(),null})),v=(n.flags&15990)!==0,n.subtreeFlags&15990||v){v=ut.transition,ut.transition=null;var S=xe;xe=1;var h=ye;ye|=4,zo.current=null,dg(t,n),_h(n,t),Rf(Ea),zr=!!Pa,Ea=Pa=null,t.current=n,fg(n),Gd(),ye=h,xe=S,ut.transition=v}else t.current=n;if(xr&&(xr=!1,Xt=t,ts=p),v=t.pendingLanes,v===0&&(Jt=null),Vd(n.stateNode),Je(t,Oe()),e!==null)for(c=t.onRecoverableError,n=0;n<e.length;n++)p=e[n],c(p.value,{componentStack:p.stack,digest:p.digest});if(es)throw es=!1,t=$a,$a=null,t;return ts&1&&t.tag!==0&&Vn(),v=t.pendingLanes,v&1?t===Ka?Ei++:(Ei=0,Ka=t):Ei=0,an(),null}function Vn(){if(Xt!==null){var t=uu(ts),e=ut.transition,n=xe;try{if(ut.transition=null,xe=16>t?16:t,Xt===null)var c=!1;else{if(t=Xt,Xt=null,ts=0,ye&6)throw Error(ne(331));var p=ye;for(ye|=4,ue=t.current;ue!==null;){var v=ue,S=v.child;if(ue.flags&16){var h=v.deletions;if(h!==null){for(var s=0;s<h.length;s++){var u=h[s];for(ue=u;ue!==null;){var d=ue;switch(d.tag){case 0:case 11:case 15:ki(8,d,v)}var r=d.child;if(r!==null)r.return=d,ue=r;else for(;ue!==null;){d=ue;var a=d.sibling,i=d.return;if(Sh(d),d===u){ue=null;break}if(a!==null){a.return=i,ue=a;break}ue=i}}}var l=v.alternate;if(l!==null){var g=l.child;if(g!==null){l.child=null;do{var o=g.sibling;g.sibling=null,g=o}while(g!==null)}}ue=v}}if(v.subtreeFlags&2064&&S!==null)S.return=v,ue=S;else e:for(;ue!==null;){if(v=ue,v.flags&2048)switch(v.tag){case 0:case 11:case 15:ki(9,v,v.return)}var f=v.sibling;if(f!==null){f.return=v.return,ue=f;break e}ue=v.return}}var m=t.current;for(ue=m;ue!==null;){S=ue;var y=S.child;if(S.subtreeFlags&2064&&y!==null)y.return=S,ue=y;else e:for(S=m;ue!==null;){if(h=ue,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:ps(9,h)}}catch(C){Ee(h,h.return,C)}if(h===S){ue=null;break e}var x=h.sibling;if(x!==null){x.return=h.return,ue=x;break e}ue=h.return}}if(ye=p,an(),Tt&&typeof Tt.onPostCommitFiberRoot=="function")try{Tt.onPostCommitFiberRoot(ls,t)}catch{}c=!0}return c}finally{xe=n,ut.transition=e}}return!1}function ac(t,e,n){e=Jn(n,e),e=uh(t,e,1),t=Qt(t,e,1),e=Ve(),t!==null&&(qi(t,1,e),Je(t,e))}function Ee(t,e,n){if(t.tag===3)ac(t,t,n);else for(;e!==null;){if(e.tag===3){ac(e,t,n);break}else if(e.tag===1){var c=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Jt===null||!Jt.has(c))){t=Jn(n,t),t=hh(e,t,1),e=Qt(e,t,1),t=Ve(),e!==null&&(qi(e,1,t),Je(e,t));break}}e=e.return}}function xg(t,e,n){var c=t.pingCache;c!==null&&c.delete(e),e=Ve(),t.pingedLanes|=t.suspendedLanes&n,De===t&&(Fe&n)===n&&(Ae===4||Ae===3&&(Fe&130023424)===Fe&&500>Oe()-Uo?gn(t,0):Bo|=n),Je(t,e)}function Ih(t,e){e===0&&(t.mode&1?(e=cr,cr<<=1,!(cr&130023424)&&(cr=4194304)):e=1);var n=Ve();t=Ft(t,e),t!==null&&(qi(t,e,n),Je(t,n))}function wg(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Ih(t,n)}function Sg(t,e){var n=0;switch(t.tag){case 13:var c=t.stateNode,p=t.memoizedState;p!==null&&(n=p.retryLane);break;case 19:c=t.stateNode;break;default:throw Error(ne(314))}c!==null&&c.delete(e),Ih(t,n)}var Ah;Ah=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||qe.current)Ke=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ke=!1,lg(t,e,n);Ke=!!(t.flags&131072)}else Ke=!1,_e&&e.flags&1048576&&Fu(e,Xr,e.index);switch(e.lanes=0,e.tag){case 2:var c=e.type;jr(t,e),t=e.pendingProps;var p=$n(e,Ge.current);Hn(e,n),p=Do(null,e,c,t,p,n);var v=No();return e.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(c)?(v=!0,Hr(e)):v=!1,e.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,Oo(e),p.updater=ms,e.stateNode=p,p._reactInternals=e,La(e,c,t,n),e=Ba(null,e,c,!0,v,n)):(e.tag=0,_e&&v&&Co(e),We(null,e,p,n),e=e.child),e;case 16:c=e.elementType;e:{switch(jr(t,e),t=e.pendingProps,p=c._init,c=p(c._payload),e.type=c,p=e.tag=bg(c),t=mt(c,t),p){case 0:e=za(null,e,c,t,n);break e;case 1:e=ql(null,e,c,t,n);break e;case 11:e=$l(null,e,c,t,n);break e;case 14:e=Kl(null,e,c,mt(c.type,t),n);break e}throw Error(ne(306,c,""))}return e;case 0:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),za(t,e,c,p,n);case 1:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),ql(t,e,c,p,n);case 3:e:{if(mh(e),t===null)throw Error(ne(387));c=e.pendingProps,v=e.memoizedState,p=v.element,Gu(t,e),Kr(e,c,null,n);var S=e.memoizedState;if(c=S.element,v.isDehydrated)if(v={element:c,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},e.updateQueue.baseState=v,e.memoizedState=v,e.flags&256){p=Jn(Error(ne(423)),e),e=Ql(t,e,c,n,p);break e}else if(c!==p){p=Jn(Error(ne(424)),e),e=Ql(t,e,c,n,p);break e}else for(tt=qt(e.stateNode.containerInfo.firstChild),nt=e,_e=!0,vt=null,n=Bu(e,null,c,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Kn(),c===p){e=Lt(t,e,n);break e}We(t,e,c,n)}e=e.child}return e;case 5:return Wu(e),t===null&&Da(e),c=e.type,p=e.pendingProps,v=t!==null?t.memoizedProps:null,S=p.children,Oa(c,p)?S=null:v!==null&&Oa(c,v)&&(e.flags|=32),gh(t,e),We(t,e,S,n),e.child;case 6:return t===null&&Da(e),null;case 13:return ph(t,e,n);case 4:return jo(e,e.stateNode.containerInfo),c=e.pendingProps,t===null?e.child=qn(e,null,c,n):We(t,e,c,n),e.child;case 11:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),$l(t,e,c,p,n);case 7:return We(t,e,e.pendingProps,n),e.child;case 8:return We(t,e,e.pendingProps.children,n),e.child;case 12:return We(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(c=e.type._context,p=e.pendingProps,v=e.memoizedProps,S=p.value,we(Yr,c._currentValue),c._currentValue=S,v!==null)if(wt(v.value,S)){if(v.children===p.children&&!qe.current){e=Lt(t,e,n);break e}}else for(v=e.child,v!==null&&(v.return=e);v!==null;){var h=v.dependencies;if(h!==null){S=v.child;for(var s=h.firstContext;s!==null;){if(s.context===c){if(v.tag===1){s=Mt(-1,n&-n),s.tag=2;var u=v.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?s.next=s:(s.next=d.next,d.next=s),u.pending=s}}v.lanes|=n,s=v.alternate,s!==null&&(s.lanes|=n),Na(v.return,n,e),h.lanes|=n;break}s=s.next}}else if(v.tag===10)S=v.type===e.type?null:v.child;else if(v.tag===18){if(S=v.return,S===null)throw Error(ne(341));S.lanes|=n,h=S.alternate,h!==null&&(h.lanes|=n),Na(S,n,e),S=v.sibling}else S=v.child;if(S!==null)S.return=v;else for(S=v;S!==null;){if(S===e){S=null;break}if(v=S.sibling,v!==null){v.return=S.return,S=v;break}S=S.return}v=S}We(t,e,p.children,n),e=e.child}return e;case 9:return p=e.type,c=e.pendingProps.children,Hn(e,n),p=ht(p),c=c(p),e.flags|=1,We(t,e,c,n),e.child;case 14:return c=e.type,p=mt(c,e.pendingProps),p=mt(c.type,p),Kl(t,e,c,p,n);case 15:return dh(t,e,e.type,e.pendingProps,n);case 17:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),jr(t,e),e.tag=1,Qe(c)?(t=!0,Hr(e)):t=!1,Hn(e,n),ch(e,c,p),La(e,c,p,n),Ba(null,e,c,!0,t,n);case 19:return vh(t,e,n);case 22:return fh(t,e,n)}throw Error(ne(156,e.tag))};function Mh(t,e){return au(t,e)}function Cg(t,e,n,c){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ct(t,e,n,c){return new Cg(t,e,n,c)}function Vo(t){return t=t.prototype,!(!t||!t.isReactComponent)}function bg(t){if(typeof t=="function")return Vo(t)?1:0;if(t!=null){if(t=t.$$typeof,t===co)return 11;if(t===uo)return 14}return 2}function en(t,e){var n=t.alternate;return n===null?(n=ct(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Mr(t,e,n,c,p,v){var S=2;if(c=t,typeof t=="function")Vo(t)&&(S=1);else if(typeof t=="string")S=5;else e:switch(t){case On:return mn(n.children,p,v,e);case lo:S=8,p|=8;break;case oa:return t=ct(12,n,e,p|2),t.elementType=oa,t.lanes=v,t;case la:return t=ct(13,n,e,p),t.elementType=la,t.lanes=v,t;case ca:return t=ct(19,n,e,p),t.elementType=ca,t.lanes=v,t;case Wc:return ys(n,p,v,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Uc:S=10;break e;case Gc:S=9;break e;case co:S=11;break e;case uo:S=14;break e;case Ut:S=16,c=null;break e}throw Error(ne(130,t==null?t:typeof t,""))}return e=ct(S,n,e,p),e.elementType=t,e.type=c,e.lanes=v,e}function mn(t,e,n,c){return t=ct(7,t,c,e),t.lanes=n,t}function ys(t,e,n,c){return t=ct(22,t,c,e),t.elementType=Wc,t.lanes=n,t.stateNode={isHidden:!1},t}function Js(t,e,n){return t=ct(6,t,null,e),t.lanes=n,t}function Zs(t,e,n){return e=ct(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function _g(t,e,n,c,p){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ms(0),this.expirationTimes=Ms(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ms(0),this.identifierPrefix=c,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function Xo(t,e,n,c,p,v,S,h,s){return t=new _g(t,e,n,h,s),e===1?(e=1,v===!0&&(e|=8)):e=0,v=ct(3,null,null,e),t.current=v,v.stateNode=t,v.memoizedState={element:c,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Oo(v),t}function Tg(t,e,n){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:En,key:c==null?null:""+c,children:t,containerInfo:e,implementation:n}}function Dh(t){if(!t)return nn;t=t._reactInternals;e:{if(bn(t)!==t||t.tag!==1)throw Error(ne(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ne(171))}if(t.tag===1){var n=t.type;if(Qe(n))return Du(t,n,e)}return e}function Nh(t,e,n,c,p,v,S,h,s){return t=Xo(n,c,!0,t,p,v,S,h,s),t.context=Dh(null),n=t.current,c=Ve(),p=Zt(n),v=Mt(c,p),v.callback=e??null,Qt(n,v,p),t.current.lanes=p,qi(t,p,c),Je(t,c),t}function xs(t,e,n,c){var p=e.current,v=Ve(),S=Zt(p);return n=Dh(n),e.context===null?e.context=n:e.pendingContext=n,e=Mt(v,S),e.payload={element:t},c=c===void 0?null:c,c!==null&&(e.callback=c),t=Qt(p,e,S),t!==null&&(xt(t,p,S,v),Pr(t,p,S)),S}function is(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function oc(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Yo(t,e){oc(t,e),(t=t.alternate)&&oc(t,e)}function kg(){return null}var Fh=typeof reportError=="function"?reportError:function(t){console.error(t)};function $o(t){this._internalRoot=t}ws.prototype.render=$o.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ne(409));xs(t,e,null,null)};ws.prototype.unmount=$o.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Sn(function(){xs(null,t,null,null)}),e[Nt]=null}};function ws(t){this._internalRoot=t}ws.prototype.unstable_scheduleHydration=function(t){if(t){var e=fu();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Wt.length&&e!==0&&e<Wt[n].priority;n++);Wt.splice(n,0,t),n===0&&mu(t)}};function Ko(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ss(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function lc(){}function Pg(t,e,n,c,p){if(p){if(typeof c=="function"){var v=c;c=function(){var u=is(S);v.call(u)}}var S=Nh(e,c,t,0,null,!1,!1,"",lc);return t._reactRootContainer=S,t[Nt]=S.current,Ri(t.nodeType===8?t.parentNode:t),Sn(),S}for(;p=t.lastChild;)t.removeChild(p);if(typeof c=="function"){var h=c;c=function(){var u=is(s);h.call(u)}}var s=Xo(t,0,!1,null,null,!1,!1,"",lc);return t._reactRootContainer=s,t[Nt]=s.current,Ri(t.nodeType===8?t.parentNode:t),Sn(function(){xs(e,s,n,c)}),s}function Cs(t,e,n,c,p){var v=n._reactRootContainer;if(v){var S=v;if(typeof p=="function"){var h=p;p=function(){var s=is(S);h.call(s)}}xs(e,S,t,p)}else S=Pg(n,e,t,p,c);return is(S)}hu=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=yi(e.pendingLanes);n!==0&&(go(e,n|1),Je(e,Oe()),!(ye&6)&&(Zn=Oe()+500,an()))}break;case 13:Sn(function(){var c=Ft(t,1);if(c!==null){var p=Ve();xt(c,t,1,p)}}),Yo(t,1)}};mo=function(t){if(t.tag===13){var e=Ft(t,134217728);if(e!==null){var n=Ve();xt(e,t,134217728,n)}Yo(t,134217728)}};du=function(t){if(t.tag===13){var e=Zt(t),n=Ft(t,e);if(n!==null){var c=Ve();xt(n,t,e,c)}Yo(t,e)}};fu=function(){return xe};gu=function(t,e){var n=xe;try{return xe=t,e()}finally{xe=n}};xa=function(t,e,n){switch(e){case"input":if(da(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var c=n[e];if(c!==t&&c.form===t.form){var p=ds(c);if(!p)throw Error(ne(90));Vc(c),da(c,p)}}}break;case"textarea":Yc(t,n);break;case"select":e=n.value,e!=null&&Bn(t,!!n.multiple,e,!1)}};eu=Go;tu=Sn;var Eg={usingClientEntryPoint:!1,Events:[Ji,Mn,ds,Jc,Zc,Go]},gi={findFiberByHostInstance:hn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Og={bundleType:gi.bundleType,version:gi.version,rendererPackageName:gi.rendererPackageName,rendererConfig:gi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zt.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ru(t),t===null?null:t.stateNode},findFiberByHostInstance:gi.findFiberByHostInstance||kg,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wr.isDisabled&&wr.supportsFiber)try{ls=wr.inject(Og),Tt=wr}catch{}}rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Eg;rt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ko(e))throw Error(ne(200));return Tg(t,e,null,n)};rt.createRoot=function(t,e){if(!Ko(t))throw Error(ne(299));var n=!1,c="",p=Fh;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(c=e.identifierPrefix),e.onRecoverableError!==void 0&&(p=e.onRecoverableError)),e=Xo(t,1,!1,null,null,n,!1,c,p),t[Nt]=e.current,Ri(t.nodeType===8?t.parentNode:t),new $o(e)};rt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ne(188)):(t=Object.keys(t).join(","),Error(ne(268,t)));return t=ru(e),t=t===null?null:t.stateNode,t};rt.flushSync=function(t){return Sn(t)};rt.hydrate=function(t,e,n){if(!Ss(e))throw Error(ne(200));return Cs(null,t,e,!0,n)};rt.hydrateRoot=function(t,e,n){if(!Ko(t))throw Error(ne(405));var c=n!=null&&n.hydratedSources||null,p=!1,v="",S=Fh;if(n!=null&&(n.unstable_strictMode===!0&&(p=!0),n.identifierPrefix!==void 0&&(v=n.identifierPrefix),n.onRecoverableError!==void 0&&(S=n.onRecoverableError)),e=Nh(e,null,t,1,n??null,p,!1,v,S),t[Nt]=e.current,Ri(t),c)for(t=0;t<c.length;t++)n=c[t],p=n._getVersion,p=p(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,p]:e.mutableSourceEagerHydrationData.push(n,p);return new ws(e)};rt.render=function(t,e,n){if(!Ss(e))throw Error(ne(200));return Cs(null,t,e,!1,n)};rt.unmountComponentAtNode=function(t){if(!Ss(t))throw Error(ne(40));return t._reactRootContainer?(Sn(function(){Cs(null,null,t,!1,function(){t._reactRootContainer=null,t[Nt]=null})}),!0):!1};rt.unstable_batchedUpdates=Go;rt.unstable_renderSubtreeIntoContainer=function(t,e,n,c){if(!Ss(n))throw Error(ne(200));if(t==null||t._reactInternals===void 0)throw Error(ne(38));return Cs(t,e,n,!1,c)};rt.version="18.3.1-next-f1338f8080-20240426";function Lh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Lh)}catch(t){console.error(t)}}Lh(),Lc.exports=rt;var jg=Lc.exports,cc=jg;sa.createRoot=cc.createRoot,sa.hydrateRoot=cc.hydrateRoot;var Ig={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Ag=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Mg=(t,e)=>{const n=le.forwardRef(({color:c="currentColor",size:p=24,strokeWidth:v=2,absoluteStrokeWidth:S,children:h,...s},u)=>le.createElement("svg",{ref:u,...Ig,width:p,height:p,stroke:c,strokeWidth:S?Number(v)*24/Number(p):v,className:`lucide lucide-${Ag(t)}`,...s},[...e.map(([d,r])=>le.createElement(d,r)),...(Array.isArray(h)?h:[h])||[]]));return n.displayName=`${t}`,n};var me=Mg;const Rh=me("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),ea=me("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),rs=me("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),zh=me("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),Dg=me("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Bh=me("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Ng=me("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),Fg=me("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Lg=me("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),qo=me("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Uh=me("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Rg=me("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),zg=me("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Gh=me("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Wh=me("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]),Bg=me("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),ss=me("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),Ug=me("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Hh=me("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Gg=me("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),uc=me("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Wg=me("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Hg=me("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),Vg=me("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]),Xg=me("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Ja=me("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Yg=me("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),$g=me("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Kg=me("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),qg=me("Mouse",[["rect",{x:"5",y:"2",width:"14",height:"20",rx:"7",key:"11ol66"}],["path",{d:"M12 6v4",key:"16clxf"}]]),Vh=me("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),hc=me("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]),dc=me("PanelRightOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]),Xh=me("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Qg=me("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Jg=me("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),fc=me("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Zg=me("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),em=me("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),ei=me("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Oi=me("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),ti=me("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),tm=me("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]),Rt=me("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),nm=me("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Qo=me("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),im=me("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),Yh=me("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),as=me("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),gc=me("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);var He={};const rm={},sm=Object.freeze(Object.defineProperty({__proto__:null,default:rm},Symbol.toStringTag,{value:"Module"})),ta=id(sm);(function(t){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var e=e||{version:"5.5.2"};if(t.fabric=e,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?e.document=document:e.document=document.implementation.createHTMLDocument(""),e.window=window;else{var n=ta,c=new n.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;e.document=c.document,e.jsdomImplForWrapper=ta.implForWrapper,e.nodeCanvas=ta.Canvas,e.window=c,DOMParser=e.window.DOMParser}e.isTouchSupported="ontouchstart"in e.window||"ontouchstart"in e.document||e.window&&e.window.navigator&&e.window.navigator.maxTouchPoints>0,e.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",e.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],e.DPI=96,e.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",e.commaWsp="(?:\\s+,?\\s*|,\\s*)",e.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,e.reNonWord=/[ \n\.,;!\?\-]/,e.fontPaths={},e.iMatrix=[1,0,0,1,0,0],e.svgNS="http://www.w3.org/2000/svg",e.perfLimitSizeTotal=2097152,e.maxCacheSideLimit=4096,e.minCacheSideLimit=256,e.charWidthsCache={},e.textureSize=2048,e.disableStyleCopyPaste=!1,e.enableGLFiltering=!0,e.devicePixelRatio=e.window.devicePixelRatio||e.window.webkitDevicePixelRatio||e.window.mozDevicePixelRatio||1,e.browserShadowBlurConstant=1,e.arcToSegmentsCache={},e.boundsOfCurveCache={},e.cachesBoundsOfCurve=!0,e.forceGLPutImageData=!1,e.initFilterBackend=function(){if(e.enableGLFiltering&&e.isWebglSupported&&e.isWebglSupported(e.textureSize))return console.log("max texture size: "+e.maxTextureSize),new e.WebglFilterBackend({tileSize:e.textureSize});if(e.Canvas2dFilterBackend)return new e.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=e),function(){function h(i,l){if(this.__eventListeners[i]){var g=this.__eventListeners[i];l?g[g.indexOf(l)]=!1:e.util.array.fill(g,!1)}}function s(i,l){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var g in i)this.on(g,i[g]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(l);return this}function u(i,l){var g=(function(){l.apply(this,arguments),this.off(i,g)}).bind(this);this.on(i,g)}function d(i,l){if(arguments.length===1)for(var g in i)u.call(this,g,i[g]);else u.call(this,i,l);return this}function r(i,l){if(!this.__eventListeners)return this;if(arguments.length===0)for(i in this.__eventListeners)h.call(this,i);else if(arguments.length===1&&typeof arguments[0]=="object")for(var g in i)h.call(this,g,i[g]);else h.call(this,i,l);return this}function a(i,l){if(!this.__eventListeners)return this;var g=this.__eventListeners[i];if(!g)return this;for(var o=0,f=g.length;o<f;o++)g[o]&&g[o].call(this,l||{});return this.__eventListeners[i]=g.filter(function(m){return m!==!1}),this}e.Observable={fire:a,on:s,once:d,off:r}}(),e.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var h=0,s=arguments.length;h<s;h++)this._onObjectAdded(arguments[h]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(h,s,u){var d=this._objects;return u?d[s]=h:d.splice(s,0,h),this._onObjectAdded&&this._onObjectAdded(h),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var h=this._objects,s,u=!1,d=0,r=arguments.length;d<r;d++)s=h.indexOf(arguments[d]),s!==-1&&(u=!0,h.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));return this.renderOnAddRemove&&u&&this.requestRenderAll(),this},forEachObject:function(h,s){for(var u=this.getObjects(),d=0,r=u.length;d<r;d++)h.call(s,u[d],d,u);return this},getObjects:function(h){return typeof h>"u"?this._objects.concat():this._objects.filter(function(s){return s.type===h})},item:function(h){return this._objects[h]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(h,s){return this._objects.indexOf(h)>-1?!0:s?this._objects.some(function(u){return typeof u.contains=="function"&&u.contains(h,!0)}):!1},complexity:function(){return this._objects.reduce(function(h,s){return h+=s.complexity?s.complexity():0,h},0)}},e.CommonMethods={_setOptions:function(h){for(var s in h)this.set(s,h[s])},_initGradient:function(h,s){h&&h.colorStops&&!(h instanceof e.Gradient)&&this.set(s,new e.Gradient(h))},_initPattern:function(h,s,u){h&&h.source&&!(h instanceof e.Pattern)?this.set(s,new e.Pattern(h,u)):u&&u()},_setObject:function(h){for(var s in h)this._set(s,h[s])},set:function(h,s){return typeof h=="object"?this._setObject(h):this._set(h,s),this},_set:function(h,s){this[h]=s},toggle:function(h){var s=this.get(h);return typeof s=="boolean"&&this.set(h,!s),this},get:function(h){return this[h]}},function(h){var s=Math.sqrt,u=Math.atan2,d=Math.pow,r=Math.PI/180,a=Math.PI/2;e.util={cos:function(i){if(i===0)return 1;i<0&&(i=-i);var l=i/a;switch(l){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(i===0)return 0;var l=i/a,g=1;switch(i<0&&(g=-1),l){case 1:return g;case 2:return 0;case 3:return-g}return Math.sin(i)},removeFromArray:function(i,l){var g=i.indexOf(l);return g!==-1&&i.splice(g,1),i},getRandomInt:function(i,l){return Math.floor(Math.random()*(l-i+1))+i},degreesToRadians:function(i){return i*r},radiansToDegrees:function(i){return i/r},rotatePoint:function(i,l,g){var o=new e.Point(i.x-l.x,i.y-l.y),f=e.util.rotateVector(o,g);return new e.Point(f.x,f.y).addEquals(l)},rotateVector:function(i,l){var g=e.util.sin(l),o=e.util.cos(l),f=i.x*o-i.y*g,m=i.x*g+i.y*o;return{x:f,y:m}},createVector:function(i,l){return new e.Point(l.x-i.x,l.y-i.y)},calcAngleBetweenVectors:function(i,l){return Math.acos((i.x*l.x+i.y*l.y)/(Math.hypot(i.x,i.y)*Math.hypot(l.x,l.y)))},getHatVector:function(i){return new e.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,l,g){var o=e.util.createVector(i,l),f=e.util.createVector(i,g),m=e.util.calcAngleBetweenVectors(o,f),y=e.util.calcAngleBetweenVectors(e.util.rotateVector(o,m),f),x=m*(y===0?1:-1)/2;return{vector:e.util.getHatVector(e.util.rotateVector(o,x)),angle:m}},projectStrokeOnPoints:function(i,l,g){var o=[],f=l.strokeWidth/2,m=l.strokeUniform?new e.Point(1/l.scaleX,1/l.scaleY):new e.Point(1,1),y=function(x){var C=f/Math.hypot(x.x,x.y);return new e.Point(x.x*C*m.x,x.y*C*m.y)};return i.length<=1||i.forEach(function(x,C){var b=new e.Point(x.x,x.y),T,E;C===0?(E=i[C+1],T=g?y(e.util.createVector(E,b)).addEquals(b):i[i.length-1]):C===i.length-1?(T=i[C-1],E=g?y(e.util.createVector(T,b)).addEquals(b):i[0]):(T=i[C-1],E=i[C+1]);var L=e.util.getBisector(b,T,E),F=L.vector,H=L.angle,J,q;if(l.strokeLineJoin==="miter"&&(J=-f/Math.sin(H/2),q=new e.Point(F.x*J*m.x,F.y*J*m.y),Math.hypot(q.x,q.y)/f<=l.strokeMiterLimit)){o.push(b.add(q)),o.push(b.subtract(q));return}J=-f*Math.SQRT2,q=new e.Point(F.x*J*m.x,F.y*J*m.y),o.push(b.add(q)),o.push(b.subtract(q))}),o},transformPoint:function(i,l,g){return g?new e.Point(l[0]*i.x+l[2]*i.y,l[1]*i.x+l[3]*i.y):new e.Point(l[0]*i.x+l[2]*i.y+l[4],l[1]*i.x+l[3]*i.y+l[5])},makeBoundingBoxFromPoints:function(i,l){if(l)for(var g=0;g<i.length;g++)i[g]=e.util.transformPoint(i[g],l);var o=[i[0].x,i[1].x,i[2].x,i[3].x],f=e.util.array.min(o),m=e.util.array.max(o),y=m-f,x=[i[0].y,i[1].y,i[2].y,i[3].y],C=e.util.array.min(x),b=e.util.array.max(x),T=b-C;return{left:f,top:C,width:y,height:T}},invertTransform:function(i){var l=1/(i[0]*i[3]-i[1]*i[2]),g=[l*i[3],-l*i[1],-l*i[2],l*i[0]],o=e.util.transformPoint({x:i[4],y:i[5]},g,!0);return g[4]=-o.x,g[5]=-o.y,g},toFixed:function(i,l){return parseFloat(Number(i).toFixed(l))},parseUnit:function(i,l){var g=/\D{0,2}$/.exec(i),o=parseFloat(i);switch(l||(l=e.Text.DEFAULT_SVG_FONT_SIZE),g[0]){case"mm":return o*e.DPI/25.4;case"cm":return o*e.DPI/2.54;case"in":return o*e.DPI;case"pt":return o*e.DPI/72;case"pc":return o*e.DPI/72*12;case"em":return o*l;default:return o}},falseFunction:function(){return!1},getKlass:function(i,l){return i=e.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),e.util.resolveNamespace(l)[i]},getSvgAttributes:function(i){var l=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":l=l.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":l=l.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":l=l.concat(["offset","stop-color","stop-opacity"]);break}return l},resolveNamespace:function(i){if(!i)return e;var l=i.split("."),g=l.length,o,f=h||e.window;for(o=0;o<g;++o)f=f[l[o]];return f},loadImage:function(i,l,g,o){if(!i){l&&l.call(g,i);return}var f=e.util.createImage(),m=function(){l&&l.call(g,f,!1),f=f.onload=f.onerror=null};f.onload=m,f.onerror=function(){e.log("Error loading "+f.src),l&&l.call(g,null,!0),f=f.onload=f.onerror=null},i.indexOf("data")!==0&&o!==void 0&&o!==null&&(f.crossOrigin=o),i.substring(0,14)==="data:image/svg"&&(f.onload=null,e.util.loadImageInDom(f,m)),f.src=i},loadImageInDom:function(i,l){var g=e.document.createElement("div");g.style.width=g.style.height="1px",g.style.left=g.style.top="-100%",g.style.position="absolute",g.appendChild(i),e.document.querySelector("body").appendChild(g),i.onload=function(){l(),g.parentNode.removeChild(g),g=null}},enlivenObjects:function(i,l,g,o){i=i||[];var f=[],m=0,y=i.length;function x(){++m===y&&l&&l(f.filter(function(C){return C}))}if(!y){l&&l(f);return}i.forEach(function(C,b){if(!C||!C.type){x();return}var T=e.util.getKlass(C.type,g);T.fromObject(C,function(E,L){L||(f[b]=E),o&&o(C,E,L),x()})})},enlivenObjectEnlivables:function(i,l,g){var o=e.Object.ENLIVEN_PROPS.filter(function(f){return!!i[f]});e.util.enlivenObjects(o.map(function(f){return i[f]}),function(f){var m={};o.forEach(function(y,x){m[y]=f[x],l&&(l[y]=f[x])}),g&&g(m)})},enlivenPatterns:function(i,l){i=i||[];function g(){++f===m&&l&&l(o)}var o=[],f=0,m=i.length;if(!m){l&&l(o);return}i.forEach(function(y,x){y&&y.source?new e.Pattern(y,function(C){o[x]=C,g()}):(o[x]=y,g())})},groupSVGElements:function(i,l,g){var o;return i&&i.length===1?(typeof g<"u"&&(i[0].sourcePath=g),i[0]):(l&&(l.width&&l.height?l.centerPoint={x:l.width/2,y:l.height/2}:(delete l.width,delete l.height)),o=new e.Group(i,l),typeof g<"u"&&(o.sourcePath=g),o)},populateWithProperties:function(i,l,g){if(g&&Array.isArray(g))for(var o=0,f=g.length;o<f;o++)g[o]in i&&(l[g[o]]=i[g[o]])},createCanvasElement:function(){return e.document.createElement("canvas")},copyCanvasElement:function(i){var l=e.util.createCanvasElement();return l.width=i.width,l.height=i.height,l.getContext("2d").drawImage(i,0,0),l},toDataURL:function(i,l,g){return i.toDataURL("image/"+l,g)},createImage:function(){return e.document.createElement("img")},multiplyTransformMatrices:function(i,l,g){return[i[0]*l[0]+i[2]*l[1],i[1]*l[0]+i[3]*l[1],i[0]*l[2]+i[2]*l[3],i[1]*l[2]+i[3]*l[3],g?0:i[0]*l[4]+i[2]*l[5]+i[4],g?0:i[1]*l[4]+i[3]*l[5]+i[5]]},qrDecompose:function(i){var l=u(i[1],i[0]),g=d(i[0],2)+d(i[1],2),o=s(g),f=(i[0]*i[3]-i[2]*i[1])/o,m=u(i[0]*i[2]+i[1]*i[3],g);return{angle:l/r,scaleX:o,scaleY:f,skewX:m/r,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return e.iMatrix.concat();var l=e.util.degreesToRadians(i.angle),g=e.util.cos(l),o=e.util.sin(l);return[g,o,-o,g,0,0]},calcDimensionsMatrix:function(i){var l=typeof i.scaleX>"u"?1:i.scaleX,g=typeof i.scaleY>"u"?1:i.scaleY,o=[i.flipX?-l:l,0,0,i.flipY?-g:g,0,0],f=e.util.multiplyTransformMatrices,m=e.util.degreesToRadians;return i.skewX&&(o=f(o,[1,0,Math.tan(m(i.skewX)),1],!0)),i.skewY&&(o=f(o,[1,Math.tan(m(i.skewY)),0,1],!0)),o},composeMatrix:function(i){var l=[1,0,0,1,i.translateX||0,i.translateY||0],g=e.util.multiplyTransformMatrices;return i.angle&&(l=g(l,e.util.calcRotateMatrix(i))),(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY)&&(l=g(l,e.util.calcDimensionsMatrix(i))),l},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,l,g,o){o>0&&(l>o?l-=o:l=0,g>o?g-=o:g=0);var f=!0,m,y,x=i.getImageData(l,g,o*2||1,o*2||1),C=x.data.length;for(m=3;m<C&&(y=x.data[m],f=y<=0,f!==!1);m+=4);return x=null,f},parsePreserveAspectRatioAttribute:function(i){var l="meet",g="Mid",o="Mid",f=i.split(" "),m;return f&&f.length&&(l=f.pop(),l!=="meet"&&l!=="slice"?(m=l,l="meet"):f.length&&(m=f.pop())),g=m!=="none"?m.slice(1,4):"none",o=m!=="none"?m.slice(5,8):"none",{meetOrSlice:l,alignX:g,alignY:o}},clearFabricFontCache:function(i){i=(i||"").toLowerCase(),i?e.charWidthsCache[i]&&delete e.charWidthsCache[i]:e.charWidthsCache={}},limitDimsByArea:function(i,l){var g=Math.sqrt(l*i),o=Math.floor(l/g);return{x:Math.floor(g),y:o}},capValue:function(i,l,g){return Math.max(i,Math.min(l,g))},findScaleToFit:function(i,l){return Math.min(l.width/i.width,l.height/i.height)},findScaleToCover:function(i,l){return Math.max(l.width/i.width,l.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(l){return e.util.toFixed(l,e.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,l){var g=e.util.invertTransform(l),o=e.util.multiplyTransformMatrices(g,i.calcOwnMatrix());e.util.applyTransformToObject(i,o)},addTransformToObject:function(i,l){e.util.applyTransformToObject(i,e.util.multiplyTransformMatrices(l,i.calcOwnMatrix()))},applyTransformToObject:function(i,l){var g=e.util.qrDecompose(l),o=new e.Point(g.translateX,g.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",g.scaleX),i.set("scaleY",g.scaleY),i.skewX=g.skewX,i.skewY=g.skewY,i.angle=g.angle,i.setPositionByOrigin(o,"center","center")},sizeAfterTransform:function(i,l,g){var o=i/2,f=l/2,m=[{x:-o,y:-f},{x:o,y:-f},{x:-o,y:f},{x:o,y:f}],y=e.util.calcDimensionsMatrix(g),x=e.util.makeBoundingBoxFromPoints(m,y);return{x:x.width,y:x.height}},mergeClipPaths:function(i,l){var g=i,o=l;g.inverted&&!o.inverted&&(g=l,o=i),e.util.applyTransformToObject(o,e.util.multiplyTransformMatrices(e.util.invertTransform(g.calcTransformMatrix()),o.calcTransformMatrix()));var f=g.inverted&&o.inverted;return f&&(g.inverted=o.inverted=!1),new e.Group([g],{clipPath:o,inverted:f})},hasStyleChanged:function(i,l,g){return g=g||!1,i.fill!==l.fill||i.stroke!==l.stroke||i.strokeWidth!==l.strokeWidth||i.fontSize!==l.fontSize||i.fontFamily!==l.fontFamily||i.fontWeight!==l.fontWeight||i.fontStyle!==l.fontStyle||i.textBackgroundColor!==l.textBackgroundColor||i.deltaY!==l.deltaY||g&&(i.overline!==l.overline||i.underline!==l.underline||i.linethrough!==l.linethrough)},stylesToArray:function(g,l){for(var g=e.util.object.clone(g,!0),o=l.split(`
`),f=-1,m={},y=[],x=0;x<o.length;x++){if(!g[x]){f+=o[x].length;continue}for(var C=0;C<o[x].length;C++){f++;var b=g[x][C];if(b&&Object.keys(b).length>0){var T=e.util.hasStyleChanged(m,b,!0);T?y.push({start:f,end:f+1,style:b}):y[y.length-1].end++}m=b||{}}}return y},stylesFromArray:function(i,l){if(!Array.isArray(i))return i;for(var g=l.split(`
`),o=-1,f=0,m={},y=0;y<g.length;y++)for(var x=0;x<g[y].length;x++)o++,i[f]&&i[f].start<=o&&o<i[f].end&&(m[y]=m[y]||{},m[y][x]=Object.assign({},i[f].style),o===i[f].end-1&&f++);return m}}}(t),function(){var h=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},u={m:"l",M:"L"};function d(_,j,A,O,z,P,k,D,R,Y,G){var K=e.util.cos(_),Z=e.util.sin(_),se=e.util.cos(j),V=e.util.sin(j),B=A*z*se-O*P*V+k,I=O*z*se+A*P*V+D,N=Y+R*(-A*z*Z-O*P*K),M=G+R*(-O*z*Z+A*P*K),U=B+R*(A*z*V+O*P*se),$=I+R*(O*z*V-A*P*se);return["C",N,M,U,$,B,I]}function r(_,j,A,O,z,P,k){var D=Math.PI,R=k*D/180,Y=e.util.sin(R),G=e.util.cos(R),K=0,Z=0;A=Math.abs(A),O=Math.abs(O);var se=-G*_*.5-Y*j*.5,V=-G*j*.5+Y*_*.5,B=A*A,I=O*O,N=V*V,M=se*se,U=B*I-B*N-I*M,$=0;if(U<0){var he=Math.sqrt(1-U/(B*I));A*=he,O*=he}else $=(z===P?-1:1)*Math.sqrt(U/(B*N+I*M));var ee=$*A*V/O,W=-$*O*se/A,re=G*ee-Y*W+_*.5,fe=Y*ee+G*W+j*.5,pe=a(1,0,(se-ee)/A,(V-W)/O),ae=a((se-ee)/A,(V-W)/O,(-se-ee)/A,(-V-W)/O);P===0&&ae>0?ae-=2*D:P===1&&ae<0&&(ae+=2*D);for(var ie=Math.ceil(Math.abs(ae/D*2)),de=[],ge=ae/ie,Re=8/3*Math.sin(ge/4)*Math.sin(ge/4)/Math.sin(ge/2),Pt=pe+ge,at=0;at<ie;at++)de[at]=d(pe,Pt,G,Y,A,O,re,fe,Re,K,Z),K=de[at][5],Z=de[at][6],pe=Pt,Pt+=ge;return de}function a(_,j,A,O){var z=Math.atan2(j,_),P=Math.atan2(O,A);return P>=z?P-z:2*Math.PI-(z-P)}function i(_,j,A,O,z,P,k,D){var R;if(e.cachesBoundsOfCurve&&(R=h.call(arguments),e.boundsOfCurveCache[R]))return e.boundsOfCurveCache[R];var Y=Math.sqrt,G=Math.min,K=Math.max,Z=Math.abs,se=[],V=[[],[]],B,I,N,M,U,$,he,ee;I=6*_-12*A+6*z,B=-3*_+9*A-9*z+3*k,N=3*A-3*_;for(var W=0;W<2;++W){if(W>0&&(I=6*j-12*O+6*P,B=-3*j+9*O-9*P+3*D,N=3*O-3*j),Z(B)<1e-12){if(Z(I)<1e-12)continue;M=-N/I,0<M&&M<1&&se.push(M);continue}he=I*I-4*N*B,!(he<0)&&(ee=Y(he),U=(-I+ee)/(2*B),0<U&&U<1&&se.push(U),$=(-I-ee)/(2*B),0<$&&$<1&&se.push($))}for(var re,fe,pe=se.length,ae=pe,ie;pe--;)M=se[pe],ie=1-M,re=ie*ie*ie*_+3*ie*ie*M*A+3*ie*M*M*z+M*M*M*k,V[0][pe]=re,fe=ie*ie*ie*j+3*ie*ie*M*O+3*ie*M*M*P+M*M*M*D,V[1][pe]=fe;V[0][ae]=_,V[1][ae]=j,V[0][ae+1]=k,V[1][ae+1]=D;var de=[{x:G.apply(null,V[0]),y:G.apply(null,V[1])},{x:K.apply(null,V[0]),y:K.apply(null,V[1])}];return e.cachesBoundsOfCurve&&(e.boundsOfCurveCache[R]=de),de}function l(_,j,A){for(var O=A[1],z=A[2],P=A[3],k=A[4],D=A[5],R=A[6],Y=A[7],G=r(R-_,Y-j,O,z,k,D,P),K=0,Z=G.length;K<Z;K++)G[K][1]+=_,G[K][2]+=j,G[K][3]+=_,G[K][4]+=j,G[K][5]+=_,G[K][6]+=j;return G}function g(_){var j=0,A=0,O=_.length,z=0,P=0,k,D,R,Y=[],G,K,Z;for(D=0;D<O;++D){switch(R=!1,k=_[D].slice(0),k[0]){case"l":k[0]="L",k[1]+=j,k[2]+=A;case"L":j=k[1],A=k[2];break;case"h":k[1]+=j;case"H":k[0]="L",k[2]=A,j=k[1];break;case"v":k[1]+=A;case"V":k[0]="L",A=k[1],k[1]=j,k[2]=A;break;case"m":k[0]="M",k[1]+=j,k[2]+=A;case"M":j=k[1],A=k[2],z=k[1],P=k[2];break;case"c":k[0]="C",k[1]+=j,k[2]+=A,k[3]+=j,k[4]+=A,k[5]+=j,k[6]+=A;case"C":K=k[3],Z=k[4],j=k[5],A=k[6];break;case"s":k[0]="S",k[1]+=j,k[2]+=A,k[3]+=j,k[4]+=A;case"S":G==="C"?(K=2*j-K,Z=2*A-Z):(K=j,Z=A),j=k[3],A=k[4],k[0]="C",k[5]=k[3],k[6]=k[4],k[3]=k[1],k[4]=k[2],k[1]=K,k[2]=Z,K=k[3],Z=k[4];break;case"q":k[0]="Q",k[1]+=j,k[2]+=A,k[3]+=j,k[4]+=A;case"Q":K=k[1],Z=k[2],j=k[3],A=k[4];break;case"t":k[0]="T",k[1]+=j,k[2]+=A;case"T":G==="Q"?(K=2*j-K,Z=2*A-Z):(K=j,Z=A),k[0]="Q",j=k[1],A=k[2],k[1]=K,k[2]=Z,k[3]=j,k[4]=A;break;case"a":k[0]="A",k[6]+=j,k[7]+=A;case"A":R=!0,Y=Y.concat(l(j,A,k)),j=k[6],A=k[7];break;case"z":case"Z":j=z,A=P;break}R||Y.push(k),G=k[0]}return Y}function o(_,j,A,O){return Math.sqrt((A-_)*(A-_)+(O-j)*(O-j))}function f(_){return _*_*_}function m(_){return 3*_*_*(1-_)}function y(_){return 3*_*(1-_)*(1-_)}function x(_){return(1-_)*(1-_)*(1-_)}function C(_,j,A,O,z,P,k,D){return function(R){var Y=f(R),G=m(R),K=y(R),Z=x(R);return{x:k*Y+z*G+A*K+_*Z,y:D*Y+P*G+O*K+j*Z}}}function b(_,j,A,O,z,P,k,D){return function(R){var Y=1-R,G=3*Y*Y*(A-_)+6*Y*R*(z-A)+3*R*R*(k-z),K=3*Y*Y*(O-j)+6*Y*R*(P-O)+3*R*R*(D-P);return Math.atan2(K,G)}}function T(_){return _*_}function E(_){return 2*_*(1-_)}function L(_){return(1-_)*(1-_)}function F(_,j,A,O,z,P){return function(k){var D=T(k),R=E(k),Y=L(k);return{x:z*D+A*R+_*Y,y:P*D+O*R+j*Y}}}function H(_,j,A,O,z,P){return function(k){var D=1-k,R=2*D*(A-_)+2*k*(z-A),Y=2*D*(O-j)+2*k*(P-O);return Math.atan2(Y,R)}}function J(_,j,A){var O={x:j,y:A},z,P=0,k;for(k=1;k<=100;k+=1)z=_(k/100),P+=o(O.x,O.y,z.x,z.y),O=z;return P}function q(_,j){for(var A=0,O=0,z=_.iterator,P={x:_.x,y:_.y},k,D,R=.01,Y=_.angleFinder,G;O<j&&R>1e-4;)k=z(A),G=A,D=o(P.x,P.y,k.x,k.y),D+O>j?(A-=R,R/=2):(P=k,A+=R,O+=D);return k.angle=Y(G),k}function Q(_){for(var j=0,A=_.length,O,z=0,P=0,k=0,D=0,R=[],Y,G,K,Z=0;Z<A;Z++){switch(O=_[Z],G={x:z,y:P,command:O[0]},O[0]){case"M":G.length=0,k=z=O[1],D=P=O[2];break;case"L":G.length=o(z,P,O[1],O[2]),z=O[1],P=O[2];break;case"C":Y=C(z,P,O[1],O[2],O[3],O[4],O[5],O[6]),K=b(z,P,O[1],O[2],O[3],O[4],O[5],O[6]),G.iterator=Y,G.angleFinder=K,G.length=J(Y,z,P),z=O[5],P=O[6];break;case"Q":Y=F(z,P,O[1],O[2],O[3],O[4]),K=H(z,P,O[1],O[2],O[3],O[4]),G.iterator=Y,G.angleFinder=K,G.length=J(Y,z,P),z=O[3],P=O[4];break;case"Z":case"z":G.destX=k,G.destY=D,G.length=o(z,P,k,D),z=k,P=D;break}j+=G.length,R.push(G)}return R.push({length:j,x:z,y:P}),R}function te(_,j,A){A||(A=Q(_));for(var O=0;j-A[O].length>0&&O<A.length-2;)j-=A[O].length,O++;var z=A[O],P=j/z.length,k=z.command,D=_[O],R;switch(k){case"M":return{x:z.x,y:z.y,angle:0};case"Z":case"z":return R=new e.Point(z.x,z.y).lerp(new e.Point(z.destX,z.destY),P),R.angle=Math.atan2(z.destY-z.y,z.destX-z.x),R;case"L":return R=new e.Point(z.x,z.y).lerp(new e.Point(D[1],D[2]),P),R.angle=Math.atan2(D[2]-z.y,D[1]-z.x),R;case"C":return q(z,j);case"Q":return q(z,j)}}function oe(_){var j=[],A=[],O,z,P=e.rePathCommand,k="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",D="("+k+")"+e.commaWsp,R="([01])"+e.commaWsp+"?",Y=D+"?"+D+"?"+D+R+R+D+"?("+k+")",G=new RegExp(Y,"g"),K,Z,se;if(!_||!_.match)return j;se=_.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var V=0,B,I=se.length;V<I;V++){O=se[V],Z=O.slice(1).trim(),A.length=0;var N=O.charAt(0);if(B=[N],N.toLowerCase()==="a")for(var M;M=G.exec(Z);)for(var U=1;U<M.length;U++)A.push(M[U]);else for(;K=P.exec(Z);)A.push(K[0]);for(var U=0,$=A.length;U<$;U++)z=parseFloat(A[U]),isNaN(z)||B.push(z);var he=s[N.toLowerCase()],ee=u[N]||N;if(B.length-1>he)for(var W=1,re=B.length;W<re;W+=he)j.push([N].concat(B.slice(W,W+he))),N=ee;else j.push(B)}return j}function ce(_,j){var A=[],O,z=new e.Point(_[0].x,_[0].y),P=new e.Point(_[1].x,_[1].y),k=_.length,D=1,R=0,Y=k>2;for(j=j||0,Y&&(D=_[2].x<P.x?-1:_[2].x===P.x?0:1,R=_[2].y<P.y?-1:_[2].y===P.y?0:1),A.push(["M",z.x-D*j,z.y-R*j]),O=1;O<k;O++){if(!z.eq(P)){var G=z.midPointFrom(P);A.push(["Q",z.x,z.y,G.x,G.y])}z=_[O],O+1<_.length&&(P=_[O+1])}return Y&&(D=z.x>_[O-2].x?1:z.x===_[O-2].x?0:-1,R=z.y>_[O-2].y?1:z.y===_[O-2].y?0:-1),A.push(["L",z.x+D*j,z.y+R*j]),A}function X(_,j,A){return A&&(j=e.util.multiplyTransformMatrices(j,[1,0,0,1,-A.x,-A.y])),_.map(function(O){for(var z=O.slice(0),P={},k=1;k<O.length-1;k+=2)P.x=O[k],P.y=O[k+1],P=e.util.transformPoint(P,j),z[k]=P.x,z[k+1]=P.y;return z})}e.util.joinPath=function(_){return _.map(function(j){return j.join(" ")}).join(" ")},e.util.parsePath=oe,e.util.makePathSimpler=g,e.util.getSmoothPathFromPoints=ce,e.util.getPathSegmentsInfo=Q,e.util.getBoundsOfCurve=i,e.util.getPointOnPath=te,e.util.transformPath=X}(),function(){var h=Array.prototype.slice;function s(i,l){for(var g=h.call(arguments,2),o=[],f=0,m=i.length;f<m;f++)o[f]=g.length?i[f][l].apply(i[f],g):i[f][l].call(i[f]);return o}function u(i,l){return a(i,l,function(g,o){return g>=o})}function d(i,l){return a(i,l,function(g,o){return g<o})}function r(i,l){for(var g=i.length;g--;)i[g]=l;return i}function a(i,l,g){if(!(!i||i.length===0)){var o=i.length-1,f=l?i[o][l]:i[o];if(l)for(;o--;)g(i[o][l],f)&&(f=i[o][l]);else for(;o--;)g(i[o],f)&&(f=i[o]);return f}}e.util.array={fill:r,invoke:s,min:d,max:u}}(),function(){function h(u,d,r){if(r)if(!e.isLikelyNode&&d instanceof Element)u=d;else if(d instanceof Array){u=[];for(var a=0,i=d.length;a<i;a++)u[a]=h({},d[a],r)}else if(d&&typeof d=="object")for(var l in d)l==="canvas"||l==="group"?u[l]=null:d.hasOwnProperty(l)&&(u[l]=h({},d[l],r));else u=d;else for(var l in d)u[l]=d[l];return u}function s(u,d){return h({},u,d)}e.util.object={extend:h,clone:s},e.util.object.extend(e.util,e.Observable)}(),function(){function h(a){return a.replace(/-+(.)?/g,function(i,l){return l?l.toUpperCase():""})}function s(a,i){return a.charAt(0).toUpperCase()+(i?a.slice(1):a.slice(1).toLowerCase())}function u(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function d(a){var i=0,l,g=[];for(i=0,l;i<a.length;i++)(l=r(a,i))!==!1&&g.push(l);return g}function r(a,i){var l=a.charCodeAt(i);if(isNaN(l))return"";if(l<55296||l>57343)return a.charAt(i);if(55296<=l&&l<=56319){if(a.length<=i+1)throw"High surrogate without following low surrogate";var g=a.charCodeAt(i+1);if(56320>g||g>57343)throw"High surrogate without following low surrogate";return a.charAt(i)+a.charAt(i+1)}if(i===0)throw"Low surrogate without preceding high surrogate";var o=a.charCodeAt(i-1);if(55296>o||o>56319)throw"Low surrogate without preceding high surrogate";return!1}e.util.string={camelize:h,capitalize:s,escapeXml:u,graphemeSplit:d}}(),function(){var h=Array.prototype.slice,s=function(){},u=function(){for(var l in{toString:1})if(l==="toString")return!1;return!0}(),d=function(l,g,o){for(var f in g)f in l.prototype&&typeof l.prototype[f]=="function"&&(g[f]+"").indexOf("callSuper")>-1?l.prototype[f]=function(m){return function(){var y=this.constructor.superclass;this.constructor.superclass=o;var x=g[m].apply(this,arguments);if(this.constructor.superclass=y,m!=="initialize")return x}}(f):l.prototype[f]=g[f],u&&(g.toString!==Object.prototype.toString&&(l.prototype.toString=g.toString),g.valueOf!==Object.prototype.valueOf&&(l.prototype.valueOf=g.valueOf))};function r(){}function a(l){for(var g=null,o=this;o.constructor.superclass;){var f=o.constructor.superclass.prototype[l];if(o[l]!==f){g=f;break}o=o.constructor.superclass.prototype}return g?arguments.length>1?g.apply(this,h.call(arguments,1)):g.call(this):console.log("tried to callSuper "+l+", method not found in prototype chain",this)}function i(){var l=null,g=h.call(arguments,0);typeof g[0]=="function"&&(l=g.shift());function o(){this.initialize.apply(this,arguments)}o.superclass=l,o.subclasses=[],l&&(r.prototype=l.prototype,o.prototype=new r,l.subclasses.push(o));for(var f=0,m=g.length;f<m;f++)d(o,g[f],l);return o.prototype.initialize||(o.prototype.initialize=s),o.prototype.constructor=o,o.prototype.callSuper=a,o}e.util.createClass=i}(),function(){var h=!!e.document.createElement("div").attachEvent,s=["touchstart","touchmove","touchend"];e.util.addListener=function(d,r,a,i){d&&d.addEventListener(r,a,h?!1:i)},e.util.removeListener=function(d,r,a,i){d&&d.removeEventListener(r,a,h?!1:i)};function u(d){var r=d.changedTouches;return r&&r[0]?r[0]:d}e.util.getPointer=function(d){var r=d.target,a=e.util.getScrollLeftTop(r),i=u(d);return{x:i.clientX+a.left,y:i.clientY+a.top}},e.util.isTouchEvent=function(d){return s.indexOf(d.type)>-1||d.pointerType==="touch"}}(),function(){function h(i,l){var g=i.style;if(!g)return i;if(typeof l=="string")return i.style.cssText+=";"+l,l.indexOf("opacity")>-1?a(i,l.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var o in l)if(o==="opacity")a(i,l[o]);else{var f=o==="float"||o==="cssFloat"?typeof g.styleFloat>"u"?"cssFloat":"styleFloat":o;g.setProperty(f,l[o])}return i}var s=e.document.createElement("div"),u=typeof s.style.opacity=="string",d=typeof s.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(i){return i};u?a=function(i,l){return i.style.opacity=l,i}:d&&(a=function(i,l){var g=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(g.zoom=1),r.test(g.filter)?(l=l>=.9999?"":"alpha(opacity="+l*100+")",g.filter=g.filter.replace(r,l)):g.filter+=" alpha(opacity="+l*100+")",i}),e.util.setStyle=h}(),function(){var h=Array.prototype.slice;function s(x){return typeof x=="string"?e.document.getElementById(x):x}var u,d=function(x){return h.call(x,0)};try{u=d(e.document.childNodes)instanceof Array}catch{}u||(d=function(x){for(var C=new Array(x.length),b=x.length;b--;)C[b]=x[b];return C});function r(x,C){var b=e.document.createElement(x);for(var T in C)T==="class"?b.className=C[T]:T==="for"?b.htmlFor=C[T]:b.setAttribute(T,C[T]);return b}function a(x,C){x&&(" "+x.className+" ").indexOf(" "+C+" ")===-1&&(x.className+=(x.className?" ":"")+C)}function i(x,C,b){return typeof C=="string"&&(C=r(C,b)),x.parentNode&&x.parentNode.replaceChild(C,x),C.appendChild(x),C}function l(x){for(var C=0,b=0,T=e.document.documentElement,E=e.document.body||{scrollLeft:0,scrollTop:0};x&&(x.parentNode||x.host)&&(x=x.parentNode||x.host,x===e.document?(C=E.scrollLeft||T.scrollLeft||0,b=E.scrollTop||T.scrollTop||0):(C+=x.scrollLeft||0,b+=x.scrollTop||0),!(x.nodeType===1&&x.style.position==="fixed")););return{left:C,top:b}}function g(x){var C,b=x&&x.ownerDocument,T={left:0,top:0},E={left:0,top:0},L,F={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!b)return E;for(var H in F)E[F[H]]+=parseInt(o(x,H),10)||0;return C=b.documentElement,typeof x.getBoundingClientRect<"u"&&(T=x.getBoundingClientRect()),L=l(x),{left:T.left+L.left-(C.clientLeft||0)+E.left,top:T.top+L.top-(C.clientTop||0)+E.top}}var o;e.document.defaultView&&e.document.defaultView.getComputedStyle?o=function(x,C){var b=e.document.defaultView.getComputedStyle(x,null);return b?b[C]:void 0}:o=function(x,C){var b=x.style[C];return!b&&x.currentStyle&&(b=x.currentStyle[C]),b},function(){var x=e.document.documentElement.style,C="userSelect"in x?"userSelect":"MozUserSelect"in x?"MozUserSelect":"WebkitUserSelect"in x?"WebkitUserSelect":"KhtmlUserSelect"in x?"KhtmlUserSelect":"";function b(E){return typeof E.onselectstart<"u"&&(E.onselectstart=e.util.falseFunction),C?E.style[C]="none":typeof E.unselectable=="string"&&(E.unselectable="on"),E}function T(E){return typeof E.onselectstart<"u"&&(E.onselectstart=null),C?E.style[C]="":typeof E.unselectable=="string"&&(E.unselectable=""),E}e.util.makeElementUnselectable=b,e.util.makeElementSelectable=T}();function f(x){var C=e.jsdomImplForWrapper(x);return C._canvas||C._image}function m(x){if(e.isLikelyNode){var C=e.jsdomImplForWrapper(x);C&&(C._image=null,C._canvas=null,C._currentSrc=null,C._attributes=null,C._classList=null)}}function y(x,C){x.imageSmoothingEnabled=x.imageSmoothingEnabled||x.webkitImageSmoothingEnabled||x.mozImageSmoothingEnabled||x.msImageSmoothingEnabled||x.oImageSmoothingEnabled,x.imageSmoothingEnabled=C}e.util.setImageSmoothing=y,e.util.getById=s,e.util.toArray=d,e.util.addClass=a,e.util.makeElement=r,e.util.wrapElement=i,e.util.getScrollLeftTop=l,e.util.getElementOffset=g,e.util.getNodeCanvas=f,e.util.cleanUpJsdomNode=m}(),function(){function h(d,r){return d+(/\?/.test(d)?"&":"?")+r}function s(){}function u(d,r){r||(r={});var a=r.method?r.method.toUpperCase():"GET",i=r.onComplete||function(){},l=new e.window.XMLHttpRequest,g=r.body||r.parameters;return l.onreadystatechange=function(){l.readyState===4&&(i(l),l.onreadystatechange=s)},a==="GET"&&(g=null,typeof r.parameters=="string"&&(d=h(d,r.parameters))),l.open(a,d,!0),(a==="POST"||a==="PUT")&&l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(g),l}e.util.request=u}(),e.log=console.log,e.warn=console.warn,function(){var h=e.util.object.extend,s=e.util.object.clone,u=[];e.util.object.extend(u,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(m){m.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var m=this.filter(function(y){return typeof y.target=="object"&&y.target.canvas===f});return m.forEach(function(y){y.cancel()}),m},cancelByTarget:function(f){var m=this.findAnimationsByTarget(f);return m.forEach(function(y){y.cancel()}),m},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(m){return m.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(m){return m.target===f}):[]}});function d(){return!1}function r(f,m,y,x){return-y*Math.cos(f/x*(Math.PI/2))+y+m}function a(f){f||(f={});var m=!1,y,x=function(){var C=e.runningAnimations.indexOf(y);return C>-1&&e.runningAnimations.splice(C,1)[0]};return y=h(s(f),{cancel:function(){return m=!0,x()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),e.runningAnimations.push(y),g(function(C){var b=C||+new Date,T=f.duration||500,E=b+T,L,F=f.onChange||d,H=f.abort||d,J=f.onComplete||d,q=f.easing||r,Q="startValue"in f?f.startValue.length>0:!1,te="startValue"in f?f.startValue:0,oe="endValue"in f?f.endValue:100,ce=f.byValue||(Q?te.map(function(X,_){return oe[_]-te[_]}):oe-te);f.onStart&&f.onStart(),function X(_){L=_||+new Date;var j=L>E?T:L-b,A=j/T,O=Q?te.map(function(P,k){return q(j,te[k],ce[k],T)}):q(j,te,ce,T),z=Math.abs(Q?(O[0]-te[0])/ce[0]:(O-te)/ce);if(y.currentValue=Q?O.slice():O,y.completionRate=z,y.durationRate=A,!m){if(H(O,z,A)){x();return}if(L>E){y.currentValue=Q?oe.slice():oe,y.completionRate=1,y.durationRate=1,F(Q?oe.slice():oe,1,1),J(oe,1,1),x();return}else F(O,z,A),g(X)}}(b)}),y.cancel}var i=e.window.requestAnimationFrame||e.window.webkitRequestAnimationFrame||e.window.mozRequestAnimationFrame||e.window.oRequestAnimationFrame||e.window.msRequestAnimationFrame||function(f){return e.window.setTimeout(f,1e3/60)},l=e.window.cancelAnimationFrame||e.window.clearTimeout;function g(){return i.apply(e.window,arguments)}function o(){return l.apply(e.window,arguments)}e.util.animate=a,e.util.requestAnimFrame=g,e.util.cancelAnimFrame=o,e.runningAnimations=u}(),function(){function h(u,d,r){var a="rgba("+parseInt(u[0]+r*(d[0]-u[0]),10)+","+parseInt(u[1]+r*(d[1]-u[1]),10)+","+parseInt(u[2]+r*(d[2]-u[2]),10);return a+=","+(u&&d?parseFloat(u[3]+r*(d[3]-u[3])):1),a+=")",a}function s(u,d,r,a){var i=new e.Color(u).getSource(),l=new e.Color(d).getSource(),g=a.onComplete,o=a.onChange;return a=a||{},e.util.animate(e.util.object.extend(a,{duration:r||500,startValue:i,endValue:l,byValue:l,easing:function(f,m,y,x){var C=a.colorEasing?a.colorEasing(f,x):1-Math.cos(f/x*(Math.PI/2));return h(m,y,C)},onComplete:function(f,m,y){if(g)return g(h(l,l,0),m,y)},onChange:function(f,m,y){if(o){if(Array.isArray(f))return o(h(f,f,0),m,y);o(f,m,y)}}}))}e.util.animateColor=s}(),function(){function h(_,j,A,O){return _<Math.abs(j)?(_=j,O=A/4):j===0&&_===0?O=A/(2*Math.PI)*Math.asin(1):O=A/(2*Math.PI)*Math.asin(j/_),{a:_,c:j,p:A,s:O}}function s(_,j,A){return _.a*Math.pow(2,10*(j-=1))*Math.sin((j*A-_.s)*(2*Math.PI)/_.p)}function u(_,j,A,O){return A*((_=_/O-1)*_*_+1)+j}function d(_,j,A,O){return _/=O/2,_<1?A/2*_*_*_+j:A/2*((_-=2)*_*_+2)+j}function r(_,j,A,O){return A*(_/=O)*_*_*_+j}function a(_,j,A,O){return-A*((_=_/O-1)*_*_*_-1)+j}function i(_,j,A,O){return _/=O/2,_<1?A/2*_*_*_*_+j:-A/2*((_-=2)*_*_*_-2)+j}function l(_,j,A,O){return A*(_/=O)*_*_*_*_+j}function g(_,j,A,O){return A*((_=_/O-1)*_*_*_*_+1)+j}function o(_,j,A,O){return _/=O/2,_<1?A/2*_*_*_*_*_+j:A/2*((_-=2)*_*_*_*_+2)+j}function f(_,j,A,O){return-A*Math.cos(_/O*(Math.PI/2))+A+j}function m(_,j,A,O){return A*Math.sin(_/O*(Math.PI/2))+j}function y(_,j,A,O){return-A/2*(Math.cos(Math.PI*_/O)-1)+j}function x(_,j,A,O){return _===0?j:A*Math.pow(2,10*(_/O-1))+j}function C(_,j,A,O){return _===O?j+A:A*(-Math.pow(2,-10*_/O)+1)+j}function b(_,j,A,O){return _===0?j:_===O?j+A:(_/=O/2,_<1?A/2*Math.pow(2,10*(_-1))+j:A/2*(-Math.pow(2,-10*--_)+2)+j)}function T(_,j,A,O){return-A*(Math.sqrt(1-(_/=O)*_)-1)+j}function E(_,j,A,O){return A*Math.sqrt(1-(_=_/O-1)*_)+j}function L(_,j,A,O){return _/=O/2,_<1?-A/2*(Math.sqrt(1-_*_)-1)+j:A/2*(Math.sqrt(1-(_-=2)*_)+1)+j}function F(_,j,A,O){var z=1.70158,P=0,k=A;if(_===0)return j;if(_/=O,_===1)return j+A;P||(P=O*.3);var D=h(k,A,P,z);return-s(D,_,O)+j}function H(_,j,A,O){var z=1.70158,P=0,k=A;if(_===0)return j;if(_/=O,_===1)return j+A;P||(P=O*.3);var D=h(k,A,P,z);return D.a*Math.pow(2,-10*_)*Math.sin((_*O-D.s)*(2*Math.PI)/D.p)+D.c+j}function J(_,j,A,O){var z=1.70158,P=0,k=A;if(_===0)return j;if(_/=O/2,_===2)return j+A;P||(P=O*(.3*1.5));var D=h(k,A,P,z);return _<1?-.5*s(D,_,O)+j:D.a*Math.pow(2,-10*(_-=1))*Math.sin((_*O-D.s)*(2*Math.PI)/D.p)*.5+D.c+j}function q(_,j,A,O,z){return z===void 0&&(z=1.70158),A*(_/=O)*_*((z+1)*_-z)+j}function Q(_,j,A,O,z){return z===void 0&&(z=1.70158),A*((_=_/O-1)*_*((z+1)*_+z)+1)+j}function te(_,j,A,O,z){return z===void 0&&(z=1.70158),_/=O/2,_<1?A/2*(_*_*(((z*=1.525)+1)*_-z))+j:A/2*((_-=2)*_*(((z*=1.525)+1)*_+z)+2)+j}function oe(_,j,A,O){return A-ce(O-_,0,A,O)+j}function ce(_,j,A,O){return(_/=O)<1/2.75?A*(7.5625*_*_)+j:_<2/2.75?A*(7.5625*(_-=1.5/2.75)*_+.75)+j:_<2.5/2.75?A*(7.5625*(_-=2.25/2.75)*_+.9375)+j:A*(7.5625*(_-=2.625/2.75)*_+.984375)+j}function X(_,j,A,O){return _<O/2?oe(_*2,0,A,O)*.5+j:ce(_*2-O,0,A,O)*.5+A*.5+j}e.util.ease={easeInQuad:function(_,j,A,O){return A*(_/=O)*_+j},easeOutQuad:function(_,j,A,O){return-A*(_/=O)*(_-2)+j},easeInOutQuad:function(_,j,A,O){return _/=O/2,_<1?A/2*_*_+j:-A/2*(--_*(_-2)-1)+j},easeInCubic:function(_,j,A,O){return A*(_/=O)*_*_+j},easeOutCubic:u,easeInOutCubic:d,easeInQuart:r,easeOutQuart:a,easeInOutQuart:i,easeInQuint:l,easeOutQuint:g,easeInOutQuint:o,easeInSine:f,easeOutSine:m,easeInOutSine:y,easeInExpo:x,easeOutExpo:C,easeInOutExpo:b,easeInCirc:T,easeOutCirc:E,easeInOutCirc:L,easeInElastic:F,easeOutElastic:H,easeInOutElastic:J,easeInBack:q,easeOutBack:Q,easeInOutBack:te,easeInBounce:oe,easeOutBounce:ce,easeInOutBounce:X}}(),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,d=s.util.object.clone,r=s.util.toFixed,a=s.util.parseUnit,i=s.util.multiplyTransformMatrices,l=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],g=["symbol","image","marker","pattern","view","svg"],o=["pattern","defs","symbol","metadata","clipPath","mask","desc"],f=["symbol","g","a","svg","clipPath","defs"],m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},y={stroke:"strokeOpacity",fill:"fillOpacity"},x="font-size",C="clip-path";s.svgValidTagNamesRegEx=E(l),s.svgViewBoxElementsRegEx=E(g),s.svgInvalidAncestorsRegEx=E(o),s.svgValidParentsRegEx=E(f),s.cssRules={},s.gradientDefs={},s.clipPaths={};function b(P){return P in m?m[P]:P}function T(P,k,D,R){var Y=Array.isArray(k),G;if((P==="fill"||P==="stroke")&&k==="none")k="";else{if(P==="strokeUniform")return k==="non-scaling-stroke";if(P==="strokeDashArray")k==="none"?k=null:k=k.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(P==="transformMatrix")D&&D.transformMatrix?k=i(D.transformMatrix,s.parseTransformAttribute(k)):k=s.parseTransformAttribute(k);else if(P==="visible")k=k!=="none"&&k!=="hidden",D&&D.visible===!1&&(k=!1);else if(P==="opacity")k=parseFloat(k),D&&typeof D.opacity<"u"&&(k*=D.opacity);else if(P==="textAnchor")k=k==="start"?"left":k==="end"?"right":"center";else if(P==="charSpacing")G=a(k,R)/R*1e3;else if(P==="paintFirst"){var K=k.indexOf("fill"),Z=k.indexOf("stroke"),k="fill";(K>-1&&Z>-1&&Z<K||K===-1&&Z>-1)&&(k="stroke")}else{if(P==="href"||P==="xlink:href"||P==="font")return k;if(P==="imageSmoothing")return k==="optimizeQuality";G=Y?k.map(a):a(k,R)}}return!Y&&isNaN(G)?k:G}function E(P){return new RegExp("^("+P.join("|")+")\\b","i")}function L(P){for(var k in y)if(!(typeof P[y[k]]>"u"||P[k]==="")){if(typeof P[k]>"u"){if(!s.Object.prototype[k])continue;P[k]=s.Object.prototype[k]}if(P[k].indexOf("url(")!==0){var D=new s.Color(P[k]);P[k]=D.setAlpha(r(D.getAlpha()*P[y[k]],2)).toRgba()}}return P}function F(P,k){var D,R=[],Y,G,K;for(G=0,K=k.length;G<K;G++)D=k[G],Y=P.getElementsByTagName(D),R=R.concat(Array.prototype.slice.call(Y));return R}s.parseTransformAttribute=function(){function P(W,re){var fe=s.util.cos(re[0]),pe=s.util.sin(re[0]),ae=0,ie=0;re.length===3&&(ae=re[1],ie=re[2]),W[0]=fe,W[1]=pe,W[2]=-pe,W[3]=fe,W[4]=ae-(fe*ae-pe*ie),W[5]=ie-(pe*ae+fe*ie)}function k(W,re){var fe=re[0],pe=re.length===2?re[1]:re[0];W[0]=fe,W[3]=pe}function D(W,re,fe){W[fe]=Math.tan(s.util.degreesToRadians(re[0]))}function R(W,re){W[4]=re[0],re.length===2&&(W[5]=re[1])}var Y=s.iMatrix,G=s.reNum,K=s.commaWsp,Z="(?:(skewX)\\s*\\(\\s*("+G+")\\s*\\))",se="(?:(skewY)\\s*\\(\\s*("+G+")\\s*\\))",V="(?:(rotate)\\s*\\(\\s*("+G+")(?:"+K+"("+G+")"+K+"("+G+"))?\\s*\\))",B="(?:(scale)\\s*\\(\\s*("+G+")(?:"+K+"("+G+"))?\\s*\\))",I="(?:(translate)\\s*\\(\\s*("+G+")(?:"+K+"("+G+"))?\\s*\\))",N="(?:(matrix)\\s*\\(\\s*("+G+")"+K+"("+G+")"+K+"("+G+")"+K+"("+G+")"+K+"("+G+")"+K+"("+G+")\\s*\\))",M="(?:"+N+"|"+I+"|"+B+"|"+V+"|"+Z+"|"+se+")",U="(?:"+M+"(?:"+K+"*"+M+")*)",$="^\\s*(?:"+U+"?)\\s*$",he=new RegExp($),ee=new RegExp(M,"g");return function(W){var re=Y.concat(),fe=[];if(!W||W&&!he.test(W))return re;W.replace(ee,function(ae){var ie=new RegExp(M).exec(ae).filter(function(Re){return!!Re}),de=ie[1],ge=ie.slice(2).map(parseFloat);switch(de){case"translate":R(re,ge);break;case"rotate":ge[0]=s.util.degreesToRadians(ge[0]),P(re,ge);break;case"scale":k(re,ge);break;case"skewX":D(re,ge,2);break;case"skewY":D(re,ge,1);break;case"matrix":re=ge;break}fe.push(re.concat()),re=Y.concat()});for(var pe=fe[0];fe.length>1;)fe.shift(),pe=s.util.multiplyTransformMatrices(pe,fe[0]);return pe}}();function H(P,k){var D,R;P.replace(/;\s*$/,"").split(";").forEach(function(Y){var G=Y.split(":");D=G[0].trim().toLowerCase(),R=G[1].trim(),k[D]=R})}function J(P,k){var D,R;for(var Y in P)typeof P[Y]>"u"||(D=Y.toLowerCase(),R=P[Y],k[D]=R)}function q(P,k){var D={};for(var R in s.cssRules[k])if(Q(P,R.split(" ")))for(var Y in s.cssRules[k][R])D[Y]=s.cssRules[k][R][Y];return D}function Q(P,k){var D,R=!0;return D=oe(P,k.pop()),D&&k.length&&(R=te(P,k)),D&&R&&k.length===0}function te(P,k){for(var D,R=!0;P.parentNode&&P.parentNode.nodeType===1&&k.length;)R&&(D=k.pop()),P=P.parentNode,R=oe(P,D);return k.length===0}function oe(P,k){var D=P.nodeName,R=P.getAttribute("class"),Y=P.getAttribute("id"),G,K;if(G=new RegExp("^"+D,"i"),k=k.replace(G,""),Y&&k.length&&(G=new RegExp("#"+Y+"(?![a-zA-Z\\-]+)","i"),k=k.replace(G,"")),R&&k.length)for(R=R.split(" "),K=R.length;K--;)G=new RegExp("\\."+R[K]+"(?![a-zA-Z\\-]+)","i"),k=k.replace(G,"");return k.length===0}function ce(P,k){var D;if(P.getElementById&&(D=P.getElementById(k)),D)return D;var R,Y,G,K=P.getElementsByTagName("*");for(Y=0,G=K.length;Y<G;Y++)if(R=K[Y],k===R.getAttribute("id"))return R}function X(P){for(var k=F(P,["use","svg:use"]),D=0;k.length&&D<k.length;){var R=k[D],Y=R.getAttribute("xlink:href")||R.getAttribute("href");if(Y===null)return;var G=Y.slice(1),K=R.getAttribute("x")||0,Z=R.getAttribute("y")||0,se=ce(P,G).cloneNode(!0),V=(se.getAttribute("transform")||"")+" translate("+K+", "+Z+")",B,I=k.length,N,M,U,$,he=s.svgNS;if(j(se),/^svg$/i.test(se.nodeName)){var ee=se.ownerDocument.createElementNS(he,"g");for(M=0,U=se.attributes,$=U.length;M<$;M++)N=U.item(M),ee.setAttributeNS(he,N.nodeName,N.nodeValue);for(;se.firstChild;)ee.appendChild(se.firstChild);se=ee}for(M=0,U=R.attributes,$=U.length;M<$;M++)N=U.item(M),!(N.nodeName==="x"||N.nodeName==="y"||N.nodeName==="xlink:href"||N.nodeName==="href")&&(N.nodeName==="transform"?V=N.nodeValue+" "+V:se.setAttribute(N.nodeName,N.nodeValue));se.setAttribute("transform",V),se.setAttribute("instantiated_by_use","1"),se.removeAttribute("id"),B=R.parentNode,B.replaceChild(se,R),k.length===I&&D++}}var _=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function j(P){if(!s.svgViewBoxElementsRegEx.test(P.nodeName))return{};var k=P.getAttribute("viewBox"),D=1,R=1,Y=0,G=0,K,Z,se,V,B=P.getAttribute("width"),I=P.getAttribute("height"),N=P.getAttribute("x")||0,M=P.getAttribute("y")||0,U=P.getAttribute("preserveAspectRatio")||"",$=!k||!(k=k.match(_)),he=!B||!I||B==="100%"||I==="100%",ee=$&&he,W={},re="",fe=0,pe=0;if(W.width=0,W.height=0,W.toBeParsed=ee,$&&(N||M)&&P.parentNode&&P.parentNode.nodeName!=="#document"&&(re=" translate("+a(N)+" "+a(M)+") ",se=(P.getAttribute("transform")||"")+re,P.setAttribute("transform",se),P.removeAttribute("x"),P.removeAttribute("y")),ee)return W;if($)return W.width=a(B),W.height=a(I),W;if(Y=-parseFloat(k[1]),G=-parseFloat(k[2]),K=parseFloat(k[3]),Z=parseFloat(k[4]),W.minX=Y,W.minY=G,W.viewBoxWidth=K,W.viewBoxHeight=Z,he?(W.width=K,W.height=Z):(W.width=a(B),W.height=a(I),D=W.width/K,R=W.height/Z),U=s.util.parsePreserveAspectRatioAttribute(U),U.alignX!=="none"&&(U.meetOrSlice==="meet"&&(R=D=D>R?R:D),U.meetOrSlice==="slice"&&(R=D=D>R?D:R),fe=W.width-K*D,pe=W.height-Z*D,U.alignX==="Mid"&&(fe/=2),U.alignY==="Mid"&&(pe/=2),U.alignX==="Min"&&(fe=0),U.alignY==="Min"&&(pe=0)),D===1&&R===1&&Y===0&&G===0&&N===0&&M===0)return W;if((N||M)&&P.parentNode.nodeName!=="#document"&&(re=" translate("+a(N)+" "+a(M)+") "),se=re+" matrix("+D+" 0 0 "+R+" "+(Y*D+fe)+" "+(G*R+pe)+") ",P.nodeName==="svg"){for(V=P.ownerDocument.createElementNS(s.svgNS,"g");P.firstChild;)V.appendChild(P.firstChild);P.appendChild(V)}else V=P,V.removeAttribute("x"),V.removeAttribute("y"),se=V.getAttribute("transform")+se;return V.setAttribute("transform",se),W}function A(P,k){for(;P&&(P=P.parentNode);)if(P.nodeName&&k.test(P.nodeName.replace("svg:",""))&&!P.getAttribute("instantiated_by_use"))return!0;return!1}s.parseSVGDocument=function(P,k,D,R){if(P){X(P);var Y=s.Object.__uid++,G,K,Z=j(P),se=s.util.toArray(P.getElementsByTagName("*"));if(Z.crossOrigin=R&&R.crossOrigin,Z.svgUid=Y,se.length===0&&s.isLikelyNode){se=P.selectNodes('//*[name(.)!="svg"]');var V=[];for(G=0,K=se.length;G<K;G++)V[G]=se[G];se=V}var B=se.filter(function(N){return j(N),s.svgValidTagNamesRegEx.test(N.nodeName.replace("svg:",""))&&!A(N,s.svgInvalidAncestorsRegEx)});if(!B||B&&!B.length){k&&k([],{});return}var I={};se.filter(function(N){return N.nodeName.replace("svg:","")==="clipPath"}).forEach(function(N){var M=N.getAttribute("id");I[M]=s.util.toArray(N.getElementsByTagName("*")).filter(function(U){return s.svgValidTagNamesRegEx.test(U.nodeName.replace("svg:",""))})}),s.gradientDefs[Y]=s.getGradientDefs(P),s.cssRules[Y]=s.getCSSRules(P),s.clipPaths[Y]=I,s.parseElements(B,function(N,M){k&&(k(N,Z,M,se),delete s.gradientDefs[Y],delete s.cssRules[Y],delete s.clipPaths[Y])},d(Z),D,R)}};function O(P,k){var D=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],R="xlink:href",Y=k.getAttribute(R).slice(1),G=ce(P,Y);if(G&&G.getAttribute(R)&&O(P,G),D.forEach(function(Z){G&&!k.hasAttribute(Z)&&G.hasAttribute(Z)&&k.setAttribute(Z,G.getAttribute(Z))}),!k.children.length)for(var K=G.cloneNode(!0);K.firstChild;)k.appendChild(K.firstChild);k.removeAttribute(R)}var z=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");u(s,{parseFontDeclaration:function(P,k){var D=P.match(z);if(D){var R=D[1],Y=D[3],G=D[4],K=D[5],Z=D[6];R&&(k.fontStyle=R),Y&&(k.fontWeight=isNaN(parseFloat(Y))?Y:parseFloat(Y)),G&&(k.fontSize=a(G)),Z&&(k.fontFamily=Z),K&&(k.lineHeight=K==="normal"?1:K)}},getGradientDefs:function(P){var k=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],D=F(P,k),R,Y=0,G={};for(Y=D.length;Y--;)R=D[Y],R.getAttribute("xlink:href")&&O(P,R),G[R.getAttribute("id")]=R;return G},parseAttributes:function(P,k,D){if(P){var R,Y={},G,K;typeof D>"u"&&(D=P.getAttribute("svgUid")),P.parentNode&&s.svgValidParentsRegEx.test(P.parentNode.nodeName)&&(Y=s.parseAttributes(P.parentNode,k,D));var Z=k.reduce(function(U,$){return R=P.getAttribute($),R&&(U[$]=R),U},{}),se=u(q(P,D),s.parseStyleAttribute(P));Z=u(Z,se),se[C]&&P.setAttribute(C,se[C]),G=K=Y.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,Z[x]&&(Z[x]=G=a(Z[x],K));var V,B,I={};for(var N in Z)V=b(N),B=T(V,Z[N],Y,G),I[V]=B;I&&I.font&&s.parseFontDeclaration(I.font,I);var M=u(Y,I);return s.svgValidParentsRegEx.test(P.nodeName)?M:L(M)}},parseElements:function(P,k,D,R,Y){new s.ElementsParser(P,k,D,R,Y).parse()},parseStyleAttribute:function(P){var k={},D=P.getAttribute("style");return D&&(typeof D=="string"?H(D,k):J(D,k)),k},parsePointsAttribute:function(P){if(!P)return null;P=P.replace(/,/g," ").trim(),P=P.split(/\s+/);var k=[],D,R;for(D=0,R=P.length;D<R;D+=2)k.push({x:parseFloat(P[D]),y:parseFloat(P[D+1])});return k},getCSSRules:function(P){var k=P.getElementsByTagName("style"),D,R,Y={},G;for(D=0,R=k.length;D<R;D++){var K=k[D].textContent;K=K.replace(/\/\*[\s\S]*?\*\//g,""),K.trim()!==""&&(G=K.split("}"),G=G.filter(function(Z){return Z.trim()}),G.forEach(function(Z){var se=Z.split("{"),V={},B=se[1].trim(),I=B.split(";").filter(function($){return $.trim()});for(D=0,R=I.length;D<R;D++){var N=I[D].split(":"),M=N[0].trim(),U=N[1].trim();V[M]=U}Z=se[0].trim(),Z.split(",").forEach(function($){$=$.replace(/^svg/i,"").trim(),$!==""&&(Y[$]?s.util.object.extend(Y[$],V):Y[$]=s.util.object.clone(V))})}))}return Y},loadSVGFromURL:function(P,k,D,R){P=P.replace(/^\n\s*/,"").trim(),new s.util.request(P,{method:"get",onComplete:Y});function Y(G){var K=G.responseXML;if(!K||!K.documentElement)return k&&k(null),!1;s.parseSVGDocument(K.documentElement,function(Z,se,V,B){k&&k(Z,se,V,B)},D,R)}},loadSVGFromString:function(P,k,D,R){var Y=new s.window.DOMParser,G=Y.parseFromString(P.trim(),"text/xml");s.parseSVGDocument(G.documentElement,function(K,Z,se,V){k(K,Z,se,V)},D,R)}})}(t),e.ElementsParser=function(h,s,u,d,r,a){this.elements=h,this.callback=s,this.options=u,this.reviver=d,this.svgUid=u&&u.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a},function(h){h.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},h.createObjects=function(){var s=this;this.elements.forEach(function(u,d){u.setAttribute("svgUid",s.svgUid),s.createObject(u,d)})},h.findTag=function(s){return e[e.util.string.capitalize(s.tagName.replace("svg:",""))]},h.createObject=function(s,u){var d=this.findTag(s);if(d&&d.fromElement)try{d.fromElement(s,this.createCallback(u,s),this.options)}catch(r){e.log(r)}else this.checkIfDone()},h.createCallback=function(s,u){var d=this;return function(r){var a;d.resolveGradient(r,u,"fill"),d.resolveGradient(r,u,"stroke"),r instanceof e.Image&&r._originalElement&&(a=r.parsePreserveAspectRatioAttribute(u)),r._removeTransformMatrix(a),d.resolveClipPath(r,u),d.reviver&&d.reviver(u,r),d.instances[s]=r,d.checkIfDone()}},h.extractPropertyDefinition=function(s,u,d){var r=s[u],a=this.regexUrl;if(a.test(r)){a.lastIndex=0;var i=a.exec(r)[1];return a.lastIndex=0,e[d][this.svgUid][i]}},h.resolveGradient=function(s,u,d){var r=this.extractPropertyDefinition(s,d,"gradientDefs");if(r){var a=u.getAttribute(d+"-opacity"),i=e.Gradient.fromElement(r,s,a,this.options);s.set(d,i)}},h.createClipPathCallback=function(s,u){return function(d){d._removeTransformMatrix(),d.fillRule=d.clipRule,u.push(d)}},h.resolveClipPath=function(s,u){var d=this.extractPropertyDefinition(s,"clipPath","clipPaths"),r,a,i,l,g,o;if(d){l=[],i=e.util.invertTransform(s.calcTransformMatrix());for(var f=d[0].parentNode,m=u;m.parentNode&&m.getAttribute("clip-path")!==s.clipPath;)m=m.parentNode;m.parentNode.appendChild(f);for(var y=0;y<d.length;y++)r=d[y],a=this.findTag(r),a.fromElement(r,this.createClipPathCallback(s,l),this.options);l.length===1?d=l[0]:d=new e.Group(l),g=e.util.multiplyTransformMatrices(i,d.calcTransformMatrix()),d.clipPath&&this.resolveClipPath(d,m);var o=e.util.qrDecompose(g);d.flipX=!1,d.flipY=!1,d.set("scaleX",o.scaleX),d.set("scaleY",o.scaleY),d.angle=o.angle,d.skewX=o.skewX,d.skewY=0,d.setPositionByOrigin({x:o.translateX,y:o.translateY},"center","center"),s.clipPath=d}else delete s.clipPath},h.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))}}(e.ElementsParser.prototype),function(h){var s=h.fabric||(h.fabric={});if(s.Point){s.warn("fabric.Point is already defined");return}s.Point=u;function u(d,r){this.x=d,this.y=r}u.prototype={type:"point",constructor:u,add:function(d){return new u(this.x+d.x,this.y+d.y)},addEquals:function(d){return this.x+=d.x,this.y+=d.y,this},scalarAdd:function(d){return new u(this.x+d,this.y+d)},scalarAddEquals:function(d){return this.x+=d,this.y+=d,this},subtract:function(d){return new u(this.x-d.x,this.y-d.y)},subtractEquals:function(d){return this.x-=d.x,this.y-=d.y,this},scalarSubtract:function(d){return new u(this.x-d,this.y-d)},scalarSubtractEquals:function(d){return this.x-=d,this.y-=d,this},multiply:function(d){return new u(this.x*d,this.y*d)},multiplyEquals:function(d){return this.x*=d,this.y*=d,this},divide:function(d){return new u(this.x/d,this.y/d)},divideEquals:function(d){return this.x/=d,this.y/=d,this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(d,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new u(this.x+(d.x-this.x)*r,this.y+(d.y-this.y)*r)},distanceFrom:function(d){var r=this.x-d.x,a=this.y-d.y;return Math.sqrt(r*r+a*a)},midPointFrom:function(d){return this.lerp(d)},min:function(d){return new u(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new u(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,r){return this.x=d,this.y=r,this},setX:function(d){return this.x=d,this},setY:function(d){return this.y=d,this},setFromPoint:function(d){return this.x=d.x,this.y=d.y,this},swap:function(d){var r=this.x,a=this.y;this.x=d.x,this.y=d.y,d.x=r,d.y=a},clone:function(){return new u(this.x,this.y)}}}(t),function(h){var s=h.fabric||(h.fabric={});if(s.Intersection){s.warn("fabric.Intersection is already defined");return}function u(d){this.status=d,this.points=[]}s.Intersection=u,s.Intersection.prototype={constructor:u,appendPoint:function(d){return this.points.push(d),this},appendPoints:function(d){return this.points=this.points.concat(d),this}},s.Intersection.intersectLineLine=function(d,r,a,i){var l,g=(i.x-a.x)*(d.y-a.y)-(i.y-a.y)*(d.x-a.x),o=(r.x-d.x)*(d.y-a.y)-(r.y-d.y)*(d.x-a.x),f=(i.y-a.y)*(r.x-d.x)-(i.x-a.x)*(r.y-d.y);if(f!==0){var m=g/f,y=o/f;0<=m&&m<=1&&0<=y&&y<=1?(l=new u("Intersection"),l.appendPoint(new s.Point(d.x+m*(r.x-d.x),d.y+m*(r.y-d.y)))):l=new u}else g===0||o===0?l=new u("Coincident"):l=new u("Parallel");return l},s.Intersection.intersectLinePolygon=function(d,r,a){var i=new u,l=a.length,g,o,f,m;for(m=0;m<l;m++)g=a[m],o=a[(m+1)%l],f=u.intersectLineLine(d,r,g,o),i.appendPoints(f.points);return i.points.length>0&&(i.status="Intersection"),i},s.Intersection.intersectPolygonPolygon=function(d,r){var a=new u,i=d.length,l;for(l=0;l<i;l++){var g=d[l],o=d[(l+1)%i],f=u.intersectLinePolygon(g,o,r);a.appendPoints(f.points)}return a.points.length>0&&(a.status="Intersection"),a},s.Intersection.intersectPolygonRectangle=function(d,r,a){var i=r.min(a),l=r.max(a),g=new s.Point(l.x,i.y),o=new s.Point(i.x,l.y),f=u.intersectLinePolygon(i,g,d),m=u.intersectLinePolygon(g,l,d),y=u.intersectLinePolygon(l,o,d),x=u.intersectLinePolygon(o,i,d),C=new u;return C.appendPoints(f.points),C.appendPoints(m.points),C.appendPoints(y.points),C.appendPoints(x.points),C.points.length>0&&(C.status="Intersection"),C}}(t),function(h){var s=h.fabric||(h.fabric={});if(s.Color){s.warn("fabric.Color is already defined.");return}function u(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}s.Color=u,s.Color.prototype={_tryParsingColor:function(r){var a;r in u.colorNameMap&&(r=u.colorNameMap[r]),r==="transparent"&&(a=[255,255,255,0]),a||(a=u.sourceFromHex(r)),a||(a=u.sourceFromRgb(r)),a||(a=u.sourceFromHsl(r)),a||(a=[0,0,0,1]),a&&this.setSource(a)},_rgbToHsl:function(r,a,i){r/=255,a/=255,i/=255;var l,g,o,f=s.util.array.max([r,a,i]),m=s.util.array.min([r,a,i]);if(o=(f+m)/2,f===m)l=g=0;else{var y=f-m;switch(g=o>.5?y/(2-f-m):y/(f+m),f){case r:l=(a-i)/y+(a<i?6:0);break;case a:l=(i-r)/y+2;break;case i:l=(r-a)/y+4;break}l/=6}return[Math.round(l*360),Math.round(g*100),Math.round(o*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),a=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var r=this.getSource(),a=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),a,i,l;return a=r[0].toString(16),a=a.length===1?"0"+a:a,i=r[1].toString(16),i=i.length===1?"0"+i:i,l=r[2].toString(16),l=l.length===1?"0"+l:l,a.toUpperCase()+i.toUpperCase()+l.toUpperCase()},toHexa:function(){var r=this.getSource(),a;return a=Math.round(r[3]*255),a=a.toString(16),a=a.length===1?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var a=this.getSource();return a[3]=r,this.setSource(a),this},toGrayscale:function(){var r=this.getSource(),a=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),i=r[3];return this.setSource([a,a,a,i]),this},toBlackWhite:function(r){var a=this.getSource(),i=(a[0]*.3+a[1]*.59+a[2]*.11).toFixed(0),l=a[3];return r=r||127,i=Number(i)<Number(r)?0:255,this.setSource([i,i,i,l]),this},overlayWith:function(r){r instanceof u||(r=new u(r));var a=[],i=this.getAlpha(),l=.5,g=this.getSource(),o=r.getSource(),f;for(f=0;f<3;f++)a.push(Math.round(g[f]*(1-l)+o[f]*l));return a[3]=i,this.setSource(a),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function d(r,a,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(a-r)*6*i:i<1/2?a:i<2/3?r+(a-r)*(2/3-i)*6:r}s.Color.fromRgb=function(r){return u.fromSource(u.sourceFromRgb(r))},s.Color.sourceFromRgb=function(r){var a=r.match(u.reRGBa);if(a){var i=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),l=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),g=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(i,10),parseInt(l,10),parseInt(g,10),a[4]?parseFloat(a[4]):1]}},s.Color.fromRgba=u.fromRgb,s.Color.fromHsl=function(r){return u.fromSource(u.sourceFromHsl(r))},s.Color.sourceFromHsl=function(r){var a=r.match(u.reHSLa);if(a){var i=(parseFloat(a[1])%360+360)%360/360,l=parseFloat(a[2])/(/%$/.test(a[2])?100:1),g=parseFloat(a[3])/(/%$/.test(a[3])?100:1),o,f,m;if(l===0)o=f=m=g;else{var y=g<=.5?g*(l+1):g+l-g*l,x=g*2-y;o=d(x,y,i+1/3),f=d(x,y,i),m=d(x,y,i-1/3)}return[Math.round(o*255),Math.round(f*255),Math.round(m*255),a[4]?parseFloat(a[4]):1]}},s.Color.fromHsla=u.fromHsl,s.Color.fromHex=function(r){return u.fromSource(u.sourceFromHex(r))},s.Color.sourceFromHex=function(r){if(r.match(u.reHex)){var a=r.slice(r.indexOf("#")+1),i=a.length===3||a.length===4,l=a.length===8||a.length===4,g=i?a.charAt(0)+a.charAt(0):a.substring(0,2),o=i?a.charAt(1)+a.charAt(1):a.substring(2,4),f=i?a.charAt(2)+a.charAt(2):a.substring(4,6),m=l?i?a.charAt(3)+a.charAt(3):a.substring(6,8):"FF";return[parseInt(g,16),parseInt(o,16),parseInt(f,16),parseFloat((parseInt(m,16)/255).toFixed(2))]}},s.Color.fromSource=function(r){var a=new u;return a.setSource(r),a}}(t),function(h){var s=h.fabric||(h.fabric={}),u=["e","se","s","sw","w","nw","n","ne","e"],d=["ns","nesw","ew","nwse"],r={},a="left",i="top",l="right",g="bottom",o="center",f={top:g,bottom:i,left:l,right:a,center:o},m=s.util.radiansToDegrees,y=Math.sign||function(V){return(V>0)-(V<0)||+V};function x(V,B){var I=V.angle+m(Math.atan2(B.y,B.x))+360;return Math.round(I%360/45)}function C(V,B){var I=B.transform.target,N=I.canvas,M=s.util.object.clone(B);M.target=I,N&&N.fire("object:"+V,M),I.fire(V,B)}function b(V,B){var I=B.canvas,N=I.uniScaleKey,M=V[N];return I.uniformScaling&&!M||!I.uniformScaling&&M}function T(V){return V.originX===o&&V.originY===o}function E(V,B,I){var N=V.lockScalingX,M=V.lockScalingY;return!!(N&&M||!B&&(N||M)&&I||N&&B==="x"||M&&B==="y")}function L(V,B,I){var N="not-allowed",M=b(V,I),U="";if(B.x!==0&&B.y===0?U="x":B.x===0&&B.y!==0&&(U="y"),E(I,U,M))return N;var $=x(I,B);return u[$]+"-resize"}function F(V,B,I){var N="not-allowed";if(B.x!==0&&I.lockSkewingY||B.y!==0&&I.lockSkewingX)return N;var M=x(I,B)%4;return d[M]+"-resize"}function H(V,B,I){return V[I.canvas.altActionKey]?r.skewCursorStyleHandler(V,B,I):r.scaleCursorStyleHandler(V,B,I)}function J(V,B,I){var N=V[I.canvas.altActionKey];if(B.x===0)return N?"skewX":"scaleY";if(B.y===0)return N?"skewY":"scaleX"}function q(V,B,I){return I.lockRotation?"not-allowed":B.cursorStyle}function Q(V,B,I,N){return{e:V,transform:B,pointer:{x:I,y:N}}}function te(V){return function(B,I,N,M){var U=I.target,$=U.getCenterPoint(),he=U.translateToOriginPoint($,I.originX,I.originY),ee=V(B,I,N,M);return U.setPositionByOrigin(he,I.originX,I.originY),ee}}function oe(V,B){return function(I,N,M,U){var $=B(I,N,M,U);return $&&C(V,Q(I,N,M,U)),$}}function ce(V,B,I,N,M){var U=V.target,$=U.controls[V.corner],he=U.canvas.getZoom(),ee=U.padding/he,W=U.toLocalPoint(new s.Point(N,M),B,I);return W.x>=ee&&(W.x-=ee),W.x<=-ee&&(W.x+=ee),W.y>=ee&&(W.y-=ee),W.y<=ee&&(W.y+=ee),W.x-=$.offsetX,W.y-=$.offsetY,W}function X(V){return V.flipX!==V.flipY}function _(V,B,I,N,M){if(V[B]!==0){var U=V._getTransformedDimensions()[N],$=M/U*V[I];V.set(I,$)}}function j(V,B,I,N){var M=B.target,U=M._getTransformedDimensions(0,M.skewY),$=ce(B,B.originX,B.originY,I,N),he=Math.abs($.x*2)-U.x,ee=M.skewX,W;he<2?W=0:(W=m(Math.atan2(he/M.scaleX,U.y/M.scaleY)),B.originX===a&&B.originY===g&&(W=-W),B.originX===l&&B.originY===i&&(W=-W),X(M)&&(W=-W));var re=ee!==W;if(re){var fe=M._getTransformedDimensions().y;M.set("skewX",W),_(M,"skewY","scaleY","y",fe)}return re}function A(V,B,I,N){var M=B.target,U=M._getTransformedDimensions(M.skewX,0),$=ce(B,B.originX,B.originY,I,N),he=Math.abs($.y*2)-U.y,ee=M.skewY,W;he<2?W=0:(W=m(Math.atan2(he/M.scaleY,U.x/M.scaleX)),B.originX===a&&B.originY===g&&(W=-W),B.originX===l&&B.originY===i&&(W=-W),X(M)&&(W=-W));var re=ee!==W;if(re){var fe=M._getTransformedDimensions().x;M.set("skewY",W),_(M,"skewX","scaleX","x",fe)}return re}function O(V,B,I,N){var M=B.target,U=M.skewX,$,he=B.originY;if(M.lockSkewingX)return!1;if(U===0){var ee=ce(B,o,o,I,N);ee.x>0?$=a:$=l}else U>0&&($=he===i?a:l),U<0&&($=he===i?l:a),X(M)&&($=$===a?l:a);B.originX=$;var W=oe("skewing",te(j));return W(V,B,I,N)}function z(V,B,I,N){var M=B.target,U=M.skewY,$,he=B.originX;if(M.lockSkewingY)return!1;if(U===0){var ee=ce(B,o,o,I,N);ee.y>0?$=i:$=g}else U>0&&($=he===a?i:g),U<0&&($=he===a?g:i),X(M)&&($=$===i?g:i);B.originY=$;var W=oe("skewing",te(A));return W(V,B,I,N)}function P(V,B,I,N){var M=B,U=M.target,$=U.translateToOriginPoint(U.getCenterPoint(),M.originX,M.originY);if(U.lockRotation)return!1;var he=Math.atan2(M.ey-$.y,M.ex-$.x),ee=Math.atan2(N-$.y,I-$.x),W=m(ee-he+M.theta),re=!0;if(U.snapAngle>0){var fe=U.snapAngle,pe=U.snapThreshold||fe,ae=Math.ceil(W/fe)*fe,ie=Math.floor(W/fe)*fe;Math.abs(W-ie)<pe?W=ie:Math.abs(W-ae)<pe&&(W=ae)}return W<0&&(W=360+W),W%=360,re=U.angle!==W,U.angle=W,re}function k(V,B,I,N,M){M=M||{};var U=B.target,$=U.lockScalingX,he=U.lockScalingY,ee=M.by,W,re,fe,pe,ae=b(V,U),ie=E(U,ee,ae),de,ge,Re=B.gestureScale;if(ie)return!1;if(Re)re=B.scaleX*Re,fe=B.scaleY*Re;else{if(W=ce(B,B.originX,B.originY,I,N),de=ee!=="y"?y(W.x):1,ge=ee!=="x"?y(W.y):1,B.signX||(B.signX=de),B.signY||(B.signY=ge),U.lockScalingFlip&&(B.signX!==de||B.signY!==ge))return!1;if(pe=U._getTransformedDimensions(),ae&&!ee){var Pt=Math.abs(W.x)+Math.abs(W.y),at=B.original,Ts=Math.abs(pe.x*at.scaleX/U.scaleX)+Math.abs(pe.y*at.scaleY/U.scaleY),nr=Pt/Ts;re=at.scaleX*nr,fe=at.scaleY*nr}else re=Math.abs(W.x*U.scaleX/pe.x),fe=Math.abs(W.y*U.scaleY/pe.y);T(B)&&(re*=2,fe*=2),B.signX!==de&&ee!=="y"&&(B.originX=f[B.originX],re*=-1,B.signX=de),B.signY!==ge&&ee!=="x"&&(B.originY=f[B.originY],fe*=-1,B.signY=ge)}var ks=U.scaleX,St=U.scaleY;return ee?(ee==="x"&&U.set("scaleX",re),ee==="y"&&U.set("scaleY",fe)):(!$&&U.set("scaleX",re),!he&&U.set("scaleY",fe)),ks!==U.scaleX||St!==U.scaleY}function D(V,B,I,N){return k(V,B,I,N)}function R(V,B,I,N){return k(V,B,I,N,{by:"x"})}function Y(V,B,I,N){return k(V,B,I,N,{by:"y"})}function G(V,B,I,N){return V[B.target.canvas.altActionKey]?r.skewHandlerX(V,B,I,N):r.scalingY(V,B,I,N)}function K(V,B,I,N){return V[B.target.canvas.altActionKey]?r.skewHandlerY(V,B,I,N):r.scalingX(V,B,I,N)}function Z(V,B,I,N){var M=B.target,U=ce(B,B.originX,B.originY,I,N),$=M.strokeWidth/(M.strokeUniform?M.scaleX:1),he=T(B)?2:1,ee=M.width,W=Math.abs(U.x*he/M.scaleX)-$;return M.set("width",Math.max(W,0)),ee!==W}function se(V,B,I,N){var M=B.target,U=I-B.offsetX,$=N-B.offsetY,he=!M.get("lockMovementX")&&M.left!==U,ee=!M.get("lockMovementY")&&M.top!==$;return he&&M.set("left",U),ee&&M.set("top",$),(he||ee)&&C("moving",Q(V,B,I,N)),he||ee}r.scaleCursorStyleHandler=L,r.skewCursorStyleHandler=F,r.scaleSkewCursorStyleHandler=H,r.rotationWithSnapping=oe("rotating",te(P)),r.scalingEqually=oe("scaling",te(D)),r.scalingX=oe("scaling",te(R)),r.scalingY=oe("scaling",te(Y)),r.scalingYOrSkewingX=G,r.scalingXOrSkewingY=K,r.changeWidth=oe("resizing",te(Z)),r.skewHandlerX=O,r.skewHandlerY=z,r.dragHandler=se,r.scaleOrSkewActionName=J,r.rotationStyleHandler=q,r.fireEvent=C,r.wrapWithFixedAnchor=te,r.wrapWithFireEvent=oe,r.getLocalPoint=ce,s.controlsUtils=r}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.degreesToRadians,d=s.controlsUtils;function r(i,l,g,o,f){o=o||{};var m=this.sizeX||o.cornerSize||f.cornerSize,y=this.sizeY||o.cornerSize||f.cornerSize,x=typeof o.transparentCorners<"u"?o.transparentCorners:f.transparentCorners,C=x?"stroke":"fill",b=!x&&(o.cornerStrokeColor||f.cornerStrokeColor),T=l,E=g,L;i.save(),i.fillStyle=o.cornerColor||f.cornerColor,i.strokeStyle=o.cornerStrokeColor||f.cornerStrokeColor,m>y?(L=m,i.scale(1,y/m),E=g*m/y):y>m?(L=y,i.scale(m/y,1),T=l*y/m):L=m,i.lineWidth=1,i.beginPath(),i.arc(T,E,L/2,0,2*Math.PI,!1),i[C](),b&&i.stroke(),i.restore()}function a(i,l,g,o,f){o=o||{};var m=this.sizeX||o.cornerSize||f.cornerSize,y=this.sizeY||o.cornerSize||f.cornerSize,x=typeof o.transparentCorners<"u"?o.transparentCorners:f.transparentCorners,C=x?"stroke":"fill",b=!x&&(o.cornerStrokeColor||f.cornerStrokeColor),T=m/2,E=y/2;i.save(),i.fillStyle=o.cornerColor||f.cornerColor,i.strokeStyle=o.cornerStrokeColor||f.cornerStrokeColor,i.lineWidth=1,i.translate(l,g),i.rotate(u(f.angle)),i[C+"Rect"](-T,-E,m,y),b&&i.strokeRect(-T,-E,m,y),i.restore()}d.renderCircleControl=r,d.renderSquareControl=a}(t),function(h){var s=h.fabric||(h.fabric={});function u(d){for(var r in d)this[r]=d[r]}s.Control=u,s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(d,r){return r.cursorStyle},getActionName:function(d,r){return r.actionName},getVisibility:function(d,r){var a=d._controlsVisibility;return a&&typeof a[r]<"u"?a[r]:this.visible},setVisibility:function(d){this.visible=d},positionHandler:function(d,r){var a=s.util.transformPoint({x:this.x*d.x+this.offsetX,y:this.y*d.y+this.offsetY},r);return a},calcCornerCoords:function(d,r,a,i,l){var g,o,f,m,y=l?this.touchSizeX:this.sizeX,x=l?this.touchSizeY:this.sizeY;if(y&&x&&y!==x){var C=Math.atan2(x,y),b=Math.sqrt(y*y+x*x)/2,T=C-s.util.degreesToRadians(d),E=Math.PI/2-C-s.util.degreesToRadians(d);g=b*s.util.cos(T),o=b*s.util.sin(T),f=b*s.util.cos(E),m=b*s.util.sin(E)}else{var L=y&&x?y:r;b=L*.7071067812;var T=s.util.degreesToRadians(45-d);g=f=b*s.util.cos(T),o=m=b*s.util.sin(T)}return{tl:{x:a-m,y:i-f},tr:{x:a+g,y:i-o},bl:{x:a-g,y:i+o},br:{x:a+m,y:i+f}}},render:function(d,r,a,i,l){switch(i=i||{},i.cornerStyle||l.cornerStyle){case"circle":s.controlsUtils.renderCircleControl.call(this,d,r,a,i,l);break;default:s.controlsUtils.renderSquareControl.call(this,d,r,a,i,l)}}}}(t),function(){function h(a,i){var l=a.getAttribute("style"),g=a.getAttribute("offset")||0,o,f,m,y;if(g=parseFloat(g)/(/%$/.test(g)?100:1),g=g<0?0:g>1?1:g,l){var x=l.split(/\s*;\s*/);for(x[x.length-1]===""&&x.pop(),y=x.length;y--;){var C=x[y].split(/\s*:\s*/),b=C[0].trim(),T=C[1].trim();b==="stop-color"?o=T:b==="stop-opacity"&&(m=T)}}return o||(o=a.getAttribute("stop-color")||"rgb(0,0,0)"),m||(m=a.getAttribute("stop-opacity")),o=new e.Color(o),f=o.getAlpha(),m=isNaN(parseFloat(m))?1:parseFloat(m),m*=f*i,{offset:g,color:o.toRgb(),opacity:m}}function s(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function u(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}var d=e.util.object.clone;e.Gradient=e.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var i,l=this;Object.keys(a).forEach(function(g){l[g]=a[g]}),this.id?this.id+="_"+e.Object.__uid++:this.id=e.Object.__uid++,i={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(i.r1=a.coords.r1||0,i.r2=a.coords.r2||0),this.coords=i,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var i in a){var l=new e.Color(a[i]);this.colorStops.push({offset:parseFloat(i),color:l.toRgb(),opacity:l.getAlpha()})}return this},toObject:function(a){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return e.util.populateWithProperties(this,i,a),i},toSVG:function(a,f){var l=d(this.coords,!0),g,o,f=f||{},m,y,x=d(this.colorStops,!0),C=l.r1>l.r2,b=this.gradientTransform?this.gradientTransform.concat():e.iMatrix.concat(),T=-this.offsetX,E=-this.offsetY,L=!!f.additionalTransform,F=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(x.sort(function(te,oe){return te.offset-oe.offset}),F==="objectBoundingBox"?(T/=a.width,E/=a.height):(T+=a.width/2,E+=a.height/2),a.type==="path"&&this.gradientUnits!=="percentage"&&(T-=a.pathOffset.x,E-=a.pathOffset.y),b[4]-=T,b[5]-=E,y='id="SVGID_'+this.id+'" gradientUnits="'+F+'"',y+=' gradientTransform="'+(L?f.additionalTransform+" ":"")+e.util.matrixToSVG(b)+'" ',this.type==="linear"?m=["<linearGradient ",y,' x1="',l.x1,'" y1="',l.y1,'" x2="',l.x2,'" y2="',l.y2,`">
`]:this.type==="radial"&&(m=["<radialGradient ",y,' cx="',C?l.x1:l.x2,'" cy="',C?l.y1:l.y2,'" r="',C?l.r1:l.r2,'" fx="',C?l.x2:l.x1,'" fy="',C?l.y2:l.y1,`">
`]),this.type==="radial"){if(C)for(x=x.concat(),x.reverse(),g=0,o=x.length;g<o;g++)x[g].offset=1-x[g].offset;var H=Math.min(l.r1,l.r2);if(H>0){var J=Math.max(l.r1,l.r2),q=H/J;for(g=0,o=x.length;g<o;g++)x[g].offset+=q*(1-x[g].offset)}}for(g=0,o=x.length;g<o;g++){var Q=x[g];m.push("<stop ",'offset="',Q.offset*100+"%",'" style="stop-color:',Q.color,typeof Q.opacity<"u"?";stop-opacity: "+Q.opacity:";",`"/>
`)}return m.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),m.join("")},toLive:function(a){var i,l=e.util.object.clone(this.coords),g,o;if(this.type){for(this.type==="linear"?i=a.createLinearGradient(l.x1,l.y1,l.x2,l.y2):this.type==="radial"&&(i=a.createRadialGradient(l.x1,l.y1,l.r1,l.x2,l.y2,l.r2)),g=0,o=this.colorStops.length;g<o;g++){var f=this.colorStops[g].color,m=this.colorStops[g].opacity,y=this.colorStops[g].offset;typeof m<"u"&&(f=new e.Color(f).setAlpha(m).toRgba()),i.addColorStop(y,f)}return i}}}),e.util.object.extend(e.Gradient,{fromElement:function(a,i,l,g){var o=parseFloat(l)/(/%$/.test(l)?100:1);o=o<0?0:o>1?1:o,isNaN(o)&&(o=1);var f=a.getElementsByTagName("stop"),m,y=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",x=a.getAttribute("gradientTransform")||"",C=[],b,T,E=0,L=0,F;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(m="linear",b=s(a)):(m="radial",b=u(a)),T=f.length;T--;)C.push(h(f[T],o));F=e.parseTransformAttribute(x),r(i,b,g,y),y==="pixels"&&(E=-i.left,L=-i.top);var H=new e.Gradient({id:a.getAttribute("id"),type:m,coords:b,colorStops:C,gradientUnits:y,gradientTransform:F,offsetX:E,offsetY:L});return H}});function r(a,i,l,g){var o,f;Object.keys(i).forEach(function(m){o=i[m],o==="Infinity"?f=1:o==="-Infinity"?f=0:(f=parseFloat(i[m],10),typeof o=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(o)&&(f*=.01,g==="pixels"&&((m==="x1"||m==="x2"||m==="r2")&&(f*=l.viewBoxWidth||l.width),(m==="y1"||m==="y2")&&(f*=l.viewBoxHeight||l.height)))),i[m]=f})}}(),function(){var h=e.util.toFixed;e.Pattern=e.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,u){if(s||(s={}),this.id=e.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string"){u&&u(this);return}else{var d=this;this.source=e.util.createImage(),e.util.loadImage(s.source,function(r,a){d.source=r,u&&u(d,a)},null,this.crossOrigin)}},toObject:function(s){var u=e.Object.NUM_FRACTION_DIGITS,d,r;return typeof this.source.src=="string"?d=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(d=this.source.toDataURL()),r={type:"pattern",source:d,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:h(this.offsetX,u),offsetY:h(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},e.util.populateWithProperties(this,r,s),r},toSVG:function(s){var u=typeof this.source=="function"?this.source():this.source,d=u.width/s.width,r=u.height/s.height,a=this.offsetX/s.width,i=this.offsetY/s.height,l="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,i&&(r+=Math.abs(i))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(d=1,a&&(d+=Math.abs(a))),u.src?l=u.src:u.toDataURL&&(l=u.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+i+'" width="'+d+'" height="'+r+`">
<image x="0" y="0" width="`+u.width+'" height="'+u.height+'" xlink:href="'+l+`"></image>
</pattern>
`},setOptions:function(s){for(var u in s)this[u]=s[u]},toLive:function(s){var u=this.source;return!u||typeof u.src<"u"&&(!u.complete||u.naturalWidth===0||u.naturalHeight===0)?"":s.createPattern(u,this.repeat)}})}(),function(h){var s=h.fabric||(h.fabric={}),u=s.util.toFixed;if(s.Shadow){s.warn("fabric.Shadow is already defined.");return}s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(d){typeof d=="string"&&(d=this._parseShadow(d));for(var r in d)this[r]=d[r];this.id=s.Object.__uid++},_parseShadow:function(d){var r=d.trim(),a=s.Shadow.reOffsetsAndBlur.exec(r)||[],i=r.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseFloat(a[1],10)||0,offsetY:parseFloat(a[2],10)||0,blur:parseFloat(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(d){var r=40,a=40,i=s.Object.NUM_FRACTION_DIGITS,l=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-d.angle)),g=20,o=new s.Color(this.color);return d.width&&d.height&&(r=u((Math.abs(l.x)+this.blur)/d.width,i)*100+g,a=u((Math.abs(l.y)+this.blur)/d.height,i)*100+g),d.flipX&&(l.x*=-1),d.flipY&&(l.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+u(this.blur?this.blur/2:0,i)+`"></feGaussianBlur>
	<feOffset dx="`+u(l.x,i)+'" dy="'+u(l.y,i)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+o.toRgb()+'" flood-opacity="'+o.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var d={},r=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(a){this[a]!==r[a]&&(d[a]=this[a])},this),d}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(t),function(){if(e.StaticCanvas){e.warn("fabric.StaticCanvas is already defined.");return}var h=e.util.object.extend,s=e.util.getElementOffset,u=e.util.removeFromArray,d=e.util.toFixed,r=e.util.transformPoint,a=e.util.invertTransform,i=e.util.getNodeCanvas,l=e.util.createCanvasElement,g=new Error("Could not initialize `canvas` element");e.StaticCanvas=e.util.createClass(e.CommonMethods,{initialize:function(o,f){f||(f={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,f)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:e.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(o,f){var m=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(o),this._initOptions(f),this.interactive||this._initRetinaScaling(),f.overlayImage&&this.setOverlayImage(f.overlayImage,m),f.backgroundImage&&this.setBackgroundImage(f.backgroundImage,m),f.backgroundColor&&this.setBackgroundColor(f.backgroundColor,m),f.overlayColor&&this.setOverlayColor(f.overlayColor,m),this.calcOffset()},_isRetinaScaling:function(){return e.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,e.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var o=e.devicePixelRatio;this.__initRetinaScaling(o,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(o,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(o,f,m){f.setAttribute("width",this.width*o),f.setAttribute("height",this.height*o),m.scale(o,o)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(o,f,m){return this.__setBgOverlayImage("overlayImage",o,f,m)},setBackgroundImage:function(o,f,m){return this.__setBgOverlayImage("backgroundImage",o,f,m)},setOverlayColor:function(o,f){return this.__setBgOverlayColor("overlayColor",o,f)},setBackgroundColor:function(o,f){return this.__setBgOverlayColor("backgroundColor",o,f)},__setBgOverlayImage:function(o,f,m,y){return typeof f=="string"?e.util.loadImage(f,function(x,C){if(x){var b=new e.Image(x,y);this[o]=b,b.canvas=this}m&&m(x,C)},this,y&&y.crossOrigin):(y&&f.setOptions(y),this[o]=f,f&&(f.canvas=this),m&&m(f,!1)),this},__setBgOverlayColor:function(o,f,m){return this[o]=f,this._initGradient(f,o),this._initPattern(f,o,m),this},_createCanvasElement:function(){var o=l();if(!o||(o.style||(o.style={}),typeof o.getContext>"u"))throw g;return o},_initOptions:function(o){var f=this.lowerCanvasEl;this._setOptions(o),this.width=this.width||parseInt(f.width,10)||0,this.height=this.height||parseInt(f.height,10)||0,this.lowerCanvasEl.style&&(f.width=this.width,f.height=this.height,f.style.width=this.width+"px",f.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(o){o&&o.getContext?this.lowerCanvasEl=o:this.lowerCanvasEl=e.util.getById(o)||this._createCanvasElement(),e.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(o,f){return this.setDimensions({width:o},f)},setHeight:function(o,f){return this.setDimensions({height:o},f)},setDimensions:function(o,f){var m;f=f||{};for(var y in o)m=o[y],f.cssOnly||(this._setBackstoreDimension(y,o[y]),m+="px",this.hasLostContext=!0),f.backstoreOnly||this._setCssDimension(y,m);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),f.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(o,f){return this.lowerCanvasEl[o]=f,this.upperCanvasEl&&(this.upperCanvasEl[o]=f),this.cacheCanvasEl&&(this.cacheCanvasEl[o]=f),this[o]=f,this},_setCssDimension:function(o,f){return this.lowerCanvasEl.style[o]=f,this.upperCanvasEl&&(this.upperCanvasEl.style[o]=f),this.wrapperEl&&(this.wrapperEl.style[o]=f),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(o){var f=this._activeObject,m=this.backgroundImage,y=this.overlayImage,x,C,b;for(this.viewportTransform=o,C=0,b=this._objects.length;C<b;C++)x=this._objects[C],x.group||x.setCoords(!0);return f&&f.setCoords(),m&&m.setCoords(!0),y&&y.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(o,f){var m=o,y=this.viewportTransform.slice(0);o=r(o,a(this.viewportTransform)),y[0]=f,y[3]=f;var x=r(o,y);return y[4]+=m.x-x.x,y[5]+=m.y-x.y,this.setViewportTransform(y)},setZoom:function(o){return this.zoomToPoint(new e.Point(0,0),o),this},absolutePan:function(o){var f=this.viewportTransform.slice(0);return f[4]=-o.x,f[5]=-o.y,this.setViewportTransform(f)},relativePan:function(o){return this.absolutePan(new e.Point(-o.x-this.viewportTransform[4],-o.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(o){this.stateful&&o.setupState(),o._set("canvas",this),o.setCoords(),this.fire("object:added",{target:o}),o.fire("added")},_onObjectRemoved:function(o){this.fire("object:removed",{target:o}),o.fire("removed"),delete o.canvas},clearContext:function(o){return o.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var o=this.contextContainer;return this.renderCanvas(o,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=e.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var o={},f=this.width,m=this.height,y=a(this.viewportTransform);return o.tl=r({x:0,y:0},y),o.br=r({x:f,y:m},y),o.tr=new e.Point(o.br.x,o.tl.y),o.bl=new e.Point(o.tl.x,o.br.y),this.vptCoords=o,o},cancelRequestedRender:function(){this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(o,f){var m=this.viewportTransform,y=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(o),e.util.setImageSmoothing(o,this.imageSmoothingEnabled),this.fire("before:render",{ctx:o}),this._renderBackground(o),o.save(),o.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._renderObjects(o,f),o.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(o),y&&(y.canvas=this,y.shouldCache(),y._transformDone=!0,y.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(o)),this._renderOverlay(o),this.controlsAboveOverlay&&this.interactive&&this.drawControls(o),this.fire("after:render",{ctx:o})},drawClipPathOnCanvas:function(o){var f=this.viewportTransform,m=this.clipPath;o.save(),o.transform(f[0],f[1],f[2],f[3],f[4],f[5]),o.globalCompositeOperation="destination-in",m.transform(o),o.scale(1/m.zoomX,1/m.zoomY),o.drawImage(m._cacheCanvas,-m.cacheTranslationX,-m.cacheTranslationY),o.restore()},_renderObjects:function(o,f){var m,y;for(m=0,y=f.length;m<y;++m)f[m]&&f[m].render(o)},_renderBackgroundOrOverlay:function(o,f){var m=this[f+"Color"],y=this[f+"Image"],x=this.viewportTransform,C=this[f+"Vpt"];if(!(!m&&!y)){if(m){o.save(),o.beginPath(),o.moveTo(0,0),o.lineTo(this.width,0),o.lineTo(this.width,this.height),o.lineTo(0,this.height),o.closePath(),o.fillStyle=m.toLive?m.toLive(o,this):m,C&&o.transform(x[0],x[1],x[2],x[3],x[4],x[5]),o.transform(1,0,0,1,m.offsetX||0,m.offsetY||0);var b=m.gradientTransform||m.patternTransform;b&&o.transform(b[0],b[1],b[2],b[3],b[4],b[5]),o.fill(),o.restore()}if(y){o.save();var T=this.skipOffscreen;this.skipOffscreen=C,C&&o.transform(x[0],x[1],x[2],x[3],x[4],x[5]),y.render(o),this.skipOffscreen=T,o.restore()}}},_renderBackground:function(o){this._renderBackgroundOrOverlay(o,"background")},_renderOverlay:function(o){this._renderBackgroundOrOverlay(o,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new e.Point(this.width/2,this.height/2)},centerObjectH:function(o){return this._centerObject(o,new e.Point(this.getCenterPoint().x,o.getCenterPoint().y))},centerObjectV:function(o){return this._centerObject(o,new e.Point(o.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(o){var f=this.getCenterPoint();return this._centerObject(o,f)},viewportCenterObject:function(o){var f=this.getVpCenter();return this._centerObject(o,f)},viewportCenterObjectH:function(o){var f=this.getVpCenter();return this._centerObject(o,new e.Point(f.x,o.getCenterPoint().y)),this},viewportCenterObjectV:function(o){var f=this.getVpCenter();return this._centerObject(o,new e.Point(o.getCenterPoint().x,f.y))},getVpCenter:function(){var o=this.getCenterPoint(),f=a(this.viewportTransform);return r(o,f)},_centerObject:function(o,f){return o.setPositionByOrigin(f,"center","center"),o.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(o){return this.toDatalessObject(o)},toObject:function(o){return this._toObjectMethod("toObject",o)},toDatalessObject:function(o){return this._toObjectMethod("toDatalessObject",o)},_toObjectMethod:function(o,f){var m=this.clipPath,y={version:e.version,objects:this._toObjects(o,f)};return m&&!m.excludeFromExport&&(y.clipPath=this._toObject(this.clipPath,o,f)),h(y,this.__serializeBgOverlay(o,f)),e.util.populateWithProperties(this,y,f),y},_toObjects:function(o,f){return this._objects.filter(function(m){return!m.excludeFromExport}).map(function(m){return this._toObject(m,o,f)},this)},_toObject:function(o,f,m){var y;this.includeDefaultValues||(y=o.includeDefaultValues,o.includeDefaultValues=!1);var x=o[f](m);return this.includeDefaultValues||(o.includeDefaultValues=y),x},__serializeBgOverlay:function(o,f){var m={},y=this.backgroundImage,x=this.overlayImage,C=this.backgroundColor,b=this.overlayColor;return C&&C.toObject?C.excludeFromExport||(m.background=C.toObject(f)):C&&(m.background=C),b&&b.toObject?b.excludeFromExport||(m.overlay=b.toObject(f)):b&&(m.overlay=b),y&&!y.excludeFromExport&&(m.backgroundImage=this._toObject(y,o,f)),x&&!x.excludeFromExport&&(m.overlayImage=this._toObject(x,o,f)),m},svgViewportTransformation:!0,toSVG:function(o,f){o||(o={}),o.reviver=f;var m=[];return this._setSVGPreamble(m,o),this._setSVGHeader(m,o),this.clipPath&&m.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(m,"background"),this._setSVGBgOverlayImage(m,"backgroundImage",f),this._setSVGObjects(m,f),this.clipPath&&m.push(`</g>
`),this._setSVGBgOverlayColor(m,"overlay"),this._setSVGBgOverlayImage(m,"overlayImage",f),m.push("</svg>"),m.join("")},_setSVGPreamble:function(o,f){f.suppressPreamble||o.push('<?xml version="1.0" encoding="',f.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(o,f){var m=f.width||this.width,y=f.height||this.height,x,C='viewBox="0 0 '+this.width+" "+this.height+'" ',b=e.Object.NUM_FRACTION_DIGITS;f.viewBox?C='viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+f.viewBox.height+'" ':this.svgViewportTransformation&&(x=this.viewportTransform,C='viewBox="'+d(-x[4]/x[0],b)+" "+d(-x[5]/x[3],b)+" "+d(this.width/x[0],b)+" "+d(this.height/x[3],b)+'" '),o.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',m,'" ','height="',y,'" ',C,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",e.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(f),`</defs>
`)},createSVGClipPathMarkup:function(o){var f=this.clipPath;return f?(f.clipPathId="CLIPPATH_"+e.Object.__uid++,'<clipPath id="'+f.clipPathId+`" >
`+this.clipPath.toClipPathSVG(o.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var o=this,f=["background","overlay"].map(function(m){var y=o[m+"Color"];if(y&&y.toLive){var x=o[m+"Vpt"],C=o.viewportTransform,b={width:o.width/(x?C[0]:1),height:o.height/(x?C[3]:1)};return y.toSVG(b,{additionalTransform:x?e.util.matrixToSVG(C):""})}});return f.join("")},createSVGFontFacesMarkup:function(){var o="",f={},m,y,x,C,b,T,E,L,F,H=e.fontPaths,J=[];for(this._objects.forEach(function Q(te){J.push(te),te._objects&&te._objects.forEach(Q)}),L=0,F=J.length;L<F;L++)if(m=J[L],y=m.fontFamily,!(m.type.indexOf("text")===-1||f[y]||!H[y])&&(f[y]=!0,!!m.styles)){x=m.styles;for(b in x){C=x[b];for(E in C)T=C[E],y=T.fontFamily,!f[y]&&H[y]&&(f[y]=!0)}}for(var q in f)o+=[`		@font-face {
`,"			font-family: '",q,`';
`,"			src: url('",H[q],`');
`,`		}
`].join("");return o&&(o=['	<style type="text/css">',`<![CDATA[
`,o,"]]>",`</style>
`].join("")),o},_setSVGObjects:function(o,f){var m,y,x,C=this._objects;for(y=0,x=C.length;y<x;y++)m=C[y],!m.excludeFromExport&&this._setSVGObject(o,m,f)},_setSVGObject:function(o,f,m){o.push(f.toSVG(m))},_setSVGBgOverlayImage:function(o,f,m){this[f]&&!this[f].excludeFromExport&&this[f].toSVG&&o.push(this[f].toSVG(m))},_setSVGBgOverlayColor:function(o,f){var m=this[f+"Color"],y=this.viewportTransform,x=this.width,C=this.height;if(m)if(m.toLive){var b=m.repeat,T=e.util.invertTransform(y),E=this[f+"Vpt"],L=E?e.util.matrixToSVG(T):"";o.push('<rect transform="'+L+" translate(",x/2,",",C/2,')"',' x="',m.offsetX-x/2,'" y="',m.offsetY-C/2,'" ','width="',b==="repeat-y"||b==="no-repeat"?m.source.width:x,'" height="',b==="repeat-x"||b==="no-repeat"?m.source.height:C,'" fill="url(#SVGID_'+m.id+')"',`></rect>
`)}else o.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',m,'"',`></rect>
`)},sendToBack:function(o){if(!o)return this;var f=this._activeObject,m,y,x;if(o===f&&o.type==="activeSelection")for(x=f._objects,m=x.length;m--;)y=x[m],u(this._objects,y),this._objects.unshift(y);else u(this._objects,o),this._objects.unshift(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(o){if(!o)return this;var f=this._activeObject,m,y,x;if(o===f&&o.type==="activeSelection")for(x=f._objects,m=0;m<x.length;m++)y=x[m],u(this._objects,y),this._objects.push(y);else u(this._objects,o),this._objects.push(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(o,f){if(!o)return this;var m=this._activeObject,y,x,C,b,T,E=0;if(o===m&&o.type==="activeSelection")for(T=m._objects,y=0;y<T.length;y++)x=T[y],C=this._objects.indexOf(x),C>0+E&&(b=C-1,u(this._objects,x),this._objects.splice(b,0,x)),E++;else C=this._objects.indexOf(o),C!==0&&(b=this._findNewLowerIndex(o,C,f),u(this._objects,o),this._objects.splice(b,0,o));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(o,f,m){var y,x;if(m)for(y=f,x=f-1;x>=0;--x){var C=o.intersectsWithObject(this._objects[x])||o.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(o);if(C){y=x;break}}else y=f-1;return y},bringForward:function(o,f){if(!o)return this;var m=this._activeObject,y,x,C,b,T,E=0;if(o===m&&o.type==="activeSelection")for(T=m._objects,y=T.length;y--;)x=T[y],C=this._objects.indexOf(x),C<this._objects.length-1-E&&(b=C+1,u(this._objects,x),this._objects.splice(b,0,x)),E++;else C=this._objects.indexOf(o),C!==this._objects.length-1&&(b=this._findNewUpperIndex(o,C,f),u(this._objects,o),this._objects.splice(b,0,o));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(o,f,m){var y,x,C;if(m)for(y=f,x=f+1,C=this._objects.length;x<C;++x){var b=o.intersectsWithObject(this._objects[x])||o.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(o);if(b){y=x;break}}else y=f+1;return y},moveTo:function(o,f){return u(this._objects,o),this._objects.splice(f,0,o),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(o){o.dispose&&o.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),e.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),e.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),h(e.StaticCanvas.prototype,e.Observable),h(e.StaticCanvas.prototype,e.Collection),h(e.StaticCanvas.prototype,e.DataURLExporter),h(e.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(o){var f=l();if(!f||!f.getContext)return null;var m=f.getContext("2d");if(!m)return null;switch(o){case"setLineDash":return typeof m.setLineDash<"u";default:return null}}}),e.StaticCanvas.prototype.toJSON=e.StaticCanvas.prototype.toObject,e.isLikelyNode&&(e.StaticCanvas.prototype.createPNGStream=function(){var o=i(this.lowerCanvasEl);return o&&o.createPNGStream()},e.StaticCanvas.prototype.createJPEGStream=function(o){var f=i(this.lowerCanvasEl);return f&&f.createJPEGStream(o)})}(),e.BaseBrush=e.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(h){h.strokeStyle=this.color,h.lineWidth=this.width,h.lineCap=this.strokeLineCap,h.miterLimit=this.strokeMiterLimit,h.lineJoin=this.strokeLineJoin,h.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(h){var s=this.canvas.viewportTransform;h.save(),h.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var h=this.canvas,s=this.shadow,u=h.contextTop,d=h.getZoom();h&&h._isRetinaScaling()&&(d*=e.devicePixelRatio),u.shadowColor=s.color,u.shadowBlur=s.blur*d,u.shadowOffsetX=s.offsetX*d,u.shadowOffsetY=s.offsetY*d}},needsFullRender:function(){var h=new e.Color(this.color);return h.getAlpha()<1||!!this.shadow},_resetShadow:function(){var h=this.canvas.contextTop;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_isOutSideCanvas:function(h){return h.x<0||h.x>this.canvas.getWidth()||h.y<0||h.y>this.canvas.getHeight()}}),function(){e.PencilBrush=e.util.createClass(e.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(h){this.canvas=h,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(h,s,u){var d=s.midPointFrom(u);return h.quadraticCurveTo(s.x,s.y,d.x,d.y),d},onMouseDown:function(h,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(h),this._captureDrawingPath(h),this._render())},onMouseMove:function(h,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h))&&this._captureDrawingPath(h)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var u=this._points,d=u.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,u[d-2],u[d-1],!0),r.stroke(),r.restore()}},onMouseUp:function(h){return this.canvas._isMainEvent(h.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(h){var s=new e.Point(h.x,h.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(h){return this._points.length>1&&h.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(h),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(h){var s=new e.Point(h.x,h.y);return this._addPoint(s)},_render:function(h){var s,u,d=this._points[0],r=this._points[1];if(h=h||this.canvas.contextTop,this._saveAndTransform(h),h.beginPath(),this._points.length===2&&d.x===r.x&&d.y===r.y){var a=this.width/1e3;d=new e.Point(d.x,d.y),r=new e.Point(r.x,r.y),d.x-=a,r.x+=a}for(h.moveTo(d.x,d.y),s=1,u=this._points.length;s<u;s++)this._drawSegment(h,d,r),d=this._points[s],r=this._points[s+1];h.lineTo(d.x,d.y),h.stroke(),h.restore()},convertPointsToSVGPath:function(h){var s=this.width/1e3;return e.util.getSmoothPathFromPoints(h,s)},_isEmptySVGPath:function(h){var s=e.util.joinPath(h);return s==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(h){var s=new e.Path(h,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new e.Shadow(this.shadow)),s},decimatePoints:function(h,s){if(h.length<=2)return h;var u=this.canvas.getZoom(),d=Math.pow(s/u,2),r,a=h.length-1,i=h[0],l=[i],g;for(r=1;r<a-1;r++)g=Math.pow(i.x-h[r].x,2)+Math.pow(i.y-h[r].y,2),g>=d&&(i=h[r],l.push(i));return l.push(h[a]),l},_finalizeAndAddPath:function(){var h=this.canvas.contextTop;h.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s)){this.canvas.requestRenderAll();return}var u=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.requestRenderAll(),u.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:u})}})}(),e.CircleBrush=e.util.createClass(e.BaseBrush,{width:10,initialize:function(h){this.canvas=h,this.points=[]},drawDot:function(h){var s=this.addPoint(h),u=this.canvas.contextTop;this._saveAndTransform(u),this.dot(u,s),u.restore()},dot:function(h,s){h.fillStyle=s.fill,h.beginPath(),h.arc(s.x,s.y,s.radius,0,Math.PI*2,!1),h.closePath(),h.fill()},onMouseDown:function(h){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(h)},_render:function(){var h=this.canvas.contextTop,s,u,d=this.points;for(this._saveAndTransform(h),s=0,u=d.length;s<u;s++)this.dot(h,d[s]);h.restore()},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(h),this._render()):this.drawDot(h))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove,s,u;this.canvas.renderOnAddRemove=!1;var d=[];for(s=0,u=this.points.length;s<u;s++){var r=this.points[s],a=new e.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(a.shadow=new e.Shadow(this.shadow)),d.push(a)}var i=new e.Group(d);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},addPoint:function(h){var s=new e.Point(h.x,h.y),u=e.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new e.Color(this.color).setAlpha(e.util.getRandomInt(0,100)/100).toRgba();return s.radius=u,s.fill=d,this.points.push(s),s}}),e.SprayBrush=e.util.createClass(e.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(h){this.canvas=h,this.sprayChunks=[]},onMouseDown:function(h){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(h),this.render(this.sprayChunkPoints)},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.addSprayChunk(h),this.render(this.sprayChunkPoints))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],u=0,d=this.sprayChunks.length;u<d;u++)for(var r=this.sprayChunks[u],a=0,i=r.length;a<i;a++){var l=new e.Rect({width:r[a].width,height:r[a].width,left:r[a].x+1,top:r[a].y+1,originX:"center",originY:"center",fill:this.color});s.push(l)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var g=new e.Group(s);this.shadow&&g.set("shadow",new e.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:g}),this.canvas.add(g),this.canvas.fire("path:created",{path:g}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},_getOptimizedRects:function(h){var s={},u,d,r;for(d=0,r=h.length;d<r;d++)u=h[d].left+""+h[d].top,s[u]||(s[u]=h[d]);var a=[];for(u in s)a.push(s[u]);return a},render:function(h){var s=this.canvas.contextTop,u,d;for(s.fillStyle=this.color,this._saveAndTransform(s),u=0,d=h.length;u<d;u++){var r=h[u];typeof r.opacity<"u"&&(s.globalAlpha=r.opacity),s.fillRect(r.x,r.y,r.width,r.width)}s.restore()},_render:function(){var h=this.canvas.contextTop,s,u;for(h.fillStyle=this.color,this._saveAndTransform(h),s=0,u=this.sprayChunks.length;s<u;s++)this.render(this.sprayChunks[s]);h.restore()},addSprayChunk:function(h){this.sprayChunkPoints=[];var s,u,d,r=this.width/2,a;for(a=0;a<this.density;a++){s=e.util.getRandomInt(h.x-r,h.x+r),u=e.util.getRandomInt(h.y-r,h.y+r),this.dotWidthVariance?d=e.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):d=this.dotWidth;var i=new e.Point(s,u);i.width=d,this.randomOpacity&&(i.opacity=e.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),e.PatternBrush=e.util.createClass(e.PencilBrush,{getPatternSrc:function(){var h=20,s=5,u=e.util.createCanvasElement(),d=u.getContext("2d");return u.width=u.height=h+s,d.fillStyle=this.color,d.beginPath(),d.arc(h/2,h/2,h/2,0,Math.PI*2,!1),d.closePath(),d.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(h){return h.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(h){this.callSuper("_setBrushStyles",h),h.strokeStyle=this.getPattern(h)},createPath:function(h){var s=this.callSuper("createPath",h),u=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new e.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-u.x,offsetY:-u.y}),s}}),function(){var h=e.util.getPointer,s=e.util.degreesToRadians,u=e.util.isTouchEvent;e.Canvas=e.util.createClass(e.StaticCanvas,{initialize:function(r,a){a||(a={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,a),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=e.PencilBrush&&new e.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),a,i,l;if(r.length>0&&!this.preserveObjectStacking){i=[],l=[];for(var g=0,o=this._objects.length;g<o;g++)a=this._objects[g],r.indexOf(a)===-1?i.push(a):l.push(a);r.length>1&&(this._activeObject._objects=l),i.push.apply(i,l)}else i=this._objects;return i},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,a){var i=r.calcTransformMatrix(),l=e.util.invertTransform(i),g=this.restorePointerVpt(a);return e.util.transformPoint(g,l)},isTargetTransparent:function(r,a,i){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var l=this._normalizePointer(r,{x:a,y:i}),g=Math.max(r.cacheTranslationX+l.x*r.zoomX,0),o=Math.max(r.cacheTranslationY+l.y*r.zoomY,0),x=e.util.isTransparent(r._cacheContext,Math.round(g),Math.round(o),this.targetFindTolerance);return x}var f=this.contextCache,m=r.selectionBackgroundColor,y=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(f),f.save(),f.transform(y[0],y[1],y[2],y[3],y[4],y[5]),r.render(f),f.restore(),r.selectionBackgroundColor=m;var x=e.util.isTransparent(f,a,i,this.targetFindTolerance);return x},_isSelectionKeyPressed:function(r){var a=!1;return Array.isArray(this.selectionKey)?a=!!this.selectionKey.find(function(i){return r[i]===!0}):a=r[this.selectionKey],a},_shouldClearSelection:function(r,a){var i=this.getActiveObjects(),l=this._activeObject;return!a||a&&l&&i.length>1&&i.indexOf(a)===-1&&l!==a&&!this._isSelectionKeyPressed(r)||a&&!a.evented||a&&!a.selectable&&l&&l!==a},_shouldCenterTransform:function(r,a,i){if(r){var l;return a==="scale"||a==="scaleX"||a==="scaleY"||a==="resizing"?l=this.centeredScaling||r.centeredScaling:a==="rotate"&&(l=this.centeredRotation||r.centeredRotation),l?!i:i}},_getOriginFromCorner:function(r,a){var i={x:r.originX,y:r.originY};return a==="ml"||a==="tl"||a==="bl"?i.x="right":(a==="mr"||a==="tr"||a==="br")&&(i.x="left"),a==="tl"||a==="mt"||a==="tr"?i.y="bottom":(a==="bl"||a==="mb"||a==="br")&&(i.y="top"),i},_getActionFromCorner:function(r,a,i,l){if(!a||!r)return"drag";var g=l.controls[a];return g.getActionName(i,g,l)},_setupCurrentTransform:function(r,a,i){if(a){var l=this.getPointer(r),g=a.__corner,o=a.controls[g],f=i&&g?o.getActionHandler(r,a,o):e.controlsUtils.dragHandler,m=this._getActionFromCorner(i,g,r,a),y=this._getOriginFromCorner(a,g),x=r[this.centeredKey],C={target:a,action:m,actionHandler:f,corner:g,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,offsetX:l.x-a.left,offsetY:l.y-a.top,originX:y.x,originY:y.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,theta:s(a.angle),width:a.width*a.scaleX,shiftKey:r.shiftKey,altKey:x,original:e.util.saveObjectTransform(a)};this._shouldCenterTransform(a,m,x)&&(C.originX="center",C.originY="center"),C.original.originX=y.x,C.original.originY=y.y,this._currentTransform=C,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var a=this._groupSelector,i=new e.Point(a.ex,a.ey),l=e.util.transformPoint(i,this.viewportTransform),g=new e.Point(a.ex+a.left,a.ey+a.top),o=e.util.transformPoint(g,this.viewportTransform),f=Math.min(l.x,o.x),m=Math.min(l.y,o.y),y=Math.max(l.x,o.x),x=Math.max(l.y,o.y),C=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(f,m,y-f,x-m)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,f+=C,m+=C,y-=C,x-=C,e.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(f,m,y-f,x-m))},findTarget:function(r,a){if(!this.skipTargetFind){var i=!0,l=this.getPointer(r,i),g=this._activeObject,o=this.getActiveObjects(),f,m,y=u(r),x=o.length>1&&!a||o.length===1;if(this.targets=[],x&&g._findTargetCorner(l,y)||o.length>1&&!a&&g===this._searchPossibleTargets([g],l))return g;if(o.length===1&&g===this._searchPossibleTargets([g],l))if(this.preserveObjectStacking)f=g,m=this.targets,this.targets=[];else return g;var C=this._searchPossibleTargets(this._objects,l);return r[this.altSelectionKey]&&C&&f&&C!==f&&(C=f,this.targets=m),C}},_checkTarget:function(r,a,i){if(a&&a.visible&&a.evented&&a.containsPoint(r))if((this.perPixelTargetFind||a.perPixelTargetFind)&&!a.isEditing){var l=this.isTargetTransparent(a,i.x,i.y);if(!l)return!0}else return!0},_searchPossibleTargets:function(r,a){for(var i,l=r.length,g;l--;){var o=r[l],f=o.group?this._normalizePointer(o.group,a):a;if(this._checkTarget(f,o,a)){i=r[l],i.subTargetCheck&&i instanceof e.Group&&(g=this._searchPossibleTargets(i._objects,a),g&&this.targets.push(g));break}}return i},restorePointerVpt:function(r){return e.util.transformPoint(r,e.util.invertTransform(this.viewportTransform))},getPointer:function(r,a){if(this._absolutePointer&&!a)return this._absolutePointer;if(this._pointer&&a)return this._pointer;var i=h(r),l=this.upperCanvasEl,g=l.getBoundingClientRect(),o=g.width||0,f=g.height||0,m;(!o||!f)&&("top"in g&&"bottom"in g&&(f=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(o=Math.abs(g.right-g.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,a||(i=this.restorePointerVpt(i));var y=this.getRetinaScaling();return y!==1&&(i.x/=y,i.y/=y),o===0||f===0?m={width:1,height:1}:m={width:l.width/o,height:l.height/f},{x:i.x*m.width,y:i.y*m.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),a=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),e.util.addClass(i,"upper-canvas "+r),this.wrapperEl.appendChild(i),this._copyCanvasStyle(a,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=e.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),e.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),e.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var a=this.width||r.width,i=this.height||r.height;e.util.setStyle(r,{position:"absolute",width:a+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=a,r.height=i,e.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,a){a.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,a){var i=!1,l=this.getActiveObjects(),g=[],o=[];r.forEach(function(f){l.indexOf(f)===-1&&(i=!0,f.fire("deselected",{e:a,target:f}),o.push(f))}),l.forEach(function(f){r.indexOf(f)===-1&&(i=!0,f.fire("selected",{e:a,target:f}),g.push(f))}),r.length>0&&l.length>0?i&&this.fire("selection:updated",{e:a,selected:g,deselected:o}):l.length>0?this.fire("selection:created",{e:a,selected:g}):r.length>0&&this.fire("selection:cleared",{e:a,deselected:o})},setActiveObject:function(r,a){var i=this.getActiveObjects();return this._setActiveObject(r,a),this._fireSelectionEvents(i,a),this},_setActiveObject:function(r,a){return this._activeObject===r||!this._discardActiveObject(a,r)||r.onSelect({e:a})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,a){var i=this._activeObject;if(i){if(i.onDeselect({e:r,object:a}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var a=this.getActiveObjects(),i=this.getActiveObject();return a.length&&this.fire("before:selection:cleared",{target:i,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(a,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(a){e.util.cleanUpJsdomNode(this[a]),this[a]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,e.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var a=this._activeObject;a&&a._renderControls(r)},_toObject:function(r,a,i){var l=this._realizeGroupTransformOnObject(r),g=this.callSuper("_toObject",r,a,i);return this._unwindGroupTransformOnObject(r,l),g},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var a=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],i={};return a.forEach(function(l){i[l]=r[l]}),e.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),i}else return null},_unwindGroupTransformOnObject:function(r,a){a&&r.set(a)},_setSVGObject:function(r,a,i){var l=this._realizeGroupTransformOnObject(a);this.callSuper("_setSVGObject",r,a,i),this._unwindGroupTransformOnObject(a,l)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),e.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var d in e.StaticCanvas)d!=="prototype"&&(e.Canvas[d]=e.StaticCanvas[d])}(),function(){var h=e.util.addListener,s=e.util.removeListener,u=3,d=2,r=1,a={passive:!1};function i(l,g){return l.button&&l.button===g-1}e.util.object.extend(e.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(h,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(l,g){var o=this.upperCanvasEl,f=this._getEventPrefix();l(e.window,"resize",this._onResize),l(o,f+"down",this._onMouseDown),l(o,f+"move",this._onMouseMove,a),l(o,f+"out",this._onMouseOut),l(o,f+"enter",this._onMouseEnter),l(o,"wheel",this._onMouseWheel),l(o,"contextmenu",this._onContextMenu),l(o,"dblclick",this._onDoubleClick),l(o,"dragover",this._onDragOver),l(o,"dragenter",this._onDragEnter),l(o,"dragleave",this._onDragLeave),l(o,"drop",this._onDrop),this.enablePointerEvents||l(o,"touchstart",this._onTouchStart,a),typeof eventjs<"u"&&g in eventjs&&(eventjs[g](o,"gesture",this._onGesture),eventjs[g](o,"drag",this._onDrag),eventjs[g](o,"orientation",this._onOrientationChange),eventjs[g](o,"shake",this._onShake),eventjs[g](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var l=this._getEventPrefix();s(e.document,l+"up",this._onMouseUp),s(e.document,"touchend",this._onTouchEnd,a),s(e.document,l+"move",this._onMouseMove,a),s(e.document,"touchmove",this._onMouseMove,a)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(l,g){this.__onTransformGesture&&this.__onTransformGesture(l,g)},_onDrag:function(l,g){this.__onDrag&&this.__onDrag(l,g)},_onMouseWheel:function(l){this.__onMouseWheel(l)},_onMouseOut:function(l){var g=this._hoveredTarget;this.fire("mouse:out",{target:g,e:l}),this._hoveredTarget=null,g&&g.fire("mouseout",{e:l});var o=this;this._hoveredTargets.forEach(function(f){o.fire("mouse:out",{target:f,e:l}),f&&f.fire("mouseout",{e:l})}),this._hoveredTargets=[]},_onMouseEnter:function(l){!this._currentTransform&&!this.findTarget(l)&&(this.fire("mouse:over",{target:null,e:l}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(l,g){this.__onOrientationChange&&this.__onOrientationChange(l,g)},_onShake:function(l,g){this.__onShake&&this.__onShake(l,g)},_onLongPress:function(l,g){this.__onLongPress&&this.__onLongPress(l,g)},_onDragOver:function(l){l.preventDefault();var g=this._simpleEventHandler("dragover",l);this._fireEnterLeaveEvents(g,l)},_onDrop:function(l){return this._simpleEventHandler("drop:before",l),this._simpleEventHandler("drop",l)},_onContextMenu:function(l){return this.stopContextMenu&&(l.stopPropagation(),l.preventDefault()),!1},_onDoubleClick:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"dblclick"),this._resetTransformEventData(l)},getPointerId:function(l){var g=l.changedTouches;return g?g[0]&&g[0].identifier:this.enablePointerEvents?l.pointerId:-1},_isMainEvent:function(l){return l.isPrimary===!0?!0:l.isPrimary===!1?!1:l.type==="touchend"&&l.touches.length===0?!0:l.changedTouches?l.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(l){l.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(l)),this.__onMouseDown(l),this._resetTransformEventData();var g=this.upperCanvasEl,o=this._getEventPrefix();h(e.document,"touchend",this._onTouchEnd,a),h(e.document,"touchmove",this._onMouseMove,a),s(g,o+"down",this._onMouseDown)},_onMouseDown:function(l){this.__onMouseDown(l),this._resetTransformEventData();var g=this.upperCanvasEl,o=this._getEventPrefix();s(g,o+"move",this._onMouseMove,a),h(e.document,o+"up",this._onMouseUp),h(e.document,o+"move",this._onMouseMove,a)},_onTouchEnd:function(l){if(!(l.touches.length>0)){this.__onMouseUp(l),this._resetTransformEventData(),this.mainTouchId=null;var g=this._getEventPrefix();s(e.document,"touchend",this._onTouchEnd,a),s(e.document,"touchmove",this._onMouseMove,a);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){h(o.upperCanvasEl,g+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(l){this.__onMouseUp(l),this._resetTransformEventData();var g=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(l)&&(s(e.document,o+"up",this._onMouseUp),s(e.document,o+"move",this._onMouseMove,a),h(g,o+"move",this._onMouseMove,a))},_onMouseMove:function(l){!this.allowTouchScrolling&&l.preventDefault&&l.preventDefault(),this.__onMouseMove(l)},_onResize:function(){this.calcOffset()},_shouldRender:function(l){var g=this._activeObject;return!!g!=!!l||g&&l&&g!==l?!0:(g&&g.isEditing,!1)},__onMouseUp:function(l){var g,o=this._currentTransform,f=this._groupSelector,m=!1,y=!f||f.left===0&&f.top===0;if(this._cacheTransformEventData(l),g=this._target,this._handleEvent(l,"up:before"),i(l,u)){this.fireRightClick&&this._handleEvent(l,"up",u,y);return}if(i(l,d)){this.fireMiddleClick&&this._handleEvent(l,"up",d,y),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(l);return}if(this._isMainEvent(l)){if(o&&(this._finalizeCurrentTransform(l),m=o.actionPerformed),!y){var x=g===this._activeObject;this._maybeGroupObjects(l),m||(m=this._shouldRender(g)||!x&&g===this._activeObject)}var C,b;if(g){if(C=g._findTargetCorner(this.getPointer(l,!0),e.util.isTouchEvent(l)),g.selectable&&g!==this._activeObject&&g.activeOn==="up")this.setActiveObject(g,l),m=!0;else{var T=g.controls[C],E=T&&T.getMouseUpHandler(l,g,T);E&&(b=this.getPointer(l),E(l,o,b.x,b.y))}g.isMoving=!1}if(o&&(o.target!==g||o.corner!==C)){var L=o.target&&o.target.controls[o.corner],F=L&&L.getMouseUpHandler(l,g,T);b=b||this.getPointer(l),F&&F(l,o,b.x,b.y)}this._setCursorFromEvent(l,g),this._handleEvent(l,"up",r,y),this._groupSelector=null,this._currentTransform=null,g&&(g.__corner=0),m?this.requestRenderAll():y||this.renderTop()}},_simpleEventHandler:function(l,g){var o=this.findTarget(g),f=this.targets,m={e:g,target:o,subTargets:f};if(this.fire(l,m),o&&o.fire(l,m),!f)return o;for(var y=0;y<f.length;y++)f[y].fire(l,m);return o},_handleEvent:function(l,g,o,f){var m=this._target,y=this.targets||[],x={e:l,target:m,subTargets:y,button:o||r,isClick:f||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};g==="up"&&(x.currentTarget=this.findTarget(l),x.currentSubTargets=this.targets),this.fire("mouse:"+g,x),m&&m.fire("mouse"+g,x);for(var C=0;C<y.length;C++)y[C].fire("mouse"+g,x)},_finalizeCurrentTransform:function(l){var g=this._currentTransform,o=g.target,f={e:l,target:o,transform:g,action:g.action};o._scaling&&(o._scaling=!1),o.setCoords(),(g.actionPerformed||this.stateful&&o.hasStateChanged())&&this._fire("modified",f)},_onMouseDownInDrawingMode:function(l){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(l).requestRenderAll();var g=this.getPointer(l);this.freeDrawingBrush.onMouseDown(g,{e:l,pointer:g}),this._handleEvent(l,"down")},_onMouseMoveInDrawingMode:function(l){if(this._isCurrentlyDrawing){var g=this.getPointer(l);this.freeDrawingBrush.onMouseMove(g,{e:l,pointer:g})}this.setCursor(this.freeDrawingCursor),this._handleEvent(l,"move")},_onMouseUpInDrawingMode:function(l){var g=this.getPointer(l);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:l,pointer:g}),this._handleEvent(l,"up")},__onMouseDown:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"down:before");var g=this._target;if(i(l,u)){this.fireRightClick&&this._handleEvent(l,"down",u);return}if(i(l,d)){this.fireMiddleClick&&this._handleEvent(l,"down",d);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(l);return}if(this._isMainEvent(l)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var f=this._shouldRender(g),m=this._shouldGroup(l,g);if(this._shouldClearSelection(l,g)?this.discardActiveObject(l):m&&(this._handleGrouping(l,g),g=this._activeObject),this.selection&&(!g||!g.selectable&&!g.isEditing&&g!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),g){var y=g===this._activeObject;g.selectable&&g.activeOn==="down"&&this.setActiveObject(g,l);var x=g._findTargetCorner(this.getPointer(l,!0),e.util.isTouchEvent(l));if(g.__corner=x,g===this._activeObject&&(x||!m)){this._setupCurrentTransform(l,g,y);var C=g.controls[x],o=this.getPointer(l),b=C&&C.getMouseDownHandler(l,g,C);b&&b(l,this._currentTransform,o.x,o.y)}}this._handleEvent(l,"down"),(f||m)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(l){this._resetTransformEventData(),this._pointer=this.getPointer(l,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(l)||null},_beforeTransform:function(l){var g=this._currentTransform;this.stateful&&g.target.saveState(),this.fire("before:transform",{e:l,transform:g})},__onMouseMove:function(l){this._handleEvent(l,"move:before"),this._cacheTransformEventData(l);var g,o;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(l);return}if(this._isMainEvent(l)){var f=this._groupSelector;f?(o=this._absolutePointer,f.left=o.x-f.ex,f.top=o.y-f.ey,this.renderTop()):this._currentTransform?this._transformObject(l):(g=this.findTarget(l)||null,this._setCursorFromEvent(l,g),this._fireOverOutEvents(g,l)),this._handleEvent(l,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(l,g){var o=this._hoveredTarget,f=this._hoveredTargets,m=this.targets,y=Math.max(f.length,m.length);this.fireSyntheticInOutEvents(l,g,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var x=0;x<y;x++)this.fireSyntheticInOutEvents(m[x],g,{oldTarget:f[x],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(l,g){var o=this._draggedoverTarget,f=this._hoveredTargets,m=this.targets,y=Math.max(f.length,m.length);this.fireSyntheticInOutEvents(l,g,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var x=0;x<y;x++)this.fireSyntheticInOutEvents(m[x],g,{oldTarget:f[x],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=l},fireSyntheticInOutEvents:function(l,g,o){var f,m,y=o.oldTarget,x,C,b=y!==l,T=o.canvasEvtIn,E=o.canvasEvtOut;b&&(f={e:g,target:l,previousTarget:y},m={e:g,target:y,nextTarget:l}),C=l&&b,x=y&&b,x&&(E&&this.fire(E,m),y.fire(o.evtOut,m)),C&&(T&&this.fire(T,f),l.fire(o.evtIn,f))},__onMouseWheel:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"wheel"),this._resetTransformEventData()},_transformObject:function(l){var g=this.getPointer(l),o=this._currentTransform;o.reset=!1,o.shiftKey=l.shiftKey,o.altKey=l[this.centeredKey],this._performTransformAction(l,o,g),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(l,g,o){var f=o.x,m=o.y,y=g.action,x=!1,C=g.actionHandler;C&&(x=C(l,g,f,m)),y==="drag"&&x&&(g.target.isMoving=!0,this.setCursor(g.target.moveCursor||this.moveCursor)),g.actionPerformed=g.actionPerformed||x},_fire:e.controlsUtils.fireEvent,_setCursorFromEvent:function(l,g){if(!g)return this.setCursor(this.defaultCursor),!1;var o=g.hoverCursor||this.hoverCursor,f=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,m=(!f||!f.contains(g))&&g._findTargetCorner(this.getPointer(l,!0));m?this.setCursor(this.getCornerCursor(m,g,l)):(g.subTargetCheck&&this.targets.concat().reverse().map(function(y){o=y.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(l,g,o){var f=g.controls[l];return f.cursorStyleHandler(o,f,g)}})}(),function(){var h=Math.min,s=Math.max;e.util.object.extend(e.Canvas.prototype,{_shouldGroup:function(u,d){var r=this._activeObject;return r&&this._isSelectionKeyPressed(u)&&d&&d.selectable&&this.selection&&(r!==d||r.type==="activeSelection")&&!d.onSelect({e:u})},_handleGrouping:function(u,d){var r=this._activeObject;r.__corner||d===r&&(d=this.findTarget(u,!0),!d||!d.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(d,u):this._createActiveSelection(d,u))},_updateActiveSelection:function(u,d){var r=this._activeObject,a=r._objects.slice(0);r.contains(u)?(r.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),d)):(r.addWithUpdate(u),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(a,d)},_createActiveSelection:function(u,d){var r=this.getActiveObjects(),a=this._createGroup(u);this._hoveredTarget=a,this._setActiveObject(a,d),this._fireSelectionEvents(r,d)},_createGroup:function(u){var d=this._objects,r=d.indexOf(this._activeObject)<d.indexOf(u),a=r?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new e.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(u){var d=this._collectObjects(u),r;d.length===1?this.setActiveObject(d[0],u):d.length>1&&(r=new e.ActiveSelection(d.reverse(),{canvas:this}),this.setActiveObject(r,u))},_collectObjects:function(u){for(var d=[],r,a=this._groupSelector.ex,i=this._groupSelector.ey,l=a+this._groupSelector.left,g=i+this._groupSelector.top,o=new e.Point(h(a,l),h(i,g)),f=new e.Point(s(a,l),s(i,g)),m=!this.selectionFullyContained,y=a===l&&i===g,x=this._objects.length;x--&&(r=this._objects[x],!(!(!r||!r.selectable||!r.visible)&&(m&&r.intersectsWithRect(o,f,!0)||r.isContainedWithinRect(o,f,!0)||m&&r.containsPoint(o,null,!0)||m&&r.containsPoint(f,null,!0))&&(d.push(r),y))););return d.length>1&&(d=d.filter(function(C){return!C.onSelect({e:u})})),d},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){e.util.object.extend(e.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var s=h.format||"png",u=h.quality||1,d=(h.multiplier||1)*(h.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(d,h);return e.util.toDataURL(r,s,u)},toCanvasElement:function(h,s){h=h||1,s=s||{};var u=(s.width||this.width)*h,d=(s.height||this.height)*h,r=this.getZoom(),a=this.width,i=this.height,l=r*h,g=this.viewportTransform,o=(g[4]-(s.left||0))*h,f=(g[5]-(s.top||0))*h,m=this.interactive,y=[l,0,0,l,o,f],x=this.enableRetinaScaling,C=e.util.createCanvasElement(),b=this.contextTop;return C.width=u,C.height=d,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=y,this.width=u,this.height=d,this.calcViewportBoundaries(),this.renderCanvas(C.getContext("2d"),this._objects),this.viewportTransform=g,this.width=a,this.height=i,this.calcViewportBoundaries(),this.interactive=m,this.enableRetinaScaling=x,this.contextTop=b,C}})}(),e.util.object.extend(e.StaticCanvas.prototype,{loadFromJSON:function(h,s,u){if(h){var d=typeof h=="string"?JSON.parse(h):e.util.object.clone(h),r=this,a=d.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete d.clipPath,this._enlivenObjects(d.objects,function(l){r.clear(),r._setBgOverlay(d,function(){a?r._enlivenObjects([a],function(g){r.clipPath=g[0],r.__setupCanvas.call(r,d,l,i,s)}):r.__setupCanvas.call(r,d,l,i,s)})},u),this}},__setupCanvas:function(h,s,u,d){var r=this;s.forEach(function(a,i){r.insertAt(a,i)}),this.renderOnAddRemove=u,delete h.objects,delete h.backgroundImage,delete h.overlayImage,delete h.background,delete h.overlay,this._setOptions(h),this.renderAll(),d&&d()},_setBgOverlay:function(h,s){var u={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!h.backgroundImage&&!h.overlayImage&&!h.background&&!h.overlay){s&&s();return}var d=function(){u.backgroundImage&&u.overlayImage&&u.backgroundColor&&u.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",h.backgroundImage,u,d),this.__setBgOverlay("overlayImage",h.overlayImage,u,d),this.__setBgOverlay("backgroundColor",h.background,u,d),this.__setBgOverlay("overlayColor",h.overlay,u,d)},__setBgOverlay:function(h,s,u,d){var r=this;if(!s){u[h]=!0,d&&d();return}h==="backgroundImage"||h==="overlayImage"?e.util.enlivenObjects([s],function(a){r[h]=a[0],u[h]=!0,d&&d()}):this["set"+e.util.string.capitalize(h,!0)](s,function(){u[h]=!0,d&&d()})},_enlivenObjects:function(h,s,u){if(!h||h.length===0){s&&s([]);return}e.util.enlivenObjects(h,function(d){s&&s(d)},null,u)},_toDataURL:function(h,s){this.clone(function(u){s(u.toDataURL(h))})},_toDataURLWithMultiplier:function(h,s,u){this.clone(function(d){u(d.toDataURLWithMultiplier(h,s))})},clone:function(h,s){var u=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(d){d.loadFromJSON(u,function(){h&&h(d)})})},cloneWithoutData:function(h){var s=e.util.createCanvasElement();s.width=this.width,s.height=this.height;var u=new e.Canvas(s);this.backgroundImage?(u.setBackgroundImage(this.backgroundImage.src,function(){u.renderAll(),h&&h(u)}),u.backgroundImageOpacity=this.backgroundImageOpacity,u.backgroundImageStretch=this.backgroundImageStretch):h&&h(u)}}),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,d=s.util.object.clone,r=s.util.toFixed,a=s.util.string.capitalize,i=s.util.degreesToRadians,l=!s.isLikelyNode,g=2;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:l,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(o){o&&this.setOptions(o)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(o){var f=s.perfLimitSizeTotal,m=o.width,y=o.height,x=s.maxCacheSideLimit,C=s.minCacheSideLimit;if(m<=x&&y<=x&&m*y<=f)return m<C&&(o.width=C),y<C&&(o.height=C),o;var b=m/y,T=s.util.limitDimsByArea(b,f),E=s.util.capValue,L=E(C,T.x,x),F=E(C,T.y,x);return m>L&&(o.zoomX/=m/L,o.width=L,o.capped=!0),y>F&&(o.zoomY/=y/F,o.height=F,o.capped=!0),o},_getCacheCanvasDimensions:function(){var o=this.getTotalObjectScaling(),f=this._getTransformedDimensions(0,0),m=f.x*o.scaleX/this.scaleX,y=f.y*o.scaleY/this.scaleY;return{width:Math.ceil(m+g),height:Math.ceil(y+g),zoomX:o.scaleX,zoomY:o.scaleY,x:m,y}},_updateCacheCanvas:function(){var o=this.canvas;if(this.noScaleCache&&o&&o._currentTransform){var f=o._currentTransform.target,m=o._currentTransform.action;if(this===f&&m.slice&&m.slice(0,5)==="scale")return!1}var y=this._cacheCanvas,x=this._limitCacheSize(this._getCacheCanvasDimensions()),C=x.width,b=x.height,T,E,L=x.zoomX,F=x.zoomY,H=C!==this.cacheWidth||b!==this.cacheHeight,J=this.zoomX!==L||this.zoomY!==F,q=H||J;return q?(H?(y.width=C,y.height=b):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,y.width,y.height)),T=x.x/2,E=x.y/2,this.cacheTranslationX=Math.round(y.width/2-T)+T,this.cacheTranslationY=Math.round(y.height/2-E)+E,this.cacheWidth=C,this.cacheHeight=b,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(L,F),this.zoomX=L,this.zoomY=F,!0):!1},setOptions:function(o){this._setOptions(o),this._initGradient(o.fill,"fill"),this._initGradient(o.stroke,"stroke"),this._initPattern(o.fill,"fill"),this._initPattern(o.stroke,"stroke")},transform:function(o){var f=this.group&&!this.group._transformDone||this.group&&this.canvas&&o===this.canvas.contextTop,m=this.calcTransformMatrix(!f);o.transform(m[0],m[1],m[2],m[3],m[4],m[5])},toObject:function(o){var f=s.Object.NUM_FRACTION_DIGITS,m={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:r(this.left,f),top:r(this.top,f),width:r(this.width,f),height:r(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,f),scaleX:r(this.scaleX,f),scaleY:r(this.scaleY,f),angle:r(this.angle,f),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,f),skewY:r(this.skewY,f)};return this.clipPath&&!this.clipPath.excludeFromExport&&(m.clipPath=this.clipPath.toObject(o),m.clipPath.inverted=this.clipPath.inverted,m.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,m,o),this.includeDefaultValues||(m=this._removeDefaultValues(m)),m},toDatalessObject:function(o){return this.toObject(o)},_removeDefaultValues:function(o){var f=s.util.getKlass(o.type).prototype,m=f.stateProperties;return m.forEach(function(y){y==="left"||y==="top"||(o[y]===f[y]&&delete o[y],Array.isArray(o[y])&&Array.isArray(f[y])&&o[y].length===0&&f[y].length===0&&delete o[y])}),o},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var o=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(o.scaleX),scaleY:Math.abs(o.scaleY)}},getTotalObjectScaling:function(){var o=this.getObjectScaling(),f=o.scaleX,m=o.scaleY;if(this.canvas){var y=this.canvas.getZoom(),x=this.canvas.getRetinaScaling();f*=y*x,m*=y*x}return{scaleX:f,scaleY:m}},getObjectOpacity:function(){var o=this.opacity;return this.group&&(o*=this.group.getObjectOpacity()),o},_set:function(o,f){var m=o==="scaleX"||o==="scaleY",y=this[o]!==f,x=!1;return m&&(f=this._constrainScale(f)),o==="scaleX"&&f<0?(this.flipX=!this.flipX,f*=-1):o==="scaleY"&&f<0?(this.flipY=!this.flipY,f*=-1):o==="shadow"&&f&&!(f instanceof s.Shadow)?f=new s.Shadow(f):o==="dirty"&&this.group&&this.group.set("dirty",f),this[o]=f,y&&(x=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(o)>-1?(this.dirty=!0,x&&this.group.set("dirty",!0)):x&&this.stateProperties.indexOf(o)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(o){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(o.save(),this._setupCompositeOperation(o),this.drawSelectionBackground(o),this.transform(o),this._setOpacity(o),this._setShadow(o,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(o)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(o),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),o.restore())},renderCache:function(o){o=o||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,o.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(o,f){if(o.save(),f.inverted?o.globalCompositeOperation="destination-out":o.globalCompositeOperation="destination-in",f.absolutePositioned){var m=s.util.invertTransform(this.calcTransformMatrix());o.transform(m[0],m[1],m[2],m[3],m[4],m[5])}f.transform(o),o.scale(1/f.zoomX,1/f.zoomY),o.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),o.restore()},drawObject:function(o,f){var m=this.fill,y=this.stroke;f?(this.fill="black",this.stroke="",this._setClippingProperties(o)):this._renderBackground(o),this._render(o),this._drawClipPath(o,this.clipPath),this.fill=m,this.stroke=y},_drawClipPath:function(o,f){f&&(f.canvas=this.canvas,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCache(o,f))},drawCacheOnCanvas:function(o){o.scale(1/this.zoomX,1/this.zoomY),o.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(o){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!o&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!o){var f=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-m/2,f,m)}return!0}return!1},_renderBackground:function(o){if(this.backgroundColor){var f=this._getNonTransformedDimensions();o.fillStyle=this.backgroundColor,o.fillRect(-f.x/2,-f.y/2,f.x,f.y),this._removeShadow(o)}},_setOpacity:function(o){this.group&&!this.group._transformDone?o.globalAlpha=this.getObjectOpacity():o.globalAlpha*=this.opacity},_setStrokeStyles:function(o,f){var m=f.stroke;m&&(o.lineWidth=f.strokeWidth,o.lineCap=f.strokeLineCap,o.lineDashOffset=f.strokeDashOffset,o.lineJoin=f.strokeLineJoin,o.miterLimit=f.strokeMiterLimit,m.toLive?m.gradientUnits==="percentage"||m.gradientTransform||m.patternTransform?this._applyPatternForTransformedGradient(o,m):(o.strokeStyle=m.toLive(o,this),this._applyPatternGradientTransform(o,m)):o.strokeStyle=f.stroke)},_setFillStyles:function(o,f){var m=f.fill;m&&(m.toLive?(o.fillStyle=m.toLive(o,this),this._applyPatternGradientTransform(o,f.fill)):o.fillStyle=m)},_setClippingProperties:function(o){o.globalAlpha=1,o.strokeStyle="transparent",o.fillStyle="#000000"},_setLineDash:function(o,f){!f||f.length===0||(1&f.length&&f.push.apply(f,f),o.setLineDash(f))},_renderControls:function(o,f){var m=this.getViewportTransform(),y=this.calcTransformMatrix(),x,C,b;f=f||{},C=typeof f.hasBorders<"u"?f.hasBorders:this.hasBorders,b=typeof f.hasControls<"u"?f.hasControls:this.hasControls,y=s.util.multiplyTransformMatrices(m,y),x=s.util.qrDecompose(y),o.save(),o.translate(x.translateX,x.translateY),o.lineWidth=1*this.borderScaleFactor,this.group||(o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(x.angle-=180),o.rotate(i(this.group?x.angle:this.angle)),f.forActiveSelection||this.group?C&&this.drawBordersInGroup(o,x,f):C&&this.drawBorders(o,f),b&&this.drawControls(o,f),o.restore()},_setShadow:function(o){if(this.shadow){var f=this.shadow,m=this.canvas,y,x=m&&m.viewportTransform[0]||1,C=m&&m.viewportTransform[3]||1;f.nonScaling?y={scaleX:1,scaleY:1}:y=this.getObjectScaling(),m&&m._isRetinaScaling()&&(x*=s.devicePixelRatio,C*=s.devicePixelRatio),o.shadowColor=f.color,o.shadowBlur=f.blur*s.browserShadowBlurConstant*(x+C)*(y.scaleX+y.scaleY)/4,o.shadowOffsetX=f.offsetX*x*y.scaleX,o.shadowOffsetY=f.offsetY*C*y.scaleY}},_removeShadow:function(o){this.shadow&&(o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0)},_applyPatternGradientTransform:function(o,f){if(!f||!f.toLive)return{offsetX:0,offsetY:0};var m=f.gradientTransform||f.patternTransform,y=-this.width/2+f.offsetX||0,x=-this.height/2+f.offsetY||0;return f.gradientUnits==="percentage"?o.transform(this.width,0,0,this.height,y,x):o.transform(1,0,0,1,y,x),m&&o.transform(m[0],m[1],m[2],m[3],m[4],m[5]),{offsetX:y,offsetY:x}},_renderPaintInOrder:function(o){this.paintFirst==="stroke"?(this._renderStroke(o),this._renderFill(o)):(this._renderFill(o),this._renderStroke(o))},_render:function(){},_renderFill:function(o){this.fill&&(o.save(),this._setFillStyles(o,this),this.fillRule==="evenodd"?o.fill("evenodd"):o.fill(),o.restore())},_renderStroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this.strokeUniform&&this.group){var f=this.getObjectScaling();o.scale(1/f.scaleX,1/f.scaleY)}else this.strokeUniform&&o.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(o,this.strokeDashArray),this._setStrokeStyles(o,this),o.stroke(),o.restore()}},_applyPatternForTransformedGradient:function(o,f){var m=this._limitCacheSize(this._getCacheCanvasDimensions()),y=s.util.createCanvasElement(),x,C=this.canvas.getRetinaScaling(),b=m.x/this.scaleX/C,T=m.y/this.scaleY/C;y.width=Math.ceil(b),y.height=Math.ceil(T),x=y.getContext("2d"),x.beginPath(),x.moveTo(0,0),x.lineTo(b,0),x.lineTo(b,T),x.lineTo(0,T),x.closePath(),x.translate(b/2,T/2),x.scale(m.zoomX/this.scaleX/C,m.zoomY/this.scaleY/C),this._applyPatternGradientTransform(x,f),x.fillStyle=f.toLive(o),x.fill(),o.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),o.scale(C*this.scaleX/m.zoomX,C*this.scaleY/m.zoomY),o.strokeStyle=x.createPattern(y,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var o=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",o.scaleX),this.set("scaleY",o.scaleY),this.angle=o.angle,this.skewX=o.skewX,this.skewY=0}},_removeTransformMatrix:function(o){var f=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),f=s.util.transformPoint(f,this.transformMatrix)),this.transformMatrix=null,o&&(this.scaleX*=o.scaleX,this.scaleY*=o.scaleY,this.cropX=o.cropX,this.cropY=o.cropY,f.x+=o.offsetLeft,f.y+=o.offsetTop,this.width=o.width,this.height=o.height),this.setPositionByOrigin(f,"center","center")},clone:function(o,f){var m=this.toObject(f);this.constructor.fromObject?this.constructor.fromObject(m,o):s.Object._fromObject("Object",m,o)},cloneAsImage:function(o,f){var m=this.toCanvasElement(f);return o&&o(new s.Image(m)),this},toCanvasElement:function(o){o||(o={});var f=s.util,m=f.saveObjectTransform(this),y=this.group,x=this.shadow,C=Math.abs,b=(o.multiplier||1)*(o.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,o.withoutTransform&&f.resetObjectTransform(this),o.withoutShadow&&(this.shadow=null);var T=s.util.createCanvasElement(),E=this.getBoundingRect(!0,!0),L=this.shadow,F,H={x:0,y:0},J,q,Q;L&&(J=L.blur,L.nonScaling?F={scaleX:1,scaleY:1}:F=this.getObjectScaling(),H.x=2*Math.round(C(L.offsetX)+J)*C(F.scaleX),H.y=2*Math.round(C(L.offsetY)+J)*C(F.scaleY)),q=E.width+H.x,Q=E.height+H.y,T.width=Math.ceil(q),T.height=Math.ceil(Q);var te=new s.StaticCanvas(T,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});o.format==="jpeg"&&(te.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(te.width/2,te.height/2),"center","center");var oe=this.canvas;te.add(this);var ce=te.toCanvasElement(b||1,o);return this.shadow=x,this.set("canvas",oe),y&&(this.group=y),this.set(m).setCoords(),te._objects=[],te.dispose(),te=null,ce},toDataURL:function(o){return o||(o={}),s.util.toDataURL(this.toCanvasElement(o),o.format||"png",o.quality||1)},isType:function(o){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===o},complexity:function(){return 1},toJSON:function(o){return this.toObject(o)},rotate:function(o){var f=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return f&&this._setOriginToCenter(),this.set("angle",o),f&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(o,f){f=f||this.canvas.getPointer(o);var m=new s.Point(f.x,f.y),y=this._getLeftTopCoords();return this.angle&&(m=s.util.rotatePoint(m,y,i(-this.angle))),{x:m.x-y.x,y:m.y-y.y}},_setupCompositeOperation:function(o){this.globalCompositeOperation&&(o.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),u(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(o,f,m,y){var x=s[o];f=d(f,!0),s.util.enlivenPatterns([f.fill,f.stroke],function(C){typeof C[0]<"u"&&(f.fill=C[0]),typeof C[1]<"u"&&(f.stroke=C[1]),s.util.enlivenObjectEnlivables(f,f,function(){var b=y?new x(f[y],f):new x(f);m&&m(b)})})},s.Object.__uid=0)}(t),function(){var h=e.util.degreesToRadians,s={left:-.5,center:0,right:.5},u={top:-.5,center:0,bottom:.5};e.util.object.extend(e.Object.prototype,{translateToGivenOrigin:function(d,r,a,i,l){var g=d.x,o=d.y,f,m,y;return typeof r=="string"?r=s[r]:r-=.5,typeof i=="string"?i=s[i]:i-=.5,f=i-r,typeof a=="string"?a=u[a]:a-=.5,typeof l=="string"?l=u[l]:l-=.5,m=l-a,(f||m)&&(y=this._getTransformedDimensions(),g=d.x+f*y.x,o=d.y+m*y.y),new e.Point(g,o)},translateToCenterPoint:function(d,r,a){var i=this.translateToGivenOrigin(d,r,a,"center","center");return this.angle?e.util.rotatePoint(i,d,h(this.angle)):i},translateToOriginPoint:function(d,r,a){var i=this.translateToGivenOrigin(d,"center","center",r,a);return this.angle?e.util.rotatePoint(i,d,h(this.angle)):i},getCenterPoint:function(){var d=new e.Point(this.left,this.top);return this.translateToCenterPoint(d,this.originX,this.originY)},getPointByOrigin:function(d,r){var a=this.getCenterPoint();return this.translateToOriginPoint(a,d,r)},toLocalPoint:function(d,r,a){var i=this.getCenterPoint(),l,g;return typeof r<"u"&&typeof a<"u"?l=this.translateToGivenOrigin(i,"center","center",r,a):l=new e.Point(this.left,this.top),g=new e.Point(d.x,d.y),this.angle&&(g=e.util.rotatePoint(g,i,-h(this.angle))),g.subtractEquals(l)},setPositionByOrigin:function(d,r,a){var i=this.translateToCenterPoint(d,r,a),l=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",l.x),this.set("top",l.y)},adjustPosition:function(d){var r=h(this.angle),a=this.getScaledWidth(),i=e.util.cos(r)*a,l=e.util.sin(r)*a,g,o;typeof this.originX=="string"?g=s[this.originX]:g=this.originX-.5,typeof d=="string"?o=s[d]:o=d-.5,this.left+=i*(o-g),this.top+=l*(o-g),this.setCoords(),this.originX=d},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var d=this.getCenterPoint();this.originX="center",this.originY="center",this.left=d.x,this.top=d.y},_resetOrigin:function(){var d=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=d.x,this.top=d.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function h(a){return[new e.Point(a.tl.x,a.tl.y),new e.Point(a.tr.x,a.tr.y),new e.Point(a.br.x,a.br.y),new e.Point(a.bl.x,a.bl.y)]}var s=e.util,u=s.degreesToRadians,d=s.multiplyTransformMatrices,r=s.transformPoint;s.object.extend(e.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(a,i){return i?a?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),a?this.aCoords:this.lineCoords)},getCoords:function(a,i){return h(this._getCoords(a,i))},intersectsWithRect:function(a,i,l,g){var o=this.getCoords(l,g),f=e.Intersection.intersectPolygonRectangle(o,a,i);return f.status==="Intersection"},intersectsWithObject:function(a,i,l){var g=e.Intersection.intersectPolygonPolygon(this.getCoords(i,l),a.getCoords(i,l));return g.status==="Intersection"||a.isContainedWithinObject(this,i,l)||this.isContainedWithinObject(a,i,l)},isContainedWithinObject:function(a,i,l){for(var g=this.getCoords(i,l),o=i?a.aCoords:a.lineCoords,f=0,m=a._getImageLines(o);f<4;f++)if(!a.containsPoint(g[f],m))return!1;return!0},isContainedWithinRect:function(a,i,l,g){var o=this.getBoundingRect(l,g);return o.left>=a.x&&o.left+o.width<=i.x&&o.top>=a.y&&o.top+o.height<=i.y},containsPoint:function(a,f,l,g){var o=this._getCoords(l,g),f=f||this._getImageLines(o),m=this._findCrossPoints(a,f);return m!==0&&m%2===1},isOnScreen:function(a){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br,g=this.getCoords(!0,a);return g.some(function(o){return o.x<=l.x&&o.x>=i.x&&o.y<=l.y&&o.y>=i.y})||this.intersectsWithRect(i,l,!0,a)?!0:this._containsCenterOfCanvas(i,l,a)},_containsCenterOfCanvas:function(a,i,l){var g={x:(a.x+i.x)/2,y:(a.y+i.y)/2};return!!this.containsPoint(g,null,!0,l)},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br;if(this.intersectsWithRect(i,l,!0,a))return!0;var g=this.getCoords(!0,a).every(function(o){return(o.x>=l.x||o.x<=i.x)&&(o.y>=l.y||o.y<=i.y)});return g&&this._containsCenterOfCanvas(i,l,a)},_getImageLines:function(a){var i={topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}};return i},_findCrossPoints:function(a,i){var l,g,o,f,m,y=0,x;for(var C in i)if(x=i[C],!(x.o.y<a.y&&x.d.y<a.y)&&!(x.o.y>=a.y&&x.d.y>=a.y)&&(x.o.x===x.d.x&&x.o.x>=a.x?m=x.o.x:(l=0,g=(x.d.y-x.o.y)/(x.d.x-x.o.x),o=a.y-l*a.x,f=x.o.y-g*x.o.x,m=-(o-f)/(l-g)),m>=a.x&&(y+=1),y===2))break;return y},getBoundingRect:function(a,i){var l=this.getCoords(a,i);return s.makeBoundingBoxFromPoints(l)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a===0?1e-4:a},scale:function(a){return this._set("scaleX",a),this._set("scaleY",a),this.setCoords()},scaleToWidth:function(a,i){var l=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(a/this.width/l)},scaleToHeight:function(a,i){var l=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(a/this.height/l)},calcLineCoords:function(){var a=this.getViewportTransform(),i=this.padding,l=u(this.angle),g=s.cos(l),o=s.sin(l),f=g*i,m=o*i,y=f+m,x=f-m,C=this.calcACoords(),b={tl:r(C.tl,a),tr:r(C.tr,a),bl:r(C.bl,a),br:r(C.br,a)};return i&&(b.tl.x-=x,b.tl.y-=y,b.tr.x+=y,b.tr.y-=x,b.bl.x-=y,b.bl.y+=x,b.br.x+=x,b.br.y+=y),b},calcOCoords:function(){var a=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),l=this.getViewportTransform(),g=d(l,i),o=d(g,a),o=d(o,[1/l[0],0,0,1/l[3],0,0]),f=this._calculateCurrentDimensions(),m={};return this.forEachControl(function(y,x,C){m[x]=y.positionHandler(f,o,C)}),m},calcACoords:function(){var a=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),l=d(i,a),g=this._getTransformedDimensions(),o=g.x/2,f=g.y/2;return{tl:r({x:-o,y:-f},l),tr:r({x:o,y:-f},l),bl:r({x:-o,y:f},l),br:r({x:o,y:f},l)}},setCoords:function(a){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),a?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var i="_",l="";return!a&&this.group&&(l=this.group.transformMatrixKey(a)+i),l+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){var i=this.calcOwnMatrix();if(a||!this.group)return i;var l=this.transformMatrixKey(a),g=this.matrixCache||(this.matrixCache={});return g.key===l?g.value:(this.group&&(i=d(this.group.calcTransformMatrix(!1),i)),g.key=l,g.value=i,i)},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===a)return i.value;var l=this._calcTranslateMatrix(),g={angle:this.angle,translateX:l[4],translateY:l[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=a,i.value=s.composeMatrix(g),i.value},_getNonTransformedDimensions:function(){var a=this.strokeWidth,i=this.width+a,l=this.height+a;return{x:i,y:l}},_getTransformedDimensions:function(a,i){typeof a>"u"&&(a=this.skewX),typeof i>"u"&&(i=this.skewY);var l,g,o,f=a===0&&i===0;if(this.strokeUniform?(g=this.width,o=this.height):(l=this._getNonTransformedDimensions(),g=l.x,o=l.y),f)return this._finalizeDimensions(g*this.scaleX,o*this.scaleY);var m=s.sizeAfterTransform(g,o,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:a,skewY:i});return this._finalizeDimensions(m.x,m.y)},_finalizeDimensions:function(a,i){return this.strokeUniform?{x:a+this.strokeWidth,y:i+this.strokeWidth}:{x:a,y:i}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),i=this._getTransformedDimensions(),l=r(i,a,!0);return l.scalarAdd(2*this.padding)}})}(),e.util.object.extend(e.Object.prototype,{sendToBack:function(){return this.group?e.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?e.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(h){return this.group?e.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas&&this.canvas.sendBackwards(this,h),this},bringForward:function(h){return this.group?e.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas&&this.canvas.bringForward(this,h),this},moveTo:function(h){return this.group&&this.group.type!=="activeSelection"?e.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas&&this.canvas.moveTo(this,h),this}}),function(){function h(u,d){if(d){if(d.toLive)return u+": url(#SVGID_"+d.id+"); ";var r=new e.Color(d),a=u+": "+r.toRgb()+"; ",i=r.getAlpha();return i!==1&&(a+=u+"-opacity: "+i.toString()+"; "),a}else return u+": none; "}var s=e.util.toFixed;e.util.object.extend(e.Object.prototype,{getSvgStyles:function(u){var d=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",l=this.strokeLineCap?this.strokeLineCap:"butt",g=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",f=typeof this.opacity<"u"?this.opacity:"1",m=this.visible?"":" visibility: hidden;",y=u?"":this.getSvgFilter(),x=h("fill",this.fill),C=h("stroke",this.stroke);return[C,"stroke-width: ",r,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",l,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",g,"; ","stroke-miterlimit: ",o,"; ",x,"fill-rule: ",d,"; ","opacity: ",f,";",y,m].join("")},getSvgSpanStyles:function(u,d){var r="; ",i=u.fontFamily?"font-family: "+(u.fontFamily.indexOf("'")===-1&&u.fontFamily.indexOf('"')===-1?"'"+u.fontFamily+"'":u.fontFamily)+r:"",a=u.strokeWidth?"stroke-width: "+u.strokeWidth+r:"",i=i,l=u.fontSize?"font-size: "+u.fontSize+"px"+r:"",g=u.fontStyle?"font-style: "+u.fontStyle+r:"",o=u.fontWeight?"font-weight: "+u.fontWeight+r:"",f=u.fill?h("fill",u.fill):"",m=u.stroke?h("stroke",u.stroke):"",y=this.getSvgTextDecoration(u),x=u.deltaY?"baseline-shift: "+-u.deltaY+"; ":"";return y&&(y="text-decoration: "+y+r),[m,a,i,l,g,o,y,f,x,d?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(u){return["overline","underline","line-through"].filter(function(d){return u[d.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(u,d){var r=u?this.calcTransformMatrix():this.calcOwnMatrix(),a='transform="'+e.util.matrixToSVG(r);return a+(d||"")+'" '},_setSVGBg:function(u){if(this.backgroundColor){var d=e.Object.NUM_FRACTION_DIGITS;u.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,d),'" y="',s(-this.height/2,d),'" width="',s(this.width,d),'" height="',s(this.height,d),`"></rect>
`)}},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(u),{reviver:u})},toClipPathSVG:function(u){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(u),{reviver:u})},_createBaseClipPathSVGMarkup:function(u,d){d=d||{};var r=d.reviver,a=d.additionalTransform||"",i=[this.getSvgTransform(!0,a),this.getSvgCommons()].join(""),l=u.indexOf("COMMON_PARTS");return u[l]=i,r?r(u.join("")):u.join("")},_createBaseSVGMarkup:function(u,d){d=d||{};var r=d.noStyle,a=d.reviver,i=r?"":'style="'+this.getSvgStyles()+'" ',l=d.withShadow?'style="'+this.getSvgFilter()+'" ':"",g=this.clipPath,o=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",f=g&&g.absolutePositioned,m=this.stroke,y=this.fill,x=this.shadow,C,b=[],T,E=u.indexOf("COMMON_PARTS"),L=d.additionalTransform;return g&&(g.clipPathId="CLIPPATH_"+e.Object.__uid++,T='<clipPath id="'+g.clipPathId+`" >
`+g.toClipPathSVG(a)+`</clipPath>
`),f&&b.push("<g ",l,this.getSvgCommons(),` >
`),b.push("<g ",this.getSvgTransform(!1),f?"":l+this.getSvgCommons(),` >
`),C=[i,o,r?"":this.addPaintOrder()," ",L?'transform="'+L+'" ':""].join(""),u[E]=C,y&&y.toLive&&b.push(y.toSVG(this)),m&&m.toLive&&b.push(m.toSVG(this)),x&&b.push(x.toSVG(this)),g&&b.push(T),b.push(u.join("")),b.push(`</g>
`),f&&b.push(`</g>
`),a?a(b.join("")):b.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var h=e.util.object.extend,s="stateProperties";function u(r,a,i){var l={},g=!0;i.forEach(function(o){l[o]=r[o]}),h(r[a],l,g)}function d(r,a,i){if(r===a)return!0;if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(var l=0,g=r.length;l<g;l++)if(!d(r[l],a[l]))return!1;return!0}else if(r&&typeof r=="object"){var o=Object.keys(r),f;if(!a||typeof a!="object"||!i&&o.length!==Object.keys(a).length)return!1;for(var l=0,g=o.length;l<g;l++)if(f=o[l],!(f==="canvas"||f==="group")&&!d(r[f],a[f]))return!1;return!0}}e.util.object.extend(e.Object.prototype,{hasStateChanged:function(r){r=r||s;var a="_"+r;return Object.keys(this[a]).length<this[r].length?!0:!d(this[a],this,!0)},saveState:function(r){var a=r&&r.propertySet||s,i="_"+a;return this[i]?(u(this,i,this[a]),r&&r.stateProperties&&u(this,i,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var a=r.propertySet||s;return r.propertySet=a,this["_"+a]={},this.saveState(r),this}})}(),function(){var h=e.util.degreesToRadians;e.util.object.extend(e.Object.prototype,{_findTargetCorner:function(s,u){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var d=s.x,r=s.y,a,i,l=Object.keys(this.oCoords),g=l.length-1,o;for(this.__corner=0;g>=0;g--)if(o=l[g],!!this.isControlVisible(o)&&(i=this._getImageLines(u?this.oCoords[o].touchCorner:this.oCoords[o].corner),a=this._findCrossPoints({x:d,y:r},i),a!==0&&a%2===1))return this.__corner=o,o;return!1},forEachControl:function(s){for(var u in this.controls)s(this.controls[u],u,this)},_setCornerCoords:function(){var s=this.oCoords;for(var u in s){var d=this.controls[u];s[u].corner=d.calcCornerCoords(this.angle,this.cornerSize,s[u].x,s[u].y,!1),s[u].touchCorner=d.calcCornerCoords(this.angle,this.touchCornerSize,s[u].x,s[u].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var u=this.getCenterPoint(),d=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return s.translate(u.x,u.y),s.scale(1/r[0],1/r[3]),s.rotate(h(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-d.x/2,-d.y/2,d.x,d.y),s.restore(),this},drawBorders:function(s,u){u=u||{};var d=this._calculateCurrentDimensions(),r=this.borderScaleFactor,a=d.x+r,i=d.y+r,l=typeof u.hasControls<"u"?u.hasControls:this.hasControls,g=!1;return s.save(),s.strokeStyle=u.borderColor||this.borderColor,this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeRect(-a/2,-i/2,a,i),l&&(s.beginPath(),this.forEachControl(function(o,f,m){o.withConnection&&o.getVisibility(m,f)&&(g=!0,s.moveTo(o.x*a,o.y*i),s.lineTo(o.x*a+o.offsetX,o.y*i+o.offsetY))}),g&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,u,d){d=d||{};var r=e.util.sizeAfterTransform(this.width,this.height,u),a=this.strokeWidth,i=this.strokeUniform,l=this.borderScaleFactor,g=r.x+a*(i?this.canvas.getZoom():u.scaleX)+l,o=r.y+a*(i?this.canvas.getZoom():u.scaleY)+l;return s.save(),this._setLineDash(s,d.borderDashArray||this.borderDashArray),s.strokeStyle=d.borderColor||this.borderColor,s.strokeRect(-g/2,-o/2,g,o),s.restore(),this},drawControls:function(s,u){u=u||{},s.save();var d=1,r,a;return this.canvas&&(d=this.canvas.getRetinaScaling()),s.setTransform(d,0,0,d,0,0),s.strokeStyle=s.fillStyle=u.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=u.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,u.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(i,l,g){a=g.oCoords[l],i.getVisibility(g,l)&&(r&&(a=e.util.transformPoint(a,r)),i.render(s,a.x,a.y,u,g))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,u){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=u,this},setControlsVisibility:function(s){s||(s={});for(var u in s)this.setControlVisible(u,s[u]);return this},onDeselect:function(){},onSelect:function(){}})}(),e.util.object.extend(e.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(h,s){s=s||{};var u=function(){},d=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:h.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){h.set("left",i),a.requestRenderAll(),r()},onComplete:function(){h.setCoords(),d()}})},fxCenterObjectV:function(h,s){s=s||{};var u=function(){},d=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:h.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){h.set("top",i),a.requestRenderAll(),r()},onComplete:function(){h.setCoords(),d()}})},fxRemove:function(h,s){s=s||{};var u=function(){},d=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:h.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){h.set("opacity",i),a.requestRenderAll(),r()},onComplete:function(){a.remove(h),d()}})}}),e.util.object.extend(e.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var h=[],s,u,d=[];for(s in arguments[0])h.push(s);for(var r=0,a=h.length;r<a;r++)s=h[r],u=r!==a-1,d.push(this._animate(s,arguments[0][s],arguments[1],u));return d}else return this._animate.apply(this,arguments)},_animate:function(h,s,u,d){var r=this,a;s=s.toString(),u?u=e.util.object.clone(u):u={},~h.indexOf(".")&&(a=h.split("."));var i=r.colorProperties.indexOf(h)>-1||a&&r.colorProperties.indexOf(a[1])>-1,l=a?this.get(a[0])[a[1]]:this.get(h);"from"in u||(u.from=l),i||(~s.indexOf("=")?s=l+parseFloat(s.replace("=","")):s=parseFloat(s));var g={target:this,startValue:u.from,endValue:s,byValue:u.by,easing:u.easing,duration:u.duration,abort:u.abort&&function(o,f,m){return u.abort.call(r,o,f,m)},onChange:function(o,f,m){a?r[a[0]][a[1]]=o:r.set(h,o),!d&&u.onChange&&u.onChange(o,f,m)},onComplete:function(o,f,m){d||(r.setCoords(),u.onComplete&&u.onComplete(o,f,m))}};return i?e.util.animateColor(g.startValue,g.endValue,g.duration,g):e.util.animate(g)}}),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,d=s.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(s.Line){s.warn("fabric.Line is already defined");return}s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,l){i||(i=[0,0,0,0]),this.callSuper("initialize",l),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(l)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,l){return this.callSuper("_set",i,l),typeof r[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var l=this.calcLinePoints();i.moveTo(l.x1,l.y1),i.lineTo(l.x2,l.y2),i.lineWidth=this.strokeWidth;var g=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=g},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return u(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(i.y-=this.strokeWidth),this.height===0&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,l=this.y1<=this.y2?-1:1,g=i*this.width*.5,o=l*this.height*.5,f=i*this.width*-.5,m=l*this.height*-.5;return{x1:g,x2:f,y1:o,y2:m}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(i,l,g){g=g||{};var o=s.parseAttributes(i,s.Line.ATTRIBUTE_NAMES),f=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];l(new s.Line(f,u(o,g)))},s.Line.fromObject=function(i,l){function g(f){delete f.points,l&&l(f)}var o=d(i,!0);o.points=[i.x1,i.y1,i.x2,i.y2],s.Object._fromObject("Line",o,g,"points")};function a(i,l){var g=i.origin,o=i.axis1,f=i.axis2,m=i.dimension,y=l.nearest,x=l.center,C=l.farthest;return function(){switch(this.get(g)){case y:return Math.min(this.get(o),this.get(f));case x:return Math.min(this.get(o),this.get(f))+.5*this.get(m);case C:return Math.max(this.get(o),this.get(f))}}}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.degreesToRadians;if(s.Circle){s.warn("fabric.Circle is already defined.");return}s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,a){return this.callSuper("_set",r,a),r==="radius"&&this.setRadius(a),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,a=0,i=0,l=(this.endAngle-this.startAngle)%360;if(l===0)r=["<circle ","COMMON_PARTS",'cx="'+a+'" cy="'+i+'" ','r="',this.radius,`" />
`];else{var g=u(this.startAngle),o=u(this.endAngle),f=this.radius,m=s.util.cos(g)*f,y=s.util.sin(g)*f,x=s.util.cos(o)*f,C=s.util.sin(o)*f,b=l>180?"1":"0";r=['<path d="M '+m+" "+y," A "+f+" "+f," 0 ",+b+" 1"," "+x+" "+C,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,u(this.startAngle),u(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(r,a){var i=s.parseAttributes(r,s.Circle.ATTRIBUTE_NAMES);if(!d(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,a(new s.Circle(i))};function d(r){return"radius"in r&&r.radius>=0}s.Circle.fromObject=function(r,a){s.Object._fromObject("Circle",r,a)}}(t),function(h){var s=h.fabric||(h.fabric={});if(s.Triangle){s.warn("fabric.Triangle is already defined");return}s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(u){var d=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-d,r),u.lineTo(0,-r),u.lineTo(d,r),u.closePath(),this._renderPaintInOrder(u)},_toSVG:function(){var u=this.width/2,d=this.height/2,r=[-u+" "+d,"0 "+-d,u+" "+d].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),s.Triangle.fromObject=function(u,d){return s.Object._fromObject("Triangle",u,d)}}(t),function(h){var s=h.fabric||(h.fabric={}),u=Math.PI*2;if(s.Ellipse){s.warn("fabric.Ellipse is already defined.");return}s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d),this.set("rx",d&&d.rx||0),this.set("ry",d&&d.ry||0)},_set:function(d,r){switch(this.callSuper("_set",d,r),d){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(d){d.beginPath(),d.save(),d.transform(1,0,0,this.ry/this.rx,0,0),d.arc(0,0,this.rx,0,u,!1),d.restore(),this._renderPaintInOrder(d)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(d,r){var a=s.parseAttributes(d,s.Ellipse.ATTRIBUTE_NAMES);a.left=(a.left||0)-a.rx,a.top=(a.top||0)-a.ry,r(new s.Ellipse(a))},s.Ellipse.fromObject=function(d,r){s.Object._fromObject("Ellipse",d,r)}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend;if(s.Rect){s.warn("fabric.Rect is already defined");return}s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(d){var r=this.rx?Math.min(this.rx,this.width/2):0,a=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,l=this.height,g=-this.width/2,o=-this.height/2,f=r!==0||a!==0,m=1-.5522847498;d.beginPath(),d.moveTo(g+r,o),d.lineTo(g+i-r,o),f&&d.bezierCurveTo(g+i-m*r,o,g+i,o+m*a,g+i,o+a),d.lineTo(g+i,o+l-a),f&&d.bezierCurveTo(g+i,o+l-m*a,g+i-m*r,o+l,g+i-r,o+l),d.lineTo(g+r,o+l),f&&d.bezierCurveTo(g+m*r,o+l,g,o+l-m*a,g,o+l-a),d.lineTo(g,o+a),f&&d.bezierCurveTo(g,o+m*a,g+m*r,o,g+r,o),d.closePath(),this._renderPaintInOrder(d)},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){var d=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',d,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(d,r,a){if(!d)return r(null);a=a||{};var i=s.parseAttributes(d,s.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var l=new s.Rect(u(a?s.util.object.clone(a):{},i));l.visible=l.visible&&l.width>0&&l.height>0,r(l)},s.Rect.fromObject=function(d,r){return s.Object._fromObject("Rect",d,r)}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,d=s.util.array.min,r=s.util.array.max,a=s.util.toFixed,i=s.util.projectStrokeOnPoints;if(s.Polyline){s.warn("fabric.Polyline is already defined");return}s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(l,g){g=g||{},this.points=l||[],this.callSuper("initialize",g),this._setPositionDimensions(g)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(l){var g=this._calcDimensions(l),o,f=this.exactBoundingBox?this.strokeWidth:0;this.width=g.width-f,this.height=g.height-f,l.fromSVG||(o=this.translateToGivenOrigin({x:g.left-this.strokeWidth/2+f/2,y:g.top-this.strokeWidth/2+f/2},"left","top",this.originX,this.originY)),typeof l.left>"u"&&(this.left=l.fromSVG?g.left:o.x),typeof l.top>"u"&&(this.top=l.fromSVG?g.top:o.y),this.pathOffset={x:g.left+this.width/2+f/2,y:g.top+this.height/2+f/2}},_calcDimensions:function(){var l=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,g=d(l,"x")||0,o=d(l,"y")||0,f=r(l,"x")||0,m=r(l,"y")||0,y=f-g,x=m-o;return{left:g,top:o,width:y,height:x}},toObject:function(l){return u(this.callSuper("toObject",l),{points:this.points.concat()})},_toSVG:function(){for(var l=[],g=this.pathOffset.x,o=this.pathOffset.y,f=s.Object.NUM_FRACTION_DIGITS,m=0,y=this.points.length;m<y;m++)l.push(a(this.points[m].x-g,f),",",a(this.points[m].y-o,f)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',l.join(""),`" />
`]},commonRender:function(l){var g,o=this.points.length,f=this.pathOffset.x,m=this.pathOffset.y;if(!o||isNaN(this.points[o-1].y))return!1;l.beginPath(),l.moveTo(this.points[0].x-f,this.points[0].y-m);for(var y=0;y<o;y++)g=this.points[y],l.lineTo(g.x-f,g.y-m);return!0},_render:function(l){this.commonRender(l)&&this._renderPaintInOrder(l)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(l){return function(g,o,f){if(!g)return o(null);f||(f={});var m=s.parsePointsAttribute(g.getAttribute("points")),y=s.parseAttributes(g,s[l].ATTRIBUTE_NAMES);y.fromSVG=!0,o(new s[l](m,u(y,f)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(l,g){return s.Object._fromObject("Polyline",l,g,"points")}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.projectStrokeOnPoints;if(s.Polygon){s.warn("fabric.Polygon is already defined");return}s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return u(this.points,this)},_render:function(d){this.commonRender(d)&&(d.closePath(),this._renderPaintInOrder(d))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(d,r){s.Object._fromObject("Polygon",d,r,"points")}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.array.min,d=s.util.array.max,r=s.util.object.extend,a=s.util.object.clone,i=s.util.toFixed;if(s.Path){s.warn("fabric.Path is already defined");return}s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(l,g){g=a(g||{}),delete g.path,this.callSuper("initialize",g),this._setPath(l||[],g)},_setPath:function(l,g){this.path=s.util.makePathSimpler(Array.isArray(l)?l:s.util.parsePath(l)),s.Polyline.prototype._setPositionDimensions.call(this,g||{})},_renderPathCommands:function(l){var g,o=0,f=0,m=0,y=0,x=0,C=0,b=-this.pathOffset.x,T=-this.pathOffset.y;l.beginPath();for(var E=0,L=this.path.length;E<L;++E)switch(g=this.path[E],g[0]){case"L":m=g[1],y=g[2],l.lineTo(m+b,y+T);break;case"M":m=g[1],y=g[2],o=m,f=y,l.moveTo(m+b,y+T);break;case"C":m=g[5],y=g[6],x=g[3],C=g[4],l.bezierCurveTo(g[1]+b,g[2]+T,x+b,C+T,m+b,y+T);break;case"Q":l.quadraticCurveTo(g[1]+b,g[2]+T,g[3]+b,g[4]+T),m=g[3],y=g[4],x=g[1],C=g[2];break;case"z":case"Z":m=o,y=f,l.closePath();break}},_render:function(l){this._renderPathCommands(l),this._renderPaintInOrder(l)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(l){return r(this.callSuper("toObject",l),{path:this.path.map(function(g){return g.slice()})})},toDatalessObject:function(l){var g=this.toObject(["sourcePath"].concat(l));return g.sourcePath&&delete g.path,g},_toSVG:function(){var l=s.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',l,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var l=s.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,l)+", "+i(-this.pathOffset.y,l)+")"},toClipPathSVG:function(l){var g=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:l,additionalTransform:g})},toSVG:function(l){var g=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,additionalTransform:g})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var l=[],g=[],o,f=0,m=0,y=0,x=0,C,b=0,T=this.path.length;b<T;++b){switch(o=this.path[b],o[0]){case"L":y=o[1],x=o[2],C=[];break;case"M":y=o[1],x=o[2],f=y,m=x,C=[];break;case"C":C=s.util.getBoundsOfCurve(y,x,o[1],o[2],o[3],o[4],o[5],o[6]),y=o[5],x=o[6];break;case"Q":C=s.util.getBoundsOfCurve(y,x,o[1],o[2],o[1],o[2],o[3],o[4]),y=o[3],x=o[4];break;case"z":case"Z":y=f,x=m;break}C.forEach(function(Q){l.push(Q.x),g.push(Q.y)}),l.push(y),g.push(x)}var E=u(l)||0,L=u(g)||0,F=d(l)||0,H=d(g)||0,J=F-E,q=H-L;return{left:E,top:L,width:J,height:q}}}),s.Path.fromObject=function(l,g){if(typeof l.sourcePath=="string"){var o=l.sourcePath;s.loadSVGFromURL(o,function(f){var m=f[0];m.setOptions(l),l.clipPath?s.util.enlivenObjects([l.clipPath],function(y){m.clipPath=y[0],g&&g(m)}):g&&g(m)})}else s.Object._fromObject("Path",l,g,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(l,g,o){var f=s.parseAttributes(l,s.Path.ATTRIBUTE_NAMES);f.fromSVG=!0,g(new s.Path(f.d,r(f,o)))}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.array.min,d=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,a,i){a=a||{},this._objects=[],i&&this.callSuper("initialize",a),this._objects=r||[];for(var l=this._objects.length;l--;)this._objects[l].group=this;if(i)this._updateObjectsACoords();else{var g=a&&a.centerPoint;a.originX!==void 0&&(this.originX=a.originX),a.originY!==void 0&&(this.originY=a.originY),g||this._calcBounds(),this._updateObjectsCoords(g),delete a.centerPoint,this.callSuper("initialize",a)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,a=this._objects.length;a--;)this._objects[a].setCoords(r)},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],a)},_updateObjectCoords:function(r,a){var i=r.left,l=r.top,g=!0;r.set({left:i-a.x,top:l-a.y}),r.group=this,r.setCoords(g)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var a=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),r&&(a&&s.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,a?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,a){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(r,a);if(r==="canvas")for(;i--;)this._objects[i]._set(r,a);s.Object.prototype._set.call(this,r,a)},toObject:function(r){var a=this.includeDefaultValues,i=this._objects.filter(function(g){return!g.excludeFromExport}).map(function(g){var o=g.includeDefaultValues;g.includeDefaultValues=a;var f=g.toObject(r);return g.includeDefaultValues=o,f}),l=s.Object.prototype.toObject.call(this,r);return l.objects=i,l},toDatalessObject:function(r){var a,i=this.sourcePath;if(i)a=i;else{var l=this.includeDefaultValues;a=this._objects.map(function(o){var f=o.includeDefaultValues;o.includeDefaultValues=l;var m=o.toDatalessObject(r);return o.includeDefaultValues=f,m})}var g=s.Object.prototype.toDatalessObject.call(this,r);return g.objects=a,g},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=s.Object.prototype.shouldCache.call(this);if(r){for(var a=0,i=this._objects.length;a<i;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,a=this._objects.length;r<a;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var a=0,i=this._objects.length;a<i;a++)this._objects[a].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var a=0,i=this._objects.length;a<i;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var l=this.cacheWidth/this.zoomX,g=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-l/2,-g/2,l,g)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(a){s.util.addTransformToObject(a,r),delete a.group,a.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,a=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var l=new s.ActiveSelection([]);return l.set(i),l.type="activeSelection",a.remove(this),r.forEach(function(g){g.group=l,g.dirty=!0,a.add(g)}),l.canvas=a,l._objects=r,a._activeObject=l,l.setCoords(),l}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(a){a.setCoords(r)}),this},_calcBounds:function(r){for(var a=[],i=[],l,g,o,f=["tr","br","bl","tl"],m=0,y=this._objects.length,x,C=f.length;m<y;++m){for(l=this._objects[m],o=l.calcACoords(),x=0;x<C;x++)g=f[x],a.push(o[g].x),i.push(o[g].y);l.aCoords=o}this._getBounds(a,i,r)},_getBounds:function(r,a,i){var l=new s.Point(u(r),u(a)),g=new s.Point(d(r),d(a)),o=l.y||0,f=l.x||0,m=g.x-l.x||0,y=g.y-l.y||0;this.width=m,this.height=y,i||this.setPositionByOrigin({x:f,y:o},"left","top")},_toSVG:function(r){for(var a=["<g ","COMMON_PARTS",` >
`],i=0,l=this._objects.length;i<l;i++)a.push("		",this._objects[i].toSVG(r));return a.push(`</g>
`),a},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",a=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),a].join("")},toClipPathSVG:function(r){for(var a=[],i=0,l=this._objects.length;i<l;i++)a.push("	",this._objects[i].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(a,{reviver:r})}}),s.Group.fromObject=function(r,a){var i=r.objects,l=s.util.object.clone(r,!0);if(delete l.objects,typeof i=="string"){s.loadSVGFromURL(i,function(g){var o=s.util.groupSVGElements(g,r,i),f=l.clipPath;delete l.clipPath,o.set(l),f?s.util.enlivenObjects([f],function(m){o.clipPath=m[0],a&&a(o)}):a&&a(o)});return}s.util.enlivenObjects(i,function(g){s.util.enlivenObjectEnlivables(r,l,function(){a&&a(new s.Group(g,l,!0))})})})}(t),function(h){var s=h.fabric||(h.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(u,d){d=d||{},this._objects=u||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;d.originX&&(this.originX=d.originX),d.originY&&(this.originY=d.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,d),this.setCoords()},toGroup:function(){var u=this._objects.concat();this._objects=[];var d=s.Object.prototype.toObject.call(this),r=new s.Group([]);if(delete d.type,r.set(d),u.forEach(function(i){i.canvas.remove(i),i.group=r}),r._objects=u,!this.canvas)return r;var a=this.canvas;return a.add(r),a._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(u,d,r){u.save(),u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var a=0,i=this._objects.length;a<i;a++)this._objects[a]._renderControls(u,r);this.callSuper("_renderControls",u,d),u.restore()}}),s.ActiveSelection.fromObject=function(u,d){s.util.enlivenObjects(u.objects,function(r){delete u.objects,d&&d(new s.ActiveSelection(r,u,!0))})})}(t),function(h){var s=e.util.object.extend;if(h.fabric||(h.fabric={}),h.fabric.Image){e.warn("fabric.Image is already defined.");return}e.Image=e.util.createClass(e.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:e.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:e.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(u,d){d||(d={}),this.filters=[],this.cacheKey="texture"+e.Object.__uid++,this.callSuper("initialize",d),this._initElement(u,d)},getElement:function(){return this._element||{}},setElement:function(u,d){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=u,this._originalElement=u,this._initConfig(d),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(u){var d=e.filterBackend;d&&d.evictCachesForKey&&d.evictCachesForKey(u)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(u){e.util.cleanUpJsdomNode(this[u]),this[u]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var u=this.getElement();return{width:u.naturalWidth||u.width,height:u.naturalHeight||u.height}},_stroke:function(u){if(!(!this.stroke||this.strokeWidth===0)){var d=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-d,-r),u.lineTo(d,-r),u.lineTo(d,r),u.lineTo(-d,r),u.lineTo(-d,-r),u.closePath()}},toObject:function(u){var d=[];this.filters.forEach(function(a){a&&d.push(a.toObject())});var r=s(this.callSuper("toObject",["cropX","cropY"].concat(u)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:d});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var u=[],d=[],r,a=this._element,i=-this.width/2,l=-this.height/2,g="",o="";if(!a)return[];if(this.hasCrop()){var f=e.Object.__uid++;u.push('<clipPath id="imageCrop_'+f+`">
`,'	<rect x="'+i+'" y="'+l+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),g=' clip-path="url(#imageCrop_'+f+')" '}if(this.imageSmoothing||(o='" image-rendering="optimizeSpeed'),d.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',l-this.cropY,'" width="',a.width||a.naturalWidth,'" height="',a.height||a.height,o,'"',g,`></image>
`),this.stroke||this.strokeDashArray){var m=this.fill;this.fill=null,r=["	<rect ",'x="',i,'" y="',l,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=m}return this.paintFirst!=="fill"?u=u.concat(r,d):u=u.concat(d,r),u},getSrc:function(u){var d=u?this._element:this._originalElement;return d?d.toDataURL?d.toDataURL():this.srcFromAttribute?d.getAttribute("src"):d.src:this.src||""},setSrc:function(u,d,r){return e.util.loadImage(u,function(a,i){this.setElement(a,r),this._setWidthHeight(),d&&d(this,i)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var u=this.resizeFilter,d=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),a=r.scaleX,i=r.scaleY,l=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!u||a>d&&i>d){this._element=l,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=a,this._lastScaleY=i;return}e.filterBackend||(e.filterBackend=e.initFilterBackend());var g=e.util.createCanvasElement(),o=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,f=l.width,m=l.height;g.width=f,g.height=m,this._element=g,this._lastScaleX=u.scaleX=a,this._lastScaleY=u.scaleY=i,e.filterBackend.applyFilters([u],l,f,m,this._element,o),this._filterScalingX=g.width/this._originalElement.width,this._filterScalingY=g.height/this._originalElement.height},applyFilters:function(u){if(u=u||this.filters||[],u=u.filter(function(l){return l&&!l.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),u.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var d=this._originalElement,r=d.naturalWidth||d.width,a=d.naturalHeight||d.height;if(this._element===this._originalElement){var i=e.util.createCanvasElement();i.width=r,i.height=a,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,a),this._lastScaleX=1,this._lastScaleY=1;return e.filterBackend||(e.filterBackend=e.initFilterBackend()),e.filterBackend.applyFilters(u,this._originalElement,r,a,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(u),this._renderPaintInOrder(u)},drawCacheOnCanvas:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),e.Object.prototype.drawCacheOnCanvas.call(this,u)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(u){var d=this._element;if(d){var r=this._filterScalingX,a=this._filterScalingY,i=this.width,l=this.height,g=Math.min,o=Math.max,f=o(this.cropX,0),m=o(this.cropY,0),y=d.naturalWidth||d.width,x=d.naturalHeight||d.height,C=f*r,b=m*a,T=g(i*r,y-C),E=g(l*a,x-b),L=-i/2,F=-l/2,H=g(i,y/r-f),J=g(l,x/a-m);d&&u.drawImage(d,C,b,T,E,L,F,H,J)}},_needsResize:function(){var u=this.getTotalObjectScaling();return u.scaleX!==this._lastScaleX||u.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(u,d){this.setElement(e.util.getById(u),d),e.util.addClass(this.getElement(),e.Image.CSS_CANVAS)},_initConfig:function(u){u||(u={}),this.setOptions(u),this._setWidthHeight(u)},_initFilters:function(u,d){u&&u.length?e.util.enlivenObjects(u,function(r){d&&d(r)},"fabric.Image.filters"):d&&d()},_setWidthHeight:function(u){u||(u={});var d=this.getElement();this.width=u.width||d.naturalWidth||d.width||0,this.height=u.height||d.naturalHeight||d.height||0},parsePreserveAspectRatioAttribute:function(){var u=e.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),d=this._element.width,r=this._element.height,a=1,i=1,l=0,g=0,o=0,f=0,m,y=this.width,x=this.height,C={width:y,height:x};return u&&(u.alignX!=="none"||u.alignY!=="none")?(u.meetOrSlice==="meet"&&(a=i=e.util.findScaleToFit(this._element,C),m=(y-d*a)/2,u.alignX==="Min"&&(l=-m),u.alignX==="Max"&&(l=m),m=(x-r*i)/2,u.alignY==="Min"&&(g=-m),u.alignY==="Max"&&(g=m)),u.meetOrSlice==="slice"&&(a=i=e.util.findScaleToCover(this._element,C),m=d-y/a,u.alignX==="Mid"&&(o=m/2),u.alignX==="Max"&&(o=m),m=r-x/i,u.alignY==="Mid"&&(f=m/2),u.alignY==="Max"&&(f=m),d=y/a,r=x/i)):(a=y/d,i=x/r),{width:d,height:r,scaleX:a,scaleY:i,offsetLeft:l,offsetTop:g,cropX:o,cropY:f}}}),e.Image.CSS_CANVAS="canvas-img",e.Image.prototype.getSvgSrc=e.Image.prototype.getSrc,e.Image.fromObject=function(u,d){var r=e.util.object.clone(u);e.util.loadImage(r.src,function(a,i){if(i){d&&d(null,!0);return}e.Image.prototype._initFilters.call(r,r.filters,function(l){r.filters=l||[],e.Image.prototype._initFilters.call(r,[r.resizeFilter],function(g){r.resizeFilter=g[0],e.util.enlivenObjectEnlivables(r,r,function(){var o=new e.Image(a,r);d(o,!1)})})})},null,r.crossOrigin)},e.Image.fromURL=function(u,d,r){e.util.loadImage(u,function(a,i){d&&d(new e.Image(a,r),i)},null,r&&r.crossOrigin)},e.Image.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),e.Image.fromElement=function(u,d,r){var a=e.parseAttributes(u,e.Image.ATTRIBUTE_NAMES);e.Image.fromURL(a["xlink:href"],d,s(r?e.util.object.clone(r):{},a))}}(t),e.util.object.extend(e.Object.prototype,{_getAngleValueForStraighten:function(){var h=this.angle%360;return h>0?Math.round((h-1)/90)*90:Math.round(h/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(h){h=h||{};var s=function(){},u=h.onComplete||s,d=h.onChange||s,r=this;return e.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){r.rotate(a),d()},onComplete:function(){r.setCoords(),u()}})}}),e.util.object.extend(e.StaticCanvas.prototype,{straightenObject:function(h){return h.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(h){return h.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function h(u,d){var r="precision "+d+` float;
void main(){}`,a=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(a,r),u.compileShader(a),!!u.getShaderParameter(a,u.COMPILE_STATUS)}e.isWebglSupported=function(u){if(e.isLikelyNode)return!1;u=u||e.WebglFilterBackend.prototype.tileSize;var d=document.createElement("canvas"),r=d.getContext("webgl")||d.getContext("experimental-webgl"),a=!1;if(r){e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),a=e.maxTextureSize>=u;for(var i=["highp","mediump","lowp"],l=0;l<3;l++)if(h(r,i[l])){e.webGlPrecision=i[l];break}}return this.isSupported=a,a},e.WebglFilterBackend=s;function s(u){u&&u.tileSize&&(this.tileSize=u.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}s.prototype={tileSize:2048,resources:{},setupGLContext:function(u,d){this.dispose(),this.createWebGLCanvas(u,d),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(u,d)},chooseFastestCopyGLTo2DMethod:function(u,d){var r=typeof window.performance<"u",a;try{new ImageData(1,1),a=!0}catch{a=!1}var i=typeof ArrayBuffer<"u",l=typeof Uint8ClampedArray<"u";if(r&&a&&i&&l){var g=e.util.createCanvasElement(),o=new ArrayBuffer(u*d*4);if(e.forceGLPutImageData){this.imageBuffer=o,this.copyGLTo2D=S;return}var f={imageBuffer:o,destinationWidth:u,destinationHeight:d,targetCanvas:g},m,y,x;g.width=u,g.height=d,m=window.performance.now(),v.call(f,this.gl,f),y=window.performance.now()-m,m=window.performance.now(),S.call(f,this.gl,f),x=window.performance.now()-m,y>x?(this.imageBuffer=o,this.copyGLTo2D=S):this.copyGLTo2D=v}},createWebGLCanvas:function(u,d){var r=e.util.createCanvasElement();r.width=u,r.height=d;var a={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=r.getContext("webgl",a);i||(i=r.getContext("experimental-webgl",a)),i&&(i.clearColor(0,0,0,0),this.canvas=r,this.gl=i)},applyFilters:function(u,d,r,a,i,l){var g=this.gl,o;l&&(o=this.getCachedTexture(l,d));var f={originalWidth:d.width||d.originalWidth,originalHeight:d.height||d.originalHeight,sourceWidth:r,sourceHeight:a,destinationWidth:r,destinationHeight:a,context:g,sourceTexture:this.createTexture(g,r,a,!o&&d),targetTexture:this.createTexture(g,r,a),originalTexture:o||this.createTexture(g,r,a,!o&&d),passes:u.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},m=g.createFramebuffer();return g.bindFramebuffer(g.FRAMEBUFFER,m),u.forEach(function(y){y&&y.applyTo(f)}),p(f),this.copyGLTo2D(g,f),g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(f.sourceTexture),g.deleteTexture(f.targetTexture),g.deleteFramebuffer(m),i.getContext("2d").setTransform(1,0,0,1,0,0),f},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(u,d,r,a,i){var l=u.createTexture();return u.bindTexture(u.TEXTURE_2D,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),a?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,a):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,d,r,0,u.RGBA,u.UNSIGNED_BYTE,null),l},getCachedTexture:function(u,d){if(this.textureCache[u])return this.textureCache[u];var r=this.createTexture(this.gl,d.width,d.height,d);return this.textureCache[u]=r,r},evictCachesForKey:function(u){this.textureCache[u]&&(this.gl.deleteTexture(this.textureCache[u]),delete this.textureCache[u])},copyGLTo2D:v,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var u=this.gl,d={renderer:"",vendor:""};if(!u)return d;var r=u.getExtension("WEBGL_debug_renderer_info");if(r){var a=u.getParameter(r.UNMASKED_RENDERER_WEBGL),i=u.getParameter(r.UNMASKED_VENDOR_WEBGL);a&&(d.renderer=a.toLowerCase()),i&&(d.vendor=i.toLowerCase())}return this.gpuInfo=d,d}}}();function p(h){var s=h.targetCanvas,u=s.width,d=s.height,r=h.destinationWidth,a=h.destinationHeight;(u!==r||d!==a)&&(s.width=r,s.height=a)}function v(h,s){var u=h.canvas,d=s.targetCanvas,r=d.getContext("2d");r.translate(0,d.height),r.scale(1,-1);var a=u.height-d.height;r.drawImage(u,0,a,d.width,d.height,0,0,d.width,d.height)}function S(h,s){var u=s.targetCanvas,d=u.getContext("2d"),r=s.destinationWidth,a=s.destinationHeight,i=r*a*4,l=new Uint8Array(this.imageBuffer,0,i),g=new Uint8ClampedArray(this.imageBuffer,0,i);h.readPixels(0,0,r,a,h.RGBA,h.UNSIGNED_BYTE,l);var o=new ImageData(g,r,a);d.putImageData(o,0,0)}(function(){var h=function(){};e.Canvas2dFilterBackend=s;function s(){}s.prototype={evictCachesForKey:h,dispose:h,clearWebGLCaches:h,resources:{},applyFilters:function(u,d,r,a,i){var l=i.getContext("2d");l.drawImage(d,0,0,r,a);var g=l.getImageData(0,0,r,a),o=l.getImageData(0,0,r,a),f={sourceWidth:r,sourceHeight:a,imageData:g,originalEl:d,originalImageData:o,canvasEl:i,ctx:l,filterBackend:this};return u.forEach(function(m){m.applyTo(f)}),(f.imageData.width!==r||f.imageData.height!==a)&&(i.width=f.imageData.width,i.height=f.imageData.height),l.putImageData(f.imageData,0,0),f}}})(),e.Image=e.Image||{},e.Image.filters=e.Image.filters||{},e.Image.filters.BaseFilter=e.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(h){h&&this.setOptions(h)},setOptions:function(h){for(var s in h)this[s]=h[s]},createProgram:function(h,s,u){s=s||this.fragmentSource,u=u||this.vertexSource,e.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+e.webGlPrecision+" float"));var d=h.createShader(h.VERTEX_SHADER);if(h.shaderSource(d,u),h.compileShader(d),!h.getShaderParameter(d,h.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+h.getShaderInfoLog(d));var r=h.createShader(h.FRAGMENT_SHADER);if(h.shaderSource(r,s),h.compileShader(r),!h.getShaderParameter(r,h.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+h.getShaderInfoLog(r));var a=h.createProgram();if(h.attachShader(a,d),h.attachShader(a,r),h.linkProgram(a),!h.getProgramParameter(a,h.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+h.getProgramInfoLog(a));var i=this.getAttributeLocations(h,a),l=this.getUniformLocations(h,a)||{};return l.uStepW=h.getUniformLocation(a,"uStepW"),l.uStepH=h.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:i,uniformLocations:l}},getAttributeLocations:function(h,s){return{aPosition:h.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(h,s,u){var d=s.aPosition,r=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,r),h.enableVertexAttribArray(d),h.vertexAttribPointer(d,2,h.FLOAT,!1,0,0),h.bufferData(h.ARRAY_BUFFER,u,h.STATIC_DRAW)},_setupFrameBuffer:function(h){var s=h.context,u,d;h.passes>1?(u=h.destinationWidth,d=h.destinationHeight,(h.sourceWidth!==u||h.sourceHeight!==d)&&(s.deleteTexture(h.targetTexture),h.targetTexture=h.filterBackend.createTexture(s,u,d)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,h.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(h){h.passes--,h.pass++;var s=h.targetTexture;h.targetTexture=h.sourceTexture,h.sourceTexture=s},isNeutralState:function(){var h=this.mainParameter,s=e.Image.filters[this.type].prototype;if(h)if(Array.isArray(s[h])){for(var u=s[h].length;u--;)if(this[h][u]!==s[h][u])return!1;return!0}else return s[h]===this[h];else return!1},applyTo:function(h){h.webgl?(this._setupFrameBuffer(h),this.applyToWebGL(h),this._swapTextures(h)):this.applyTo2d(h)},retrieveShader:function(h){return h.programCache.hasOwnProperty(this.type)||(h.programCache[this.type]=this.createProgram(h.context)),h.programCache[this.type]},applyToWebGL:function(h){var s=h.context,u=this.retrieveShader(h);h.pass===0&&h.originalTexture?s.bindTexture(s.TEXTURE_2D,h.originalTexture):s.bindTexture(s.TEXTURE_2D,h.sourceTexture),s.useProgram(u.program),this.sendAttributeData(s,u.attributeLocations,h.aPosition),s.uniform1f(u.uniformLocations.uStepW,1/h.sourceWidth),s.uniform1f(u.uniformLocations.uStepH,1/h.sourceHeight),this.sendUniformData(s,u.uniformLocations),s.viewport(0,0,h.destinationWidth,h.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(h,s,u){h.activeTexture(u),h.bindTexture(h.TEXTURE_2D,s),h.activeTexture(h.TEXTURE0)},unbindAdditionalTexture:function(h,s){h.activeTexture(s),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(h){this[this.mainParameter]=h},sendUniformData:function(){},createHelpLayer:function(h){if(!h.helpLayer){var s=document.createElement("canvas");s.width=h.sourceWidth,s.height=h.sourceHeight,h.helpLayer=s}},toObject:function(){var h={type:this.type},s=this.mainParameter;return s&&(h[s]=this[s]),h},toJSON:function(){return this.toObject()}}),e.Image.filters.BaseFilter.fromObject=function(h,s){var u=new e.Image.filters[h.type](h);return s&&s(u),u},function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.ColorMatrix=d(u.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var a=r.imageData,i=a.data,l=i.length,g=this.matrix,o,f,m,y,x,C=this.colorsOnly;for(x=0;x<l;x+=4)o=i[x],f=i[x+1],m=i[x+2],C?(i[x]=o*g[0]+f*g[1]+m*g[2]+g[4]*255,i[x+1]=o*g[5]+f*g[6]+m*g[7]+g[9]*255,i[x+2]=o*g[10]+f*g[11]+m*g[12]+g[14]*255):(y=i[x+3],i[x]=o*g[0]+f*g[1]+m*g[2]+y*g[3]+g[4]*255,i[x+1]=o*g[5]+f*g[6]+m*g[7]+y*g[8]+g[9]*255,i[x+2]=o*g[10]+f*g[11]+m*g[12]+y*g[13]+g[14]*255,i[x+3]=o*g[15]+f*g[16]+m*g[17]+y*g[18]+g[19]*255)},getUniformLocations:function(r,a){return{uColorMatrix:r.getUniformLocation(a,"uColorMatrix"),uConstants:r.getUniformLocation(a,"uConstants")}},sendUniformData:function(r,a){var i=this.matrix,l=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],g=[i[4],i[9],i[14],i[19]];r.uniformMatrix4fv(a.uColorMatrix,!1,l),r.uniform4fv(a.uConstants,g)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Brightness=d(u.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var a=r.imageData,i=a.data,l,g=i.length,o=Math.round(this.brightness*255);for(l=0;l<g;l+=4)i[l]=i[l]+o,i[l+1]=i[l+1]+o,i[l+2]=i[l+2]+o}},getUniformLocations:function(r,a){return{uBrightness:r.getUniformLocation(a,"uBrightness")}},sendUniformData:function(r,a){r.uniform1f(a.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,d=s.Image.filters,r=s.util.createClass;d.Convolute=r(d.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(a){var i=Math.sqrt(this.matrix.length),l=this.type+"_"+i+"_"+(this.opaque?1:0),g=this.fragmentSource[l];return a.programCache.hasOwnProperty(l)||(a.programCache[l]=this.createProgram(a.context,g)),a.programCache[l]},applyTo2d:function(a){var i=a.imageData,l=i.data,g=this.matrix,o=Math.round(Math.sqrt(g.length)),f=Math.floor(o/2),m=i.width,y=i.height,x=a.ctx.createImageData(m,y),C=x.data,b=this.opaque?1:0,T,E,L,F,H,J,q,Q,te,oe,ce,X,_;for(ce=0;ce<y;ce++)for(oe=0;oe<m;oe++){for(H=(ce*m+oe)*4,T=0,E=0,L=0,F=0,_=0;_<o;_++)for(X=0;X<o;X++)q=ce+_-f,J=oe+X-f,!(q<0||q>=y||J<0||J>=m)&&(Q=(q*m+J)*4,te=g[_*o+X],T+=l[Q]*te,E+=l[Q+1]*te,L+=l[Q+2]*te,b||(F+=l[Q+3]*te));C[H]=T,C[H+1]=E,C[H+2]=L,b?C[H+3]=l[H+3]:C[H+3]=F}a.imageData=x},getUniformLocations:function(a,i){return{uMatrix:a.getUniformLocation(i,"uMatrix"),uOpaque:a.getUniformLocation(i,"uOpaque"),uHalfSize:a.getUniformLocation(i,"uHalfSize"),uSize:a.getUniformLocation(i,"uSize")}},sendUniformData:function(a,i){a.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return u(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Grayscale=d(u.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var a=r.imageData,i=a.data,l,g=i.length,o,f=this.mode;for(l=0;l<g;l+=4)f==="average"?o=(i[l]+i[l+1]+i[l+2])/3:f==="lightness"?o=(Math.min(i[l],i[l+1],i[l+2])+Math.max(i[l],i[l+1],i[l+2]))/2:f==="luminosity"&&(o=.21*i[l]+.72*i[l+1]+.07*i[l+2]),i[l]=o,i[l+1]=o,i[l+2]=o},retrieveShader:function(r){var a=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(a)){var i=this.fragmentSource[this.mode];r.programCache[a]=this.createProgram(r.context,i)}return r.programCache[a]},getUniformLocations:function(r,a){return{uMode:r.getUniformLocation(a,"uMode")}},sendUniformData:function(r,a){var i=1;r.uniform1i(a.uMode,i)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Invert=d(u.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var a=r.imageData,i=a.data,l,g=i.length;for(l=0;l<g;l+=4)i[l]=255-i[l],i[l+1]=255-i[l+1],i[l+2]=255-i[l+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,a){return{uInvert:r.getUniformLocation(a,"uInvert")}},sendUniformData:function(r,a){r.uniform1i(a.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,d=s.Image.filters,r=s.util.createClass;d.Noise=r(d.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(a){if(this.noise!==0){var i=a.imageData,l=i.data,g,o=l.length,f=this.noise,m;for(g=0,o=l.length;g<o;g+=4)m=(.5-Math.random())*f,l[g]+=m,l[g+1]+=m,l[g+2]+=m}},getUniformLocations:function(a,i){return{uNoise:a.getUniformLocation(i,"uNoise"),uSeed:a.getUniformLocation(i,"uSeed")}},sendUniformData:function(a,i){a.uniform1f(i.uNoise,this.noise/255),a.uniform1f(i.uSeed,Math.random())},toObject:function(){return u(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Pixelate=d(u.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var a=r.imageData,i=a.data,l=a.height,g=a.width,o,f,m,y,x,C,b,T,E,L,F;for(f=0;f<l;f+=this.blocksize)for(m=0;m<g;m+=this.blocksize)for(o=f*4*g+m*4,y=i[o],x=i[o+1],C=i[o+2],b=i[o+3],L=Math.min(f+this.blocksize,l),F=Math.min(m+this.blocksize,g),T=f;T<L;T++)for(E=m;E<F;E++)o=T*4*g+E*4,i[o]=y,i[o+1]=x,i[o+2]=C,i[o+3]=b},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,a){return{uBlocksize:r.getUniformLocation(a,"uBlocksize"),uStepW:r.getUniformLocation(a,"uStepW"),uStepH:r.getUniformLocation(a,"uStepH")}},sendUniformData:function(r,a){r.uniform1f(a.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,d=s.Image.filters,r=s.util.createClass;d.RemoveColor=r(d.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(a){var i=a.imageData,l=i.data,g,o=this.distance*255,f,m,y,x=new s.Color(this.color).getSource(),C=[x[0]-o,x[1]-o,x[2]-o],b=[x[0]+o,x[1]+o,x[2]+o];for(g=0;g<l.length;g+=4)f=l[g],m=l[g+1],y=l[g+2],f>C[0]&&m>C[1]&&y>C[2]&&f<b[0]&&m<b[1]&&y<b[2]&&(l[g+3]=0)},getUniformLocations:function(a,i){return{uLow:a.getUniformLocation(i,"uLow"),uHigh:a.getUniformLocation(i,"uHigh")}},sendUniformData:function(a,i){var l=new s.Color(this.color).getSource(),g=parseFloat(this.distance),o=[0+l[0]/255-g,0+l[1]/255-g,0+l[2]/255-g,1],f=[l[0]/255+g,l[1]/255+g,l[2]/255+g,1];a.uniform4fv(i.uLow,o),a.uniform4fv(i.uHigh,f)},toObject:function(){return u(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in r)u[a]=d(u.ColorMatrix,{type:a,matrix:r[a],mainParameter:!1,colorsOnly:!0}),s.Image.filters[a].fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric,u=s.Image.filters,d=s.util.createClass;u.BlendColor=d(u.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var a=this.type+"_"+this.mode,i;return r.programCache.hasOwnProperty(a)||(i=this.buildSource(this.mode),r.programCache[a]=this.createProgram(r.context,i)),r.programCache[a]},applyTo2d:function(r){var a=r.imageData,i=a.data,l=i.length,g,o,f,m,y,x,C,b=1-this.alpha;C=new s.Color(this.color).getSource(),g=C[0]*this.alpha,o=C[1]*this.alpha,f=C[2]*this.alpha;for(var T=0;T<l;T+=4)switch(m=i[T],y=i[T+1],x=i[T+2],this.mode){case"multiply":i[T]=m*g/255,i[T+1]=y*o/255,i[T+2]=x*f/255;break;case"screen":i[T]=255-(255-m)*(255-g)/255,i[T+1]=255-(255-y)*(255-o)/255,i[T+2]=255-(255-x)*(255-f)/255;break;case"add":i[T]=m+g,i[T+1]=y+o,i[T+2]=x+f;break;case"diff":case"difference":i[T]=Math.abs(m-g),i[T+1]=Math.abs(y-o),i[T+2]=Math.abs(x-f);break;case"subtract":i[T]=m-g,i[T+1]=y-o,i[T+2]=x-f;break;case"darken":i[T]=Math.min(m,g),i[T+1]=Math.min(y,o),i[T+2]=Math.min(x,f);break;case"lighten":i[T]=Math.max(m,g),i[T+1]=Math.max(y,o),i[T+2]=Math.max(x,f);break;case"overlay":i[T]=g<128?2*m*g/255:255-2*(255-m)*(255-g)/255,i[T+1]=o<128?2*y*o/255:255-2*(255-y)*(255-o)/255,i[T+2]=f<128?2*x*f/255:255-2*(255-x)*(255-f)/255;break;case"exclusion":i[T]=g+m-2*g*m/255,i[T+1]=o+y-2*o*y/255,i[T+2]=f+x-2*f*x/255;break;case"tint":i[T]=g+m*b,i[T+1]=o+y*b,i[T+2]=f+x*b}},getUniformLocations:function(r,a){return{uColor:r.getUniformLocation(a,"uColor")}},sendUniformData:function(r,a){var i=new s.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,r.uniform4fv(a.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric,u=s.Image.filters,d=s.util.createClass;u.BlendImage=d(u.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var a=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(a)||(r.programCache[a]=this.createProgram(r.context,i)),r.programCache[a]},applyToWebGL:function(r){var a=r.context,i=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(a,i,a.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(r,a){return r.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var r=this.image,a=r._element.width,i=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/a,-r.top/i,1]},applyTo2d:function(r){var a=r.imageData,i=r.filterBackend.resources,l=a.data,g=l.length,o=a.width,f=a.height,m,y,x,C,b,T,E,L,F,H,J=this.image,q;i.blendImage||(i.blendImage=s.util.createCanvasElement()),F=i.blendImage,H=F.getContext("2d"),F.width!==o||F.height!==f?(F.width=o,F.height=f):H.clearRect(0,0,o,f),H.setTransform(J.scaleX,0,0,J.scaleY,J.left,J.top),H.drawImage(J._element,0,0,o,f),q=H.getImageData(0,0,o,f).data;for(var Q=0;Q<g;Q+=4)switch(b=l[Q],T=l[Q+1],E=l[Q+2],L=l[Q+3],m=q[Q],y=q[Q+1],x=q[Q+2],C=q[Q+3],this.mode){case"multiply":l[Q]=b*m/255,l[Q+1]=T*y/255,l[Q+2]=E*x/255,l[Q+3]=L*C/255;break;case"mask":l[Q+3]=C;break}},getUniformLocations:function(r,a){return{uTransformMatrix:r.getUniformLocation(a,"uTransformMatrix"),uImage:r.getUniformLocation(a,"uImage")}},sendUniformData:function(r,a){var i=this.calculateMatrix();r.uniform1i(a.uImage,1),r.uniformMatrix3fv(a.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(r,a){s.Image.fromObject(r.image,function(i){var l=s.util.object.clone(r);l.image=i,a(new s.Image.filters.BlendImage(l))})}}(t),function(h){var s=h.fabric||(h.fabric={}),u=Math.pow,d=Math.floor,r=Math.sqrt,a=Math.abs,i=Math.round,l=Math.sin,g=Math.ceil,o=s.Image.filters,f=s.util.createClass;o.Resize=f(o.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(m,y){return{uDelta:m.getUniformLocation(y,"uDelta"),uTaps:m.getUniformLocation(y,"uTaps")}},sendUniformData:function(m,y){m.uniform2fv(y.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),m.uniform1fv(y.uTaps,this.taps)},retrieveShader:function(m){var y=this.getFilterWindow(),x=this.type+"_"+y;if(!m.programCache.hasOwnProperty(x)){var C=this.generateShader(y);m.programCache[x]=this.createProgram(m.context,C)}return m.programCache[x]},getFilterWindow:function(){var m=this.tempScale;return Math.ceil(this.lanczosLobes/m)},getTaps:function(){for(var m=this.lanczosCreate(this.lanczosLobes),y=this.tempScale,x=this.getFilterWindow(),C=new Array(x),b=1;b<=x;b++)C[b-1]=m(b*y);return C},generateShader:function(C){for(var y=new Array(C),x=this.fragmentSourceTOP,C,b=1;b<=C;b++)y[b-1]=b+".0 * uDelta";return x+="uniform float uTaps["+C+`];
`,x+=`void main() {
`,x+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,x+=`  float sum = 1.0;
`,y.forEach(function(T,E){x+="  color += texture2D(uTexture, vTexCoord + "+T+") * uTaps["+E+`];
`,x+="  color += texture2D(uTexture, vTexCoord - "+T+") * uTaps["+E+`];
`,x+="  sum += 2.0 * uTaps["+E+`];
`}),x+=`  gl_FragColor = color / sum;
`,x+="}",x},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(m){m.webgl?(m.passes++,this.width=m.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=m.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),m.destinationWidth=this.dW,this._setupFrameBuffer(m),this.applyToWebGL(m),this._swapTextures(m),m.sourceWidth=m.destinationWidth,this.height=m.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),m.destinationHeight=this.dH,this._setupFrameBuffer(m),this.applyToWebGL(m),this._swapTextures(m),m.sourceHeight=m.destinationHeight):this.applyTo2d(m)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(m){return function(y){if(y>=m||y<=-m)return 0;if(y<11920929e-14&&y>-11920929e-14)return 1;y*=Math.PI;var x=y/m;return l(y)/y*l(x)/x}},applyTo2d:function(m){var y=m.imageData,x=this.scaleX,C=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/C;var b=y.width,T=y.height,E=i(b*x),L=i(T*C),F;this.resizeType==="sliceHack"?F=this.sliceByTwo(m,b,T,E,L):this.resizeType==="hermite"?F=this.hermiteFastResize(m,b,T,E,L):this.resizeType==="bilinear"?F=this.bilinearFiltering(m,b,T,E,L):this.resizeType==="lanczos"&&(F=this.lanczosResize(m,b,T,E,L)),m.imageData=F},sliceByTwo:function(m,y,x,C,b){var T=m.imageData,E=.5,L=!1,F=!1,H=y*E,J=x*E,q=s.filterBackend.resources,Q,te,oe=0,ce=0,X=y,_=0;for(q.sliceByTwo||(q.sliceByTwo=document.createElement("canvas")),Q=q.sliceByTwo,(Q.width<y*1.5||Q.height<x)&&(Q.width=y*1.5,Q.height=x),te=Q.getContext("2d"),te.clearRect(0,0,y*1.5,x),te.putImageData(T,0,0),C=d(C),b=d(b);!L||!F;)y=H,x=J,C<d(H*E)?H=d(H*E):(H=C,L=!0),b<d(J*E)?J=d(J*E):(J=b,F=!0),te.drawImage(Q,oe,ce,y,x,X,_,H,J),oe=X,ce=_,_+=J;return te.getImageData(oe,ce,C,b)},lanczosResize:function(m,y,x,C,b){function T(A){var O,z,P,k,D,R,Y,G,K,Z,se;for(_.x=(A+.5)*J,j.x=d(_.x),O=0;O<b;O++){for(_.y=(O+.5)*q,j.y=d(_.y),D=0,R=0,Y=0,G=0,K=0,z=j.x-oe;z<=j.x+oe;z++)if(!(z<0||z>=y)){Z=d(1e3*a(z-_.x)),X[Z]||(X[Z]={});for(var V=j.y-ce;V<=j.y+ce;V++)V<0||V>=x||(se=d(1e3*a(V-_.y)),X[Z][se]||(X[Z][se]=H(r(u(Z*Q,2)+u(se*te,2))/1e3)),P=X[Z][se],P>0&&(k=(V*y+z)*4,D+=P,R+=P*E[k],Y+=P*E[k+1],G+=P*E[k+2],K+=P*E[k+3]))}k=(O*C+A)*4,F[k]=R/D,F[k+1]=Y/D,F[k+2]=G/D,F[k+3]=K/D}return++A<C?T(A):L}var E=m.imageData.data,L=m.ctx.createImageData(C,b),F=L.data,H=this.lanczosCreate(this.lanczosLobes),J=this.rcpScaleX,q=this.rcpScaleY,Q=2/this.rcpScaleX,te=2/this.rcpScaleY,oe=g(J*this.lanczosLobes/2),ce=g(q*this.lanczosLobes/2),X={},_={},j={};return T(0)},bilinearFiltering:function(m,y,x,C,b){var T,E,L,F,H,J,q,Q,te,oe,ce,X,_=0,j,A=this.rcpScaleX,O=this.rcpScaleY,z=4*(y-1),P=m.imageData,k=P.data,D=m.ctx.createImageData(C,b),R=D.data;for(q=0;q<b;q++)for(Q=0;Q<C;Q++)for(H=d(A*Q),J=d(O*q),te=A*Q-H,oe=O*q-J,j=4*(J*y+H),ce=0;ce<4;ce++)T=k[j+ce],E=k[j+4+ce],L=k[j+z+ce],F=k[j+z+4+ce],X=T*(1-te)*(1-oe)+E*te*(1-oe)+L*oe*(1-te)+F*te*oe,R[_++]=X;return D},hermiteFastResize:function(m,y,x,C,b){for(var T=this.rcpScaleX,E=this.rcpScaleY,L=g(T/2),F=g(E/2),H=m.imageData,J=H.data,q=m.ctx.createImageData(C,b),Q=q.data,te=0;te<b;te++)for(var oe=0;oe<C;oe++){for(var ce=(oe+te*C)*4,X=0,_=0,j=0,A=0,O=0,z=0,P=0,k=(te+.5)*E,D=d(te*E);D<(te+1)*E;D++)for(var R=a(k-(D+.5))/F,Y=(oe+.5)*T,G=R*R,K=d(oe*T);K<(oe+1)*T;K++){var Z=a(Y-(K+.5))/L,se=r(G+Z*Z);se>1&&se<-1||(X=2*se*se*se-3*se*se+1,X>0&&(Z=4*(K+D*y),P+=X*J[Z+3],j+=X,J[Z+3]<255&&(X=X*J[Z+3]/250),A+=X*J[Z],O+=X*J[Z+1],z+=X*J[Z+2],_+=X))}Q[ce]=A/_,Q[ce+1]=O/_,Q[ce+2]=z/_,Q[ce+3]=P/j}return q},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Contrast=d(u.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var a=r.imageData,i,g,l=a.data,g=l.length,o=Math.floor(this.contrast*255),f=259*(o+255)/(255*(259-o));for(i=0;i<g;i+=4)l[i]=f*(l[i]-128)+128,l[i+1]=f*(l[i+1]-128)+128,l[i+2]=f*(l[i+2]-128)+128}},getUniformLocations:function(r,a){return{uContrast:r.getUniformLocation(a,"uContrast")}},sendUniformData:function(r,a){r.uniform1f(a.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Saturation=d(u.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var a=r.imageData,i=a.data,l=i.length,g=-this.saturation,o,f;for(o=0;o<l;o+=4)f=Math.max(i[o],i[o+1],i[o+2]),i[o]+=f!==i[o]?(f-i[o])*g:0,i[o+1]+=f!==i[o+1]?(f-i[o+1])*g:0,i[o+2]+=f!==i[o+2]?(f-i[o+2])*g:0}},getUniformLocations:function(r,a){return{uSaturation:r.getUniformLocation(a,"uSaturation")}},sendUniformData:function(r,a){r.uniform1f(a.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Vibrance=d(u.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var a=r.imageData,i=a.data,l=i.length,g=-this.vibrance,o,f,m,y;for(o=0;o<l;o+=4)f=Math.max(i[o],i[o+1],i[o+2]),m=(i[o]+i[o+1]+i[o+2])/3,y=Math.abs(f-m)*2/255*g,i[o]+=f!==i[o]?(f-i[o])*y:0,i[o+1]+=f!==i[o+1]?(f-i[o+1])*y:0,i[o+2]+=f!==i[o+2]?(f-i[o+2])*y:0}},getUniformLocations:function(r,a){return{uVibrance:r.getUniformLocation(a,"uVibrance")}},sendUniformData:function(r,a){r.uniform1f(a.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Blur=d(u.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var a=r.filterBackend.resources,i,l,g=r.imageData.width,o=r.imageData.height;a.blurLayer1||(a.blurLayer1=s.util.createCanvasElement(),a.blurLayer2=s.util.createCanvasElement()),i=a.blurLayer1,l=a.blurLayer2,(i.width!==g||i.height!==o)&&(l.width=i.width=g,l.height=i.height=o);var f=i.getContext("2d"),m=l.getContext("2d"),y=15,x,C,b,T,E=this.blur*.06*.5;for(f.putImageData(r.imageData,0,0),m.clearRect(0,0,g,o),T=-y;T<=y;T++)x=(Math.random()-.5)/4,C=T/y,b=E*C*g+x,m.globalAlpha=1-Math.abs(C),m.drawImage(i,b,x),f.drawImage(l,0,0),m.globalAlpha=1,m.clearRect(0,0,l.width,l.height);for(T=-y;T<=y;T++)x=(Math.random()-.5)/4,C=T/y,b=E*C*o+x,m.globalAlpha=1-Math.abs(C),m.drawImage(i,x,b),f.drawImage(l,0,0),m.globalAlpha=1,m.clearRect(0,0,l.width,l.height);r.ctx.drawImage(i,0,0);var L=r.ctx.getImageData(0,0,i.width,i.height);return f.globalAlpha=1,f.clearRect(0,0,i.width,i.height),L},getUniformLocations:function(r,a){return{delta:r.getUniformLocation(a,"uDelta")}},sendUniformData:function(r,a){var i=this.chooseRightDelta();r.uniform2fv(a.delta,i)},chooseRightDelta:function(){var r=1,a=[0,0],i;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),i=r*this.blur*.12,this.horizontal?a[0]=i:a[1]=i,a}}),u.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Gamma=d(u.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],u.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var a=r.imageData,i=a.data,l=this.gamma,g=i.length,o=1/l[0],f=1/l[1],m=1/l[2],y;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),y=0,g=256;y<g;y++)this.rVals[y]=Math.pow(y/255,o)*255,this.gVals[y]=Math.pow(y/255,f)*255,this.bVals[y]=Math.pow(y/255,m)*255;for(y=0,g=i.length;y<g;y+=4)i[y]=this.rVals[i[y]],i[y+1]=this.gVals[i[y+1]],i[y+2]=this.bVals[i[y+2]]},getUniformLocations:function(r,a){return{uGamma:r.getUniformLocation(a,"uGamma")}},sendUniformData:function(r,a){r.uniform3fv(a.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.Composed=d(u.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(a){a.applyTo(r)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(r,a){var i=r.subFilters||[],l=i.map(function(o){return new s.Image.filters[o.type](o)}),g=new s.Image.filters.Composed({subFilters:l});return a&&a(g),g}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,d=s.util.createClass;u.HueRotation=d(u.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,a=s.util.cos(r),i=s.util.sin(r),l=1/3,g=Math.sqrt(l)*i,o=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=a+o/3,this.matrix[1]=l*o-g,this.matrix[2]=l*o+g,this.matrix[5]=l*o+g,this.matrix[6]=a+l*o,this.matrix[7]=l*o-g,this.matrix[10]=l*o-g,this.matrix[11]=l*o+g,this.matrix[12]=a+l*o},isNeutralState:function(r){return this.calculateMatrix(),u.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),u.BaseFilter.prototype.applyTo.call(this,r)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.clone;if(s.Text){s.warn("fabric.Text is already defined");return}var d="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(d),cacheProperties:s.Object.prototype.cacheProperties.concat(d),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,a){this.styles=a?a.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",a),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=s.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){if(!this.__skipDimension){if(this._splitText(),this._clearCache(),this.path){var r=this.getHeightOfLine(0)*1.1;this.width=this.path.width+r,this.height=this.path.height+r}else this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight();this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"})}},enlargeSpaces:function(){for(var r,a,i,l,g,o,f,m=0,y=this._textLines.length;m<y;m++)if(!(this.textAlign!=="justify"&&(m===y-1||this.isEndOfWrapping(m)))&&(l=0,g=this._textLines[m],a=this.getLineWidth(m),a<this.width&&(f=this.textLines[m].match(this._reSpacesAndTabs)))){i=f.length,r=(this.width-a)/i;for(var x=0,C=g.length;x<=C;x++)o=this.__charBounds[m][x],this._reSpaceAndTab.test(g[x])?(o.width+=r,o.kernedWidth+=r,o.left+=l,l+=r):o.left+=l}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),a=this.fontSize;return r.width+=a*r.zoomX,r.height+=a*r.zoomY,r},_render:function(r){var a=this.path;a&&!a.isNotVisible()&&a._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,a,i){if(r.textBaseline="alphabetic",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(a,i)},calcTextWidth:function(){for(var r=this.getLineWidth(0),a=1,i=this._textLines.length;a<i;a++){var l=this.getLineWidth(a);l>r&&(r=l)}return r},_renderTextLine:function(r,a,i,l,g,o){this._renderChars(r,a,i,l,g,o)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var a,i,l=r.fillStyle,g,o,f=this._getLeftOffset(),m=this._getTopOffset(),y=0,x=0,C,b,T=this.path,E,L=0,F=this._textLines.length;L<F;L++){if(a=this.getHeightOfLine(L),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",L)){m+=a;continue}g=this._textLines[L],i=this._getLineLeftOffset(L),x=0,y=0,o=this.getValueOfPropertyAt(L,0,"textBackgroundColor");for(var H=0,J=g.length;H<J;H++)C=this.__charBounds[L][H],b=this.getValueOfPropertyAt(L,H,"textBackgroundColor"),T?(r.save(),r.translate(C.renderLeft,C.renderTop),r.rotate(C.angle),r.fillStyle=b,b&&r.fillRect(-C.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),C.width,a/this.lineHeight),r.restore()):b!==o?(E=f+i+y,this.direction==="rtl"&&(E=this.width-E-x),r.fillStyle=o,o&&r.fillRect(E,m,x,a/this.lineHeight),y=C.left,x=C.width,o=b):x+=C.kernedWidth;b&&!T&&(E=f+i+y,this.direction==="rtl"&&(E=this.width-E-x),r.fillStyle=b,r.fillRect(E,m,x,a/this.lineHeight)),m+=a}r.fillStyle=l,this._removeShadow(r)}},getFontCache:function(r){var a=r.fontFamily.toLowerCase();s.charWidthsCache[a]||(s.charWidthsCache[a]={});var i=s.charWidthsCache[a],l=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return i[l]||(i[l]={}),i[l]},_measureChar:function(r,a,i,l){var g=this.getFontCache(a),o=this._getFontDeclaration(a),f=this._getFontDeclaration(l),m=i+r,y=o===f,x,C,b,T=a.fontSize/this.CACHE_FONT_SIZE,E;if(i&&g[i]!==void 0&&(b=g[i]),g[r]!==void 0&&(E=x=g[r]),y&&g[m]!==void 0&&(C=g[m],E=C-b),x===void 0||b===void 0||C===void 0){var L=this.getMeasuringContext();this._setTextStyles(L,a,!0)}return x===void 0&&(E=x=L.measureText(r).width,g[r]=x),b===void 0&&y&&i&&(b=L.measureText(i).width,g[i]=b),y&&C===void 0&&(C=L.measureText(m).width,g[m]=C,E=C-b),{width:x*T,kernedWidth:E*T}},getHeightOfChar:function(r,a){return this.getValueOfPropertyAt(r,a,"fontSize")},measureLine:function(r){var a=this._measureLine(r);return this.charSpacing!==0&&(a.width-=this._getWidthOfCharSpacing()),a.width<0&&(a.width=0),a},_measureLine:function(r){var a=0,i,l,g=this._textLines[r],o,f,m=0,y=new Array(g.length),x=0,C,b,T=this.path,E=this.pathSide==="right";for(this.__charBounds[r]=y,i=0;i<g.length;i++)l=g[i],f=this._getGraphemeBox(l,r,i,o),y[i]=f,a+=f.kernedWidth,o=l;if(y[i]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},T){switch(b=T.segmentsInfo[T.segmentsInfo.length-1].length,C=s.util.getPointOnPath(T.path,0,T.segmentsInfo),C.x+=T.pathOffset.x,C.y+=T.pathOffset.y,this.textAlign){case"left":x=E?b-a:0;break;case"center":x=(b-a)/2;break;case"right":x=E?0:b-a;break}for(x+=this.pathStartOffset*(E?-1:1),i=E?g.length-1:0;E?i>=0:i<g.length;E?i--:i++)f=y[i],x>b?x%=b:x<0&&(x+=b),this._setGraphemeOnPath(x,f,C),x+=f.kernedWidth}return{width:a,numOfSpaces:m}},_setGraphemeOnPath:function(r,a,i){var l=r+a.kernedWidth/2,g=this.path,o=s.util.getPointOnPath(g.path,l,g.segmentsInfo);a.renderLeft=o.x-i.x,a.renderTop=o.y-i.y,a.angle=o.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,a,i,l,g){var o=this.getCompleteStyleDeclaration(a,i),f=l?this.getCompleteStyleDeclaration(a,i-1):{},m=this._measureChar(r,o,l,f),y=m.kernedWidth,x=m.width,C;this.charSpacing!==0&&(C=this._getWidthOfCharSpacing(),x+=C,y+=C);var b={width:x,left:0,height:o.fontSize,kernedWidth:y,deltaY:o.deltaY};if(i>0&&!g){var T=this.__charBounds[a][i-1];b.left=T.left+T.width+m.kernedWidth-m.width}return b},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var a=this._textLines[r],i=this.getHeightOfChar(r,0),l=1,g=a.length;l<g;l++)i=Math.max(this.getHeightOfChar(r,l),i);return this.__lineHeights[r]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,a=0,i=0,l=this._textLines.length;i<l;i++)r=this.getHeightOfLine(i),a+=i===l-1?r/this.lineHeight:r;return a},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,a){r.save();for(var i=0,l=this._getLeftOffset(),g=this._getTopOffset(),o=0,f=this._textLines.length;o<f;o++){var m=this.getHeightOfLine(o),y=m/this.lineHeight,x=this._getLineLeftOffset(o);this._renderTextLine(a,r,this._textLines[o],l+x,g+i+y,o),i+=m}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,a,i,l,g,o){var f=this.getHeightOfLine(o),m=this.textAlign.indexOf("justify")!==-1,y,x,C="",b,T=0,E,L=this.path,F=!m&&this.charSpacing===0&&this.isEmptyStyles(o)&&!L,H=this.direction==="ltr",J=this.direction==="ltr"?1:-1,q,Q=a.canvas.getAttribute("dir");if(a.save(),Q!==this.direction&&(a.canvas.setAttribute("dir",H?"ltr":"rtl"),a.direction=H?"ltr":"rtl",a.textAlign=H?"left":"right"),g-=f*this._fontSizeFraction/this.lineHeight,F){this._renderChar(r,a,o,0,i.join(""),l,g,f),a.restore();return}for(var te=0,oe=i.length-1;te<=oe;te++)E=te===oe||this.charSpacing||L,C+=i[te],b=this.__charBounds[o][te],T===0?(l+=J*(b.kernedWidth-b.width),T+=b.width):T+=b.kernedWidth,m&&!E&&this._reSpaceAndTab.test(i[te])&&(E=!0),E||(y=y||this.getCompleteStyleDeclaration(o,te),x=this.getCompleteStyleDeclaration(o,te+1),E=s.util.hasStyleChanged(y,x,!1)),E&&(L?(a.save(),a.translate(b.renderLeft,b.renderTop),a.rotate(b.angle),this._renderChar(r,a,o,te,C,-T/2,0,f),a.restore()):(q=l,this._renderChar(r,a,o,te,C,q,g,f)),C="",y=x,l+=J*T,T=0);a.restore()},_applyPatternGradientTransformText:function(r){var a=s.util.createCanvasElement(),i,l=this.width+this.strokeWidth,g=this.height+this.strokeWidth;return a.width=l,a.height=g,i=a.getContext("2d"),i.beginPath(),i.moveTo(0,0),i.lineTo(l,0),i.lineTo(l,g),i.lineTo(0,g),i.closePath(),i.translate(l/2,g/2),i.fillStyle=r.toLive(i),this._applyPatternGradientTransform(i,r),i.fill(),i.createPattern(a,"no-repeat")},handleFiller:function(r,a,i){var l,g;return i.toLive?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(l=-this.width/2,g=-this.height/2,r.translate(l,g),r[a]=this._applyPatternGradientTransformText(i),{offsetX:l,offsetY:g}):(r[a]=i.toLive(r,this),this._applyPatternGradientTransform(r,i)):(r[a]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,a){return r.lineWidth=a.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",a.stroke)},_setFillStyles:function(r,a){return this.handleFiller(r,"fillStyle",a.fill)},_renderChar:function(r,a,i,l,g,o,f){var m=this._getStyleDeclaration(i,l),y=this.getCompleteStyleDeclaration(i,l),x=r==="fillText"&&y.fill,C=r==="strokeText"&&y.stroke&&y.strokeWidth,b,T;!C&&!x||(a.save(),x&&(b=this._setFillStyles(a,y)),C&&(T=this._setStrokeStyles(a,y)),a.font=this._getFontDeclaration(y),m&&m.textBackgroundColor&&this._removeShadow(a),m&&m.deltaY&&(f+=m.deltaY),x&&a.fillText(g,o-b.offsetX,f-b.offsetY),C&&a.strokeText(g,o-T.offsetX,f-T.offsetY),a.restore())},setSuperscript:function(r,a){return this._setScript(r,a,this.superscript)},setSubscript:function(r,a){return this._setScript(r,a,this.subscript)},_setScript:function(r,a,i){var l=this.get2DCursorLocation(r,!0),g=this.getValueOfPropertyAt(l.lineIndex,l.charIndex,"fontSize"),o=this.getValueOfPropertyAt(l.lineIndex,l.charIndex,"deltaY"),f={fontSize:g*i.size,deltaY:o+g*i.baseline};return this.setSelectionStyles(f,r,a),this},_getLineLeftOffset:function(r){var a=this.getLineWidth(r),i=this.width-a,l=this.textAlign,g=this.direction,f,o=0,f=this.isEndOfWrapping(r);return l==="justify"||l==="justify-center"&&!f||l==="justify-right"&&!f||l==="justify-left"&&!f?0:(l==="center"&&(o=i/2),l==="right"&&(o=i),l==="justify-center"&&(o=i/2),l==="justify-right"&&(o=i),g==="rtl"&&(o-=i),o)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var a=this.measureLine(r),i=a.width;return this.__lineWidths[r]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,a,i){var l=this._getStyleDeclaration(r,a);return l&&typeof l[i]<"u"?l[i]:this[i]},_renderTextDecoration:function(r,a){if(!(!this[a]&&!this.styleHas(a))){r.save(),(a==="overline"||a==="linethrough")&&this._removeShadow(r);for(var i,l,g,o,f,m,y,x,C=this._getLeftOffset(),b=this._getTopOffset(),T,E,L,F,H,J,q,Q,te=this.path,oe=this._getWidthOfCharSpacing(),ce=this.offsets[a],X=0,_=this._textLines.length;X<_;X++){if(i=this.getHeightOfLine(X),!this[a]&&!this.styleHas(a,X)){b+=i;continue}y=this._textLines[X],J=i/this.lineHeight,o=this._getLineLeftOffset(X),E=0,L=0,x=this.getValueOfPropertyAt(X,0,a),Q=this.getValueOfPropertyAt(X,0,"fill"),T=b+J*(1-this._fontSizeFraction),l=this.getHeightOfChar(X,0),f=this.getValueOfPropertyAt(X,0,"deltaY");for(var j=0,A=y.length;j<A;j++)if(F=this.__charBounds[X][j],H=this.getValueOfPropertyAt(X,j,a),q=this.getValueOfPropertyAt(X,j,"fill"),g=this.getHeightOfChar(X,j),m=this.getValueOfPropertyAt(X,j,"deltaY"),te&&H&&q)r.save(),r.fillStyle=Q,r.translate(F.renderLeft,F.renderTop),r.rotate(F.angle),r.fillRect(-F.kernedWidth/2,ce*g+m,F.kernedWidth,this.fontSize/15),r.restore();else if((H!==x||q!==Q||g!==l||m!==f)&&L>0){var O=C+o+E;this.direction==="rtl"&&(O=this.width-O-L),x&&Q&&(r.fillStyle=Q,r.fillRect(O,T+ce*l+f,L,this.fontSize/15)),E=F.left,L=F.width,x=H,Q=q,l=g,f=m}else L+=F.kernedWidth;var O=C+o+E;this.direction==="rtl"&&(O=this.width-O-L),r.fillStyle=q,H&&q&&r.fillRect(O,T+ce*l+f,L-oe,this.fontSize/15),b+=i}r.restore()}},_getFontDeclaration:function(r,a){var i=r||this,l=this.fontFamily,g=s.Text.genericFonts.indexOf(l.toLowerCase())>-1,o=l===void 0||l.indexOf("'")>-1||l.indexOf(",")>-1||l.indexOf('"')>-1||g?i.fontFamily:'"'+i.fontFamily+'"';return[s.isLikelyNode?i.fontWeight:i.fontStyle,s.isLikelyNode?i.fontStyle:i.fontWeight,a?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",o].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var a=r.split(this._reNewline),i=new Array(a.length),l=[`
`],g=[],o=0;o<a.length;o++)i[o]=s.util.string.graphemeSplit(a[o]),g=g.concat(i[o],l);return g.pop(),{_unwrappedLines:i,lines:a,graphemeText:g,graphemeLines:i}},toObject:function(r){var a=d.concat(r),i=this.callSuper("toObject",a);return i.styles=s.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(r,a){this.callSuper("set",r,a);var i=!1,l=!1;if(typeof r=="object")for(var g in r)g==="path"&&this.setPathInfo(),i=i||this._dimensionAffectingProps.indexOf(g)!==-1,l=l||g==="path";else i=this._dimensionAffectingProps.indexOf(r)!==-1,l=r==="path";return l&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(r,a,i){if(!r)return a(null);var l=s.parseAttributes(r,s.Text.ATTRIBUTE_NAMES),g=l.textAnchor||"left";if(i=s.util.object.extend(i?u(i):{},l),i.top=i.top||0,i.left=i.left||0,l.textDecoration){var o=l.textDecoration;o.indexOf("underline")!==-1&&(i.underline=!0),o.indexOf("overline")!==-1&&(i.overline=!0),o.indexOf("line-through")!==-1&&(i.linethrough=!0),delete i.textDecoration}"dx"in l&&(i.left+=l.dx),"dy"in l&&(i.top+=l.dy),"fontSize"in i||(i.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var f="";"textContent"in r?f=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(f=r.firstChild.data),f=f.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var m=i.strokeWidth;i.strokeWidth=0;var y=new s.Text(f,i),x=y.getScaledHeight()/y.height,C=(y.height+y.strokeWidth)*y.lineHeight-y.height,b=C*x,T=y.getScaledHeight()+b,E=0;g==="center"&&(E=y.getScaledWidth()/2),g==="right"&&(E=y.getScaledWidth()),y.set({left:y.left-E,top:y.top-(T-y.fontSize*(.07+y._fontSizeFraction))/y.lineHeight,strokeWidth:typeof m<"u"?m:1}),a(y)},s.Text.fromObject=function(r,a){var i=u(r),l=r.path;return delete i.path,s.Object._fromObject("Text",i,function(g){g.styles=s.util.stylesFromArray(r.styles,r.text),l?s.Object._fromObject("Path",l,function(o){g.set("path",o),a(g)},"path"):a(g)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}(t),function(){e.util.object.extend(e.Text.prototype,{isEmptyStyles:function(h){if(!this.styles||typeof h<"u"&&!this.styles[h])return!0;var s=typeof h>"u"?this.styles:{line:this.styles[h]};for(var u in s)for(var d in s[u])for(var r in s[u][d])return!1;return!0},styleHas:function(h,s){if(!this.styles||!h||h===""||typeof s<"u"&&!this.styles[s])return!1;var u=typeof s>"u"?this.styles:{0:this.styles[s]};for(var d in u)for(var r in u[d])if(typeof u[d][r][h]<"u")return!0;return!1},cleanStyle:function(h){if(!this.styles||!h||h==="")return!1;var s=this.styles,u=0,d,r,a=!0,i=0,l;for(var g in s){d=0;for(var o in s[g]){var l=s[g][o],f=l.hasOwnProperty(h);u++,f?(r?l[h]!==r&&(a=!1):r=l[h],l[h]===this[h]&&delete l[h]):a=!1,Object.keys(l).length!==0?d++:delete s[g][o]}d===0&&delete s[g]}for(var m=0;m<this._textLines.length;m++)i+=this._textLines[m].length;a&&u===i&&(this[h]=r,this.removeStyle(h))},removeStyle:function(h){if(!(!this.styles||!h||h==="")){var s=this.styles,u,d,r;for(d in s){u=s[d];for(r in u)delete u[r][h],Object.keys(u[r]).length===0&&delete u[r];Object.keys(u).length===0&&delete s[d]}}},_extendStyles:function(h,s){var u=this.get2DCursorLocation(h);this._getLineStyle(u.lineIndex)||this._setLineStyle(u.lineIndex),this._getStyleDeclaration(u.lineIndex,u.charIndex)||this._setStyleDeclaration(u.lineIndex,u.charIndex,{}),e.util.object.extend(this._getStyleDeclaration(u.lineIndex,u.charIndex),s)},get2DCursorLocation:function(h,s){typeof h>"u"&&(h=this.selectionStart);for(var u=s?this._unwrappedTextLines:this._textLines,d=u.length,r=0;r<d;r++){if(h<=u[r].length)return{lineIndex:r,charIndex:h};h-=u[r].length+this.missingNewlineOffset(r,s)}return{lineIndex:r-1,charIndex:u[r-1].length<h?u[r-1].length:h}},getSelectionStyles:function(h,s,u){typeof h>"u"&&(h=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||h);for(var d=[],r=h;r<s;r++)d.push(this.getStyleAtPosition(r,u));return d},getStyleAtPosition:function(h,s){var u=this.get2DCursorLocation(h),d=s?this.getCompleteStyleDeclaration(u.lineIndex,u.charIndex):this._getStyleDeclaration(u.lineIndex,u.charIndex);return d||{}},setSelectionStyles:function(h,s,u){typeof s>"u"&&(s=this.selectionStart||0),typeof u>"u"&&(u=this.selectionEnd||s);for(var d=s;d<u;d++)this._extendStyles(d,h);return this._forceClearCache=!0,this},_getStyleDeclaration:function(h,s){var u=this.styles&&this.styles[h];return u?u[s]:null},getCompleteStyleDeclaration:function(h,s){for(var u=this._getStyleDeclaration(h,s)||{},d={},r,a=0;a<this._styleProperties.length;a++)r=this._styleProperties[a],d[r]=typeof u[r]>"u"?this[r]:u[r];return d},_setStyleDeclaration:function(h,s,u){this.styles[h][s]=u},_deleteStyleDeclaration:function(h,s){delete this.styles[h][s]},_getLineStyle:function(h){return!!this.styles[h]},_setLineStyle:function(h){this.styles[h]={}},_deleteLineStyle:function(h){delete this.styles[h]}})}(),function(){function h(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}e.IText=e.util.createClass(e.Text,e.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,u){this.callSuper("initialize",s,u),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,u){this[s]!==u&&(this._fireSelectionChanged(),this[s]=u),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var u=this.canvas.contextTop,d=this.canvas.viewportTransform;u.save(),u.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this.transform(u),this._clearTextArea(u),s||u.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var s=this._getCursorBoundaries(),u=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,u):this.renderSelection(s,u),u.restore()}},_clearTextArea:function(s){var u=this.width+4,d=this.height+4;s.clearRect(-u/2,-d/2,u,d)},_getCursorBoundaries:function(s){typeof s>"u"&&(s=this.selectionStart);var u=this._getLeftOffset(),d=this._getTopOffset(),r=this._getCursorBoundariesOffsets(s);return{left:u,top:d,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var u,d,r,a=0,i=0,l,g=this.get2DCursorLocation(s);r=g.charIndex,d=g.lineIndex;for(var o=0;o<d;o++)a+=this.getHeightOfLine(o);u=this._getLineLeftOffset(d);var f=this.__charBounds[d][r];return f&&(i=f.left),this.charSpacing!==0&&r===this._textLines[d].length&&(i-=this._getWidthOfCharSpacing()),l={top:a,left:u+(i>0?i:0)},this.direction==="rtl"&&(l.left*=-1),this.cursorOffsetCache=l,this.cursorOffsetCache},renderCursor:function(s,u){var d=this.get2DCursorLocation(),r=d.lineIndex,a=d.charIndex>0?d.charIndex-1:0,i=this.getValueOfPropertyAt(r,a,"fontSize"),l=this.scaleX*this.canvas.getZoom(),g=this.cursorWidth/l,o=s.topOffset,f=this.getValueOfPropertyAt(r,a,"deltaY");o+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,u),u.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,a,"fill"),u.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,u.fillRect(s.left+s.leftOffset-g/2,o+s.top+f,g,i)},renderSelection:function(s,u){for(var d=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=this.textAlign.indexOf("justify")!==-1,i=this.get2DCursorLocation(d),l=this.get2DCursorLocation(r),g=i.lineIndex,o=l.lineIndex,f=i.charIndex<0?0:i.charIndex,m=l.charIndex<0?0:l.charIndex,y=g;y<=o;y++){var x=this._getLineLeftOffset(y)||0,C=this.getHeightOfLine(y),b=0,T=0,E=0;if(y===g&&(T=this.__charBounds[g][f].left),y>=g&&y<o)E=a&&!this.isEndOfWrapping(y)?this.width:this.getLineWidth(y)||5;else if(y===o)if(m===0)E=this.__charBounds[o][m].left;else{var L=this._getWidthOfCharSpacing();E=this.__charBounds[o][m-1].left+this.__charBounds[o][m-1].width-L}b=C,(this.lineHeight<1||y===o&&this.lineHeight>1)&&(C/=this.lineHeight);var F=s.left+x+T,H=E-T,J=C,q=0;this.inCompositionMode?(u.fillStyle=this.compositionColor||"black",J=1,q=C):u.fillStyle=this.selectionColor,this.direction==="rtl"&&(F=this.width-F-H),u.fillRect(F,s.top+s.topOffset+q,H,J),s.topOffset+=b}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),u=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:u}}}),e.IText.fromObject=function(s,u){var d=e.util.stylesFromArray(s.styles,s.text),r=Object.assign({},s,{styles:d});if(delete r.path,h(r),r.styles)for(var a in r.styles)for(var i in r.styles[a])h(r.styles[a][i]);e.Object._fromObject("IText",r,function(l){s.path?e.Object._fromObject("Path",s.path,function(g){l.set("path",g),u(l)},"path"):u(l)},"text")}}(),function(){var h=e.util.object.clone;e.util.object.extend(e.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var u=s.canvas;u&&(u._hasITextHandlers||(u._hasITextHandlers=!0,s._initCanvasHandlers(u)),u._iTextInstances=u._iTextInstances||[],u._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var u=s.canvas;u&&(u._iTextInstances=u._iTextInstances||[],e.util.removeFromArray(u._iTextInstances,s),u._iTextInstances.length===0&&(u._hasITextHandlers=!1,s._removeCanvasHandlers(u)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,u,d,r){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",u,{duration:d,onComplete:function(){a.isAborted||s[r]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var u=this,d=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){u._tick()},d)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,u=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&u&&u.clearContext(u.contextTop||u.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var u=0,d=s-1;if(this._reSpace.test(this._text[d]))for(;this._reSpace.test(this._text[d]);)u++,d--;for(;/\S/.test(this._text[d])&&d>-1;)u++,d--;return s-u},findWordBoundaryRight:function(s){var u=0,d=s;if(this._reSpace.test(this._text[d]))for(;this._reSpace.test(this._text[d]);)u++,d++;for(;/\S/.test(this._text[d])&&d<this._text.length;)u++,d++;return s+u},findLineBoundaryLeft:function(s){for(var u=0,d=s-1;!/\n/.test(this._text[d])&&d>-1;)u++,d--;return s-u},findLineBoundaryRight:function(s){for(var u=0,d=s;!/\n/.test(this._text[d])&&d<this._text.length;)u++,d++;return s+u},searchWordBoundary:function(s,u){for(var d=this._text,r=this._reSpace.test(d[s])?s-1:s,a=d[r],i=e.reNonWord;!i.test(a)&&r>0&&r<d.length;)r+=u,a=d[r];return i.test(a)&&(r+=u===1?0:1),r},selectWord:function(s){s=s||this.selectionStart;var u=this.searchWordBoundary(s,-1),d=this.searchWordBoundary(s,1);this.selectionStart=u,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var u=this.findLineBoundaryLeft(s),d=this.findLineBoundaryRight(s);return this.selectionStart=u,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.selected=!1,u.isEditing&&u.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var u=this.getSelectionStartFromPointer(s.e),d=this.selectionStart,r=this.selectionEnd;(u!==this.__selectionStartOnMouseDown||d===r)&&(d===u||r===u)||(u>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=u):(this.selectionStart=u,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==d||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,u,d){var r=d.slice(0,s),a=e.util.string.graphemeSplit(r).length;if(s===u)return{selectionStart:a,selectionEnd:a};var i=d.slice(s,u),l=e.util.string.graphemeSplit(i).length;return{selectionStart:a,selectionEnd:a+l}},fromGraphemeToStringSelection:function(s,u,d){var r=d.slice(0,s),a=r.join("").length;if(s===u)return{selectionStart:a,selectionEnd:a};var i=d.slice(s,u),l=i.join("").length;return{selectionStart:a,selectionEnd:a+l}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,u=this._getCursorBoundaries(s),d=this.get2DCursorLocation(s),r=d.lineIndex,a=d.charIndex,i=this.getValueOfPropertyAt(r,a,"fontSize")*this.lineHeight,l=u.leftOffset,g=this.calcTransformMatrix(),o={x:u.left+l,y:u.top+u.topOffset+i},f=this.canvas.getRetinaScaling(),m=this.canvas.upperCanvasEl,y=m.width/f,x=m.height/f,C=y-i,b=x-i,T=m.clientWidth/y,E=m.clientHeight/x;return o=e.util.transformPoint(o,g),o=e.util.transformPoint(o,this.canvas.viewportTransform),o.x*=T,o.y*=E,o.x<0&&(o.x=0),o.x>C&&(o.x=C),o.y<0&&(o.y=0),o.y>b&&(o.y=b),o.x+=this.canvas._offset.left,o.y+=this.canvas._offset.top,{left:o.x+"px",top:o.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,u=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,u&&(u.blur&&u.blur(),u.parentNode&&u.parentNode.removeChild(u)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,u){var d=this.get2DCursorLocation(s,!0),r=this.get2DCursorLocation(u,!0),a=d.lineIndex,i=d.charIndex,l=r.lineIndex,g=r.charIndex,o,f;if(a!==l){if(this.styles[a])for(o=i;o<this._unwrappedTextLines[a].length;o++)delete this.styles[a][o];if(this.styles[l])for(o=g;o<this._unwrappedTextLines[l].length;o++)f=this.styles[l][o],f&&(this.styles[a]||(this.styles[a]={}),this.styles[a][i+o-g]=f);for(o=a+1;o<=l;o++)delete this.styles[o];this.shiftLineStyles(l,a-l)}else if(this.styles[a]){f=this.styles[a];var m=g-i,y,x;for(o=i;o<g;o++)delete f[o];for(x in this.styles[a])y=parseInt(x,10),y>=g&&(f[y-m]=f[x],delete f[x])}},shiftLineStyles:function(s,u){var d=h(this.styles);for(var r in this.styles){var a=parseInt(r,10);a>s&&(this.styles[a+u]=d[a],d[a-u]||delete this.styles[a])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(s,u,d,r){var a,i={},l=!1,g=this._unwrappedTextLines[s].length,o=g===u;d||(d=1),this.shiftLineStyles(s,d),this.styles[s]&&(a=this.styles[s][u===0?u:u-1]);for(var f in this.styles[s]){var m=parseInt(f,10);m>=u&&(l=!0,i[m-u]=this.styles[s][f],o&&u===0||delete this.styles[s][f])}var y=!1;for(l&&!o&&(this.styles[s+d]=i,y=!0),(y||g>u)&&d--;d>0;)r&&r[d-1]?this.styles[s+d]={0:h(r[d-1])}:a?this.styles[s+d]={0:h(a)}:delete this.styles[s+d],d--;this._forceClearCache=!0},insertCharStyleObject:function(s,u,d,r){this.styles||(this.styles={});var a=this.styles[s],i=a?h(a):{};d||(d=1);for(var l in i){var g=parseInt(l,10);g>=u&&(a[g+d]=i[g],i[g-d]||delete a[g])}if(this._forceClearCache=!0,r){for(;d--;)Object.keys(r[d]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][u+d]=h(r[d]));return}if(a)for(var o=a[u?u-1:1];o&&d--;)this.styles[s][u+d]=h(o)},insertNewStyleBlock:function(s,u,d){for(var r=this.get2DCursorLocation(u,!0),a=[0],i=0,l=0;l<s.length;l++)s[l]===`
`?(i++,a[i]=0):a[i]++;a[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,a[0],d),d=d&&d.slice(a[0]+1)),i&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+a[0],i);for(var l=1;l<i;l++)a[l]>0?this.insertCharStyleObject(r.lineIndex+l,0,a[l],d):d&&this.styles[r.lineIndex+l]&&d[0]&&(this.styles[r.lineIndex+l][0]=d[0]),d=d&&d.slice(a[l]+1);a[l]>0&&this.insertCharStyleObject(r.lineIndex+l,0,a[l],d)},setSelectionStartEndWithShift:function(s,u,d){d<=s?(u===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=d):d>s&&d<u?this._selectionDirection==="right"?this.selectionEnd=d:this.selectionStart=d:(u===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=u),this.selectionEnd=d)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),e.util.object.extend(e.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(h){if(this.canvas){this.__newClickTime=+new Date;var s=h.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",h),this._stopEvent(h.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(h){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===h.x&&this.__lastPointer.y===h.y},_stopEvent:function(h){h.preventDefault&&h.preventDefault(),h.stopPropagation&&h.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(h){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(h.e))},tripleClickHandler:function(h){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(h.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(h.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(h){if(this.__isMousedown=!1,!(!this.editable||this.group||h.transform&&h.transform.actionPerformed||h.e.button&&h.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(h.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(h){var s=this.getSelectionStartFromPointer(h),u=this.selectionStart,d=this.selectionEnd;h.shiftKey?this.setSelectionStartEndWithShift(u,d,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(h){for(var s=this.getLocalPointer(h),u=0,d=0,r=0,a=0,i=0,l,g,o=0,f=this._textLines.length;o<f&&r<=s.y;o++)r+=this.getHeightOfLine(o)*this.scaleY,i=o,o>0&&(a+=this._textLines[o-1].length+this.missingNewlineOffset(o-1));l=this._getLineLeftOffset(i),d=l*this.scaleX,g=this._textLines[i],this.direction==="rtl"&&(s.x=this.width*this.scaleX-s.x+d);for(var m=0,y=g.length;m<y&&(u=d,d+=this.__charBounds[i][m].kernedWidth*this.scaleX,d<=s.x);m++)a++;return this._getNewSelectionStartFromOffset(s,u,d,a,y)},_getNewSelectionStartFromOffset:function(h,s,u,d,r){var a=h.x-s,i=u-h.x,l=i>a||i<0?0:1,g=d+l;return this.flipX&&(g=r-g),g>this._text.length&&(g=this._text.length),g}}),e.util.object.extend(e.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=e.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var h=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+h.top+"; left: "+h.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+h.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):e.document.body.appendChild(this.hiddenTextarea),e.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),e.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),e.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),e.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(e.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(h){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(h.keyCode in s)this[s[h.keyCode]](h);else if(h.keyCode in this.ctrlKeysMapDown&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapDown[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),h.keyCode>=33&&h.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(h){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(h.keyCode in this.ctrlKeysMapUp&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapUp[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(h){var s=this.fromPaste;if(this.fromPaste=!1,h&&h.stopPropagation(),!!this.isEditing){var u=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,d=this._text.length,r=u.length,a,i,l=r-d,g=this.selectionStart,o=this.selectionEnd,f=g!==o,m,y,x;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var C=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),b=g>C.selectionStart;f?(a=this._text.slice(g,o),l+=o-g):r<d&&(b?a=this._text.slice(o+l,o):a=this._text.slice(g,g-l)),i=u.slice(C.selectionEnd-l,C.selectionEnd),a&&a.length&&(i.length&&(m=this.getSelectionStyles(g,g+1,!1),m=i.map(function(){return m[0]})),f?(y=g,x=o):b?(y=o-a.length,x=o):(y=o,x=o+a.length),this.removeStyleFromTo(y,x)),i.length&&(s&&i.join("")===e.copiedText&&!e.disableStyleCopyPaste&&(m=e.copiedTextStyle),this.insertNewStyleBlock(i,g,m)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(h){this.compositionStart=h.target.selectionStart,this.compositionEnd=h.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(e.copiedText=this.getSelectedText(),e.disableStyleCopyPaste?e.copiedTextStyle=null:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(h){return h&&h.clipboardData||e.window.clipboardData},_getWidthBeforeCursor:function(h,s){var u=this._getLineLeftOffset(h),d;return s>0&&(d=this.__charBounds[h][s-1],u+=d.left+d.width),u},getDownCursorOffset:function(h,s){var u=this._getSelectionForOffset(h,s),d=this.get2DCursorLocation(u),r=d.lineIndex;if(r===this._textLines.length-1||h.metaKey||h.keyCode===34)return this._text.length-u;var a=d.charIndex,i=this._getWidthBeforeCursor(r,a),l=this._getIndexOnLine(r+1,i),g=this._textLines[r].slice(a);return g.length+l+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(h,s){return h.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(h,s){var u=this._getSelectionForOffset(h,s),d=this.get2DCursorLocation(u),r=d.lineIndex;if(r===0||h.metaKey||h.keyCode===33)return-u;var a=d.charIndex,i=this._getWidthBeforeCursor(r,a),l=this._getIndexOnLine(r-1,i),g=this._textLines[r].slice(0,a),o=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+l-g.length+(1-o)},_getIndexOnLine:function(h,s){for(var u=this._textLines[h],d=this._getLineLeftOffset(h),r=d,a=0,i,l,g=0,o=u.length;g<o;g++)if(i=this.__charBounds[h][g].width,r+=i,r>s){l=!0;var f=r-i,m=r,y=Math.abs(f-s),x=Math.abs(m-s);a=x<y?g:g-1;break}return l||(a=u.length-1),a},moveCursorDown:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",h)},moveCursorUp:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",h)},_moveCursorUpOrDown:function(h,s){var u="get"+h+"CursorOffset",d=this[u](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(d):this.moveCursorWithoutShift(d),d!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(h){var s=this._selectionDirection==="left"?this.selectionStart+h:this.selectionEnd+h;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),h!==0},moveCursorWithoutShift:function(h){return h<0?(this.selectionStart+=h,this.selectionEnd=this.selectionStart):(this.selectionEnd+=h,this.selectionStart=this.selectionEnd),h!==0},moveCursorLeft:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",h)},_move:function(h,s,u){var d;if(h.altKey)d=this["findWordBoundary"+u](this[s]);else if(h.metaKey||h.keyCode===35||h.keyCode===36)d=this["findLineBoundary"+u](this[s]);else return this[s]+=u==="Left"?-1:1,!0;if(typeof d<"u"&&this[s]!==d)return this[s]=d,!0},_moveLeft:function(h,s){return this._move(h,s,"Left")},_moveRight:function(h,s){return this._move(h,s,"Right")},moveCursorLeftWithoutShift:function(h){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(h,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(h){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(h,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(h,"selectionStart")},moveCursorRight:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",h)},_moveCursorLeftOrRight:function(h,s){var u="moveCursor"+h+"With";this._currentCursorOpacity=1,s.shiftKey?u+="Shift":u+="outShift",this[u](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(h){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(h,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(h,"selectionEnd")},moveCursorRightWithoutShift:function(h){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(h,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(h,s){typeof s>"u"&&(s=h+1),this.removeStyleFromTo(h,s),this._text.splice(h,s-h),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(h,s,u,d){typeof d>"u"&&(d=u),d>u&&this.removeStyleFromTo(u,d);var r=e.util.string.graphemeSplit(h);this.insertNewStyleBlock(r,u,s),this._text=[].concat(this._text.slice(0,u),r,this._text.slice(d)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var h=e.util.toFixed,s=e.util.radiansToDegrees,u=e.util.calcRotateMatrix,d=e.util.transformPoint,r=/  +/g;e.util.object.extend(e.Text.prototype,{_toSVG:function(){var a=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(a){var i=this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0}),l=this.path;return l?i+l._createBaseSVGMarkup(l._toSVG(),{reviver:a,withShadow:!0}):i},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var i=!0,l=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",l?'text-decoration="'+l+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",a.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(a,i){var l=[],g=[],o=a,f;this._setSVGBg(g);for(var m=0,y=this._textLines.length;m<y;m++)f=this._getLineLeftOffset(m),(this.textBackgroundColor||this.styleHas("textBackgroundColor",m))&&this._setSVGTextLineBg(g,m,i+f,o),this._setSVGTextLineText(l,m,i+f,o),o+=this.getHeightOfLine(m);return{textSpans:l,textBgRects:g}},_createTextCharSpan:function(a,i,l,g,o){var f=a!==a.trim()||a.match(r),m=this.getSvgSpanStyles(i,f),y=m?'style="'+m+'"':"",x=i.deltaY,C="",b=e.Object.NUM_FRACTION_DIGITS,T="";if(x&&(C=' dy="'+h(x,b)+'" '),o.renderLeft!==void 0){var E=o.angle;T=' rotate="'+h(s(E),e.Object.NUM_FRACTION_DIGITS)+'" ';var L=o.width/2,F=u({angle:s(E)});F[4]=o.renderLeft,F[5]=o.renderTop;var H=d({x:-L,y:0},F);l=H.x,g=H.y}return['<tspan x="',h(l,b),'" y="',h(g,b),'" ',C,y,T,">",e.util.string.escapeXml(a),"</tspan>"].join("")},_setSVGTextLineText:function(a,i,l,g){var o=this.getHeightOfLine(i),f=this.textAlign.indexOf("justify")!==-1,m,y,x="",C,b,T=0,E=this._textLines[i],L;g+=o*(1-this._fontSizeFraction)/this.lineHeight;for(var F=0,H=E.length-1;F<=H;F++)L=F===H||this.charSpacing||this.path,x+=E[F],C=this.__charBounds[i][F],T===0?(l+=C.kernedWidth-C.width,T+=C.width):T+=C.kernedWidth,f&&!L&&this._reSpaceAndTab.test(E[F])&&(L=!0),L||(m=m||this.getCompleteStyleDeclaration(i,F),y=this.getCompleteStyleDeclaration(i,F+1),L=e.util.hasStyleChanged(m,y,!0)),L&&(b=this._getStyleDeclaration(i,F)||{},a.push(this._createTextCharSpan(x,b,l,g,C)),x="",m=y,l+=T,T=0)},_pushTextBgRect:function(a,i,l,g,o,f){var m=e.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(i),' x="',h(l,m),'" y="',h(g,m),'" width="',h(o,m),'" height="',h(f,m),`"></rect>
`)},_setSVGTextLineBg:function(a,i,l,g){for(var o=this._textLines[i],f=this.getHeightOfLine(i)/this.lineHeight,m=0,y=0,x,C,b=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),T=0,E=o.length;T<E;T++)x=this.__charBounds[i][T],C=this.getValueOfPropertyAt(i,T,"textBackgroundColor"),C!==b?(b&&this._pushTextBgRect(a,b,l+y,g,m,f),y=x.left,m=x.width,b=C):m+=x.kernedWidth;C&&this._pushTextBgRect(a,C,l+y,g,m,f)},_getFillAttributes:function(a){var i=a&&typeof a=="string"?new e.Color(a):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+a+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(a){for(var i=0,l=0,g=0;g<a;g++)i+=this.getHeightOfLine(g);return l=this.getHeightOfLine(g),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*l/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){var i=e.Object.prototype.getSvgStyles.call(this,a);return i+" white-space: pre;"}})}(),function(h){var s=h.fabric||(h.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(u){for(var d=0,r=0,a=0,i={},l=0;l<u.graphemeLines.length;l++)u.graphemeText[a]===`
`&&l>0?(r=0,a++,d++):!this.splitByGrapheme&&this._reSpaceAndTab.test(u.graphemeText[a])&&l>0&&(r++,a++),i[l]={line:d,offset:r},a+=u.graphemeLines[l].length,r+=u.graphemeLines[l].length;return i},styleHas:function(u,d){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[d];r&&(d=r.line)}return s.Text.prototype.styleHas.call(this,u,d)},isEmptyStyles:function(u){if(!this.styles)return!0;var d=0,r=u+1,a,i,l=!1,g=this._styleMap[u],o=this._styleMap[u+1];g&&(u=g.line,d=g.offset),o&&(r=o.line,l=r===u,a=o.offset),i=typeof u>"u"?this.styles:{line:this.styles[u]};for(var f in i)for(var m in i[f])if(m>=d&&(!l||m<a))for(var y in i[f][m])return!1;return!0},_getStyleDeclaration:function(u,d){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];if(!r)return null;u=r.line,d=r.offset+d}return this.callSuper("_getStyleDeclaration",u,d)},_setStyleDeclaration:function(u,d,r){var a=this._styleMap[u];u=a.line,d=a.offset+d,this.styles[u][d]=r},_deleteStyleDeclaration:function(u,d){var r=this._styleMap[u];u=r.line,d=r.offset+d,delete this.styles[u][d]},_getLineStyle:function(u){var d=this._styleMap[u];return!!this.styles[d.line]},_setLineStyle:function(u){var d=this._styleMap[u];this.styles[d.line]={}},_wrapText:function(u,d){var r=[],a;for(this.isWrapping=!0,a=0;a<u.length;a++)r=r.concat(this._wrapLine(u[a],a,d));return this.isWrapping=!1,r},_measureWord:function(u,d,r){var a=0,i,l=!0;r=r||0;for(var g=0,o=u.length;g<o;g++){var f=this._getGraphemeBox(u[g],d,g+r,i,l);a+=f.kernedWidth,i=u[g]}return a},_wrapLine:function(u,d,r,F){var i=0,l=this.splitByGrapheme,g=[],o=[],f=l?s.util.string.graphemeSplit(u):u.split(this._wordJoiners),m="",y=0,x=l?"":" ",C=0,b=0,T=0,E=!0,L=this._getWidthOfCharSpacing(),F=F||0;f.length===0&&f.push([]),r-=F;for(var H=0;H<f.length;H++)m=l?f[H]:s.util.string.graphemeSplit(f[H]),C=this._measureWord(m,d,y),y+=m.length,i+=b+C-L,i>r&&!E?(g.push(o),o=[],i=C,E=!0):i+=L,!E&&!l&&o.push(x),o=o.concat(m),b=l?0:this._measureWord([x],d,y),y++,E=!1,C>T&&(T=C);return H&&g.push(o),T+F>this.dynamicMinWidth&&(this.dynamicMinWidth=T-L+F),g},isEndOfWrapping:function(u){return!this._styleMap[u+1]||this._styleMap[u+1].line!==this._styleMap[u].line},missingNewlineOffset:function(u,d){return this.splitByGrapheme&&!d?this.isEndOfWrapping(u)?1:0:1},_splitTextIntoLines:function(u){for(var d=s.Text.prototype._splitTextIntoLines.call(this,u),r=this._wrapText(d.lines,this.width),a=new Array(r.length),i=0;i<r.length;i++)a[i]=r[i].join("");return d.lines=a,d.graphemeLines=r,d},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var u={};for(var d in this._styleMap)this._textLines[d]&&(u[this._styleMap[d].line]=1);for(var d in this.styles)u[d]||delete this.styles[d]},toObject:function(u){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(u))}}),s.Textbox.fromObject=function(u,d){var r=s.util.stylesFromArray(u.styles,u.text),a=Object.assign({},u,{styles:r});return delete a.path,s.Object._fromObject("Textbox",a,function(i){u.path?s.Object._fromObject("Path",u.path,function(l){i.set("path",l),d(i)},"path"):d(i)},"text")}}(t),function(){var h=e.controlsUtils,s=h.scaleSkewCursorStyleHandler,u=h.scaleCursorStyleHandler,d=h.scalingEqually,r=h.scalingYOrSkewingX,a=h.scalingXOrSkewingY,i=h.scaleOrSkewActionName,l=e.Object.prototype.controls;if(l.ml=new e.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:a,getActionName:i}),l.mr=new e.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:a,getActionName:i}),l.mb=new e.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),l.mt=new e.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),l.tl=new e.Control({x:-.5,y:-.5,cursorStyleHandler:u,actionHandler:d}),l.tr=new e.Control({x:.5,y:-.5,cursorStyleHandler:u,actionHandler:d}),l.bl=new e.Control({x:-.5,y:.5,cursorStyleHandler:u,actionHandler:d}),l.br=new e.Control({x:.5,y:.5,cursorStyleHandler:u,actionHandler:d}),l.mtr=new e.Control({x:0,y:-.5,actionHandler:h.rotationWithSnapping,cursorStyleHandler:h.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),e.Textbox){var g=e.Textbox.prototype.controls={};g.mtr=l.mtr,g.tr=l.tr,g.br=l.br,g.tl=l.tl,g.bl=l.bl,g.mt=l.mt,g.mb=l.mb,g.mr=new e.Control({x:.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),g.ml=new e.Control({x:-.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()})(He);const mc=t=>{let e;const n=new Set,c=(d,r)=>{const a=typeof d=="function"?d(e):d;if(!Object.is(a,e)){const i=e;e=r??(typeof a!="object"||a===null)?a:Object.assign({},e,a),n.forEach(l=>l(e,i))}},p=()=>e,s={setState:c,getState:p,getInitialState:()=>u,subscribe:d=>(n.add(d),()=>n.delete(d)),destroy:()=>{n.clear()}},u=e=t(c,p,s);return s},am=t=>t?mc(t):mc;var $h={exports:{}},Kh={},qh={exports:{}},Qh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ni=le;function om(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var lm=typeof Object.is=="function"?Object.is:om,cm=ni.useState,um=ni.useEffect,hm=ni.useLayoutEffect,dm=ni.useDebugValue;function fm(t,e){var n=e(),c=cm({inst:{value:n,getSnapshot:e}}),p=c[0].inst,v=c[1];return hm(function(){p.value=n,p.getSnapshot=e,na(p)&&v({inst:p})},[t,n,e]),um(function(){return na(p)&&v({inst:p}),t(function(){na(p)&&v({inst:p})})},[t]),dm(n),n}function na(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!lm(t,n)}catch{return!0}}function gm(t,e){return e()}var mm=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?gm:fm;Qh.useSyncExternalStore=ni.useSyncExternalStore!==void 0?ni.useSyncExternalStore:mm;qh.exports=Qh;var pm=qh.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bs=le,vm=pm;function ym(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var xm=typeof Object.is=="function"?Object.is:ym,wm=vm.useSyncExternalStore,Sm=bs.useRef,Cm=bs.useEffect,bm=bs.useMemo,_m=bs.useDebugValue;Kh.useSyncExternalStoreWithSelector=function(t,e,n,c,p){var v=Sm(null);if(v.current===null){var S={hasValue:!1,value:null};v.current=S}else S=v.current;v=bm(function(){function s(i){if(!u){if(u=!0,d=i,i=c(i),p!==void 0&&S.hasValue){var l=S.value;if(p(l,i))return r=l}return r=i}if(l=r,xm(d,i))return l;var g=c(i);return p!==void 0&&p(l,g)?(d=i,l):(d=i,r=g)}var u=!1,d,r,a=n===void 0?null:n;return[function(){return s(e())},a===null?void 0:function(){return s(a())}]},[e,n,c,p]);var h=wm(t,v[0],v[1]);return Cm(function(){S.hasValue=!0,S.value=h},[h]),_m(h),h};$h.exports=Kh;var Tm=$h.exports;const km=_c(Tm),{useDebugValue:Pm}=Nc,{useSyncExternalStoreWithSelector:Em}=km;const Om=t=>t;function jm(t,e=Om,n){const c=Em(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return Pm(c),c}const pc=t=>{const e=typeof t=="function"?am(t):t,n=(c,p)=>jm(e,c,p);return Object.assign(n,e),n},ai=t=>t?pc(t):pc,pn=ai((t,e)=>({canvas:null,tool:"select",brushSize:5,brushColor:"#000000",isDrawing:!1,history:[],historyIndex:-1,zoom:1,panX:0,panY:0,setCanvas:n=>t({canvas:n}),setTool:n=>{const c=e(),p=c.canvas,v=c.brushSize,S=c.brushColor;if(p){switch(n){case"select":p.isDrawingMode=!1,p.selection=!0,p.getContext().globalCompositeOperation="source-over";break;case"brush":p.isDrawingMode=!0,p.selection=!1,p.freeDrawingBrush=new He.fabric.PencilBrush(p),p.freeDrawingBrush.width=v,p.freeDrawingBrush.color=S,p.getContext().globalCompositeOperation="source-over";break;case"eraser":p.isDrawingMode=!0,p.selection=!1,p.freeDrawingBrush=new He.fabric.PencilBrush(p),p.freeDrawingBrush.width=v(p.getContext()).globalCompositeOperation="destination-out",p.freeDrawingBrush.color="rgba(0,0,0,1)";break;default:p.isDrawingMode=!1,p.selection=!0}t({tool:n})}},setBrushSize:n=>{const{canvas:c,tool:p}=e();c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=n,p==="eraser"?c.getContext().globalCompositeOperation="destination-out":c.getContext().globalCompositeOperation="source-over"),t({brushSize:n})},setBrushColor:n=>{const{canvas:c,tool:p}=e();c&&c.freeDrawingBrush&&p!=="eraser"&&(c.freeDrawingBrush.color=n),t({brushColor:n})},setIsDrawing:n=>t({isDrawing:n}),addToHistory:n=>{const{history:c,historyIndex:p}=e(),v={id:Date.now().toString(),timestamp:Date.now(),data:n},s=[...c.slice(0,p+1),v].slice(-50);t({history:s,historyIndex:s.length-1})},undo:()=>{const{canvas:n,history:c,historyIndex:p}=e();if(!n||p<=0)return;const v=c[p-1];n._skipHistory=!0,n.loadFromJSON(v.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:p-1})},redo:()=>{const{canvas:n,history:c,historyIndex:p}=e();if(!n||p>=c.length-1)return;const v=c[p+1];n._skipHistory=!0,n.loadFromJSON(v.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:p+1})},canUndo:()=>{const{historyIndex:n}=e();return n>0},canRedo:()=>{const{history:n,historyIndex:c}=e();return c<n.length-1},clearCanvas:()=>{const{canvas:n}=e();if(n){n.clear(),n.backgroundColor="#ffffff",n.renderAll();const c=JSON.stringify(n.toJSON());e().addToHistory(c)}},exportCanvas:n=>{const{canvas:c}=e();if(!c)return null;switch(n){case"png":return c.toDataURL({format:"png",quality:1,multiplier:2});case"jpg":return c.toDataURL({format:"jpeg",quality:.9,multiplier:2});case"pdf":return console.warn("PDF export not yet implemented"),null;default:return null}},importImage:async(n,c)=>{const{canvas:p}=e();if(p){if(console.log("🖼️ Importing image to canvas:",typeof n=="string"?n.substring(0,50)+"...":n),typeof n!="string")throw console.error("❌ Invalid imageUrl type:",typeof n,n),new Error(`Invalid imageUrl: expected string, got ${typeof n}`);if(!n||n.length===0)throw console.error("❌ Empty imageUrl provided"),new Error("Empty imageUrl provided");return new Promise((v,S)=>{try{He.fabric.Image.fromURL(n,h=>{try{if(h&&h.width&&h.height){console.log("✅ Image loaded successfully:",h.width,"x",h.height);const s=h.width||1,u=h.height||1,d=Math.max(s,u);console.log("📏 Original AI image size:",s,"x",u);const r=600;let a=1;if(d>r?(a=r/d,console.log("🔽 Scaling down large AI image:",a)):console.log("✅ Using original AI image size (good quality)"),h.scale(a),console.log("✅ Final AI image display size:",(s*a).toFixed(0),"x",(u*a).toFixed(0)),(c==null?void 0:c.x)!==void 0&&(c==null?void 0:c.y)!==void 0)h.set({left:c.x,top:c.y}),console.log("📍 Positioned image at:",c.x,c.y);else{const l=p.viewportTransform,g=p.getElement();console.log("🤖 AI IMAGE POSITIONING - TIMESTAMP:",new Date().toISOString());const o=["div",'[class*="panel"]','[class*="sidebar"]','[class*="assistant"]',".ai-assistant-panel",".right-panel","[data-panel]","aside","section",'[style*="position: fixed"]','[style*="position: absolute"]'];let f=null,m=0;for(const q of o){const Q=document.querySelectorAll(q);for(const te of Q){const oe=te.getBoundingClientRect(),ce=oe.width>250&&oe.width<window.innerWidth*.6,X=oe.right>=window.innerWidth-100,_=oe.width<window.innerWidth-100,j=oe.height>300;if(ce&&X&&_&&j){f=te,m=oe.width,console.log("🤖 AI - Found right panel:",q,"class:",te.className,"width:",m);break}}if(f)break}f||console.log("🤖 AI - No right panel detected, using full viewport");const y=window.innerWidth-m,x=window.innerHeight,C=y/2,b=x/2,T=l[0],E=l[3],L=l[4],F=l[5],H=(C-L)/T,J=(b-F)/E;console.log("🤖 AI CALCULATION RESULT:",H.toFixed(0),J.toFixed(0)),console.log("🤖 AI Transform values: scale=",T.toFixed(2),E.toFixed(2),"translate=",L.toFixed(0),F.toFixed(0)),console.log("🤖 AI VIEWPORT vs CANVAS SIZE:"),console.log("   - Window size:",window.innerWidth,"x",window.innerHeight,"(full window)"),console.log("   - Right panel width:",m,"(detected panel)"),console.log("   - Available viewport size:",y,"x",x,"(available canvas area)"),console.log("   - Viewport center:",C,b),h.set({left:H,top:J,originX:"center",originY:"center"}),console.log("📍 AI Image positioned at viewport center:",{finalPosition:{x:H.toFixed(0),y:J.toFixed(0)},vpt:p.viewportTransform,canvasSize:{width:g.width,height:g.height},zoom:p.getZoom()})}try{n.startsWith("data:image/")&&(h.set("isAIGenerated",!0),h.set("imageId",`ai_generated_${Date.now()}`))}catch(l){console.warn("Failed to set metadata:",l)}p.add(h),p.renderAll(),console.log("✅ Image added to canvas and rendered");const i=JSON.stringify(p.toJSON());e().addToHistory(i),v()}else console.error("❌ Failed to load image - img object is null or has no dimensions"),S(new Error("Failed to load image - invalid image data"))}catch(s){console.error("❌ Error in image load callback:",s),S(s)}},{crossOrigin:"anonymous"})}catch(h){console.error("❌ Error calling fabric.Image.fromURL:",h),S(h)}})}},updateBrushSettings:n=>{const{canvas:c,brushSize:p,brushColor:v}=e(),S=n.size??p,h=n.color??v;c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=S,c.freeDrawingBrush.color=h,n.opacity),t({brushSize:S,brushColor:h})},setZoom:n=>{const{canvas:c}=e();if(c){const p=c.getCenter();c.zoomToPoint(new He.fabric.Point(p.left,p.top),n),c.renderAll()}t({zoom:n})},setPan:(n,c)=>{const{canvas:p}=e();p&&(p.absolutePan(new He.fabric.Point(n,c)),p.renderAll()),t({panX:n,panY:c})},zoomIn:()=>{const{zoom:n,setZoom:c}=e(),p=Math.min(n*1.2,5);c(p)},zoomOut:()=>{const{zoom:n,setZoom:c}=e(),p=Math.max(n/1.2,.1);c(p)},resetView:()=>{const{canvas:n,setZoom:c,setPan:p}=e();n&&(c(1),p(0,0),n.setViewportTransform([1,0,0,1,0,0]),n.renderAll())},getSelectedImages:()=>{const{canvas:n}=e();if(console.log("🎯 Canvas selection check:",{hasCanvas:!!n}),!n)return[];const c=n.getActiveObjects();console.log("📋 Active objects:",{count:c.length,objects:c});const p=[];return c.forEach((v,S)=>{var h,s,u,d,r,a;console.log(`🖼️ Object ${S}:`,{type:v.type,hasElement:!!v._element,hasSrc:!!((h=v._element)!=null&&h.src),src:typeof((s=v._element)==null?void 0:s.src)=="string"?((d=(u=v._element)==null?void 0:u.src)==null?void 0:d.substring(0,50))+"...":(r=v._element)==null?void 0:r.src}),v.type==="image"&&((a=v._element)!=null&&a.src)&&p.push(v._element.src)}),console.log("✅ Selected image URLs:",{count:p.length}),p}})),Jo=ai((t,e)=>({images:[],selectedImages:[],isMultiSelectMode:!1,canvas:null,setCanvas:n=>t({canvas:n}),addImages:async(n,c={autoArrange:!1,spacing:20})=>{const{canvas:p,images:v}=e();if(!p)return;const S=[],h=Array.from(n);for(let s=0;s<h.length;s++){const u=h[s];if(u.type.startsWith("image/"))try{const d=await new Promise(z=>{const P=new FileReader;P.onload=k=>{var D;return z((D=k.target)==null?void 0:D.result)},P.readAsDataURL(u)}),r=await new Promise((z,P)=>{He.fabric.Image.fromURL(d,k=>{k?(k.set({selectable:!0,hasControls:!0,hasBorders:!0,cornerColor:"#2563eb",cornerStyle:"circle",borderColor:"#2563eb"}),z(k)):P(new Error("Failed to load image"))})}),a=r.width||1,i=r.height||1,l=Math.max(a,i);console.log("📏 Original image size:",a,"x",i);const g=600;let o=1;l>g?(o=g/l,console.log("🔽 Scaling down large image:",o)):console.log("✅ Using original size (good quality)"),r.scale(o),console.log("✅ Final display size:",(a*o).toFixed(0),"x",(i*o).toFixed(0));const f=a*o,m=i*o,y=c.spacing||100,x=p.getZoom(),C=p.viewportTransform,b=p.getElement();console.log("🚨 EXECUTING MANUAL MATRIX CALCULATION - TIMESTAMP:",new Date().toISOString());const T=document.querySelectorAll("*"),E=[];for(const z of T){const P=z.getBoundingClientRect();P.width>250&&P.right>=window.innerWidth-100&&P.height>300&&E.push({tag:z.tagName,className:z.className,id:z.id,width:P.width,height:P.height,right:P.right,left:P.left})}console.log("🔍 All potential right-side panels found:",E);const L=["div",'[class*="panel"]','[class*="sidebar"]','[class*="assistant"]',".ai-assistant-panel",".right-panel","[data-panel]","aside","section",'[style*="position: fixed"]','[style*="position: absolute"]'];let F=null,H=0;for(const z of L){const P=document.querySelectorAll(z);for(const k of P){const D=k.getBoundingClientRect(),R=D.width>250&&D.width<window.innerWidth*.6,Y=D.right>=window.innerWidth-100,G=D.width<window.innerWidth-100,K=D.height>300;if(R&&Y&&G&&K){F=k,H=D.width,console.log("🎯 Found right panel:",z,"class:",k.className,"width:",H,"rect:",D);break}}if(F)break}F||(console.log("⚠️ No right panel detected, using full viewport"),console.log("   - Window dimensions:",window.innerWidth,"x",window.innerHeight),console.log("   - Checked",E.length,"potential elements"));const J=window.innerWidth-H,q=window.innerHeight,Q=J/2,te=q/2,oe=C[0],ce=C[3],X=C[4],_=C[5],j=(Q-X)/oe,A=(te-_)/ce;if(console.log("🔥 MANUAL CALCULATION RESULT:",j.toFixed(0),A.toFixed(0)),console.log("📊 Transform values: scale=",oe.toFixed(2),ce.toFixed(2),"translate=",X.toFixed(0),_.toFixed(0)),console.log("🔍 VIEWPORT vs CANVAS SIZE:"),console.log("   - Window size:",window.innerWidth,"x",window.innerHeight,"(full window)"),console.log("   - Right panel width:",H,"(detected panel)"),console.log("   - Available viewport size:",J,"x",q,"(available canvas area)"),console.log("   - Canvas element size:",b.width,"x",b.height,"(canvas element)"),console.log("   - Viewport center:",Q,te),console.log("✅ USING FABRIC.JS BUILT-IN TRANSFORMATION - SHOULD BE CORRECT NOW!"),console.log("🎯 Using Method 2 (direct calculation) for positioning"),console.log("📏 Transform matrix details:"),console.log("   - Canvas size:",b.width,"x",b.height),console.log("   - Screen center:",b.width/2,b.height/2),console.log("   - Transform scale:",C[0],C[3]),console.log("   - Transform translate:",C[4],C[5]),console.log("📐 DETAILED Viewport center calculation:",{zoom:x,canvasSize:{width:b.width,height:b.height},vpt:{full:C,scaleX:C[0],scaleY:C[3],translateX:C[4],translateY:C[5]},screenCenter:{x:b.width/2,y:b.height/2},invertedTransform:He.fabric.util.invertTransform(C),finalCalculatedCenter:{x:j.toFixed(0),y:A.toFixed(0)},fileArrayLength:h.length,autoArrangeEnabled:c.autoArrange,willUseGridLayout:c.autoArrange&&h.length>1}),c.autoArrange&&h.length>1){const z=Math.ceil(Math.sqrt(h.length)),P=Math.floor(s/z),k=s%z,D=z*(f+y)-y,R=Math.ceil(h.length/z)*(m+y)-y,Y=j-D/2,G=A-R/2,K=Y+k*(f+y),Z=G+P*(m+y);r.set({left:K+f/2,top:Z+m/2,originX:"center",originY:"center"}),console.log(`📍 Positioned image ${s+1} at viewport-centered grid:`,K.toFixed(0),Z.toFixed(0))}else r.set({left:j,top:A,originX:"center",originY:"center"}),console.log("📍 Centered image at viewport center:",j.toFixed(0),A.toFixed(0)),console.log("🔍 Raw viewport transform values:",{vpt_array:C,scaleX:C[0],skewY:C[1],skewX:C[2],scaleY:C[3],translateX:C[4],translateY:C[5]}),console.log("🔍 Canvas element size:",{width:b.width,height:b.height}),console.log("🔍 Center point calculation:",{x:b.width/2,y:b.height/2});p.add(r);const O={id:`img_${Date.now()}_${s}`,name:u.name,url:d,fabricObject:r,width:r.width||0,height:r.height||0,selected:!1,position:{x:r.left||0,y:r.top||0},scale:o,thumbnail:d};S.push(O)}catch(d){console.error(`Failed to load image ${u.name}:`,d)}}p.renderAll(),t({images:[...v,...S]}),p&&S.length>0&&console.log("Added",S.length,"images to canvas")},removeImage:n=>{const{canvas:c,images:p,selectedImages:v}=e();if(!c)return;const S=p.find(h=>h.id===n);S&&S.fabricObject&&(c.remove(S.fabricObject),c.renderAll()),t({images:p.filter(h=>h.id!==n),selectedImages:v.filter(h=>h!==n)})},selectImage:(n,c=!1)=>{const{selectedImages:p,isMultiSelectMode:v}=e();if(c||v){const s=p.includes(n)?p.filter(u=>u!==n):[...p,n];t({selectedImages:s})}else t({selectedImages:[n]});const{images:S,canvas:h}=e();if(h){const s=e().selectedImages;S.forEach(u=>{if(u.fabricObject){const d=s.includes(u.id);u.fabricObject.set({borderColor:d?"#ef4444":"#2563eb",cornerColor:d?"#ef4444":"#2563eb"})}}),h.renderAll()}},selectAllImages:()=>{const{images:n}=e();t({selectedImages:n.map(p=>p.id)});const{canvas:c}=e();c&&(n.forEach(p=>{p.fabricObject&&p.fabricObject.set({borderColor:"#ef4444",cornerColor:"#ef4444"})}),c.renderAll())},clearSelection:()=>{t({selectedImages:[]});const{images:n,canvas:c}=e();c&&(n.forEach(p=>{p.fabricObject&&p.fabricObject.set({borderColor:"#2563eb",cornerColor:"#2563eb"})}),c.renderAll())},deleteSelectedImages:()=>{const{selectedImages:n}=e();n.forEach(c=>{e().removeImage(c)}),t({selectedImages:[]})},toggleMultiSelectMode:()=>{const{isMultiSelectMode:n}=e();t({isMultiSelectMode:!n}),n||e().clearSelection()},arrangeImages:n=>{const{images:c,canvas:p}=e();if(!p||c.length===0)return;const v=p.width||800,S=p.height||600,h=20,s=v-h*2,u=S-h*2;c.forEach((d,r)=>{if(!d.fabricObject)return;let a=h,i=h;switch(n){case"grid":const l=Math.ceil(Math.sqrt(c.length)),g=s/l,o=u/Math.ceil(c.length/l);a=h+r%l*g+g/2,i=h+Math.floor(r/l)*o+o/2;break;case"horizontal":const f=s/c.length;a=h+r*f+f/2,i=S/2;break;case"vertical":const m=u/c.length;a=v/2,i=h+r*m+m/2;break}d.fabricObject.set({left:a,top:i}),d.position={x:a,y:i}}),p.renderAll()},getSelectedImages:()=>{const{images:n,selectedImages:c}=e();return n.filter(p=>c.includes(p.id))},getSelectionBounds:()=>{const n=e().getSelectedImages();if(n.length===0)return null;const c=n.map(v=>v.fabricObject).filter(v=>v!==null);if(c.length===0)return null;const p={left:Math.min(...c.map(v=>v.left||0)),top:Math.min(...c.map(v=>v.top||0)),right:Math.max(...c.map(v=>(v.left||0)+(v.width||0)*(v.scaleX||1))),bottom:Math.max(...c.map(v=>(v.top||0)+(v.height||0)*(v.scaleY||1)))};return{images:n,bounds:{left:p.left,top:p.top,width:p.right-p.left,height:p.bottom-p.top}}}}));function Xn(t){const e=t.split(",")[1]||t;return Math.floor(e.length*.75)}async function Et(t,e={}){const{maxWidth:n=1024,maxHeight:c=1024,quality:p=.8,maxSizeKB:v=3500,format:S="jpeg"}=e,h=Xn(t);return new Promise((s,u)=>{const d=new Image;d.onload=async()=>{try{const r=document.createElement("canvas"),a=r.getContext("2d");let{width:i,height:l}=Im(d.width,d.height,n,c);r.width=i,r.height=l,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(d,0,0,i,l);let g=p,o,f;do o=r.toDataURL(`image/${S}`,g),f=Xn(o),console.log(`🔧 Compression attempt: ${Math.round(f/1024)}KB at quality ${g}`),f>v*1024&&(g>.3?g-=.1:(i=Math.floor(i*.8),l=Math.floor(l*.8),r.width=i,r.height=l,a.clearRect(0,0,i,l),a.drawImage(d,0,0,i,l),g=.7));while(f>v*1024&&(g>.2||i>200));const m=h/f;console.log(`✅ Image compressed: ${Math.round(h/1024)}KB → ${Math.round(f/1024)}KB (${Math.round(m*100)/100}x reduction)`),s({dataURL:o,originalSize:h,compressedSize:f,compressionRatio:m})}catch(r){u(r)}},d.onerror=()=>u(new Error("Failed to load image for compression")),d.src=t})}function Im(t,e,n,c){let p=t,v=e;return p>n&&(v=v*n/p,p=n),v>c&&(p=p*c/v,v=c),{width:Math.floor(p),height:Math.floor(v)}}async function Sr(t,e={}){const n=[];for(const c of t)try{const p=await Et(c,e);n.push(p)}catch(p){console.error("Failed to compress image:",p);const v=Xn(c);n.push({dataURL:c,originalSize:v,compressedSize:v,compressionRatio:1})}return n}function Am(t,e){let n;try{n=t()}catch{return}return{getItem:p=>{var v;const S=s=>s===null?null:JSON.parse(s,e==null?void 0:e.reviver),h=(v=n.getItem(p))!=null?v:null;return h instanceof Promise?h.then(S):S(h)},setItem:(p,v)=>n.setItem(p,JSON.stringify(v,e==null?void 0:e.replacer)),removeItem:p=>n.removeItem(p)}}const Yi=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(c){return Yi(c)(n)},catch(c){return this}}}catch(n){return{then(c){return this},catch(c){return Yi(c)(n)}}}},Mm=(t,e)=>(n,c,p)=>{let v={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:o=>o,version:0,merge:(o,f)=>({...f,...o}),...e},S=!1;const h=new Set,s=new Set;let u;try{u=v.getStorage()}catch{}if(!u)return t((...o)=>{console.warn(`[zustand persist middleware] Unable to update item '${v.name}', the given storage is currently unavailable.`),n(...o)},c,p);const d=Yi(v.serialize),r=()=>{const o=v.partialize({...c()});let f;const m=d({state:o,version:v.version}).then(y=>u.setItem(v.name,y)).catch(y=>{f=y});if(f)throw f;return m},a=p.setState;p.setState=(o,f)=>{a(o,f),r()};const i=t((...o)=>{n(...o),r()},c,p);let l;const g=()=>{var o;if(!u)return;S=!1,h.forEach(m=>m(c()));const f=((o=v.onRehydrateStorage)==null?void 0:o.call(v,c()))||void 0;return Yi(u.getItem.bind(u))(v.name).then(m=>{if(m)return v.deserialize(m)}).then(m=>{if(m)if(typeof m.version=="number"&&m.version!==v.version){if(v.migrate)return v.migrate(m.state,m.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return m.state}).then(m=>{var y;return l=v.merge(m,(y=c())!=null?y:i),n(l,!0),r()}).then(()=>{f==null||f(l,void 0),S=!0,s.forEach(m=>m(l))}).catch(m=>{f==null||f(void 0,m)})};return p.persist={setOptions:o=>{v={...v,...o},o.getStorage&&(u=o.getStorage())},clearStorage:()=>{u==null||u.removeItem(v.name)},getOptions:()=>v,rehydrate:()=>g(),hasHydrated:()=>S,onHydrate:o=>(h.add(o),()=>{h.delete(o)}),onFinishHydration:o=>(s.add(o),()=>{s.delete(o)})},g(),l||i},Dm=(t,e)=>(n,c,p)=>{let v={storage:Am(()=>localStorage),partialize:g=>g,version:0,merge:(g,o)=>({...o,...g}),...e},S=!1;const h=new Set,s=new Set;let u=v.storage;if(!u)return t((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${v.name}', the given storage is currently unavailable.`),n(...g)},c,p);const d=()=>{const g=v.partialize({...c()});return u.setItem(v.name,{state:g,version:v.version})},r=p.setState;p.setState=(g,o)=>{r(g,o),d()};const a=t((...g)=>{n(...g),d()},c,p);p.getInitialState=()=>a;let i;const l=()=>{var g,o;if(!u)return;S=!1,h.forEach(m=>{var y;return m((y=c())!=null?y:a)});const f=((o=v.onRehydrateStorage)==null?void 0:o.call(v,(g=c())!=null?g:a))||void 0;return Yi(u.getItem.bind(u))(v.name).then(m=>{if(m)if(typeof m.version=="number"&&m.version!==v.version){if(v.migrate)return[!0,v.migrate(m.state,m.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,m.state];return[!1,void 0]}).then(m=>{var y;const[x,C]=m;if(i=v.merge(C,(y=c())!=null?y:a),n(i,!0),x)return d()}).then(()=>{f==null||f(i,void 0),i=c(),S=!0,s.forEach(m=>m(i))}).catch(m=>{f==null||f(void 0,m)})};return p.persist={setOptions:g=>{v={...v,...g},g.storage&&(u=g.storage)},clearStorage:()=>{u==null||u.removeItem(v.name)},getOptions:()=>v,rehydrate:()=>l(),hasHydrated:()=>S,onHydrate:g=>(h.add(g),()=>{h.delete(g)}),onFinishHydration:g=>(s.add(g),()=>{s.delete(g)})},v.skipHydration||l(),i||a},Nm=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?Mm(t,e):Dm(t,e),Jh=Nm,Fm=t=>!t||t.length<=8?"••••••••":`${t.slice(0,4)}••••${t.slice(-4)}`,vc=t=>t.trim().replace(/[\x00-\x1F\x7F]/g,""),yc=(t,e)=>{if(!/^[a-zA-Z0-9\-_]+$/.test(e))return!1;switch(t){case"gemini":return/^AIza[a-zA-Z0-9\-_]{35}$/.test(e);default:return!1}},Lm=async t=>{try{const n=new TextEncoder().encode(t),c=window.location.origin.repeat(Math.ceil(t.length/window.location.origin.length)),p=Array.from(n).map((v,S)=>v^c.charCodeAt(S%c.length));return btoa(String.fromCharCode(...p))}catch{return btoa(t)}},Rm=async t=>{try{const e=atob(t),n=Array.from(e).map(S=>S.charCodeAt(0)),c=window.location.origin.repeat(Math.ceil(n.length/window.location.origin.length)),p=n.map((S,h)=>S^c.charCodeAt(h%c.length));return new TextDecoder().decode(new Uint8Array(p))}catch{try{return atob(t)}catch{return""}}},Zo=ai()(Jh((t,e)=>({apiKeys:{},isConfigured:!1,setAPIKey:(n,c)=>{const p=vc(c);if(!yc(n,p)){console.error(`Invalid API key format for ${n}`);return}t(v=>({apiKeys:{...v.apiKeys,[n]:p},isConfigured:!0}))},removeAPIKey:n=>{t(c=>{const p={...c.apiKeys};return delete p[n],{apiKeys:p,isConfigured:Object.keys(p).length>0}})},clearAllKeys:()=>{t({apiKeys:{},isConfigured:!1}),localStorage.removeItem("api-keys-storage")},validateAPIKey:async(n,c)=>{const p=vc(c);return!!yc(n,p)},getObfuscatedKey:n=>{const c=e().apiKeys[n];return c?Fm(c):void 0}}),{name:"api-keys-storage",storage:{getItem:async t=>{const e=localStorage.getItem(t);if(!e)return null;try{const n=JSON.parse(e),c=await Rm(n.state);return{state:JSON.parse(c)}}catch(n){return console.error("Failed to decrypt API keys:",n),localStorage.removeItem(t),null}},setItem:async(t,e)=>{try{const n=await Lm(JSON.stringify(e.state));localStorage.setItem(t,JSON.stringify({state:n,version:"1.0",timestamp:Date.now()}))}catch(n){console.error("Failed to encrypt API keys:",n)}},removeItem:t=>{localStorage.removeItem(t)}}}));class zm{constructor(){ft(this,"config");this.config={baseUrl:"https://omnicanvas-backend.vercel.app/api",endpoints:{generateImage:"/ai/generate-image",mergeImages:"/ai/merge-images",transferStyle:"/ai/transfer-style",generateSimilar:"/ai/generate-similar",elevenlabs:"/ai/elevenlabs",generateComic:"/ai/generate-comic",editWithWords:"/ai/edit-with-words",blendProduct:"/ai/blend-product",generateVideo:"/ai/generate-video",generateText:"/ai/generate-text",nanoBananaPhotoToVideo:"/ai/nano-banana-photo-to-video",nanoBananaImageFusion:"/ai/nano-banana-image-fusion"}}}configure(e){e&&(this.config.baseUrl=e)}getGeminiAPIKey(){const e=Zo.getState().apiKeys.gemini;if(!e)throw new Error("Please configure your Gemini API key in Settings to use AI features");return e}getRequestHeaders(){return{"Content-Type":"application/json","X-API-Key":this.getGeminiAPIKey()}}async generateImage(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({prompt:e.prompt,width:e.width||512,height:e.height||512,provider:"gemini"})});if(!n.ok){const p=await n.text();throw new Error(`Backend API error: ${n.status} - ${p}`)}const c=await n.json();return{url:c.imageUrl||c.url,width:c.width||e.width||512,height:c.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",...c.metadata}}}catch(n){throw console.error("Image generation error:",n),n}}async imageToImage(e){try{console.log("🎨 Frontend AI Image-to-Image called!"),console.log("📝 Request details:",{prompt:typeof e.prompt=="string"?e.prompt.substring(0,100)+"...":e.prompt,imageUrl:typeof e.imageUrl=="string"?e.imageUrl.substring(0,50)+"...":e.imageUrl,width:e.width,height:e.height,strength:e.strength});let n=e.imageUrl;if(e.imageUrl.startsWith("data:")){console.log("🔧 Compressing reference image for image-to-image...");const S=Xn(e.imageUrl);console.log(`📏 Original image size: ${Math.round(S/1024)}KB`);const h=await Et(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3});n=h.dataURL,console.log(`✅ Compressed image size: ${Math.round(h.compressedSize/1024)}KB`)}const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({prompt:e.prompt,imageUrl:n,width:e.width||512,height:e.height||512,strength:e.strength||.7,provider:"gemini",mode:"image-to-image"})});if(!c.ok){const S=await c.text();throw new Error(`Backend API error: ${c.status} - ${S}`)}const p=await c.json();console.log("📦 Backend response received:",{hasImageUrl:!!p.imageUrl,hasUrl:!!p.url,imageUrlType:typeof p.imageUrl,urlType:typeof p.url,dataKeys:Object.keys(p)});let v=p.imageUrl||p.url;if(!v)throw console.error("❌ No imageUrl or url found in response:",p),new Error("Backend did not return a valid image URL");if(typeof v!="string")throw console.error("❌ imageUrl is not a string:",typeof v,v),new Error(`Invalid imageUrl type: expected string, got ${typeof v}`);if(v.length===0)throw console.error("❌ imageUrl is empty string"),new Error("Backend returned empty imageUrl");return console.log("✅ Successfully extracted imageUrl:",v.substring(0,50)+"..."),{url:v,width:p.width||e.width||512,height:p.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",mode:"image-to-image",referenceImage:e.imageUrl,strength:e.strength||.7,...p.metadata}}}catch(n){throw console.error("Image-to-image generation error:",n),n}}async mergeImages(e,n){try{console.log("🎨 Backend AI Merge - Images:",e.length,"Prompt:",n);const c=e.filter(u=>u.startsWith("data:")),p=e.filter(u=>!u.startsWith("data:"));let v=[...p];if(c.length>0){console.log("🔧 Compressing",c.length,"data URLs on client side...");const d=c.map(l=>Xn(l)).reduce((l,g)=>l+g,0);console.log(`📏 Original total size: ${Math.round(d/1024)}KB`);const r=await Sr(c,{maxWidth:800,maxHeight:800,quality:.6,format:"jpeg",maxSizeKB:1500}),a=r.map(l=>l.dataURL),i=r.reduce((l,g)=>l+g.compressedSize,0);console.log(`✅ Compressed total size: ${Math.round(i/1024)}KB (${Math.round(d/i*100)/100}x reduction)`),v=[...p,...a]}const S=await fetch(`${this.config.baseUrl}${this.config.endpoints.mergeImages}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrls:v,prompt:n,provider:"gemini"})});if(!S.ok){const u=await S.text();throw console.error("Backend merge error:",u),new Error(`Backend merge error: ${S.status}`)}const h=await S.json();console.log("✅ Backend merge successful:",h),console.log("📦 Merge response received:",{hasImageUrl:!!h.imageUrl,hasUrl:!!h.url,imageUrlType:typeof h.imageUrl,urlType:typeof h.url,dataKeys:Object.keys(h)});let s=h.imageUrl||h.url;if(!s)throw console.error("❌ No imageUrl or url found in merge response:",h),new Error("Backend merge did not return a valid image URL");if(typeof s!="string")throw console.error("❌ Merge imageUrl is not a string:",typeof s,s),new Error(`Invalid merge imageUrl type: expected string, got ${typeof s}`);if(s.length===0)throw console.error("❌ Merge imageUrl is empty string"),new Error("Backend merge returned empty imageUrl");return console.log("✅ Successfully extracted merge imageUrl:",s.substring(0,50)+"..."),s}catch(c){throw console.error("Backend merge failed:",c),c}}async transferStyle(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.transferStyle}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrl:e.imageUrl,style:e.style,provider:"gemini"})});if(!n.ok){const p=await n.text();throw new Error(`Style transfer error: ${n.status} - ${p}`)}const c=await n.json();return c.imageUrl||c.url}catch(n){throw console.error("Style transfer error:",n),n}}async generateSimilar(e){try{console.log("🌟 Calling generateSimilar API with",e.images.length,"images");const n=e.images.filter(h=>h.startsWith("data:")),c=e.images.filter(h=>!h.startsWith("data:"));let p=[...c];if(n.length>0){console.log("🔧 Compressing",n.length,"data URLs for generateSimilar...");const s=(await Sr(n,{maxWidth:768,maxHeight:768,quality:.7,format:"jpeg",maxSizeKB:1800})).map(u=>u.dataURL);p=[...c,...s]}const v=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateSimilar}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrls:p,prompt:e.prompt,aspectRatio:e.aspectRatio||"1:1",provider:"gemini"})});if(!v.ok){const h=await v.text();throw console.error("Generate similar API error:",h),new Error(`Generate similar error: ${v.status} - ${h}`)}const S=await v.json();return console.log("✅ Generate similar API response:",S),S.imageUrl||S.url}catch(n){throw console.error("Generate similar error:",n),n}}async generateVoice(e,n){try{const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.elevenlabs}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({text:e,voiceId:n||"default",provider:"elevenlabs"})});if(!c.ok){const v=await c.text();throw new Error(`Voice generation error: ${c.status} - ${v}`)}const p=await c.json();return p.audioUrl||p.url}catch(c){throw console.error("Voice generation error:",c),c}}async generateComic(e){try{console.log("📚 Generating comic with StoryShop API");let n=e.characterImage,c=e.productImage;if(e.characterImage&&e.characterImage.startsWith("data:")){console.log("🔧 Compressing character image for comic generation...");const S=await Et(e.characterImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});n=S.dataURL,console.log(`✅ Character image compressed: ${Math.round(S.compressedSize/1024)}KB`)}if(e.productImage&&e.productImage.startsWith("data:")){console.log("🔧 Compressing product image for comic generation...");const S=await Et(e.productImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});c=S.dataURL,console.log(`✅ Product image compressed: ${Math.round(S.compressedSize/1024)}KB`)}const p=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateComic}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({storyPrompt:e.storyPrompt,characterImage:n,productImage:c,style:e.style,panelCount:e.panelCount||4,provider:"gemini"})});if(!p.ok){const S=await p.text();throw new Error(`Comic generation error: ${p.status} - ${S}`)}return(await p.json()).panelUrls||[]}catch(n){throw console.error("Comic generation error:",n),n}}async editWithWords(e){try{let n=e.imageUrl,c=e.maskUrl;e.imageUrl.startsWith("data:")&&(console.log("🔧 Compressing image for editWithWords..."),n=(await Et(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.maskUrl&&e.maskUrl.startsWith("data:")&&(console.log("🔧 Compressing mask for editWithWords..."),c=(await Et(e.maskUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"png",maxSizeKB:1e3})).dataURL);const p=await fetch(`${this.config.baseUrl}${this.config.endpoints.editWithWords}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrl:n,editPrompt:e.editPrompt,maskUrl:c,provider:"gemini"})});if(!p.ok){const S=await p.text();throw new Error(`Edit with words error: ${p.status} - ${S}`)}const v=await p.json();return v.imageUrl||v.url}catch(n){throw console.error("Edit with words error:",n),n}}async blendProduct(e){try{let n=e.sceneImageUrl,c=e.productImageUrl;e.sceneImageUrl.startsWith("data:")&&(console.log("🔧 Compressing scene image for blendProduct..."),n=(await Et(e.sceneImageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.productImageUrl.startsWith("data:")&&(console.log("🔧 Compressing product image for blendProduct..."),c=(await Et(e.productImageUrl,{maxWidth:512,maxHeight:512,quality:.8,format:"jpeg",maxSizeKB:1500})).dataURL);const p=await fetch(`${this.config.baseUrl}${this.config.endpoints.blendProduct}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({sceneImageUrl:n,productImageUrl:c,blendPrompt:e.blendPrompt,provider:"gemini"})});if(!p.ok){const S=await p.text();throw new Error(`Product blend error: ${p.status} - ${S}`)}const v=await p.json();return v.imageUrl||v.url}catch(n){throw console.error("Product blend error:",n),n}}async generateVideoFromPanels(e){try{console.log("🎬 Generating video from panels...");const n=e.panelUrls.filter(h=>h.startsWith("data:")),c=e.panelUrls.filter(h=>!h.startsWith("data:"));let p=[...c];if(n.length>0){console.log("🔧 Compressing",n.length,"panel images for video generation...");const s=n.map(a=>Xn(a)).reduce((a,i)=>a+i,0);console.log(`📏 Original panels total size: ${Math.round(s/1024)}KB`);const u=await Sr(n,{maxWidth:720,maxHeight:720,quality:.75,format:"jpeg",maxSizeKB:1e3}),d=u.map(a=>a.dataURL),r=u.reduce((a,i)=>a+i.compressedSize,0);console.log(`✅ Compressed panels total size: ${Math.round(r/1024)}KB (${Math.round(s/r*100)/100}x reduction)`),p=[...c,...d]}const v=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateVideo}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({panelUrls:p,narrationText:e.narrationText,voiceId:e.voiceId||"default",duration:e.duration||8,provider:"fal-ai"})});if(!v.ok){const h=await v.text();throw new Error(`Video generation error: ${v.status} - ${h}`)}const S=await v.json();return S.videoUrl||S.url}catch(n){throw console.error("Video generation error:",n),n}}async generateText(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateText}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({prompt:e.prompt,maxLength:e.maxLength||100})});if(!n.ok){const p=await n.text();throw new Error(`Text generation error: ${n.status} - ${p}`)}return(await n.json()).text}catch(n){throw console.error("Text generation error:",n),n}}async nanoBananaPhotoToVideo(e){try{console.log("🍌 Nano Banana: Converting photo to 8-second video...");let n=e.imageUrl;if(e.imageUrl.startsWith("data:")){console.log("🔧 Compressing image for Nano Banana video generation...");const v=await Et(e.imageUrl,{maxWidth:720,maxHeight:720,quality:.8,format:"jpeg",maxSizeKB:2e3});n=v.dataURL,console.log(`✅ Compressed for video: ${Math.round(v.compressedSize/1024)}KB`)}const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.nanoBananaPhotoToVideo}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrl:n,prompt:e.prompt||"Create an 8-second animated video with natural movement and depth",duration:e.duration||8,quality:e.quality||"720p",provider:"gemini-nano-banana"})});if(!c.ok){const v=await c.text();throw new Error(`Nano Banana photo to video error: ${c.status} - ${v}`)}const p=await c.json();return console.log("✅ Nano Banana video generated successfully!"),p.videoUrl||p.url}catch(n){throw console.error("Nano Banana photo to video error:",n),n}}async nanoBananaImageFusion(e){try{console.log("🍌 Nano Banana: Fusing",e.imageUrls.length,"images...");const n=e.imageUrls.filter(h=>h.startsWith("data:")),c=e.imageUrls.filter(h=>!h.startsWith("data:"));let p=[...c];if(n.length>0){console.log("🔧 Compressing",n.length,"images for Nano Banana fusion...");const h=await Sr(n,{maxWidth:512,maxHeight:512,quality:.8,format:"jpeg",maxSizeKB:1500}),s=h.map(d=>d.dataURL);p=[...c,...s];const u=h.reduce((d,r)=>d+r.compressedSize,0);console.log(`✅ Compressed for fusion: ${Math.round(u/1024)}KB total`)}const v=await fetch(`${this.config.baseUrl}${this.config.endpoints.nanoBananaImageFusion}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrls:p,prompt:e.prompt||"Create a natural and seamless fusion blending all images harmoniously",style:e.style||"natural",maxImages:8,provider:"gemini-nano-banana"})});if(!v.ok){const h=await v.text();throw new Error(`Nano Banana image fusion error: ${v.status} - ${h}`)}const S=await v.json();return console.log("✅ Nano Banana image fusion completed successfully!"),S.imageUrl||S.url}catch(n){throw console.error("Nano Banana image fusion error:",n),n}}async testConnection(){try{return(await fetch(`${this.config.baseUrl}/health`,{method:"GET"})).ok}catch(e){return console.error("Backend connection test failed:",e),!1}}}const Ze=new zm,Bm=()=>{var t;try{const e=navigator.language||((t=navigator.languages)==null?void 0:t[0])||"en",n={zh:"zh-TW","zh-TW":"zh-TW","zh-CN":"zh-TW","zh-HK":"zh-TW",es:"es","es-ES":"es","es-MX":"es",ja:"ja","ja-JP":"ja",fr:"fr","fr-FR":"fr",en:"en","en-US":"en","en-GB":"en"};if(n[e])return console.log("🌍 Language detected:",e,"→",n[e]),n[e];const c=e.substring(0,2);return n[c]?(console.log("🌍 Language detected (prefix):",c,"→",n[c]),n[c]):(console.log("🌍 Language defaulted to English for:",e),"en")}catch(e){return console.log("🌍 Language detection failed, defaulting to English:",e),"en"}},er=ai()(Jh((t,e)=>({currentLanguage:"en",isInitialized:!1,setLanguage:n=>t({currentLanguage:n}),initializeLanguage:()=>{if(!e().isInitialized){const c=Bm();t({currentLanguage:c,isInitialized:!0})}}}),{name:"language-storage",partialize:t=>({currentLanguage:t.currentLanguage})})),tr={en:{settings:{title:"API Configuration",apiConfiguration:"AI Service Configuration",importantNotice:{title:"Important: Use Your Own Gemini API Key",description:"OmniCanvas uses Google Gemini for AI image generation. Your API key is stored securely and processed through our backend for better security."},apiKeys:{title:"Gemini API Key Configuration",services:{gemini:{name:"Google Gemini",description:"For AI image generation and creative tools",placeholder:"AIza..."}},required:"Required",optional:"Optional",valid:"Valid",invalid:"Invalid",current:"Current",save:"Save",openSettings:"Open Settings",rateLimitExceeded:"Rate limit exceeded. Please wait a moment before trying again."},gettingStarted:{title:"Getting Started:",steps:["Visit Google AI Studio to get your free API key","Copy your Gemini API key from the dashboard","Paste it below and save your configuration","Start creating amazing AI-powered content!"],getApiKeyButton:"Get Free Gemini API Key"},security:{title:"Security & Privacy",benefits:["Your API key is encrypted and stored locally","All AI requests are processed securely through our backend","You maintain full control over your API usage and costs","No API keys are stored on our servers","Enhanced security compared to direct frontend API calls"]}}},"zh-TW":{settings:{title:"API 設定",apiConfiguration:"AI 服務設定",importantNotice:{title:"重要：使用您自己的 Gemini API 金鑰",description:"OmniCanvas 使用 Google Gemini 進行 AI 圖片生成。您的 API 金鑰安全儲存並透過我們的後端處理，提供更佳的安全性。"},apiKeys:{title:"Gemini API 金鑰設定",services:{gemini:{name:"Google Gemini",description:"用於 AI 圖片生成和創意工具",placeholder:"AIza..."}},required:"必填",optional:"選填",valid:"有效",invalid:"無效",current:"目前",save:"儲存",openSettings:"開啟設定",rateLimitExceeded:"請求頻率超過限制，請稍候再試。"},gettingStarted:{title:"開始使用：",steps:["造訪 Google AI Studio 取得免費 API 金鑰","從控制台複製您的 Gemini API 金鑰","貼上並儲存您的設定","開始創作令人驚艷的 AI 內容！"],getApiKeyButton:"取得免費 Gemini API 金鑰"},security:{title:"安全與隱私",benefits:["您的 API 金鑰加密儲存在本地","所有 AI 請求透過我們的後端安全處理","您完全控制 API 使用和費用","我們的伺服器不儲存任何 API 金鑰","相較於直接前端 API 呼叫提供更強化的安全性"]}}},es:{settings:{title:"Configuración de API",apiConfiguration:"Configuración de Servicios de IA",importantNotice:{title:"Importante: Use Su Propia Clave API de Gemini",description:"OmniCanvas utiliza Google Gemini para la generación de imágenes con IA. Su clave API se almacena de forma segura y se procesa a través de nuestro backend para mayor seguridad."},apiKeys:{title:"Configuración de Clave API de Gemini",services:{gemini:{name:"Google Gemini",description:"Para generación de imágenes con IA y herramientas creativas",placeholder:"AIza..."}},required:"Requerido",optional:"Opcional",valid:"Válido",invalid:"Inválido",current:"Actual",save:"Guardar",openSettings:"Abrir Configuración",rateLimitExceeded:"Límite de velocidad excedido. Espere un momento antes de intentar nuevamente."},gettingStarted:{title:"Primeros pasos:",steps:["Visite Google AI Studio para obtener su clave API gratuita","Copie su clave API de Gemini desde el panel de control","Péguela abajo y guarde su configuración","¡Comience a crear contenido increible con IA!"],getApiKeyButton:"Obtener Clave API de Gemini Gratis"},security:{title:"Seguridad y Privacidad",benefits:["Su clave API se cifra y almacena localmente","Todas las solicitudes de IA se procesan de forma segura a través de nuestro backend","Mantiene control total sobre el uso y los costos de su API","No se almacenan claves API en nuestros servidores","Seguridad mejorada comparada con llamadas directas de API desde el frontend"]}}},ja:{settings:{title:"API設定",apiConfiguration:"AIサービス設定",importantNotice:{title:"重要：独自のGemini APIキーを使用してください",description:"OmniCanvasはGoogle Geminiを使用してAI画像生成を行います。您のAPIキーは安全に保存され、より高いセキュリティのために当社のバックエンドで処理されます。"},apiKeys:{title:"Gemini APIキー設定",services:{gemini:{name:"Google Gemini",description:"AI画像生成とクリエイティブツール用",placeholder:"AIza..."}},required:"必須",optional:"オプション",valid:"有効",invalid:"無効",current:"現在",save:"保存",openSettings:"設定を開く",rateLimitExceeded:"レート制限を超えました。しばらく待ってから再試行してください。"},gettingStarted:{title:"始め方：",steps:["Google AI Studioで無料APIキーを取得","ダッシュボードからGemini APIキーをコピー","以下に貼り付けて設定を保存","素晴らしいAIコンテンツの作成を開始！"],getApiKeyButton:"無料Gemini APIキーを取得"},security:{title:"セキュリティとプライバシー",benefits:["APIキーは暗号化されてローカルに保存されます","すべてのAIリクエストは当社のバックエンドで安全に処理されます","APIの使用とコストを完全に制御できます","当社のサーバーにAPIキーは保存されません","フロントエンドからの直接API呼び出しと比較して強化されたセキュリティ"]}}},fr:{settings:{title:"Configuration API",apiConfiguration:"Configuration des Services IA",importantNotice:{title:"Important : Utilisez Votre Propre Clé API Gemini",description:"OmniCanvas utilise Google Gemini pour la génération d'images IA. Votre clé API est stockée en sécurité et traitée via notre backend pour une meilleure sécurité."},apiKeys:{title:"Configuration de la Clé API Gemini",services:{gemini:{name:"Google Gemini",description:"Pour la génération d'images IA et les outils créatifs",placeholder:"AIza..."}},required:"Requis",optional:"Optionnel",valid:"Valide",invalid:"Invalide",current:"Actuel",save:"Sauvegarder",openSettings:"Ouvrir les Paramètres",rateLimitExceeded:"Limite de débit dépassée. Veuillez attendre un moment avant de réessayer."},gettingStarted:{title:"Commencer :",steps:["Visitez Google AI Studio pour obtenir votre clé API gratuite","Copiez votre clé API Gemini depuis le tableau de bord","Collez-la ci-dessous et sauvegardez votre configuration","Commencez à créer du contenu IA incroyable !"],getApiKeyButton:"Obtenir une Clé API Gemini Gratuite"},security:{title:"Sécurité et Confidentialité",benefits:["Votre clé API est chiffrée et stockée localement","Toutes les requêtes IA sont traitées en sécurité via notre backend","Vous maintenez un contrôle total sur l'utilisation et les coûts de votre API","Aucune clé API n'est stockée sur nos serveurs","Sécurité améliorée comparée aux appels API directs depuis le frontend"]}}}},Um={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"AI Assistant",tabs:{storyMaker:"Story Maker",generate:"Generate"},generate:{tabs:{generate:"Generate",enhance:"Enhance",video:"Video"},validation:{generateMessage:"Generate supports any number of reference images or none for fresh creation",styleMessage:"Style transfer requires exactly 1 image",mergeMessage:"Merge requires 2+ images"},processing:{analyzing:"Analyzing your request...",composing:"Creating beautiful compositions...",rendering:"Rendering high-quality images...",finalizing:"Adding final touches..."},templates:{title:"Popular Nano Banana Templates (Click to use)",withSelection:"+ Selected Images",categories:{all:"All",creative:"🎨 Creative",professional:"💼 Professional",fun:"🎮 Fun"},items:{figurine:{title:"3D Figurine",description:"Desktop model"},handDrawn:{title:"Hand-drawn Process",description:"Sketch to final"},crossSection:{title:"3D Cross-section",description:"Internal structure"},restoration:{title:"Photo Restoration",description:"Colorize & repair"},idPhoto:{title:"Professional ID",description:"Business portrait"},product:{title:"Product Shot",description:"E-commerce photo"},interior:{title:"Interior Design",description:"Space makeover"},marketing:{title:"Marketing Material",description:"Social media"},tryOn:{title:"Virtual Try-on",description:"Outfit swap"},timeTravel:{title:"Time Travel",description:"Different eras"},petAdventure:{title:"Pet Adventures",description:"Fun scenarios"},ingredients:{title:"Food Breakdown",description:"Recipe guide"},backgroundRemoval:{title:"Background Removal",description:"Remove background"},qualityEnhancement:{title:"Quality Enhancement",description:"Improve clarity"}},applied:"✨ Template applied! You can generate directly or modify the prompt above"},placeholder:"Describe what you want to generate...",generateButton:"Generate with Nano Banana",generating:"Generating with Nano Banana...",imageToImageMode:"🎨 Image-to-Image Mode",imageToImageDescription:"Your selected images will be combined with your prompt/template to generate new images.",quickEnhancements:"✨ Quick Enhancements (Click to toggle)",enhancementItems:["viral meme style","4K ultra HD","cinematic lighting","trending on artstation","octane render"],selectedImages:"images selected from canvas",invalidForTab:"Invalid for"},enhance:{selectImages:"Select Images to Enhance",selectImagesDescription:"Please select one or more images from the canvas to enhance",enhancementReady:"Enhancement Ready",willBeProcessed:"Your selected images will be processed and enhanced with AI technology.",enhancementOptions:"Enhancement Options",aiUpscale:"AI Upscale",upscaleDescription:"Increase image resolution using AI upscaling technology",backgroundRemoval:"Background Removal",backgroundRemovalDescription:"Automatically remove background and create transparent PNG",qualityEnhancement:"Quality Enhancement",qualityEnhancementDescription:"Improve overall image quality, reduce noise and artifacts",enhancementSummary:"Enhancement Summary",upscaleTo:"Upscale to",removeBackground:"Remove background (transparent PNG)",enhancedQuality:"Enhanced quality and noise reduction",processing:"Processing",enhanceButton:"Enhance Images",enhancing:"Enhancing...",resolutions:{"2x":"2x Resolution","4x":"4x Resolution","8x":"8x Resolution"}},selected:"selected",selectedFromCanvas:"selected from canvas",invalidFor:"Invalid for",selectedImagesNote:"Selected images will be automatically included in the AI request",generateBasedOn:"Generate new images based on your",selectedImage:"selected image",generateWithGemini:"Generate images with Gemini 2.5 Flash (Nano Banana)",imageToImageMode:"Image-to-Image Mode",active:"ACTIVE",selectedImagesCombined:"Your selected images will be combined with your prompt/template to generate new images.",useTemplate:"Use Template",close:"Close",image:"image",images:"images",storyMaker:{title:"Story Maker",description:"Create 4-panel comic stories with consistent characters",styleLabel:"Art Style",characterLabel:"Main Character",productLabel:"Featured Product",storyPromptLabel:"Story Concept",generateButton:"Generate 4-Panel Comic",useFromCanvas:"Use from Canvas",uploadImage:"Upload Image",generating:"Generating panel",placeholder:`Describe your story in one sentence...

Examples:
• A coffee shop encounter on a snowy Christmas night
• Finding the perfect gift during holiday shopping
• A friendship that blooms in a cozy bookstore`,styles:{comic:"Comic Book",manga:"Manga Style",watercolor:"Watercolor",oil:"Oil Painting",sketch:"Pencil Sketch"},characterSection:{title:"Main Character",description:"Upload or select the main character for your story",required:"Required",optional:"Optional"},productSection:{title:"Featured Product",description:"Add a product to feature in your story (optional)",optional:"Optional"},storySection:{title:"Story Concept",description:"Describe your story idea in one sentence",examples:["A coffee shop encounter on a snowy Christmas night","Finding the perfect gift during holiday shopping","A friendship that blooms in a cozy bookstore"]},generatingPanels:"Generating comic panels...",panelComplete:"Panel completed",storyComplete:"Comic story completed!",errors:{noStory:"Please enter a story prompt first!",characterRequired:"Please upload or select a character image!",generationFailed:"Comic generation failed. Please try again."}}},loadingIndicator:{stages:{analyzing:{text:"Analyzing...",description:"Understanding your creative needs"},composing:{text:"Composing...",description:"Designing creative concepts"},rendering:{text:"Rendering...",description:"Drawing beautiful images"},finalizing:{text:"Finalizing...",description:"Final touches"}}},nanoBananaPrompt:{title:"🎤 Nano Banana Prompt Input",selectedObjects:"objects selected",stabilityTip:{title:"Object Stability Tip",description:'We recommend including phrases like "keep main objects unchanged" or "maintain original features" in your prompt to ensure all important elements like people, furniture, and products remain stable and consistent.'},inputModes:{text:"📝 Text Input",voice:"🎤 Voice Input"},voiceNotSupported:"⚠️ Your browser does not support voice recognition",voiceStatus:{listening:"🎤 Listening, please speak...",clickToStart:"Click the microphone to start voice input"},promptLabel:"Prompt Content",promptPlaceholder:"For example: Change the background to a beach, keep main objects unchanged; Move the sofa to the living room, maintain sofa features...",quickExamples:"Quick Examples",examples:["Change the background to a beach, keep main objects unchanged","Move the sofa to the living room, maintain sofa features","Add stars to the sky, keep all objects consistent","Change to snowy background, furniture features unchanged","Make the room brighter, keep items as they are","Change to wooden floor, object appearance stable"],submit:"Execute Command",cancel:"Cancel"},contextMenu:{header:"✨ AI Actions",playVideo:"🎬 Play Video",aiSmartCompose:"🧠 AI Smart Compose",creativeBlend:"✨ Creative Blend",generateSimilar:"🌟 Generate Similar",nanoBananaPrompt:"🎤 Nano Banana Prompt Input",saveSelected:"Save Selected",duplicate:"Duplicate",duplicateMultiple:"Duplicate",delete:"Delete",deleteMultiple:"Delete"},serviceGuide:{title:"Service Guide",subtitle:"Learn how to use OmniCanvas features",quickStart:"Quick Start",quickActions:{generate:"Start Creating",generateDesc:"Open AI generation panel",enhance:"Enhance Images",enhanceDesc:"Improve your images with AI",settings:"Configure API",settingsDesc:"Set up your API keys"},overview:{title:"Overview",whatIs:{title:"What is OmniCanvas?",description:"OmniCanvas is an AI-powered creative platform that combines digital drawing, AI image generation, and multi-modal content integration.",features:{unlimited:"Unlimited creative canvas",aiPowered:"AI-powered generation and enhancement",multilingual:"Support for 5 languages",privacy:"Privacy-first with your own API keys"}}},aiGeneration:{title:"AI Image Generation",textToImage:{title:"Text-to-Image",description:"Generate images from text descriptions using Gemini 2.5 Flash.",steps:{openPanel:"Open the AI panel",writePrompt:"Write your description",selectTemplate:"Choose a template (optional)",generate:"Click Generate to create"}},imageToImage:{title:"Image-to-Image",description:"Create new images based on existing reference images.",steps:{selectImages:"Select reference images on canvas",openPanel:"Open AI panel",writePrompt:"Add your creative instructions",generate:"Generate new variations"}}},enhancement:{title:"AI Enhancement",aiUpscale:{title:"AI Upscaling",description:"Increase image resolution up to 8x using AI technology.",features:{resolution:"2x, 4x, 8x resolution options",quality:"Enhanced detail preservation",details:"Smart edge enhancement"}},backgroundRemoval:{title:"Background Removal",description:"Automatically remove backgrounds and create transparent PNGs.",features:{automatic:"One-click background removal",transparent:"True transparent PNG output",precise:"Accurate edge detection"}}},canvas:{title:"Canvas Navigation",navigation:{title:"Navigation Controls",description:"Learn how to navigate the infinite canvas.",controls:{zoom:"Zoom in/out",pan:"Pan around",select:"Select objects",multiSelect:"Multi-select"}},layers:{title:"Layer Management",description:"Organize your artwork with layers.",features:{unlimited:"Unlimited layers",visibility:"Show/hide layers",reorder:"Drag to reorder",lock:"Lock for protection"}}},contextMenu:{title:"Smart Context Menu",smartCompose:{title:"AI Composition",description:"Right-click on selected images to access AI composition tools.",options:{intelligent:"Intelligent auto-compose",accessory:"Accessory integration",scene:"Scene composition",creative:"Creative blending"}},voiceCommand:{title:"Voice Commands",description:"Use voice input for creative instructions.",features:{multilingual:"Multiple language support",intelligent:"AI understanding of creative intent",realtime:"Real-time processing"}}},settings:{title:"Settings & Configuration",apiKey:{title:"API Key Setup",description:"Configure your Gemini API key for AI features.",steps:{getKey:"Get API key from ai.google.dev",openSettings:"Open Settings panel",enterKey:"Enter your API key",save:"Save configuration"}},language:{title:"Language Settings",description:"Choose your preferred interface language."}},needHelp:{title:"Need Help?",description:"Get support from our community or contact us directly.",contact:"Contact Support",community:"Join Community"}},common:{loading:"Loading...",error:"Error",success:"Success",cancel:"Cancel",confirm:"Confirm",save:"Save",delete:"Delete",edit:"Edit",close:"Close",settings:"Settings"},alerts:{imageGenerationFailed:"Image generation failed: ",mergeSelectMinImages:"Please select at least 2 images to merge",mergeEnterInstructions:'Please enter merge instructions, e.g., "Blend these images into an artistic collage"',mergeFailed:"Image merging failed: ",styleSelectImage:"Please select an image to apply style",styleEnterDescription:'Please enter style description, e.g., "Van Gogh Starry Night style"',styleTransferComplete:"Style transfer complete!",styleTransferFailed:"Style transfer failed: ",comicGenerationFailed:"Comic generation failed. Please try again!",enterEditInstructions:"Please enter edit instructions!",generateComicFirst:"Generate a comic first!",panelEditingFailed:"Panel editing failed. Please try again!",storyGenerationFailed:"Story idea generation failed. Please try again!",selectImagesFirst:"Please select images on the canvas or generate a comic first!",magicEraserSelectImage:"Please select an image to use Magic Eraser",magicEraserComplete:"🪄 Magic Eraser complete! Unwanted objects removed.",magicEraserFailed:"Magic eraser failed: ",backgroundRemovalSelectImage:"Please select an image to remove background",backgroundRemovalComplete:"✂️ Background removed successfully!",backgroundRemovalFailed:"Background removal failed: ",avatarSelectPhoto:"Please select a photo to generate avatar",avatarGenerationFailed:"Avatar generation failed: ",mergedImagesSuccess:"Successfully merged {count} images!"},...tr.en},Gm={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"AI 助手",tabs:{storyMaker:"故事創作",generate:"生成"},generate:{tabs:{generate:"生成",enhance:"增強",video:"視頻"},validation:{generateMessage:"生成功能支援任意數量的參考圖片，或無圖片全新創作",styleMessage:"風格轉換需要恰好 1 張圖片",mergeMessage:"合併功能需要 2 張以上圖片"},processing:{analyzing:"正在分析您的需求...",composing:"正在創作精美構圖...",rendering:"正在渲染高品質圖像...",finalizing:"正在添加最後潤飾..."},templates:{title:"Nano Banana 熱門模板 (點擊使用)",withSelection:"+ 已選圖片",categories:{all:"全部",creative:"🎨 創意轉換",professional:"💼 專業商用",fun:"🎮 趣味玩法"},items:{figurine:{title:"3D 模型公仔",description:"桌面擺飾模型"},handDrawn:{title:"手繪過程",description:"草稿到完稿"},crossSection:{title:"3D 剖面圖",description:"內部結構解析"},restoration:{title:"老照片修復",description:"上色與修復"},idPhoto:{title:"專業證件照",description:"商務形象照"},product:{title:"產品攝影",description:"電商專業照"},interior:{title:"室內設計",description:"空間改造"},marketing:{title:"行銷素材",description:"社群媒體圖"},tryOn:{title:"虛擬試穿",description:"服裝換搭"},timeTravel:{title:"時空旅行",description:"不同年代造型"},petAdventure:{title:"寵物冒險",description:"趣味場景"},ingredients:{title:"食材分解",description:"料理教學"},backgroundRemoval:{title:"背景移除",description:"去除背景"},qualityEnhancement:{title:"品質增強",description:"提升清晰度"}},applied:"✨ 模板已套用！可以直接生成或在上方輸入框中修改提示詞"},placeholder:"描述您想要生成的內容...",generateButton:"使用 Nano Banana 生成",generating:"正在使用 Nano Banana 生成...",imageToImageMode:"🎨 圖生圖模式",imageToImageDescription:"您選擇的圖片將與提示詞/模板結合來生成新圖片。",quickEnhancements:"✨ 快速增強 (點擊切換)",enhancementItems:["病毒迷因風格","4K 超高清","電影級打光","藝術站熱門","Octane 渲染"],selectedImages:"張圖片已從畫布選取",invalidForTab:"不適用於"},enhance:{selectImages:"選擇要增強的圖片",selectImagesDescription:"請從畫布選擇一張或多張圖片進行增強",enhancementReady:"增強準備就緒",willBeProcessed:"您選擇的圖片將使用 AI 技術進行處理和增強。",enhancementOptions:"增強選項",aiUpscale:"AI 放大",upscaleDescription:"使用 AI 放大技術提升圖片解析度",backgroundRemoval:"背景移除",backgroundRemovalDescription:"自動移除背景並創建透明 PNG",qualityEnhancement:"品質增強",qualityEnhancementDescription:"提升整體圖片品質，減少噪點和瑕疵",enhancementSummary:"增強摘要",upscaleTo:"放大至",removeBackground:"移除背景 (透明 PNG)",enhancedQuality:"增強品質和降噪",processing:"處理",enhanceButton:"增強圖片",enhancing:"增強中...",resolutions:{"2x":"2 倍解析度","4x":"4 倍解析度","8x":"8 倍解析度"}},selected:"已選擇",selectedFromCanvas:"從畫布選擇",invalidFor:"不適用於",selectedImagesNote:"選擇的圖片將自動包含在 AI 請求中",generateBasedOn:"基於您的",selectedImage:"選擇的圖片",generateWithGemini:"使用 Gemini 2.5 Flash 生成圖片 (Nano Banana)",imageToImageMode:"圖像到圖像模式",active:"啟用",selectedImagesCombined:"您選擇的圖片將與提示詞/模板結合來生成新圖片。",useTemplate:"使用模板",close:"關閉",image:"圖片",images:"圖片",storyMaker:{title:"故事創作",description:"創建具有一致角色的四格漫畫故事",styleLabel:"藝術風格",characterLabel:"主要角色",productLabel:"特色產品",storyPromptLabel:"故事概念",generateButton:"生成四格漫畫",useFromCanvas:"從畫布使用",uploadImage:"上傳圖片",generating:"正在生成分鏡",placeholder:`用一句話描述您的故事...

範例：
• 雪夜中的咖啡店邂逅
• 假期購物中尋找完美禮物
• 在溫馨書店中綻放的友誼`,styles:{comic:"漫畫風格",manga:"日式漫畫",watercolor:"水彩畫",oil:"油畫",sketch:"鉛筆素描"},characterSection:{title:"主要角色",description:"上傳或選擇故事的主要角色",required:"必填",optional:"選填"},productSection:{title:"特色產品",description:"添加要在故事中展示的產品（選填）",optional:"選填"},storySection:{title:"故事概念",description:"用一句話描述您的故事想法",examples:["雪夜中的咖啡店邂逅","假期購物中尋找完美禮物","在溫馨書店中綻放的友誼"]},generatingPanels:"正在生成漫畫分鏡...",panelComplete:"分鏡完成",storyComplete:"漫畫故事完成！",errors:{noStory:"請先輸入故事提示！",characterRequired:"請上傳或選擇角色圖片！",generationFailed:"漫畫生成失敗，請重試。"}}},loadingIndicator:{stages:{analyzing:{text:"分析中...",description:"理解您的創意需求"},composing:{text:"構思中...",description:"設計創意概念"},rendering:{text:"生成中...",description:"繪製精美圖像"},finalizing:{text:"完成中...",description:"最後潤飾"}}},nanoBananaPrompt:{title:"🎤 Nano Banana 提示詞輸入",selectedObjects:"個物件已選擇",stabilityTip:{title:"物件穩定性提示",description:"建議在指令中加入「保持主要物件不變」、「維持原本特徵」等字句，確保人物、傢具、產品等所有重要元素的特徵穩定一致。"},inputModes:{text:"📝 文字輸入",voice:"🎤 語音輸入"},voiceNotSupported:"⚠️ 您的瀏覽器不支援語音識別功能",voiceStatus:{listening:"🎤 正在聆聽中，請說話...",clickToStart:"點擊麥克風開始語音輸入"},promptLabel:"指令內容",promptPlaceholder:"例如：把背景換成海灘，保持主要物件不變、讓沙發移到客廳，維持沙發特徵...",quickExamples:"快速範例",examples:["把背景換成海灘，保持主要物件不變","讓沙發移到客廳，維持沙發特徵","加入星星到天空，所有物件保持一致","換成雪景背景，傢具特徵不變","讓房間更明亮，保持物品原貌","改成木質地板，物件外觀穩定"],submit:"執行指令",cancel:"取消"},contextMenu:{header:"✨ AI 動作",playVideo:"🎬 播放影片",aiSmartCompose:"🧠 AI 智能合成",creativeBlend:"✨ 創意混合",generateSimilar:"🌟 生成相似內容",nanoBananaPrompt:"🎤 Nano Banana 提示詞輸入",saveSelected:"儲存已選擇",duplicate:"複製",duplicateMultiple:"複製",delete:"刪除",deleteMultiple:"刪除"},serviceGuide:{title:"服務指南",subtitle:"學習如何使用 OmniCanvas 功能",quickStart:"快速開始",quickActions:{generate:"開始創作",generateDesc:"開啟 AI 生成面板",enhance:"增強圖片",enhanceDesc:"使用 AI 提升圖片品質",settings:"設定 API",settingsDesc:"配置 API 金鑰"},overview:{title:"概述",whatIs:{title:"什麼是 OmniCanvas？",description:"OmniCanvas 是一個 AI 驅動的創意平台，結合了數位繪圖、AI 圖片生成和多模態內容整合。",features:{unlimited:"無限創意畫布",aiPowered:"AI 驅動的生成與增強",multilingual:"支援 5 種語言",privacy:"隱私優先，使用您自己的 API 金鑰"}}},aiGeneration:{title:"AI 圖片生成",textToImage:{title:"文字轉圖片",description:"使用 Gemini 2.5 Flash 從文字描述生成圖片。",steps:{openPanel:"開啟 AI 面板",writePrompt:"撰寫描述文字",selectTemplate:"選擇模板（可選）",generate:"點擊生成創作"}},imageToImage:{title:"圖片轉圖片",description:"基於現有參考圖片創建新圖片。",steps:{selectImages:"在畫布上選擇參考圖片",openPanel:"開啟 AI 面板",writePrompt:"添加創作指令",generate:"生成新變化"}}},enhancement:{title:"AI 增強",aiUpscale:{title:"AI 放大",description:"使用 AI 技術將圖片解析度提升至 8 倍。",features:{resolution:"2x、4x、8x 解析度選項",quality:"增強細節保留",details:"智能邊緣強化"}},backgroundRemoval:{title:"背景移除",description:"自動移除背景並創建透明 PNG。",features:{automatic:"一鍵背景移除",transparent:"真正透明 PNG 輸出",precise:"精確邊緣檢測"}}},canvas:{title:"畫布導航",navigation:{title:"導航控制",description:"學習如何在無限畫布上導航。",controls:{zoom:"縮放",pan:"平移",select:"選擇物件",multiSelect:"多重選擇"}},layers:{title:"圖層管理",description:"使用圖層組織您的作品。",features:{unlimited:"無限圖層",visibility:"顯示/隱藏圖層",reorder:"拖曳重新排序",lock:"鎖定保護"}}},contextMenu:{title:"智能右鍵選單",smartCompose:{title:"AI 合成",description:"右鍵點擊選中的圖片以使用 AI 合成工具。",options:{intelligent:"智能自動合成",accessory:"配件整合",scene:"場景合成",creative:"創意混合"}},voiceCommand:{title:"語音指令",description:"使用語音輸入創作指令。",features:{multilingual:"多語言支援",intelligent:"AI 理解創作意圖",realtime:"即時處理"}}},settings:{title:"設定與配置",apiKey:{title:"API 金鑰設定",description:"配置您的 Gemini API 金鑰以使用 AI 功能。",steps:{getKey:"從 ai.google.dev 獲取 API 金鑰",openSettings:"開啟設定面板",enterKey:"輸入您的 API 金鑰",save:"儲存配置"}},language:{title:"語言設定",description:"選擇您偏好的介面語言。"}},needHelp:{title:"需要幫助？",description:"從我們的社群獲得支援或直接聯絡我們。",contact:"聯絡支援",community:"加入社群"}},common:{loading:"載入中...",error:"錯誤",success:"成功",cancel:"取消",confirm:"確認",save:"儲存",delete:"刪除",edit:"編輯",close:"關閉",settings:"設定"},alerts:{imageGenerationFailed:"圖片生成失敗：",mergeSelectMinImages:"請選擇至少 2 張圖片進行合併",mergeEnterInstructions:"請輸入合併指令，例如：「將這些圖片融合成藝術拼貼」",mergeFailed:"圖片合併失敗：",styleSelectImage:"請選擇一張圖片來套用風格",styleEnterDescription:"請輸入風格描述，例如：「梵谷星夜風格」",styleTransferComplete:"風格轉換完成！",styleTransferFailed:"風格轉換失敗：",comicGenerationFailed:"漫畫生成失敗，請重試！",enterEditInstructions:"請輸入編輯指令！",generateComicFirst:"請先生成漫畫！",panelEditingFailed:"分鏡編輯失敗，請重試！",storyGenerationFailed:"故事構思生成失敗，請重試！",selectImagesFirst:"請先在畫布上選擇圖片或生成漫畫！",magicEraserSelectImage:"請選擇一張圖片來使用魔術橡皮擦",magicEraserComplete:"🪄 魔術橡皮擦完成！已移除不需要的物件。",magicEraserFailed:"魔術橡皮擦失敗：",backgroundRemovalSelectImage:"請選擇一張圖片來移除背景",backgroundRemovalComplete:"✂️ 背景移除成功！",backgroundRemovalFailed:"背景移除失敗：",avatarSelectPhoto:"請選擇一張照片來生成頭像",avatarGenerationFailed:"頭像生成失敗：",mergedImagesSuccess:"成功合併 {count} 張圖片！"},...tr["zh-TW"]},Wm={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"Asistente IA",tabs:{storyMaker:"Creador de Historias",generate:"Generar"},generate:{tabs:{generate:"Generar",enhance:"Mejorar",video:"Video"},validation:{generateMessage:"Generar soporta cualquier número de imágenes de referencia o ninguna para creación nueva",styleMessage:"Transferencia de estilo requiere exactamente 1 imagen",mergeMessage:"Fusionar requiere 2+ imágenes"},processing:{analyzing:"Analizando tu solicitud...",composing:"Creando composiciones hermosas...",rendering:"Renderizando imágenes de alta calidad...",finalizing:"Añadiendo toques finales..."},templates:{title:"Plantillas Populares de Nano Banana (Clic para usar)",withSelection:"+ Imágenes Seleccionadas",categories:{all:"Todas",creative:"🎨 Creativo",professional:"💼 Profesional",fun:"🎮 Diversión"},items:{figurine:{title:"Figura 3D",description:"Modelo de escritorio"},handDrawn:{title:"Proceso Dibujado",description:"Boceto a final"},crossSection:{title:"Sección 3D",description:"Estructura interna"},restoration:{title:"Restaurar Foto",description:"Colorear y reparar"},idPhoto:{title:"ID Profesional",description:"Retrato empresarial"},product:{title:"Foto de Producto",description:"Foto e-commerce"},interior:{title:"Diseño Interior",description:"Renovación espacial"},marketing:{title:"Material Marketing",description:"Redes sociales"},tryOn:{title:"Prueba Virtual",description:"Cambio de ropa"},timeTravel:{title:"Viaje en el Tiempo",description:"Diferentes épocas"},petAdventure:{title:"Aventuras Mascota",description:"Escenas divertidas"},ingredients:{title:"Desglose Comida",description:"Guía de receta"}},applied:"✨ ¡Plantilla aplicada! Puedes generar directamente o modificar el prompt arriba"},placeholder:"Describe lo que quieres generar...",generateButton:"Generar con Nano Banana",generating:"Generando con Nano Banana...",imageToImageMode:"🎨 Modo Imagen a Imagen",imageToImageDescription:"Tus imágenes seleccionadas se combinarán con tu prompt/plantilla para generar nuevas imágenes.",quickEnhancements:"✨ Mejoras Rápidas (Clic para alternar)",enhancementItems:["estilo meme viral","4K ultra HD","iluminación cinematográfica","tendencia en artstation","render octane"],selectedImages:"imágenes seleccionadas del lienzo",invalidForTab:"No válido para"},enhance:{selectImages:"Seleccionar Imágenes para Mejorar",selectImagesDescription:"Por favor selecciona una o más imágenes del lienzo para mejorar",enhancementReady:"Mejora Lista",willBeProcessed:"Tus imágenes seleccionadas serán procesadas y mejoradas con tecnología IA.",enhancementOptions:"Opciones de Mejora",aiUpscale:"Escalado IA",upscaleDescription:"Aumentar resolución de imagen usando tecnología de escalado IA",backgroundRemoval:"Eliminación de Fondo",backgroundRemovalDescription:"Remover automáticamente el fondo y crear PNG transparente",qualityEnhancement:"Mejora de Calidad",qualityEnhancementDescription:"Mejorar la calidad general de imagen, reducir ruido y artefactos",enhancementSummary:"Resumen de Mejora",upscaleTo:"Escalar a",removeBackground:"Remover fondo (PNG transparente)",enhancedQuality:"Calidad mejorada y reducción de ruido",processing:"Procesando",enhanceButton:"Mejorar Imágenes",enhancing:"Mejorando...",resolutions:{"2x":"Resolución 2x","4x":"Resolución 4x","8x":"Resolución 8x"}},selected:"seleccionado",selectedFromCanvas:"seleccionado del lienzo",invalidFor:"No válido para",selectedImagesNote:"Las imágenes seleccionadas se incluirán automáticamente en la solicitud de IA",generateBasedOn:"Generar nuevas imágenes basadas en tu",selectedImage:"imagen seleccionada",generateWithGemini:"Generar imágenes con Gemini 2.5 Flash (Nano Banana)",imageToImageMode:"Modo Imagen a Imagen",active:"ACTIVO",selectedImagesCombined:"Tus imágenes seleccionadas se combinarán con tu prompt/plantilla para generar nuevas imágenes.",useTemplate:"Usar Plantilla",close:"Cerrar",image:"imagen",images:"imágenes",storyMaker:{title:"Creador de Historias",description:"Crea historias de cómic de 4 paneles con personajes consistentes",styleLabel:"Estilo Artístico",characterLabel:"Personaje Principal",productLabel:"Producto Destacado",storyPromptLabel:"Concepto de Historia",generateButton:"Generar Cómic de 4 Paneles",useFromCanvas:"Usar del Lienzo",uploadImage:"Subir Imagen",generating:"Generando panel",placeholder:`Describe tu historia en una oración...

Ejemplos:
• Un encuentro en una cafetería en una noche navideña nevada
• Encontrar el regalo perfecto durante las compras navideñas
• Una amistad que florece en una acogedora librería`,styles:{comic:"Cómic",manga:"Estilo Manga",watercolor:"Acuarela",oil:"Pintura al Óleo",sketch:"Boceto a Lápiz"},characterSection:{title:"Personaje Principal",description:"Sube o selecciona el personaje principal de tu historia",required:"Requerido",optional:"Opcional"},productSection:{title:"Producto Destacado",description:"Agrega un producto para destacar en tu historia (opcional)",optional:"Opcional"},storySection:{title:"Concepto de Historia",description:"Describe tu idea de historia en una oración",examples:["Un encuentro en una cafetería en una noche navideña nevada","Encontrar el regalo perfecto durante las compras navideñas","Una amistad que florece en una acogedora librería"]},generatingPanels:"Generando paneles de cómic...",panelComplete:"Panel completado",storyComplete:"¡Historia de cómic completada!",errors:{noStory:"¡Por favor ingresa una propuesta de historia primero!",characterRequired:"¡Por favor sube o selecciona una imagen de personaje!",generationFailed:"La generación del cómic falló. Por favor intenta de nuevo."}}},loadingIndicator:{stages:{analyzing:{text:"Analizando...",description:"Entendiendo tus necesidades creativas"},composing:{text:"Componiendo...",description:"Diseñando conceptos creativos"},rendering:{text:"Renderizando...",description:"Dibujando imágenes hermosas"},finalizing:{text:"Finalizando...",description:"Toques finales"}}},nanoBananaPrompt:{title:"🎤 Entrada de Comando Nano Banana",selectedObjects:"objetos seleccionados",stabilityTip:{title:"Consejo de Estabilidad de Objetos",description:'Recomendamos incluir frases como "mantener objetos principales sin cambios" o "conservar características originales" en tu comando para asegurar que todos los elementos importantes como personas, muebles y productos permanezcan estables y consistentes.'},inputModes:{text:"📝 Entrada de Texto",voice:"🎤 Entrada de Voz"},voiceNotSupported:"⚠️ Tu navegador no soporta reconocimiento de voz",voiceStatus:{listening:"🎤 Escuchando, por favor habla...",clickToStart:"Haz clic en el micrófono para iniciar entrada de voz"},promptLabel:"Contenido del Comando",promptPlaceholder:"Por ejemplo: Cambiar el fondo a una playa, mantener objetos principales sin cambios; Mover el sofá a la sala, conservar características del sofá...",quickExamples:"Ejemplos Rápidos",examples:["Cambiar el fondo a una playa, mantener objetos principales sin cambios","Mover el sofá a la sala, conservar características del sofá","Agregar estrellas al cielo, mantener todos los objetos consistentes","Cambiar a fondo nevado, características de muebles sin cambios","Hacer la habitación más brillante, mantener elementos como están","Cambiar a piso de madera, apariencia de objetos estable"],submit:"Ejecutar Comando",cancel:"Cancelar"},contextMenu:{header:"✨ Acciones IA",playVideo:"🎬 Reproducir Video",aiSmartCompose:"🧠 Composición Inteligente IA",creativeBlend:"✨ Mezcla Creativa",generateSimilar:"🌟 Generar Similar",nanoBananaPrompt:"🎤 Entrada de Comando Nano Banana",saveSelected:"Guardar Seleccionados",duplicate:"Duplicar",duplicateMultiple:"Duplicar",delete:"Eliminar",deleteMultiple:"Eliminar"},common:{loading:"Cargando...",error:"Error",success:"Éxito",cancel:"Cancelar",confirm:"Confirmar",save:"Guardar",delete:"Eliminar",edit:"Editar",close:"Cerrar",settings:"Configuración"},alerts:{imageGenerationFailed:"La generación de imágenes falló: ",mergeSelectMinImages:"Por favor selecciona al menos 2 imágenes para fusionar",mergeEnterInstructions:'Por favor ingresa instrucciones de fusión, ej: "Mezcla estas imágenes en un collage artístico"',mergeFailed:"La fusión de imágenes falló: ",styleSelectImage:"Por favor selecciona una imagen para aplicar estilo",styleEnterDescription:'Por favor ingresa descripción de estilo, ej: "Estilo Noche Estrellada de Van Gogh"',styleTransferComplete:"¡Transferencia de estilo completa!",styleTransferFailed:"La transferencia de estilo falló: ",comicGenerationFailed:"¡La generación del cómic falló. Por favor inténtalo de nuevo!",enterEditInstructions:"¡Por favor ingresa instrucciones de edición!",generateComicFirst:"¡Genera un cómic primero!",panelEditingFailed:"¡La edición del panel falló. Por favor inténtalo de nuevo!",storyGenerationFailed:"¡La generación de historia falló. Por favor inténtalo de nuevo!",selectImagesFirst:"¡Por favor selecciona imágenes en el lienzo o genera un cómic primero!",magicEraserSelectImage:"Por favor selecciona una imagen para usar la Goma Mágica",magicEraserComplete:"🪄 ¡Goma Mágica completa! Objetos no deseados eliminados.",magicEraserFailed:"La goma mágica falló: ",backgroundRemovalSelectImage:"Por favor selecciona una imagen para quitar el fondo",backgroundRemovalComplete:"✂️ ¡Fondo eliminado exitosamente!",backgroundRemovalFailed:"La eliminación del fondo falló: ",avatarSelectPhoto:"Por favor selecciona una foto para generar avatar",avatarGenerationFailed:"La generación del avatar falló: ",mergedImagesSuccess:"¡Fusionadas exitosamente {count} imágenes!"},serviceGuide:{title:"Guía de Servicio",subtitle:"Aprende a usar las funciones de OmniCanvas",quickStart:"Inicio Rápido",quickActions:{generate:"Comenzar a Crear",generateDesc:"Abrir panel de generación IA",enhance:"Mejorar Imágenes",enhanceDesc:"Mejora tus imágenes con IA",settings:"Configurar API",settingsDesc:"Configura tus claves API"},overview:{title:"Resumen",whatIs:{title:"¿Qué es OmniCanvas?",description:"OmniCanvas es una plataforma creativa impulsada por IA que combina dibujo digital, generación de imágenes IA e integración de contenido multimodal.",features:{unlimited:"Lienzo creativo ilimitado",aiPowered:"Generación y mejora impulsada por IA",multilingual:"Soporte para 5 idiomas",privacy:"Privacidad primero con tus propias claves API"}}},aiGeneration:{title:"Generación de Imágenes IA",textToImage:{title:"Texto a Imagen",description:"Genera imágenes desde descripciones de texto usando Gemini 2.5 Flash.",steps:{openPanel:"Abre el panel IA",writePrompt:"Escribe tu descripción",selectTemplate:"Elige una plantilla (opcional)",generate:"Haz clic en Generar para crear"}},imageToImage:{title:"Imagen a Imagen",description:"Crea nuevas imágenes basadas en imágenes de referencia existentes.",steps:{selectImages:"Selecciona imágenes de referencia en el lienzo",openPanel:"Abre el panel IA",writePrompt:"Añade tus instrucciones creativas",generate:"Genera nuevas variaciones"}}},enhancement:{title:"Mejora IA",aiUpscale:{title:"Escalado IA",description:"Aumenta la resolución de imagen hasta 8x usando tecnología IA.",features:{resolution:"Opciones de resolución 2x, 4x, 8x",quality:"Preservación mejorada de detalles",details:"Mejora inteligente de bordes"}},backgroundRemoval:{title:"Eliminación de Fondo",description:"Elimina automáticamente fondos y crea PNGs transparentes.",features:{automatic:"Eliminación de fondo con un clic",transparent:"Salida PNG verdaderamente transparente",precise:"Detección precisa de bordes"}}},canvas:{title:"Navegación del Lienzo",navigation:{title:"Controles de Navegación",description:"Aprende a navegar el lienzo infinito.",controls:{zoom:"Acercar/alejar",pan:"Panorámica",select:"Seleccionar objetos",multiSelect:"Selección múltiple"}},layers:{title:"Gestión de Capas",description:"Organiza tu arte con capas.",features:{unlimited:"Capas ilimitadas",visibility:"Mostrar/ocultar capas",reorder:"Arrastra para reordenar",lock:"Bloquear para protección"}}},contextMenu:{title:"Menú Contextual Inteligente",smartCompose:{title:"Composición IA",description:"Haz clic derecho en imágenes seleccionadas para acceder a herramientas de composición IA.",options:{intelligent:"Composición inteligente automática",accessory:"Añadir accesorios relacionados",scene:"Crear escena envolvente",creative:"Mezcla artística creativa"}},voiceCommand:{title:"Comando de Voz",description:"Usa comandos de voz para crear y editar contenido.",features:{multilingual:"Reconocimiento multiidioma",intelligent:"Comprensión de contexto inteligente",realtime:"Procesamiento en tiempo real"}}},settings:{title:"Configuración",apiKey:{title:"Configuración de Clave API",description:"Configura tu clave API de Gemini para usar funciones IA.",steps:{getKey:"Obtén una clave API de Google AI Studio",openSettings:"Abre la configuración",enterKey:"Ingresa tu clave API",save:"Guarda la configuración"}},language:{title:"Configuración de Idioma",description:"Cambia el idioma de la interfaz según tu preferencia."}},needHelp:{title:"¿Necesitas Ayuda?",description:"Estamos aquí para ayudarte con cualquier pregunta.",contact:"Contactar Soporte",community:"Unirse a la Comunidad"}},...tr.es},Hm={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"AIアシスタント",tabs:{storyMaker:"ストーリーメーカー",generate:"生成"},generate:{tabs:{generate:"生成",enhance:"強化",video:"ビデオ"},validation:{generateMessage:"生成は任意の数の参照画像をサポート、または画像なしで新規作成",styleMessage:"スタイル転送は正確に1枚の画像が必要",mergeMessage:"マージには2枚以上の画像が必要"},processing:{analyzing:"リクエストを分析中...",composing:"美しい構図を作成中...",rendering:"高品質画像をレンダリング中...",finalizing:"最終仕上げを追加中..."},templates:{title:"Nano Banana 人気テンプレート（クリックで使用）",withSelection:"+ 選択画像",categories:{all:"すべて",creative:"🎨 クリエイティブ",professional:"💼 プロフェッショナル",fun:"🎮 楽しい"},items:{figurine:{title:"3Dフィギュア",description:"デスクトップモデル"},handDrawn:{title:"手描きプロセス",description:"スケッチから完成"},crossSection:{title:"3D断面図",description:"内部構造"},restoration:{title:"写真修復",description:"着色と修復"},idPhoto:{title:"プロフェッショナルID",description:"ビジネスポートレート"},product:{title:"商品撮影",description:"ECサイト写真"},interior:{title:"インテリアデザイン",description:"空間リメイク"},marketing:{title:"マーケティング素材",description:"ソーシャルメディア"},tryOn:{title:"バーチャル試着",description:"衣装チェンジ"},timeTravel:{title:"タイムトラベル",description:"異なる時代"},petAdventure:{title:"ペット冒険",description:"楽しいシーン"},ingredients:{title:"食材分解",description:"レシピガイド"}},applied:"✨ テンプレート適用済み！直接生成するか、上のプロンプトを修正できます"},placeholder:"生成したい内容を説明してください...",generateButton:"Nano Bananaで生成",generating:"Nano Bananaで生成中...",imageToImageMode:"🎨 画像から画像モード",imageToImageDescription:"選択した画像がプロンプト/テンプレートと組み合わされて新しい画像を生成します。",quickEnhancements:"✨ クイック強化（クリックで切り替え）",enhancementItems:["バイラルミームスタイル","4K ウルトラHD","シネマティックライティング","artstation トレンド","octane レンダー"],selectedImages:"枚の画像をキャンバスから選択",invalidForTab:"無効："},enhance:{selectImages:"強化する画像を選択",selectImagesDescription:"キャンバスから強化する画像を1つ以上選択してください",enhancementReady:"強化準備完了",willBeProcessed:"選択した画像はAI技術で処理・強化されます。",enhancementOptions:"強化オプション",aiUpscale:"AIアップスケール",upscaleDescription:"AIアップスケール技術で画像解像度を向上",backgroundRemoval:"背景除去",backgroundRemovalDescription:"自動的に背景を除去し透明PNGを作成",qualityEnhancement:"品質強化",qualityEnhancementDescription:"全体的な画像品質を改善、ノイズとアーティファクトを削減",enhancementSummary:"強化概要",upscaleTo:"アップスケール先",removeBackground:"背景除去（透明PNG）",enhancedQuality:"品質強化とノイズ削減",processing:"処理中",enhanceButton:"画像強化",enhancing:"強化中...",resolutions:{"2x":"2倍解像度","4x":"4倍解像度","8x":"8倍解像度"}},selected:"選択済み",selectedFromCanvas:"キャンバスから選択",invalidFor:"無効：",selectedImagesNote:"選択した画像は自動的にAIリクエストに含まれます",generateBasedOn:"あなたの",selectedImage:"選択した画像",generateWithGemini:"Gemini 2.5 Flash で画像生成 (Nano Banana)",imageToImageMode:"画像から画像モード",active:"アクティブ",selectedImagesCombined:"選択した画像がプロンプト/テンプレートと組み合わされて新しい画像を生成します。",useTemplate:"テンプレート使用",close:"閉じる",image:"画像",images:"画像",storyMaker:{title:"ストーリーメーカー",description:"一貫したキャラクターで4コマ漫画ストーリーを作成",styleLabel:"アートスタイル",characterLabel:"メインキャラクター",productLabel:"フィーチャー商品",storyPromptLabel:"ストーリーコンセプト",generateButton:"4コマ漫画生成",useFromCanvas:"キャンバスから使用",uploadImage:"画像をアップロード",generating:"パネル生成中",placeholder:`ストーリーを一文で説明してください...

例：
• 雪のクリスマスの夜のコーヒーショップでの出会い
• ホリデーショッピングで完璧なギフトを見つける
• 居心地の良い本屋で咲く友情`,styles:{comic:"コミックブック",manga:"マンガスタイル",watercolor:"水彩画",oil:"油絵",sketch:"鉛筆スケッチ"},characterSection:{title:"メインキャラクター",description:"ストーリーのメインキャラクターをアップロードまたは選択",required:"必須",optional:"オプション"},productSection:{title:"フィーチャー商品",description:"ストーリーで紹介する商品を追加（オプション）",optional:"オプション"},storySection:{title:"ストーリーコンセプト",description:"ストーリーのアイデアを一文で説明",examples:["雪のクリスマスの夜のコーヒーショップでの出会い","ホリデーショッピングで完璧なギフトを見つける","居心地の良い本屋で咲く友情"]},generatingPanels:"コミックパネル生成中...",panelComplete:"パネル完了",storyComplete:"コミックストーリー完了！",errors:{noStory:"まずストーリープロンプトを入力してください！",characterRequired:"キャラクター画像をアップロードまたは選択してください！",generationFailed:"コミック生成に失敗しました。もう一度お試しください。"}}},loadingIndicator:{stages:{analyzing:{text:"分析中...",description:"您のクリエイティブニーズを理解中"},composing:{text:"構成中...",description:"クリエイティブコンセプトをデザイン中"},rendering:{text:"レンダリング中...",description:"美しい画像を描いています"},finalizing:{text:"仕上げ中...",description:"最終仕上げ"}}},nanoBananaPrompt:{title:"🎤 Nano Banana プロンプト入力",selectedObjects:"つのオブジェクトが選択されています",stabilityTip:{title:"オブジェクト安定性のヒント",description:"プロンプトに「主要オブジェクトを変更しない」や「元の特徴を維持する」などのフレーズを含めることをお勧めします。これにより、人物、家具、製品などのすべての重要な要素が安定して一貫性を保てます。"},inputModes:{text:"📝 テキスト入力",voice:"🎤 音声入力"},voiceNotSupported:"⚠️ お使いのブラウザは音声認識をサポートしていません",voiceStatus:{listening:"🎤 聞いています、話してください...",clickToStart:"マイクをクリックして音声入力を開始してください"},promptLabel:"コマンド内容",promptPlaceholder:"例：背景をビーチに変更、主要オブジェクトは変更しない；ソファをリビングに移動、ソファの特徴を維持...",quickExamples:"クイック例",examples:["背景をビーチに変更、主要オブジェクトは変更しない","ソファをリビングに移動、ソファの特徴を維持","空に星を追加、すべてのオブジェクトの一貫性を保つ","雪景色の背景に変更、家具の特徴は変更しない","部屋をより明るくする、アイテムはそのままに","木製の床に変更、オブジェクトの外観は安定"],submit:"コマンド実行",cancel:"キャンセル"},contextMenu:{header:"✨ AIアクション",playVideo:"🎬 動画再生",aiSmartCompose:"🧠 AIスマート合成",creativeBlend:"✨ クリエイティブブレンド",generateSimilar:"🌟 類似生成",nanoBananaPrompt:"🎤 Nano Banana プロンプト入力",saveSelected:"選択項目を保存",duplicate:"複製",duplicateMultiple:"複製",delete:"削除",deleteMultiple:"削除"},common:{loading:"読み込み中...",error:"エラー",success:"成功",cancel:"キャンセル",confirm:"確認",save:"保存",delete:"削除",edit:"編集",close:"閉じる",settings:"設定"},alerts:{imageGenerationFailed:"画像生成に失敗しました：",mergeSelectMinImages:"結合するには少なくとも2つの画像を選択してください",mergeEnterInstructions:"結合指示を入力してください、例：「これらの画像をアートコラージュに混合」",mergeFailed:"画像結合に失敗しました：",styleSelectImage:"スタイルを適用する画像を選択してください",styleEnterDescription:"スタイル説明を入力してください、例：「ゴッホの星月夜スタイル」",styleTransferComplete:"スタイル転送完了！",styleTransferFailed:"スタイル転送に失敗しました：",comicGenerationFailed:"コミック生成に失敗しました。もう一度試してください！",enterEditInstructions:"編集指示を入力してください！",generateComicFirst:"最初にコミックを生成してください！",panelEditingFailed:"パネル編集に失敗しました。もう一度試してください！",storyGenerationFailed:"ストーリー生成に失敗しました。もう一度試してください！",selectImagesFirst:"キャンバス上の画像を選択するか、最初にコミックを生成してください！",magicEraserSelectImage:"マジック消しゴムを使用する画像を選択してください",magicEraserComplete:"🪄 マジック消しゴム完了！不要なオブジェクトが削除されました。",magicEraserFailed:"マジック消しゴムに失敗しました：",backgroundRemovalSelectImage:"背景を削除する画像を選択してください",backgroundRemovalComplete:"✂️ 背景削除が成功しました！",backgroundRemovalFailed:"背景削除に失敗しました：",avatarSelectPhoto:"アバターを生成する写真を選択してください",avatarGenerationFailed:"アバター生成に失敗しました：",mergedImagesSuccess:"{count}枚の画像を正常に結合しました！"},serviceGuide:{title:"サービスガイド",subtitle:"OmniCanvasの機能の使い方を学ぶ",quickStart:"クイックスタート",quickActions:{generate:"作成を開始",generateDesc:"AI生成パネルを開く",enhance:"画像を強化",enhanceDesc:"AIで画像を改善する",settings:"APIを設定",settingsDesc:"APIキーを設定する"},overview:{title:"概要",whatIs:{title:"OmniCanvasとは？",description:"OmniCanvasは、デジタル描画、AI画像生成、マルチモーダルコンテンツ統合を組み合わせたAI駆動のクリエイティブプラットフォームです。",features:{unlimited:"無制限のクリエイティブキャンバス",aiPowered:"AI駆動の生成と強化",multilingual:"5言語サポート",privacy:"独自のAPIキーでプライバシー優先"}}},aiGeneration:{title:"AI画像生成",textToImage:{title:"テキストから画像",description:"Gemini 2.5 Flashを使用してテキスト説明から画像を生成します。",steps:{openPanel:"AIパネルを開く",writePrompt:"説明を書く",selectTemplate:"テンプレートを選択（オプション）",generate:"生成をクリックして作成"}},imageToImage:{title:"画像から画像",description:"既存の参照画像に基づいて新しい画像を作成します。",steps:{selectImages:"キャンバス上で参照画像を選択",openPanel:"AIパネルを開く",writePrompt:"クリエイティブな指示を追加",generate:"新しいバリエーションを生成"}}},enhancement:{title:"AI強化",aiUpscale:{title:"AIアップスケール",description:"AI技術を使用して画像解像度を最大8倍に向上させます。",features:{resolution:"2倍、4倍、8倍の解像度オプション",quality:"詳細保持の向上",details:"スマートエッジ強化"}},backgroundRemoval:{title:"背景除去",description:"自動的に背景を除去し、透明なPNGを作成します。",features:{automatic:"ワンクリック背景除去",transparent:"真の透明PNG出力",precise:"正確なエッジ検出"}}},canvas:{title:"キャンバスナビゲーション",navigation:{title:"ナビゲーションコントロール",description:"無限キャンバスのナビゲーション方法を学びます。",controls:{zoom:"ズームイン/アウト",pan:"パン",select:"オブジェクト選択",multiSelect:"複数選択"}},layers:{title:"レイヤー管理",description:"レイヤーでアートワークを整理します。",features:{unlimited:"無制限レイヤー",visibility:"レイヤーの表示/非表示",reorder:"ドラッグで並べ替え",lock:"保護のためのロック"}}},contextMenu:{title:"スマートコンテキストメニュー",smartCompose:{title:"AI構成",description:"選択した画像を右クリックしてAI構成ツールにアクセスします。",options:{intelligent:"自動インテリジェント構成",accessory:"関連アクセサリーを追加",scene:"包み込むシーンを作成",creative:"クリエイティブな芸術的ブレンド"}},voiceCommand:{title:"音声コマンド",description:"音声コマンドを使用してコンテンツを作成・編集します。",features:{multilingual:"多言語認識",intelligent:"インテリジェントなコンテキスト理解",realtime:"リアルタイム処理"}}},settings:{title:"設定",apiKey:{title:"APIキー設定",description:"AI機能を使用するためのGemini APIキーを設定します。",steps:{getKey:"Google AI StudioからAPIキーを取得",openSettings:"設定を開く",enterKey:"APIキーを入力",save:"設定を保存"}},language:{title:"言語設定",description:"好みに応じてインターフェース言語を変更します。"}},needHelp:{title:"ヘルプが必要ですか？",description:"ご質問があれば、喜んでお手伝いします。",contact:"サポートに連絡",community:"コミュニティに参加"}},...tr.ja},Vm={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"Assistant IA",tabs:{storyMaker:"Créateur d'Histoires",generate:"Générer"},generate:{tabs:{generate:"Générer",enhance:"Améliorer",video:"Vidéo"},validation:{generateMessage:"Générer supporte n'importe quel nombre d'images de référence ou aucune pour une création fraîche",styleMessage:"Le transfert de style nécessite exactement 1 image",mergeMessage:"Fusionner nécessite 2+ images"},processing:{analyzing:"Analyse de votre demande...",composing:"Création de belles compositions...",rendering:"Rendu d'images haute qualité...",finalizing:"Ajout des touches finales..."},templates:{title:"Modèles Populaires Nano Banana (Cliquer pour utiliser)",withSelection:"+ Images Sélectionnées",categories:{all:"Tous",creative:"🎨 Créatif",professional:"💼 Professionnel",fun:"🎮 Amusant"},items:{figurine:{title:"Figurine 3D",description:"Modèle de bureau"},handDrawn:{title:"Processus Dessiné",description:"Croquis au final"},crossSection:{title:"Coupe 3D",description:"Structure interne"},restoration:{title:"Restauration Photo",description:"Coloriser et réparer"},idPhoto:{title:"ID Professionnel",description:"Portrait d'affaires"},product:{title:"Photo Produit",description:"Photo e-commerce"},interior:{title:"Design Intérieur",description:"Relooking espace"},marketing:{title:"Matériel Marketing",description:"Médias sociaux"},tryOn:{title:"Essai Virtuel",description:"Changement tenue"},timeTravel:{title:"Voyage Temporel",description:"Époques différentes"},petAdventure:{title:"Aventures Animaux",description:"Scènes amusantes"},ingredients:{title:"Décomposition Plat",description:"Guide recette"}},applied:"✨ Modèle appliqué! Vous pouvez générer directement ou modifier le prompt ci-dessus"},placeholder:"Décrivez ce que vous voulez générer...",generateButton:"Générer avec Nano Banana",generating:"Génération avec Nano Banana...",imageToImageMode:"🎨 Mode Image à Image",imageToImageDescription:"Vos images sélectionnées seront combinées avec votre prompt/modèle pour générer de nouvelles images.",quickEnhancements:"✨ Améliorations Rapides (Cliquer pour basculer)",enhancementItems:["style mème viral","4K ultra HD","éclairage cinématographique","tendance sur artstation","rendu octane"],selectedImages:"images sélectionnées du canevas",invalidForTab:"Non valide pour"},enhance:{selectImages:"Sélectionner Images à Améliorer",selectImagesDescription:"Veuillez sélectionner une ou plusieurs images du canevas à améliorer",enhancementReady:"Amélioration Prête",willBeProcessed:"Vos images sélectionnées seront traitées et améliorées avec la technologie IA.",enhancementOptions:"Options d'Amélioration",aiUpscale:"Mise à l'Échelle IA",upscaleDescription:"Augmenter la résolution d'image en utilisant la technologie de mise à l'échelle IA",backgroundRemoval:"Suppression d'Arrière-plan",backgroundRemovalDescription:"Supprimer automatiquement l'arrière-plan et créer un PNG transparent",qualityEnhancement:"Amélioration de Qualité",qualityEnhancementDescription:"Améliorer la qualité générale de l'image, réduire le bruit et les artefacts",enhancementSummary:"Résumé d'Amélioration",upscaleTo:"Mise à l'échelle vers",removeBackground:"Supprimer l'arrière-plan (PNG transparent)",enhancedQuality:"Qualité améliorée et réduction du bruit",processing:"Traitement",enhanceButton:"Améliorer Images",enhancing:"Amélioration...",resolutions:{"2x":"Résolution 2x","4x":"Résolution 4x","8x":"Résolution 8x"}},selected:"sélectionné",selectedFromCanvas:"sélectionné du canevas",invalidFor:"Non valide pour",selectedImagesNote:"Les images sélectionnées seront automatiquement incluses dans la demande IA",generateBasedOn:"Générer de nouvelles images basées sur votre",selectedImage:"image sélectionnée",generateWithGemini:"Générer des images avec Gemini 2.5 Flash (Nano Banana)",imageToImageMode:"Mode Image vers Image",active:"ACTIF",selectedImagesCombined:"Vos images sélectionnées seront combinées avec votre prompt/modèle pour générer de nouvelles images.",useTemplate:"Utiliser le Modèle",close:"Fermer",image:"image",images:"images",storyMaker:{title:"Créateur d'Histoires",description:"Créez des histoires de bande dessinée à 4 panneaux avec des personnages cohérents",styleLabel:"Style Artistique",characterLabel:"Personnage Principal",productLabel:"Produit Vedette",storyPromptLabel:"Concept d'Histoire",generateButton:"Générer BD 4 Panneaux",useFromCanvas:"Utiliser du Canevas",uploadImage:"Télécharger Image",generating:"Génération panneau",placeholder:`Décrivez votre histoire en une phrase...

Exemples :
• Une rencontre dans un café par une nuit de Noël enneigée
• Trouver le cadeau parfait pendant les achats des fêtes
• Une amitié qui s'épanouit dans une librairie douillette`,styles:{comic:"Bande Dessinée",manga:"Style Manga",watercolor:"Aquarelle",oil:"Peinture à l'Huile",sketch:"Croquis au Crayon"},characterSection:{title:"Personnage Principal",description:"Téléchargez ou sélectionnez le personnage principal de votre histoire",required:"Requis",optional:"Optionnel"},productSection:{title:"Produit Vedette",description:"Ajoutez un produit à mettre en vedette dans votre histoire (optionnel)",optional:"Optionnel"},storySection:{title:"Concept d'Histoire",description:"Décrivez votre idée d'histoire en une phrase",examples:["Une rencontre dans un café par une nuit de Noël enneigée","Trouver le cadeau parfait pendant les achats des fêtes","Une amitié qui s'épanouit dans une librairie douillette"]},generatingPanels:"Génération des panneaux de BD...",panelComplete:"Panneau terminé",storyComplete:"Histoire de BD terminée !",errors:{noStory:"Veuillez d'abord entrer une proposition d'histoire !",characterRequired:"Veuillez télécharger ou sélectionner une image de personnage !",generationFailed:"La génération de la BD a échoué. Veuillez réessayer."}}},loadingIndicator:{stages:{analyzing:{text:"Analyse...",description:"Compréhension de vos besoins créatifs"},composing:{text:"Composition...",description:"Conception de concepts créatifs"},rendering:{text:"Rendu...",description:"Dessin d'images magnifiques"},finalizing:{text:"Finalisation...",description:"Touches finales"}}},nanoBananaPrompt:{title:"🎤 Saisie de Commande Nano Banana",selectedObjects:"objets sélectionnés",stabilityTip:{title:"Astuce de Stabilité d'Objets",description:`Nous recommandons d'inclure des phrases comme "maintenir les objets principaux inchangés" ou "conserver les caractéristiques originales" dans votre commande pour assurer que tous les éléments importants comme les personnes, meubles et produits restent stables et cohérents.`},inputModes:{text:"📝 Saisie Texte",voice:"🎤 Saisie Vocale"},voiceNotSupported:"⚠️ Votre navigateur ne supporte pas la reconnaissance vocale",voiceStatus:{listening:"🎤 Écoute en cours, veuillez parler...",clickToStart:"Cliquez sur le microphone pour commencer la saisie vocale"},promptLabel:"Contenu de la Commande",promptPlaceholder:"Par exemple : Changer l'arrière-plan en plage, garder les objets principaux inchangés ; Déplacer le canapé au salon, maintenir les caractéristiques du canapé...",quickExamples:"Exemples Rapides",examples:["Changer l'arrière-plan en plage, garder les objets principaux inchangés","Déplacer le canapé au salon, maintenir les caractéristiques du canapé","Ajouter des étoiles au ciel, garder tous les objets cohérents","Changer en arrière-plan neigeux, caractéristiques des meubles inchangées","Rendre la pièce plus lumineuse, garder les éléments comme ils sont","Changer en sol en bois, apparence des objets stable"],submit:"Exécuter la Commande",cancel:"Annuler"},contextMenu:{header:"✨ Actions IA",playVideo:"🎬 Lire Vidéo",aiSmartCompose:"🧠 Composition Intelligente IA",creativeBlend:"✨ Mélange Créatif",generateSimilar:"🌟 Générer Similaire",nanoBananaPrompt:"🎤 Saisie de Commande Nano Banana",saveSelected:"Sauvegarder Sélectionnés",duplicate:"Dupliquer",duplicateMultiple:"Dupliquer",delete:"Supprimer",deleteMultiple:"Supprimer"},common:{loading:"Chargement...",error:"Erreur",success:"Succès",cancel:"Annuler",confirm:"Confirmer",save:"Sauvegarder",delete:"Supprimer",edit:"Modifier",close:"Fermer",settings:"Paramètres"},alerts:{imageGenerationFailed:"La génération d'image a échoué : ",mergeSelectMinImages:"Veuillez sélectionner au moins 2 images à fusionner",mergeEnterInstructions:'Veuillez entrer des instructions de fusion, ex : "Mélanger ces images en collage artistique"',mergeFailed:"La fusion d'images a échoué : ",styleSelectImage:"Veuillez sélectionner une image pour appliquer un style",styleEnterDescription:'Veuillez entrer une description de style, ex : "Style Nuit Étoilée de Van Gogh"',styleTransferComplete:"Transfert de style terminé !",styleTransferFailed:"Le transfert de style a échoué : ",comicGenerationFailed:"La génération de BD a échoué. Veuillez réessayer !",enterEditInstructions:"Veuillez entrer des instructions d'édition !",generateComicFirst:"Générez d'abord une BD !",panelEditingFailed:"L'édition du panneau a échoué. Veuillez réessayer !",storyGenerationFailed:"La génération d'histoire a échoué. Veuillez réessayer !",selectImagesFirst:"Veuillez sélectionner des images sur le canevas ou générer une BD d'abord !",magicEraserSelectImage:"Veuillez sélectionner une image pour utiliser la Gomme Magique",magicEraserComplete:"🪄 Gomme Magique terminée ! Objets indésirables supprimés.",magicEraserFailed:"La gomme magique a échoué : ",backgroundRemovalSelectImage:"Veuillez sélectionner une image pour supprimer l'arrière-plan",backgroundRemovalComplete:"✂️ Arrière-plan supprimé avec succès !",backgroundRemovalFailed:"La suppression de l'arrière-plan a échoué : ",avatarSelectPhoto:"Veuillez sélectionner une photo pour générer un avatar",avatarGenerationFailed:"La génération d'avatar a échoué : ",mergedImagesSuccess:"{count} images fusionnées avec succès !"},serviceGuide:{title:"Guide de Service",subtitle:"Apprendre à utiliser les fonctionnalités d'OmniCanvas",quickStart:"Démarrage Rapide",quickActions:{generate:"Commencer à Créer",generateDesc:"Ouvrir le panneau de génération IA",enhance:"Améliorer les Images",enhanceDesc:"Améliorez vos images avec l'IA",settings:"Configurer l'API",settingsDesc:"Configurez vos clés API"},overview:{title:"Aperçu",whatIs:{title:"Qu'est-ce qu'OmniCanvas ?",description:"OmniCanvas est une plateforme créative alimentée par l'IA qui combine le dessin numérique, la génération d'images IA et l'intégration de contenu multimodal.",features:{unlimited:"Toile créative illimitée",aiPowered:"Génération et amélioration alimentées par l'IA",multilingual:"Support de 5 langues",privacy:"Confidentialité d'abord avec vos propres clés API"}}},aiGeneration:{title:"Génération d'Images IA",textToImage:{title:"Texte vers Image",description:"Générez des images à partir de descriptions textuelles en utilisant Gemini 2.5 Flash.",steps:{openPanel:"Ouvrir le panneau IA",writePrompt:"Écrivez votre description",selectTemplate:"Choisissez un modèle (optionnel)",generate:"Cliquez sur Générer pour créer"}},imageToImage:{title:"Image vers Image",description:"Créez de nouvelles images basées sur des images de référence existantes.",steps:{selectImages:"Sélectionnez les images de référence sur la toile",openPanel:"Ouvrir le panneau IA",writePrompt:"Ajoutez vos instructions créatives",generate:"Générer de nouvelles variations"}}},enhancement:{title:"Amélioration IA",aiUpscale:{title:"Mise à l'échelle IA",description:"Augmentez la résolution d'image jusqu'à 8x en utilisant la technologie IA.",features:{resolution:"Options de résolution 2x, 4x, 8x",quality:"Préservation améliorée des détails",details:"Amélioration intelligente des bords"}},backgroundRemoval:{title:"Suppression d'Arrière-plan",description:"Supprimez automatiquement les arrière-plans et créez des PNG transparents.",features:{automatic:"Suppression d'arrière-plan en un clic",transparent:"Sortie PNG vraiment transparente",precise:"Détection précise des bords"}}},canvas:{title:"Navigation de Toile",navigation:{title:"Contrôles de Navigation",description:"Apprenez à naviguer sur la toile infinie.",controls:{zoom:"Zoomer/Dézoomer",pan:"Panoramique",select:"Sélectionner des objets",multiSelect:"Multi-sélection"}},layers:{title:"Gestion des Calques",description:"Organisez votre œuvre d'art avec des calques.",features:{unlimited:"Calques illimités",visibility:"Afficher/masquer les calques",reorder:"Glisser pour réorganiser",lock:"Verrouiller pour protection"}}},contextMenu:{title:"Menu Contextuel Intelligent",smartCompose:{title:"Composition IA",description:"Cliquez droit sur les images sélectionnées pour accéder aux outils de composition IA.",options:{intelligent:"Composition intelligente automatique",accessory:"Ajouter des accessoires connexes",scene:"Créer une scène enveloppante",creative:"Mélange artistique créatif"}},voiceCommand:{title:"Commande Vocale",description:"Utilisez des commandes vocales pour créer et éditer du contenu.",features:{multilingual:"Reconnaissance multilingue",intelligent:"Compréhension intelligente du contexte",realtime:"Traitement en temps réel"}}},settings:{title:"Paramètres",apiKey:{title:"Configuration de Clé API",description:"Configurez votre clé API Gemini pour utiliser les fonctionnalités IA.",steps:{getKey:"Obtenez une clé API de Google AI Studio",openSettings:"Ouvrir les paramètres",enterKey:"Entrez votre clé API",save:"Sauvegarder la configuration"}},language:{title:"Paramètres de Langue",description:"Changez la langue de l'interface selon votre préférence."}},needHelp:{title:"Besoin d'Aide ?",description:"Nous sommes là pour vous aider avec toute question.",contact:"Contacter le Support",community:"Rejoindre la Communauté"}},...tr.fr},xc={en:Um,"zh-TW":Gm,es:Wm,ja:Hm,fr:Vm};function el(t){return xc[t]||xc.en}function _n(){const{currentLanguage:t}=er();return el(t)}const Xm=({x:t,y:e,visible:n,selectedCount:c,onClose:p,onMergeImages:v,onStyleTransfer:S,onDuplicate:h,onDelete:s,onBringToFront:u,onSendToBack:d,onRotate:r,onGenerateSimilar:a,onExportSelected:i,onGroupSelection:l,onIntelligentCompose:g,onWearAccessory:o,onSceneCompose:f,onCreativeBlend:m,onPlayVideo:y,hasVideoThumbnail:x,onVoicePrompt:C})=>{const b=_n();if(!n)return null;console.log("🔥🔥🔥 NEW AI CONTEXT MENU RENDERING! Time:",new Date().toLocaleTimeString()),console.log("🔥 NewContextMenu props:",{visible:n,x:t,y:e,selectedCount:c}),console.log("🔥 AI handlers available:",{onIntelligentCompose:!!g,onWearAccessory:!!o,onSceneCompose:!!f,onCreativeBlend:!!m});const T=[...x&&c===1&&y?[{icon:Xh,label:b.contextMenu.playVideo,onClick:y,className:"text-orange-600 hover:bg-orange-50 font-semibold",separator:!0}]:[],...c>=2?[{icon:zh,label:`${b.contextMenu.aiSmartCompose} (${c})`,onClick:g,className:"text-blue-600 hover:bg-blue-50 font-semibold",separator:!1},{icon:Yh,label:b.contextMenu.creativeBlend,onClick:m,className:"text-pink-600 hover:bg-pink-50",separator:!0}]:[],...c>=1?[{icon:Rt,label:b.contextMenu.generateSimilar,onClick:a,className:"text-green-600 hover:bg-green-50",separator:!1}]:[],...c>=1&&C?[{icon:Ja,label:b.contextMenu.nanoBananaPrompt,onClick:C,className:"text-purple-600 hover:bg-purple-50 font-semibold",separator:!0}]:[],...c>=1?[{icon:Uh,label:b.contextMenu.saveSelected,onClick:i,className:"text-blue-600 hover:bg-blue-50",separator:!1},{icon:qo,label:c>1?`${b.contextMenu.duplicateMultiple} ${c}`:b.contextMenu.duplicate,onClick:h,className:"hover:bg-gray-50",separator:!1},{icon:Qo,label:c>1?`${b.contextMenu.deleteMultiple} ${c}`:b.contextMenu.delete,onClick:s,className:"text-red-600 hover:bg-red-50",separator:!1}]:[]],E={left:Math.min(t,window.innerWidth-250),top:Math.min(e,window.innerHeight-T.length*40)};return w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"fixed inset-0 z-10",onClick:p}),w.jsxs("div",{className:"fixed z-20 bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[200px]",style:E,onClick:L=>L.stopPropagation(),children:[w.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 bg-gradient-to-r from-blue-50 to-purple-50",children:[b.contextMenu.header," - ",c," selected"]}),T.map((L,F)=>{const H=L.icon;return w.jsxs("div",{children:[w.jsxs("button",{onClick:J=>{J.stopPropagation(),L.onClick(),p()},className:`w-full px-3 py-2 text-left text-sm flex items-center space-x-2 transition-colors ${L.className}`,children:[w.jsx(H,{className:"w-4 h-4 flex-shrink-0"}),w.jsx("span",{className:"flex-1",children:L.label})]}),L.separator&&w.jsx("div",{className:"border-t border-gray-100 my-1"})]},F)})]})]})},Ym=({visible:t,onClose:e,onSubmit:n,selectedCount:c})=>{const p=_n(),[v,S]=le.useState(""),[h,s]=le.useState(!1),[u,d]=le.useState("text"),[r,a]=le.useState(!1),[i,l]=le.useState(!1),[g,o]=le.useState(""),f=le.useRef(null);le.useEffect(()=>{const F=window.SpeechRecognition||window.webkitSpeechRecognition;if(F){a(!0);const H=new F;H.continuous=!1,H.interimResults=!1,H.lang="zh-TW",H.onstart=()=>{console.log("🎤 語音識別開始"),s(!0)},H.onresult=J=>{const q=J.results[0][0].transcript;console.log("🎤 語音識別結果:",q),S(q),s(!1)},H.onerror=J=>{console.error("🎤 語音識別錯誤:",J.error),s(!1);let q="Voice recognition failed";switch(J.error){case"no-speech":q="No speech detected, please try again";break;case"audio-capture":q="Cannot access microphone";break;case"not-allowed":q="Microphone permission denied";break;case"network":q="Network error, please check connection";break}alert(q)},H.onend=()=>{console.log("🎤 語音識別結束"),s(!1)},f.current=H}else a(!1),console.warn("瀏覽器不支援語音識別");return()=>{f.current&&f.current.stop()}},[]);const m=()=>{if(!(!f.current||h))try{f.current.start()}catch(F){console.error("啟動語音識別失敗:",F),alert("Unable to start voice recognition, please try again")}},y=()=>{f.current&&h&&f.current.stop()},x=()=>{v.trim()&&(n(v.trim(),u==="voice"),S(""),e())},C=()=>{h&&y(),S(""),e()},b=F=>{S(F),d("text")},T=()=>{if(!v.trim())return;const F=["，確保保持主要物件的特徵和比例","，使用專業攝影級別的燈光和構圖","，注意維持物件的原有顏色和質感","，確保場景的空間邏輯合理自然","，使整體畫面具有視覺衝擊力"],H=F[Math.floor(Math.random()*F.length)],J=v+H;o(J),l(!0)},E=()=>{S(g),l(!1),o("")},L=()=>{const F=p.nanoBananaPrompt.examples,H=F[Math.floor(Math.random()*F.length)];S(H)};return t?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:C}),w.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:w.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] flex flex-col",children:[w.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-blue-500 text-white p-4 flex items-center justify-between flex-shrink-0",children:[w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(Ja,{className:"w-5 h-5"}),w.jsx("h3",{className:"font-semibold",children:p.nanoBananaPrompt.title})]}),w.jsx("button",{onClick:C,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:w.jsx(as,{className:"w-5 h-5"})})]}),w.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto flex-1",children:[w.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:[c," ",p.nanoBananaPrompt.selectedObjects]}),w.jsx("div",{className:"text-sm text-purple-700 bg-purple-50 p-3 rounded-lg border border-purple-200",children:w.jsxs("div",{className:"flex items-start space-x-2",children:[w.jsx("span",{className:"text-purple-500",children:"💡"}),w.jsxs("div",{children:[w.jsx("div",{className:"font-medium mb-1",children:p.nanoBananaPrompt.stabilityTip.title}),w.jsx("div",{className:"text-xs",children:p.nanoBananaPrompt.stabilityTip.description})]})]})}),w.jsxs("div",{className:"flex space-x-2",children:[w.jsx("button",{onClick:()=>d("text"),className:`flex-1 p-2 rounded-lg border transition-colors ${u==="text"?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-600"}`,children:p.nanoBananaPrompt.inputModes.text}),w.jsx("button",{onClick:()=>d("voice"),disabled:!r,className:`flex-1 p-2 rounded-lg border transition-colors ${u==="voice"?"bg-purple-100 border-purple-300 text-purple-700":r?"bg-gray-50 border-gray-200 text-gray-600":"bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed"}`,children:p.nanoBananaPrompt.inputModes.voice})]}),!r&&w.jsx("div",{className:"text-sm text-amber-600 bg-amber-50 p-2 rounded",children:p.nanoBananaPrompt.voiceNotSupported}),u==="voice"&&r&&w.jsxs("div",{className:"space-y-3",children:[w.jsx("div",{className:"text-center",children:w.jsx("button",{onClick:h?y:m,className:`p-4 rounded-full transition-all ${h?"bg-red-500 hover:bg-red-600 text-white animate-pulse":"bg-purple-500 hover:bg-purple-600 text-white"}`,children:h?w.jsx(Yg,{className:"w-6 h-6"}):w.jsx($g,{className:"w-6 h-6"})})}),w.jsx("p",{className:"text-center text-sm text-gray-600",children:h?p.nanoBananaPrompt.voiceStatus.listening:p.nanoBananaPrompt.voiceStatus.clickToStart})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("label",{className:"block text-sm font-medium text-gray-700",children:p.nanoBananaPrompt.promptLabel}),w.jsxs("div",{className:"flex space-x-2",children:[w.jsxs("button",{onClick:T,disabled:!v.trim(),className:`text-xs px-2 py-1 rounded-lg transition-colors ${v.trim()?"bg-purple-100 text-purple-700 hover:bg-purple-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[w.jsx(Rt,{className:"w-3 h-3 inline mr-1"}),"智能增強"]}),w.jsxs("button",{onClick:L,className:"text-xs px-2 py-1 bg-green-100 text-green-700 hover:bg-green-200 rounded-lg transition-colors",children:[w.jsx(tm,{className:"w-3 h-3 inline mr-1"}),"隨機靈感"]})]})]}),w.jsx("textarea",{value:v,onChange:F=>S(F.target.value),placeholder:p.nanoBananaPrompt.promptPlaceholder,className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3}),i&&g&&w.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:w.jsxs("div",{className:"flex items-start space-x-2",children:[w.jsx(Wg,{className:"w-4 h-4 text-purple-600 mt-0.5 flex-shrink-0"}),w.jsxs("div",{className:"flex-1",children:[w.jsx("div",{className:"text-sm font-medium text-purple-700 mb-1",children:"智能增強建議"}),w.jsx("div",{className:"text-sm text-purple-600 mb-3",children:g}),w.jsxs("div",{className:"flex space-x-2",children:[w.jsxs("button",{onClick:E,className:"text-xs px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:[w.jsx(nm,{className:"w-3 h-3 inline mr-1"}),"使用增強版本"]}),w.jsx("button",{onClick:()=>l(!1),className:"text-xs px-3 py-1 bg-gray-200 text-gray-600 rounded hover:bg-gray-300 transition-colors",children:"關閉"})]})]})]})})]}),w.jsxs("div",{className:"space-y-2",children:[w.jsx("label",{className:"block text-sm font-medium text-gray-700",children:p.nanoBananaPrompt.quickExamples}),w.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-32 overflow-y-auto",children:p.nanoBananaPrompt.examples.map((F,H)=>w.jsxs("button",{onClick:()=>b(F),className:"p-2 text-xs bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg hover:from-blue-100 hover:to-purple-100 transition-all text-left flex items-center",children:[w.jsx(Ja,{className:"w-3 h-3 text-blue-500 mr-2 flex-shrink-0"}),w.jsx("span",{className:"truncate",children:F})]},H))})]})]}),w.jsxs("div",{className:"flex justify-end space-x-3 p-4 border-t bg-gray-50 flex-shrink-0",children:[w.jsx("button",{onClick:C,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:p.nanoBananaPrompt.cancel}),w.jsxs("button",{onClick:x,disabled:!v.trim(),className:`px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors ${v.trim()?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[w.jsx(em,{className:"w-4 h-4"}),w.jsx("span",{children:p.nanoBananaPrompt.submit})]})]})]})})]}):null},$m={analyzing:{icon:zh,color:"text-blue-500",bgColor:"bg-blue-50",borderColor:"border-blue-200"},composing:{icon:Vh,color:"text-purple-500",bgColor:"bg-purple-50",borderColor:"border-purple-200"},rendering:{icon:Hh,color:"text-orange-500",bgColor:"bg-orange-50",borderColor:"border-orange-200"},finalizing:{icon:Rt,color:"text-green-500",bgColor:"bg-green-50",borderColor:"border-green-200"}},Zh=({isVisible:t,stage:e="analyzing",className:n=""})=>{const c=_n(),[p,v]=le.useState({x:0,y:0});if(le.useEffect(()=>{if(!t)return;const u=()=>{console.log("🎯 CANVAS LOADING INDICATOR - 計算置中位置 - TIMESTAMP:",new Date().toISOString());const r=["div",'[class*="panel"]','[class*="sidebar"]','[class*="assistant"]',".ai-assistant-panel",".right-panel","[data-panel]","aside","section",'[style*="position: fixed"]','[style*="position: absolute"]'];let a=null,i=0;for(const m of r){const y=document.querySelectorAll(m);for(const x of y){const C=x.getBoundingClientRect(),b=C.width>250&&C.width<window.innerWidth*.6,T=C.right>=window.innerWidth-100,E=C.width<window.innerWidth-100,L=C.height>300;if(b&&T&&E&&L){a=x,i=C.width,console.log("🎯 Loading Indicator - 找到右側面板:",m,"class:",x.className,"width:",i);break}}if(a)break}a||console.log("🎯 Loading Indicator - 沒有檢測到右側面板，使用全螢幕寬度");const l=window.innerWidth-i,g=window.innerHeight,o=l/2,f=g/2;console.log("🎯 Loading Indicator 計算結果:"),console.log("   - 視窗尺寸:",window.innerWidth,"x",window.innerHeight),console.log("   - 右側面板寬度:",i),console.log("   - 可用視窗寬度:",l),console.log("   - 置中位置:",o.toFixed(0),f.toFixed(0)),v({x:o,y:f})};u();const d=()=>u();return window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}},[t]),!t)return null;const S=$m[e],h=S.icon,s=c.loadingIndicator.stages[e];return w.jsxs("div",{className:`
        fixed z-50 pointer-events-none transform -translate-x-1/2 -translate-y-1/2
        ${n}
      `,style:{left:p.x,top:p.y},children:[w.jsxs("div",{className:`
        ${S.bgColor} ${S.borderColor}
        border-2 rounded-lg shadow-lg backdrop-blur-sm
        p-4 min-w-[200px]
        animate-pulse
      `,children:[w.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[w.jsx("div",{className:`${S.color} p-2 rounded-full bg-white shadow-sm`,children:w.jsx(h,{className:"w-5 h-5"})}),w.jsxs("div",{children:[w.jsx("div",{className:`font-medium ${S.color}`,children:s.text}),w.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})]}),w.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:w.jsx("div",{className:`h-2 rounded-full transition-all duration-1000 ${e==="analyzing"?"bg-blue-500 w-1/4":e==="composing"?"bg-purple-500 w-1/2":e==="rendering"?"bg-orange-500 w-3/4":"bg-green-500 w-full"}`})}),w.jsx("div",{className:"flex justify-center space-x-1",children:[0,1,2].map(u=>w.jsx("div",{className:`w-2 h-2 ${S.color.replace("text-","bg-")} rounded-full animate-bounce`,style:{animationDelay:`${u*.2}s`,animationDuration:"1s"}},u))})]}),w.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(6)].map((u,d)=>w.jsx("div",{className:"absolute w-1 h-1 bg-yellow-400 rounded-full animate-ping",style:{left:`${20+d*15}%`,top:`${10+d%3*30}%`,animationDelay:`${d*.3}s`,animationDuration:"2s"}},d))})]})},Km={width:5e3,height:5e3,backgroundColor:"#ffffff",selection:!0,renderOnAddRemove:!0,centeredScaling:!0,centeredRotation:!0},qm=()=>{const t=le.useRef(null),e=le.useRef(null),[n,c]=le.useState({visible:!1,x:0,y:0,selectedObjects:[]}),[p,v]=le.useState({visible:!1,selectedObjects:[]}),[S,h]=le.useState(!1),[s,u]=le.useState("analyzing"),[d,r]=le.useState({x:0,y:0}),[a,i]=le.useState({x:0,y:0}),[l,g]=le.useState(!1),o=()=>{f&&(f.absolutePan(new He.fabric.Point(0,0)),f.setZoom(1),q(1),f.renderAll())},{canvas:f,setCanvas:m,tool:y,brushSize:x,brushColor:C,setIsDrawing:b,addToHistory:T,importImage:E,zoom:L,zoomIn:F,zoomOut:H,resetView:J,setZoom:q}=pn(),{setCanvas:Q,selectImage:te,isMultiSelectMode:oe}=Jo();le.useEffect(()=>{if(!t.current||!e.current)return;const I=new He.fabric.Canvas(t.current,{...Km,width:e.current.clientWidth,height:e.current.clientHeight,selection:!0,preserveObjectStacking:!0,fireRightClick:!0,fireMiddleClick:!0,skipTargetFind:!1,targetFindTolerance:4,perPixelTargetFind:!1,uniformScaling:!0,stopContextMenu:!1,selectionBorderColor:"rgba(46, 115, 252, 0.8)",selectionLineWidth:2,selectionDashArray:[5,5]});I.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),I.selection=!0,I.preserveObjectStacking=!0,console.log("Canvas initialized with multi-selection enabled:",I.selection),I.on("object:added",ae=>{const ie=ae.target;console.log("📦 Object added to canvas:",ie.type),ie&&typeof ie.set=="function"&&(ie.set({selectable:!0,evented:!0,hasControls:!0,hasBorders:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,hoverCursor:"move",moveCursor:"move"}),console.log("✅ Object configured for selection:",ie.type,"selectable:",ie.selectable))}),I.setWidth(e.current.clientWidth),I.setHeight(e.current.clientHeight),I.freeDrawingBrush=new He.fabric.PencilBrush(I),I.freeDrawingBrush.width=x,I.freeDrawingBrush.color=C,m(I),Q(I);let N=null;const M=()=>{I._skipHistory||(N&&clearTimeout(N),N=setTimeout(()=>{const ae=JSON.stringify(I.toJSON());T(ae)},300))};I.on("path:created",ae=>{console.log("📝 Path created"),M()}),I.on("object:modified",M),I.on("selection:created",ae=>{var ie;console.log("🎯 Selection created:",((ie=ae.selected)==null?void 0:ie.length)||0,"objects"),ae.selected&&ae.selected.forEach(de=>{console.log("  - Selected object type:",de.type)}),oe&&ae.selected&&ae.selected.forEach(de=>{if(de.type==="image"){const ge=de.imageId||`img_${de.cacheKey}`;te(ge,!0)}})}),I.on("selection:updated",ae=>{var ie;console.log("🔄 Selection updated:",((ie=ae.selected)==null?void 0:ie.length)||0,"objects"),ae.selected&&ae.selected.forEach(de=>{console.log("  - Updated selection object type:",de.type)})}),I.on("selection:cleared",()=>{console.log("🗑️ Selection cleared"),c(ae=>({...ae,selectedObjects:[]}))}),I.on("mouse:down",ae=>{const ie=ae.e;if(console.log("🖱️ Mouse down - Button:",ie.button,"Shift:",ie.shiftKey,"Ctrl:",ie.ctrlKey,"Cmd:",ie.metaKey),b(!0),ie.button===2){console.log("🔥 RIGHT CLICK DETECTED! Preventing default..."),ie.preventDefault(),ie.stopPropagation();const de=I.getActiveObject(),ge=de?[de]:[];if(de&&de.type==="activeSelection"){const Re=de;ge.length=0,Re.forEachObject(Pt=>ge.push(Pt))}console.log("🔥 SHOWING CONTEXT MENU! activeObject:",de,"selectedObjects:",ge.length),c({visible:!0,x:ie.clientX,y:ie.clientY,selectedObjects:ge})}else{c(ge=>({...ge,visible:!1}));const de=I.findTarget(ie,!1);console.log("🎯 Target found:",(de==null?void 0:de.type)||"none"),ie.shiftKey&&!de?(console.log("🖐️ Starting pan mode (Shift+drag on empty space)"),re=!0,I.isDragging=!0,I.selection=!1,fe=ie.clientX,pe=ie.clientY):(console.log("✅ Ensuring selection is enabled for multi-selection"),I.selection=!0,I.isDragging=!1,(ie.ctrlKey||ie.metaKey)&&console.log("🔥 Ctrl/Cmd detected - multi-selection should work!"))}}),I.on("mouse:up",()=>{b(!1),re&&(console.log("🖐️ Ending pan mode"),re=!1,I.isDragging=!1,I.selection=!0)});const U=I.getElement(),$=U.parentElement,he=ae=>(console.log("🔥 PREVENTING CONTEXT MENU on:",ae.target),ae.preventDefault(),ae.stopPropagation(),!1);U.addEventListener("contextmenu",he),$&&$.addEventListener("contextmenu",he),e.current&&e.current.addEventListener("contextmenu",he);const ee=()=>{e.current&&(I.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),I.renderAll())};window.addEventListener("resize",ee);const W=ae=>{const ie=ae.e;if(ie.ctrlKey||ie.metaKey){ie.preventDefault();const de=ie.deltaY;let ge=I.getZoom();ge*=.999**de,ge>5&&(ge=5),ge<.1&&(ge=.1);const Re=new He.fabric.Point(ae.e.offsetX,ae.e.offsetY);I.zoomToPoint(Re,ge),q(ge)}};I.on("mouse:wheel",W);let re=!1,fe=0,pe=0;return I.on("mouse:move",ae=>{const ie=I.getPointer(ae.e);r({x:Math.round(ie.x),y:Math.round(ie.y)});const de=I.getCenter();if(i({x:Math.round(de.left),y:Math.round(de.top)}),re){const ge=ae.e,Re=I.viewportTransform;Re[4]+=ge.clientX-fe,Re[5]+=ge.clientY-pe,I.requestRenderAll(),fe=ge.clientX,pe=ge.clientY}}),I.on("mouse:wheel",ae=>{const ie=ae.e;if(!ie.ctrlKey&&!ie.metaKey){ie.preventDefault();const de=I.viewportTransform;de[4]-=ie.deltaX||0,de[5]-=ie.deltaY||0,I.requestRenderAll()}}),()=>{window.removeEventListener("resize",ee),I.dispose()}},[]),le.useEffect(()=>{f&&f.freeDrawingBrush&&(f.freeDrawingBrush.width=x,f.freeDrawingBrush.color=C),console.log("🔧 Canvas tool changed to:",y)},[f,x,C,y]),le.useEffect(()=>{const I=N=>{if(f){if((N.ctrlKey||N.metaKey)&&["z","y","a","c","v","x","+","-","=","0"].includes(N.key.toLowerCase())&&N.preventDefault(),(N.ctrlKey||N.metaKey)&&N.key==="z"&&!N.shiftKey)pn.getState().undo();else if((N.ctrlKey||N.metaKey)&&N.key==="y"||(N.ctrlKey||N.metaKey)&&N.shiftKey&&N.key==="Z")pn.getState().redo();else if((N.ctrlKey||N.metaKey)&&N.key==="a"){const M=f.getObjects();f.discardActiveObject();const U=new He.fabric.ActiveSelection(M,{canvas:f});f.setActiveObject(U),f.requestRenderAll()}else if((N.ctrlKey||N.metaKey)&&(N.key==="+"||N.key==="="))F();else if((N.ctrlKey||N.metaKey)&&N.key==="-")H();else if((N.ctrlKey||N.metaKey)&&N.key==="0")J();else if((N.ctrlKey||N.metaKey)&&N.key==="v")ce();else if(N.key==="Delete"||N.key==="Backspace"){const M=document.activeElement;if(!(M&&(M.tagName==="INPUT"||M.tagName==="TEXTAREA"||M.getAttribute("contenteditable")==="true"))){const $=f.getActiveObject();$&&($.type==="activeSelection"?($.forEachObject(ee=>{f.remove(ee)}),f.discardActiveObject()):f.remove($),f.requestRenderAll())}}}};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[f]);const ce=async()=>{if(!f)return;const I=document.activeElement;if(!(I&&(I.tagName==="INPUT"||I.tagName==="TEXTAREA"||I.getAttribute("contenteditable")==="true")))try{const M=await navigator.clipboard.read();for(const U of M)for(const $ of U.types)if($.startsWith("image/")){const he=await U.getType($),ee=new FileReader;ee.onload=async W=>{var re;if((re=W.target)!=null&&re.result&&typeof W.target.result=="string")try{await E(W.target.result),console.log("✅ Image pasted from clipboard successfully")}catch(fe){console.error("❌ Failed to import pasted image:",fe),alert("無法貼上圖片，請確保圖片格式正確")}},ee.readAsDataURL(he);return}console.log("ℹ️ No image found in clipboard")}catch(M){console.error("❌ Failed to read clipboard:",M),M instanceof DOMException&&M.name==="NotAllowedError"?alert("需要剪貼簿權限才能貼上圖片，請允許瀏覽器訪問剪貼簿"):console.log("ℹ️ Clipboard access failed (might be normal on some browsers)")}},X=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(U=>U.type==="image").map(U=>{var $;return(($=U._originalElement)==null?void 0:$.src)||U.src}).filter(Boolean);if(I.length<2){alert("請選擇至少 2 張圖片來合併");return}const N=window.prompt("請輸入合併指令：","將這些圖片融合成藝術拼貼");if(!N)return;const M=await Ze.mergeImages(I,N);await E(M),alert("圖片合併完成！")}catch(I){console.error("合併失敗:",I),alert("合併失敗: "+I)}},_=async()=>{var M;if(n.selectedObjects.length===0)return;const I=n.selectedObjects.find(U=>U.type==="image");if(!I){alert("請選擇一張圖片來套用風格");return}const N=window.prompt("請輸入風格描述：","梵高星夜風格");if(N)try{const U=((M=I._originalElement)==null?void 0:M.src)||I.src,$=await Ze.transferStyle({imageUrl:U,style:N});await E($),alert("風格轉換完成！")}catch(U){alert("風格轉換失敗: "+U)}},j=()=>{!f||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{I.clone(N=>{N.set({left:(N.left||0)+20,top:(N.top||0)+20}),f.add(N)})}),f.renderAll())},A=()=>{!f||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{f.remove(I)}),f.renderAll())},O=()=>{!f||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{f.bringToFront(I)}),f.renderAll())},z=()=>{!f||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{f.sendToBack(I)}),f.renderAll())},P=()=>{!f||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{const N=I.angle||0;I.set({angle:N+90})}),f.renderAll())},k=async()=>{var N;if(n.selectedObjects.length===0)return;console.log("🌟 Generating similar images from selected objects:",n.selectedObjects.length);const I="Generate a very similar object or item with the same category, style, and visual characteristics. Keep the same type of object, similar colors, materials, and overall appearance. Maintain the same scene context and background style.";try{h(!0),u("analyzing");const M=[];for(const $ of n.selectedObjects)if($.type==="image"){const he=$;let ee;he.getSrc&&typeof he.getSrc=="function"?ee=he.getSrc():(N=$._originalElement)!=null&&N.src?ee=$._originalElement.src:$.src&&(ee=$.src),typeof ee=="string"&&ee.length>0&&M.push(ee)}if(M.length===0){h(!1),alert("Please select at least one image to generate similar content");return}console.log("🎯 Using images for similarity generation:",M.length),setTimeout(()=>{u("composing")},1e3),setTimeout(()=>{u("rendering")},2e3);const U=await Ze.generateSimilar({images:M,prompt:`Create an image of the exact same type of object/item as shown in the reference image(s). If it's sunglasses, generate different sunglasses. If it's a car, generate a different car. ${I}. Do NOT change the object category - keep it as the same type of item but with variations in design, color, or style.`,aspectRatio:"1:1"});u("finalizing"),setTimeout(async()=>{try{U?(await E(U),console.log("✅ Similar image generated and added to canvas!")):(console.error("❌ No image generated from similarity API"),alert("Failed to generate similar image - no result returned"))}catch($){console.error("Failed to import similar image:",$),alert("Image generation succeeded but failed to display: "+$)}finally{h(!1)}},500)}catch(M){console.error("❌ Generate similar error:",M),h(!1),alert("Failed to generate similar image: "+M)}},D=async()=>{if(!(!f||n.selectedObjects.length===0)){console.log("🖼️ Exporting selected objects:",n.selectedObjects.length);try{let I=1/0,N=1/0,M=-1/0,U=-1/0;n.selectedObjects.forEach(ae=>{const ie=ae.getBoundingRect(!0);I=Math.min(I,ie.left),N=Math.min(N,ie.top),M=Math.max(M,ie.left+ie.width),U=Math.max(U,ie.top+ie.height)});const $=20,he=M-I+$*2,ee=U-N+$*2;console.log("📐 Export bounds:",{minX:I,minY:N,maxX:M,maxY:U,exportWidth:he,exportHeight:ee,objectCount:n.selectedObjects.length});const W=document.createElement("canvas");W.width=he,W.height=ee;const re=new He.fabric.Canvas(W);re.setWidth(he),re.setHeight(ee),re.backgroundColor="transparent";const fe=W.getContext("2d");fe&&fe.clearRect(0,0,he,ee);const pe=n.selectedObjects.map(ae=>new Promise(ie=>{ae.clone(de=>{const ge=ae.getBoundingRect(!0),Re=ge.left-I+$,Pt=ge.top-N+$,at=ae.left||0,Ts=ae.top||0,nr=ge.left+ge.width/2,ks=ge.top+ge.height/2;if(de.set({left:Re+(at-nr)+ge.width/2,top:Pt+(Ts-ks)+ge.height/2,scaleX:ae.scaleX,scaleY:ae.scaleY,angle:ae.angle,flipX:ae.flipX,flipY:ae.flipY,skewX:ae.skewX,skewY:ae.skewY,opacity:ae.opacity}),de.type==="image"){const St=de;if(St._originalElement){const Tn=document.createElement("canvas"),Ps=Tn.getContext("2d");if(Ps&&St._originalElement){Tn.width=St._originalElement.width||St.width||100,Tn.height=St._originalElement.height||St.height||100,Ps.clearRect(0,0,Tn.width,Tn.height),Ps.drawImage(St._originalElement,0,0);const ir=new Image;ir.crossOrigin="anonymous",ir.onload=()=>{St.setElement(ir),re.add(de),console.log("📦 Cloned image with transparency preserved:",de.type,"from",ae.left,ae.top,"to",de.left,de.top),ie()},ir.src=Tn.toDataURL("image/png");return}}}re.add(de),console.log("📦 Cloned object:",de.type,"from",ae.left,ae.top,"to",de.left,de.top),ie()})}));await Promise.all(pe),re.renderAll(),setTimeout(()=>{const ae=re.toDataURL({format:"png",quality:1,multiplier:2,enableRetinaScaling:!1,withoutTransform:!1,backgroundColor:"transparent"});if(ae&&ae!=="data:,"){const ie=document.createElement("a");ie.download=`selected-objects-${Date.now()}.png`,ie.href=ae,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),console.log("✅ Export completed successfully")}else console.error("❌ Failed to generate image data"),alert("圖片匯出失敗，請重試");re.dispose()},500)}catch(I){console.error("❌ Export error:",I),alert("圖片匯出失敗："+I)}}},R=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(M=>M.type==="image").map(M=>{var U;return((U=M._originalElement)==null?void 0:U.src)||M.src}).filter(Boolean);if(I.length<2){alert("Please select at least 2 images for AI composition");return}c(M=>({...M,visible:!1})),h(!0),u("analyzing"),setTimeout(()=>{u("composing")},1e3),setTimeout(()=>{u("rendering")},2e3);const N=await Ze.mergeImages(I,"Intelligent auto-compose - merge the key subjects and elements naturally into a cohesive, professional composition");u("finalizing"),setTimeout(async()=>{try{await E(N),console.log(`✅ AI Smart Composition completed! Merged ${I.length} images intelligently.`)}catch(M){console.error("Failed to import generated image:",M),alert("Image generation completed but failed to display on canvas: "+M)}finally{h(!1)}},500)}catch(I){console.error("AI Composition failed:",I),h(!1),alert("AI Composition failed: "+I)}},Y=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(M=>M.type==="image").map(M=>{var U;return((U=M._originalElement)==null?void 0:U.src)||M.src}).filter(Boolean);if(I.length<2)return;c(M=>({...M,visible:!1})),h(!0),u("analyzing"),setTimeout(()=>{u("composing")},1e3),setTimeout(()=>{u("rendering")},2e3);const N=await Ze.mergeImages(I,"Make the person wear or use the accessories/items naturally. Ensure realistic lighting, shadows, and proportions.");u("finalizing"),setTimeout(async()=>{try{await E(N),alert("🥽 Accessory composition completed! Items naturally integrated.")}catch(M){console.error("Failed to import accessory composition:",M),alert("Accessory composition completed but failed to display: "+M)}finally{h(!1)}},500)}catch(I){console.error("Accessory composition failed:",I),h(!1),alert("Accessory composition failed: "+I)}},G=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(M=>M.type==="image").map(M=>{var U;return((U=M._originalElement)==null?void 0:U.src)||M.src}).filter(Boolean);if(I.length<2)return;c(M=>({...M,visible:!1})),h(!0),u("analyzing"),setTimeout(()=>{u("composing")},1e3),setTimeout(()=>{u("rendering")},2e3);const N=await Ze.mergeImages(I,"Create a realistic scene by placing subjects into backgrounds naturally. Match lighting, shadows, and perspective perfectly.");u("finalizing"),setTimeout(async()=>{try{await E(N),alert("🏞️ Scene integration completed! Objects naturally placed in scene.")}catch(M){console.error("Failed to import scene composition:",M),alert("Scene composition completed but failed to display: "+M)}finally{h(!1)}},500)}catch(I){console.error("Scene composition failed:",I),h(!1),alert("Scene composition failed: "+I)}},K=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(M=>M.type==="image").map(M=>{var U;return((U=M._originalElement)==null?void 0:U.src)||M.src}).filter(Boolean);if(I.length<2)return;c(M=>({...M,visible:!1})),h(!0),u("analyzing"),setTimeout(()=>{u("composing")},1e3),setTimeout(()=>{u("rendering")},2e3);const N=await Ze.mergeImages(I,"Create an artistic, creative blend that combines the best elements from all images in an innovative and visually stunning way.");u("finalizing"),setTimeout(async()=>{try{await E(N),alert("✨ Creative blend completed! Innovative artistic fusion created.")}catch(M){console.error("Failed to import creative blend:",M),alert("Creative blend completed but failed to display: "+M)}finally{h(!1)}},500)}catch(I){console.error("Creative blend failed:",I),h(!1),alert("Creative blend failed: "+I)}},Z=()=>{if(!f||n.selectedObjects.length<=1)return;const I=new He.fabric.Group(n.selectedObjects,{left:Math.min(...n.selectedObjects.map(N=>N.left||0)),top:Math.min(...n.selectedObjects.map(N=>N.top||0))});n.selectedObjects.forEach(N=>f.remove(N)),f.add(I),f.setActiveObject(I),f.renderAll()},se=()=>{n.selectedObjects.length!==0&&(console.log("🎤 Opening voice prompt modal for",n.selectedObjects.length,"objects"),v({visible:!0,selectedObjects:[...n.selectedObjects]}),c(I=>({...I,visible:!1})))},V=async(I,N)=>{if(!(!I.trim()||p.selectedObjects.length===0))try{console.log("🎤 Processing voice/text prompt:",I),console.log("🖼️ Selected objects:",p.selectedObjects.length),h(!0),u("analyzing");const M=p.selectedObjects.filter(ee=>ee.type==="image").map(ee=>{var fe;const W=ee;let re;if(W.getSrc&&typeof W.getSrc=="function"?re=W.getSrc():(fe=ee._originalElement)!=null&&fe.src?re=ee._originalElement.src:ee.src&&(re=ee.src),typeof re=="string"&&re.length>0)try{return typeof re.indexOf=="function"?re:(console.warn("String URL does not support indexOf method:",typeof re),null)}catch(pe){return console.warn("Error validating image URL:",pe),null}return console.warn("無法提取圖片URL，物件:",ee),null}).filter(ee=>typeof ee=="string"&&ee.length>0);if(console.log("🎤 提取的圖片URLs:",M),M.length===0){h(!1),alert("請選擇至少一張圖片來執行語音指令");return}setTimeout(()=>{u("composing")},800);let U;if(M.length===1){console.log("🎯 Single image voice command processing");const ee=M[0];if(console.log("🔍 Debug - imageUrl type:",typeof ee,"value:",ee),typeof ee!="string")throw new Error(`Invalid imageUrl type: expected string, got ${typeof ee}`);U=await Ze.imageToImage({imageUrl:ee,prompt:`${I}. IMPORTANT: Preserve the exact features, identity, and characteristics of ALL main subjects and objects in the image (people, furniture, vehicles, animals, products, etc.). Maintain the original style, quality, shape, texture, color, and distinctive details of all important elements while making only the requested changes naturally. Keep the core identity and recognizable features of every main object completely consistent.`,strength:.5,width:512,height:512})}else{console.log("🎯 Multi-image voice command processing"),console.log("🔍 Debug - imageUrls types:",M.map((W,re)=>`[${re}]: ${typeof W}`)),console.log("🔍 Debug - imageUrls values:",M.map((W,re)=>`[${re}]: ${W}`));const ee=M.filter(W=>typeof W!="string");if(ee.length>0)throw new Error(`Invalid imageUrl types in array: ${ee.map(W=>typeof W).join(", ")}`);U=await Ze.mergeImages(M,`${I}. IMPORTANT: Preserve the exact features, identity, and characteristics of ALL main subjects and objects in all images (people, furniture, vehicles, animals, products, etc.). Maintain consistent shape, texture, color, distinctive details, and core identity of every important element. Apply this instruction to combine and edit the images naturally while keeping all main subjects and objects completely recognizable and stable.`)}u("rendering");const $=typeof U=="string"?U:U.url;if(console.log("🔍 Debug - final imageUrl type:",typeof $,"value:",typeof $=="string"?$.substring(0,50)+"...":$),typeof $!="string")throw new Error(`Invalid final imageUrl type: expected string, got ${typeof $}`);await E($),u("finalizing"),console.log("✅ Voice/text command completed successfully!");const he=N?`🎤 語音指令「${I}」執行完成！`:`📝 文字指令「${I}」執行完成！`;setTimeout(()=>{h(!1),alert(he)},500)}catch(M){console.error("❌ Voice/text prompt failed:",M),console.error("❌ Error details:",{message:M.message,stack:M.stack,name:M.name}),h(!1);let U=N?"語音指令處理失敗":"文字指令處理失敗";M.message&&M.message.includes("indexOf")?U+=": 圖片格式處理錯誤，請重新嘗試":M.message?U+=`: ${M.message}`:U+=`: ${M}`,alert(U)}},B=()=>{v({visible:!1,selectedObjects:[]})};return w.jsxs("div",{ref:e,className:"canvas-container flex-1 relative",onContextMenu:I=>(console.log("🔥 CONTAINER RIGHT CLICK!"),I.preventDefault(),I.stopPropagation(),!1),onMouseDown:I=>{console.log("🔥 CONTAINER MOUSE DOWN - Button:",I.button),I.button===2&&(console.log("🔥 CONTAINER RIGHT CLICK DETECTED!"),I.preventDefault(),I.stopPropagation(),c({visible:!0,x:I.clientX,y:I.clientY,selectedObjects:(f==null?void 0:f.getActiveObjects())||[]}))},children:[w.jsx("canvas",{ref:t}),w.jsx("div",{className:"absolute top-4 left-4 md:top-4 md:right-4 md:left-auto bg-white bg-opacity-90 rounded-lg px-2 md:px-3 py-1.5 md:py-2 shadow-lg border border-gray-200 z-10",children:w.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[w.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[w.jsx("span",{className:"hidden md:inline",children:"📍 Mouse:"}),w.jsx("span",{className:"md:hidden",children:"📍"}),w.jsxs("span",{className:"font-mono bg-gray-100 px-1.5 md:px-2 py-0.5 rounded text-xs",children:["x:",d.x," y:",d.y]})]}),w.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[w.jsx("span",{className:"hidden md:inline",children:"🎯 Center:"}),w.jsx("span",{className:"md:hidden",children:"🎯"}),w.jsxs("span",{className:"font-mono bg-blue-100 px-1.5 md:px-2 py-0.5 rounded text-xs",children:["x:",a.x," y:",a.y]})]}),w.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[w.jsxs("button",{onClick:o,className:"text-xs px-1.5 md:px-2 py-1 bg-green-100 hover:bg-green-200 active:bg-green-300 text-green-700 rounded transition-colors touch-manipulation",title:"Go to origin (0,0)",children:[w.jsx("span",{className:"hidden md:inline",children:"🏠 Origin"}),w.jsx("span",{className:"md:hidden",children:"🏠"})]}),w.jsxs("button",{onClick:()=>g(!l),className:`text-xs px-1.5 md:px-2 py-1 rounded transition-colors touch-manipulation ${l?"bg-purple-200 text-purple-700":"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-700"}`,title:"Toggle grid",children:[w.jsx("span",{className:"hidden md:inline",children:"⊞ Grid"}),w.jsx("span",{className:"md:hidden",children:"⊞"})]})]})]})}),w.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center space-x-1 md:space-x-2",children:[w.jsx("button",{onClick:H,className:"bg-white bg-opacity-90 hover:bg-opacity-100 active:bg-gray-100 rounded p-2 md:p-2.5 text-gray-600 transition-all shadow-md touch-manipulation",title:"Zoom out (Ctrl+Mouse wheel)",children:w.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})})}),w.jsxs("button",{onClick:J,className:"bg-white bg-opacity-90 hover:bg-opacity-100 active:bg-gray-100 rounded px-2 md:px-3 py-1 md:py-1.5 text-xs md:text-sm text-gray-600 min-w-[50px] md:min-w-[60px] transition-all shadow-md touch-manipulation font-mono",title:"Reset zoom and pan",children:[Math.round(L*100),"%"]}),w.jsx("button",{onClick:F,className:"bg-white bg-opacity-90 hover:bg-opacity-100 active:bg-gray-100 rounded p-2 md:p-2.5 text-gray-600 transition-all shadow-md touch-manipulation",title:"Zoom in (Ctrl+Mouse wheel)",children:w.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})]}),w.jsx("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 rounded-lg px-3 py-2 text-xs text-gray-600 shadow-lg border border-gray-200",children:w.jsxs("div",{className:"space-y-1",children:[w.jsxs("div",{children:["🔍 ",w.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Cmd"})," + Trackpad: Zoom"]}),w.jsx("div",{children:"🖐️ Trackpad: Move canvas"}),w.jsxs("div",{children:["✨ ",w.jsx("kbd",{className:"px-1 py-0.5 bg-blue-100 rounded text-xs",children:"Shift"})," + Click: Multi-select"]}),w.jsxs("div",{children:["🎯 ",w.jsx("kbd",{className:"px-1 py-0.5 bg-purple-100 rounded text-xs",children:"Cmd"})," + Click: Add/Remove selection"]})]})}),w.jsx(Xm,{x:n.x,y:n.y,visible:n.visible,selectedCount:n.selectedObjects.length,onClose:()=>c(I=>({...I,visible:!1})),onMergeImages:X,onStyleTransfer:_,onDuplicate:j,onDelete:A,onBringToFront:O,onSendToBack:z,onRotate:P,onGenerateSimilar:k,onExportSelected:D,onIntelligentCompose:R,onWearAccessory:Y,onSceneCompose:G,onCreativeBlend:K,onGroupSelection:Z,onVoicePrompt:se}),w.jsx(Ym,{visible:p.visible,selectedCount:p.selectedObjects.length,onClose:B,onSubmit:V}),w.jsx(Zh,{isVisible:S,stage:s})]})},Qm=[{id:"select",icon:Kg,label:"選取工具",shortcut:"V"}],Jm=()=>{le.useState(!1);const{tool:t,setTool:e,undo:n,redo:c,canUndo:p,canRedo:v,clearCanvas:S,getSelectedImages:h}=pn(),{addImages:s}=Jo(),u=r=>{e(r)},d=()=>{const r=document.createElement("input");r.type="file",r.accept="image/*",r.multiple=!0,r.onchange=async a=>{const i=a.target.files;i&&i.length>0&&await s(i,{autoArrange:i.length>1,spacing:20,maxWidth:200,maxHeight:200})},r.click()};return w.jsx("div",{className:"tool-panel relative",children:w.jsxs("div",{className:"w-12 md:w-16 flex flex-col items-center py-2 md:py-4 space-y-1 md:space-y-2",children:[w.jsx("div",{className:"flex flex-col space-y-1",children:w.jsx("button",{onClick:d,className:"w-8 h-8 md:w-10 md:h-10 rounded-lg bg-blue-100 hover:bg-blue-200 active:bg-blue-300 text-blue-600 flex items-center justify-center transition-all duration-200 touch-manipulation",title:"Import Multiple Images",children:w.jsx(Hh,{className:"w-4 h-4 md:w-5 md:h-5"})})}),w.jsx("div",{className:"w-6 md:w-8 h-px bg-gray-300 my-1 md:my-2"}),w.jsx("div",{className:"flex flex-col space-y-1",children:Qm.map(r=>{const a=r.icon,i=t===r.id;return w.jsx("button",{onClick:()=>u(r.id),className:`
                w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center transition-all duration-200 touch-manipulation
                ${i?"bg-primary-600 text-white shadow-md":"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-600"}
              `,title:`${r.label} (${r.shortcut})`,children:w.jsx(a,{className:"w-4 h-4 md:w-5 md:h-5"})},r.id)})}),w.jsxs("div",{className:"flex flex-col space-y-1",children:[w.jsx("button",{onClick:n,disabled:!p(),className:`
            w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center transition-all duration-200 touch-manipulation
            ${p()?"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Undo (Ctrl+Z)",children:w.jsx(im,{className:"w-4 h-4 md:w-5 md:h-5"})}),w.jsx("button",{onClick:c,disabled:!v(),className:`
            w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center transition-all duration-200 touch-manipulation
            ${v()?"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Redo (Ctrl+Y)",children:w.jsx(Jg,{className:"w-4 h-4 md:w-5 md:h-5"})})]}),w.jsx("div",{className:"w-6 md:w-8 h-px bg-gray-300 my-1 md:my-2"}),w.jsx("div",{className:"flex flex-col space-y-1",children:w.jsx("button",{onClick:S,className:"w-8 h-8 md:w-10 md:h-10 rounded-lg bg-red-100 hover:bg-red-200 active:bg-red-300 text-red-600 flex items-center justify-center transition-all duration-200 touch-manipulation",title:"Clear Canvas",children:w.jsx(Qo,{className:"w-4 h-4 md:w-5 md:h-5"})})})]})})},Za=[{id:"figurine",category:"creative",icon:"🎎",previewImage:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=600&h=400&fit=crop&q=80",withSelection:{en:"Transform the person from the reference image into a hyper-realistic 1/7 scale figurine, placed on an iMac computer desk with a white Apple keyboard. The figurine perfectly captures the person's appearance, clothing, and personality. The figurine stands on a transparent acrylic base. The iMac screen shows the ZBrush modeling process. Next to it is a packaging box designed to match the person's style theme.","zh-TW":"將參考圖片中的人物轉換成超寫實的1/7比例模型，放置在iMac電腦桌上，旁邊有白色Apple鍵盤。模型完美捕捉人物的外觀、服裝和個性。模型站在透明壓克力底座上。iMac螢幕顯示ZBrush建模過程。旁邊放置包裝盒，盒子設計配合人物風格主題。",es:"Transforma a la persona de la imagen de referencia en una figurita hiperrealista a escala 1/7, colocada en un escritorio de iMac con un teclado Apple blanco. La figurita captura perfectamente la apariencia, ropa y personalidad de la persona. La figurita está sobre una base acrílica transparente. La pantalla del iMac muestra el proceso de modelado en ZBrush. Junto a ella hay una caja de embalaje diseñada para coincidir con el tema de estilo de la persona.",ja:"参考画像の人物を、白いAppleキーボードと一緒にiMacコンピューターデスクに置かれた、超リアルな1/7スケールフィギュアに変換します。フィギュアは人物の外観、服装、個性を完璧に捉えています。フィギュアは透明なアクリルベースの上に立っています。iMacの画面にはZBrushモデリングプロセスが表示されています。その隣には、人物のスタイルテーマに合わせてデザインされたパッケージボックスがあります。",fr:"Transformez la personne de l'image de référence en une figurine hyperréaliste à l'échelle 1/7, placée sur un bureau iMac avec un clavier Apple blanc. La figurine capture parfaitement l'apparence, les vêtements et la personnalité de la personne. La figurine se dresse sur une base acrylique transparente. L'écran iMac affiche le processus de modélisation ZBrush. À côté se trouve une boîte d'emballage conçue pour correspondre au thème de style de la personne."},withoutSelection:{en:"Create an exquisite anime character 1/7 scale figurine, placed on a work desk, professional studio lighting, showcasing figurine details.","zh-TW":"創建一個精緻的動漫角色1/7比例模型，放置在工作桌上，專業攝影棚燈光，展現模型細節。",es:"Crea una exquisita figurita de personaje de anime a escala 1/7, colocada en un escritorio de trabajo, iluminación de estudio profesional, mostrando los detalles de la figurita.",ja:"精巧なアニメキャラクター1/7スケールフィギュアを作成し、作業机の上に配置し、プロのスタジオ照明でフィギュアの詳細を紹介します。",fr:"Créez une figurine de personnage d'anime exquise à l'échelle 1/7, placée sur un bureau de travail, éclairage de studio professionnel, mettant en valeur les détails de la figurine."}},{id:"handDrawn",category:"creative",icon:"✏️",previewImage:"https://images.unsplash.com/photo-1609845234176-c1b46ccc3ecc?w=600&h=400&fit=crop&q=80",withSelection:{en:"Transform the image into a 4-stage hand-drawn illustration process: 1. Pencil sketch outline 2. Add basic lines 3. Add details and shadows 4. Complete color illustration. Show the drawing steps from sketch to finished artwork.","zh-TW":"將圖片轉換成4階段手繪插畫過程：1.鉛筆草稿輪廓 2.加入基本線條 3.添加細節和陰影 4.完成的彩色插畫。展示從草圖到完成品的繪畫步驟。",es:"Transforma la imagen en un proceso de ilustración dibujada a mano de 4 etapas: 1. Contorno de boceto a lápiz 2. Agregar líneas básicas 3. Agregar detalles y sombras 4. Ilustración completa en color. Muestra los pasos de dibujo desde el boceto hasta la obra terminada.",ja:"画像を4段階の手描きイラストプロセスに変換：1.鉛筆スケッチの輪郭 2.基本的な線を追加 3.詳細と影を追加 4.完全なカラーイラスト。スケッチから完成した作品までの描画ステップを示します。",fr:"Transformez l'image en un processus d'illustration dessinée à la main en 4 étapes : 1. Contour de croquis au crayon 2. Ajouter des lignes de base 3. Ajouter des détails et des ombres 4. Illustration couleur complète. Montrez les étapes de dessin du croquis à l'œuvre finie."},withoutSelection:{en:"Create a character's 4-stage hand-drawing process, from simple sketch to complete color illustration","zh-TW":"創建一個角色的4階段手繪過程，從簡單草稿到完整彩色插畫",es:"Crea el proceso de dibujo a mano de 4 etapas de un personaje, desde un boceto simple hasta una ilustración completa en color",ja:"キャラクターの4段階手描きプロセスを作成し、シンプルなスケッチから完全なカラーイラストまで",fr:"Créez le processus de dessin à la main en 4 étapes d'un personnage, du croquis simple à l'illustration couleur complète"}},{id:"crossSection",category:"creative",icon:"🔧",withSelection:{en:"Create a 3D cross-section diagram of the object, showing internal structure and components, technical diagram style, labeling each part, engineering drawing style","zh-TW":"創建物體的3D剖面圖，展示內部結構和組件，技術圖解風格，標註各部分名稱，工程圖紙風格",es:"Crea un diagrama de sección transversal 3D del objeto, mostrando la estructura interna y los componentes, estilo de diagrama técnico, etiquetando cada parte, estilo de dibujo de ingeniería",ja:"オブジェクトの3D断面図を作成し、内部構造とコンポーネントを示し、技術図スタイル、各部分にラベルを付け、エンジニアリング図面スタイル",fr:"Créez un diagramme de coupe transversale 3D de l'objet, montrant la structure interne et les composants, style de diagramme technique, étiquetant chaque partie, style de dessin d'ingénierie"},withoutSelection:{en:"Generate a 3D cross-section diagram of a building, showing internal floor structure","zh-TW":"生成建築物的3D剖面圖，展示內部樓層結構",es:"Genera un diagrama de sección transversal 3D de un edificio, mostrando la estructura interna del piso",ja:"建物の3D断面図を生成し、内部フロア構造を示す",fr:"Générez un diagramme de coupe transversale 3D d'un bâtiment, montrant la structure interne du plancher"}},{id:"restoration",category:"creative",icon:"📸",previewImage:"https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=600&h=400&fit=crop&q=80",withSelection:{en:"Restore and colorize this old photo, remove scratches, stains and fading, enhance details, add natural colors, maintain original composition and character features","zh-TW":"修復並上色這張老照片，去除刮痕、污漬和褪色，增強細節，添加自然色彩，保持原始構圖和人物特徵",es:"Restaura y colorea esta foto antigua, elimina rayones, manchas y decoloración, mejora los detalles, agrega colores naturales, mantiene la composición original y las características del personaje",ja:"この古い写真を復元し、着色し、傷、汚れ、色あせを除去し、詳細を強化し、自然な色を追加し、元の構図とキャラクターの特徴を維持します",fr:"Restaurez et coloriez cette vieille photo, supprimez les rayures, les taches et la décoloration, améliorez les détails, ajoutez des couleurs naturelles, maintenez la composition originale et les caractéristiques du personnage"},withoutSelection:{en:"Restore a 1950s black and white family photo, add colors","zh-TW":"修復一張1950年代的黑白家庭照片，添加色彩",es:"Restaura una foto familiar en blanco y negro de los años 1950, agrega colores",ja:"1950年代の白黒家族写真を復元し、色を追加します",fr:"Restaurez une photo de famille en noir et blanc des années 1950, ajoutez des couleurs"}},{id:"idPhoto",category:"professional",icon:"📷",previewImage:"https://images.unsplash.com/photo-1607706189992-eae578626c86?w=600&h=400&fit=crop&q=80",withSelection:{en:"Transform the person into a professional ID photo: white background, formal attire, confident expression, ID photo format, professional studio lighting, maintain person's facial features","zh-TW":"將人物轉換成專業證件照：白色背景、正裝、自信表情、證件照規格、專業攝影棚燈光、保持人物臉部特徵",es:"Transforma a la persona en una foto de identificación profesional: fondo blanco, vestimenta formal, expresión confiada, formato de foto de identificación, iluminación de estudio profesional, mantén las características faciales de la persona",ja:"人物をプロフェッショナルなID写真に変換：白い背景、フォーマルな服装、自信に満ちた表情、ID写真フォーマット、プロのスタジオ照明、人物の顔の特徴を維持",fr:"Transformez la personne en photo d'identité professionnelle : arrière-plan blanc, tenue formelle, expression confiante, format de photo d'identité, éclairage de studio professionnel, maintenez les traits du visage de la personne"},withoutSelection:{en:"Generate professional business ID photo, white background, formal attire","zh-TW":"生成專業商務證件照，白色背景，正裝",es:"Genera una foto de identificación comercial profesional, fondo blanco, vestimenta formal",ja:"プロフェッショナルなビジネスID写真を生成、白い背景、フォーマルな服装",fr:"Générez une photo d'identité commerciale professionnelle, arrière-plan blanc, tenue formelle"}},{id:"product",category:"professional",icon:"📦",withSelection:{en:"Transform the product into professional e-commerce photography: pure white background, multi-angle display, professional lighting, showcase product details and texture","zh-TW":"將產品轉換成專業電商攝影：純白背景、多角度展示、專業打光、展現產品細節和質感",es:"Transforma el producto en fotografía profesional de comercio electrónico: fondo blanco puro, exhibición en múltiples ángulos, iluminación profesional, muestra los detalles y textura del producto",ja:"製品をプロフェッショナルなeコマース写真に変換：純白の背景、多角度表示、プロの照明、製品の詳細と質感を紹介",fr:"Transformez le produit en photographie professionnelle de commerce électronique : arrière-plan blanc pur, affichage multi-angles, éclairage professionnel, mettez en valeur les détails et la texture du produit"},withoutSelection:{en:"Create professional product photography, suitable for e-commerce platforms","zh-TW":"創建專業產品攝影，適合電商平台使用",es:"Crea fotografía profesional de productos, adecuada para plataformas de comercio electrónico",ja:"プロフェッショナルな製品写真を作成し、eコマースプラットフォームに適している",fr:"Créez une photographie de produit professionnelle, adaptée aux plateformes de commerce électronique"}},{id:"interior",category:"professional",icon:"🏠",withSelection:{en:"Redesign the space: add modern furniture, change wall colors, add decorations, professional interior design style","zh-TW":"將空間重新設計：添加現代家具、改變牆面顏色、加入裝飾品、專業室內設計風格",es:"Rediseña el espacio: agrega muebles modernos, cambia los colores de las paredes, agrega decoraciones, estilo de diseño de interiores profesional",ja:"スペースを再設計：モダンな家具を追加、壁の色を変更、装飾を追加、プロのインテリアデザインスタイル",fr:"Redessinez l'espace : ajoutez des meubles modernes, changez les couleurs des murs, ajoutez des décorations, style de design d'intérieur professionnel"},withoutSelection:{en:"Design modern minimalist living room, including sofa, coffee table and decorations","zh-TW":"設計現代簡約風格客廳，包含沙發、茶几和裝飾",es:"Diseña una sala de estar minimalista moderna, incluyendo sofá, mesa de café y decoraciones",ja:"ソファ、コーヒーテーブル、装飾を含むモダンなミニマリストのリビングルームをデザイン",fr:"Concevez un salon minimaliste moderne, comprenant un canapé, une table basse et des décorations"}},{id:"marketing",category:"professional",icon:"📱",withSelection:{en:"Create social media marketing material: add attractive background, text space, brand colors, suitable for Instagram posting","zh-TW":"創建社群媒體行銷素材：加入吸引人的背景、文字空間、品牌色彩、適合Instagram發布",es:"Crea material de marketing para redes sociales: agrega fondo atractivo, espacio de texto, colores de marca, adecuado para publicar en Instagram",ja:"ソーシャルメディアマーケティング素材を作成：魅力的な背景、テキストスペース、ブランドカラーを追加、Instagram投稿に適している",fr:"Créez du matériel de marketing pour les médias sociaux : ajoutez un arrière-plan attrayant, un espace de texte, des couleurs de marque, adapté à la publication Instagram"},withoutSelection:{en:"Design eye-catching social media advertising images","zh-TW":"設計引人注目的社群媒體廣告圖片",es:"Diseña imágenes publicitarias llamativas para redes sociales",ja:"目を引くソーシャルメディア広告画像をデザイン",fr:"Concevez des images publicitaires accrocheuses pour les médias sociaux"}},{id:"tryOn",category:"fun",icon:"👗",withSelection:{en:"Dress the person from the first image in the clothing from the second image, keep the person's pose and background unchanged, clothing should fit naturally","zh-TW":"將第一張圖片的人物穿上第二張圖片的服裝，保持人物姿勢和背景不變，服裝要自然貼合",es:"Viste a la persona de la primera imagen con la ropa de la segunda imagen, mantén la pose y el fondo de la persona sin cambios, la ropa debe quedar naturalmente",ja:"最初の画像の人物に2番目の画像の服を着せ、人物のポーズと背景を変更せず、服は自然にフィットするようにします",fr:"Habillez la personne de la première image avec les vêtements de la deuxième image, gardez la pose et l'arrière-plan de la personne inchangés, les vêtements doivent s'ajuster naturellement"},withoutSelection:{en:"Show model trying on different style outfits","zh-TW":"展示模特兒試穿不同風格服裝",es:"Muestra un modelo probándose diferentes estilos de conjuntos",ja:"モデルが異なるスタイルの衣装を試着している様子を表示",fr:"Montrez un modèle essayant différents styles de tenues"}},{id:"timeTravel",category:"fun",icon:"⏰",withSelection:{en:"Place the person in different eras: 1920s vintage style, 1960s hippie style, 1980s disco, 2000s Y2K style, maintain person's features","zh-TW":"將人物放到不同年代：1920年代復古風、1960年代嬉皮風、1980年代迪斯可、2000年代Y2K風格，保持人物特徵",es:"Coloca a la persona en diferentes épocas: estilo vintage de los años 1920, estilo hippie de los años 1960, disco de los años 1980, estilo Y2K de los años 2000, mantén las características de la persona",ja:"人物を異なる時代に配置：1920年代のヴィンテージスタイル、1960年代のヒッピースタイル、1980年代のディスコ、2000年代のY2Kスタイル、人物の特徴を維持",fr:"Placez la personne dans différentes époques : style vintage des années 1920, style hippie des années 1960, disco des années 1980, style Y2K des années 2000, maintenez les caractéristiques de la personne"},withoutSelection:{en:"Show the same character in different historical period styles","zh-TW":"展示同一角色在不同歷史時期的造型",es:"Muestra el mismo personaje en estilos de diferentes períodos históricos",ja:"同じキャラクターを異なる歴史的時代のスタイルで表示",fr:"Montrez le même personnage dans des styles de différentes périodes historiques"}},{id:"petAdventure",category:"fun",icon:"🐾",withSelection:{en:"Place the pet in adventure scenes: astronaut costume on the moon, pirate captain on a ship, superhero flying, knight armor in a castle","zh-TW":"將寵物放入冒險場景：太空人裝扮在月球、海盜船長在船上、超級英雄飛行、騎士盔甲在城堡",es:"Coloca a la mascota en escenas de aventura: disfraz de astronauta en la luna, capitán pirata en un barco, superhéroe volando, armadura de caballero en un castillo",ja:"ペットを冒険シーンに配置：月の宇宙飛行士のコスチューム、船の海賊船長、飛行するスーパーヒーロー、城の騎士の鎧",fr:"Placez l'animal dans des scènes d'aventure : costume d'astronaute sur la lune, capitaine pirate sur un navire, super-héros volant, armure de chevalier dans un château"},withoutSelection:{en:"Create fantasy adventure scenes for pets","zh-TW":"創造寵物的奇幻冒險場景",es:"Crea escenas de aventura fantástica para mascotas",ja:"ペットのファンタジー冒険シーンを作成",fr:"Créez des scènes d'aventure fantastique pour animaux de compagnie"}},{id:"ingredients",category:"fun",icon:"🍳",withSelection:{en:"Break down the food into ingredients: each ingredient in separate bowls, label names and quantities, cooking tutorial style arrangement","zh-TW":"將食物分解成食材：每個食材放在單獨的碗中，標註名稱和份量，烹飪教學風格排列",es:"Descompón la comida en ingredientes: cada ingrediente en tazones separados, etiqueta nombres y cantidades, disposición estilo tutorial de cocina",ja:"食べ物を材料に分解：各材料を別々のボウルに入れ、名前と分量をラベル付け、料理チュートリアルスタイルの配置",fr:"Décomposez la nourriture en ingrédients : chaque ingrédient dans des bols séparés, étiquetez les noms et les quantités, arrangement de style tutoriel de cuisine"},withoutSelection:{en:"Display all ingredients and seasonings for a dish","zh-TW":"展示料理的所有食材和調味料",es:"Muestra todos los ingredientes y condimentos para un plato",ja:"料理のすべての材料と調味料を表示",fr:"Affichez tous les ingrédients et assaisonnements pour un plat"}},{id:"backgroundRemoval",category:"professional",icon:"✂️",withSelection:{en:"REMOVE ALL BACKGROUND completely, make background fully transparent, isolate main subject only, cutout style, PNG with alpha channel, white background becomes transparent, solid subject with clean edges, preserve subject 100% unchanged","zh-TW":"完全移除所有背景，讓背景完全透明，只保留主要物體，去背風格，PNG透明通道，白色背景變透明，保持主體邊緣乾淨，100%保持主體不變",es:"ELIMINAR COMPLETAMENTE TODO EL FONDO, hacer el fondo completamente transparente, aislar solo el sujeto principal, estilo de recorte, PNG con canal alfa, el fondo blanco se vuelve transparente, sujeto sólido con bordes limpios, preservar el sujeto 100% sin cambios",ja:"すべての背景を完全に削除し、背景を完全に透明にし、メインの被写体のみを分離し、カットアウトスタイル、アルファチャンネル付きPNG、白い背景を透明にし、きれいなエッジで被写体を確実にし、被写体を100%変更しない",fr:"SUPPRIMER COMPLÈTEMENT TOUT L'ARRIÈRE-PLAN, rendre l'arrière-plan complètement transparent, isoler uniquement le sujet principal, style de découpe, PNG avec canal alpha, l'arrière-plan blanc devient transparent, sujet solide avec des bords nets, préserver le sujet 100% inchangé"},withoutSelection:{en:"Remove background from object, transparent PNG output","zh-TW":"移除物體背景，輸出透明PNG",es:"Eliminar fondo del objeto, salida PNG transparente",ja:"オブジェクトから背景を削除、透明PNG出力",fr:"Supprimer l'arrière-plan de l'objet, sortie PNG transparente"}},{id:"qualityEnhancement",category:"professional",icon:"✨",withSelection:{en:"preserve original appearance, enhance clarity, reduce noise, maintain exact same composition and features, improve sharpness and detail while keeping the original look identical","zh-TW":"保持原始外觀，增強清晰度，減少雜訊，維持完全相同的構圖和特徵，提升銳利度和細節同時保持原始外觀一致",es:"preservar la apariencia original, mejorar la claridad, reducir el ruido, mantener exactamente la misma composición y características, mejorar la nitidez y los detalles manteniendo el aspecto original idéntico",ja:"元の外観を保持し、明瞭度を向上させ、ノイズを減らし、まったく同じ構成と特徴を維持し、元の外観を同一に保ちながらシャープネスと詳細を改善します",fr:"préserver l'apparence originale, améliorer la clarté, réduire le bruit, maintenir exactement la même composition et les mêmes caractéristiques, améliorer la netteté et les détails tout en gardant l'aspect original identique"},withoutSelection:{en:"Enhance image quality and clarity, professional photo enhancement","zh-TW":"增強圖像品質和清晰度，專業照片增強",es:"Mejorar la calidad y claridad de la imagen, mejora profesional de fotos",ja:"画像の品質と明瞭度を向上させ、プロの写真強化",fr:"Améliorer la qualité et la clarté de l'image, amélioration professionnelle des photos"}}];function wc(t,e,n){const c=Za.find(v=>v.id===t);if(!c)return"";const p=e?c.withSelection:c.withoutSelection;return p[n]||p.en}const _s=()=>{const n={enabled:!1,environment:"production",googleAnalyticsId:"G-5Q0951GHF0",features:{pageTracking:!0,eventTracking:!0,errorTracking:!0,performanceTracking:!0},privacy:{anonymizeIP:!0,respectDoNotTrack:!0,cookieConsent:!0}};return n.enabled=!0,n},ia=t=>{const e=_s();return e.enabled&&e.features[t]},Zm=()=>(_s(),navigator.doNotTrack==="1"),ep=()=>{const t=_s();return Zm()?(console.log("🔒 Analytics disabled due to privacy settings"),!1):!t.enabled||!t.googleAnalyticsId?(console.log("📊 Analytics not initialized - missing configuration"),!1):!0};class tp{constructor(){ft(this,"isEnabled",!1);ft(this,"gaTrackingId",null);ft(this,"currentSession",null);this.initializeSession(),this.safeInitialize()}safeInitialize(){try{const e=_s();if(!ep()){console.log("📊 Analytics initialization skipped");return}e.googleAnalyticsId&&this.init(e.googleAnalyticsId)}catch(e){console.warn("📊 Analytics initialization failed safely:",e),this.isEnabled=!1}}init(e){this.gaTrackingId=e,this.isEnabled=!0,this.loadGoogleAnalytics(e),ia("pageTracking")&&this.trackPageView(window.location.pathname),console.log("📊 Analytics initialized with tracking ID:",e)}loadGoogleAnalytics(e){const n=document.createElement("script");n.async=!0,n.src=`https://www.googletagmanager.com/gtag/js?id=${e}`,document.head.appendChild(n);const c=document.createElement("script");c.innerHTML=`
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '${e}', {
        page_title: 'OmniCanvas - AI Creative Canvas',
        custom_map: {'custom_parameter_1': 'ai_feature'}
      });
    `,document.head.appendChild(c),window.gtag=(...p)=>{window.dataLayer=window.dataLayer||[],window.dataLayer.push(arguments)}}initializeSession(){this.currentSession={session_id:this.generateSessionId(),start_time:Date.now(),page_views:0,events:[]}}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}trackPageView(e){if(!(!this.isEnabled||!ia("pageTracking")))try{this.currentSession&&this.currentSession.page_views++,window.gtag&&window.gtag("config",this.gaTrackingId,{page_path:e,page_title:`OmniCanvas - ${e}`}),console.log("📄 Page view tracked:",e)}catch(n){console.warn("📄 Page view tracking failed safely:",n)}}trackEvent(e){var n;if(!(!this.isEnabled||!ia("eventTracking")))try{this.currentSession&&this.currentSession.events.push({...e,custom_parameters:{...e.custom_parameters,timestamp:Date.now(),session_id:this.currentSession.session_id}}),window.gtag&&window.gtag("event",e.action,{event_category:e.category,event_label:e.label,value:e.value,custom_parameter_1:(n=e.custom_parameters)==null?void 0:n.ai_feature,...e.custom_parameters}),console.log("📊 Event tracked:",e)}catch(c){console.warn("📊 Event tracking failed safely:",c)}}trackAIGeneration(e){this.trackEvent({action:"ai_generation",category:"AI Features",label:e.type,value:e.processingTime,custom_parameters:{ai_feature:e.type,template_used:e.template,has_image_selection:e.hasSelection,prompt_length:e.promptLength,generation_mode:e.hasSelection?"image-to-image":"text-to-image"}})}trackTemplateUsage(e,n){this.trackEvent({action:"template_selected",category:"Templates",label:e,custom_parameters:{template_id:e,template_category:n,ai_feature:"template_usage"}})}trackFeatureUsage(e,n){this.trackEvent({action:"feature_used",category:"User Interaction",label:e,custom_parameters:{feature_name:e,...n,ai_feature:"general_usage"}})}trackError(e,n){this.trackEvent({action:"error_occurred",category:"Errors",label:e,custom_parameters:{error_message:e,error_context:n,ai_feature:"error_tracking"}})}getSessionStats(){return this.currentSession}trackUserEngagement(){if(!this.currentSession)return;const e=Date.now()-this.currentSession.start_time,n=this.currentSession.events.length;this.trackEvent({action:"session_engagement",category:"User Behavior",label:"session_summary",value:Math.round(e/1e3),custom_parameters:{session_duration_ms:e,total_events:n,page_views:this.currentSession.page_views,events_per_minute:n/(e/6e4),ai_feature:"engagement_metrics"}})}disable(){this.isEnabled=!1,console.log("📊 Analytics disabled")}enable(){this.isEnabled=!0,console.log("📊 Analytics enabled")}}const be=new tp,np=({onOpenSettings:t})=>{var ce,X,_,j,A;const e=_n(),{currentLanguage:n}=er(),{isConfigured:c}=Zo(),{getSelectedImages:p}=Jo(),{importImage:v,getSelectedImages:S}=pn(),[h,s]=le.useState(!1),[u,d]=le.useState("composing"),[r,a]=le.useState(""),[i,l]=le.useState(""),[g,o]=le.useState("generate"),[f,m]=le.useState(null),[y,x]=le.useState(null),[C,b]=le.useState("all"),[T,E]=le.useState([]),[L,F]=le.useState(null),H=S(),J=p(),q=H.length>0?H.map(O=>({url:O})):J,Q=q.length>0,te={generate:{maxImages:10,message:e.aiPanel.generate.validation.generateMessage,canUse:!0},style:{maxImages:1,message:e.aiPanel.generate.validation.styleMessage,canUse:q.length===1},merge:{maxImages:10,message:e.aiPanel.generate.validation.mergeMessage,canUse:q.length>=2}},oe=async()=>{if(!i.trim()&&g==="generate")return;const O=Date.now();console.log("🚀 Starting generation process..."),console.log("📊 State check:",{activeTab:g,hasSelection:Q,selectedImagesCount:q.length,canvasSelectedImages:S(),imageStoreImages:p(),selectedImages:q.map(P=>({url:typeof P.url=="string"?P.url.substring(0,50)+"...":P.url}))});const z=Q?"image-to-image":"text-to-image";be.trackAIGeneration({type:z,template:y||void 0,hasSelection:Q,promptLength:i.length}),s(!0),d("analyzing"),a(e.aiPanel.generate.processing.analyzing);try{setTimeout(()=>{d("composing"),a(e.aiPanel.generate.processing.composing)},1e3),setTimeout(()=>{d("rendering"),a(e.aiPanel.generate.processing.rendering)},3e3),setTimeout(()=>{d("finalizing"),a(e.aiPanel.generate.processing.finalizing)},5e3);let P;if(g==="generate")if(Q&&q.length>0){console.log("🎯 Using Image-to-Image mode!");const R=q.map(Y=>Y.url);q.length===1?(console.log("📸 Single image generation with:",typeof R[0]=="string"?R[0].substring(0,50)+"...":R[0]),P=await Ze.imageToImage({prompt:i,imageUrl:R[0],width:512,height:512,strength:.7})):(console.log("🔀 Multi-image merge with",q.length,"images"),P=await Ze.imageToImage({prompt:`Merge these ${q.length} images: ${i}`,imageUrl:R[0],width:512,height:512,strength:.5})),console.log(`✅ Generated ${q.length===1?"image-to-image":"merged"} result based on selection`)}else console.log("📝 Using Text-to-Image mode (no images selected)"),P=await Ze.generateImage({prompt:i,width:512,height:512}),console.log("✅ Generated image from text prompt:",P);else P=await Ze.generateImage({prompt:i,width:512,height:512}),console.log("Generated image from text prompt in",g,"tab:",P);const k=typeof P=="string"?P:P.url;await v(k),m(k),l("");const D=Date.now()-O;be.trackAIGeneration({type:z,template:y||void 0,hasSelection:Q,promptLength:i.length,processingTime:D}),be.trackEvent({action:"ai_generation_success",category:"AI Features",label:z,value:D,custom_parameters:{generation_successful:!0,processing_time_ms:D,template_used:y,ai_feature:"generation_completion"}})}catch(P){console.error("Image processing failed:",P),be.trackError(`AI generation failed: ${P}`,`${z}_generation`),alert(e.alerts.imageGenerationFailed+P)}finally{s(!1)}};return w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"flex h-full flex-col bg-gradient-to-br from-white to-purple-50 min-h-0",children:[w.jsx("div",{className:"p-3 border-b border-gray-200 bg-white/90 backdrop-blur-sm flex-shrink-0",children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("div",{className:"p-1.5 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg",children:w.jsx(Yh,{className:"w-4 h-4 text-white"})}),w.jsx("h3",{className:"text-sm font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:e.aiPanel.title})]}),w.jsx("div",{className:"flex items-center space-x-1",children:Q&&w.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${(ce=te[g])!=null&&ce.canUse?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"}`,children:["🖼️ ",q.length," ",e.aiPanel.selected]})})]})}),w.jsx("div",{className:"border-b border-gray-200 bg-white/90 backdrop-blur-sm flex-shrink-0",children:w.jsx("div",{className:"flex space-x-1 p-2",children:w.jsxs("button",{onClick:()=>o("generate"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${g==="generate"?"bg-purple-100 text-purple-700 border border-purple-300":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[w.jsx(Rt,{className:"w-4 h-4"}),w.jsx("span",{children:e.aiPanel.generate.tabs.generate})]})})}),w.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:[w.jsxs("div",{className:"p-3 md:p-4 flex-1 overflow-y-auto pb-safe",children:[!c&&w.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:w.jsxs("div",{className:"flex items-start space-x-2",children:[w.jsx(ei,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-medium text-amber-900 mb-1",children:e.settings.apiKeys.required}),w.jsx("p",{className:"text-xs text-amber-800",children:e.settings.importantNotice.description}),w.jsx("button",{onClick:t,className:"mt-2 text-xs px-3 py-1 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors",children:e.settings.apiKeys.openSettings})]})]})}),Q&&w.jsxs("div",{className:`mb-3 p-2 rounded-lg border ${(X=te[g])!=null&&X.canUse?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200"}`,children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("span",{className:"text-xs font-medium text-gray-700",children:["🖼️ ",q.length," ",q.length!==1?e.aiPanel.images:e.aiPanel.image," ",e.aiPanel.selectedFromCanvas]}),!((_=te[g])!=null&&_.canUse)&&w.jsxs("span",{className:"text-xs text-orange-600 font-medium",children:["⚠️ ",e.aiPanel.invalidFor," ",g]})]}),w.jsx("p",{className:"text-xs text-gray-600 mt-1",children:(j=te[g])==null?void 0:j.message})]}),g==="generate"&&w.jsxs("div",{className:"mb-3",children:[w.jsx("textarea",{value:i,onChange:O=>{l(O.target.value),x(null),E([])},placeholder:e.aiPanel.generate.placeholder,className:"w-full h-20 p-2 text-sm border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:h}),Q&&w.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["💡 ",e.aiPanel.selectedImagesNote]})]}),g==="generate"&&w.jsxs("div",{className:"space-y-3",children:[w.jsx("p",{className:"text-xs text-gray-600",children:Q?`${e.aiPanel.generateBasedOn} ${q.length} ${q.length!==1?e.aiPanel.selectedImages:e.aiPanel.selectedImage}`:e.aiPanel.generateWithGemini}),Q&&w.jsxs("div",{className:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 mb-3",children:[w.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[w.jsxs("span",{className:"text-sm font-bold text-blue-700",children:["🎨 ",e.aiPanel.imageToImageMode]}),w.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-200 text-blue-800 rounded-full",children:e.aiPanel.active})]}),w.jsx("p",{className:"text-xs text-blue-700",children:e.aiPanel.selectedImagesCombined})]}),w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("p",{className:"text-xs font-bold text-purple-700 flex items-center",children:["✨ ",e.aiPanel.generate.templates.title]}),Q&&w.jsx("span",{className:"text-xs text-blue-600 font-medium",children:e.aiPanel.generate.templates.withSelection})]}),w.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap",children:[w.jsx("button",{onClick:()=>b("all"),className:`px-2 py-1 text-xs rounded-full transition-all ${C==="all"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.all}),w.jsx("button",{onClick:()=>b("creative"),className:`px-2 py-1 text-xs rounded-full transition-all ${C==="creative"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.creative}),w.jsx("button",{onClick:()=>b("professional"),className:`px-2 py-1 text-xs rounded-full transition-all ${C==="professional"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.professional}),w.jsx("button",{onClick:()=>b("fun"),className:`px-2 py-1 text-xs rounded-full transition-all ${C==="fun"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.fun})]}),w.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-96 overflow-y-auto",children:Za.filter(O=>C==="all"||O.category===C).map(O=>{var z,P;return w.jsxs("button",{onClick:()=>{const k=wc(O.id,Q,n);l(k),x(O.id),be.trackTemplateUsage(O.id,O.category),be.trackFeatureUsage("template_selected",{template_id:O.id,template_category:O.category,has_selection:Q,timestamp:Date.now()})},className:`p-2 rounded-lg border text-left transition-all ${y===O.id?"bg-gradient-to-r from-orange-100 to-yellow-100 border-orange-400 ring-1 ring-orange-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[w.jsx("div",{className:"text-lg mb-1",children:O.icon}),w.jsx("div",{className:"text-xs font-bold text-gray-800",children:(z=e.aiPanel.generate.templates.items[O.id])==null?void 0:z.title}),w.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:(P=e.aiPanel.generate.templates.items[O.id])==null?void 0:P.description})]},O.id)})}),y&&w.jsx("div",{className:"p-2 bg-purple-50 rounded-lg border border-purple-200",children:w.jsx("p",{className:"text-xs text-purple-700",children:e.aiPanel.generate.templates.applied})})]}),w.jsxs("div",{className:"mt-2 p-2 bg-purple-50 rounded-lg",children:[w.jsxs("p",{className:"text-xs font-medium text-purple-700 mb-1",children:["✨ ",e.aiPanel.generate.quickEnhancements]}),w.jsx("div",{className:"flex flex-wrap gap-1",children:e.aiPanel.generate.enhancementItems.map(O=>{const z=T.includes(O);return w.jsx("button",{onClick:()=>{const P=z?T.filter(R=>R!==O):[...T,O];E(P);const k=i.split(",").filter(R=>!e.aiPanel.generate.enhancementItems.includes(R.trim())).join(",").trim(),D=k+(P.length>0?(k?", ":"")+P.join(", "):"");l(D)},className:`text-xs px-2 py-1 rounded border transition-all ${z?"bg-purple-200 border-purple-500 text-purple-800 ring-1 ring-purple-400":"bg-white hover:bg-purple-100 border-purple-300 text-gray-700"}`,children:O},O)})})]})]})]}),g==="generate"&&w.jsxs("div",{className:"sticky bottom-0 p-3 md:p-4 border-t border-gray-200 bg-white/98 backdrop-blur-sm flex-shrink-0 shadow-lg md:shadow-none",children:[w.jsx("button",{onClick:oe,disabled:h||!i.trim()||!((A=te[g])!=null&&A.canUse),className:"w-full py-4 md:py-3 px-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 active:from-purple-800 active:to-pink-800 disabled:from-gray-300 disabled:to-gray-400 text-white text-sm md:text-base rounded-xl transition-all flex items-center justify-center space-x-2 font-bold shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:scale-100 touch-manipulation",children:h?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"animate-spin rounded-full h-4 w-4 md:h-5 md:w-5 border-b-2 border-white"}),w.jsx("span",{children:e.aiPanel.generate.generating})]}):w.jsxs(w.Fragment,{children:[w.jsx(Rt,{className:"w-4 h-4 md:w-5 md:h-5"}),w.jsx("span",{children:e.aiPanel.generate.generateButton})]})}),w.jsx("div",{className:"md:hidden mt-2 text-center",children:w.jsx("p",{className:"text-xs text-gray-500",children:"🤖 由 Google Gemini 驅動的 AI 圖像生成"})})]})]}),L&&w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>F(null),children:w.jsx("div",{className:"bg-white rounded-xl p-4 max-w-md w-full mx-4",onClick:O=>O.stopPropagation(),children:(()=>{var z,P;const O=Za.find(k=>k.id===L);return O?w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"flex items-center justify-between mb-3",children:[w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx("div",{className:"text-2xl",children:O.icon}),w.jsx("h3",{className:"text-lg font-bold text-gray-800",children:(z=e.aiPanel.generate.templates.items[O.id])==null?void 0:z.title})]}),w.jsx("button",{onClick:()=>F(null),className:"text-gray-400 hover:text-gray-600 text-xl font-bold",children:"×"})]}),O.previewImage&&w.jsx("div",{className:"mb-3",children:w.jsx("img",{src:O.previewImage,alt:`${O.id} preview`,className:"w-full h-48 object-cover rounded-lg shadow-lg",loading:"lazy",onError:k=>{k.currentTarget.style.display="none"}})}),w.jsx("p",{className:"text-sm text-gray-600 mb-4",children:(P=e.aiPanel.generate.templates.items[O.id])==null?void 0:P.description}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("button",{onClick:()=>{const k=wc(O.id,Q,n);l(k),x(O.id),F(null)},className:"flex-1 py-2 px-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white text-sm rounded-lg transition-all font-medium",children:e.aiPanel.useTemplate}),w.jsx("button",{onClick:()=>F(null),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm rounded-lg transition-colors",children:e.aiPanel.close})]})]}):null})()})})]}),w.jsx(Zh,{isVisible:h,stage:u})]})},ed={enableCSP:!0,enableXSSProtection:!0,enableExtensionDetection:!0,strictMode:!0},cn=class cn{constructor(){ft(this,"isInitialized",!1)}static getInstance(){return cn.instance||(cn.instance=new cn),cn.instance}initializeCSP(e={}){if(this.isInitialized)return;const n={...ed,...e};if(!n.enableCSP)return;const c=["default-src 'self'","script-src 'self' 'unsafe-inline' 'unsafe-eval' https://vercel.live","style-src 'self' 'unsafe-inline' https://fonts.googleapis.com","font-src 'self' https://fonts.gstatic.com","img-src 'self' data: blob: https: http:","media-src 'self' data: blob: https:","connect-src 'self' https: wss: ws:","object-src 'none'","base-uri 'self'","form-action 'self'","frame-ancestors 'none'",n.strictMode?"upgrade-insecure-requests":""].filter(Boolean).join("; ");this.insertCSPMeta(c),this.setupCSPViolationReporting(),this.isInitialized=!0,console.log("🛡️ CSP initialized:",c)}insertCSPMeta(e){const n=document.createElement("meta");n.httpEquiv="Content-Security-Policy",n.content=e,document.head.appendChild(n)}setupCSPViolationReporting(){document.addEventListener("securitypolicyviolation",e=>{console.warn("🚨 CSP Violation detected:",{blockedURI:e.blockedURI,violatedDirective:e.violatedDirective,originalPolicy:e.originalPolicy,sourceFile:e.sourceFile,lineNumber:e.lineNumber}),this.reportViolation({type:"csp_violation",blockedURI:e.blockedURI,directive:e.violatedDirective,timestamp:Date.now(),userAgent:navigator.userAgent})})}reportViolation(e){}};ft(cn,"instance");let eo=cn;class Sc{static sanitizeHTML(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}static sanitizeURL(e){try{const n=new URL(e);if(!["http:","https:","data:"].includes(n.protocol))throw new Error("Invalid protocol");return n.toString()}catch{return""}}static sanitizeInput(e){return e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim()}static detectXSS(e){return[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe/gi,/<object/gi,/<embed/gi,/expression\s*\(/gi,/vbscript:/gi].some(c=>c.test(e))}static safeSetInnerHTML(e,n){if(this.detectXSS(n)){console.warn("🚨 XSS attempt blocked:",n.substring(0,100)),e.textContent="Content blocked for security reasons";return}e.innerHTML=this.sanitizeHTML(n)}}class Pn{static async detectExtensions(){const e=[];await this.checkForExtension("chrome-extension://fmkadmapgofadopljbjfkapdkoienihi/")&&e.push("React Developer Tools"),this.checkAdBlocker()&&e.push("Ad Blocker"),this.checkPasswordManager()&&e.push("Password Manager");const n=this.checkMaliciousIndicators();return n.length>0&&e.push(...n),this.detectedExtensions=new Set(e),e}static async checkForExtension(e){try{return(await fetch(e,{method:"HEAD"})).ok}catch{return!1}}static checkAdBlocker(){const e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",e.style.position="absolute",e.style.left="-10000px",document.body.appendChild(e);const n=e.offsetHeight===0;return document.body.removeChild(e),n}static checkPasswordManager(){return["data-lastpass-icon-root","data-dashlane-rid","_1PasswordExtension","bitwarden-browser-action-handler"].some(n=>document.querySelector(`[${n}]`)!==null)}static checkMaliciousIndicators(){const e=[];return["webpackChunkJsonp","__REACT_DEVTOOLS_GLOBAL_HOOK__"].forEach(c=>{window[c]&&typeof window[c]!="function"&&e.push(`Suspicious Global: ${c}`)}),this.checkDOMModification()&&e.push("Suspicious DOM Modification"),e}static checkDOMModification(){const e=document.scripts.length;return setTimeout(()=>{if(document.scripts.length>e+5)return console.warn("🚨 Suspicious script injection detected"),!0},1e3),!1}static getDetectedExtensions(){return Array.from(this.detectedExtensions)}static hasPotentialThreats(){return this.getDetectedExtensions().filter(n=>n.includes("Suspicious")||n.includes("Malicious")).length>0}}ft(Pn,"detectedExtensions",new Set);const un=class un{constructor(e={}){ft(this,"isInitialized",!1);ft(this,"config");this.config={...ed,...e}}static getInstance(e){return un.instance||(un.instance=new un(e)),un.instance}async initialize(){this.isInitialized||(console.log("🔒 Initializing OmniCanvas Security Manager..."),this.config.enableCSP&&eo.getInstance().initializeCSP(this.config),this.config.enableXSSProtection&&this.setupXSSProtection(),this.config.enableExtensionDetection&&await this.performExtensionDetection(),this.setupSecurityHeaders(),this.setupSecurityMonitoring(),this.isInitialized=!0,console.log("✅ Security Manager initialized successfully"))}setupXSSProtection(){document.addEventListener("input",e=>{const n=e.target;n.value&&Sc.detectXSS(n.value)&&(console.warn("🚨 XSS attempt detected in input field"),n.value=Sc.sanitizeInput(n.value))}),console.log("🛡️ XSS Protection enabled")}async performExtensionDetection(){try{const e=await Pn.detectExtensions();e.length>0&&(console.log("🔍 Browser extensions detected:",e),Pn.hasPotentialThreats()&&(console.warn("⚠️ Potential security threats detected!"),this.handleSecurityThreat("malicious_extension",e)))}catch(e){console.error("Extension detection failed:",e)}}setupSecurityHeaders(){window.self!==window.top&&console.warn("🚨 Application running in iframe - potential security risk"),this.config.strictMode&&document.addEventListener("contextmenu",e=>{e.preventDefault()})}setupSecurityMonitoring(){let e=0;const n=window.fetch;window.fetch=async(...c)=>(e++,e>100&&(console.warn("🚨 High frequency requests detected"),this.handleSecurityThreat("high_frequency_requests",{count:e})),n.apply(window,c)),console.log("👀 Security monitoring enabled")}handleSecurityThreat(e,n){const c={type:e,details:n,timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href};console.error("🚨 Security threat detected:",c)}getSecurityReport(){return{initialized:this.isInitialized,config:this.config,detectedExtensions:Pn.getDetectedExtensions(),hasPotentialThreats:Pn.hasPotentialThreats(),timestamp:Date.now()}}async performSecurityCheck(){console.log("🔍 Performing security check..."),await this.performExtensionDetection();const e=Pn.hasPotentialThreats();return console.log(e?"⚠️ Security issues found":"✅ Security check passed"),!e}};ft(un,"instance");let $i=un;const ip=async t=>{await $i.getInstance(t).initialize()},rp=()=>$i.getInstance().getSecurityReport(),sp=({className:t})=>{_n();const[e,n]=le.useState(null),[c,p]=le.useState(!1),[v,S]=le.useState(null),h=async()=>{p(!0);try{await $i.getInstance().performSecurityCheck();const l=rp();n(l),S(new Date)}catch(i){console.error("Failed to load security report:",i)}finally{p(!1)}};le.useEffect(()=>{h()},[]);const s=()=>e?e.hasPotentialThreats?"danger":e.detectedExtensions.length>5?"warning":"safe":"unknown",u=i=>{switch(i){case"safe":return"text-green-600 bg-green-100";case"warning":return"text-yellow-600 bg-yellow-100";case"danger":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},d=i=>{switch(i){case"safe":return Dg;case"warning":return ea;case"danger":return ea;default:return ti}},r=s(),a=d(r);return w.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 p-4 ${t}`,children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ti,{className:"w-5 h-5 text-blue-600"}),w.jsx("h3",{className:"font-semibold text-gray-800",children:"安全狀態"})]}),w.jsx("button",{onClick:h,disabled:c,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",title:"重新檢查",children:w.jsx(fc,{className:`w-4 h-4 ${c?"animate-spin":""}`})})]}),w.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg mb-4 ${u(r)}`,children:[w.jsx(a,{className:"w-5 h-5"}),w.jsxs("div",{children:[w.jsxs("div",{className:"font-medium",children:[r==="safe"&&"安全",r==="warning"&&"警告",r==="danger"&&"危險",r==="unknown"&&"檢查中..."]}),w.jsxs("div",{className:"text-xs opacity-75",children:[r==="safe"&&"系統狀態良好",r==="warning"&&"發現一些需要注意的項目",r==="danger"&&"檢測到潛在安全威脅",r==="unknown"&&"正在分析安全狀態..."]})]})]}),e&&w.jsxs("div",{className:"space-y-3",children:[w.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[w.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center",children:[w.jsx(Gg,{className:"w-4 h-4 mr-2"}),"安全配置"]}),w.jsxs("div",{className:"space-y-1 text-sm",children:[w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{className:"text-gray-600",children:"CSP 保護:"}),w.jsx("span",{className:e.config.enableCSP?"text-green-600":"text-red-600",children:e.config.enableCSP?"已啟用":"已停用"})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{className:"text-gray-600",children:"XSS 防護:"}),w.jsx("span",{className:e.config.enableXSSProtection?"text-green-600":"text-red-600",children:e.config.enableXSSProtection?"已啟用":"已停用"})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{className:"text-gray-600",children:"擴展檢測:"}),w.jsx("span",{className:e.config.enableExtensionDetection?"text-green-600":"text-red-600",children:e.config.enableExtensionDetection?"已啟用":"已停用"})]}),w.jsxs("div",{className:"flex justify-between",children:[w.jsx("span",{className:"text-gray-600",children:"嚴格模式:"}),w.jsx("span",{className:e.config.strictMode?"text-green-600":"text-yellow-600",children:e.config.strictMode?"已啟用":"已停用"})]})]})]}),e.detectedExtensions.length>0&&w.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[w.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center",children:[w.jsx(Gh,{className:"w-4 h-4 mr-2"}),"檢測到的瀏覽器擴展 (",e.detectedExtensions.length,")"]}),w.jsx("div",{className:"space-y-1 text-xs",children:e.detectedExtensions.map((i,l)=>w.jsx("div",{className:`p-2 rounded ${i.includes("Suspicious")||i.includes("Malicious")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:i},l))})]}),e.hasPotentialThreats&&w.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[w.jsxs("h4",{className:"font-medium text-red-800 mb-2 flex items-center",children:[w.jsx(ea,{className:"w-4 h-4 mr-2"}),"安全警告"]}),w.jsx("p",{className:"text-red-700 text-sm",children:"檢測到潛在的安全威脅。建議檢查瀏覽器擴展並確保只安裝可信任的軟件。"})]}),w.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[w.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"安全建議"}),w.jsxs("ul",{className:"text-blue-700 text-xs space-y-1",children:[w.jsx("li",{children:"• 定期檢查並移除不必要的瀏覽器擴展"}),w.jsx("li",{children:"• 確保 API Key 只在安全環境中使用"}),w.jsx("li",{children:"• 避免在公共網路中進行敏感操作"}),w.jsx("li",{children:"• 定期更新瀏覽器到最新版本"})]})]}),v&&w.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["最後檢查: ",v.toLocaleString()]})]}),c&&!e&&w.jsxs("div",{className:"flex items-center justify-center py-8",children:[w.jsx(fc,{className:"w-6 h-6 animate-spin text-blue-600"}),w.jsx("span",{className:"ml-2 text-gray-600",children:"正在檢查安全狀態..."})]})]})},Cc=[{version:"v1.0.0",date:"2025-10-25",type:"major",features:["🎨 無界創意畫布 - AI 驅動的線上創意平台","🤖 整合 Google Gemini AI 圖片生成","🖌️ 多功能繪圖工具 (筆刷、橡皮擦、選取)","📋 圖片複製貼上功能 (Ctrl+V)","🔧 完整的畫布操作 (縮放、拖移、重設)","🎯 智能物件選取與多選功能","📱 右鍵選單與快捷操作","🌍 多語言支援 (繁中、簡中、英文、日文)","🔐 用戶自有 API 密鑰系統","🛡️ 完整的安全防護機制"],improvements:["響應式設計適配各種螢幕尺寸","高效能畫布渲染與記憶體管理","直觀的用戶介面與操作體驗"]}],ap=()=>{const t=c=>{switch(c){case"major":return w.jsx(Rt,{className:"w-4 h-4 text-purple-500"});case"minor":return w.jsx(gc,{className:"w-4 h-4 text-blue-500"});case"patch":return w.jsx(ti,{className:"w-4 h-4 text-green-500"})}},e=c=>{switch(c){case"major":return"bg-purple-100 text-purple-800 border-purple-200";case"minor":return"bg-blue-100 text-blue-800 border-blue-200";case"patch":return"bg-green-100 text-green-800 border-green-200"}},n=c=>{switch(c){case"major":return"重大版本";case"minor":return"功能更新";case"patch":return"修復更新"}};return w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[w.jsx(Wh,{className:"w-5 h-5 text-blue-600"}),w.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"版本歷史"}),w.jsx("span",{className:"text-sm text-gray-500",children:"OmniCanvas 更新記錄"})]}),w.jsx("div",{className:"space-y-6",children:Cc.map((c,p)=>w.jsxs("div",{className:"relative",children:[p<Cc.length-1&&w.jsx("div",{className:"absolute left-6 top-12 w-px h-full bg-gray-200"}),w.jsx("div",{className:"bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow",children:w.jsxs("div",{className:"p-6",children:[w.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[w.jsx("div",{className:"flex items-center justify-center w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full text-white font-bold relative z-10",children:t(c.type)}),w.jsxs("div",{className:"flex-1",children:[w.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[w.jsx("h4",{className:"text-xl font-bold text-gray-900",children:c.version}),w.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${e(c.type)}`,children:n(c.type)})]}),w.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[w.jsx(Lg,{className:"w-4 h-4"}),w.jsx("span",{children:c.date})]})]})]}),w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{children:[w.jsxs("h5",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[w.jsx(Rt,{className:"w-4 h-4 text-yellow-500"}),"新功能"]}),w.jsx("ul",{className:"space-y-1",children:c.features.map((v,S)=>w.jsxs("li",{className:"text-sm text-gray-700 flex items-start gap-2",children:[w.jsx("span",{className:"text-green-500 font-bold mt-0.5",children:"•"}),w.jsx("span",{children:v})]},S))})]}),c.improvements&&c.improvements.length>0&&w.jsxs("div",{children:[w.jsxs("h5",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[w.jsx(gc,{className:"w-4 h-4 text-blue-500"}),"改進優化"]}),w.jsx("ul",{className:"space-y-1",children:c.improvements.map((v,S)=>w.jsxs("li",{className:"text-sm text-gray-700 flex items-start gap-2",children:[w.jsx("span",{className:"text-blue-500 font-bold mt-0.5",children:"•"}),w.jsx("span",{children:v})]},S))})]}),c.fixes&&c.fixes.length>0&&w.jsxs("div",{children:[w.jsxs("h5",{className:"font-semibold text-gray-800 mb-2 flex items-center gap-2",children:[w.jsx(ti,{className:"w-4 h-4 text-green-500"}),"錯誤修復"]}),w.jsx("ul",{className:"space-y-1",children:c.fixes.map((v,S)=>w.jsxs("li",{className:"text-sm text-gray-700 flex items-start gap-2",children:[w.jsx("span",{className:"text-green-500 font-bold mt-0.5",children:"•"}),w.jsx("span",{children:v})]},S))})]})]})]})})]},c.version))}),w.jsx("div",{className:"text-center py-6 border-t border-gray-200",children:w.jsx("p",{className:"text-sm text-gray-500",children:"OmniCanvas 持續開發中，更多功能即將推出 🚀"})})]})},op=({isOpen:t,setIsOpen:e})=>{const{currentLanguage:n}=er(),c=el(n),{apiKeys:p,setAPIKey:v,removeAPIKey:S,validateAPIKey:h,getObfuscatedKey:s,isConfigured:u}=Zo(),[d,r]=le.useState({}),[a,i]=le.useState({}),[l,g]=le.useState({}),[o,f]=le.useState("apikeys");le.useEffect(()=>{r(p);const b={};Object.keys(p).forEach(T=>{b[T]="unchecked"}),g(b)},[p]);const m=(b,T)=>{r(E=>({...E,[b]:T})),g(E=>({...E,[b]:"unchecked"}))},y=async b=>{const T=d[b];if(!T){S(b),g(L=>({...L,[b]:"unchecked"}));return}await h(b,T)?(v(b,T),g(L=>({...L,[b]:"valid"}))):g(L=>({...L,[b]:"invalid"}))},x=b=>{i(T=>({...T,[b]:!T[b]}))},C=[{key:"gemini",name:c.settings.apiKeys.services.gemini.name,placeholder:c.settings.apiKeys.services.gemini.placeholder,description:c.settings.apiKeys.services.gemini.description,required:!0}];return w.jsx(w.Fragment,{children:t&&w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>e(!1)}),w.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsxs("div",{className:"flex items-center space-x-2",children:[w.jsx(ei,{className:"w-5 h-5 text-blue-600"}),w.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c.settings.title})]}),w.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-gray-600",children:w.jsx(as,{className:"w-5 h-5"})})]}),w.jsxs("div",{className:"flex space-x-1 border-b border-gray-200 mb-4",children:[w.jsxs("button",{onClick:()=>f("apikeys"),className:`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${o==="apikeys"?"bg-blue-50 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"}`,children:[w.jsx(uc,{className:"w-4 h-4 inline mr-2"}),"API 金鑰"]}),w.jsxs("button",{onClick:()=>f("security"),className:`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${o==="security"?"bg-blue-50 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"}`,children:[w.jsx(ti,{className:"w-4 h-4 inline mr-2"}),"安全狀態"]}),w.jsxs("button",{onClick:()=>f("version"),className:`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${o==="version"?"bg-blue-50 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"}`,children:[w.jsx(Wh,{className:"w-4 h-4 inline mr-2"}),"版本歷史"]})]}),w.jsxs("div",{className:"space-y-4",children:[o==="apikeys"&&w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:w.jsxs("div",{className:"flex items-start",children:[w.jsx(Rh,{className:"w-5 h-5 text-amber-600 mr-2 flex-shrink-0 mt-0.5"}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-medium text-amber-900 mb-1",children:c.settings.importantNotice.title}),w.jsx("p",{className:"text-xs text-amber-800",children:c.settings.importantNotice.description})]})]})}),w.jsxs("div",{className:"space-y-4",children:[w.jsxs("h3",{className:"text-sm font-semibold text-gray-900 flex items-center",children:[w.jsx(uc,{className:"w-4 h-4 mr-2"}),c.settings.apiKeys.title]}),C.map(b=>w.jsxs("div",{className:"space-y-2 p-4 bg-gray-50 rounded-lg",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[b.name,b.required&&w.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),l[b.key]==="valid"&&w.jsxs("span",{className:"text-xs text-green-600 flex items-center",children:[w.jsx(Bh,{className:"w-3 h-3 mr-1"})," ",c.settings.apiKeys.valid]}),l[b.key]==="invalid"&&w.jsxs("span",{className:"text-xs text-red-600 flex items-center",children:[w.jsx(as,{className:"w-3 h-3 mr-1"})," ",c.settings.apiKeys.invalid]})]}),w.jsx("p",{className:"text-xs text-gray-600",children:b.description}),w.jsxs("div",{className:"flex space-x-2",children:[w.jsxs("div",{className:"flex-1 relative",children:[w.jsx("input",{type:a[b.key]?"text":"password",value:d[b.key]||"",onChange:T=>m(b.key,T.target.value),onKeyDown:T=>{(T.metaKey||T.ctrlKey)&&T.key==="v"&&(T.preventDefault(),navigator.clipboard.readText().then(E=>{m(b.key,E)}).catch(()=>{T.preventDefault=()=>{}}))},placeholder:b.placeholder,className:"w-full text-sm border border-gray-300 rounded px-3 py-2 pr-10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoComplete:"off"}),w.jsx("button",{type:"button",onClick:()=>x(b.key),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:a[b.key]?w.jsx(zg,{className:"w-4 h-4"}):w.jsx(Gh,{className:"w-4 h-4"})})]}),w.jsx("button",{onClick:()=>y(b.key),className:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center",children:w.jsx(Zg,{className:"w-4 h-4"})})]}),p[b.key]&&w.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.settings.apiKeys.current,": ",s(b.key)]})]},b.key))]}),w.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[w.jsxs("div",{className:"flex items-center justify-between mb-2",children:[w.jsx("h3",{className:"text-sm font-medium text-blue-900",children:c.settings.gettingStarted.title}),w.jsxs("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors",children:[c.settings.gettingStarted.getApiKeyButton,w.jsx(Rg,{className:"w-3 h-3 ml-1"})]})]}),w.jsx("ol",{className:"text-xs text-blue-800 space-y-1",children:c.settings.gettingStarted.steps.map((b,T)=>w.jsxs("li",{children:[T+1,". ",b]},T))})]}),w.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[w.jsxs("h3",{className:"text-sm font-medium text-green-900 mb-2 flex items-center",children:[w.jsx(ti,{className:"w-4 h-4 mr-2"}),c.settings.security.title]}),w.jsx("ul",{className:"text-xs text-green-800 space-y-1",children:c.settings.security.benefits.map((b,T)=>w.jsxs("li",{children:["• ",b]},T))})]})]}),o==="security"&&w.jsx(sp,{}),o==="version"&&w.jsx(ap,{}),w.jsx("div",{className:"flex justify-end space-x-2 pt-4",children:w.jsx("button",{onClick:()=>e(!1),className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:c.common.close})})]})]})]})})},lp=({onOpenSettings:t,onOpenAIPanel:e,onClose:n})=>{const c=_n(),[p,v]=le.useState("overview"),S=d=>{v(p===d?null:d)},h=d=>{switch(d){case"open_settings":t==null||t(),n==null||n();break;case"open_ai_panel":e==null||e(),n==null||n();break;default:console.log("Unknown action:",d)}},s=[{id:"overview",icon:rs,title:c.serviceGuide.overview.title,content:[{title:c.serviceGuide.overview.whatIs.title,description:c.serviceGuide.overview.whatIs.description,features:[c.serviceGuide.overview.whatIs.features.unlimited,c.serviceGuide.overview.whatIs.features.aiPowered,c.serviceGuide.overview.whatIs.features.multilingual,c.serviceGuide.overview.whatIs.features.privacy]}]},{id:"aiGeneration",icon:Rt,title:c.serviceGuide.aiGeneration.title,content:[{title:c.serviceGuide.aiGeneration.textToImage.title,description:c.serviceGuide.aiGeneration.textToImage.description,steps:[c.serviceGuide.aiGeneration.textToImage.steps.openPanel,c.serviceGuide.aiGeneration.textToImage.steps.writePrompt,c.serviceGuide.aiGeneration.textToImage.steps.selectTemplate,c.serviceGuide.aiGeneration.textToImage.steps.generate]},{title:"專業模板功能",description:"使用內建的專業模板快速實現常見需求，包括背景移除和品質增強等功能",features:["✂️ 背景移除模板 - 一鍵去除圖片背景","✨ 品質增強模板 - 提升圖片清晰度和細節","📷 證件照模板 - 專業證件照製作","📦 產品攝影模板 - 電商產品圖片優化"]},{title:c.serviceGuide.aiGeneration.imageToImage.title,description:c.serviceGuide.aiGeneration.imageToImage.description,steps:[c.serviceGuide.aiGeneration.imageToImage.steps.selectImages,c.serviceGuide.aiGeneration.imageToImage.steps.openPanel,c.serviceGuide.aiGeneration.imageToImage.steps.writePrompt,c.serviceGuide.aiGeneration.imageToImage.steps.generate]}]},{id:"canvas",icon:Vh,title:c.serviceGuide.canvas.title,content:[{title:c.serviceGuide.canvas.navigation.title,description:c.serviceGuide.canvas.navigation.description,controls:[{key:c.serviceGuide.canvas.navigation.controls.zoom,value:"Ctrl/Cmd + 滾輪"},{key:c.serviceGuide.canvas.navigation.controls.pan,value:"觸控板 / Shift + 拖曳"},{key:c.serviceGuide.canvas.navigation.controls.select,value:"點擊選取"},{key:c.serviceGuide.canvas.navigation.controls.multiSelect,value:"Ctrl/Cmd + 點擊"}]},{title:c.serviceGuide.canvas.layers.title,description:c.serviceGuide.canvas.layers.description,features:[c.serviceGuide.canvas.layers.features.unlimited,c.serviceGuide.canvas.layers.features.visibility,c.serviceGuide.canvas.layers.features.reorder,c.serviceGuide.canvas.layers.features.lock]}]},{id:"contextMenu",icon:qg,title:c.serviceGuide.contextMenu.title,content:[{title:c.serviceGuide.contextMenu.smartCompose.title,description:c.serviceGuide.contextMenu.smartCompose.description,options:[c.serviceGuide.contextMenu.smartCompose.options.intelligent,c.serviceGuide.contextMenu.smartCompose.options.accessory,c.serviceGuide.contextMenu.smartCompose.options.scene,c.serviceGuide.contextMenu.smartCompose.options.creative]},{title:c.serviceGuide.contextMenu.voiceCommand.title,description:c.serviceGuide.contextMenu.voiceCommand.description,features:[c.serviceGuide.contextMenu.voiceCommand.features.multilingual,c.serviceGuide.contextMenu.voiceCommand.features.intelligent,c.serviceGuide.contextMenu.voiceCommand.features.realtime]}]},{id:"settings",icon:ei,title:c.serviceGuide.settings.title,content:[{title:c.serviceGuide.settings.apiKey.title,description:c.serviceGuide.settings.apiKey.description,steps:[c.serviceGuide.settings.apiKey.steps.getKey,c.serviceGuide.settings.apiKey.steps.openSettings,c.serviceGuide.settings.apiKey.steps.enterKey,c.serviceGuide.settings.apiKey.steps.save]},{title:c.serviceGuide.settings.language.title,description:c.serviceGuide.settings.language.description,languages:["繁體中文","English","日本語","Español","Français"]}]}],u=[{icon:ei,title:c.serviceGuide.quickActions.settings,description:c.serviceGuide.quickActions.settingsDesc,action:"open_settings"},{icon:Rt,title:c.serviceGuide.quickActions.generate,description:c.serviceGuide.quickActions.generateDesc,action:"open_ai_panel"}];return w.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-white to-blue-50",children:[w.jsx("div",{className:"p-3 md:p-4 border-b border-gray-200 bg-white/90 backdrop-blur-sm",children:w.jsxs("div",{className:"flex items-center space-x-3",children:[w.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:w.jsx(rs,{className:"w-4 h-4 md:w-5 md:h-5 text-white"})}),w.jsxs("div",{children:[w.jsx("h2",{className:"text-base md:text-lg font-bold text-gray-800",children:c.serviceGuide.title}),w.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:c.serviceGuide.subtitle})]})]})}),w.jsxs("div",{className:"flex-1 overflow-y-auto",children:[w.jsxs("div",{className:"p-3 md:p-4 border-b border-gray-100",children:[w.jsxs("h3",{className:"text-sm font-bold text-gray-800 mb-3 flex items-center",children:[w.jsx(Xh,{className:"w-4 h-4 mr-2 text-green-600"}),c.serviceGuide.quickStart]}),w.jsx("div",{className:"grid grid-cols-1 gap-3",children:u.map((d,r)=>w.jsx("button",{onClick:()=>h(d.action),className:"p-4 bg-white border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all text-left group active:bg-blue-100 touch-manipulation",children:w.jsxs("div",{className:"flex items-start space-x-3",children:[w.jsx(d.icon,{className:"w-5 h-5 text-blue-600 mt-0.5 group-hover:text-blue-700 flex-shrink-0"}),w.jsxs("div",{className:"min-w-0 flex-1",children:[w.jsx("div",{className:"text-sm font-medium text-gray-800 group-hover:text-blue-800 leading-5",children:d.title}),w.jsx("div",{className:"text-xs text-gray-600 group-hover:text-blue-600 mt-1 leading-4",children:d.description})]})]})},r))})]}),w.jsx("div",{className:"p-3 md:p-4 space-y-3",children:s.map(d=>w.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[w.jsx("button",{onClick:()=>S(d.id),className:"w-full p-4 text-left hover:bg-gray-50 transition-colors active:bg-gray-100 touch-manipulation",children:w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[w.jsx(d.icon,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),w.jsx("span",{className:"font-medium text-gray-800 text-sm md:text-base truncate",children:d.title})]}),p===d.id?w.jsx(Ng,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):w.jsx(Fg,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})}),p===d.id&&w.jsx("div",{className:"px-3 md:px-4 pb-4 border-t border-gray-100",children:d.content.map((r,a)=>w.jsxs("div",{className:"mt-4",children:[w.jsx("h4",{className:"font-medium text-gray-800 mb-3 text-sm md:text-base",children:r.title}),w.jsx("p",{className:"text-xs md:text-sm text-gray-600 mb-3 leading-relaxed",children:r.description}),r.features&&w.jsx("ul",{className:"space-y-3",children:r.features.map((i,l)=>w.jsxs("li",{className:"flex items-start space-x-3 text-xs md:text-sm text-gray-600",children:[w.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),w.jsx("span",{className:"leading-relaxed",children:i})]},l))}),r.steps&&w.jsx("ol",{className:"space-y-3",children:r.steps.map((i,l)=>w.jsxs("li",{className:"flex items-start space-x-3 text-xs md:text-sm text-gray-600",children:[w.jsx("span",{className:"w-6 h-6 bg-blue-100 text-blue-600 rounded-full text-xs flex items-center justify-center font-medium flex-shrink-0",children:l+1}),w.jsx("span",{className:"leading-relaxed pt-0.5",children:i})]},l))}),r.controls&&w.jsx("div",{className:"space-y-3",children:r.controls.map((i,l)=>w.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 space-y-1 sm:space-y-0",children:[w.jsx("span",{className:"text-xs md:text-sm text-gray-600 font-medium",children:i.key}),w.jsx("code",{className:"text-xs bg-gray-100 px-3 py-2 rounded font-mono self-start sm:self-auto",children:i.value})]},l))}),r.options&&w.jsx("div",{className:"grid grid-cols-1 gap-3 mt-3",children:r.options.map((i,l)=>w.jsx("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:w.jsx("span",{className:"text-xs md:text-sm text-blue-800 leading-relaxed",children:i})},l))}),r.languages&&w.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:r.languages.map((i,l)=>w.jsx("span",{className:"px-3 py-2 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:i},l))})]},a))})]},d.id))}),w.jsx("div",{className:"p-4 bg-gradient-to-r from-purple-50 to-blue-50 border-t border-gray-200",children:w.jsxs("div",{className:"flex items-start space-x-3",children:[w.jsx(Ug,{className:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),w.jsxs("div",{className:"min-w-0 flex-1",children:[w.jsx("h3",{className:"text-sm font-medium text-purple-800 mb-2",children:c.serviceGuide.needHelp.title}),w.jsx("p",{className:"text-xs text-purple-600 mb-4 leading-relaxed",children:c.serviceGuide.needHelp.description}),w.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[w.jsx("button",{onClick:()=>window.location.href="mailto:joeylaijal@gmail.com",className:"px-4 py-2 bg-purple-600 text-white text-xs font-medium rounded-lg hover:bg-purple-700 transition-colors active:bg-purple-800 touch-manipulation",children:c.serviceGuide.needHelp.contact}),w.jsx("button",{className:"px-4 py-2 bg-white text-purple-600 text-xs font-medium rounded-lg border border-purple-200 hover:bg-purple-50 transition-colors active:bg-purple-100 touch-manipulation",children:c.serviceGuide.needHelp.community})]}),w.jsx("p",{className:"text-xs text-purple-500 mt-3 break-all",children:"Support: joeylaijal@gmail.com"})]})]})})]})]})},mi="omnicanvas-favorites",cp=ai((t,e)=>({favorites:[],loadFavorites:()=>{try{const n=localStorage.getItem(mi);if(n){const c=JSON.parse(n);t({favorites:c}),console.log("✅ Favorites loaded:",c.length)}}catch(n){console.error("❌ Failed to load favorites:",n)}},addFavorite:(n,c,p)=>{const v=`fav_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,S=Date.now(),h={id:v,name:p||`Saved Canvas ${new Date().toLocaleDateString()}`,canvasData:n,thumbnail:c,createdAt:S,updatedAt:S};return t(s=>{const u=[...s.favorites,h];try{localStorage.setItem(mi,JSON.stringify(u))}catch(d){console.error("❌ Failed to save favorite:",d)}return{favorites:u}}),console.log("✅ Favorite added:",v),v},updateFavorite:(n,c,p,v)=>{t(S=>{const h=S.favorites.map(s=>s.id===n?{...s,canvasData:c,thumbnail:p,name:v||s.name,updatedAt:Date.now()}:s);try{localStorage.setItem(mi,JSON.stringify(h))}catch(s){console.error("❌ Failed to update favorite:",s)}return{favorites:h}}),console.log("✅ Favorite updated:",n)},removeFavorite:n=>{t(c=>{const p=c.favorites.filter(v=>v.id!==n);try{localStorage.setItem(mi,JSON.stringify(p))}catch(v){console.error("❌ Failed to remove favorite:",v)}return{favorites:p}}),console.log("✅ Favorite removed:",n)},getFavorite:n=>e().favorites.find(c=>c.id===n),getFavorites:()=>e().favorites,clearAllFavorites:()=>{try{localStorage.removeItem(mi),t({favorites:[]}),console.log("✅ All favorites cleared")}catch(n){console.error("❌ Failed to clear favorites:",n)}}})),up=({isOpen:t,onClose:e})=>{const{favorites:n,loadFavorites:c,removeFavorite:p,addFavorite:v}=cp(),{canvas:S}=pn(),[h,s]=le.useState(null),[u,d]=le.useState(null);if(le.useEffect(()=>{c()},[c]),!t)return null;const r=()=>{if(!S){alert("Canvas is empty. Please create something first.");return}try{const o=JSON.stringify(S.toJSON(["backgroundColor"])),f=S.toDataURL({format:"png",multiplier:.15}),y=`Saved at ${new Date().toLocaleString("zh-CN")}`;v(o,f,y),be.trackFeatureUsage("favorite_saved",{favorite_count:n.length+1})}catch(o){console.error("Failed to save favorite:",o),alert("Failed to save favorite")}},a=async o=>{if(S)try{const f=JSON.parse(o.canvasData);S.loadFromJSON(f,()=>{S.renderAll(),be.trackFeatureUsage("favorite_loaded",{favorite_id:o.id,name:o.name}),e()})}catch(f){console.error("Failed to load favorite:",f),alert("Failed to load favorite")}},i=async o=>{if(S)try{const f=JSON.parse(o.canvasData);S.loadFromJSON(f,()=>{S.getObjects().forEach((m,y)=>{y>0&&m.set({left:(m.left||0)+20,top:(m.top||0)+20})}),S.renderAll(),d(o.id),be.trackFeatureUsage("favorite_copied",{favorite_id:o.id,name:o.name}),setTimeout(()=>d(null),2e3)})}catch(f){console.error("Failed to copy favorite:",f),alert("Failed to copy favorite")}},l=o=>{confirm("Are you sure you want to delete this favorite?")&&(p(o),be.trackFeatureUsage("favorite_deleted",{favorite_id:o}))},g=o=>{try{const f=document.createElement("a");f.href=o.thumbnail,f.download=`${o.name.replace(/\s+/g,"-")}.png`,document.body.appendChild(f),f.click(),document.body.removeChild(f),be.trackFeatureUsage("favorite_downloaded",{favorite_id:o.id,name:o.name})}catch(f){console.error("Failed to download favorite:",f)}};return w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:w.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[w.jsxs("div",{className:"bg-gradient-to-r from-red-500 to-pink-500 px-6 py-4 flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx(ss,{className:"w-6 h-6 text-white",fill:"white"}),w.jsx("h2",{className:"text-white text-xl font-bold",children:"My Favorites"}),w.jsx("span",{className:"bg-white bg-opacity-30 text-white px-3 py-1 rounded-full text-sm",children:n.length})]}),w.jsx("button",{onClick:e,className:"text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-lg transition",children:"✕"})]}),w.jsx("div",{className:"flex-1 overflow-auto p-6",children:n.length===0?w.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500",children:[w.jsx(ss,{className:"w-12 h-12 mb-4 text-gray-300"}),w.jsx("p",{className:"text-lg font-semibold mb-2",children:"No favorites yet"}),w.jsx("p",{className:"text-sm",children:"Save your current canvas to create your first favorite"})]}):w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:n.map(o=>w.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition",children:[w.jsxs("div",{className:"relative bg-gray-100 aspect-video overflow-hidden",children:[w.jsx("img",{src:o.thumbnail,alt:o.name,className:"w-full h-full object-contain"}),w.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition flex items-center justify-center gap-2",children:(h==null?void 0:h.id)===o.id&&w.jsx("button",{onClick:()=>a(o),className:"bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-blue-600 transition",children:"Load"})})]}),w.jsxs("div",{className:"p-4",children:[w.jsx("h3",{className:"font-semibold text-gray-800 truncate mb-1",children:o.name}),w.jsxs("p",{className:"text-xs text-gray-500 mb-3",children:["Saved ",new Date(o.createdAt).toLocaleDateString()]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("button",{onClick:()=>s(o),className:"flex-1 bg-blue-50 text-blue-600 px-2 py-2 rounded text-xs font-semibold hover:bg-blue-100 transition flex items-center justify-center gap-1",children:(h==null?void 0:h.id)===o.id?"📂 Selected":"📂 Select"}),w.jsxs("button",{onClick:()=>i(o),className:`flex-1 px-2 py-2 rounded text-xs font-semibold transition flex items-center justify-center gap-1 ${u===o.id?"bg-green-100 text-green-600":"bg-green-50 text-green-600 hover:bg-green-100"}`,children:[w.jsx(qo,{className:"w-3 h-3"}),u===o.id?"Copied!":"Copy"]}),w.jsx("button",{onClick:()=>g(o),className:"px-2 py-2 rounded bg-gray-50 text-gray-600 text-xs font-semibold hover:bg-gray-100 transition flex items-center justify-center",children:w.jsx(Uh,{className:"w-3 h-3"})}),w.jsx("button",{onClick:()=>l(o.id),className:"px-2 py-2 rounded bg-red-50 text-red-600 text-xs font-semibold hover:bg-red-100 transition flex items-center justify-center",children:w.jsx(Qo,{className:"w-3 h-3"})})]})]})]},o.id))})}),w.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4 flex gap-3",children:[w.jsxs("button",{onClick:r,disabled:!S,className:"flex-1 bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition disabled:bg-gray-300 flex items-center justify-center gap-2",children:[w.jsx(Qg,{className:"w-4 h-4"}),"Save Current Canvas"]}),w.jsx("button",{onClick:e,className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400 transition",children:"Close"})]})]})})},ra="https://omnicanvas-backend.vercel.app/api",hp=ai((t,e)=>({sharedCanvases:new Map,createShare:async(n,c,p="Anonymous")=>{try{const v=await fetch(`${ra}/shares`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({canvasData:n,thumbnail:c,creatorName:p,createdAt:Date.now()})});if(!v.ok)throw new Error(`Failed to create share: ${v.statusText}`);const S=await v.json(),h=S.id||S.shareId;return console.log("✅ Share created:",h),h}catch(v){return console.error("❌ Failed to create share:",v),e().createLocalShare(n,c,p)}},getShare:async n=>{try{const c=e().sharedCanvases.get(n);if(c)return c;const p=await fetch(`${ra}/shares/${n}`);if(!p.ok){if(p.status===404)return null;throw new Error(`Failed to fetch share: ${p.statusText}`)}const v=await p.json();return e().sharedCanvases.set(n,v),console.log("✅ Share fetched:",n),v}catch(c){return console.error("❌ Failed to fetch share:",c),null}},deleteShare:async n=>{try{const c=await fetch(`${ra}/shares/${n}`,{method:"DELETE"});if(!c.ok)throw new Error(`Failed to delete share: ${c.statusText}`);e().sharedCanvases.delete(n),console.log("✅ Share deleted:",n)}catch(c){console.error("❌ Failed to delete share:",c)}},getShareUrl:n=>`${window.location.origin}/share/${n}`,createLocalShare:(n,c,p)=>{const v=`share_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,S={id:v,canvasData:n,thumbnail:c,creatorName:p,createdAt:Date.now(),viewCount:0};return e().sharedCanvases.set(v,S),v}})),dp=({isOpen:t,onClose:e})=>{const{canvas:n}=pn(),{createShare:c,getShareUrl:p}=hp(),[v,S]=le.useState(null),[h,s]=le.useState(!1),[u,d]=le.useState(!1),[r,a]=le.useState(null),[i,l]=le.useState("");if(!t)return null;const g=async()=>{if(!n){a("Canvas is empty. Please create something first.");return}d(!0),a(null);try{const m=JSON.stringify(n.toJSON(["backgroundColor"])),y=n.toDataURL({format:"png",multiplier:.2}),x=await c(m,y,i||"Anonymous"),C=p(x);S(C),be.trackFeatureUsage("share_created",{share_id:x,creator_name:i||"anonymous"})}catch(m){const y=m instanceof Error?m.message:"Failed to create share link";a(y),console.error("Failed to create share:",m)}finally{d(!1)}},o=()=>{v&&navigator.clipboard.writeText(v).then(()=>{s(!0),be.trackFeatureUsage("share_link_copied",{share_url:v}),setTimeout(()=>s(!1),2e3)})},f=()=>{v&&(window.open(v,"_blank"),be.trackFeatureUsage("share_link_opened",{share_url:v}))};return w.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:w.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-11/12 max-w-md overflow-hidden",children:[w.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-500 px-6 py-4 flex items-center justify-between",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx(Oi,{className:"w-6 h-6 text-white"}),w.jsx("h2",{className:"text-white text-xl font-bold",children:"Share Canvas"})]}),w.jsx("button",{onClick:e,className:"text-white hover:bg-white hover:bg-opacity-20 p-2 rounded-lg transition",children:"✕"})]}),w.jsxs("div",{className:"p-6 space-y-4",children:[w.jsxs("div",{children:[w.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Your Name (optional)"}),w.jsx("input",{type:"text",value:i,onChange:m=>l(m.target.value),placeholder:"e.g., John Doe",disabled:!!v,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),!v&&w.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 flex gap-3",children:[w.jsx(Hg,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold text-blue-900",children:"Shareable Link"}),w.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Generate a public link to let others view and copy your canvas"})]})]}),r&&w.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex gap-3",children:[w.jsx(Rh,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),w.jsxs("div",{children:[w.jsx("p",{className:"text-sm font-semibold text-red-900",children:"Error"}),w.jsx("p",{className:"text-xs text-red-700 mt-1",children:r})]})]}),v&&w.jsxs("div",{className:"bg-gray-50 border border-gray-300 rounded-lg p-4",children:[w.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"Your Share Link:"}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("input",{type:"text",value:v,readOnly:!0,className:"flex-1 px-3 py-2 text-sm bg-white border border-gray-300 rounded font-mono text-xs overflow-x-auto"}),w.jsx("button",{onClick:o,className:`px-3 py-2 rounded font-semibold text-sm transition flex items-center gap-2 ${h?"bg-green-500 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}`,children:h?w.jsxs(w.Fragment,{children:[w.jsx(Bh,{className:"w-4 h-4"}),"Copied!"]}):w.jsxs(w.Fragment,{children:[w.jsx(qo,{className:"w-4 h-4"}),"Copy"]})})]})]}),v&&i&&w.jsxs("div",{className:"text-sm text-gray-600",children:[w.jsxs("p",{className:"font-semibold",children:["Created by: ",i]}),w.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date().toLocaleDateString()})]})]}),w.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 px-6 py-4 flex gap-3",children:[v?w.jsxs(w.Fragment,{children:[w.jsxs("button",{onClick:f,className:"flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition flex items-center justify-center gap-2",children:[w.jsx(Oi,{className:"w-4 h-4"}),"Open Link"]}),w.jsx("button",{onClick:()=>{S(null),l(""),a(null)},className:"flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-400 transition",children:"Create Another"})]}):w.jsx("button",{onClick:g,disabled:u,className:"flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:u?w.jsxs(w.Fragment,{children:[w.jsx(Vg,{className:"w-4 h-4 animate-spin"}),"Generating..."]}):w.jsxs(w.Fragment,{children:[w.jsx(Oi,{className:"w-4 h-4"}),"Generate Link"]})}),w.jsx("button",{onClick:e,className:"flex-1 bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 transition",children:"Close"})]})]})})},bc=()=>{const{currentLanguage:t,setLanguage:e}=er(),[n,c]=le.useState(!1),p=el(t),v=[{code:"en",flag:"🇺🇸",name:p.language.en},{code:"zh-TW",flag:"🇹🇼",name:p.language.zhTW},{code:"es",flag:"🇪🇸",name:p.language.es},{code:"ja",flag:"🇯🇵",name:p.language.ja},{code:"fr",flag:"🇫🇷",name:p.language.fr}],S=v.find(h=>h.code===t)||v[0];return w.jsxs("div",{className:"relative",children:[w.jsxs("button",{onClick:()=>c(!n),className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200",children:[w.jsx(Bg,{className:"w-4 h-4"}),w.jsx("span",{className:"text-lg",children:S.flag}),w.jsx("span",{className:"hidden sm:inline",children:S.name}),w.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),w.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-20 overflow-hidden",children:v.map(h=>w.jsxs("button",{onClick:()=>{e(h.code),c(!1)},className:`w-full flex items-center space-x-3 px-4 py-3 text-sm hover:bg-gray-50 transition-colors duration-150 ${t===h.code?"bg-blue-50 text-blue-700 border-r-4 border-blue-500":"text-gray-700"}`,children:[w.jsx("span",{className:"text-lg",children:h.flag}),w.jsx("span",{className:"font-medium",children:h.name}),t===h.code&&w.jsx("div",{className:"ml-auto w-2 h-2 bg-blue-500 rounded-full"})]},h.code))})]})]})};function fp(){const t=_n(),{initializeLanguage:e}=er(),[n,c]=le.useState(!1),[p,v]=le.useState(!1),[S,h]=le.useState(!1),[s,u]=le.useState(!1),[d,r]=le.useState(!0),[a,i]=le.useState(!1);le.useEffect(()=>{e(),!localStorage.getItem("omnicanvas_visited")&&(localStorage.setItem("omnicanvas_visited","true"),be.trackFeatureUsage("first_visit",{detected_language:navigator.language,user_agent:navigator.userAgent,timestamp:Date.now()}),setTimeout(()=>{v(!0)},1500))},[e]),le.useEffect(()=>{be.trackPageView("/"),be.trackFeatureUsage("app_loaded",{timestamp:Date.now(),user_agent:navigator.userAgent,viewport:`${window.innerWidth}x${window.innerHeight}`});const g=()=>{be.trackUserEngagement()};return window.addEventListener("beforeunload",g),()=>window.removeEventListener("beforeunload",g)},[]),le.useEffect(()=>{const g=setTimeout(()=>{window.dispatchEvent(new Event("resize"))},300);return()=>clearTimeout(g)},[d]),le.useEffect(()=>{be.trackFeatureUsage("panel_toggle",{panel_state:d?"open":"closed",timestamp:Date.now()})},[d]);const l=()=>{r(!0),be.trackFeatureUsage("ai_panel_opened_from_guide",{source:"service_guide",timestamp:Date.now()})};return w.jsxs("div",{className:"h-screen w-screen flex flex-col bg-gray-100",children:[w.jsxs("header",{className:"bg-white border-b border-gray-200 px-3 py-2 flex items-center justify-between relative",children:[w.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[w.jsx("h1",{className:"text-lg md:text-xl font-bold text-gray-900 truncate",children:"OmniCanvas"}),w.jsx("span",{className:"text-xs md:text-sm text-gray-500 hidden sm:block",children:"AI Creative Canvas"})]}),w.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[w.jsxs("button",{onClick:()=>{u(!0),be.trackFeatureUsage("share_opened",{source:"desktop_header",timestamp:Date.now()})},className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-cyan-100 hover:bg-cyan-200 text-cyan-700 rounded-lg transition-colors",title:"Share Canvas",children:[w.jsx(Oi,{className:"w-4 h-4"}),w.jsx("span",{children:"Share"})]}),w.jsxs("button",{onClick:()=>{h(!0),be.trackFeatureUsage("favorites_opened",{source:"desktop_header",timestamp:Date.now()})},className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors",title:"Open Favorites",children:[w.jsx(ss,{className:"w-4 h-4"}),w.jsx("span",{children:"Favorites"})]}),w.jsxs("button",{onClick:()=>{v(!0),be.trackFeatureUsage("service_guide_opened",{source:"desktop_header",timestamp:Date.now()})},className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",children:[w.jsx(rs,{className:"w-4 h-4"}),w.jsx("span",{children:t.serviceGuide.title})]}),w.jsxs("button",{onClick:()=>{c(!0),be.trackFeatureUsage("settings_opened",{source:"desktop_header",timestamp:Date.now()})},className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[w.jsx(ei,{className:"w-4 h-4"}),w.jsx("span",{children:t.common.settings})]}),w.jsx(bc,{}),w.jsxs("button",{onClick:()=>r(!d),className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:d?"Hide AI Assistant":"Show AI Assistant",children:[d?w.jsx(hc,{className:"w-4 h-4"}):w.jsx(dc,{className:"w-4 h-4"}),w.jsx("span",{children:d?"Hide Panel":"Show Panel"})]})]}),w.jsxs("div",{className:"md:hidden flex items-center space-x-2",children:[w.jsx("button",{onClick:()=>r(!d),className:"p-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:d?"Hide AI Assistant":"Show AI Assistant",children:d?w.jsx(hc,{className:"w-5 h-5"}):w.jsx(dc,{className:"w-5 h-5"})}),w.jsx("button",{onClick:()=>i(!a),className:"p-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:a?w.jsx(as,{className:"w-5 h-5"}):w.jsx(Xg,{className:"w-5 h-5"})}),w.jsx(bc,{})]}),a&&w.jsx("div",{className:"absolute top-full left-0 right-0 z-40 bg-white border-b border-gray-200 shadow-lg md:hidden",children:w.jsxs("div",{className:"p-4 space-y-3",children:[w.jsxs("button",{onClick:()=>{u(!0),i(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 text-sm bg-cyan-100 hover:bg-cyan-200 text-cyan-700 rounded-lg transition-colors",children:[w.jsx(Oi,{className:"w-4 h-4"}),w.jsx("span",{children:"Share"})]}),w.jsxs("button",{onClick:()=>{h(!0),i(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg transition-colors",children:[w.jsx(ss,{className:"w-4 h-4"}),w.jsx("span",{children:"Favorites"})]}),w.jsxs("button",{onClick:()=>{c(!0),i(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[w.jsx(ei,{className:"w-4 h-4"}),w.jsx("span",{children:t.common.settings})]}),w.jsxs("button",{onClick:()=>{v(!0),i(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",children:[w.jsx(rs,{className:"w-4 h-4"}),w.jsx("span",{children:t.serviceGuide.title})]})]})})]}),w.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[w.jsx("div",{className:`${d?"hidden md:block":"block"}`,children:w.jsx(Jm,{})}),w.jsx("div",{className:`flex-1 flex flex-col min-w-0 ${d?"hidden md:flex":"flex"}`,children:w.jsx(qm,{})}),d&&w.jsx("div",{className:"w-full md:w-80 lg:w-96 xl:w-[420px] bg-white border-l border-gray-200 flex flex-col overflow-hidden flex-shrink-0 transition-all duration-300 ease-in-out h-full md:h-auto",children:w.jsx("div",{className:"flex-1 flex flex-col min-h-0 h-full",children:w.jsx(np,{onOpenSettings:()=>c(!0)})})})]}),w.jsx(op,{isOpen:n,setIsOpen:c}),w.jsx(up,{isOpen:S,onClose:()=>h(!1)}),w.jsx(dp,{isOpen:s,onClose:()=>u(!1)}),p&&w.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4",children:w.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-full max-h-[90vh] flex flex-col",children:[w.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[w.jsx("h2",{className:"text-xl font-bold text-gray-800",children:t.serviceGuide.title}),w.jsx("button",{onClick:()=>v(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),w.jsx("div",{className:"flex-1 overflow-hidden",children:w.jsx(lp,{onOpenSettings:()=>c(!0),onOpenAIPanel:l,onClose:()=>v(!1)})})]})})]})}ip({enableCSP:!0,enableXSSProtection:!0,enableExtensionDetection:!0,strictMode:!0}).then(()=>{console.log("🔒 Security initialized, starting application...")}).catch(t=>{console.error("❌ Security initialization failed:",t)});sa.createRoot(document.getElementById("root")).render(w.jsx(Nc.StrictMode,{children:w.jsx(fp,{})}));
