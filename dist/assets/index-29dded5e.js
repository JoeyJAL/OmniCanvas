var fh=Object.defineProperty;var dh=(t,e,n)=>e in t?fh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ba=(t,e,n)=>(dh(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const y of m)if(y.type==="childList")for(const w of y.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&c(w)}).observe(document,{childList:!0,subtree:!0});function n(m){const y={};return m.integrity&&(y.integrity=m.integrity),m.referrerPolicy&&(y.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?y.credentials="include":m.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function c(m){if(m.ep)return;m.ep=!0;const y=n(m);fetch(m.href,y)}})();function zl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function gh(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function c(){return this instanceof c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(c){var m=Object.getOwnPropertyDescriptor(t,c);Object.defineProperty(n,c,m.get?m:{enumerable:!0,get:function(){return t[c]}})}),n}var Ul={exports:{}},Ri={},Wl={exports:{}},he={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ir=Symbol.for("react.element"),ph=Symbol.for("react.portal"),mh=Symbol.for("react.fragment"),vh=Symbol.for("react.strict_mode"),yh=Symbol.for("react.profiler"),xh=Symbol.for("react.provider"),wh=Symbol.for("react.context"),Ch=Symbol.for("react.forward_ref"),Sh=Symbol.for("react.suspense"),_h=Symbol.for("react.memo"),bh=Symbol.for("react.lazy"),Ta=Symbol.iterator;function Th(t){return t===null||typeof t!="object"?null:(t=Ta&&t[Ta]||t["@@iterator"],typeof t=="function"?t:null)}var Hl={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Xl=Object.assign,Yl={};function Xn(t,e,n){this.props=t,this.context=e,this.refs=Yl,this.updater=n||Hl}Xn.prototype.isReactComponent={};Xn.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Xn.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Vl(){}Vl.prototype=Xn.prototype;function ko(t,e,n){this.props=t,this.context=e,this.refs=Yl,this.updater=n||Hl}var Oo=ko.prototype=new Vl;Oo.constructor=ko;Xl(Oo,Xn.prototype);Oo.isPureReactComponent=!0;var ka=Array.isArray,Gl=Object.prototype.hasOwnProperty,Po={current:null},$l={key:!0,ref:!0,__self:!0,__source:!0};function Kl(t,e,n){var c,m={},y=null,w=null;if(e!=null)for(c in e.ref!==void 0&&(w=e.ref),e.key!==void 0&&(y=""+e.key),e)Gl.call(e,c)&&!$l.hasOwnProperty(c)&&(m[c]=e[c]);var f=arguments.length-2;if(f===1)m.children=n;else if(1<f){for(var s=Array(f),u=0;u<f;u++)s[u]=arguments[u+2];m.children=s}if(t&&t.defaultProps)for(c in f=t.defaultProps,f)m[c]===void 0&&(m[c]=f[c]);return{$$typeof:Ir,type:t,key:y,ref:w,props:m,_owner:Po.current}}function kh(t,e){return{$$typeof:Ir,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Eo(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ir}function Oh(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Oa=/\/+/g;function ts(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Oh(""+t.key):e.toString(36)}function ni(t,e,n,c,m){var y=typeof t;(y==="undefined"||y==="boolean")&&(t=null);var w=!1;if(t===null)w=!0;else switch(y){case"string":case"number":w=!0;break;case"object":switch(t.$$typeof){case Ir:case ph:w=!0}}if(w)return w=t,m=m(w),t=c===""?"."+ts(w,0):c,ka(m)?(n="",t!=null&&(n=t.replace(Oa,"$&/")+"/"),ni(m,e,n,"",function(u){return u})):m!=null&&(Eo(m)&&(m=kh(m,n+(!m.key||w&&w.key===m.key?"":(""+m.key).replace(Oa,"$&/")+"/")+t)),e.push(m)),1;if(w=0,c=c===""?".":c+":",ka(t))for(var f=0;f<t.length;f++){y=t[f];var s=c+ts(y,f);w+=ni(y,e,n,s,m)}else if(s=Th(t),typeof s=="function")for(t=s.call(t),f=0;!(y=t.next()).done;)y=y.value,s=c+ts(y,f++),w+=ni(y,e,n,s,m);else if(y==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return w}function Br(t,e,n){if(t==null)return t;var c=[],m=0;return ni(t,c,"","",function(y){return e.call(n,y,m++)}),c}function Ph(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ye={current:null},ri={transition:null},Eh={ReactCurrentDispatcher:Ye,ReactCurrentBatchConfig:ri,ReactCurrentOwner:Po};function ql(){throw Error("act(...) is not supported in production builds of React.")}he.Children={map:Br,forEach:function(t,e,n){Br(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Br(t,function(){e++}),e},toArray:function(t){return Br(t,function(e){return e})||[]},only:function(t){if(!Eo(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};he.Component=Xn;he.Fragment=mh;he.Profiler=yh;he.PureComponent=ko;he.StrictMode=vh;he.Suspense=Sh;he.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Eh;he.act=ql;he.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var c=Xl({},t.props),m=t.key,y=t.ref,w=t._owner;if(e!=null){if(e.ref!==void 0&&(y=e.ref,w=Po.current),e.key!==void 0&&(m=""+e.key),t.type&&t.type.defaultProps)var f=t.type.defaultProps;for(s in e)Gl.call(e,s)&&!$l.hasOwnProperty(s)&&(c[s]=e[s]===void 0&&f!==void 0?f[s]:e[s])}var s=arguments.length-2;if(s===1)c.children=n;else if(1<s){f=Array(s);for(var u=0;u<s;u++)f[u]=arguments[u+2];c.children=f}return{$$typeof:Ir,type:t.type,key:m,ref:y,props:c,_owner:w}};he.createContext=function(t){return t={$$typeof:wh,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:xh,_context:t},t.Consumer=t};he.createElement=Kl;he.createFactory=function(t){var e=Kl.bind(null,t);return e.type=t,e};he.createRef=function(){return{current:null}};he.forwardRef=function(t){return{$$typeof:Ch,render:t}};he.isValidElement=Eo;he.lazy=function(t){return{$$typeof:bh,_payload:{_status:-1,_result:t},_init:Ph}};he.memo=function(t,e){return{$$typeof:_h,type:t,compare:e===void 0?null:e}};he.startTransition=function(t){var e=ri.transition;ri.transition={};try{t()}finally{ri.transition=e}};he.unstable_act=ql;he.useCallback=function(t,e){return Ye.current.useCallback(t,e)};he.useContext=function(t){return Ye.current.useContext(t)};he.useDebugValue=function(){};he.useDeferredValue=function(t){return Ye.current.useDeferredValue(t)};he.useEffect=function(t,e){return Ye.current.useEffect(t,e)};he.useId=function(){return Ye.current.useId()};he.useImperativeHandle=function(t,e,n){return Ye.current.useImperativeHandle(t,e,n)};he.useInsertionEffect=function(t,e){return Ye.current.useInsertionEffect(t,e)};he.useLayoutEffect=function(t,e){return Ye.current.useLayoutEffect(t,e)};he.useMemo=function(t,e){return Ye.current.useMemo(t,e)};he.useReducer=function(t,e,n){return Ye.current.useReducer(t,e,n)};he.useRef=function(t){return Ye.current.useRef(t)};he.useState=function(t){return Ye.current.useState(t)};he.useSyncExternalStore=function(t,e,n){return Ye.current.useSyncExternalStore(t,e,n)};he.useTransition=function(){return Ye.current.useTransition()};he.version="18.3.1";Wl.exports=he;var ue=Wl.exports;const Ql=zl(ue);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jh=ue,Mh=Symbol.for("react.element"),Dh=Symbol.for("react.fragment"),Ah=Object.prototype.hasOwnProperty,Ih=jh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Lh={key:!0,ref:!0,__self:!0,__source:!0};function Jl(t,e,n){var c,m={},y=null,w=null;n!==void 0&&(y=""+n),e.key!==void 0&&(y=""+e.key),e.ref!==void 0&&(w=e.ref);for(c in e)Ah.call(e,c)&&!Lh.hasOwnProperty(c)&&(m[c]=e[c]);if(t&&t.defaultProps)for(c in e=t.defaultProps,e)m[c]===void 0&&(m[c]=e[c]);return{$$typeof:Mh,type:t,key:y,ref:w,props:m,_owner:Ih.current}}Ri.Fragment=Dh;Ri.jsx=Jl;Ri.jsxs=Jl;Ul.exports=Ri;var b=Ul.exports,Ms={},Zl={exports:{}},nt={},ec={exports:{}},tc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(V,_){var O=V.length;V.push(_);e:for(;0<O;){var j=O-1>>>1,D=V[j];if(0<m(D,_))V[j]=_,V[O]=D,O=j;else break e}}function n(V){return V.length===0?null:V[0]}function c(V){if(V.length===0)return null;var _=V[0],O=V.pop();if(O!==_){V[0]=O;e:for(var j=0,D=V.length,X=D>>>1;j<X;){var M=2*(j+1)-1,k=V[M],L=M+1,B=V[L];if(0>m(k,O))L<D&&0>m(B,k)?(V[j]=B,V[L]=O,j=L):(V[j]=k,V[M]=O,j=M);else if(L<D&&0>m(B,O))V[j]=B,V[L]=O,j=L;else break e}}return _}function m(V,_){var O=V.sortIndex-_.sortIndex;return O!==0?O:V.id-_.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;t.unstable_now=function(){return y.now()}}else{var w=Date,f=w.now();t.unstable_now=function(){return w.now()-f}}var s=[],u=[],h=1,r=null,o=3,i=!1,l=!1,d=!1,a=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(V){for(var _=n(u);_!==null;){if(_.callback===null)c(u);else if(_.startTime<=V)c(u),_.sortIndex=_.expirationTime,e(s,_);else break;_=n(u)}}function x(V){if(d=!1,v(V),!l)if(n(s)!==null)l=!0,oe(C);else{var _=n(u);_!==null&&le(x,_.startTime-V)}}function C(V,_){l=!1,d&&(d=!1,g(P),P=-1),i=!0;var O=o;try{for(v(_),r=n(s);r!==null&&(!(r.expirationTime>_)||V&&!J());){var j=r.callback;if(typeof j=="function"){r.callback=null,o=r.priorityLevel;var D=j(r.expirationTime<=_);_=t.unstable_now(),typeof D=="function"?r.callback=D:r===n(s)&&c(s),v(_)}else c(s);r=n(s)}if(r!==null)var X=!0;else{var M=n(u);M!==null&&le(x,M.startTime-_),X=!1}return X}finally{r=null,o=O,i=!1}}var S=!1,T=null,P=-1,R=5,z=-1;function J(){return!(t.unstable_now()-z<R)}function ne(){if(T!==null){var V=t.unstable_now();z=V;var _=!0;try{_=T(!0,V)}finally{_?ie():(S=!1,T=null)}}else S=!1}var ie;if(typeof p=="function")ie=function(){p(ne)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,re=te.port2;te.port1.onmessage=ne,ie=function(){re.postMessage(null)}}else ie=function(){a(ne,0)};function oe(V){T=V,S||(S=!0,ie())}function le(V,_){P=a(function(){V(t.unstable_now())},_)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_continueExecution=function(){l||i||(l=!0,oe(C))},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return o},t.unstable_getFirstCallbackNode=function(){return n(s)},t.unstable_next=function(V){switch(o){case 1:case 2:case 3:var _=3;break;default:_=o}var O=o;o=_;try{return V()}finally{o=O}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(V,_){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var O=o;o=V;try{return _()}finally{o=O}},t.unstable_scheduleCallback=function(V,_,O){var j=t.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?j+O:j):O=j,V){case 1:var D=-1;break;case 2:D=250;break;case 5:D=1073741823;break;case 4:D=1e4;break;default:D=5e3}return D=O+D,V={id:h++,callback:_,priorityLevel:V,startTime:O,expirationTime:D,sortIndex:-1},O>j?(V.sortIndex=O,e(u,V),n(s)===null&&V===n(u)&&(d?(g(P),P=-1):d=!0,le(x,O-j))):(V.sortIndex=D,e(s,V),l||i||(l=!0,oe(C))),V},t.unstable_shouldYield=J,t.unstable_wrapCallback=function(V){var _=o;return function(){var O=o;o=_;try{return V.apply(this,arguments)}finally{o=O}}}})(tc);ec.exports=tc;var Fh=ec.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nh=ue,tt=Fh;function ee(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nc=new Set,mr={};function gn(t,e){Fn(t,e),Fn(t+"Capture",e)}function Fn(t,e){for(mr[t]=e,t=0;t<e.length;t++)nc.add(e[t])}var Pt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ds=Object.prototype.hasOwnProperty,Rh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Pa={},Ea={};function Bh(t){return Ds.call(Ea,t)?!0:Ds.call(Pa,t)?!1:Rh.test(t)?Ea[t]=!0:(Pa[t]=!0,!1)}function zh(t,e,n,c){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return c?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Uh(t,e,n,c){if(e===null||typeof e>"u"||zh(t,e,n,c))return!0;if(c)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ve(t,e,n,c,m,y,w){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=c,this.attributeNamespace=m,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=y,this.removeEmptyString=w}var Fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fe[t]=new Ve(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fe[e]=new Ve(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fe[t]=new Ve(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fe[t]=new Ve(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fe[t]=new Ve(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fe[t]=new Ve(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fe[t]=new Ve(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fe[t]=new Ve(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fe[t]=new Ve(t,5,!1,t.toLowerCase(),null,!1,!1)});var jo=/[\-:]([a-z])/g;function Mo(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(jo,Mo);Fe[e]=new Ve(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(jo,Mo);Fe[e]=new Ve(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(jo,Mo);Fe[e]=new Ve(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fe[t]=new Ve(t,1,!1,t.toLowerCase(),null,!1,!1)});Fe.xlinkHref=new Ve("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fe[t]=new Ve(t,1,!1,t.toLowerCase(),null,!0,!0)});function Do(t,e,n,c){var m=Fe.hasOwnProperty(e)?Fe[e]:null;(m!==null?m.type!==0:c||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Uh(e,n,m,c)&&(n=null),c||m===null?Bh(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):m.mustUseProperty?t[m.propertyName]=n===null?m.type===3?!1:"":n:(e=m.attributeName,c=m.attributeNamespace,n===null?t.removeAttribute(e):(m=m.type,n=m===3||m===4&&n===!0?"":""+n,c?t.setAttributeNS(c,e,n):t.setAttribute(e,n))))}var Dt=Nh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,zr=Symbol.for("react.element"),vn=Symbol.for("react.portal"),yn=Symbol.for("react.fragment"),Ao=Symbol.for("react.strict_mode"),As=Symbol.for("react.profiler"),rc=Symbol.for("react.provider"),ic=Symbol.for("react.context"),Io=Symbol.for("react.forward_ref"),Is=Symbol.for("react.suspense"),Ls=Symbol.for("react.suspense_list"),Lo=Symbol.for("react.memo"),Lt=Symbol.for("react.lazy"),sc=Symbol.for("react.offscreen"),ja=Symbol.iterator;function $n(t){return t===null||typeof t!="object"?null:(t=ja&&t[ja]||t["@@iterator"],typeof t=="function"?t:null)}var Te=Object.assign,ns;function nr(t){if(ns===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);ns=e&&e[1]||""}return`
`+ns+t}var rs=!1;function is(t,e){if(!t||rs)return"";rs=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var c=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){c=u}t.call(e.prototype)}else{try{throw Error()}catch(u){c=u}t()}}catch(u){if(u&&c&&typeof u.stack=="string"){for(var m=u.stack.split(`
`),y=c.stack.split(`
`),w=m.length-1,f=y.length-1;1<=w&&0<=f&&m[w]!==y[f];)f--;for(;1<=w&&0<=f;w--,f--)if(m[w]!==y[f]){if(w!==1||f!==1)do if(w--,f--,0>f||m[w]!==y[f]){var s=`
`+m[w].replace(" at new "," at ");return t.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",t.displayName)),s}while(1<=w&&0<=f);break}}}finally{rs=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?nr(t):""}function Wh(t){switch(t.tag){case 5:return nr(t.type);case 16:return nr("Lazy");case 13:return nr("Suspense");case 19:return nr("SuspenseList");case 0:case 2:case 15:return t=is(t.type,!1),t;case 11:return t=is(t.type.render,!1),t;case 1:return t=is(t.type,!0),t;default:return""}}function Fs(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case yn:return"Fragment";case vn:return"Portal";case As:return"Profiler";case Ao:return"StrictMode";case Is:return"Suspense";case Ls:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case ic:return(t.displayName||"Context")+".Consumer";case rc:return(t._context.displayName||"Context")+".Provider";case Io:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Lo:return e=t.displayName||null,e!==null?e:Fs(t.type)||"Memo";case Lt:e=t._payload,t=t._init;try{return Fs(t(e))}catch{}}return null}function Hh(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Fs(e);case 8:return e===Ao?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Kt(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function oc(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Xh(t){var e=oc(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),c=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var m=n.get,y=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return m.call(this)},set:function(w){c=""+w,y.call(this,w)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return c},setValue:function(w){c=""+w},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Ur(t){t._valueTracker||(t._valueTracker=Xh(t))}function ac(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),c="";return t&&(c=oc(t)?t.checked?"true":"false":t.value),t=c,t!==n?(e.setValue(t),!0):!1}function gi(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ns(t,e){var n=e.checked;return Te({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Ma(t,e){var n=e.defaultValue==null?"":e.defaultValue,c=e.checked!=null?e.checked:e.defaultChecked;n=Kt(e.value!=null?e.value:n),t._wrapperState={initialChecked:c,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function lc(t,e){e=e.checked,e!=null&&Do(t,"checked",e,!1)}function Rs(t,e){lc(t,e);var n=Kt(e.value),c=e.type;if(n!=null)c==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(c==="submit"||c==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Bs(t,e.type,n):e.hasOwnProperty("defaultValue")&&Bs(t,e.type,Kt(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Da(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var c=e.type;if(!(c!=="submit"&&c!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Bs(t,e,n){(e!=="number"||gi(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var rr=Array.isArray;function En(t,e,n,c){if(t=t.options,e){e={};for(var m=0;m<n.length;m++)e["$"+n[m]]=!0;for(n=0;n<t.length;n++)m=e.hasOwnProperty("$"+t[n].value),t[n].selected!==m&&(t[n].selected=m),m&&c&&(t[n].defaultSelected=!0)}else{for(n=""+Kt(n),e=null,m=0;m<t.length;m++){if(t[m].value===n){t[m].selected=!0,c&&(t[m].defaultSelected=!0);return}e!==null||t[m].disabled||(e=t[m])}e!==null&&(e.selected=!0)}}function zs(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ee(91));return Te({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Aa(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ee(92));if(rr(n)){if(1<n.length)throw Error(ee(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Kt(n)}}function cc(t,e){var n=Kt(e.value),c=Kt(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),c!=null&&(t.defaultValue=""+c)}function Ia(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function uc(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Us(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?uc(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Wr,hc=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,c,m){MSApp.execUnsafeLocalFunction(function(){return t(e,n,c,m)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Wr=Wr||document.createElement("div"),Wr.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Wr.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function vr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var or={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Yh=["Webkit","ms","Moz","O"];Object.keys(or).forEach(function(t){Yh.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),or[e]=or[t]})});function fc(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||or.hasOwnProperty(t)&&or[t]?(""+e).trim():e+"px"}function dc(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var c=n.indexOf("--")===0,m=fc(n,e[n],c);n==="float"&&(n="cssFloat"),c?t.setProperty(n,m):t[n]=m}}var Vh=Te({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ws(t,e){if(e){if(Vh[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ee(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ee(62))}}function Hs(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xs=null;function Fo(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ys=null,jn=null,Mn=null;function La(t){if(t=Nr(t)){if(typeof Ys!="function")throw Error(ee(280));var e=t.stateNode;e&&(e=Hi(e),Ys(t.stateNode,t.type,e))}}function gc(t){jn?Mn?Mn.push(t):Mn=[t]:jn=t}function pc(){if(jn){var t=jn,e=Mn;if(Mn=jn=null,La(t),e)for(t=0;t<e.length;t++)La(e[t])}}function mc(t,e){return t(e)}function vc(){}var ss=!1;function yc(t,e,n){if(ss)return t(e,n);ss=!0;try{return mc(t,e,n)}finally{ss=!1,(jn!==null||Mn!==null)&&(vc(),pc())}}function yr(t,e){var n=t.stateNode;if(n===null)return null;var c=Hi(n);if(c===null)return null;n=c[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ee(231,e,typeof n));return n}var Vs=!1;if(Pt)try{var Kn={};Object.defineProperty(Kn,"passive",{get:function(){Vs=!0}}),window.addEventListener("test",Kn,Kn),window.removeEventListener("test",Kn,Kn)}catch{Vs=!1}function Gh(t,e,n,c,m,y,w,f,s){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var ar=!1,pi=null,mi=!1,Gs=null,$h={onError:function(t){ar=!0,pi=t}};function Kh(t,e,n,c,m,y,w,f,s){ar=!1,pi=null,Gh.apply($h,arguments)}function qh(t,e,n,c,m,y,w,f,s){if(Kh.apply(this,arguments),ar){if(ar){var u=pi;ar=!1,pi=null}else throw Error(ee(198));mi||(mi=!0,Gs=u)}}function pn(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function xc(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Fa(t){if(pn(t)!==t)throw Error(ee(188))}function Qh(t){var e=t.alternate;if(!e){if(e=pn(t),e===null)throw Error(ee(188));return e!==t?null:t}for(var n=t,c=e;;){var m=n.return;if(m===null)break;var y=m.alternate;if(y===null){if(c=m.return,c!==null){n=c;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===n)return Fa(m),t;if(y===c)return Fa(m),e;y=y.sibling}throw Error(ee(188))}if(n.return!==c.return)n=m,c=y;else{for(var w=!1,f=m.child;f;){if(f===n){w=!0,n=m,c=y;break}if(f===c){w=!0,c=m,n=y;break}f=f.sibling}if(!w){for(f=y.child;f;){if(f===n){w=!0,n=y,c=m;break}if(f===c){w=!0,c=y,n=m;break}f=f.sibling}if(!w)throw Error(ee(189))}}if(n.alternate!==c)throw Error(ee(190))}if(n.tag!==3)throw Error(ee(188));return n.stateNode.current===n?t:e}function wc(t){return t=Qh(t),t!==null?Cc(t):null}function Cc(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Cc(t);if(e!==null)return e;t=t.sibling}return null}var Sc=tt.unstable_scheduleCallback,Na=tt.unstable_cancelCallback,Jh=tt.unstable_shouldYield,Zh=tt.unstable_requestPaint,Oe=tt.unstable_now,ef=tt.unstable_getCurrentPriorityLevel,No=tt.unstable_ImmediatePriority,_c=tt.unstable_UserBlockingPriority,vi=tt.unstable_NormalPriority,tf=tt.unstable_LowPriority,bc=tt.unstable_IdlePriority,Bi=null,Ct=null;function nf(t){if(Ct&&typeof Ct.onCommitFiberRoot=="function")try{Ct.onCommitFiberRoot(Bi,t,void 0,(t.current.flags&128)===128)}catch{}}var gt=Math.clz32?Math.clz32:of,rf=Math.log,sf=Math.LN2;function of(t){return t>>>=0,t===0?32:31-(rf(t)/sf|0)|0}var Hr=64,Xr=4194304;function ir(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function yi(t,e){var n=t.pendingLanes;if(n===0)return 0;var c=0,m=t.suspendedLanes,y=t.pingedLanes,w=n&268435455;if(w!==0){var f=w&~m;f!==0?c=ir(f):(y&=w,y!==0&&(c=ir(y)))}else w=n&~m,w!==0?c=ir(w):y!==0&&(c=ir(y));if(c===0)return 0;if(e!==0&&e!==c&&!(e&m)&&(m=c&-c,y=e&-e,m>=y||m===16&&(y&4194240)!==0))return e;if(c&4&&(c|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=c;0<e;)n=31-gt(e),m=1<<n,c|=t[n],e&=~m;return c}function af(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lf(t,e){for(var n=t.suspendedLanes,c=t.pingedLanes,m=t.expirationTimes,y=t.pendingLanes;0<y;){var w=31-gt(y),f=1<<w,s=m[w];s===-1?(!(f&n)||f&c)&&(m[w]=af(f,e)):s<=e&&(t.expiredLanes|=f),y&=~f}}function $s(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Tc(){var t=Hr;return Hr<<=1,!(Hr&4194240)&&(Hr=64),t}function os(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Lr(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-gt(e),t[e]=n}function cf(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var c=t.eventTimes;for(t=t.expirationTimes;0<n;){var m=31-gt(n),y=1<<m;e[m]=0,c[m]=-1,t[m]=-1,n&=~y}}function Ro(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var c=31-gt(n),m=1<<c;m&e|t[c]&e&&(t[c]|=e),n&=~m}}var pe=0;function kc(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Oc,Bo,Pc,Ec,jc,Ks=!1,Yr=[],Ut=null,Wt=null,Ht=null,xr=new Map,wr=new Map,Nt=[],uf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ra(t,e){switch(t){case"focusin":case"focusout":Ut=null;break;case"dragenter":case"dragleave":Wt=null;break;case"mouseover":case"mouseout":Ht=null;break;case"pointerover":case"pointerout":xr.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":wr.delete(e.pointerId)}}function qn(t,e,n,c,m,y){return t===null||t.nativeEvent!==y?(t={blockedOn:e,domEventName:n,eventSystemFlags:c,nativeEvent:y,targetContainers:[m]},e!==null&&(e=Nr(e),e!==null&&Bo(e)),t):(t.eventSystemFlags|=c,e=t.targetContainers,m!==null&&e.indexOf(m)===-1&&e.push(m),t)}function hf(t,e,n,c,m){switch(e){case"focusin":return Ut=qn(Ut,t,e,n,c,m),!0;case"dragenter":return Wt=qn(Wt,t,e,n,c,m),!0;case"mouseover":return Ht=qn(Ht,t,e,n,c,m),!0;case"pointerover":var y=m.pointerId;return xr.set(y,qn(xr.get(y)||null,t,e,n,c,m)),!0;case"gotpointercapture":return y=m.pointerId,wr.set(y,qn(wr.get(y)||null,t,e,n,c,m)),!0}return!1}function Mc(t){var e=rn(t.target);if(e!==null){var n=pn(e);if(n!==null){if(e=n.tag,e===13){if(e=xc(n),e!==null){t.blockedOn=e,jc(t.priority,function(){Pc(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ii(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=qs(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var c=new n.constructor(n.type,n);Xs=c,n.target.dispatchEvent(c),Xs=null}else return e=Nr(n),e!==null&&Bo(e),t.blockedOn=n,!1;e.shift()}return!0}function Ba(t,e,n){ii(t)&&n.delete(e)}function ff(){Ks=!1,Ut!==null&&ii(Ut)&&(Ut=null),Wt!==null&&ii(Wt)&&(Wt=null),Ht!==null&&ii(Ht)&&(Ht=null),xr.forEach(Ba),wr.forEach(Ba)}function Qn(t,e){t.blockedOn===e&&(t.blockedOn=null,Ks||(Ks=!0,tt.unstable_scheduleCallback(tt.unstable_NormalPriority,ff)))}function Cr(t){function e(m){return Qn(m,t)}if(0<Yr.length){Qn(Yr[0],t);for(var n=1;n<Yr.length;n++){var c=Yr[n];c.blockedOn===t&&(c.blockedOn=null)}}for(Ut!==null&&Qn(Ut,t),Wt!==null&&Qn(Wt,t),Ht!==null&&Qn(Ht,t),xr.forEach(e),wr.forEach(e),n=0;n<Nt.length;n++)c=Nt[n],c.blockedOn===t&&(c.blockedOn=null);for(;0<Nt.length&&(n=Nt[0],n.blockedOn===null);)Mc(n),n.blockedOn===null&&Nt.shift()}var Dn=Dt.ReactCurrentBatchConfig,xi=!0;function df(t,e,n,c){var m=pe,y=Dn.transition;Dn.transition=null;try{pe=1,zo(t,e,n,c)}finally{pe=m,Dn.transition=y}}function gf(t,e,n,c){var m=pe,y=Dn.transition;Dn.transition=null;try{pe=4,zo(t,e,n,c)}finally{pe=m,Dn.transition=y}}function zo(t,e,n,c){if(xi){var m=qs(t,e,n,c);if(m===null)ms(t,e,c,wi,n),Ra(t,c);else if(hf(m,t,e,n,c))c.stopPropagation();else if(Ra(t,c),e&4&&-1<uf.indexOf(t)){for(;m!==null;){var y=Nr(m);if(y!==null&&Oc(y),y=qs(t,e,n,c),y===null&&ms(t,e,c,wi,n),y===m)break;m=y}m!==null&&c.stopPropagation()}else ms(t,e,c,null,n)}}var wi=null;function qs(t,e,n,c){if(wi=null,t=Fo(c),t=rn(t),t!==null)if(e=pn(t),e===null)t=null;else if(n=e.tag,n===13){if(t=xc(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return wi=t,null}function Dc(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ef()){case No:return 1;case _c:return 4;case vi:case tf:return 16;case bc:return 536870912;default:return 16}default:return 16}}var Bt=null,Uo=null,si=null;function Ac(){if(si)return si;var t,e=Uo,n=e.length,c,m="value"in Bt?Bt.value:Bt.textContent,y=m.length;for(t=0;t<n&&e[t]===m[t];t++);var w=n-t;for(c=1;c<=w&&e[n-c]===m[y-c];c++);return si=m.slice(t,1<c?1-c:void 0)}function oi(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vr(){return!0}function za(){return!1}function rt(t){function e(n,c,m,y,w){this._reactName=n,this._targetInst=m,this.type=c,this.nativeEvent=y,this.target=w,this.currentTarget=null;for(var f in t)t.hasOwnProperty(f)&&(n=t[f],this[f]=n?n(y):y[f]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Vr:za,this.isPropagationStopped=za,this}return Te(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vr)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vr)},persist:function(){},isPersistent:Vr}),e}var Yn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wo=rt(Yn),Fr=Te({},Yn,{view:0,detail:0}),pf=rt(Fr),as,ls,Jn,zi=Te({},Fr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ho,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Jn&&(Jn&&t.type==="mousemove"?(as=t.screenX-Jn.screenX,ls=t.screenY-Jn.screenY):ls=as=0,Jn=t),as)},movementY:function(t){return"movementY"in t?t.movementY:ls}}),Ua=rt(zi),mf=Te({},zi,{dataTransfer:0}),vf=rt(mf),yf=Te({},Fr,{relatedTarget:0}),cs=rt(yf),xf=Te({},Yn,{animationName:0,elapsedTime:0,pseudoElement:0}),wf=rt(xf),Cf=Te({},Yn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Sf=rt(Cf),_f=Te({},Yn,{data:0}),Wa=rt(_f),bf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Of(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=kf[t])?!!e[t]:!1}function Ho(){return Of}var Pf=Te({},Fr,{key:function(t){if(t.key){var e=bf[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=oi(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Tf[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ho,charCode:function(t){return t.type==="keypress"?oi(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?oi(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Ef=rt(Pf),jf=Te({},zi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ha=rt(jf),Mf=Te({},Fr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ho}),Df=rt(Mf),Af=Te({},Yn,{propertyName:0,elapsedTime:0,pseudoElement:0}),If=rt(Af),Lf=Te({},zi,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Ff=rt(Lf),Nf=[9,13,27,32],Xo=Pt&&"CompositionEvent"in window,lr=null;Pt&&"documentMode"in document&&(lr=document.documentMode);var Rf=Pt&&"TextEvent"in window&&!lr,Ic=Pt&&(!Xo||lr&&8<lr&&11>=lr),Xa=String.fromCharCode(32),Ya=!1;function Lc(t,e){switch(t){case"keyup":return Nf.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fc(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var xn=!1;function Bf(t,e){switch(t){case"compositionend":return Fc(e);case"keypress":return e.which!==32?null:(Ya=!0,Xa);case"textInput":return t=e.data,t===Xa&&Ya?null:t;default:return null}}function zf(t,e){if(xn)return t==="compositionend"||!Xo&&Lc(t,e)?(t=Ac(),si=Uo=Bt=null,xn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ic&&e.locale!=="ko"?null:e.data;default:return null}}var Uf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Va(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Uf[t.type]:e==="textarea"}function Nc(t,e,n,c){gc(c),e=Ci(e,"onChange"),0<e.length&&(n=new Wo("onChange","change",null,n,c),t.push({event:n,listeners:e}))}var cr=null,Sr=null;function Wf(t){$c(t,0)}function Ui(t){var e=Sn(t);if(ac(e))return t}function Hf(t,e){if(t==="change")return e}var Rc=!1;if(Pt){var us;if(Pt){var hs="oninput"in document;if(!hs){var Ga=document.createElement("div");Ga.setAttribute("oninput","return;"),hs=typeof Ga.oninput=="function"}us=hs}else us=!1;Rc=us&&(!document.documentMode||9<document.documentMode)}function $a(){cr&&(cr.detachEvent("onpropertychange",Bc),Sr=cr=null)}function Bc(t){if(t.propertyName==="value"&&Ui(Sr)){var e=[];Nc(e,Sr,t,Fo(t)),yc(Wf,e)}}function Xf(t,e,n){t==="focusin"?($a(),cr=e,Sr=n,cr.attachEvent("onpropertychange",Bc)):t==="focusout"&&$a()}function Yf(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ui(Sr)}function Vf(t,e){if(t==="click")return Ui(e)}function Gf(t,e){if(t==="input"||t==="change")return Ui(e)}function $f(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var mt=typeof Object.is=="function"?Object.is:$f;function _r(t,e){if(mt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),c=Object.keys(e);if(n.length!==c.length)return!1;for(c=0;c<n.length;c++){var m=n[c];if(!Ds.call(e,m)||!mt(t[m],e[m]))return!1}return!0}function Ka(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function qa(t,e){var n=Ka(t);t=0;for(var c;n;){if(n.nodeType===3){if(c=t+n.textContent.length,t<=e&&c>=e)return{node:n,offset:e-t};t=c}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ka(n)}}function zc(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?zc(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Uc(){for(var t=window,e=gi();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=gi(t.document)}return e}function Yo(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Kf(t){var e=Uc(),n=t.focusedElem,c=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&zc(n.ownerDocument.documentElement,n)){if(c!==null&&Yo(n)){if(e=c.start,t=c.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var m=n.textContent.length,y=Math.min(c.start,m);c=c.end===void 0?y:Math.min(c.end,m),!t.extend&&y>c&&(m=c,c=y,y=m),m=qa(n,y);var w=qa(n,c);m&&w&&(t.rangeCount!==1||t.anchorNode!==m.node||t.anchorOffset!==m.offset||t.focusNode!==w.node||t.focusOffset!==w.offset)&&(e=e.createRange(),e.setStart(m.node,m.offset),t.removeAllRanges(),y>c?(t.addRange(e),t.extend(w.node,w.offset)):(e.setEnd(w.node,w.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var qf=Pt&&"documentMode"in document&&11>=document.documentMode,wn=null,Qs=null,ur=null,Js=!1;function Qa(t,e,n){var c=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Js||wn==null||wn!==gi(c)||(c=wn,"selectionStart"in c&&Yo(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),ur&&_r(ur,c)||(ur=c,c=Ci(Qs,"onSelect"),0<c.length&&(e=new Wo("onSelect","select",null,e,n),t.push({event:e,listeners:c}),e.target=wn)))}function Gr(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Cn={animationend:Gr("Animation","AnimationEnd"),animationiteration:Gr("Animation","AnimationIteration"),animationstart:Gr("Animation","AnimationStart"),transitionend:Gr("Transition","TransitionEnd")},fs={},Wc={};Pt&&(Wc=document.createElement("div").style,"AnimationEvent"in window||(delete Cn.animationend.animation,delete Cn.animationiteration.animation,delete Cn.animationstart.animation),"TransitionEvent"in window||delete Cn.transitionend.transition);function Wi(t){if(fs[t])return fs[t];if(!Cn[t])return t;var e=Cn[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Wc)return fs[t]=e[n];return t}var Hc=Wi("animationend"),Xc=Wi("animationiteration"),Yc=Wi("animationstart"),Vc=Wi("transitionend"),Gc=new Map,Ja="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qt(t,e){Gc.set(t,e),gn(e,[t])}for(var ds=0;ds<Ja.length;ds++){var gs=Ja[ds],Qf=gs.toLowerCase(),Jf=gs[0].toUpperCase()+gs.slice(1);Qt(Qf,"on"+Jf)}Qt(Hc,"onAnimationEnd");Qt(Xc,"onAnimationIteration");Qt(Yc,"onAnimationStart");Qt("dblclick","onDoubleClick");Qt("focusin","onFocus");Qt("focusout","onBlur");Qt(Vc,"onTransitionEnd");Fn("onMouseEnter",["mouseout","mouseover"]);Fn("onMouseLeave",["mouseout","mouseover"]);Fn("onPointerEnter",["pointerout","pointerover"]);Fn("onPointerLeave",["pointerout","pointerover"]);gn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));gn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));gn("onBeforeInput",["compositionend","keypress","textInput","paste"]);gn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));gn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));gn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Zf=new Set("cancel close invalid load scroll toggle".split(" ").concat(sr));function Za(t,e,n){var c=t.type||"unknown-event";t.currentTarget=n,qh(c,e,void 0,t),t.currentTarget=null}function $c(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var c=t[n],m=c.event;c=c.listeners;e:{var y=void 0;if(e)for(var w=c.length-1;0<=w;w--){var f=c[w],s=f.instance,u=f.currentTarget;if(f=f.listener,s!==y&&m.isPropagationStopped())break e;Za(m,f,u),y=s}else for(w=0;w<c.length;w++){if(f=c[w],s=f.instance,u=f.currentTarget,f=f.listener,s!==y&&m.isPropagationStopped())break e;Za(m,f,u),y=s}}}if(mi)throw t=Gs,mi=!1,Gs=null,t}function ye(t,e){var n=e[ro];n===void 0&&(n=e[ro]=new Set);var c=t+"__bubble";n.has(c)||(Kc(e,t,2,!1),n.add(c))}function ps(t,e,n){var c=0;e&&(c|=4),Kc(n,t,c,e)}var $r="_reactListening"+Math.random().toString(36).slice(2);function br(t){if(!t[$r]){t[$r]=!0,nc.forEach(function(n){n!=="selectionchange"&&(Zf.has(n)||ps(n,!1,t),ps(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[$r]||(e[$r]=!0,ps("selectionchange",!1,e))}}function Kc(t,e,n,c){switch(Dc(e)){case 1:var m=df;break;case 4:m=gf;break;default:m=zo}n=m.bind(null,e,n,t),m=void 0,!Vs||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(m=!0),c?m!==void 0?t.addEventListener(e,n,{capture:!0,passive:m}):t.addEventListener(e,n,!0):m!==void 0?t.addEventListener(e,n,{passive:m}):t.addEventListener(e,n,!1)}function ms(t,e,n,c,m){var y=c;if(!(e&1)&&!(e&2)&&c!==null)e:for(;;){if(c===null)return;var w=c.tag;if(w===3||w===4){var f=c.stateNode.containerInfo;if(f===m||f.nodeType===8&&f.parentNode===m)break;if(w===4)for(w=c.return;w!==null;){var s=w.tag;if((s===3||s===4)&&(s=w.stateNode.containerInfo,s===m||s.nodeType===8&&s.parentNode===m))return;w=w.return}for(;f!==null;){if(w=rn(f),w===null)return;if(s=w.tag,s===5||s===6){c=y=w;continue e}f=f.parentNode}}c=c.return}yc(function(){var u=y,h=Fo(n),r=[];e:{var o=Gc.get(t);if(o!==void 0){var i=Wo,l=t;switch(t){case"keypress":if(oi(n)===0)break e;case"keydown":case"keyup":i=Ef;break;case"focusin":l="focus",i=cs;break;case"focusout":l="blur",i=cs;break;case"beforeblur":case"afterblur":i=cs;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":i=Ua;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":i=vf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":i=Df;break;case Hc:case Xc:case Yc:i=wf;break;case Vc:i=If;break;case"scroll":i=pf;break;case"wheel":i=Ff;break;case"copy":case"cut":case"paste":i=Sf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":i=Ha}var d=(e&4)!==0,a=!d&&t==="scroll",g=d?o!==null?o+"Capture":null:o;d=[];for(var p=u,v;p!==null;){v=p;var x=v.stateNode;if(v.tag===5&&x!==null&&(v=x,g!==null&&(x=yr(p,g),x!=null&&d.push(Tr(p,x,v)))),a)break;p=p.return}0<d.length&&(o=new i(o,l,null,n,h),r.push({event:o,listeners:d}))}}if(!(e&7)){e:{if(o=t==="mouseover"||t==="pointerover",i=t==="mouseout"||t==="pointerout",o&&n!==Xs&&(l=n.relatedTarget||n.fromElement)&&(rn(l)||l[Et]))break e;if((i||o)&&(o=h.window===h?h:(o=h.ownerDocument)?o.defaultView||o.parentWindow:window,i?(l=n.relatedTarget||n.toElement,i=u,l=l?rn(l):null,l!==null&&(a=pn(l),l!==a||l.tag!==5&&l.tag!==6)&&(l=null)):(i=null,l=u),i!==l)){if(d=Ua,x="onMouseLeave",g="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(d=Ha,x="onPointerLeave",g="onPointerEnter",p="pointer"),a=i==null?o:Sn(i),v=l==null?o:Sn(l),o=new d(x,p+"leave",i,n,h),o.target=a,o.relatedTarget=v,x=null,rn(h)===u&&(d=new d(g,p+"enter",l,n,h),d.target=v,d.relatedTarget=a,x=d),a=x,i&&l)t:{for(d=i,g=l,p=0,v=d;v;v=mn(v))p++;for(v=0,x=g;x;x=mn(x))v++;for(;0<p-v;)d=mn(d),p--;for(;0<v-p;)g=mn(g),v--;for(;p--;){if(d===g||g!==null&&d===g.alternate)break t;d=mn(d),g=mn(g)}d=null}else d=null;i!==null&&el(r,o,i,d,!1),l!==null&&a!==null&&el(r,a,l,d,!0)}}e:{if(o=u?Sn(u):window,i=o.nodeName&&o.nodeName.toLowerCase(),i==="select"||i==="input"&&o.type==="file")var C=Hf;else if(Va(o))if(Rc)C=Gf;else{C=Yf;var S=Xf}else(i=o.nodeName)&&i.toLowerCase()==="input"&&(o.type==="checkbox"||o.type==="radio")&&(C=Vf);if(C&&(C=C(t,u))){Nc(r,C,n,h);break e}S&&S(t,o,u),t==="focusout"&&(S=o._wrapperState)&&S.controlled&&o.type==="number"&&Bs(o,"number",o.value)}switch(S=u?Sn(u):window,t){case"focusin":(Va(S)||S.contentEditable==="true")&&(wn=S,Qs=u,ur=null);break;case"focusout":ur=Qs=wn=null;break;case"mousedown":Js=!0;break;case"contextmenu":case"mouseup":case"dragend":Js=!1,Qa(r,n,h);break;case"selectionchange":if(qf)break;case"keydown":case"keyup":Qa(r,n,h)}var T;if(Xo)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else xn?Lc(t,n)&&(P="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(P="onCompositionStart");P&&(Ic&&n.locale!=="ko"&&(xn||P!=="onCompositionStart"?P==="onCompositionEnd"&&xn&&(T=Ac()):(Bt=h,Uo="value"in Bt?Bt.value:Bt.textContent,xn=!0)),S=Ci(u,P),0<S.length&&(P=new Wa(P,t,null,n,h),r.push({event:P,listeners:S}),T?P.data=T:(T=Fc(n),T!==null&&(P.data=T)))),(T=Rf?Bf(t,n):zf(t,n))&&(u=Ci(u,"onBeforeInput"),0<u.length&&(h=new Wa("onBeforeInput","beforeinput",null,n,h),r.push({event:h,listeners:u}),h.data=T))}$c(r,e)})}function Tr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ci(t,e){for(var n=e+"Capture",c=[];t!==null;){var m=t,y=m.stateNode;m.tag===5&&y!==null&&(m=y,y=yr(t,n),y!=null&&c.unshift(Tr(t,y,m)),y=yr(t,e),y!=null&&c.push(Tr(t,y,m))),t=t.return}return c}function mn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function el(t,e,n,c,m){for(var y=e._reactName,w=[];n!==null&&n!==c;){var f=n,s=f.alternate,u=f.stateNode;if(s!==null&&s===c)break;f.tag===5&&u!==null&&(f=u,m?(s=yr(n,y),s!=null&&w.unshift(Tr(n,s,f))):m||(s=yr(n,y),s!=null&&w.push(Tr(n,s,f)))),n=n.return}w.length!==0&&t.push({event:e,listeners:w})}var ed=/\r\n?/g,td=/\u0000|\uFFFD/g;function tl(t){return(typeof t=="string"?t:""+t).replace(ed,`
`).replace(td,"")}function Kr(t,e,n){if(e=tl(e),tl(t)!==e&&n)throw Error(ee(425))}function Si(){}var Zs=null,eo=null;function to(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var no=typeof setTimeout=="function"?setTimeout:void 0,nd=typeof clearTimeout=="function"?clearTimeout:void 0,nl=typeof Promise=="function"?Promise:void 0,rd=typeof queueMicrotask=="function"?queueMicrotask:typeof nl<"u"?function(t){return nl.resolve(null).then(t).catch(id)}:no;function id(t){setTimeout(function(){throw t})}function vs(t,e){var n=e,c=0;do{var m=n.nextSibling;if(t.removeChild(n),m&&m.nodeType===8)if(n=m.data,n==="/$"){if(c===0){t.removeChild(m),Cr(e);return}c--}else n!=="$"&&n!=="$?"&&n!=="$!"||c++;n=m}while(n);Cr(e)}function Xt(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function rl(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Vn=Math.random().toString(36).slice(2),wt="__reactFiber$"+Vn,kr="__reactProps$"+Vn,Et="__reactContainer$"+Vn,ro="__reactEvents$"+Vn,sd="__reactListeners$"+Vn,od="__reactHandles$"+Vn;function rn(t){var e=t[wt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Et]||n[wt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=rl(t);t!==null;){if(n=t[wt])return n;t=rl(t)}return e}t=n,n=t.parentNode}return null}function Nr(t){return t=t[wt]||t[Et],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Sn(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ee(33))}function Hi(t){return t[kr]||null}var io=[],_n=-1;function Jt(t){return{current:t}}function we(t){0>_n||(t.current=io[_n],io[_n]=null,_n--)}function ve(t,e){_n++,io[_n]=t.current,t.current=e}var qt={},ze=Jt(qt),Ke=Jt(!1),cn=qt;function Nn(t,e){var n=t.type.contextTypes;if(!n)return qt;var c=t.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===e)return c.__reactInternalMemoizedMaskedChildContext;var m={},y;for(y in n)m[y]=e[y];return c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=m),m}function qe(t){return t=t.childContextTypes,t!=null}function _i(){we(Ke),we(ze)}function il(t,e,n){if(ze.current!==qt)throw Error(ee(168));ve(ze,e),ve(Ke,n)}function qc(t,e,n){var c=t.stateNode;if(e=e.childContextTypes,typeof c.getChildContext!="function")return n;c=c.getChildContext();for(var m in c)if(!(m in e))throw Error(ee(108,Hh(t)||"Unknown",m));return Te({},n,c)}function bi(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||qt,cn=ze.current,ve(ze,t),ve(Ke,Ke.current),!0}function sl(t,e,n){var c=t.stateNode;if(!c)throw Error(ee(169));n?(t=qc(t,e,cn),c.__reactInternalMemoizedMergedChildContext=t,we(Ke),we(ze),ve(ze,t)):we(Ke),ve(Ke,n)}var bt=null,Xi=!1,ys=!1;function Qc(t){bt===null?bt=[t]:bt.push(t)}function ad(t){Xi=!0,Qc(t)}function Zt(){if(!ys&&bt!==null){ys=!0;var t=0,e=pe;try{var n=bt;for(pe=1;t<n.length;t++){var c=n[t];do c=c(!0);while(c!==null)}bt=null,Xi=!1}catch(m){throw bt!==null&&(bt=bt.slice(t+1)),Sc(No,Zt),m}finally{pe=e,ys=!1}}return null}var bn=[],Tn=0,Ti=null,ki=0,it=[],st=0,un=null,Tt=1,kt="";function tn(t,e){bn[Tn++]=ki,bn[Tn++]=Ti,Ti=t,ki=e}function Jc(t,e,n){it[st++]=Tt,it[st++]=kt,it[st++]=un,un=t;var c=Tt;t=kt;var m=32-gt(c)-1;c&=~(1<<m),n+=1;var y=32-gt(e)+m;if(30<y){var w=m-m%5;y=(c&(1<<w)-1).toString(32),c>>=w,m-=w,Tt=1<<32-gt(e)+m|n<<m|c,kt=y+t}else Tt=1<<y|n<<m|c,kt=t}function Vo(t){t.return!==null&&(tn(t,1),Jc(t,1,0))}function Go(t){for(;t===Ti;)Ti=bn[--Tn],bn[Tn]=null,ki=bn[--Tn],bn[Tn]=null;for(;t===un;)un=it[--st],it[st]=null,kt=it[--st],it[st]=null,Tt=it[--st],it[st]=null}var et=null,Ze=null,Se=!1,dt=null;function Zc(t,e){var n=ot(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function ol(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,et=t,Ze=Xt(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,et=t,Ze=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=un!==null?{id:Tt,overflow:kt}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ot(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,et=t,Ze=null,!0):!1;default:return!1}}function so(t){return(t.mode&1)!==0&&(t.flags&128)===0}function oo(t){if(Se){var e=Ze;if(e){var n=e;if(!ol(t,e)){if(so(t))throw Error(ee(418));e=Xt(n.nextSibling);var c=et;e&&ol(t,e)?Zc(c,n):(t.flags=t.flags&-4097|2,Se=!1,et=t)}}else{if(so(t))throw Error(ee(418));t.flags=t.flags&-4097|2,Se=!1,et=t}}}function al(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;et=t}function qr(t){if(t!==et)return!1;if(!Se)return al(t),Se=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!to(t.type,t.memoizedProps)),e&&(e=Ze)){if(so(t))throw eu(),Error(ee(418));for(;e;)Zc(t,e),e=Xt(e.nextSibling)}if(al(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ee(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ze=Xt(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ze=null}}else Ze=et?Xt(t.stateNode.nextSibling):null;return!0}function eu(){for(var t=Ze;t;)t=Xt(t.nextSibling)}function Rn(){Ze=et=null,Se=!1}function $o(t){dt===null?dt=[t]:dt.push(t)}var ld=Dt.ReactCurrentBatchConfig;function Zn(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ee(309));var c=n.stateNode}if(!c)throw Error(ee(147,t));var m=c,y=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===y?e.ref:(e=function(w){var f=m.refs;w===null?delete f[y]:f[y]=w},e._stringRef=y,e)}if(typeof t!="string")throw Error(ee(284));if(!n._owner)throw Error(ee(290,t))}return t}function Qr(t,e){throw t=Object.prototype.toString.call(e),Error(ee(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ll(t){var e=t._init;return e(t._payload)}function tu(t){function e(g,p){if(t){var v=g.deletions;v===null?(g.deletions=[p],g.flags|=16):v.push(p)}}function n(g,p){if(!t)return null;for(;p!==null;)e(g,p),p=p.sibling;return null}function c(g,p){for(g=new Map;p!==null;)p.key!==null?g.set(p.key,p):g.set(p.index,p),p=p.sibling;return g}function m(g,p){return g=$t(g,p),g.index=0,g.sibling=null,g}function y(g,p,v){return g.index=v,t?(v=g.alternate,v!==null?(v=v.index,v<p?(g.flags|=2,p):v):(g.flags|=2,p)):(g.flags|=1048576,p)}function w(g){return t&&g.alternate===null&&(g.flags|=2),g}function f(g,p,v,x){return p===null||p.tag!==6?(p=Ts(v,g.mode,x),p.return=g,p):(p=m(p,v),p.return=g,p)}function s(g,p,v,x){var C=v.type;return C===yn?h(g,p,v.props.children,x,v.key):p!==null&&(p.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Lt&&ll(C)===p.type)?(x=m(p,v.props),x.ref=Zn(g,p,v),x.return=g,x):(x=di(v.type,v.key,v.props,null,g.mode,x),x.ref=Zn(g,p,v),x.return=g,x)}function u(g,p,v,x){return p===null||p.tag!==4||p.stateNode.containerInfo!==v.containerInfo||p.stateNode.implementation!==v.implementation?(p=ks(v,g.mode,x),p.return=g,p):(p=m(p,v.children||[]),p.return=g,p)}function h(g,p,v,x,C){return p===null||p.tag!==7?(p=ln(v,g.mode,x,C),p.return=g,p):(p=m(p,v),p.return=g,p)}function r(g,p,v){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Ts(""+p,g.mode,v),p.return=g,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case zr:return v=di(p.type,p.key,p.props,null,g.mode,v),v.ref=Zn(g,null,p),v.return=g,v;case vn:return p=ks(p,g.mode,v),p.return=g,p;case Lt:var x=p._init;return r(g,x(p._payload),v)}if(rr(p)||$n(p))return p=ln(p,g.mode,v,null),p.return=g,p;Qr(g,p)}return null}function o(g,p,v,x){var C=p!==null?p.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return C!==null?null:f(g,p,""+v,x);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case zr:return v.key===C?s(g,p,v,x):null;case vn:return v.key===C?u(g,p,v,x):null;case Lt:return C=v._init,o(g,p,C(v._payload),x)}if(rr(v)||$n(v))return C!==null?null:h(g,p,v,x,null);Qr(g,v)}return null}function i(g,p,v,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(v)||null,f(p,g,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case zr:return g=g.get(x.key===null?v:x.key)||null,s(p,g,x,C);case vn:return g=g.get(x.key===null?v:x.key)||null,u(p,g,x,C);case Lt:var S=x._init;return i(g,p,v,S(x._payload),C)}if(rr(x)||$n(x))return g=g.get(v)||null,h(p,g,x,C,null);Qr(p,x)}return null}function l(g,p,v,x){for(var C=null,S=null,T=p,P=p=0,R=null;T!==null&&P<v.length;P++){T.index>P?(R=T,T=null):R=T.sibling;var z=o(g,T,v[P],x);if(z===null){T===null&&(T=R);break}t&&T&&z.alternate===null&&e(g,T),p=y(z,p,P),S===null?C=z:S.sibling=z,S=z,T=R}if(P===v.length)return n(g,T),Se&&tn(g,P),C;if(T===null){for(;P<v.length;P++)T=r(g,v[P],x),T!==null&&(p=y(T,p,P),S===null?C=T:S.sibling=T,S=T);return Se&&tn(g,P),C}for(T=c(g,T);P<v.length;P++)R=i(T,g,P,v[P],x),R!==null&&(t&&R.alternate!==null&&T.delete(R.key===null?P:R.key),p=y(R,p,P),S===null?C=R:S.sibling=R,S=R);return t&&T.forEach(function(J){return e(g,J)}),Se&&tn(g,P),C}function d(g,p,v,x){var C=$n(v);if(typeof C!="function")throw Error(ee(150));if(v=C.call(v),v==null)throw Error(ee(151));for(var S=C=null,T=p,P=p=0,R=null,z=v.next();T!==null&&!z.done;P++,z=v.next()){T.index>P?(R=T,T=null):R=T.sibling;var J=o(g,T,z.value,x);if(J===null){T===null&&(T=R);break}t&&T&&J.alternate===null&&e(g,T),p=y(J,p,P),S===null?C=J:S.sibling=J,S=J,T=R}if(z.done)return n(g,T),Se&&tn(g,P),C;if(T===null){for(;!z.done;P++,z=v.next())z=r(g,z.value,x),z!==null&&(p=y(z,p,P),S===null?C=z:S.sibling=z,S=z);return Se&&tn(g,P),C}for(T=c(g,T);!z.done;P++,z=v.next())z=i(T,g,P,z.value,x),z!==null&&(t&&z.alternate!==null&&T.delete(z.key===null?P:z.key),p=y(z,p,P),S===null?C=z:S.sibling=z,S=z);return t&&T.forEach(function(ne){return e(g,ne)}),Se&&tn(g,P),C}function a(g,p,v,x){if(typeof v=="object"&&v!==null&&v.type===yn&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case zr:e:{for(var C=v.key,S=p;S!==null;){if(S.key===C){if(C=v.type,C===yn){if(S.tag===7){n(g,S.sibling),p=m(S,v.props.children),p.return=g,g=p;break e}}else if(S.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Lt&&ll(C)===S.type){n(g,S.sibling),p=m(S,v.props),p.ref=Zn(g,S,v),p.return=g,g=p;break e}n(g,S);break}else e(g,S);S=S.sibling}v.type===yn?(p=ln(v.props.children,g.mode,x,v.key),p.return=g,g=p):(x=di(v.type,v.key,v.props,null,g.mode,x),x.ref=Zn(g,p,v),x.return=g,g=x)}return w(g);case vn:e:{for(S=v.key;p!==null;){if(p.key===S)if(p.tag===4&&p.stateNode.containerInfo===v.containerInfo&&p.stateNode.implementation===v.implementation){n(g,p.sibling),p=m(p,v.children||[]),p.return=g,g=p;break e}else{n(g,p);break}else e(g,p);p=p.sibling}p=ks(v,g.mode,x),p.return=g,g=p}return w(g);case Lt:return S=v._init,a(g,p,S(v._payload),x)}if(rr(v))return l(g,p,v,x);if($n(v))return d(g,p,v,x);Qr(g,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,p!==null&&p.tag===6?(n(g,p.sibling),p=m(p,v),p.return=g,g=p):(n(g,p),p=Ts(v,g.mode,x),p.return=g,g=p),w(g)):n(g,p)}return a}var Bn=tu(!0),nu=tu(!1),Oi=Jt(null),Pi=null,kn=null,Ko=null;function qo(){Ko=kn=Pi=null}function Qo(t){var e=Oi.current;we(Oi),t._currentValue=e}function ao(t,e,n){for(;t!==null;){var c=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,c!==null&&(c.childLanes|=e)):c!==null&&(c.childLanes&e)!==e&&(c.childLanes|=e),t===n)break;t=t.return}}function An(t,e){Pi=t,Ko=kn=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&($e=!0),t.firstContext=null)}function lt(t){var e=t._currentValue;if(Ko!==t)if(t={context:t,memoizedValue:e,next:null},kn===null){if(Pi===null)throw Error(ee(308));kn=t,Pi.dependencies={lanes:0,firstContext:t}}else kn=kn.next=t;return e}var sn=null;function Jo(t){sn===null?sn=[t]:sn.push(t)}function ru(t,e,n,c){var m=e.interleaved;return m===null?(n.next=n,Jo(e)):(n.next=m.next,m.next=n),e.interleaved=n,jt(t,c)}function jt(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ft=!1;function Zo(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function iu(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ot(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yt(t,e,n){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,de&2){var m=c.pending;return m===null?e.next=e:(e.next=m.next,m.next=e),c.pending=e,jt(t,n)}return m=c.interleaved,m===null?(e.next=e,Jo(c)):(e.next=m.next,m.next=e),c.interleaved=e,jt(t,n)}function ai(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,Ro(t,n)}}function cl(t,e){var n=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,n===c)){var m=null,y=null;if(n=n.firstBaseUpdate,n!==null){do{var w={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};y===null?m=y=w:y=y.next=w,n=n.next}while(n!==null);y===null?m=y=e:y=y.next=e}else m=y=e;n={baseState:c.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:c.shared,effects:c.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ei(t,e,n,c){var m=t.updateQueue;Ft=!1;var y=m.firstBaseUpdate,w=m.lastBaseUpdate,f=m.shared.pending;if(f!==null){m.shared.pending=null;var s=f,u=s.next;s.next=null,w===null?y=u:w.next=u,w=s;var h=t.alternate;h!==null&&(h=h.updateQueue,f=h.lastBaseUpdate,f!==w&&(f===null?h.firstBaseUpdate=u:f.next=u,h.lastBaseUpdate=s))}if(y!==null){var r=m.baseState;w=0,h=u=s=null,f=y;do{var o=f.lane,i=f.eventTime;if((c&o)===o){h!==null&&(h=h.next={eventTime:i,lane:0,tag:f.tag,payload:f.payload,callback:f.callback,next:null});e:{var l=t,d=f;switch(o=e,i=n,d.tag){case 1:if(l=d.payload,typeof l=="function"){r=l.call(i,r,o);break e}r=l;break e;case 3:l.flags=l.flags&-65537|128;case 0:if(l=d.payload,o=typeof l=="function"?l.call(i,r,o):l,o==null)break e;r=Te({},r,o);break e;case 2:Ft=!0}}f.callback!==null&&f.lane!==0&&(t.flags|=64,o=m.effects,o===null?m.effects=[f]:o.push(f))}else i={eventTime:i,lane:o,tag:f.tag,payload:f.payload,callback:f.callback,next:null},h===null?(u=h=i,s=r):h=h.next=i,w|=o;if(f=f.next,f===null){if(f=m.shared.pending,f===null)break;o=f,f=o.next,o.next=null,m.lastBaseUpdate=o,m.shared.pending=null}}while(1);if(h===null&&(s=r),m.baseState=s,m.firstBaseUpdate=u,m.lastBaseUpdate=h,e=m.shared.interleaved,e!==null){m=e;do w|=m.lane,m=m.next;while(m!==e)}else y===null&&(m.shared.lanes=0);fn|=w,t.lanes=w,t.memoizedState=r}}function ul(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var c=t[e],m=c.callback;if(m!==null){if(c.callback=null,c=n,typeof m!="function")throw Error(ee(191,m));m.call(c)}}}var Rr={},St=Jt(Rr),Or=Jt(Rr),Pr=Jt(Rr);function on(t){if(t===Rr)throw Error(ee(174));return t}function ea(t,e){switch(ve(Pr,e),ve(Or,t),ve(St,Rr),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Us(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Us(e,t)}we(St),ve(St,e)}function zn(){we(St),we(Or),we(Pr)}function su(t){on(Pr.current);var e=on(St.current),n=Us(e,t.type);e!==n&&(ve(Or,t),ve(St,n))}function ta(t){Or.current===t&&(we(St),we(Or))}var _e=Jt(0);function ji(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xs=[];function na(){for(var t=0;t<xs.length;t++)xs[t]._workInProgressVersionPrimary=null;xs.length=0}var li=Dt.ReactCurrentDispatcher,ws=Dt.ReactCurrentBatchConfig,hn=0,be=null,je=null,De=null,Mi=!1,hr=!1,Er=0,cd=0;function Ne(){throw Error(ee(321))}function ra(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!mt(t[n],e[n]))return!1;return!0}function ia(t,e,n,c,m,y){if(hn=y,be=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,li.current=t===null||t.memoizedState===null?dd:gd,t=n(c,m),hr){y=0;do{if(hr=!1,Er=0,25<=y)throw Error(ee(301));y+=1,De=je=null,e.updateQueue=null,li.current=pd,t=n(c,m)}while(hr)}if(li.current=Di,e=je!==null&&je.next!==null,hn=0,De=je=be=null,Mi=!1,e)throw Error(ee(300));return t}function sa(){var t=Er!==0;return Er=0,t}function xt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return De===null?be.memoizedState=De=t:De=De.next=t,De}function ct(){if(je===null){var t=be.alternate;t=t!==null?t.memoizedState:null}else t=je.next;var e=De===null?be.memoizedState:De.next;if(e!==null)De=e,je=t;else{if(t===null)throw Error(ee(310));je=t,t={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},De===null?be.memoizedState=De=t:De=De.next=t}return De}function jr(t,e){return typeof e=="function"?e(t):e}function Cs(t){var e=ct(),n=e.queue;if(n===null)throw Error(ee(311));n.lastRenderedReducer=t;var c=je,m=c.baseQueue,y=n.pending;if(y!==null){if(m!==null){var w=m.next;m.next=y.next,y.next=w}c.baseQueue=m=y,n.pending=null}if(m!==null){y=m.next,c=c.baseState;var f=w=null,s=null,u=y;do{var h=u.lane;if((hn&h)===h)s!==null&&(s=s.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),c=u.hasEagerState?u.eagerState:t(c,u.action);else{var r={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};s===null?(f=s=r,w=c):s=s.next=r,be.lanes|=h,fn|=h}u=u.next}while(u!==null&&u!==y);s===null?w=c:s.next=f,mt(c,e.memoizedState)||($e=!0),e.memoizedState=c,e.baseState=w,e.baseQueue=s,n.lastRenderedState=c}if(t=n.interleaved,t!==null){m=t;do y=m.lane,be.lanes|=y,fn|=y,m=m.next;while(m!==t)}else m===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Ss(t){var e=ct(),n=e.queue;if(n===null)throw Error(ee(311));n.lastRenderedReducer=t;var c=n.dispatch,m=n.pending,y=e.memoizedState;if(m!==null){n.pending=null;var w=m=m.next;do y=t(y,w.action),w=w.next;while(w!==m);mt(y,e.memoizedState)||($e=!0),e.memoizedState=y,e.baseQueue===null&&(e.baseState=y),n.lastRenderedState=y}return[y,c]}function ou(){}function au(t,e){var n=be,c=ct(),m=e(),y=!mt(c.memoizedState,m);if(y&&(c.memoizedState=m,$e=!0),c=c.queue,oa(uu.bind(null,n,c,t),[t]),c.getSnapshot!==e||y||De!==null&&De.memoizedState.tag&1){if(n.flags|=2048,Mr(9,cu.bind(null,n,c,m,e),void 0,null),Ae===null)throw Error(ee(349));hn&30||lu(n,e,m)}return m}function lu(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=be.updateQueue,e===null?(e={lastEffect:null,stores:null},be.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function cu(t,e,n,c){e.value=n,e.getSnapshot=c,hu(e)&&fu(t)}function uu(t,e,n){return n(function(){hu(e)&&fu(t)})}function hu(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!mt(t,n)}catch{return!0}}function fu(t){var e=jt(t,1);e!==null&&pt(e,t,1,-1)}function hl(t){var e=xt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jr,lastRenderedState:t},e.queue=t,t=t.dispatch=fd.bind(null,be,t),[e.memoizedState,t]}function Mr(t,e,n,c){return t={tag:t,create:e,destroy:n,deps:c,next:null},e=be.updateQueue,e===null?(e={lastEffect:null,stores:null},be.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(c=n.next,n.next=t,t.next=c,e.lastEffect=t)),t}function du(){return ct().memoizedState}function ci(t,e,n,c){var m=xt();be.flags|=t,m.memoizedState=Mr(1|e,n,void 0,c===void 0?null:c)}function Yi(t,e,n,c){var m=ct();c=c===void 0?null:c;var y=void 0;if(je!==null){var w=je.memoizedState;if(y=w.destroy,c!==null&&ra(c,w.deps)){m.memoizedState=Mr(e,n,y,c);return}}be.flags|=t,m.memoizedState=Mr(1|e,n,y,c)}function fl(t,e){return ci(8390656,8,t,e)}function oa(t,e){return Yi(2048,8,t,e)}function gu(t,e){return Yi(4,2,t,e)}function pu(t,e){return Yi(4,4,t,e)}function mu(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function vu(t,e,n){return n=n!=null?n.concat([t]):null,Yi(4,4,mu.bind(null,e,t),n)}function aa(){}function yu(t,e){var n=ct();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&ra(e,c[1])?c[0]:(n.memoizedState=[t,e],t)}function xu(t,e){var n=ct();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&ra(e,c[1])?c[0]:(t=t(),n.memoizedState=[t,e],t)}function wu(t,e,n){return hn&21?(mt(n,e)||(n=Tc(),be.lanes|=n,fn|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,$e=!0),t.memoizedState=n)}function ud(t,e){var n=pe;pe=n!==0&&4>n?n:4,t(!0);var c=ws.transition;ws.transition={};try{t(!1),e()}finally{pe=n,ws.transition=c}}function Cu(){return ct().memoizedState}function hd(t,e,n){var c=Gt(t);if(n={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null},Su(t))_u(e,n);else if(n=ru(t,e,n,c),n!==null){var m=Xe();pt(n,t,c,m),bu(n,e,c)}}function fd(t,e,n){var c=Gt(t),m={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null};if(Su(t))_u(e,m);else{var y=t.alternate;if(t.lanes===0&&(y===null||y.lanes===0)&&(y=e.lastRenderedReducer,y!==null))try{var w=e.lastRenderedState,f=y(w,n);if(m.hasEagerState=!0,m.eagerState=f,mt(f,w)){var s=e.interleaved;s===null?(m.next=m,Jo(e)):(m.next=s.next,s.next=m),e.interleaved=m;return}}catch{}finally{}n=ru(t,e,m,c),n!==null&&(m=Xe(),pt(n,t,c,m),bu(n,e,c))}}function Su(t){var e=t.alternate;return t===be||e!==null&&e===be}function _u(t,e){hr=Mi=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function bu(t,e,n){if(n&4194240){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,Ro(t,n)}}var Di={readContext:lt,useCallback:Ne,useContext:Ne,useEffect:Ne,useImperativeHandle:Ne,useInsertionEffect:Ne,useLayoutEffect:Ne,useMemo:Ne,useReducer:Ne,useRef:Ne,useState:Ne,useDebugValue:Ne,useDeferredValue:Ne,useTransition:Ne,useMutableSource:Ne,useSyncExternalStore:Ne,useId:Ne,unstable_isNewReconciler:!1},dd={readContext:lt,useCallback:function(t,e){return xt().memoizedState=[t,e===void 0?null:e],t},useContext:lt,useEffect:fl,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ci(4194308,4,mu.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ci(4194308,4,t,e)},useInsertionEffect:function(t,e){return ci(4,2,t,e)},useMemo:function(t,e){var n=xt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var c=xt();return e=n!==void 0?n(e):e,c.memoizedState=c.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},c.queue=t,t=t.dispatch=hd.bind(null,be,t),[c.memoizedState,t]},useRef:function(t){var e=xt();return t={current:t},e.memoizedState=t},useState:hl,useDebugValue:aa,useDeferredValue:function(t){return xt().memoizedState=t},useTransition:function(){var t=hl(!1),e=t[0];return t=ud.bind(null,t[1]),xt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var c=be,m=xt();if(Se){if(n===void 0)throw Error(ee(407));n=n()}else{if(n=e(),Ae===null)throw Error(ee(349));hn&30||lu(c,e,n)}m.memoizedState=n;var y={value:n,getSnapshot:e};return m.queue=y,fl(uu.bind(null,c,y,t),[t]),c.flags|=2048,Mr(9,cu.bind(null,c,y,n,e),void 0,null),n},useId:function(){var t=xt(),e=Ae.identifierPrefix;if(Se){var n=kt,c=Tt;n=(c&~(1<<32-gt(c)-1)).toString(32)+n,e=":"+e+"R"+n,n=Er++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=cd++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},gd={readContext:lt,useCallback:yu,useContext:lt,useEffect:oa,useImperativeHandle:vu,useInsertionEffect:gu,useLayoutEffect:pu,useMemo:xu,useReducer:Cs,useRef:du,useState:function(){return Cs(jr)},useDebugValue:aa,useDeferredValue:function(t){var e=ct();return wu(e,je.memoizedState,t)},useTransition:function(){var t=Cs(jr)[0],e=ct().memoizedState;return[t,e]},useMutableSource:ou,useSyncExternalStore:au,useId:Cu,unstable_isNewReconciler:!1},pd={readContext:lt,useCallback:yu,useContext:lt,useEffect:oa,useImperativeHandle:vu,useInsertionEffect:gu,useLayoutEffect:pu,useMemo:xu,useReducer:Ss,useRef:du,useState:function(){return Ss(jr)},useDebugValue:aa,useDeferredValue:function(t){var e=ct();return je===null?e.memoizedState=t:wu(e,je.memoizedState,t)},useTransition:function(){var t=Ss(jr)[0],e=ct().memoizedState;return[t,e]},useMutableSource:ou,useSyncExternalStore:au,useId:Cu,unstable_isNewReconciler:!1};function ht(t,e){if(t&&t.defaultProps){e=Te({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function lo(t,e,n,c){e=t.memoizedState,n=n(c,e),n=n==null?e:Te({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Vi={isMounted:function(t){return(t=t._reactInternals)?pn(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var c=Xe(),m=Gt(t),y=Ot(c,m);y.payload=e,n!=null&&(y.callback=n),e=Yt(t,y,m),e!==null&&(pt(e,t,m,c),ai(e,t,m))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var c=Xe(),m=Gt(t),y=Ot(c,m);y.tag=1,y.payload=e,n!=null&&(y.callback=n),e=Yt(t,y,m),e!==null&&(pt(e,t,m,c),ai(e,t,m))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Xe(),c=Gt(t),m=Ot(n,c);m.tag=2,e!=null&&(m.callback=e),e=Yt(t,m,c),e!==null&&(pt(e,t,c,n),ai(e,t,c))}};function dl(t,e,n,c,m,y,w){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,y,w):e.prototype&&e.prototype.isPureReactComponent?!_r(n,c)||!_r(m,y):!0}function Tu(t,e,n){var c=!1,m=qt,y=e.contextType;return typeof y=="object"&&y!==null?y=lt(y):(m=qe(e)?cn:ze.current,c=e.contextTypes,y=(c=c!=null)?Nn(t,m):qt),e=new e(n,y),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vi,t.stateNode=e,e._reactInternals=t,c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=m,t.__reactInternalMemoizedMaskedChildContext=y),e}function gl(t,e,n,c){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,c),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,c),e.state!==t&&Vi.enqueueReplaceState(e,e.state,null)}function co(t,e,n,c){var m=t.stateNode;m.props=n,m.state=t.memoizedState,m.refs={},Zo(t);var y=e.contextType;typeof y=="object"&&y!==null?m.context=lt(y):(y=qe(e)?cn:ze.current,m.context=Nn(t,y)),m.state=t.memoizedState,y=e.getDerivedStateFromProps,typeof y=="function"&&(lo(t,e,y,n),m.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(e=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),e!==m.state&&Vi.enqueueReplaceState(m,m.state,null),Ei(t,n,m,c),m.state=t.memoizedState),typeof m.componentDidMount=="function"&&(t.flags|=4194308)}function Un(t,e){try{var n="",c=e;do n+=Wh(c),c=c.return;while(c);var m=n}catch(y){m=`
Error generating stack: `+y.message+`
`+y.stack}return{value:t,source:e,stack:m,digest:null}}function _s(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function uo(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var md=typeof WeakMap=="function"?WeakMap:Map;function ku(t,e,n){n=Ot(-1,n),n.tag=3,n.payload={element:null};var c=e.value;return n.callback=function(){Ii||(Ii=!0,Co=c),uo(t,e)},n}function Ou(t,e,n){n=Ot(-1,n),n.tag=3;var c=t.type.getDerivedStateFromError;if(typeof c=="function"){var m=e.value;n.payload=function(){return c(m)},n.callback=function(){uo(t,e)}}var y=t.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(n.callback=function(){uo(t,e),typeof c!="function"&&(Vt===null?Vt=new Set([this]):Vt.add(this));var w=e.stack;this.componentDidCatch(e.value,{componentStack:w!==null?w:""})}),n}function pl(t,e,n){var c=t.pingCache;if(c===null){c=t.pingCache=new md;var m=new Set;c.set(e,m)}else m=c.get(e),m===void 0&&(m=new Set,c.set(e,m));m.has(n)||(m.add(n),t=jd.bind(null,t,e,n),e.then(t,t))}function ml(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function vl(t,e,n,c,m){return t.mode&1?(t.flags|=65536,t.lanes=m,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ot(-1,1),e.tag=2,Yt(n,e,1))),n.lanes|=1),t)}var vd=Dt.ReactCurrentOwner,$e=!1;function We(t,e,n,c){e.child=t===null?nu(e,null,n,c):Bn(e,t.child,n,c)}function yl(t,e,n,c,m){n=n.render;var y=e.ref;return An(e,m),c=ia(t,e,n,c,y,m),n=sa(),t!==null&&!$e?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~m,Mt(t,e,m)):(Se&&n&&Vo(e),e.flags|=1,We(t,e,c,m),e.child)}function xl(t,e,n,c,m){if(t===null){var y=n.type;return typeof y=="function"&&!pa(y)&&y.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=y,Pu(t,e,y,c,m)):(t=di(n.type,null,c,e,e.mode,m),t.ref=e.ref,t.return=e,e.child=t)}if(y=t.child,!(t.lanes&m)){var w=y.memoizedProps;if(n=n.compare,n=n!==null?n:_r,n(w,c)&&t.ref===e.ref)return Mt(t,e,m)}return e.flags|=1,t=$t(y,c),t.ref=e.ref,t.return=e,e.child=t}function Pu(t,e,n,c,m){if(t!==null){var y=t.memoizedProps;if(_r(y,c)&&t.ref===e.ref)if($e=!1,e.pendingProps=c=y,(t.lanes&m)!==0)t.flags&131072&&($e=!0);else return e.lanes=t.lanes,Mt(t,e,m)}return ho(t,e,n,c,m)}function Eu(t,e,n){var c=e.pendingProps,m=c.children,y=t!==null?t.memoizedState:null;if(c.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ve(Pn,Je),Je|=n;else{if(!(n&1073741824))return t=y!==null?y.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ve(Pn,Je),Je|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=y!==null?y.baseLanes:n,ve(Pn,Je),Je|=c}else y!==null?(c=y.baseLanes|n,e.memoizedState=null):c=n,ve(Pn,Je),Je|=c;return We(t,e,m,n),e.child}function ju(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function ho(t,e,n,c,m){var y=qe(n)?cn:ze.current;return y=Nn(e,y),An(e,m),n=ia(t,e,n,c,y,m),c=sa(),t!==null&&!$e?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~m,Mt(t,e,m)):(Se&&c&&Vo(e),e.flags|=1,We(t,e,n,m),e.child)}function wl(t,e,n,c,m){if(qe(n)){var y=!0;bi(e)}else y=!1;if(An(e,m),e.stateNode===null)ui(t,e),Tu(e,n,c),co(e,n,c,m),c=!0;else if(t===null){var w=e.stateNode,f=e.memoizedProps;w.props=f;var s=w.context,u=n.contextType;typeof u=="object"&&u!==null?u=lt(u):(u=qe(n)?cn:ze.current,u=Nn(e,u));var h=n.getDerivedStateFromProps,r=typeof h=="function"||typeof w.getSnapshotBeforeUpdate=="function";r||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(f!==c||s!==u)&&gl(e,w,c,u),Ft=!1;var o=e.memoizedState;w.state=o,Ei(e,c,w,m),s=e.memoizedState,f!==c||o!==s||Ke.current||Ft?(typeof h=="function"&&(lo(e,n,h,c),s=e.memoizedState),(f=Ft||dl(e,n,f,c,o,s,u))?(r||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(e.flags|=4194308)):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=c,e.memoizedState=s),w.props=c,w.state=s,w.context=u,c=f):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),c=!1)}else{w=e.stateNode,iu(t,e),f=e.memoizedProps,u=e.type===e.elementType?f:ht(e.type,f),w.props=u,r=e.pendingProps,o=w.context,s=n.contextType,typeof s=="object"&&s!==null?s=lt(s):(s=qe(n)?cn:ze.current,s=Nn(e,s));var i=n.getDerivedStateFromProps;(h=typeof i=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(f!==r||o!==s)&&gl(e,w,c,s),Ft=!1,o=e.memoizedState,w.state=o,Ei(e,c,w,m);var l=e.memoizedState;f!==r||o!==l||Ke.current||Ft?(typeof i=="function"&&(lo(e,n,i,c),l=e.memoizedState),(u=Ft||dl(e,n,u,c,o,l,s)||!1)?(h||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(c,l,s),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(c,l,s)),typeof w.componentDidUpdate=="function"&&(e.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof w.componentDidUpdate!="function"||f===t.memoizedProps&&o===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||f===t.memoizedProps&&o===t.memoizedState||(e.flags|=1024),e.memoizedProps=c,e.memoizedState=l),w.props=c,w.state=l,w.context=s,c=u):(typeof w.componentDidUpdate!="function"||f===t.memoizedProps&&o===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||f===t.memoizedProps&&o===t.memoizedState||(e.flags|=1024),c=!1)}return fo(t,e,n,c,y,m)}function fo(t,e,n,c,m,y){ju(t,e);var w=(e.flags&128)!==0;if(!c&&!w)return m&&sl(e,n,!1),Mt(t,e,y);c=e.stateNode,vd.current=e;var f=w&&typeof n.getDerivedStateFromError!="function"?null:c.render();return e.flags|=1,t!==null&&w?(e.child=Bn(e,t.child,null,y),e.child=Bn(e,null,f,y)):We(t,e,f,y),e.memoizedState=c.state,m&&sl(e,n,!0),e.child}function Mu(t){var e=t.stateNode;e.pendingContext?il(t,e.pendingContext,e.pendingContext!==e.context):e.context&&il(t,e.context,!1),ea(t,e.containerInfo)}function Cl(t,e,n,c,m){return Rn(),$o(m),e.flags|=256,We(t,e,n,c),e.child}var go={dehydrated:null,treeContext:null,retryLane:0};function po(t){return{baseLanes:t,cachePool:null,transitions:null}}function Du(t,e,n){var c=e.pendingProps,m=_e.current,y=!1,w=(e.flags&128)!==0,f;if((f=w)||(f=t!==null&&t.memoizedState===null?!1:(m&2)!==0),f?(y=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(m|=1),ve(_e,m&1),t===null)return oo(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(w=c.children,t=c.fallback,y?(c=e.mode,y=e.child,w={mode:"hidden",children:w},!(c&1)&&y!==null?(y.childLanes=0,y.pendingProps=w):y=Ki(w,c,0,null),t=ln(t,c,n,null),y.return=e,t.return=e,y.sibling=t,e.child=y,e.child.memoizedState=po(n),e.memoizedState=go,t):la(e,w));if(m=t.memoizedState,m!==null&&(f=m.dehydrated,f!==null))return yd(t,e,w,c,f,m,n);if(y){y=c.fallback,w=e.mode,m=t.child,f=m.sibling;var s={mode:"hidden",children:c.children};return!(w&1)&&e.child!==m?(c=e.child,c.childLanes=0,c.pendingProps=s,e.deletions=null):(c=$t(m,s),c.subtreeFlags=m.subtreeFlags&14680064),f!==null?y=$t(f,y):(y=ln(y,w,n,null),y.flags|=2),y.return=e,c.return=e,c.sibling=y,e.child=c,c=y,y=e.child,w=t.child.memoizedState,w=w===null?po(n):{baseLanes:w.baseLanes|n,cachePool:null,transitions:w.transitions},y.memoizedState=w,y.childLanes=t.childLanes&~n,e.memoizedState=go,c}return y=t.child,t=y.sibling,c=$t(y,{mode:"visible",children:c.children}),!(e.mode&1)&&(c.lanes=n),c.return=e,c.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=c,e.memoizedState=null,c}function la(t,e){return e=Ki({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Jr(t,e,n,c){return c!==null&&$o(c),Bn(e,t.child,null,n),t=la(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function yd(t,e,n,c,m,y,w){if(n)return e.flags&256?(e.flags&=-257,c=_s(Error(ee(422))),Jr(t,e,w,c)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(y=c.fallback,m=e.mode,c=Ki({mode:"visible",children:c.children},m,0,null),y=ln(y,m,w,null),y.flags|=2,c.return=e,y.return=e,c.sibling=y,e.child=c,e.mode&1&&Bn(e,t.child,null,w),e.child.memoizedState=po(w),e.memoizedState=go,y);if(!(e.mode&1))return Jr(t,e,w,null);if(m.data==="$!"){if(c=m.nextSibling&&m.nextSibling.dataset,c)var f=c.dgst;return c=f,y=Error(ee(419)),c=_s(y,c,void 0),Jr(t,e,w,c)}if(f=(w&t.childLanes)!==0,$e||f){if(c=Ae,c!==null){switch(w&-w){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(c.suspendedLanes|w)?0:m,m!==0&&m!==y.retryLane&&(y.retryLane=m,jt(t,m),pt(c,t,m,-1))}return ga(),c=_s(Error(ee(421))),Jr(t,e,w,c)}return m.data==="$?"?(e.flags|=128,e.child=t.child,e=Md.bind(null,t),m._reactRetry=e,null):(t=y.treeContext,Ze=Xt(m.nextSibling),et=e,Se=!0,dt=null,t!==null&&(it[st++]=Tt,it[st++]=kt,it[st++]=un,Tt=t.id,kt=t.overflow,un=e),e=la(e,c.children),e.flags|=4096,e)}function Sl(t,e,n){t.lanes|=e;var c=t.alternate;c!==null&&(c.lanes|=e),ao(t.return,e,n)}function bs(t,e,n,c,m){var y=t.memoizedState;y===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:c,tail:n,tailMode:m}:(y.isBackwards=e,y.rendering=null,y.renderingStartTime=0,y.last=c,y.tail=n,y.tailMode=m)}function Au(t,e,n){var c=e.pendingProps,m=c.revealOrder,y=c.tail;if(We(t,e,c.children,n),c=_e.current,c&2)c=c&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Sl(t,n,e);else if(t.tag===19)Sl(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}if(ve(_e,c),!(e.mode&1))e.memoizedState=null;else switch(m){case"forwards":for(n=e.child,m=null;n!==null;)t=n.alternate,t!==null&&ji(t)===null&&(m=n),n=n.sibling;n=m,n===null?(m=e.child,e.child=null):(m=n.sibling,n.sibling=null),bs(e,!1,m,n,y);break;case"backwards":for(n=null,m=e.child,e.child=null;m!==null;){if(t=m.alternate,t!==null&&ji(t)===null){e.child=m;break}t=m.sibling,m.sibling=n,n=m,m=t}bs(e,!0,n,null,y);break;case"together":bs(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ui(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Mt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),fn|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ee(153));if(e.child!==null){for(t=e.child,n=$t(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$t(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function xd(t,e,n){switch(e.tag){case 3:Mu(e),Rn();break;case 5:su(e);break;case 1:qe(e.type)&&bi(e);break;case 4:ea(e,e.stateNode.containerInfo);break;case 10:var c=e.type._context,m=e.memoizedProps.value;ve(Oi,c._currentValue),c._currentValue=m;break;case 13:if(c=e.memoizedState,c!==null)return c.dehydrated!==null?(ve(_e,_e.current&1),e.flags|=128,null):n&e.child.childLanes?Du(t,e,n):(ve(_e,_e.current&1),t=Mt(t,e,n),t!==null?t.sibling:null);ve(_e,_e.current&1);break;case 19:if(c=(n&e.childLanes)!==0,t.flags&128){if(c)return Au(t,e,n);e.flags|=128}if(m=e.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ve(_e,_e.current),c)break;return null;case 22:case 23:return e.lanes=0,Eu(t,e,n)}return Mt(t,e,n)}var Iu,mo,Lu,Fu;Iu=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};mo=function(){};Lu=function(t,e,n,c){var m=t.memoizedProps;if(m!==c){t=e.stateNode,on(St.current);var y=null;switch(n){case"input":m=Ns(t,m),c=Ns(t,c),y=[];break;case"select":m=Te({},m,{value:void 0}),c=Te({},c,{value:void 0}),y=[];break;case"textarea":m=zs(t,m),c=zs(t,c),y=[];break;default:typeof m.onClick!="function"&&typeof c.onClick=="function"&&(t.onclick=Si)}Ws(n,c);var w;n=null;for(u in m)if(!c.hasOwnProperty(u)&&m.hasOwnProperty(u)&&m[u]!=null)if(u==="style"){var f=m[u];for(w in f)f.hasOwnProperty(w)&&(n||(n={}),n[w]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(mr.hasOwnProperty(u)?y||(y=[]):(y=y||[]).push(u,null));for(u in c){var s=c[u];if(f=m!=null?m[u]:void 0,c.hasOwnProperty(u)&&s!==f&&(s!=null||f!=null))if(u==="style")if(f){for(w in f)!f.hasOwnProperty(w)||s&&s.hasOwnProperty(w)||(n||(n={}),n[w]="");for(w in s)s.hasOwnProperty(w)&&f[w]!==s[w]&&(n||(n={}),n[w]=s[w])}else n||(y||(y=[]),y.push(u,n)),n=s;else u==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,f=f?f.__html:void 0,s!=null&&f!==s&&(y=y||[]).push(u,s)):u==="children"?typeof s!="string"&&typeof s!="number"||(y=y||[]).push(u,""+s):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(mr.hasOwnProperty(u)?(s!=null&&u==="onScroll"&&ye("scroll",t),y||f===s||(y=[])):(y=y||[]).push(u,s))}n&&(y=y||[]).push("style",n);var u=y;(e.updateQueue=u)&&(e.flags|=4)}};Fu=function(t,e,n,c){n!==c&&(e.flags|=4)};function er(t,e){if(!Se)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var c=null;n!==null;)n.alternate!==null&&(c=n),n=n.sibling;c===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function Re(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,c=0;if(e)for(var m=t.child;m!==null;)n|=m.lanes|m.childLanes,c|=m.subtreeFlags&14680064,c|=m.flags&14680064,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)n|=m.lanes|m.childLanes,c|=m.subtreeFlags,c|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=c,t.childLanes=n,e}function wd(t,e,n){var c=e.pendingProps;switch(Go(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Re(e),null;case 1:return qe(e.type)&&_i(),Re(e),null;case 3:return c=e.stateNode,zn(),we(Ke),we(ze),na(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(t===null||t.child===null)&&(qr(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dt!==null&&(bo(dt),dt=null))),mo(t,e),Re(e),null;case 5:ta(e);var m=on(Pr.current);if(n=e.type,t!==null&&e.stateNode!=null)Lu(t,e,n,c,m),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!c){if(e.stateNode===null)throw Error(ee(166));return Re(e),null}if(t=on(St.current),qr(e)){c=e.stateNode,n=e.type;var y=e.memoizedProps;switch(c[wt]=e,c[kr]=y,t=(e.mode&1)!==0,n){case"dialog":ye("cancel",c),ye("close",c);break;case"iframe":case"object":case"embed":ye("load",c);break;case"video":case"audio":for(m=0;m<sr.length;m++)ye(sr[m],c);break;case"source":ye("error",c);break;case"img":case"image":case"link":ye("error",c),ye("load",c);break;case"details":ye("toggle",c);break;case"input":Ma(c,y),ye("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!y.multiple},ye("invalid",c);break;case"textarea":Aa(c,y),ye("invalid",c)}Ws(n,y),m=null;for(var w in y)if(y.hasOwnProperty(w)){var f=y[w];w==="children"?typeof f=="string"?c.textContent!==f&&(y.suppressHydrationWarning!==!0&&Kr(c.textContent,f,t),m=["children",f]):typeof f=="number"&&c.textContent!==""+f&&(y.suppressHydrationWarning!==!0&&Kr(c.textContent,f,t),m=["children",""+f]):mr.hasOwnProperty(w)&&f!=null&&w==="onScroll"&&ye("scroll",c)}switch(n){case"input":Ur(c),Da(c,y,!0);break;case"textarea":Ur(c),Ia(c);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(c.onclick=Si)}c=m,e.updateQueue=c,c!==null&&(e.flags|=4)}else{w=m.nodeType===9?m:m.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=uc(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=w.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof c.is=="string"?t=w.createElement(n,{is:c.is}):(t=w.createElement(n),n==="select"&&(w=t,c.multiple?w.multiple=!0:c.size&&(w.size=c.size))):t=w.createElementNS(t,n),t[wt]=e,t[kr]=c,Iu(t,e,!1,!1),e.stateNode=t;e:{switch(w=Hs(n,c),n){case"dialog":ye("cancel",t),ye("close",t),m=c;break;case"iframe":case"object":case"embed":ye("load",t),m=c;break;case"video":case"audio":for(m=0;m<sr.length;m++)ye(sr[m],t);m=c;break;case"source":ye("error",t),m=c;break;case"img":case"image":case"link":ye("error",t),ye("load",t),m=c;break;case"details":ye("toggle",t),m=c;break;case"input":Ma(t,c),m=Ns(t,c),ye("invalid",t);break;case"option":m=c;break;case"select":t._wrapperState={wasMultiple:!!c.multiple},m=Te({},c,{value:void 0}),ye("invalid",t);break;case"textarea":Aa(t,c),m=zs(t,c),ye("invalid",t);break;default:m=c}Ws(n,m),f=m;for(y in f)if(f.hasOwnProperty(y)){var s=f[y];y==="style"?dc(t,s):y==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,s!=null&&hc(t,s)):y==="children"?typeof s=="string"?(n!=="textarea"||s!=="")&&vr(t,s):typeof s=="number"&&vr(t,""+s):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(mr.hasOwnProperty(y)?s!=null&&y==="onScroll"&&ye("scroll",t):s!=null&&Do(t,y,s,w))}switch(n){case"input":Ur(t),Da(t,c,!1);break;case"textarea":Ur(t),Ia(t);break;case"option":c.value!=null&&t.setAttribute("value",""+Kt(c.value));break;case"select":t.multiple=!!c.multiple,y=c.value,y!=null?En(t,!!c.multiple,y,!1):c.defaultValue!=null&&En(t,!!c.multiple,c.defaultValue,!0);break;default:typeof m.onClick=="function"&&(t.onclick=Si)}switch(n){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Re(e),null;case 6:if(t&&e.stateNode!=null)Fu(t,e,t.memoizedProps,c);else{if(typeof c!="string"&&e.stateNode===null)throw Error(ee(166));if(n=on(Pr.current),on(St.current),qr(e)){if(c=e.stateNode,n=e.memoizedProps,c[wt]=e,(y=c.nodeValue!==n)&&(t=et,t!==null))switch(t.tag){case 3:Kr(c.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Kr(c.nodeValue,n,(t.mode&1)!==0)}y&&(e.flags|=4)}else c=(n.nodeType===9?n:n.ownerDocument).createTextNode(c),c[wt]=e,e.stateNode=c}return Re(e),null;case 13:if(we(_e),c=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Se&&Ze!==null&&e.mode&1&&!(e.flags&128))eu(),Rn(),e.flags|=98560,y=!1;else if(y=qr(e),c!==null&&c.dehydrated!==null){if(t===null){if(!y)throw Error(ee(318));if(y=e.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(ee(317));y[wt]=e}else Rn(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Re(e),y=!1}else dt!==null&&(bo(dt),dt=null),y=!0;if(!y)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(c=c!==null,c!==(t!==null&&t.memoizedState!==null)&&c&&(e.child.flags|=8192,e.mode&1&&(t===null||_e.current&1?Me===0&&(Me=3):ga())),e.updateQueue!==null&&(e.flags|=4),Re(e),null);case 4:return zn(),mo(t,e),t===null&&br(e.stateNode.containerInfo),Re(e),null;case 10:return Qo(e.type._context),Re(e),null;case 17:return qe(e.type)&&_i(),Re(e),null;case 19:if(we(_e),y=e.memoizedState,y===null)return Re(e),null;if(c=(e.flags&128)!==0,w=y.rendering,w===null)if(c)er(y,!1);else{if(Me!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(w=ji(t),w!==null){for(e.flags|=128,er(y,!1),c=w.updateQueue,c!==null&&(e.updateQueue=c,e.flags|=4),e.subtreeFlags=0,c=n,n=e.child;n!==null;)y=n,t=c,y.flags&=14680066,w=y.alternate,w===null?(y.childLanes=0,y.lanes=t,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=w.childLanes,y.lanes=w.lanes,y.child=w.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=w.memoizedProps,y.memoizedState=w.memoizedState,y.updateQueue=w.updateQueue,y.type=w.type,t=w.dependencies,y.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ve(_e,_e.current&1|2),e.child}t=t.sibling}y.tail!==null&&Oe()>Wn&&(e.flags|=128,c=!0,er(y,!1),e.lanes=4194304)}else{if(!c)if(t=ji(w),t!==null){if(e.flags|=128,c=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),er(y,!0),y.tail===null&&y.tailMode==="hidden"&&!w.alternate&&!Se)return Re(e),null}else 2*Oe()-y.renderingStartTime>Wn&&n!==1073741824&&(e.flags|=128,c=!0,er(y,!1),e.lanes=4194304);y.isBackwards?(w.sibling=e.child,e.child=w):(n=y.last,n!==null?n.sibling=w:e.child=w,y.last=w)}return y.tail!==null?(e=y.tail,y.rendering=e,y.tail=e.sibling,y.renderingStartTime=Oe(),e.sibling=null,n=_e.current,ve(_e,c?n&1|2:n&1),e):(Re(e),null);case 22:case 23:return da(),c=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==c&&(e.flags|=8192),c&&e.mode&1?Je&1073741824&&(Re(e),e.subtreeFlags&6&&(e.flags|=8192)):Re(e),null;case 24:return null;case 25:return null}throw Error(ee(156,e.tag))}function Cd(t,e){switch(Go(e),e.tag){case 1:return qe(e.type)&&_i(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return zn(),we(Ke),we(ze),na(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ta(e),null;case 13:if(we(_e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ee(340));Rn()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return we(_e),null;case 4:return zn(),null;case 10:return Qo(e.type._context),null;case 22:case 23:return da(),null;case 24:return null;default:return null}}var Zr=!1,Be=!1,Sd=typeof WeakSet=="function"?WeakSet:Set,ae=null;function On(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(c){ke(t,e,c)}else n.current=null}function vo(t,e,n){try{n()}catch(c){ke(t,e,c)}}var _l=!1;function _d(t,e){if(Zs=xi,t=Uc(),Yo(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var c=n.getSelection&&n.getSelection();if(c&&c.rangeCount!==0){n=c.anchorNode;var m=c.anchorOffset,y=c.focusNode;c=c.focusOffset;try{n.nodeType,y.nodeType}catch{n=null;break e}var w=0,f=-1,s=-1,u=0,h=0,r=t,o=null;t:for(;;){for(var i;r!==n||m!==0&&r.nodeType!==3||(f=w+m),r!==y||c!==0&&r.nodeType!==3||(s=w+c),r.nodeType===3&&(w+=r.nodeValue.length),(i=r.firstChild)!==null;)o=r,r=i;for(;;){if(r===t)break t;if(o===n&&++u===m&&(f=w),o===y&&++h===c&&(s=w),(i=r.nextSibling)!==null)break;r=o,o=r.parentNode}r=i}n=f===-1||s===-1?null:{start:f,end:s}}else n=null}n=n||{start:0,end:0}}else n=null;for(eo={focusedElem:t,selectionRange:n},xi=!1,ae=e;ae!==null;)if(e=ae,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ae=t;else for(;ae!==null;){e=ae;try{var l=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(l!==null){var d=l.memoizedProps,a=l.memoizedState,g=e.stateNode,p=g.getSnapshotBeforeUpdate(e.elementType===e.type?d:ht(e.type,d),a);g.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(x){ke(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,ae=t;break}ae=e.return}return l=_l,_l=!1,l}function fr(t,e,n){var c=e.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var m=c=c.next;do{if((m.tag&t)===t){var y=m.destroy;m.destroy=void 0,y!==void 0&&vo(e,n,y)}m=m.next}while(m!==c)}}function Gi(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var c=n.create;n.destroy=c()}n=n.next}while(n!==e)}}function yo(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Nu(t){var e=t.alternate;e!==null&&(t.alternate=null,Nu(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[wt],delete e[kr],delete e[ro],delete e[sd],delete e[od])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Ru(t){return t.tag===5||t.tag===3||t.tag===4}function bl(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ru(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function xo(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Si));else if(c!==4&&(t=t.child,t!==null))for(xo(t,e,n),t=t.sibling;t!==null;)xo(t,e,n),t=t.sibling}function wo(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(c!==4&&(t=t.child,t!==null))for(wo(t,e,n),t=t.sibling;t!==null;)wo(t,e,n),t=t.sibling}var Ie=null,ft=!1;function At(t,e,n){for(n=n.child;n!==null;)Bu(t,e,n),n=n.sibling}function Bu(t,e,n){if(Ct&&typeof Ct.onCommitFiberUnmount=="function")try{Ct.onCommitFiberUnmount(Bi,n)}catch{}switch(n.tag){case 5:Be||On(n,e);case 6:var c=Ie,m=ft;Ie=null,At(t,e,n),Ie=c,ft=m,Ie!==null&&(ft?(t=Ie,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ie.removeChild(n.stateNode));break;case 18:Ie!==null&&(ft?(t=Ie,n=n.stateNode,t.nodeType===8?vs(t.parentNode,n):t.nodeType===1&&vs(t,n),Cr(t)):vs(Ie,n.stateNode));break;case 4:c=Ie,m=ft,Ie=n.stateNode.containerInfo,ft=!0,At(t,e,n),Ie=c,ft=m;break;case 0:case 11:case 14:case 15:if(!Be&&(c=n.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){m=c=c.next;do{var y=m,w=y.destroy;y=y.tag,w!==void 0&&(y&2||y&4)&&vo(n,e,w),m=m.next}while(m!==c)}At(t,e,n);break;case 1:if(!Be&&(On(n,e),c=n.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=n.memoizedProps,c.state=n.memoizedState,c.componentWillUnmount()}catch(f){ke(n,e,f)}At(t,e,n);break;case 21:At(t,e,n);break;case 22:n.mode&1?(Be=(c=Be)||n.memoizedState!==null,At(t,e,n),Be=c):At(t,e,n);break;default:At(t,e,n)}}function Tl(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Sd),e.forEach(function(c){var m=Dd.bind(null,t,c);n.has(c)||(n.add(c),c.then(m,m))})}}function ut(t,e){var n=e.deletions;if(n!==null)for(var c=0;c<n.length;c++){var m=n[c];try{var y=t,w=e,f=w;e:for(;f!==null;){switch(f.tag){case 5:Ie=f.stateNode,ft=!1;break e;case 3:Ie=f.stateNode.containerInfo,ft=!0;break e;case 4:Ie=f.stateNode.containerInfo,ft=!0;break e}f=f.return}if(Ie===null)throw Error(ee(160));Bu(y,w,m),Ie=null,ft=!1;var s=m.alternate;s!==null&&(s.return=null),m.return=null}catch(u){ke(m,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)zu(e,t),e=e.sibling}function zu(t,e){var n=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ut(e,t),yt(t),c&4){try{fr(3,t,t.return),Gi(3,t)}catch(d){ke(t,t.return,d)}try{fr(5,t,t.return)}catch(d){ke(t,t.return,d)}}break;case 1:ut(e,t),yt(t),c&512&&n!==null&&On(n,n.return);break;case 5:if(ut(e,t),yt(t),c&512&&n!==null&&On(n,n.return),t.flags&32){var m=t.stateNode;try{vr(m,"")}catch(d){ke(t,t.return,d)}}if(c&4&&(m=t.stateNode,m!=null)){var y=t.memoizedProps,w=n!==null?n.memoizedProps:y,f=t.type,s=t.updateQueue;if(t.updateQueue=null,s!==null)try{f==="input"&&y.type==="radio"&&y.name!=null&&lc(m,y),Hs(f,w);var u=Hs(f,y);for(w=0;w<s.length;w+=2){var h=s[w],r=s[w+1];h==="style"?dc(m,r):h==="dangerouslySetInnerHTML"?hc(m,r):h==="children"?vr(m,r):Do(m,h,r,u)}switch(f){case"input":Rs(m,y);break;case"textarea":cc(m,y);break;case"select":var o=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!y.multiple;var i=y.value;i!=null?En(m,!!y.multiple,i,!1):o!==!!y.multiple&&(y.defaultValue!=null?En(m,!!y.multiple,y.defaultValue,!0):En(m,!!y.multiple,y.multiple?[]:"",!1))}m[kr]=y}catch(d){ke(t,t.return,d)}}break;case 6:if(ut(e,t),yt(t),c&4){if(t.stateNode===null)throw Error(ee(162));m=t.stateNode,y=t.memoizedProps;try{m.nodeValue=y}catch(d){ke(t,t.return,d)}}break;case 3:if(ut(e,t),yt(t),c&4&&n!==null&&n.memoizedState.isDehydrated)try{Cr(e.containerInfo)}catch(d){ke(t,t.return,d)}break;case 4:ut(e,t),yt(t);break;case 13:ut(e,t),yt(t),m=t.child,m.flags&8192&&(y=m.memoizedState!==null,m.stateNode.isHidden=y,!y||m.alternate!==null&&m.alternate.memoizedState!==null||(ha=Oe())),c&4&&Tl(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Be=(u=Be)||h,ut(e,t),Be=u):ut(e,t),yt(t),c&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!h&&t.mode&1)for(ae=t,h=t.child;h!==null;){for(r=ae=h;ae!==null;){switch(o=ae,i=o.child,o.tag){case 0:case 11:case 14:case 15:fr(4,o,o.return);break;case 1:On(o,o.return);var l=o.stateNode;if(typeof l.componentWillUnmount=="function"){c=o,n=o.return;try{e=c,l.props=e.memoizedProps,l.state=e.memoizedState,l.componentWillUnmount()}catch(d){ke(c,n,d)}}break;case 5:On(o,o.return);break;case 22:if(o.memoizedState!==null){Ol(r);continue}}i!==null?(i.return=o,ae=i):Ol(r)}h=h.sibling}e:for(h=null,r=t;;){if(r.tag===5){if(h===null){h=r;try{m=r.stateNode,u?(y=m.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(f=r.stateNode,s=r.memoizedProps.style,w=s!=null&&s.hasOwnProperty("display")?s.display:null,f.style.display=fc("display",w))}catch(d){ke(t,t.return,d)}}}else if(r.tag===6){if(h===null)try{r.stateNode.nodeValue=u?"":r.memoizedProps}catch(d){ke(t,t.return,d)}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;h===r&&(h=null),r=r.return}h===r&&(h=null),r.sibling.return=r.return,r=r.sibling}}break;case 19:ut(e,t),yt(t),c&4&&Tl(t);break;case 21:break;default:ut(e,t),yt(t)}}function yt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Ru(n)){var c=n;break e}n=n.return}throw Error(ee(160))}switch(c.tag){case 5:var m=c.stateNode;c.flags&32&&(vr(m,""),c.flags&=-33);var y=bl(t);wo(t,y,m);break;case 3:case 4:var w=c.stateNode.containerInfo,f=bl(t);xo(t,f,w);break;default:throw Error(ee(161))}}catch(s){ke(t,t.return,s)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function bd(t,e,n){ae=t,Uu(t)}function Uu(t,e,n){for(var c=(t.mode&1)!==0;ae!==null;){var m=ae,y=m.child;if(m.tag===22&&c){var w=m.memoizedState!==null||Zr;if(!w){var f=m.alternate,s=f!==null&&f.memoizedState!==null||Be;f=Zr;var u=Be;if(Zr=w,(Be=s)&&!u)for(ae=m;ae!==null;)w=ae,s=w.child,w.tag===22&&w.memoizedState!==null?Pl(m):s!==null?(s.return=w,ae=s):Pl(m);for(;y!==null;)ae=y,Uu(y),y=y.sibling;ae=m,Zr=f,Be=u}kl(t)}else m.subtreeFlags&8772&&y!==null?(y.return=m,ae=y):kl(t)}}function kl(t){for(;ae!==null;){var e=ae;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Be||Gi(5,e);break;case 1:var c=e.stateNode;if(e.flags&4&&!Be)if(n===null)c.componentDidMount();else{var m=e.elementType===e.type?n.memoizedProps:ht(e.type,n.memoizedProps);c.componentDidUpdate(m,n.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var y=e.updateQueue;y!==null&&ul(e,y,c);break;case 3:var w=e.updateQueue;if(w!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ul(e,w,n)}break;case 5:var f=e.stateNode;if(n===null&&e.flags&4){n=f;var s=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break;case"img":s.src&&(n.src=s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var r=h.dehydrated;r!==null&&Cr(r)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}Be||e.flags&512&&yo(e)}catch(o){ke(e,e.return,o)}}if(e===t){ae=null;break}if(n=e.sibling,n!==null){n.return=e.return,ae=n;break}ae=e.return}}function Ol(t){for(;ae!==null;){var e=ae;if(e===t){ae=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ae=n;break}ae=e.return}}function Pl(t){for(;ae!==null;){var e=ae;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Gi(4,e)}catch(s){ke(e,n,s)}break;case 1:var c=e.stateNode;if(typeof c.componentDidMount=="function"){var m=e.return;try{c.componentDidMount()}catch(s){ke(e,m,s)}}var y=e.return;try{yo(e)}catch(s){ke(e,y,s)}break;case 5:var w=e.return;try{yo(e)}catch(s){ke(e,w,s)}}}catch(s){ke(e,e.return,s)}if(e===t){ae=null;break}var f=e.sibling;if(f!==null){f.return=e.return,ae=f;break}ae=e.return}}var Td=Math.ceil,Ai=Dt.ReactCurrentDispatcher,ca=Dt.ReactCurrentOwner,at=Dt.ReactCurrentBatchConfig,de=0,Ae=null,Ee=null,Le=0,Je=0,Pn=Jt(0),Me=0,Dr=null,fn=0,$i=0,ua=0,dr=null,Ge=null,ha=0,Wn=1/0,_t=null,Ii=!1,Co=null,Vt=null,ei=!1,zt=null,Li=0,gr=0,So=null,hi=-1,fi=0;function Xe(){return de&6?Oe():hi!==-1?hi:hi=Oe()}function Gt(t){return t.mode&1?de&2&&Le!==0?Le&-Le:ld.transition!==null?(fi===0&&(fi=Tc()),fi):(t=pe,t!==0||(t=window.event,t=t===void 0?16:Dc(t.type)),t):1}function pt(t,e,n,c){if(50<gr)throw gr=0,So=null,Error(ee(185));Lr(t,n,c),(!(de&2)||t!==Ae)&&(t===Ae&&(!(de&2)&&($i|=n),Me===4&&Rt(t,Le)),Qe(t,c),n===1&&de===0&&!(e.mode&1)&&(Wn=Oe()+500,Xi&&Zt()))}function Qe(t,e){var n=t.callbackNode;lf(t,e);var c=yi(t,t===Ae?Le:0);if(c===0)n!==null&&Na(n),t.callbackNode=null,t.callbackPriority=0;else if(e=c&-c,t.callbackPriority!==e){if(n!=null&&Na(n),e===1)t.tag===0?ad(El.bind(null,t)):Qc(El.bind(null,t)),rd(function(){!(de&6)&&Zt()}),n=null;else{switch(kc(c)){case 1:n=No;break;case 4:n=_c;break;case 16:n=vi;break;case 536870912:n=bc;break;default:n=vi}n=Ku(n,Wu.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Wu(t,e){if(hi=-1,fi=0,de&6)throw Error(ee(327));var n=t.callbackNode;if(In()&&t.callbackNode!==n)return null;var c=yi(t,t===Ae?Le:0);if(c===0)return null;if(c&30||c&t.expiredLanes||e)e=Fi(t,c);else{e=c;var m=de;de|=2;var y=Xu();(Ae!==t||Le!==e)&&(_t=null,Wn=Oe()+500,an(t,e));do try{Pd();break}catch(f){Hu(t,f)}while(1);qo(),Ai.current=y,de=m,Ee!==null?e=0:(Ae=null,Le=0,e=Me)}if(e!==0){if(e===2&&(m=$s(t),m!==0&&(c=m,e=_o(t,m))),e===1)throw n=Dr,an(t,0),Rt(t,c),Qe(t,Oe()),n;if(e===6)Rt(t,c);else{if(m=t.current.alternate,!(c&30)&&!kd(m)&&(e=Fi(t,c),e===2&&(y=$s(t),y!==0&&(c=y,e=_o(t,y))),e===1))throw n=Dr,an(t,0),Rt(t,c),Qe(t,Oe()),n;switch(t.finishedWork=m,t.finishedLanes=c,e){case 0:case 1:throw Error(ee(345));case 2:nn(t,Ge,_t);break;case 3:if(Rt(t,c),(c&130023424)===c&&(e=ha+500-Oe(),10<e)){if(yi(t,0)!==0)break;if(m=t.suspendedLanes,(m&c)!==c){Xe(),t.pingedLanes|=t.suspendedLanes&m;break}t.timeoutHandle=no(nn.bind(null,t,Ge,_t),e);break}nn(t,Ge,_t);break;case 4:if(Rt(t,c),(c&4194240)===c)break;for(e=t.eventTimes,m=-1;0<c;){var w=31-gt(c);y=1<<w,w=e[w],w>m&&(m=w),c&=~y}if(c=m,c=Oe()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*Td(c/1960))-c,10<c){t.timeoutHandle=no(nn.bind(null,t,Ge,_t),c);break}nn(t,Ge,_t);break;case 5:nn(t,Ge,_t);break;default:throw Error(ee(329))}}}return Qe(t,Oe()),t.callbackNode===n?Wu.bind(null,t):null}function _o(t,e){var n=dr;return t.current.memoizedState.isDehydrated&&(an(t,e).flags|=256),t=Fi(t,e),t!==2&&(e=Ge,Ge=n,e!==null&&bo(e)),t}function bo(t){Ge===null?Ge=t:Ge.push.apply(Ge,t)}function kd(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var c=0;c<n.length;c++){var m=n[c],y=m.getSnapshot;m=m.value;try{if(!mt(y(),m))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Rt(t,e){for(e&=~ua,e&=~$i,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-gt(e),c=1<<n;t[n]=-1,e&=~c}}function El(t){if(de&6)throw Error(ee(327));In();var e=yi(t,0);if(!(e&1))return Qe(t,Oe()),null;var n=Fi(t,e);if(t.tag!==0&&n===2){var c=$s(t);c!==0&&(e=c,n=_o(t,c))}if(n===1)throw n=Dr,an(t,0),Rt(t,e),Qe(t,Oe()),n;if(n===6)throw Error(ee(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,nn(t,Ge,_t),Qe(t,Oe()),null}function fa(t,e){var n=de;de|=1;try{return t(e)}finally{de=n,de===0&&(Wn=Oe()+500,Xi&&Zt())}}function dn(t){zt!==null&&zt.tag===0&&!(de&6)&&In();var e=de;de|=1;var n=at.transition,c=pe;try{if(at.transition=null,pe=1,t)return t()}finally{pe=c,at.transition=n,de=e,!(de&6)&&Zt()}}function da(){Je=Pn.current,we(Pn)}function an(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,nd(n)),Ee!==null)for(n=Ee.return;n!==null;){var c=n;switch(Go(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&_i();break;case 3:zn(),we(Ke),we(ze),na();break;case 5:ta(c);break;case 4:zn();break;case 13:we(_e);break;case 19:we(_e);break;case 10:Qo(c.type._context);break;case 22:case 23:da()}n=n.return}if(Ae=t,Ee=t=$t(t.current,null),Le=Je=e,Me=0,Dr=null,ua=$i=fn=0,Ge=dr=null,sn!==null){for(e=0;e<sn.length;e++)if(n=sn[e],c=n.interleaved,c!==null){n.interleaved=null;var m=c.next,y=n.pending;if(y!==null){var w=y.next;y.next=m,c.next=w}n.pending=c}sn=null}return t}function Hu(t,e){do{var n=Ee;try{if(qo(),li.current=Di,Mi){for(var c=be.memoizedState;c!==null;){var m=c.queue;m!==null&&(m.pending=null),c=c.next}Mi=!1}if(hn=0,De=je=be=null,hr=!1,Er=0,ca.current=null,n===null||n.return===null){Me=1,Dr=e,Ee=null;break}e:{var y=t,w=n.return,f=n,s=e;if(e=Le,f.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){var u=s,h=f,r=h.tag;if(!(h.mode&1)&&(r===0||r===11||r===15)){var o=h.alternate;o?(h.updateQueue=o.updateQueue,h.memoizedState=o.memoizedState,h.lanes=o.lanes):(h.updateQueue=null,h.memoizedState=null)}var i=ml(w);if(i!==null){i.flags&=-257,vl(i,w,f,y,e),i.mode&1&&pl(y,u,e),e=i,s=u;var l=e.updateQueue;if(l===null){var d=new Set;d.add(s),e.updateQueue=d}else l.add(s);break e}else{if(!(e&1)){pl(y,u,e),ga();break e}s=Error(ee(426))}}else if(Se&&f.mode&1){var a=ml(w);if(a!==null){!(a.flags&65536)&&(a.flags|=256),vl(a,w,f,y,e),$o(Un(s,f));break e}}y=s=Un(s,f),Me!==4&&(Me=2),dr===null?dr=[y]:dr.push(y),y=w;do{switch(y.tag){case 3:y.flags|=65536,e&=-e,y.lanes|=e;var g=ku(y,s,e);cl(y,g);break e;case 1:f=s;var p=y.type,v=y.stateNode;if(!(y.flags&128)&&(typeof p.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Vt===null||!Vt.has(v)))){y.flags|=65536,e&=-e,y.lanes|=e;var x=Ou(y,f,e);cl(y,x);break e}}y=y.return}while(y!==null)}Vu(n)}catch(C){e=C,Ee===n&&n!==null&&(Ee=n=n.return);continue}break}while(1)}function Xu(){var t=Ai.current;return Ai.current=Di,t===null?Di:t}function ga(){(Me===0||Me===3||Me===2)&&(Me=4),Ae===null||!(fn&268435455)&&!($i&268435455)||Rt(Ae,Le)}function Fi(t,e){var n=de;de|=2;var c=Xu();(Ae!==t||Le!==e)&&(_t=null,an(t,e));do try{Od();break}catch(m){Hu(t,m)}while(1);if(qo(),de=n,Ai.current=c,Ee!==null)throw Error(ee(261));return Ae=null,Le=0,Me}function Od(){for(;Ee!==null;)Yu(Ee)}function Pd(){for(;Ee!==null&&!Jh();)Yu(Ee)}function Yu(t){var e=$u(t.alternate,t,Je);t.memoizedProps=t.pendingProps,e===null?Vu(t):Ee=e,ca.current=null}function Vu(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Cd(n,e),n!==null){n.flags&=32767,Ee=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Me=6,Ee=null;return}}else if(n=wd(n,e,Je),n!==null){Ee=n;return}if(e=e.sibling,e!==null){Ee=e;return}Ee=e=t}while(e!==null);Me===0&&(Me=5)}function nn(t,e,n){var c=pe,m=at.transition;try{at.transition=null,pe=1,Ed(t,e,n,c)}finally{at.transition=m,pe=c}return null}function Ed(t,e,n,c){do In();while(zt!==null);if(de&6)throw Error(ee(327));n=t.finishedWork;var m=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ee(177));t.callbackNode=null,t.callbackPriority=0;var y=n.lanes|n.childLanes;if(cf(t,y),t===Ae&&(Ee=Ae=null,Le=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ei||(ei=!0,Ku(vi,function(){return In(),null})),y=(n.flags&15990)!==0,n.subtreeFlags&15990||y){y=at.transition,at.transition=null;var w=pe;pe=1;var f=de;de|=4,ca.current=null,_d(t,n),zu(n,t),Kf(eo),xi=!!Zs,eo=Zs=null,t.current=n,bd(n),Zh(),de=f,pe=w,at.transition=y}else t.current=n;if(ei&&(ei=!1,zt=t,Li=m),y=t.pendingLanes,y===0&&(Vt=null),nf(n.stateNode),Qe(t,Oe()),e!==null)for(c=t.onRecoverableError,n=0;n<e.length;n++)m=e[n],c(m.value,{componentStack:m.stack,digest:m.digest});if(Ii)throw Ii=!1,t=Co,Co=null,t;return Li&1&&t.tag!==0&&In(),y=t.pendingLanes,y&1?t===So?gr++:(gr=0,So=t):gr=0,Zt(),null}function In(){if(zt!==null){var t=kc(Li),e=at.transition,n=pe;try{if(at.transition=null,pe=16>t?16:t,zt===null)var c=!1;else{if(t=zt,zt=null,Li=0,de&6)throw Error(ee(331));var m=de;for(de|=4,ae=t.current;ae!==null;){var y=ae,w=y.child;if(ae.flags&16){var f=y.deletions;if(f!==null){for(var s=0;s<f.length;s++){var u=f[s];for(ae=u;ae!==null;){var h=ae;switch(h.tag){case 0:case 11:case 15:fr(8,h,y)}var r=h.child;if(r!==null)r.return=h,ae=r;else for(;ae!==null;){h=ae;var o=h.sibling,i=h.return;if(Nu(h),h===u){ae=null;break}if(o!==null){o.return=i,ae=o;break}ae=i}}}var l=y.alternate;if(l!==null){var d=l.child;if(d!==null){l.child=null;do{var a=d.sibling;d.sibling=null,d=a}while(d!==null)}}ae=y}}if(y.subtreeFlags&2064&&w!==null)w.return=y,ae=w;else e:for(;ae!==null;){if(y=ae,y.flags&2048)switch(y.tag){case 0:case 11:case 15:fr(9,y,y.return)}var g=y.sibling;if(g!==null){g.return=y.return,ae=g;break e}ae=y.return}}var p=t.current;for(ae=p;ae!==null;){w=ae;var v=w.child;if(w.subtreeFlags&2064&&v!==null)v.return=w,ae=v;else e:for(w=p;ae!==null;){if(f=ae,f.flags&2048)try{switch(f.tag){case 0:case 11:case 15:Gi(9,f)}}catch(C){ke(f,f.return,C)}if(f===w){ae=null;break e}var x=f.sibling;if(x!==null){x.return=f.return,ae=x;break e}ae=f.return}}if(de=m,Zt(),Ct&&typeof Ct.onPostCommitFiberRoot=="function")try{Ct.onPostCommitFiberRoot(Bi,t)}catch{}c=!0}return c}finally{pe=n,at.transition=e}}return!1}function jl(t,e,n){e=Un(n,e),e=ku(t,e,1),t=Yt(t,e,1),e=Xe(),t!==null&&(Lr(t,1,e),Qe(t,e))}function ke(t,e,n){if(t.tag===3)jl(t,t,n);else for(;e!==null;){if(e.tag===3){jl(e,t,n);break}else if(e.tag===1){var c=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Vt===null||!Vt.has(c))){t=Un(n,t),t=Ou(e,t,1),e=Yt(e,t,1),t=Xe(),e!==null&&(Lr(e,1,t),Qe(e,t));break}}e=e.return}}function jd(t,e,n){var c=t.pingCache;c!==null&&c.delete(e),e=Xe(),t.pingedLanes|=t.suspendedLanes&n,Ae===t&&(Le&n)===n&&(Me===4||Me===3&&(Le&130023424)===Le&&500>Oe()-ha?an(t,0):ua|=n),Qe(t,e)}function Gu(t,e){e===0&&(t.mode&1?(e=Xr,Xr<<=1,!(Xr&130023424)&&(Xr=4194304)):e=1);var n=Xe();t=jt(t,e),t!==null&&(Lr(t,e,n),Qe(t,n))}function Md(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Gu(t,n)}function Dd(t,e){var n=0;switch(t.tag){case 13:var c=t.stateNode,m=t.memoizedState;m!==null&&(n=m.retryLane);break;case 19:c=t.stateNode;break;default:throw Error(ee(314))}c!==null&&c.delete(e),Gu(t,n)}var $u;$u=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ke.current)$e=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return $e=!1,xd(t,e,n);$e=!!(t.flags&131072)}else $e=!1,Se&&e.flags&1048576&&Jc(e,ki,e.index);switch(e.lanes=0,e.tag){case 2:var c=e.type;ui(t,e),t=e.pendingProps;var m=Nn(e,ze.current);An(e,n),m=ia(null,e,c,t,m,n);var y=sa();return e.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qe(c)?(y=!0,bi(e)):y=!1,e.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,Zo(e),m.updater=Vi,e.stateNode=m,m._reactInternals=e,co(e,c,t,n),e=fo(null,e,c,!0,y,n)):(e.tag=0,Se&&y&&Vo(e),We(null,e,m,n),e=e.child),e;case 16:c=e.elementType;e:{switch(ui(t,e),t=e.pendingProps,m=c._init,c=m(c._payload),e.type=c,m=e.tag=Id(c),t=ht(c,t),m){case 0:e=ho(null,e,c,t,n);break e;case 1:e=wl(null,e,c,t,n);break e;case 11:e=yl(null,e,c,t,n);break e;case 14:e=xl(null,e,c,ht(c.type,t),n);break e}throw Error(ee(306,c,""))}return e;case 0:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),ho(t,e,c,m,n);case 1:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),wl(t,e,c,m,n);case 3:e:{if(Mu(e),t===null)throw Error(ee(387));c=e.pendingProps,y=e.memoizedState,m=y.element,iu(t,e),Ei(e,c,null,n);var w=e.memoizedState;if(c=w.element,y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},e.updateQueue.baseState=y,e.memoizedState=y,e.flags&256){m=Un(Error(ee(423)),e),e=Cl(t,e,c,n,m);break e}else if(c!==m){m=Un(Error(ee(424)),e),e=Cl(t,e,c,n,m);break e}else for(Ze=Xt(e.stateNode.containerInfo.firstChild),et=e,Se=!0,dt=null,n=nu(e,null,c,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Rn(),c===m){e=Mt(t,e,n);break e}We(t,e,c,n)}e=e.child}return e;case 5:return su(e),t===null&&oo(e),c=e.type,m=e.pendingProps,y=t!==null?t.memoizedProps:null,w=m.children,to(c,m)?w=null:y!==null&&to(c,y)&&(e.flags|=32),ju(t,e),We(t,e,w,n),e.child;case 6:return t===null&&oo(e),null;case 13:return Du(t,e,n);case 4:return ea(e,e.stateNode.containerInfo),c=e.pendingProps,t===null?e.child=Bn(e,null,c,n):We(t,e,c,n),e.child;case 11:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),yl(t,e,c,m,n);case 7:return We(t,e,e.pendingProps,n),e.child;case 8:return We(t,e,e.pendingProps.children,n),e.child;case 12:return We(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(c=e.type._context,m=e.pendingProps,y=e.memoizedProps,w=m.value,ve(Oi,c._currentValue),c._currentValue=w,y!==null)if(mt(y.value,w)){if(y.children===m.children&&!Ke.current){e=Mt(t,e,n);break e}}else for(y=e.child,y!==null&&(y.return=e);y!==null;){var f=y.dependencies;if(f!==null){w=y.child;for(var s=f.firstContext;s!==null;){if(s.context===c){if(y.tag===1){s=Ot(-1,n&-n),s.tag=2;var u=y.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?s.next=s:(s.next=h.next,h.next=s),u.pending=s}}y.lanes|=n,s=y.alternate,s!==null&&(s.lanes|=n),ao(y.return,n,e),f.lanes|=n;break}s=s.next}}else if(y.tag===10)w=y.type===e.type?null:y.child;else if(y.tag===18){if(w=y.return,w===null)throw Error(ee(341));w.lanes|=n,f=w.alternate,f!==null&&(f.lanes|=n),ao(w,n,e),w=y.sibling}else w=y.child;if(w!==null)w.return=y;else for(w=y;w!==null;){if(w===e){w=null;break}if(y=w.sibling,y!==null){y.return=w.return,w=y;break}w=w.return}y=w}We(t,e,m.children,n),e=e.child}return e;case 9:return m=e.type,c=e.pendingProps.children,An(e,n),m=lt(m),c=c(m),e.flags|=1,We(t,e,c,n),e.child;case 14:return c=e.type,m=ht(c,e.pendingProps),m=ht(c.type,m),xl(t,e,c,m,n);case 15:return Pu(t,e,e.type,e.pendingProps,n);case 17:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),ui(t,e),e.tag=1,qe(c)?(t=!0,bi(e)):t=!1,An(e,n),Tu(e,c,m),co(e,c,m,n),fo(null,e,c,!0,t,n);case 19:return Au(t,e,n);case 22:return Eu(t,e,n)}throw Error(ee(156,e.tag))};function Ku(t,e){return Sc(t,e)}function Ad(t,e,n,c){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ot(t,e,n,c){return new Ad(t,e,n,c)}function pa(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Id(t){if(typeof t=="function")return pa(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Io)return 11;if(t===Lo)return 14}return 2}function $t(t,e){var n=t.alternate;return n===null?(n=ot(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function di(t,e,n,c,m,y){var w=2;if(c=t,typeof t=="function")pa(t)&&(w=1);else if(typeof t=="string")w=5;else e:switch(t){case yn:return ln(n.children,m,y,e);case Ao:w=8,m|=8;break;case As:return t=ot(12,n,e,m|2),t.elementType=As,t.lanes=y,t;case Is:return t=ot(13,n,e,m),t.elementType=Is,t.lanes=y,t;case Ls:return t=ot(19,n,e,m),t.elementType=Ls,t.lanes=y,t;case sc:return Ki(n,m,y,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case rc:w=10;break e;case ic:w=9;break e;case Io:w=11;break e;case Lo:w=14;break e;case Lt:w=16,c=null;break e}throw Error(ee(130,t==null?t:typeof t,""))}return e=ot(w,n,e,m),e.elementType=t,e.type=c,e.lanes=y,e}function ln(t,e,n,c){return t=ot(7,t,c,e),t.lanes=n,t}function Ki(t,e,n,c){return t=ot(22,t,c,e),t.elementType=sc,t.lanes=n,t.stateNode={isHidden:!1},t}function Ts(t,e,n){return t=ot(6,t,null,e),t.lanes=n,t}function ks(t,e,n){return e=ot(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Ld(t,e,n,c,m){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=os(0),this.expirationTimes=os(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=os(0),this.identifierPrefix=c,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function ma(t,e,n,c,m,y,w,f,s){return t=new Ld(t,e,n,f,s),e===1?(e=1,y===!0&&(e|=8)):e=0,y=ot(3,null,null,e),t.current=y,y.stateNode=t,y.memoizedState={element:c,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zo(y),t}function Fd(t,e,n){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:vn,key:c==null?null:""+c,children:t,containerInfo:e,implementation:n}}function qu(t){if(!t)return qt;t=t._reactInternals;e:{if(pn(t)!==t||t.tag!==1)throw Error(ee(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ee(171))}if(t.tag===1){var n=t.type;if(qe(n))return qc(t,n,e)}return e}function Qu(t,e,n,c,m,y,w,f,s){return t=ma(n,c,!0,t,m,y,w,f,s),t.context=qu(null),n=t.current,c=Xe(),m=Gt(n),y=Ot(c,m),y.callback=e??null,Yt(n,y,m),t.current.lanes=m,Lr(t,m,c),Qe(t,c),t}function qi(t,e,n,c){var m=e.current,y=Xe(),w=Gt(m);return n=qu(n),e.context===null?e.context=n:e.pendingContext=n,e=Ot(y,w),e.payload={element:t},c=c===void 0?null:c,c!==null&&(e.callback=c),t=Yt(m,e,w),t!==null&&(pt(t,m,w,y),ai(t,m,w)),w}function Ni(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ml(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function va(t,e){Ml(t,e),(t=t.alternate)&&Ml(t,e)}function Nd(){return null}var Ju=typeof reportError=="function"?reportError:function(t){console.error(t)};function ya(t){this._internalRoot=t}Qi.prototype.render=ya.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ee(409));qi(t,e,null,null)};Qi.prototype.unmount=ya.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;dn(function(){qi(null,t,null,null)}),e[Et]=null}};function Qi(t){this._internalRoot=t}Qi.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ec();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Nt.length&&e!==0&&e<Nt[n].priority;n++);Nt.splice(n,0,t),n===0&&Mc(t)}};function xa(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ji(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Dl(){}function Rd(t,e,n,c,m){if(m){if(typeof c=="function"){var y=c;c=function(){var u=Ni(w);y.call(u)}}var w=Qu(e,c,t,0,null,!1,!1,"",Dl);return t._reactRootContainer=w,t[Et]=w.current,br(t.nodeType===8?t.parentNode:t),dn(),w}for(;m=t.lastChild;)t.removeChild(m);if(typeof c=="function"){var f=c;c=function(){var u=Ni(s);f.call(u)}}var s=ma(t,0,!1,null,null,!1,!1,"",Dl);return t._reactRootContainer=s,t[Et]=s.current,br(t.nodeType===8?t.parentNode:t),dn(function(){qi(e,s,n,c)}),s}function Zi(t,e,n,c,m){var y=n._reactRootContainer;if(y){var w=y;if(typeof m=="function"){var f=m;m=function(){var s=Ni(w);f.call(s)}}qi(e,w,t,m)}else w=Rd(n,e,t,m,c);return Ni(w)}Oc=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ir(e.pendingLanes);n!==0&&(Ro(e,n|1),Qe(e,Oe()),!(de&6)&&(Wn=Oe()+500,Zt()))}break;case 13:dn(function(){var c=jt(t,1);if(c!==null){var m=Xe();pt(c,t,1,m)}}),va(t,1)}};Bo=function(t){if(t.tag===13){var e=jt(t,134217728);if(e!==null){var n=Xe();pt(e,t,134217728,n)}va(t,134217728)}};Pc=function(t){if(t.tag===13){var e=Gt(t),n=jt(t,e);if(n!==null){var c=Xe();pt(n,t,e,c)}va(t,e)}};Ec=function(){return pe};jc=function(t,e){var n=pe;try{return pe=t,e()}finally{pe=n}};Ys=function(t,e,n){switch(e){case"input":if(Rs(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var c=n[e];if(c!==t&&c.form===t.form){var m=Hi(c);if(!m)throw Error(ee(90));ac(c),Rs(c,m)}}}break;case"textarea":cc(t,n);break;case"select":e=n.value,e!=null&&En(t,!!n.multiple,e,!1)}};mc=fa;vc=dn;var Bd={usingClientEntryPoint:!1,Events:[Nr,Sn,Hi,gc,pc,fa]},tr={findFiberByHostInstance:rn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},zd={bundleType:tr.bundleType,version:tr.version,rendererPackageName:tr.rendererPackageName,rendererConfig:tr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Dt.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=wc(t),t===null?null:t.stateNode},findFiberByHostInstance:tr.findFiberByHostInstance||Nd,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ti=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ti.isDisabled&&ti.supportsFiber)try{Bi=ti.inject(zd),Ct=ti}catch{}}nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bd;nt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xa(e))throw Error(ee(200));return Fd(t,e,null,n)};nt.createRoot=function(t,e){if(!xa(t))throw Error(ee(299));var n=!1,c="",m=Ju;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(c=e.identifierPrefix),e.onRecoverableError!==void 0&&(m=e.onRecoverableError)),e=ma(t,1,!1,null,null,n,!1,c,m),t[Et]=e.current,br(t.nodeType===8?t.parentNode:t),new ya(e)};nt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ee(188)):(t=Object.keys(t).join(","),Error(ee(268,t)));return t=wc(e),t=t===null?null:t.stateNode,t};nt.flushSync=function(t){return dn(t)};nt.hydrate=function(t,e,n){if(!Ji(e))throw Error(ee(200));return Zi(null,t,e,!0,n)};nt.hydrateRoot=function(t,e,n){if(!xa(t))throw Error(ee(405));var c=n!=null&&n.hydratedSources||null,m=!1,y="",w=Ju;if(n!=null&&(n.unstable_strictMode===!0&&(m=!0),n.identifierPrefix!==void 0&&(y=n.identifierPrefix),n.onRecoverableError!==void 0&&(w=n.onRecoverableError)),e=Qu(e,null,t,1,n??null,m,!1,y,w),t[Et]=e.current,br(t),c)for(t=0;t<c.length;t++)n=c[t],m=n._getVersion,m=m(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,m]:e.mutableSourceEagerHydrationData.push(n,m);return new Qi(e)};nt.render=function(t,e,n){if(!Ji(e))throw Error(ee(200));return Zi(null,t,e,!1,n)};nt.unmountComponentAtNode=function(t){if(!Ji(t))throw Error(ee(40));return t._reactRootContainer?(dn(function(){Zi(null,null,t,!1,function(){t._reactRootContainer=null,t[Et]=null})}),!0):!1};nt.unstable_batchedUpdates=fa;nt.unstable_renderSubtreeIntoContainer=function(t,e,n,c){if(!Ji(n))throw Error(ee(200));if(t==null||t._reactInternals===void 0)throw Error(ee(38));return Zi(t,e,n,!1,c)};nt.version="18.3.1-next-f1338f8080-20240426";function Zu(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Zu)}catch(t){console.error(t)}}Zu(),Zl.exports=nt;var Ud=Zl.exports,Al=Ud;Ms.createRoot=Al.createRoot,Ms.hydrateRoot=Al.hydrateRoot;var Wd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Hd=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Xd=(t,e)=>{const n=ue.forwardRef(({color:c="currentColor",size:m=24,strokeWidth:y=2,absoluteStrokeWidth:w,children:f,...s},u)=>ue.createElement("svg",{ref:u,...Wd,width:m,height:m,stroke:c,strokeWidth:w?Number(y)*24/Number(m):y,className:`lucide lucide-${Hd(t)}`,...s},[...e.map(([h,r])=>ue.createElement(h,r)),...(Array.isArray(f)?f:[f])||[]]));return n.displayName=`${t}`,n};var me=Xd;const Os=me("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),Yd=me("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),Vd=me("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Gd=me("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),$d=me("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Kd=me("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Il=me("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]),qd=me("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),Qd=me("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Jd=me("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Zd=me("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),eg=me("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]),tg=me("PanelRightOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]),eh=me("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),ng=me("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),rg=me("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),ig=me("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),sg=me("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),To=me("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),og=me("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),th=me("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ag=me("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),lg=me("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Ll=me("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),nh=me("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),cg=me("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Fl=me("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var He={};const ug={},hg=Object.freeze(Object.defineProperty({__proto__:null,default:ug},Symbol.toStringTag,{value:"Module"})),Ps=gh(hg);(function(t){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var e=e||{version:"5.5.2"};if(t.fabric=e,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?e.document=document:e.document=document.implementation.createHTMLDocument(""),e.window=window;else{var n=Ps,c=new n.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;e.document=c.document,e.jsdomImplForWrapper=Ps.implForWrapper,e.nodeCanvas=Ps.Canvas,e.window=c,DOMParser=e.window.DOMParser}e.isTouchSupported="ontouchstart"in e.window||"ontouchstart"in e.document||e.window&&e.window.navigator&&e.window.navigator.maxTouchPoints>0,e.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",e.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],e.DPI=96,e.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",e.commaWsp="(?:\\s+,?\\s*|,\\s*)",e.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,e.reNonWord=/[ \n\.,;!\?\-]/,e.fontPaths={},e.iMatrix=[1,0,0,1,0,0],e.svgNS="http://www.w3.org/2000/svg",e.perfLimitSizeTotal=2097152,e.maxCacheSideLimit=4096,e.minCacheSideLimit=256,e.charWidthsCache={},e.textureSize=2048,e.disableStyleCopyPaste=!1,e.enableGLFiltering=!0,e.devicePixelRatio=e.window.devicePixelRatio||e.window.webkitDevicePixelRatio||e.window.mozDevicePixelRatio||1,e.browserShadowBlurConstant=1,e.arcToSegmentsCache={},e.boundsOfCurveCache={},e.cachesBoundsOfCurve=!0,e.forceGLPutImageData=!1,e.initFilterBackend=function(){if(e.enableGLFiltering&&e.isWebglSupported&&e.isWebglSupported(e.textureSize))return console.log("max texture size: "+e.maxTextureSize),new e.WebglFilterBackend({tileSize:e.textureSize});if(e.Canvas2dFilterBackend)return new e.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=e),function(){function f(i,l){if(this.__eventListeners[i]){var d=this.__eventListeners[i];l?d[d.indexOf(l)]=!1:e.util.array.fill(d,!1)}}function s(i,l){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var d in i)this.on(d,i[d]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(l);return this}function u(i,l){var d=(function(){l.apply(this,arguments),this.off(i,d)}).bind(this);this.on(i,d)}function h(i,l){if(arguments.length===1)for(var d in i)u.call(this,d,i[d]);else u.call(this,i,l);return this}function r(i,l){if(!this.__eventListeners)return this;if(arguments.length===0)for(i in this.__eventListeners)f.call(this,i);else if(arguments.length===1&&typeof arguments[0]=="object")for(var d in i)f.call(this,d,i[d]);else f.call(this,i,l);return this}function o(i,l){if(!this.__eventListeners)return this;var d=this.__eventListeners[i];if(!d)return this;for(var a=0,g=d.length;a<g;a++)d[a]&&d[a].call(this,l||{});return this.__eventListeners[i]=d.filter(function(p){return p!==!1}),this}e.Observable={fire:o,on:s,once:h,off:r}}(),e.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var f=0,s=arguments.length;f<s;f++)this._onObjectAdded(arguments[f]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(f,s,u){var h=this._objects;return u?h[s]=f:h.splice(s,0,f),this._onObjectAdded&&this._onObjectAdded(f),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var f=this._objects,s,u=!1,h=0,r=arguments.length;h<r;h++)s=f.indexOf(arguments[h]),s!==-1&&(u=!0,f.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[h]));return this.renderOnAddRemove&&u&&this.requestRenderAll(),this},forEachObject:function(f,s){for(var u=this.getObjects(),h=0,r=u.length;h<r;h++)f.call(s,u[h],h,u);return this},getObjects:function(f){return typeof f>"u"?this._objects.concat():this._objects.filter(function(s){return s.type===f})},item:function(f){return this._objects[f]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(f,s){return this._objects.indexOf(f)>-1?!0:s?this._objects.some(function(u){return typeof u.contains=="function"&&u.contains(f,!0)}):!1},complexity:function(){return this._objects.reduce(function(f,s){return f+=s.complexity?s.complexity():0,f},0)}},e.CommonMethods={_setOptions:function(f){for(var s in f)this.set(s,f[s])},_initGradient:function(f,s){f&&f.colorStops&&!(f instanceof e.Gradient)&&this.set(s,new e.Gradient(f))},_initPattern:function(f,s,u){f&&f.source&&!(f instanceof e.Pattern)?this.set(s,new e.Pattern(f,u)):u&&u()},_setObject:function(f){for(var s in f)this._set(s,f[s])},set:function(f,s){return typeof f=="object"?this._setObject(f):this._set(f,s),this},_set:function(f,s){this[f]=s},toggle:function(f){var s=this.get(f);return typeof s=="boolean"&&this.set(f,!s),this},get:function(f){return this[f]}},function(f){var s=Math.sqrt,u=Math.atan2,h=Math.pow,r=Math.PI/180,o=Math.PI/2;e.util={cos:function(i){if(i===0)return 1;i<0&&(i=-i);var l=i/o;switch(l){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(i===0)return 0;var l=i/o,d=1;switch(i<0&&(d=-1),l){case 1:return d;case 2:return 0;case 3:return-d}return Math.sin(i)},removeFromArray:function(i,l){var d=i.indexOf(l);return d!==-1&&i.splice(d,1),i},getRandomInt:function(i,l){return Math.floor(Math.random()*(l-i+1))+i},degreesToRadians:function(i){return i*r},radiansToDegrees:function(i){return i/r},rotatePoint:function(i,l,d){var a=new e.Point(i.x-l.x,i.y-l.y),g=e.util.rotateVector(a,d);return new e.Point(g.x,g.y).addEquals(l)},rotateVector:function(i,l){var d=e.util.sin(l),a=e.util.cos(l),g=i.x*a-i.y*d,p=i.x*d+i.y*a;return{x:g,y:p}},createVector:function(i,l){return new e.Point(l.x-i.x,l.y-i.y)},calcAngleBetweenVectors:function(i,l){return Math.acos((i.x*l.x+i.y*l.y)/(Math.hypot(i.x,i.y)*Math.hypot(l.x,l.y)))},getHatVector:function(i){return new e.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,l,d){var a=e.util.createVector(i,l),g=e.util.createVector(i,d),p=e.util.calcAngleBetweenVectors(a,g),v=e.util.calcAngleBetweenVectors(e.util.rotateVector(a,p),g),x=p*(v===0?1:-1)/2;return{vector:e.util.getHatVector(e.util.rotateVector(a,x)),angle:p}},projectStrokeOnPoints:function(i,l,d){var a=[],g=l.strokeWidth/2,p=l.strokeUniform?new e.Point(1/l.scaleX,1/l.scaleY):new e.Point(1,1),v=function(x){var C=g/Math.hypot(x.x,x.y);return new e.Point(x.x*C*p.x,x.y*C*p.y)};return i.length<=1||i.forEach(function(x,C){var S=new e.Point(x.x,x.y),T,P;C===0?(P=i[C+1],T=d?v(e.util.createVector(P,S)).addEquals(S):i[i.length-1]):C===i.length-1?(T=i[C-1],P=d?v(e.util.createVector(T,S)).addEquals(S):i[0]):(T=i[C-1],P=i[C+1]);var R=e.util.getBisector(S,T,P),z=R.vector,J=R.angle,ne,ie;if(l.strokeLineJoin==="miter"&&(ne=-g/Math.sin(J/2),ie=new e.Point(z.x*ne*p.x,z.y*ne*p.y),Math.hypot(ie.x,ie.y)/g<=l.strokeMiterLimit)){a.push(S.add(ie)),a.push(S.subtract(ie));return}ne=-g*Math.SQRT2,ie=new e.Point(z.x*ne*p.x,z.y*ne*p.y),a.push(S.add(ie)),a.push(S.subtract(ie))}),a},transformPoint:function(i,l,d){return d?new e.Point(l[0]*i.x+l[2]*i.y,l[1]*i.x+l[3]*i.y):new e.Point(l[0]*i.x+l[2]*i.y+l[4],l[1]*i.x+l[3]*i.y+l[5])},makeBoundingBoxFromPoints:function(i,l){if(l)for(var d=0;d<i.length;d++)i[d]=e.util.transformPoint(i[d],l);var a=[i[0].x,i[1].x,i[2].x,i[3].x],g=e.util.array.min(a),p=e.util.array.max(a),v=p-g,x=[i[0].y,i[1].y,i[2].y,i[3].y],C=e.util.array.min(x),S=e.util.array.max(x),T=S-C;return{left:g,top:C,width:v,height:T}},invertTransform:function(i){var l=1/(i[0]*i[3]-i[1]*i[2]),d=[l*i[3],-l*i[1],-l*i[2],l*i[0]],a=e.util.transformPoint({x:i[4],y:i[5]},d,!0);return d[4]=-a.x,d[5]=-a.y,d},toFixed:function(i,l){return parseFloat(Number(i).toFixed(l))},parseUnit:function(i,l){var d=/\D{0,2}$/.exec(i),a=parseFloat(i);switch(l||(l=e.Text.DEFAULT_SVG_FONT_SIZE),d[0]){case"mm":return a*e.DPI/25.4;case"cm":return a*e.DPI/2.54;case"in":return a*e.DPI;case"pt":return a*e.DPI/72;case"pc":return a*e.DPI/72*12;case"em":return a*l;default:return a}},falseFunction:function(){return!1},getKlass:function(i,l){return i=e.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),e.util.resolveNamespace(l)[i]},getSvgAttributes:function(i){var l=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":l=l.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":l=l.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":l=l.concat(["offset","stop-color","stop-opacity"]);break}return l},resolveNamespace:function(i){if(!i)return e;var l=i.split("."),d=l.length,a,g=f||e.window;for(a=0;a<d;++a)g=g[l[a]];return g},loadImage:function(i,l,d,a){if(!i){l&&l.call(d,i);return}var g=e.util.createImage(),p=function(){l&&l.call(d,g,!1),g=g.onload=g.onerror=null};g.onload=p,g.onerror=function(){e.log("Error loading "+g.src),l&&l.call(d,null,!0),g=g.onload=g.onerror=null},i.indexOf("data")!==0&&a!==void 0&&a!==null&&(g.crossOrigin=a),i.substring(0,14)==="data:image/svg"&&(g.onload=null,e.util.loadImageInDom(g,p)),g.src=i},loadImageInDom:function(i,l){var d=e.document.createElement("div");d.style.width=d.style.height="1px",d.style.left=d.style.top="-100%",d.style.position="absolute",d.appendChild(i),e.document.querySelector("body").appendChild(d),i.onload=function(){l(),d.parentNode.removeChild(d),d=null}},enlivenObjects:function(i,l,d,a){i=i||[];var g=[],p=0,v=i.length;function x(){++p===v&&l&&l(g.filter(function(C){return C}))}if(!v){l&&l(g);return}i.forEach(function(C,S){if(!C||!C.type){x();return}var T=e.util.getKlass(C.type,d);T.fromObject(C,function(P,R){R||(g[S]=P),a&&a(C,P,R),x()})})},enlivenObjectEnlivables:function(i,l,d){var a=e.Object.ENLIVEN_PROPS.filter(function(g){return!!i[g]});e.util.enlivenObjects(a.map(function(g){return i[g]}),function(g){var p={};a.forEach(function(v,x){p[v]=g[x],l&&(l[v]=g[x])}),d&&d(p)})},enlivenPatterns:function(i,l){i=i||[];function d(){++g===p&&l&&l(a)}var a=[],g=0,p=i.length;if(!p){l&&l(a);return}i.forEach(function(v,x){v&&v.source?new e.Pattern(v,function(C){a[x]=C,d()}):(a[x]=v,d())})},groupSVGElements:function(i,l,d){var a;return i&&i.length===1?(typeof d<"u"&&(i[0].sourcePath=d),i[0]):(l&&(l.width&&l.height?l.centerPoint={x:l.width/2,y:l.height/2}:(delete l.width,delete l.height)),a=new e.Group(i,l),typeof d<"u"&&(a.sourcePath=d),a)},populateWithProperties:function(i,l,d){if(d&&Array.isArray(d))for(var a=0,g=d.length;a<g;a++)d[a]in i&&(l[d[a]]=i[d[a]])},createCanvasElement:function(){return e.document.createElement("canvas")},copyCanvasElement:function(i){var l=e.util.createCanvasElement();return l.width=i.width,l.height=i.height,l.getContext("2d").drawImage(i,0,0),l},toDataURL:function(i,l,d){return i.toDataURL("image/"+l,d)},createImage:function(){return e.document.createElement("img")},multiplyTransformMatrices:function(i,l,d){return[i[0]*l[0]+i[2]*l[1],i[1]*l[0]+i[3]*l[1],i[0]*l[2]+i[2]*l[3],i[1]*l[2]+i[3]*l[3],d?0:i[0]*l[4]+i[2]*l[5]+i[4],d?0:i[1]*l[4]+i[3]*l[5]+i[5]]},qrDecompose:function(i){var l=u(i[1],i[0]),d=h(i[0],2)+h(i[1],2),a=s(d),g=(i[0]*i[3]-i[2]*i[1])/a,p=u(i[0]*i[2]+i[1]*i[3],d);return{angle:l/r,scaleX:a,scaleY:g,skewX:p/r,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return e.iMatrix.concat();var l=e.util.degreesToRadians(i.angle),d=e.util.cos(l),a=e.util.sin(l);return[d,a,-a,d,0,0]},calcDimensionsMatrix:function(i){var l=typeof i.scaleX>"u"?1:i.scaleX,d=typeof i.scaleY>"u"?1:i.scaleY,a=[i.flipX?-l:l,0,0,i.flipY?-d:d,0,0],g=e.util.multiplyTransformMatrices,p=e.util.degreesToRadians;return i.skewX&&(a=g(a,[1,0,Math.tan(p(i.skewX)),1],!0)),i.skewY&&(a=g(a,[1,Math.tan(p(i.skewY)),0,1],!0)),a},composeMatrix:function(i){var l=[1,0,0,1,i.translateX||0,i.translateY||0],d=e.util.multiplyTransformMatrices;return i.angle&&(l=d(l,e.util.calcRotateMatrix(i))),(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY)&&(l=d(l,e.util.calcDimensionsMatrix(i))),l},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,l,d,a){a>0&&(l>a?l-=a:l=0,d>a?d-=a:d=0);var g=!0,p,v,x=i.getImageData(l,d,a*2||1,a*2||1),C=x.data.length;for(p=3;p<C&&(v=x.data[p],g=v<=0,g!==!1);p+=4);return x=null,g},parsePreserveAspectRatioAttribute:function(i){var l="meet",d="Mid",a="Mid",g=i.split(" "),p;return g&&g.length&&(l=g.pop(),l!=="meet"&&l!=="slice"?(p=l,l="meet"):g.length&&(p=g.pop())),d=p!=="none"?p.slice(1,4):"none",a=p!=="none"?p.slice(5,8):"none",{meetOrSlice:l,alignX:d,alignY:a}},clearFabricFontCache:function(i){i=(i||"").toLowerCase(),i?e.charWidthsCache[i]&&delete e.charWidthsCache[i]:e.charWidthsCache={}},limitDimsByArea:function(i,l){var d=Math.sqrt(l*i),a=Math.floor(l/d);return{x:Math.floor(d),y:a}},capValue:function(i,l,d){return Math.max(i,Math.min(l,d))},findScaleToFit:function(i,l){return Math.min(l.width/i.width,l.height/i.height)},findScaleToCover:function(i,l){return Math.max(l.width/i.width,l.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(l){return e.util.toFixed(l,e.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,l){var d=e.util.invertTransform(l),a=e.util.multiplyTransformMatrices(d,i.calcOwnMatrix());e.util.applyTransformToObject(i,a)},addTransformToObject:function(i,l){e.util.applyTransformToObject(i,e.util.multiplyTransformMatrices(l,i.calcOwnMatrix()))},applyTransformToObject:function(i,l){var d=e.util.qrDecompose(l),a=new e.Point(d.translateX,d.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",d.scaleX),i.set("scaleY",d.scaleY),i.skewX=d.skewX,i.skewY=d.skewY,i.angle=d.angle,i.setPositionByOrigin(a,"center","center")},sizeAfterTransform:function(i,l,d){var a=i/2,g=l/2,p=[{x:-a,y:-g},{x:a,y:-g},{x:-a,y:g},{x:a,y:g}],v=e.util.calcDimensionsMatrix(d),x=e.util.makeBoundingBoxFromPoints(p,v);return{x:x.width,y:x.height}},mergeClipPaths:function(i,l){var d=i,a=l;d.inverted&&!a.inverted&&(d=l,a=i),e.util.applyTransformToObject(a,e.util.multiplyTransformMatrices(e.util.invertTransform(d.calcTransformMatrix()),a.calcTransformMatrix()));var g=d.inverted&&a.inverted;return g&&(d.inverted=a.inverted=!1),new e.Group([d],{clipPath:a,inverted:g})},hasStyleChanged:function(i,l,d){return d=d||!1,i.fill!==l.fill||i.stroke!==l.stroke||i.strokeWidth!==l.strokeWidth||i.fontSize!==l.fontSize||i.fontFamily!==l.fontFamily||i.fontWeight!==l.fontWeight||i.fontStyle!==l.fontStyle||i.textBackgroundColor!==l.textBackgroundColor||i.deltaY!==l.deltaY||d&&(i.overline!==l.overline||i.underline!==l.underline||i.linethrough!==l.linethrough)},stylesToArray:function(d,l){for(var d=e.util.object.clone(d,!0),a=l.split(`
`),g=-1,p={},v=[],x=0;x<a.length;x++){if(!d[x]){g+=a[x].length;continue}for(var C=0;C<a[x].length;C++){g++;var S=d[x][C];if(S&&Object.keys(S).length>0){var T=e.util.hasStyleChanged(p,S,!0);T?v.push({start:g,end:g+1,style:S}):v[v.length-1].end++}p=S||{}}}return v},stylesFromArray:function(i,l){if(!Array.isArray(i))return i;for(var d=l.split(`
`),a=-1,g=0,p={},v=0;v<d.length;v++)for(var x=0;x<d[v].length;x++)a++,i[g]&&i[g].start<=a&&a<i[g].end&&(p[v]=p[v]||{},p[v][x]=Object.assign({},i[g].style),a===i[g].end-1&&g++);return p}}}(t),function(){var f=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},u={m:"l",M:"L"};function h(_,O,j,D,X,M,k,L,B,$,E){var I=e.util.cos(_),W=e.util.sin(_),q=e.util.cos(O),U=e.util.sin(O),N=j*X*q-D*M*U+k,G=D*X*q+j*M*U+L,A=$+B*(-j*X*W-D*M*I),F=E+B*(-D*X*W+j*M*I),Y=N+B*(j*X*U+D*M*q),Z=G+B*(D*X*U-j*M*q);return["C",A,F,Y,Z,N,G]}function r(_,O,j,D,X,M,k){var L=Math.PI,B=k*L/180,$=e.util.sin(B),E=e.util.cos(B),I=0,W=0;j=Math.abs(j),D=Math.abs(D);var q=-E*_*.5-$*O*.5,U=-E*O*.5+$*_*.5,N=j*j,G=D*D,A=U*U,F=q*q,Y=N*G-N*A-G*F,Z=0;if(Y<0){var Q=Math.sqrt(1-Y/(N*G));j*=Q,D*=Q}else Z=(X===M?-1:1)*Math.sqrt(Y/(N*A+G*F));var K=Z*j*U/D,H=-Z*D*q/j,se=E*K-$*H+_*.5,ce=$*K+E*H+O*.5,fe=o(1,0,(q-K)/j,(U-H)/D),Ce=o((q-K)/j,(U-H)/D,(-q-K)/j,(-U-H)/D);M===0&&Ce>0?Ce-=2*L:M===1&&Ce<0&&(Ce+=2*L);for(var ge=Math.ceil(Math.abs(Ce/L*2)),Ue=[],Pe=Ce/ge,en=8/3*Math.sin(Pe/4)*Math.sin(Pe/4)/Math.sin(Pe/2),Gn=fe+Pe,vt=0;vt<ge;vt++)Ue[vt]=h(fe,Gn,E,$,j,D,se,ce,en,I,W),I=Ue[vt][5],W=Ue[vt][6],fe=Gn,Gn+=Pe;return Ue}function o(_,O,j,D){var X=Math.atan2(O,_),M=Math.atan2(D,j);return M>=X?M-X:2*Math.PI-(X-M)}function i(_,O,j,D,X,M,k,L){var B;if(e.cachesBoundsOfCurve&&(B=f.call(arguments),e.boundsOfCurveCache[B]))return e.boundsOfCurveCache[B];var $=Math.sqrt,E=Math.min,I=Math.max,W=Math.abs,q=[],U=[[],[]],N,G,A,F,Y,Z,Q,K;G=6*_-12*j+6*X,N=-3*_+9*j-9*X+3*k,A=3*j-3*_;for(var H=0;H<2;++H){if(H>0&&(G=6*O-12*D+6*M,N=-3*O+9*D-9*M+3*L,A=3*D-3*O),W(N)<1e-12){if(W(G)<1e-12)continue;F=-A/G,0<F&&F<1&&q.push(F);continue}Q=G*G-4*A*N,!(Q<0)&&(K=$(Q),Y=(-G+K)/(2*N),0<Y&&Y<1&&q.push(Y),Z=(-G-K)/(2*N),0<Z&&Z<1&&q.push(Z))}for(var se,ce,fe=q.length,Ce=fe,ge;fe--;)F=q[fe],ge=1-F,se=ge*ge*ge*_+3*ge*ge*F*j+3*ge*F*F*X+F*F*F*k,U[0][fe]=se,ce=ge*ge*ge*O+3*ge*ge*F*D+3*ge*F*F*M+F*F*F*L,U[1][fe]=ce;U[0][Ce]=_,U[1][Ce]=O,U[0][Ce+1]=k,U[1][Ce+1]=L;var Ue=[{x:E.apply(null,U[0]),y:E.apply(null,U[1])},{x:I.apply(null,U[0]),y:I.apply(null,U[1])}];return e.cachesBoundsOfCurve&&(e.boundsOfCurveCache[B]=Ue),Ue}function l(_,O,j){for(var D=j[1],X=j[2],M=j[3],k=j[4],L=j[5],B=j[6],$=j[7],E=r(B-_,$-O,D,X,k,L,M),I=0,W=E.length;I<W;I++)E[I][1]+=_,E[I][2]+=O,E[I][3]+=_,E[I][4]+=O,E[I][5]+=_,E[I][6]+=O;return E}function d(_){var O=0,j=0,D=_.length,X=0,M=0,k,L,B,$=[],E,I,W;for(L=0;L<D;++L){switch(B=!1,k=_[L].slice(0),k[0]){case"l":k[0]="L",k[1]+=O,k[2]+=j;case"L":O=k[1],j=k[2];break;case"h":k[1]+=O;case"H":k[0]="L",k[2]=j,O=k[1];break;case"v":k[1]+=j;case"V":k[0]="L",j=k[1],k[1]=O,k[2]=j;break;case"m":k[0]="M",k[1]+=O,k[2]+=j;case"M":O=k[1],j=k[2],X=k[1],M=k[2];break;case"c":k[0]="C",k[1]+=O,k[2]+=j,k[3]+=O,k[4]+=j,k[5]+=O,k[6]+=j;case"C":I=k[3],W=k[4],O=k[5],j=k[6];break;case"s":k[0]="S",k[1]+=O,k[2]+=j,k[3]+=O,k[4]+=j;case"S":E==="C"?(I=2*O-I,W=2*j-W):(I=O,W=j),O=k[3],j=k[4],k[0]="C",k[5]=k[3],k[6]=k[4],k[3]=k[1],k[4]=k[2],k[1]=I,k[2]=W,I=k[3],W=k[4];break;case"q":k[0]="Q",k[1]+=O,k[2]+=j,k[3]+=O,k[4]+=j;case"Q":I=k[1],W=k[2],O=k[3],j=k[4];break;case"t":k[0]="T",k[1]+=O,k[2]+=j;case"T":E==="Q"?(I=2*O-I,W=2*j-W):(I=O,W=j),k[0]="Q",O=k[1],j=k[2],k[1]=I,k[2]=W,k[3]=O,k[4]=j;break;case"a":k[0]="A",k[6]+=O,k[7]+=j;case"A":B=!0,$=$.concat(l(O,j,k)),O=k[6],j=k[7];break;case"z":case"Z":O=X,j=M;break}B||$.push(k),E=k[0]}return $}function a(_,O,j,D){return Math.sqrt((j-_)*(j-_)+(D-O)*(D-O))}function g(_){return _*_*_}function p(_){return 3*_*_*(1-_)}function v(_){return 3*_*(1-_)*(1-_)}function x(_){return(1-_)*(1-_)*(1-_)}function C(_,O,j,D,X,M,k,L){return function(B){var $=g(B),E=p(B),I=v(B),W=x(B);return{x:k*$+X*E+j*I+_*W,y:L*$+M*E+D*I+O*W}}}function S(_,O,j,D,X,M,k,L){return function(B){var $=1-B,E=3*$*$*(j-_)+6*$*B*(X-j)+3*B*B*(k-X),I=3*$*$*(D-O)+6*$*B*(M-D)+3*B*B*(L-M);return Math.atan2(I,E)}}function T(_){return _*_}function P(_){return 2*_*(1-_)}function R(_){return(1-_)*(1-_)}function z(_,O,j,D,X,M){return function(k){var L=T(k),B=P(k),$=R(k);return{x:X*L+j*B+_*$,y:M*L+D*B+O*$}}}function J(_,O,j,D,X,M){return function(k){var L=1-k,B=2*L*(j-_)+2*k*(X-j),$=2*L*(D-O)+2*k*(M-D);return Math.atan2($,B)}}function ne(_,O,j){var D={x:O,y:j},X,M=0,k;for(k=1;k<=100;k+=1)X=_(k/100),M+=a(D.x,D.y,X.x,X.y),D=X;return M}function ie(_,O){for(var j=0,D=0,X=_.iterator,M={x:_.x,y:_.y},k,L,B=.01,$=_.angleFinder,E;D<O&&B>1e-4;)k=X(j),E=j,L=a(M.x,M.y,k.x,k.y),L+D>O?(j-=B,B/=2):(M=k,j+=B,D+=L);return k.angle=$(E),k}function te(_){for(var O=0,j=_.length,D,X=0,M=0,k=0,L=0,B=[],$,E,I,W=0;W<j;W++){switch(D=_[W],E={x:X,y:M,command:D[0]},D[0]){case"M":E.length=0,k=X=D[1],L=M=D[2];break;case"L":E.length=a(X,M,D[1],D[2]),X=D[1],M=D[2];break;case"C":$=C(X,M,D[1],D[2],D[3],D[4],D[5],D[6]),I=S(X,M,D[1],D[2],D[3],D[4],D[5],D[6]),E.iterator=$,E.angleFinder=I,E.length=ne($,X,M),X=D[5],M=D[6];break;case"Q":$=z(X,M,D[1],D[2],D[3],D[4]),I=J(X,M,D[1],D[2],D[3],D[4]),E.iterator=$,E.angleFinder=I,E.length=ne($,X,M),X=D[3],M=D[4];break;case"Z":case"z":E.destX=k,E.destY=L,E.length=a(X,M,k,L),X=k,M=L;break}O+=E.length,B.push(E)}return B.push({length:O,x:X,y:M}),B}function re(_,O,j){j||(j=te(_));for(var D=0;O-j[D].length>0&&D<j.length-2;)O-=j[D].length,D++;var X=j[D],M=O/X.length,k=X.command,L=_[D],B;switch(k){case"M":return{x:X.x,y:X.y,angle:0};case"Z":case"z":return B=new e.Point(X.x,X.y).lerp(new e.Point(X.destX,X.destY),M),B.angle=Math.atan2(X.destY-X.y,X.destX-X.x),B;case"L":return B=new e.Point(X.x,X.y).lerp(new e.Point(L[1],L[2]),M),B.angle=Math.atan2(L[2]-X.y,L[1]-X.x),B;case"C":return ie(X,O);case"Q":return ie(X,O)}}function oe(_){var O=[],j=[],D,X,M=e.rePathCommand,k="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",L="("+k+")"+e.commaWsp,B="([01])"+e.commaWsp+"?",$=L+"?"+L+"?"+L+B+B+L+"?("+k+")",E=new RegExp($,"g"),I,W,q;if(!_||!_.match)return O;q=_.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var U=0,N,G=q.length;U<G;U++){D=q[U],W=D.slice(1).trim(),j.length=0;var A=D.charAt(0);if(N=[A],A.toLowerCase()==="a")for(var F;F=E.exec(W);)for(var Y=1;Y<F.length;Y++)j.push(F[Y]);else for(;I=M.exec(W);)j.push(I[0]);for(var Y=0,Z=j.length;Y<Z;Y++)X=parseFloat(j[Y]),isNaN(X)||N.push(X);var Q=s[A.toLowerCase()],K=u[A]||A;if(N.length-1>Q)for(var H=1,se=N.length;H<se;H+=Q)O.push([A].concat(N.slice(H,H+Q))),A=K;else O.push(N)}return O}function le(_,O){var j=[],D,X=new e.Point(_[0].x,_[0].y),M=new e.Point(_[1].x,_[1].y),k=_.length,L=1,B=0,$=k>2;for(O=O||0,$&&(L=_[2].x<M.x?-1:_[2].x===M.x?0:1,B=_[2].y<M.y?-1:_[2].y===M.y?0:1),j.push(["M",X.x-L*O,X.y-B*O]),D=1;D<k;D++){if(!X.eq(M)){var E=X.midPointFrom(M);j.push(["Q",X.x,X.y,E.x,E.y])}X=_[D],D+1<_.length&&(M=_[D+1])}return $&&(L=X.x>_[D-2].x?1:X.x===_[D-2].x?0:-1,B=X.y>_[D-2].y?1:X.y===_[D-2].y?0:-1),j.push(["L",X.x+L*O,X.y+B*O]),j}function V(_,O,j){return j&&(O=e.util.multiplyTransformMatrices(O,[1,0,0,1,-j.x,-j.y])),_.map(function(D){for(var X=D.slice(0),M={},k=1;k<D.length-1;k+=2)M.x=D[k],M.y=D[k+1],M=e.util.transformPoint(M,O),X[k]=M.x,X[k+1]=M.y;return X})}e.util.joinPath=function(_){return _.map(function(O){return O.join(" ")}).join(" ")},e.util.parsePath=oe,e.util.makePathSimpler=d,e.util.getSmoothPathFromPoints=le,e.util.getPathSegmentsInfo=te,e.util.getBoundsOfCurve=i,e.util.getPointOnPath=re,e.util.transformPath=V}(),function(){var f=Array.prototype.slice;function s(i,l){for(var d=f.call(arguments,2),a=[],g=0,p=i.length;g<p;g++)a[g]=d.length?i[g][l].apply(i[g],d):i[g][l].call(i[g]);return a}function u(i,l){return o(i,l,function(d,a){return d>=a})}function h(i,l){return o(i,l,function(d,a){return d<a})}function r(i,l){for(var d=i.length;d--;)i[d]=l;return i}function o(i,l,d){if(!(!i||i.length===0)){var a=i.length-1,g=l?i[a][l]:i[a];if(l)for(;a--;)d(i[a][l],g)&&(g=i[a][l]);else for(;a--;)d(i[a],g)&&(g=i[a]);return g}}e.util.array={fill:r,invoke:s,min:h,max:u}}(),function(){function f(u,h,r){if(r)if(!e.isLikelyNode&&h instanceof Element)u=h;else if(h instanceof Array){u=[];for(var o=0,i=h.length;o<i;o++)u[o]=f({},h[o],r)}else if(h&&typeof h=="object")for(var l in h)l==="canvas"||l==="group"?u[l]=null:h.hasOwnProperty(l)&&(u[l]=f({},h[l],r));else u=h;else for(var l in h)u[l]=h[l];return u}function s(u,h){return f({},u,h)}e.util.object={extend:f,clone:s},e.util.object.extend(e.util,e.Observable)}(),function(){function f(o){return o.replace(/-+(.)?/g,function(i,l){return l?l.toUpperCase():""})}function s(o,i){return o.charAt(0).toUpperCase()+(i?o.slice(1):o.slice(1).toLowerCase())}function u(o){return o.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(o){var i=0,l,d=[];for(i=0,l;i<o.length;i++)(l=r(o,i))!==!1&&d.push(l);return d}function r(o,i){var l=o.charCodeAt(i);if(isNaN(l))return"";if(l<55296||l>57343)return o.charAt(i);if(55296<=l&&l<=56319){if(o.length<=i+1)throw"High surrogate without following low surrogate";var d=o.charCodeAt(i+1);if(56320>d||d>57343)throw"High surrogate without following low surrogate";return o.charAt(i)+o.charAt(i+1)}if(i===0)throw"Low surrogate without preceding high surrogate";var a=o.charCodeAt(i-1);if(55296>a||a>56319)throw"Low surrogate without preceding high surrogate";return!1}e.util.string={camelize:f,capitalize:s,escapeXml:u,graphemeSplit:h}}(),function(){var f=Array.prototype.slice,s=function(){},u=function(){for(var l in{toString:1})if(l==="toString")return!1;return!0}(),h=function(l,d,a){for(var g in d)g in l.prototype&&typeof l.prototype[g]=="function"&&(d[g]+"").indexOf("callSuper")>-1?l.prototype[g]=function(p){return function(){var v=this.constructor.superclass;this.constructor.superclass=a;var x=d[p].apply(this,arguments);if(this.constructor.superclass=v,p!=="initialize")return x}}(g):l.prototype[g]=d[g],u&&(d.toString!==Object.prototype.toString&&(l.prototype.toString=d.toString),d.valueOf!==Object.prototype.valueOf&&(l.prototype.valueOf=d.valueOf))};function r(){}function o(l){for(var d=null,a=this;a.constructor.superclass;){var g=a.constructor.superclass.prototype[l];if(a[l]!==g){d=g;break}a=a.constructor.superclass.prototype}return d?arguments.length>1?d.apply(this,f.call(arguments,1)):d.call(this):console.log("tried to callSuper "+l+", method not found in prototype chain",this)}function i(){var l=null,d=f.call(arguments,0);typeof d[0]=="function"&&(l=d.shift());function a(){this.initialize.apply(this,arguments)}a.superclass=l,a.subclasses=[],l&&(r.prototype=l.prototype,a.prototype=new r,l.subclasses.push(a));for(var g=0,p=d.length;g<p;g++)h(a,d[g],l);return a.prototype.initialize||(a.prototype.initialize=s),a.prototype.constructor=a,a.prototype.callSuper=o,a}e.util.createClass=i}(),function(){var f=!!e.document.createElement("div").attachEvent,s=["touchstart","touchmove","touchend"];e.util.addListener=function(h,r,o,i){h&&h.addEventListener(r,o,f?!1:i)},e.util.removeListener=function(h,r,o,i){h&&h.removeEventListener(r,o,f?!1:i)};function u(h){var r=h.changedTouches;return r&&r[0]?r[0]:h}e.util.getPointer=function(h){var r=h.target,o=e.util.getScrollLeftTop(r),i=u(h);return{x:i.clientX+o.left,y:i.clientY+o.top}},e.util.isTouchEvent=function(h){return s.indexOf(h.type)>-1||h.pointerType==="touch"}}(),function(){function f(i,l){var d=i.style;if(!d)return i;if(typeof l=="string")return i.style.cssText+=";"+l,l.indexOf("opacity")>-1?o(i,l.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var a in l)if(a==="opacity")o(i,l[a]);else{var g=a==="float"||a==="cssFloat"?typeof d.styleFloat>"u"?"cssFloat":"styleFloat":a;d.setProperty(g,l[a])}return i}var s=e.document.createElement("div"),u=typeof s.style.opacity=="string",h=typeof s.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,o=function(i){return i};u?o=function(i,l){return i.style.opacity=l,i}:h&&(o=function(i,l){var d=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(d.zoom=1),r.test(d.filter)?(l=l>=.9999?"":"alpha(opacity="+l*100+")",d.filter=d.filter.replace(r,l)):d.filter+=" alpha(opacity="+l*100+")",i}),e.util.setStyle=f}(),function(){var f=Array.prototype.slice;function s(x){return typeof x=="string"?e.document.getElementById(x):x}var u,h=function(x){return f.call(x,0)};try{u=h(e.document.childNodes)instanceof Array}catch{}u||(h=function(x){for(var C=new Array(x.length),S=x.length;S--;)C[S]=x[S];return C});function r(x,C){var S=e.document.createElement(x);for(var T in C)T==="class"?S.className=C[T]:T==="for"?S.htmlFor=C[T]:S.setAttribute(T,C[T]);return S}function o(x,C){x&&(" "+x.className+" ").indexOf(" "+C+" ")===-1&&(x.className+=(x.className?" ":"")+C)}function i(x,C,S){return typeof C=="string"&&(C=r(C,S)),x.parentNode&&x.parentNode.replaceChild(C,x),C.appendChild(x),C}function l(x){for(var C=0,S=0,T=e.document.documentElement,P=e.document.body||{scrollLeft:0,scrollTop:0};x&&(x.parentNode||x.host)&&(x=x.parentNode||x.host,x===e.document?(C=P.scrollLeft||T.scrollLeft||0,S=P.scrollTop||T.scrollTop||0):(C+=x.scrollLeft||0,S+=x.scrollTop||0),!(x.nodeType===1&&x.style.position==="fixed")););return{left:C,top:S}}function d(x){var C,S=x&&x.ownerDocument,T={left:0,top:0},P={left:0,top:0},R,z={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!S)return P;for(var J in z)P[z[J]]+=parseInt(a(x,J),10)||0;return C=S.documentElement,typeof x.getBoundingClientRect<"u"&&(T=x.getBoundingClientRect()),R=l(x),{left:T.left+R.left-(C.clientLeft||0)+P.left,top:T.top+R.top-(C.clientTop||0)+P.top}}var a;e.document.defaultView&&e.document.defaultView.getComputedStyle?a=function(x,C){var S=e.document.defaultView.getComputedStyle(x,null);return S?S[C]:void 0}:a=function(x,C){var S=x.style[C];return!S&&x.currentStyle&&(S=x.currentStyle[C]),S},function(){var x=e.document.documentElement.style,C="userSelect"in x?"userSelect":"MozUserSelect"in x?"MozUserSelect":"WebkitUserSelect"in x?"WebkitUserSelect":"KhtmlUserSelect"in x?"KhtmlUserSelect":"";function S(P){return typeof P.onselectstart<"u"&&(P.onselectstart=e.util.falseFunction),C?P.style[C]="none":typeof P.unselectable=="string"&&(P.unselectable="on"),P}function T(P){return typeof P.onselectstart<"u"&&(P.onselectstart=null),C?P.style[C]="":typeof P.unselectable=="string"&&(P.unselectable=""),P}e.util.makeElementUnselectable=S,e.util.makeElementSelectable=T}();function g(x){var C=e.jsdomImplForWrapper(x);return C._canvas||C._image}function p(x){if(e.isLikelyNode){var C=e.jsdomImplForWrapper(x);C&&(C._image=null,C._canvas=null,C._currentSrc=null,C._attributes=null,C._classList=null)}}function v(x,C){x.imageSmoothingEnabled=x.imageSmoothingEnabled||x.webkitImageSmoothingEnabled||x.mozImageSmoothingEnabled||x.msImageSmoothingEnabled||x.oImageSmoothingEnabled,x.imageSmoothingEnabled=C}e.util.setImageSmoothing=v,e.util.getById=s,e.util.toArray=h,e.util.addClass=o,e.util.makeElement=r,e.util.wrapElement=i,e.util.getScrollLeftTop=l,e.util.getElementOffset=d,e.util.getNodeCanvas=g,e.util.cleanUpJsdomNode=p}(),function(){function f(h,r){return h+(/\?/.test(h)?"&":"?")+r}function s(){}function u(h,r){r||(r={});var o=r.method?r.method.toUpperCase():"GET",i=r.onComplete||function(){},l=new e.window.XMLHttpRequest,d=r.body||r.parameters;return l.onreadystatechange=function(){l.readyState===4&&(i(l),l.onreadystatechange=s)},o==="GET"&&(d=null,typeof r.parameters=="string"&&(h=f(h,r.parameters))),l.open(o,h,!0),(o==="POST"||o==="PUT")&&l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(d),l}e.util.request=u}(),e.log=console.log,e.warn=console.warn,function(){var f=e.util.object.extend,s=e.util.object.clone,u=[];e.util.object.extend(u,{cancelAll:function(){var g=this.splice(0);return g.forEach(function(p){p.cancel()}),g},cancelByCanvas:function(g){if(!g)return[];var p=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===g});return p.forEach(function(v){v.cancel()}),p},cancelByTarget:function(g){var p=this.findAnimationsByTarget(g);return p.forEach(function(v){v.cancel()}),p},findAnimationIndex:function(g){return this.indexOf(this.findAnimation(g))},findAnimation:function(g){return this.find(function(p){return p.cancel===g})},findAnimationsByTarget:function(g){return g?this.filter(function(p){return p.target===g}):[]}});function h(){return!1}function r(g,p,v,x){return-v*Math.cos(g/x*(Math.PI/2))+v+p}function o(g){g||(g={});var p=!1,v,x=function(){var C=e.runningAnimations.indexOf(v);return C>-1&&e.runningAnimations.splice(C,1)[0]};return v=f(s(g),{cancel:function(){return p=!0,x()},currentValue:"startValue"in g?g.startValue:0,completionRate:0,durationRate:0}),e.runningAnimations.push(v),d(function(C){var S=C||+new Date,T=g.duration||500,P=S+T,R,z=g.onChange||h,J=g.abort||h,ne=g.onComplete||h,ie=g.easing||r,te="startValue"in g?g.startValue.length>0:!1,re="startValue"in g?g.startValue:0,oe="endValue"in g?g.endValue:100,le=g.byValue||(te?re.map(function(V,_){return oe[_]-re[_]}):oe-re);g.onStart&&g.onStart(),function V(_){R=_||+new Date;var O=R>P?T:R-S,j=O/T,D=te?re.map(function(M,k){return ie(O,re[k],le[k],T)}):ie(O,re,le,T),X=Math.abs(te?(D[0]-re[0])/le[0]:(D-re)/le);if(v.currentValue=te?D.slice():D,v.completionRate=X,v.durationRate=j,!p){if(J(D,X,j)){x();return}if(R>P){v.currentValue=te?oe.slice():oe,v.completionRate=1,v.durationRate=1,z(te?oe.slice():oe,1,1),ne(oe,1,1),x();return}else z(D,X,j),d(V)}}(S)}),v.cancel}var i=e.window.requestAnimationFrame||e.window.webkitRequestAnimationFrame||e.window.mozRequestAnimationFrame||e.window.oRequestAnimationFrame||e.window.msRequestAnimationFrame||function(g){return e.window.setTimeout(g,1e3/60)},l=e.window.cancelAnimationFrame||e.window.clearTimeout;function d(){return i.apply(e.window,arguments)}function a(){return l.apply(e.window,arguments)}e.util.animate=o,e.util.requestAnimFrame=d,e.util.cancelAnimFrame=a,e.runningAnimations=u}(),function(){function f(u,h,r){var o="rgba("+parseInt(u[0]+r*(h[0]-u[0]),10)+","+parseInt(u[1]+r*(h[1]-u[1]),10)+","+parseInt(u[2]+r*(h[2]-u[2]),10);return o+=","+(u&&h?parseFloat(u[3]+r*(h[3]-u[3])):1),o+=")",o}function s(u,h,r,o){var i=new e.Color(u).getSource(),l=new e.Color(h).getSource(),d=o.onComplete,a=o.onChange;return o=o||{},e.util.animate(e.util.object.extend(o,{duration:r||500,startValue:i,endValue:l,byValue:l,easing:function(g,p,v,x){var C=o.colorEasing?o.colorEasing(g,x):1-Math.cos(g/x*(Math.PI/2));return f(p,v,C)},onComplete:function(g,p,v){if(d)return d(f(l,l,0),p,v)},onChange:function(g,p,v){if(a){if(Array.isArray(g))return a(f(g,g,0),p,v);a(g,p,v)}}}))}e.util.animateColor=s}(),function(){function f(_,O,j,D){return _<Math.abs(O)?(_=O,D=j/4):O===0&&_===0?D=j/(2*Math.PI)*Math.asin(1):D=j/(2*Math.PI)*Math.asin(O/_),{a:_,c:O,p:j,s:D}}function s(_,O,j){return _.a*Math.pow(2,10*(O-=1))*Math.sin((O*j-_.s)*(2*Math.PI)/_.p)}function u(_,O,j,D){return j*((_=_/D-1)*_*_+1)+O}function h(_,O,j,D){return _/=D/2,_<1?j/2*_*_*_+O:j/2*((_-=2)*_*_+2)+O}function r(_,O,j,D){return j*(_/=D)*_*_*_+O}function o(_,O,j,D){return-j*((_=_/D-1)*_*_*_-1)+O}function i(_,O,j,D){return _/=D/2,_<1?j/2*_*_*_*_+O:-j/2*((_-=2)*_*_*_-2)+O}function l(_,O,j,D){return j*(_/=D)*_*_*_*_+O}function d(_,O,j,D){return j*((_=_/D-1)*_*_*_*_+1)+O}function a(_,O,j,D){return _/=D/2,_<1?j/2*_*_*_*_*_+O:j/2*((_-=2)*_*_*_*_+2)+O}function g(_,O,j,D){return-j*Math.cos(_/D*(Math.PI/2))+j+O}function p(_,O,j,D){return j*Math.sin(_/D*(Math.PI/2))+O}function v(_,O,j,D){return-j/2*(Math.cos(Math.PI*_/D)-1)+O}function x(_,O,j,D){return _===0?O:j*Math.pow(2,10*(_/D-1))+O}function C(_,O,j,D){return _===D?O+j:j*(-Math.pow(2,-10*_/D)+1)+O}function S(_,O,j,D){return _===0?O:_===D?O+j:(_/=D/2,_<1?j/2*Math.pow(2,10*(_-1))+O:j/2*(-Math.pow(2,-10*--_)+2)+O)}function T(_,O,j,D){return-j*(Math.sqrt(1-(_/=D)*_)-1)+O}function P(_,O,j,D){return j*Math.sqrt(1-(_=_/D-1)*_)+O}function R(_,O,j,D){return _/=D/2,_<1?-j/2*(Math.sqrt(1-_*_)-1)+O:j/2*(Math.sqrt(1-(_-=2)*_)+1)+O}function z(_,O,j,D){var X=1.70158,M=0,k=j;if(_===0)return O;if(_/=D,_===1)return O+j;M||(M=D*.3);var L=f(k,j,M,X);return-s(L,_,D)+O}function J(_,O,j,D){var X=1.70158,M=0,k=j;if(_===0)return O;if(_/=D,_===1)return O+j;M||(M=D*.3);var L=f(k,j,M,X);return L.a*Math.pow(2,-10*_)*Math.sin((_*D-L.s)*(2*Math.PI)/L.p)+L.c+O}function ne(_,O,j,D){var X=1.70158,M=0,k=j;if(_===0)return O;if(_/=D/2,_===2)return O+j;M||(M=D*(.3*1.5));var L=f(k,j,M,X);return _<1?-.5*s(L,_,D)+O:L.a*Math.pow(2,-10*(_-=1))*Math.sin((_*D-L.s)*(2*Math.PI)/L.p)*.5+L.c+O}function ie(_,O,j,D,X){return X===void 0&&(X=1.70158),j*(_/=D)*_*((X+1)*_-X)+O}function te(_,O,j,D,X){return X===void 0&&(X=1.70158),j*((_=_/D-1)*_*((X+1)*_+X)+1)+O}function re(_,O,j,D,X){return X===void 0&&(X=1.70158),_/=D/2,_<1?j/2*(_*_*(((X*=1.525)+1)*_-X))+O:j/2*((_-=2)*_*(((X*=1.525)+1)*_+X)+2)+O}function oe(_,O,j,D){return j-le(D-_,0,j,D)+O}function le(_,O,j,D){return(_/=D)<1/2.75?j*(7.5625*_*_)+O:_<2/2.75?j*(7.5625*(_-=1.5/2.75)*_+.75)+O:_<2.5/2.75?j*(7.5625*(_-=2.25/2.75)*_+.9375)+O:j*(7.5625*(_-=2.625/2.75)*_+.984375)+O}function V(_,O,j,D){return _<D/2?oe(_*2,0,j,D)*.5+O:le(_*2-D,0,j,D)*.5+j*.5+O}e.util.ease={easeInQuad:function(_,O,j,D){return j*(_/=D)*_+O},easeOutQuad:function(_,O,j,D){return-j*(_/=D)*(_-2)+O},easeInOutQuad:function(_,O,j,D){return _/=D/2,_<1?j/2*_*_+O:-j/2*(--_*(_-2)-1)+O},easeInCubic:function(_,O,j,D){return j*(_/=D)*_*_+O},easeOutCubic:u,easeInOutCubic:h,easeInQuart:r,easeOutQuart:o,easeInOutQuart:i,easeInQuint:l,easeOutQuint:d,easeInOutQuint:a,easeInSine:g,easeOutSine:p,easeInOutSine:v,easeInExpo:x,easeOutExpo:C,easeInOutExpo:S,easeInCirc:T,easeOutCirc:P,easeInOutCirc:R,easeInElastic:z,easeOutElastic:J,easeInOutElastic:ne,easeInBack:ie,easeOutBack:te,easeInOutBack:re,easeInBounce:oe,easeOutBounce:le,easeInOutBounce:V}}(),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend,h=s.util.object.clone,r=s.util.toFixed,o=s.util.parseUnit,i=s.util.multiplyTransformMatrices,l=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],d=["symbol","image","marker","pattern","view","svg"],a=["pattern","defs","symbol","metadata","clipPath","mask","desc"],g=["symbol","g","a","svg","clipPath","defs"],p={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},v={stroke:"strokeOpacity",fill:"fillOpacity"},x="font-size",C="clip-path";s.svgValidTagNamesRegEx=P(l),s.svgViewBoxElementsRegEx=P(d),s.svgInvalidAncestorsRegEx=P(a),s.svgValidParentsRegEx=P(g),s.cssRules={},s.gradientDefs={},s.clipPaths={};function S(M){return M in p?p[M]:M}function T(M,k,L,B){var $=Array.isArray(k),E;if((M==="fill"||M==="stroke")&&k==="none")k="";else{if(M==="strokeUniform")return k==="non-scaling-stroke";if(M==="strokeDashArray")k==="none"?k=null:k=k.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(M==="transformMatrix")L&&L.transformMatrix?k=i(L.transformMatrix,s.parseTransformAttribute(k)):k=s.parseTransformAttribute(k);else if(M==="visible")k=k!=="none"&&k!=="hidden",L&&L.visible===!1&&(k=!1);else if(M==="opacity")k=parseFloat(k),L&&typeof L.opacity<"u"&&(k*=L.opacity);else if(M==="textAnchor")k=k==="start"?"left":k==="end"?"right":"center";else if(M==="charSpacing")E=o(k,B)/B*1e3;else if(M==="paintFirst"){var I=k.indexOf("fill"),W=k.indexOf("stroke"),k="fill";(I>-1&&W>-1&&W<I||I===-1&&W>-1)&&(k="stroke")}else{if(M==="href"||M==="xlink:href"||M==="font")return k;if(M==="imageSmoothing")return k==="optimizeQuality";E=$?k.map(o):o(k,B)}}return!$&&isNaN(E)?k:E}function P(M){return new RegExp("^("+M.join("|")+")\\b","i")}function R(M){for(var k in v)if(!(typeof M[v[k]]>"u"||M[k]==="")){if(typeof M[k]>"u"){if(!s.Object.prototype[k])continue;M[k]=s.Object.prototype[k]}if(M[k].indexOf("url(")!==0){var L=new s.Color(M[k]);M[k]=L.setAlpha(r(L.getAlpha()*M[v[k]],2)).toRgba()}}return M}function z(M,k){var L,B=[],$,E,I;for(E=0,I=k.length;E<I;E++)L=k[E],$=M.getElementsByTagName(L),B=B.concat(Array.prototype.slice.call($));return B}s.parseTransformAttribute=function(){function M(H,se){var ce=s.util.cos(se[0]),fe=s.util.sin(se[0]),Ce=0,ge=0;se.length===3&&(Ce=se[1],ge=se[2]),H[0]=ce,H[1]=fe,H[2]=-fe,H[3]=ce,H[4]=Ce-(ce*Ce-fe*ge),H[5]=ge-(fe*Ce+ce*ge)}function k(H,se){var ce=se[0],fe=se.length===2?se[1]:se[0];H[0]=ce,H[3]=fe}function L(H,se,ce){H[ce]=Math.tan(s.util.degreesToRadians(se[0]))}function B(H,se){H[4]=se[0],se.length===2&&(H[5]=se[1])}var $=s.iMatrix,E=s.reNum,I=s.commaWsp,W="(?:(skewX)\\s*\\(\\s*("+E+")\\s*\\))",q="(?:(skewY)\\s*\\(\\s*("+E+")\\s*\\))",U="(?:(rotate)\\s*\\(\\s*("+E+")(?:"+I+"("+E+")"+I+"("+E+"))?\\s*\\))",N="(?:(scale)\\s*\\(\\s*("+E+")(?:"+I+"("+E+"))?\\s*\\))",G="(?:(translate)\\s*\\(\\s*("+E+")(?:"+I+"("+E+"))?\\s*\\))",A="(?:(matrix)\\s*\\(\\s*("+E+")"+I+"("+E+")"+I+"("+E+")"+I+"("+E+")"+I+"("+E+")"+I+"("+E+")\\s*\\))",F="(?:"+A+"|"+G+"|"+N+"|"+U+"|"+W+"|"+q+")",Y="(?:"+F+"(?:"+I+"*"+F+")*)",Z="^\\s*(?:"+Y+"?)\\s*$",Q=new RegExp(Z),K=new RegExp(F,"g");return function(H){var se=$.concat(),ce=[];if(!H||H&&!Q.test(H))return se;H.replace(K,function(Ce){var ge=new RegExp(F).exec(Ce).filter(function(en){return!!en}),Ue=ge[1],Pe=ge.slice(2).map(parseFloat);switch(Ue){case"translate":B(se,Pe);break;case"rotate":Pe[0]=s.util.degreesToRadians(Pe[0]),M(se,Pe);break;case"scale":k(se,Pe);break;case"skewX":L(se,Pe,2);break;case"skewY":L(se,Pe,1);break;case"matrix":se=Pe;break}ce.push(se.concat()),se=$.concat()});for(var fe=ce[0];ce.length>1;)ce.shift(),fe=s.util.multiplyTransformMatrices(fe,ce[0]);return fe}}();function J(M,k){var L,B;M.replace(/;\s*$/,"").split(";").forEach(function($){var E=$.split(":");L=E[0].trim().toLowerCase(),B=E[1].trim(),k[L]=B})}function ne(M,k){var L,B;for(var $ in M)typeof M[$]>"u"||(L=$.toLowerCase(),B=M[$],k[L]=B)}function ie(M,k){var L={};for(var B in s.cssRules[k])if(te(M,B.split(" ")))for(var $ in s.cssRules[k][B])L[$]=s.cssRules[k][B][$];return L}function te(M,k){var L,B=!0;return L=oe(M,k.pop()),L&&k.length&&(B=re(M,k)),L&&B&&k.length===0}function re(M,k){for(var L,B=!0;M.parentNode&&M.parentNode.nodeType===1&&k.length;)B&&(L=k.pop()),M=M.parentNode,B=oe(M,L);return k.length===0}function oe(M,k){var L=M.nodeName,B=M.getAttribute("class"),$=M.getAttribute("id"),E,I;if(E=new RegExp("^"+L,"i"),k=k.replace(E,""),$&&k.length&&(E=new RegExp("#"+$+"(?![a-zA-Z\\-]+)","i"),k=k.replace(E,"")),B&&k.length)for(B=B.split(" "),I=B.length;I--;)E=new RegExp("\\."+B[I]+"(?![a-zA-Z\\-]+)","i"),k=k.replace(E,"");return k.length===0}function le(M,k){var L;if(M.getElementById&&(L=M.getElementById(k)),L)return L;var B,$,E,I=M.getElementsByTagName("*");for($=0,E=I.length;$<E;$++)if(B=I[$],k===B.getAttribute("id"))return B}function V(M){for(var k=z(M,["use","svg:use"]),L=0;k.length&&L<k.length;){var B=k[L],$=B.getAttribute("xlink:href")||B.getAttribute("href");if($===null)return;var E=$.slice(1),I=B.getAttribute("x")||0,W=B.getAttribute("y")||0,q=le(M,E).cloneNode(!0),U=(q.getAttribute("transform")||"")+" translate("+I+", "+W+")",N,G=k.length,A,F,Y,Z,Q=s.svgNS;if(O(q),/^svg$/i.test(q.nodeName)){var K=q.ownerDocument.createElementNS(Q,"g");for(F=0,Y=q.attributes,Z=Y.length;F<Z;F++)A=Y.item(F),K.setAttributeNS(Q,A.nodeName,A.nodeValue);for(;q.firstChild;)K.appendChild(q.firstChild);q=K}for(F=0,Y=B.attributes,Z=Y.length;F<Z;F++)A=Y.item(F),!(A.nodeName==="x"||A.nodeName==="y"||A.nodeName==="xlink:href"||A.nodeName==="href")&&(A.nodeName==="transform"?U=A.nodeValue+" "+U:q.setAttribute(A.nodeName,A.nodeValue));q.setAttribute("transform",U),q.setAttribute("instantiated_by_use","1"),q.removeAttribute("id"),N=B.parentNode,N.replaceChild(q,B),k.length===G&&L++}}var _=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function O(M){if(!s.svgViewBoxElementsRegEx.test(M.nodeName))return{};var k=M.getAttribute("viewBox"),L=1,B=1,$=0,E=0,I,W,q,U,N=M.getAttribute("width"),G=M.getAttribute("height"),A=M.getAttribute("x")||0,F=M.getAttribute("y")||0,Y=M.getAttribute("preserveAspectRatio")||"",Z=!k||!(k=k.match(_)),Q=!N||!G||N==="100%"||G==="100%",K=Z&&Q,H={},se="",ce=0,fe=0;if(H.width=0,H.height=0,H.toBeParsed=K,Z&&(A||F)&&M.parentNode&&M.parentNode.nodeName!=="#document"&&(se=" translate("+o(A)+" "+o(F)+") ",q=(M.getAttribute("transform")||"")+se,M.setAttribute("transform",q),M.removeAttribute("x"),M.removeAttribute("y")),K)return H;if(Z)return H.width=o(N),H.height=o(G),H;if($=-parseFloat(k[1]),E=-parseFloat(k[2]),I=parseFloat(k[3]),W=parseFloat(k[4]),H.minX=$,H.minY=E,H.viewBoxWidth=I,H.viewBoxHeight=W,Q?(H.width=I,H.height=W):(H.width=o(N),H.height=o(G),L=H.width/I,B=H.height/W),Y=s.util.parsePreserveAspectRatioAttribute(Y),Y.alignX!=="none"&&(Y.meetOrSlice==="meet"&&(B=L=L>B?B:L),Y.meetOrSlice==="slice"&&(B=L=L>B?L:B),ce=H.width-I*L,fe=H.height-W*L,Y.alignX==="Mid"&&(ce/=2),Y.alignY==="Mid"&&(fe/=2),Y.alignX==="Min"&&(ce=0),Y.alignY==="Min"&&(fe=0)),L===1&&B===1&&$===0&&E===0&&A===0&&F===0)return H;if((A||F)&&M.parentNode.nodeName!=="#document"&&(se=" translate("+o(A)+" "+o(F)+") "),q=se+" matrix("+L+" 0 0 "+B+" "+($*L+ce)+" "+(E*B+fe)+") ",M.nodeName==="svg"){for(U=M.ownerDocument.createElementNS(s.svgNS,"g");M.firstChild;)U.appendChild(M.firstChild);M.appendChild(U)}else U=M,U.removeAttribute("x"),U.removeAttribute("y"),q=U.getAttribute("transform")+q;return U.setAttribute("transform",q),H}function j(M,k){for(;M&&(M=M.parentNode);)if(M.nodeName&&k.test(M.nodeName.replace("svg:",""))&&!M.getAttribute("instantiated_by_use"))return!0;return!1}s.parseSVGDocument=function(M,k,L,B){if(M){V(M);var $=s.Object.__uid++,E,I,W=O(M),q=s.util.toArray(M.getElementsByTagName("*"));if(W.crossOrigin=B&&B.crossOrigin,W.svgUid=$,q.length===0&&s.isLikelyNode){q=M.selectNodes('//*[name(.)!="svg"]');var U=[];for(E=0,I=q.length;E<I;E++)U[E]=q[E];q=U}var N=q.filter(function(A){return O(A),s.svgValidTagNamesRegEx.test(A.nodeName.replace("svg:",""))&&!j(A,s.svgInvalidAncestorsRegEx)});if(!N||N&&!N.length){k&&k([],{});return}var G={};q.filter(function(A){return A.nodeName.replace("svg:","")==="clipPath"}).forEach(function(A){var F=A.getAttribute("id");G[F]=s.util.toArray(A.getElementsByTagName("*")).filter(function(Y){return s.svgValidTagNamesRegEx.test(Y.nodeName.replace("svg:",""))})}),s.gradientDefs[$]=s.getGradientDefs(M),s.cssRules[$]=s.getCSSRules(M),s.clipPaths[$]=G,s.parseElements(N,function(A,F){k&&(k(A,W,F,q),delete s.gradientDefs[$],delete s.cssRules[$],delete s.clipPaths[$])},h(W),L,B)}};function D(M,k){var L=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],B="xlink:href",$=k.getAttribute(B).slice(1),E=le(M,$);if(E&&E.getAttribute(B)&&D(M,E),L.forEach(function(W){E&&!k.hasAttribute(W)&&E.hasAttribute(W)&&k.setAttribute(W,E.getAttribute(W))}),!k.children.length)for(var I=E.cloneNode(!0);I.firstChild;)k.appendChild(I.firstChild);k.removeAttribute(B)}var X=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");u(s,{parseFontDeclaration:function(M,k){var L=M.match(X);if(L){var B=L[1],$=L[3],E=L[4],I=L[5],W=L[6];B&&(k.fontStyle=B),$&&(k.fontWeight=isNaN(parseFloat($))?$:parseFloat($)),E&&(k.fontSize=o(E)),W&&(k.fontFamily=W),I&&(k.lineHeight=I==="normal"?1:I)}},getGradientDefs:function(M){var k=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],L=z(M,k),B,$=0,E={};for($=L.length;$--;)B=L[$],B.getAttribute("xlink:href")&&D(M,B),E[B.getAttribute("id")]=B;return E},parseAttributes:function(M,k,L){if(M){var B,$={},E,I;typeof L>"u"&&(L=M.getAttribute("svgUid")),M.parentNode&&s.svgValidParentsRegEx.test(M.parentNode.nodeName)&&($=s.parseAttributes(M.parentNode,k,L));var W=k.reduce(function(Y,Z){return B=M.getAttribute(Z),B&&(Y[Z]=B),Y},{}),q=u(ie(M,L),s.parseStyleAttribute(M));W=u(W,q),q[C]&&M.setAttribute(C,q[C]),E=I=$.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,W[x]&&(W[x]=E=o(W[x],I));var U,N,G={};for(var A in W)U=S(A),N=T(U,W[A],$,E),G[U]=N;G&&G.font&&s.parseFontDeclaration(G.font,G);var F=u($,G);return s.svgValidParentsRegEx.test(M.nodeName)?F:R(F)}},parseElements:function(M,k,L,B,$){new s.ElementsParser(M,k,L,B,$).parse()},parseStyleAttribute:function(M){var k={},L=M.getAttribute("style");return L&&(typeof L=="string"?J(L,k):ne(L,k)),k},parsePointsAttribute:function(M){if(!M)return null;M=M.replace(/,/g," ").trim(),M=M.split(/\s+/);var k=[],L,B;for(L=0,B=M.length;L<B;L+=2)k.push({x:parseFloat(M[L]),y:parseFloat(M[L+1])});return k},getCSSRules:function(M){var k=M.getElementsByTagName("style"),L,B,$={},E;for(L=0,B=k.length;L<B;L++){var I=k[L].textContent;I=I.replace(/\/\*[\s\S]*?\*\//g,""),I.trim()!==""&&(E=I.split("}"),E=E.filter(function(W){return W.trim()}),E.forEach(function(W){var q=W.split("{"),U={},N=q[1].trim(),G=N.split(";").filter(function(Z){return Z.trim()});for(L=0,B=G.length;L<B;L++){var A=G[L].split(":"),F=A[0].trim(),Y=A[1].trim();U[F]=Y}W=q[0].trim(),W.split(",").forEach(function(Z){Z=Z.replace(/^svg/i,"").trim(),Z!==""&&($[Z]?s.util.object.extend($[Z],U):$[Z]=s.util.object.clone(U))})}))}return $},loadSVGFromURL:function(M,k,L,B){M=M.replace(/^\n\s*/,"").trim(),new s.util.request(M,{method:"get",onComplete:$});function $(E){var I=E.responseXML;if(!I||!I.documentElement)return k&&k(null),!1;s.parseSVGDocument(I.documentElement,function(W,q,U,N){k&&k(W,q,U,N)},L,B)}},loadSVGFromString:function(M,k,L,B){var $=new s.window.DOMParser,E=$.parseFromString(M.trim(),"text/xml");s.parseSVGDocument(E.documentElement,function(I,W,q,U){k(I,W,q,U)},L,B)}})}(t),e.ElementsParser=function(f,s,u,h,r,o){this.elements=f,this.callback=s,this.options=u,this.reviver=h,this.svgUid=u&&u.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=o},function(f){f.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},f.createObjects=function(){var s=this;this.elements.forEach(function(u,h){u.setAttribute("svgUid",s.svgUid),s.createObject(u,h)})},f.findTag=function(s){return e[e.util.string.capitalize(s.tagName.replace("svg:",""))]},f.createObject=function(s,u){var h=this.findTag(s);if(h&&h.fromElement)try{h.fromElement(s,this.createCallback(u,s),this.options)}catch(r){e.log(r)}else this.checkIfDone()},f.createCallback=function(s,u){var h=this;return function(r){var o;h.resolveGradient(r,u,"fill"),h.resolveGradient(r,u,"stroke"),r instanceof e.Image&&r._originalElement&&(o=r.parsePreserveAspectRatioAttribute(u)),r._removeTransformMatrix(o),h.resolveClipPath(r,u),h.reviver&&h.reviver(u,r),h.instances[s]=r,h.checkIfDone()}},f.extractPropertyDefinition=function(s,u,h){var r=s[u],o=this.regexUrl;if(o.test(r)){o.lastIndex=0;var i=o.exec(r)[1];return o.lastIndex=0,e[h][this.svgUid][i]}},f.resolveGradient=function(s,u,h){var r=this.extractPropertyDefinition(s,h,"gradientDefs");if(r){var o=u.getAttribute(h+"-opacity"),i=e.Gradient.fromElement(r,s,o,this.options);s.set(h,i)}},f.createClipPathCallback=function(s,u){return function(h){h._removeTransformMatrix(),h.fillRule=h.clipRule,u.push(h)}},f.resolveClipPath=function(s,u){var h=this.extractPropertyDefinition(s,"clipPath","clipPaths"),r,o,i,l,d,a;if(h){l=[],i=e.util.invertTransform(s.calcTransformMatrix());for(var g=h[0].parentNode,p=u;p.parentNode&&p.getAttribute("clip-path")!==s.clipPath;)p=p.parentNode;p.parentNode.appendChild(g);for(var v=0;v<h.length;v++)r=h[v],o=this.findTag(r),o.fromElement(r,this.createClipPathCallback(s,l),this.options);l.length===1?h=l[0]:h=new e.Group(l),d=e.util.multiplyTransformMatrices(i,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,p);var a=e.util.qrDecompose(d);h.flipX=!1,h.flipY=!1,h.set("scaleX",a.scaleX),h.set("scaleY",a.scaleY),h.angle=a.angle,h.skewX=a.skewX,h.skewY=0,h.setPositionByOrigin({x:a.translateX,y:a.translateY},"center","center"),s.clipPath=h}else delete s.clipPath},f.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))}}(e.ElementsParser.prototype),function(f){var s=f.fabric||(f.fabric={});if(s.Point){s.warn("fabric.Point is already defined");return}s.Point=u;function u(h,r){this.x=h,this.y=r}u.prototype={type:"point",constructor:u,add:function(h){return new u(this.x+h.x,this.y+h.y)},addEquals:function(h){return this.x+=h.x,this.y+=h.y,this},scalarAdd:function(h){return new u(this.x+h,this.y+h)},scalarAddEquals:function(h){return this.x+=h,this.y+=h,this},subtract:function(h){return new u(this.x-h.x,this.y-h.y)},subtractEquals:function(h){return this.x-=h.x,this.y-=h.y,this},scalarSubtract:function(h){return new u(this.x-h,this.y-h)},scalarSubtractEquals:function(h){return this.x-=h,this.y-=h,this},multiply:function(h){return new u(this.x*h,this.y*h)},multiplyEquals:function(h){return this.x*=h,this.y*=h,this},divide:function(h){return new u(this.x/h,this.y/h)},divideEquals:function(h){return this.x/=h,this.y/=h,this},eq:function(h){return this.x===h.x&&this.y===h.y},lt:function(h){return this.x<h.x&&this.y<h.y},lte:function(h){return this.x<=h.x&&this.y<=h.y},gt:function(h){return this.x>h.x&&this.y>h.y},gte:function(h){return this.x>=h.x&&this.y>=h.y},lerp:function(h,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new u(this.x+(h.x-this.x)*r,this.y+(h.y-this.y)*r)},distanceFrom:function(h){var r=this.x-h.x,o=this.y-h.y;return Math.sqrt(r*r+o*o)},midPointFrom:function(h){return this.lerp(h)},min:function(h){return new u(Math.min(this.x,h.x),Math.min(this.y,h.y))},max:function(h){return new u(Math.max(this.x,h.x),Math.max(this.y,h.y))},toString:function(){return this.x+","+this.y},setXY:function(h,r){return this.x=h,this.y=r,this},setX:function(h){return this.x=h,this},setY:function(h){return this.y=h,this},setFromPoint:function(h){return this.x=h.x,this.y=h.y,this},swap:function(h){var r=this.x,o=this.y;this.x=h.x,this.y=h.y,h.x=r,h.y=o},clone:function(){return new u(this.x,this.y)}}}(t),function(f){var s=f.fabric||(f.fabric={});if(s.Intersection){s.warn("fabric.Intersection is already defined");return}function u(h){this.status=h,this.points=[]}s.Intersection=u,s.Intersection.prototype={constructor:u,appendPoint:function(h){return this.points.push(h),this},appendPoints:function(h){return this.points=this.points.concat(h),this}},s.Intersection.intersectLineLine=function(h,r,o,i){var l,d=(i.x-o.x)*(h.y-o.y)-(i.y-o.y)*(h.x-o.x),a=(r.x-h.x)*(h.y-o.y)-(r.y-h.y)*(h.x-o.x),g=(i.y-o.y)*(r.x-h.x)-(i.x-o.x)*(r.y-h.y);if(g!==0){var p=d/g,v=a/g;0<=p&&p<=1&&0<=v&&v<=1?(l=new u("Intersection"),l.appendPoint(new s.Point(h.x+p*(r.x-h.x),h.y+p*(r.y-h.y)))):l=new u}else d===0||a===0?l=new u("Coincident"):l=new u("Parallel");return l},s.Intersection.intersectLinePolygon=function(h,r,o){var i=new u,l=o.length,d,a,g,p;for(p=0;p<l;p++)d=o[p],a=o[(p+1)%l],g=u.intersectLineLine(h,r,d,a),i.appendPoints(g.points);return i.points.length>0&&(i.status="Intersection"),i},s.Intersection.intersectPolygonPolygon=function(h,r){var o=new u,i=h.length,l;for(l=0;l<i;l++){var d=h[l],a=h[(l+1)%i],g=u.intersectLinePolygon(d,a,r);o.appendPoints(g.points)}return o.points.length>0&&(o.status="Intersection"),o},s.Intersection.intersectPolygonRectangle=function(h,r,o){var i=r.min(o),l=r.max(o),d=new s.Point(l.x,i.y),a=new s.Point(i.x,l.y),g=u.intersectLinePolygon(i,d,h),p=u.intersectLinePolygon(d,l,h),v=u.intersectLinePolygon(l,a,h),x=u.intersectLinePolygon(a,i,h),C=new u;return C.appendPoints(g.points),C.appendPoints(p.points),C.appendPoints(v.points),C.appendPoints(x.points),C.points.length>0&&(C.status="Intersection"),C}}(t),function(f){var s=f.fabric||(f.fabric={});if(s.Color){s.warn("fabric.Color is already defined.");return}function u(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}s.Color=u,s.Color.prototype={_tryParsingColor:function(r){var o;r in u.colorNameMap&&(r=u.colorNameMap[r]),r==="transparent"&&(o=[255,255,255,0]),o||(o=u.sourceFromHex(r)),o||(o=u.sourceFromRgb(r)),o||(o=u.sourceFromHsl(r)),o||(o=[0,0,0,1]),o&&this.setSource(o)},_rgbToHsl:function(r,o,i){r/=255,o/=255,i/=255;var l,d,a,g=s.util.array.max([r,o,i]),p=s.util.array.min([r,o,i]);if(a=(g+p)/2,g===p)l=d=0;else{var v=g-p;switch(d=a>.5?v/(2-g-p):v/(g+p),g){case r:l=(o-i)/v+(o<i?6:0);break;case o:l=(i-r)/v+2;break;case i:l=(r-o)/v+4;break}l/=6}return[Math.round(l*360),Math.round(d*100),Math.round(a*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),o=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+o[0]+","+o[1]+"%,"+o[2]+"%)"},toHsla:function(){var r=this.getSource(),o=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+o[0]+","+o[1]+"%,"+o[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),o,i,l;return o=r[0].toString(16),o=o.length===1?"0"+o:o,i=r[1].toString(16),i=i.length===1?"0"+i:i,l=r[2].toString(16),l=l.length===1?"0"+l:l,o.toUpperCase()+i.toUpperCase()+l.toUpperCase()},toHexa:function(){var r=this.getSource(),o;return o=Math.round(r[3]*255),o=o.toString(16),o=o.length===1?"0"+o:o,this.toHex()+o.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var o=this.getSource();return o[3]=r,this.setSource(o),this},toGrayscale:function(){var r=this.getSource(),o=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),i=r[3];return this.setSource([o,o,o,i]),this},toBlackWhite:function(r){var o=this.getSource(),i=(o[0]*.3+o[1]*.59+o[2]*.11).toFixed(0),l=o[3];return r=r||127,i=Number(i)<Number(r)?0:255,this.setSource([i,i,i,l]),this},overlayWith:function(r){r instanceof u||(r=new u(r));var o=[],i=this.getAlpha(),l=.5,d=this.getSource(),a=r.getSource(),g;for(g=0;g<3;g++)o.push(Math.round(d[g]*(1-l)+a[g]*l));return o[3]=i,this.setSource(o),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function h(r,o,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(o-r)*6*i:i<1/2?o:i<2/3?r+(o-r)*(2/3-i)*6:r}s.Color.fromRgb=function(r){return u.fromSource(u.sourceFromRgb(r))},s.Color.sourceFromRgb=function(r){var o=r.match(u.reRGBa);if(o){var i=parseInt(o[1],10)/(/%$/.test(o[1])?100:1)*(/%$/.test(o[1])?255:1),l=parseInt(o[2],10)/(/%$/.test(o[2])?100:1)*(/%$/.test(o[2])?255:1),d=parseInt(o[3],10)/(/%$/.test(o[3])?100:1)*(/%$/.test(o[3])?255:1);return[parseInt(i,10),parseInt(l,10),parseInt(d,10),o[4]?parseFloat(o[4]):1]}},s.Color.fromRgba=u.fromRgb,s.Color.fromHsl=function(r){return u.fromSource(u.sourceFromHsl(r))},s.Color.sourceFromHsl=function(r){var o=r.match(u.reHSLa);if(o){var i=(parseFloat(o[1])%360+360)%360/360,l=parseFloat(o[2])/(/%$/.test(o[2])?100:1),d=parseFloat(o[3])/(/%$/.test(o[3])?100:1),a,g,p;if(l===0)a=g=p=d;else{var v=d<=.5?d*(l+1):d+l-d*l,x=d*2-v;a=h(x,v,i+1/3),g=h(x,v,i),p=h(x,v,i-1/3)}return[Math.round(a*255),Math.round(g*255),Math.round(p*255),o[4]?parseFloat(o[4]):1]}},s.Color.fromHsla=u.fromHsl,s.Color.fromHex=function(r){return u.fromSource(u.sourceFromHex(r))},s.Color.sourceFromHex=function(r){if(r.match(u.reHex)){var o=r.slice(r.indexOf("#")+1),i=o.length===3||o.length===4,l=o.length===8||o.length===4,d=i?o.charAt(0)+o.charAt(0):o.substring(0,2),a=i?o.charAt(1)+o.charAt(1):o.substring(2,4),g=i?o.charAt(2)+o.charAt(2):o.substring(4,6),p=l?i?o.charAt(3)+o.charAt(3):o.substring(6,8):"FF";return[parseInt(d,16),parseInt(a,16),parseInt(g,16),parseFloat((parseInt(p,16)/255).toFixed(2))]}},s.Color.fromSource=function(r){var o=new u;return o.setSource(r),o}}(t),function(f){var s=f.fabric||(f.fabric={}),u=["e","se","s","sw","w","nw","n","ne","e"],h=["ns","nesw","ew","nwse"],r={},o="left",i="top",l="right",d="bottom",a="center",g={top:d,bottom:i,left:l,right:o,center:a},p=s.util.radiansToDegrees,v=Math.sign||function(U){return(U>0)-(U<0)||+U};function x(U,N){var G=U.angle+p(Math.atan2(N.y,N.x))+360;return Math.round(G%360/45)}function C(U,N){var G=N.transform.target,A=G.canvas,F=s.util.object.clone(N);F.target=G,A&&A.fire("object:"+U,F),G.fire(U,N)}function S(U,N){var G=N.canvas,A=G.uniScaleKey,F=U[A];return G.uniformScaling&&!F||!G.uniformScaling&&F}function T(U){return U.originX===a&&U.originY===a}function P(U,N,G){var A=U.lockScalingX,F=U.lockScalingY;return!!(A&&F||!N&&(A||F)&&G||A&&N==="x"||F&&N==="y")}function R(U,N,G){var A="not-allowed",F=S(U,G),Y="";if(N.x!==0&&N.y===0?Y="x":N.x===0&&N.y!==0&&(Y="y"),P(G,Y,F))return A;var Z=x(G,N);return u[Z]+"-resize"}function z(U,N,G){var A="not-allowed";if(N.x!==0&&G.lockSkewingY||N.y!==0&&G.lockSkewingX)return A;var F=x(G,N)%4;return h[F]+"-resize"}function J(U,N,G){return U[G.canvas.altActionKey]?r.skewCursorStyleHandler(U,N,G):r.scaleCursorStyleHandler(U,N,G)}function ne(U,N,G){var A=U[G.canvas.altActionKey];if(N.x===0)return A?"skewX":"scaleY";if(N.y===0)return A?"skewY":"scaleX"}function ie(U,N,G){return G.lockRotation?"not-allowed":N.cursorStyle}function te(U,N,G,A){return{e:U,transform:N,pointer:{x:G,y:A}}}function re(U){return function(N,G,A,F){var Y=G.target,Z=Y.getCenterPoint(),Q=Y.translateToOriginPoint(Z,G.originX,G.originY),K=U(N,G,A,F);return Y.setPositionByOrigin(Q,G.originX,G.originY),K}}function oe(U,N){return function(G,A,F,Y){var Z=N(G,A,F,Y);return Z&&C(U,te(G,A,F,Y)),Z}}function le(U,N,G,A,F){var Y=U.target,Z=Y.controls[U.corner],Q=Y.canvas.getZoom(),K=Y.padding/Q,H=Y.toLocalPoint(new s.Point(A,F),N,G);return H.x>=K&&(H.x-=K),H.x<=-K&&(H.x+=K),H.y>=K&&(H.y-=K),H.y<=K&&(H.y+=K),H.x-=Z.offsetX,H.y-=Z.offsetY,H}function V(U){return U.flipX!==U.flipY}function _(U,N,G,A,F){if(U[N]!==0){var Y=U._getTransformedDimensions()[A],Z=F/Y*U[G];U.set(G,Z)}}function O(U,N,G,A){var F=N.target,Y=F._getTransformedDimensions(0,F.skewY),Z=le(N,N.originX,N.originY,G,A),Q=Math.abs(Z.x*2)-Y.x,K=F.skewX,H;Q<2?H=0:(H=p(Math.atan2(Q/F.scaleX,Y.y/F.scaleY)),N.originX===o&&N.originY===d&&(H=-H),N.originX===l&&N.originY===i&&(H=-H),V(F)&&(H=-H));var se=K!==H;if(se){var ce=F._getTransformedDimensions().y;F.set("skewX",H),_(F,"skewY","scaleY","y",ce)}return se}function j(U,N,G,A){var F=N.target,Y=F._getTransformedDimensions(F.skewX,0),Z=le(N,N.originX,N.originY,G,A),Q=Math.abs(Z.y*2)-Y.y,K=F.skewY,H;Q<2?H=0:(H=p(Math.atan2(Q/F.scaleY,Y.x/F.scaleX)),N.originX===o&&N.originY===d&&(H=-H),N.originX===l&&N.originY===i&&(H=-H),V(F)&&(H=-H));var se=K!==H;if(se){var ce=F._getTransformedDimensions().x;F.set("skewY",H),_(F,"skewX","scaleX","x",ce)}return se}function D(U,N,G,A){var F=N.target,Y=F.skewX,Z,Q=N.originY;if(F.lockSkewingX)return!1;if(Y===0){var K=le(N,a,a,G,A);K.x>0?Z=o:Z=l}else Y>0&&(Z=Q===i?o:l),Y<0&&(Z=Q===i?l:o),V(F)&&(Z=Z===o?l:o);N.originX=Z;var H=oe("skewing",re(O));return H(U,N,G,A)}function X(U,N,G,A){var F=N.target,Y=F.skewY,Z,Q=N.originX;if(F.lockSkewingY)return!1;if(Y===0){var K=le(N,a,a,G,A);K.y>0?Z=i:Z=d}else Y>0&&(Z=Q===o?i:d),Y<0&&(Z=Q===o?d:i),V(F)&&(Z=Z===i?d:i);N.originY=Z;var H=oe("skewing",re(j));return H(U,N,G,A)}function M(U,N,G,A){var F=N,Y=F.target,Z=Y.translateToOriginPoint(Y.getCenterPoint(),F.originX,F.originY);if(Y.lockRotation)return!1;var Q=Math.atan2(F.ey-Z.y,F.ex-Z.x),K=Math.atan2(A-Z.y,G-Z.x),H=p(K-Q+F.theta),se=!0;if(Y.snapAngle>0){var ce=Y.snapAngle,fe=Y.snapThreshold||ce,Ce=Math.ceil(H/ce)*ce,ge=Math.floor(H/ce)*ce;Math.abs(H-ge)<fe?H=ge:Math.abs(H-Ce)<fe&&(H=Ce)}return H<0&&(H=360+H),H%=360,se=Y.angle!==H,Y.angle=H,se}function k(U,N,G,A,F){F=F||{};var Y=N.target,Z=Y.lockScalingX,Q=Y.lockScalingY,K=F.by,H,se,ce,fe,Ce=S(U,Y),ge=P(Y,K,Ce),Ue,Pe,en=N.gestureScale;if(ge)return!1;if(en)se=N.scaleX*en,ce=N.scaleY*en;else{if(H=le(N,N.originX,N.originY,G,A),Ue=K!=="y"?v(H.x):1,Pe=K!=="x"?v(H.y):1,N.signX||(N.signX=Ue),N.signY||(N.signY=Pe),Y.lockScalingFlip&&(N.signX!==Ue||N.signY!==Pe))return!1;if(fe=Y._getTransformedDimensions(),Ce&&!K){var Gn=Math.abs(H.x)+Math.abs(H.y),vt=N.original,ch=Math.abs(fe.x*vt.scaleX/Y.scaleX)+Math.abs(fe.y*vt.scaleY/Y.scaleY),_a=Gn/ch;se=vt.scaleX*_a,ce=vt.scaleY*_a}else se=Math.abs(H.x*Y.scaleX/fe.x),ce=Math.abs(H.y*Y.scaleY/fe.y);T(N)&&(se*=2,ce*=2),N.signX!==Ue&&K!=="y"&&(N.originX=g[N.originX],se*=-1,N.signX=Ue),N.signY!==Pe&&K!=="x"&&(N.originY=g[N.originY],ce*=-1,N.signY=Pe)}var uh=Y.scaleX,hh=Y.scaleY;return K?(K==="x"&&Y.set("scaleX",se),K==="y"&&Y.set("scaleY",ce)):(!Z&&Y.set("scaleX",se),!Q&&Y.set("scaleY",ce)),uh!==Y.scaleX||hh!==Y.scaleY}function L(U,N,G,A){return k(U,N,G,A)}function B(U,N,G,A){return k(U,N,G,A,{by:"x"})}function $(U,N,G,A){return k(U,N,G,A,{by:"y"})}function E(U,N,G,A){return U[N.target.canvas.altActionKey]?r.skewHandlerX(U,N,G,A):r.scalingY(U,N,G,A)}function I(U,N,G,A){return U[N.target.canvas.altActionKey]?r.skewHandlerY(U,N,G,A):r.scalingX(U,N,G,A)}function W(U,N,G,A){var F=N.target,Y=le(N,N.originX,N.originY,G,A),Z=F.strokeWidth/(F.strokeUniform?F.scaleX:1),Q=T(N)?2:1,K=F.width,H=Math.abs(Y.x*Q/F.scaleX)-Z;return F.set("width",Math.max(H,0)),K!==H}function q(U,N,G,A){var F=N.target,Y=G-N.offsetX,Z=A-N.offsetY,Q=!F.get("lockMovementX")&&F.left!==Y,K=!F.get("lockMovementY")&&F.top!==Z;return Q&&F.set("left",Y),K&&F.set("top",Z),(Q||K)&&C("moving",te(U,N,G,A)),Q||K}r.scaleCursorStyleHandler=R,r.skewCursorStyleHandler=z,r.scaleSkewCursorStyleHandler=J,r.rotationWithSnapping=oe("rotating",re(M)),r.scalingEqually=oe("scaling",re(L)),r.scalingX=oe("scaling",re(B)),r.scalingY=oe("scaling",re($)),r.scalingYOrSkewingX=E,r.scalingXOrSkewingY=I,r.changeWidth=oe("resizing",re(W)),r.skewHandlerX=D,r.skewHandlerY=X,r.dragHandler=q,r.scaleOrSkewActionName=ne,r.rotationStyleHandler=ie,r.fireEvent=C,r.wrapWithFixedAnchor=re,r.wrapWithFireEvent=oe,r.getLocalPoint=le,s.controlsUtils=r}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.degreesToRadians,h=s.controlsUtils;function r(i,l,d,a,g){a=a||{};var p=this.sizeX||a.cornerSize||g.cornerSize,v=this.sizeY||a.cornerSize||g.cornerSize,x=typeof a.transparentCorners<"u"?a.transparentCorners:g.transparentCorners,C=x?"stroke":"fill",S=!x&&(a.cornerStrokeColor||g.cornerStrokeColor),T=l,P=d,R;i.save(),i.fillStyle=a.cornerColor||g.cornerColor,i.strokeStyle=a.cornerStrokeColor||g.cornerStrokeColor,p>v?(R=p,i.scale(1,v/p),P=d*p/v):v>p?(R=v,i.scale(p/v,1),T=l*v/p):R=p,i.lineWidth=1,i.beginPath(),i.arc(T,P,R/2,0,2*Math.PI,!1),i[C](),S&&i.stroke(),i.restore()}function o(i,l,d,a,g){a=a||{};var p=this.sizeX||a.cornerSize||g.cornerSize,v=this.sizeY||a.cornerSize||g.cornerSize,x=typeof a.transparentCorners<"u"?a.transparentCorners:g.transparentCorners,C=x?"stroke":"fill",S=!x&&(a.cornerStrokeColor||g.cornerStrokeColor),T=p/2,P=v/2;i.save(),i.fillStyle=a.cornerColor||g.cornerColor,i.strokeStyle=a.cornerStrokeColor||g.cornerStrokeColor,i.lineWidth=1,i.translate(l,d),i.rotate(u(g.angle)),i[C+"Rect"](-T,-P,p,v),S&&i.strokeRect(-T,-P,p,v),i.restore()}h.renderCircleControl=r,h.renderSquareControl=o}(t),function(f){var s=f.fabric||(f.fabric={});function u(h){for(var r in h)this[r]=h[r]}s.Control=u,s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(h,r){return r.cursorStyle},getActionName:function(h,r){return r.actionName},getVisibility:function(h,r){var o=h._controlsVisibility;return o&&typeof o[r]<"u"?o[r]:this.visible},setVisibility:function(h){this.visible=h},positionHandler:function(h,r){var o=s.util.transformPoint({x:this.x*h.x+this.offsetX,y:this.y*h.y+this.offsetY},r);return o},calcCornerCoords:function(h,r,o,i,l){var d,a,g,p,v=l?this.touchSizeX:this.sizeX,x=l?this.touchSizeY:this.sizeY;if(v&&x&&v!==x){var C=Math.atan2(x,v),S=Math.sqrt(v*v+x*x)/2,T=C-s.util.degreesToRadians(h),P=Math.PI/2-C-s.util.degreesToRadians(h);d=S*s.util.cos(T),a=S*s.util.sin(T),g=S*s.util.cos(P),p=S*s.util.sin(P)}else{var R=v&&x?v:r;S=R*.7071067812;var T=s.util.degreesToRadians(45-h);d=g=S*s.util.cos(T),a=p=S*s.util.sin(T)}return{tl:{x:o-p,y:i-g},tr:{x:o+d,y:i-a},bl:{x:o-d,y:i+a},br:{x:o+p,y:i+g}}},render:function(h,r,o,i,l){switch(i=i||{},i.cornerStyle||l.cornerStyle){case"circle":s.controlsUtils.renderCircleControl.call(this,h,r,o,i,l);break;default:s.controlsUtils.renderSquareControl.call(this,h,r,o,i,l)}}}}(t),function(){function f(o,i){var l=o.getAttribute("style"),d=o.getAttribute("offset")||0,a,g,p,v;if(d=parseFloat(d)/(/%$/.test(d)?100:1),d=d<0?0:d>1?1:d,l){var x=l.split(/\s*;\s*/);for(x[x.length-1]===""&&x.pop(),v=x.length;v--;){var C=x[v].split(/\s*:\s*/),S=C[0].trim(),T=C[1].trim();S==="stop-color"?a=T:S==="stop-opacity"&&(p=T)}}return a||(a=o.getAttribute("stop-color")||"rgb(0,0,0)"),p||(p=o.getAttribute("stop-opacity")),a=new e.Color(a),g=a.getAlpha(),p=isNaN(parseFloat(p))?1:parseFloat(p),p*=g*i,{offset:d,color:a.toRgb(),opacity:p}}function s(o){return{x1:o.getAttribute("x1")||0,y1:o.getAttribute("y1")||0,x2:o.getAttribute("x2")||"100%",y2:o.getAttribute("y2")||0}}function u(o){return{x1:o.getAttribute("fx")||o.getAttribute("cx")||"50%",y1:o.getAttribute("fy")||o.getAttribute("cy")||"50%",r1:0,x2:o.getAttribute("cx")||"50%",y2:o.getAttribute("cy")||"50%",r2:o.getAttribute("r")||"50%"}}var h=e.util.object.clone;e.Gradient=e.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(o){o||(o={}),o.coords||(o.coords={});var i,l=this;Object.keys(o).forEach(function(d){l[d]=o[d]}),this.id?this.id+="_"+e.Object.__uid++:this.id=e.Object.__uid++,i={x1:o.coords.x1||0,y1:o.coords.y1||0,x2:o.coords.x2||0,y2:o.coords.y2||0},this.type==="radial"&&(i.r1=o.coords.r1||0,i.r2=o.coords.r2||0),this.coords=i,this.colorStops=o.colorStops.slice()},addColorStop:function(o){for(var i in o){var l=new e.Color(o[i]);this.colorStops.push({offset:parseFloat(i),color:l.toRgb(),opacity:l.getAlpha()})}return this},toObject:function(o){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return e.util.populateWithProperties(this,i,o),i},toSVG:function(o,g){var l=h(this.coords,!0),d,a,g=g||{},p,v,x=h(this.colorStops,!0),C=l.r1>l.r2,S=this.gradientTransform?this.gradientTransform.concat():e.iMatrix.concat(),T=-this.offsetX,P=-this.offsetY,R=!!g.additionalTransform,z=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(x.sort(function(re,oe){return re.offset-oe.offset}),z==="objectBoundingBox"?(T/=o.width,P/=o.height):(T+=o.width/2,P+=o.height/2),o.type==="path"&&this.gradientUnits!=="percentage"&&(T-=o.pathOffset.x,P-=o.pathOffset.y),S[4]-=T,S[5]-=P,v='id="SVGID_'+this.id+'" gradientUnits="'+z+'"',v+=' gradientTransform="'+(R?g.additionalTransform+" ":"")+e.util.matrixToSVG(S)+'" ',this.type==="linear"?p=["<linearGradient ",v,' x1="',l.x1,'" y1="',l.y1,'" x2="',l.x2,'" y2="',l.y2,`">
`]:this.type==="radial"&&(p=["<radialGradient ",v,' cx="',C?l.x1:l.x2,'" cy="',C?l.y1:l.y2,'" r="',C?l.r1:l.r2,'" fx="',C?l.x2:l.x1,'" fy="',C?l.y2:l.y1,`">
`]),this.type==="radial"){if(C)for(x=x.concat(),x.reverse(),d=0,a=x.length;d<a;d++)x[d].offset=1-x[d].offset;var J=Math.min(l.r1,l.r2);if(J>0){var ne=Math.max(l.r1,l.r2),ie=J/ne;for(d=0,a=x.length;d<a;d++)x[d].offset+=ie*(1-x[d].offset)}}for(d=0,a=x.length;d<a;d++){var te=x[d];p.push("<stop ",'offset="',te.offset*100+"%",'" style="stop-color:',te.color,typeof te.opacity<"u"?";stop-opacity: "+te.opacity:";",`"/>
`)}return p.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),p.join("")},toLive:function(o){var i,l=e.util.object.clone(this.coords),d,a;if(this.type){for(this.type==="linear"?i=o.createLinearGradient(l.x1,l.y1,l.x2,l.y2):this.type==="radial"&&(i=o.createRadialGradient(l.x1,l.y1,l.r1,l.x2,l.y2,l.r2)),d=0,a=this.colorStops.length;d<a;d++){var g=this.colorStops[d].color,p=this.colorStops[d].opacity,v=this.colorStops[d].offset;typeof p<"u"&&(g=new e.Color(g).setAlpha(p).toRgba()),i.addColorStop(v,g)}return i}}}),e.util.object.extend(e.Gradient,{fromElement:function(o,i,l,d){var a=parseFloat(l)/(/%$/.test(l)?100:1);a=a<0?0:a>1?1:a,isNaN(a)&&(a=1);var g=o.getElementsByTagName("stop"),p,v=o.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",x=o.getAttribute("gradientTransform")||"",C=[],S,T,P=0,R=0,z;for(o.nodeName==="linearGradient"||o.nodeName==="LINEARGRADIENT"?(p="linear",S=s(o)):(p="radial",S=u(o)),T=g.length;T--;)C.push(f(g[T],a));z=e.parseTransformAttribute(x),r(i,S,d,v),v==="pixels"&&(P=-i.left,R=-i.top);var J=new e.Gradient({id:o.getAttribute("id"),type:p,coords:S,colorStops:C,gradientUnits:v,gradientTransform:z,offsetX:P,offsetY:R});return J}});function r(o,i,l,d){var a,g;Object.keys(i).forEach(function(p){a=i[p],a==="Infinity"?g=1:a==="-Infinity"?g=0:(g=parseFloat(i[p],10),typeof a=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(a)&&(g*=.01,d==="pixels"&&((p==="x1"||p==="x2"||p==="r2")&&(g*=l.viewBoxWidth||l.width),(p==="y1"||p==="y2")&&(g*=l.viewBoxHeight||l.height)))),i[p]=g})}}(),function(){var f=e.util.toFixed;e.Pattern=e.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,u){if(s||(s={}),this.id=e.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string"){u&&u(this);return}else{var h=this;this.source=e.util.createImage(),e.util.loadImage(s.source,function(r,o){h.source=r,u&&u(h,o)},null,this.crossOrigin)}},toObject:function(s){var u=e.Object.NUM_FRACTION_DIGITS,h,r;return typeof this.source.src=="string"?h=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(h=this.source.toDataURL()),r={type:"pattern",source:h,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:f(this.offsetX,u),offsetY:f(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},e.util.populateWithProperties(this,r,s),r},toSVG:function(s){var u=typeof this.source=="function"?this.source():this.source,h=u.width/s.width,r=u.height/s.height,o=this.offsetX/s.width,i=this.offsetY/s.height,l="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,i&&(r+=Math.abs(i))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(h=1,o&&(h+=Math.abs(o))),u.src?l=u.src:u.toDataURL&&(l=u.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+o+'" y="'+i+'" width="'+h+'" height="'+r+`">
<image x="0" y="0" width="`+u.width+'" height="'+u.height+'" xlink:href="'+l+`"></image>
</pattern>
`},setOptions:function(s){for(var u in s)this[u]=s[u]},toLive:function(s){var u=this.source;return!u||typeof u.src<"u"&&(!u.complete||u.naturalWidth===0||u.naturalHeight===0)?"":s.createPattern(u,this.repeat)}})}(),function(f){var s=f.fabric||(f.fabric={}),u=s.util.toFixed;if(s.Shadow){s.warn("fabric.Shadow is already defined.");return}s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(h){typeof h=="string"&&(h=this._parseShadow(h));for(var r in h)this[r]=h[r];this.id=s.Object.__uid++},_parseShadow:function(h){var r=h.trim(),o=s.Shadow.reOffsetsAndBlur.exec(r)||[],i=r.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseFloat(o[1],10)||0,offsetY:parseFloat(o[2],10)||0,blur:parseFloat(o[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(h){var r=40,o=40,i=s.Object.NUM_FRACTION_DIGITS,l=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-h.angle)),d=20,a=new s.Color(this.color);return h.width&&h.height&&(r=u((Math.abs(l.x)+this.blur)/h.width,i)*100+d,o=u((Math.abs(l.y)+this.blur)/h.height,i)*100+d),h.flipX&&(l.x*=-1),h.flipY&&(l.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+o+'%" height="'+(100+2*o)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+u(this.blur?this.blur/2:0,i)+`"></feGaussianBlur>
	<feOffset dx="`+u(l.x,i)+'" dy="'+u(l.y,i)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+a.toRgb()+'" flood-opacity="'+a.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var h={},r=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(o){this[o]!==r[o]&&(h[o]=this[o])},this),h}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(t),function(){if(e.StaticCanvas){e.warn("fabric.StaticCanvas is already defined.");return}var f=e.util.object.extend,s=e.util.getElementOffset,u=e.util.removeFromArray,h=e.util.toFixed,r=e.util.transformPoint,o=e.util.invertTransform,i=e.util.getNodeCanvas,l=e.util.createCanvasElement,d=new Error("Could not initialize `canvas` element");e.StaticCanvas=e.util.createClass(e.CommonMethods,{initialize:function(a,g){g||(g={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,g)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:e.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(a,g){var p=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(a),this._initOptions(g),this.interactive||this._initRetinaScaling(),g.overlayImage&&this.setOverlayImage(g.overlayImage,p),g.backgroundImage&&this.setBackgroundImage(g.backgroundImage,p),g.backgroundColor&&this.setBackgroundColor(g.backgroundColor,p),g.overlayColor&&this.setOverlayColor(g.overlayColor,p),this.calcOffset()},_isRetinaScaling:function(){return e.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,e.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var a=e.devicePixelRatio;this.__initRetinaScaling(a,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(a,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(a,g,p){g.setAttribute("width",this.width*a),g.setAttribute("height",this.height*a),p.scale(a,a)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(a,g,p){return this.__setBgOverlayImage("overlayImage",a,g,p)},setBackgroundImage:function(a,g,p){return this.__setBgOverlayImage("backgroundImage",a,g,p)},setOverlayColor:function(a,g){return this.__setBgOverlayColor("overlayColor",a,g)},setBackgroundColor:function(a,g){return this.__setBgOverlayColor("backgroundColor",a,g)},__setBgOverlayImage:function(a,g,p,v){return typeof g=="string"?e.util.loadImage(g,function(x,C){if(x){var S=new e.Image(x,v);this[a]=S,S.canvas=this}p&&p(x,C)},this,v&&v.crossOrigin):(v&&g.setOptions(v),this[a]=g,g&&(g.canvas=this),p&&p(g,!1)),this},__setBgOverlayColor:function(a,g,p){return this[a]=g,this._initGradient(g,a),this._initPattern(g,a,p),this},_createCanvasElement:function(){var a=l();if(!a||(a.style||(a.style={}),typeof a.getContext>"u"))throw d;return a},_initOptions:function(a){var g=this.lowerCanvasEl;this._setOptions(a),this.width=this.width||parseInt(g.width,10)||0,this.height=this.height||parseInt(g.height,10)||0,this.lowerCanvasEl.style&&(g.width=this.width,g.height=this.height,g.style.width=this.width+"px",g.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(a){a&&a.getContext?this.lowerCanvasEl=a:this.lowerCanvasEl=e.util.getById(a)||this._createCanvasElement(),e.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(a,g){return this.setDimensions({width:a},g)},setHeight:function(a,g){return this.setDimensions({height:a},g)},setDimensions:function(a,g){var p;g=g||{};for(var v in a)p=a[v],g.cssOnly||(this._setBackstoreDimension(v,a[v]),p+="px",this.hasLostContext=!0),g.backstoreOnly||this._setCssDimension(v,p);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),g.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(a,g){return this.lowerCanvasEl[a]=g,this.upperCanvasEl&&(this.upperCanvasEl[a]=g),this.cacheCanvasEl&&(this.cacheCanvasEl[a]=g),this[a]=g,this},_setCssDimension:function(a,g){return this.lowerCanvasEl.style[a]=g,this.upperCanvasEl&&(this.upperCanvasEl.style[a]=g),this.wrapperEl&&(this.wrapperEl.style[a]=g),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(a){var g=this._activeObject,p=this.backgroundImage,v=this.overlayImage,x,C,S;for(this.viewportTransform=a,C=0,S=this._objects.length;C<S;C++)x=this._objects[C],x.group||x.setCoords(!0);return g&&g.setCoords(),p&&p.setCoords(!0),v&&v.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(a,g){var p=a,v=this.viewportTransform.slice(0);a=r(a,o(this.viewportTransform)),v[0]=g,v[3]=g;var x=r(a,v);return v[4]+=p.x-x.x,v[5]+=p.y-x.y,this.setViewportTransform(v)},setZoom:function(a){return this.zoomToPoint(new e.Point(0,0),a),this},absolutePan:function(a){var g=this.viewportTransform.slice(0);return g[4]=-a.x,g[5]=-a.y,this.setViewportTransform(g)},relativePan:function(a){return this.absolutePan(new e.Point(-a.x-this.viewportTransform[4],-a.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(a){this.stateful&&a.setupState(),a._set("canvas",this),a.setCoords(),this.fire("object:added",{target:a}),a.fire("added")},_onObjectRemoved:function(a){this.fire("object:removed",{target:a}),a.fire("removed"),delete a.canvas},clearContext:function(a){return a.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var a=this.contextContainer;return this.renderCanvas(a,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=e.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var a={},g=this.width,p=this.height,v=o(this.viewportTransform);return a.tl=r({x:0,y:0},v),a.br=r({x:g,y:p},v),a.tr=new e.Point(a.br.x,a.tl.y),a.bl=new e.Point(a.tl.x,a.br.y),this.vptCoords=a,a},cancelRequestedRender:function(){this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(a,g){var p=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(a),e.util.setImageSmoothing(a,this.imageSmoothingEnabled),this.fire("before:render",{ctx:a}),this._renderBackground(a),a.save(),a.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._renderObjects(a,g),a.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(a)),this._renderOverlay(a),this.controlsAboveOverlay&&this.interactive&&this.drawControls(a),this.fire("after:render",{ctx:a})},drawClipPathOnCanvas:function(a){var g=this.viewportTransform,p=this.clipPath;a.save(),a.transform(g[0],g[1],g[2],g[3],g[4],g[5]),a.globalCompositeOperation="destination-in",p.transform(a),a.scale(1/p.zoomX,1/p.zoomY),a.drawImage(p._cacheCanvas,-p.cacheTranslationX,-p.cacheTranslationY),a.restore()},_renderObjects:function(a,g){var p,v;for(p=0,v=g.length;p<v;++p)g[p]&&g[p].render(a)},_renderBackgroundOrOverlay:function(a,g){var p=this[g+"Color"],v=this[g+"Image"],x=this.viewportTransform,C=this[g+"Vpt"];if(!(!p&&!v)){if(p){a.save(),a.beginPath(),a.moveTo(0,0),a.lineTo(this.width,0),a.lineTo(this.width,this.height),a.lineTo(0,this.height),a.closePath(),a.fillStyle=p.toLive?p.toLive(a,this):p,C&&a.transform(x[0],x[1],x[2],x[3],x[4],x[5]),a.transform(1,0,0,1,p.offsetX||0,p.offsetY||0);var S=p.gradientTransform||p.patternTransform;S&&a.transform(S[0],S[1],S[2],S[3],S[4],S[5]),a.fill(),a.restore()}if(v){a.save();var T=this.skipOffscreen;this.skipOffscreen=C,C&&a.transform(x[0],x[1],x[2],x[3],x[4],x[5]),v.render(a),this.skipOffscreen=T,a.restore()}}},_renderBackground:function(a){this._renderBackgroundOrOverlay(a,"background")},_renderOverlay:function(a){this._renderBackgroundOrOverlay(a,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new e.Point(this.width/2,this.height/2)},centerObjectH:function(a){return this._centerObject(a,new e.Point(this.getCenterPoint().x,a.getCenterPoint().y))},centerObjectV:function(a){return this._centerObject(a,new e.Point(a.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(a){var g=this.getCenterPoint();return this._centerObject(a,g)},viewportCenterObject:function(a){var g=this.getVpCenter();return this._centerObject(a,g)},viewportCenterObjectH:function(a){var g=this.getVpCenter();return this._centerObject(a,new e.Point(g.x,a.getCenterPoint().y)),this},viewportCenterObjectV:function(a){var g=this.getVpCenter();return this._centerObject(a,new e.Point(a.getCenterPoint().x,g.y))},getVpCenter:function(){var a=this.getCenterPoint(),g=o(this.viewportTransform);return r(a,g)},_centerObject:function(a,g){return a.setPositionByOrigin(g,"center","center"),a.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(a){return this.toDatalessObject(a)},toObject:function(a){return this._toObjectMethod("toObject",a)},toDatalessObject:function(a){return this._toObjectMethod("toDatalessObject",a)},_toObjectMethod:function(a,g){var p=this.clipPath,v={version:e.version,objects:this._toObjects(a,g)};return p&&!p.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,a,g)),f(v,this.__serializeBgOverlay(a,g)),e.util.populateWithProperties(this,v,g),v},_toObjects:function(a,g){return this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){return this._toObject(p,a,g)},this)},_toObject:function(a,g,p){var v;this.includeDefaultValues||(v=a.includeDefaultValues,a.includeDefaultValues=!1);var x=a[g](p);return this.includeDefaultValues||(a.includeDefaultValues=v),x},__serializeBgOverlay:function(a,g){var p={},v=this.backgroundImage,x=this.overlayImage,C=this.backgroundColor,S=this.overlayColor;return C&&C.toObject?C.excludeFromExport||(p.background=C.toObject(g)):C&&(p.background=C),S&&S.toObject?S.excludeFromExport||(p.overlay=S.toObject(g)):S&&(p.overlay=S),v&&!v.excludeFromExport&&(p.backgroundImage=this._toObject(v,a,g)),x&&!x.excludeFromExport&&(p.overlayImage=this._toObject(x,a,g)),p},svgViewportTransformation:!0,toSVG:function(a,g){a||(a={}),a.reviver=g;var p=[];return this._setSVGPreamble(p,a),this._setSVGHeader(p,a),this.clipPath&&p.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(p,"background"),this._setSVGBgOverlayImage(p,"backgroundImage",g),this._setSVGObjects(p,g),this.clipPath&&p.push(`</g>
`),this._setSVGBgOverlayColor(p,"overlay"),this._setSVGBgOverlayImage(p,"overlayImage",g),p.push("</svg>"),p.join("")},_setSVGPreamble:function(a,g){g.suppressPreamble||a.push('<?xml version="1.0" encoding="',g.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(a,g){var p=g.width||this.width,v=g.height||this.height,x,C='viewBox="0 0 '+this.width+" "+this.height+'" ',S=e.Object.NUM_FRACTION_DIGITS;g.viewBox?C='viewBox="'+g.viewBox.x+" "+g.viewBox.y+" "+g.viewBox.width+" "+g.viewBox.height+'" ':this.svgViewportTransformation&&(x=this.viewportTransform,C='viewBox="'+h(-x[4]/x[0],S)+" "+h(-x[5]/x[3],S)+" "+h(this.width/x[0],S)+" "+h(this.height/x[3],S)+'" '),a.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',p,'" ','height="',v,'" ',C,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",e.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(g),`</defs>
`)},createSVGClipPathMarkup:function(a){var g=this.clipPath;return g?(g.clipPathId="CLIPPATH_"+e.Object.__uid++,'<clipPath id="'+g.clipPathId+`" >
`+this.clipPath.toClipPathSVG(a.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var a=this,g=["background","overlay"].map(function(p){var v=a[p+"Color"];if(v&&v.toLive){var x=a[p+"Vpt"],C=a.viewportTransform,S={width:a.width/(x?C[0]:1),height:a.height/(x?C[3]:1)};return v.toSVG(S,{additionalTransform:x?e.util.matrixToSVG(C):""})}});return g.join("")},createSVGFontFacesMarkup:function(){var a="",g={},p,v,x,C,S,T,P,R,z,J=e.fontPaths,ne=[];for(this._objects.forEach(function te(re){ne.push(re),re._objects&&re._objects.forEach(te)}),R=0,z=ne.length;R<z;R++)if(p=ne[R],v=p.fontFamily,!(p.type.indexOf("text")===-1||g[v]||!J[v])&&(g[v]=!0,!!p.styles)){x=p.styles;for(S in x){C=x[S];for(P in C)T=C[P],v=T.fontFamily,!g[v]&&J[v]&&(g[v]=!0)}}for(var ie in g)a+=[`		@font-face {
`,"			font-family: '",ie,`';
`,"			src: url('",J[ie],`');
`,`		}
`].join("");return a&&(a=['	<style type="text/css">',`<![CDATA[
`,a,"]]>",`</style>
`].join("")),a},_setSVGObjects:function(a,g){var p,v,x,C=this._objects;for(v=0,x=C.length;v<x;v++)p=C[v],!p.excludeFromExport&&this._setSVGObject(a,p,g)},_setSVGObject:function(a,g,p){a.push(g.toSVG(p))},_setSVGBgOverlayImage:function(a,g,p){this[g]&&!this[g].excludeFromExport&&this[g].toSVG&&a.push(this[g].toSVG(p))},_setSVGBgOverlayColor:function(a,g){var p=this[g+"Color"],v=this.viewportTransform,x=this.width,C=this.height;if(p)if(p.toLive){var S=p.repeat,T=e.util.invertTransform(v),P=this[g+"Vpt"],R=P?e.util.matrixToSVG(T):"";a.push('<rect transform="'+R+" translate(",x/2,",",C/2,')"',' x="',p.offsetX-x/2,'" y="',p.offsetY-C/2,'" ','width="',S==="repeat-y"||S==="no-repeat"?p.source.width:x,'" height="',S==="repeat-x"||S==="no-repeat"?p.source.height:C,'" fill="url(#SVGID_'+p.id+')"',`></rect>
`)}else a.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',p,'"',`></rect>
`)},sendToBack:function(a){if(!a)return this;var g=this._activeObject,p,v,x;if(a===g&&a.type==="activeSelection")for(x=g._objects,p=x.length;p--;)v=x[p],u(this._objects,v),this._objects.unshift(v);else u(this._objects,a),this._objects.unshift(a);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(a){if(!a)return this;var g=this._activeObject,p,v,x;if(a===g&&a.type==="activeSelection")for(x=g._objects,p=0;p<x.length;p++)v=x[p],u(this._objects,v),this._objects.push(v);else u(this._objects,a),this._objects.push(a);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(a,g){if(!a)return this;var p=this._activeObject,v,x,C,S,T,P=0;if(a===p&&a.type==="activeSelection")for(T=p._objects,v=0;v<T.length;v++)x=T[v],C=this._objects.indexOf(x),C>0+P&&(S=C-1,u(this._objects,x),this._objects.splice(S,0,x)),P++;else C=this._objects.indexOf(a),C!==0&&(S=this._findNewLowerIndex(a,C,g),u(this._objects,a),this._objects.splice(S,0,a));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(a,g,p){var v,x;if(p)for(v=g,x=g-1;x>=0;--x){var C=a.intersectsWithObject(this._objects[x])||a.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(a);if(C){v=x;break}}else v=g-1;return v},bringForward:function(a,g){if(!a)return this;var p=this._activeObject,v,x,C,S,T,P=0;if(a===p&&a.type==="activeSelection")for(T=p._objects,v=T.length;v--;)x=T[v],C=this._objects.indexOf(x),C<this._objects.length-1-P&&(S=C+1,u(this._objects,x),this._objects.splice(S,0,x)),P++;else C=this._objects.indexOf(a),C!==this._objects.length-1&&(S=this._findNewUpperIndex(a,C,g),u(this._objects,a),this._objects.splice(S,0,a));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(a,g,p){var v,x,C;if(p)for(v=g,x=g+1,C=this._objects.length;x<C;++x){var S=a.intersectsWithObject(this._objects[x])||a.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(a);if(S){v=x;break}}else v=g+1;return v},moveTo:function(a,g){return u(this._objects,a),this._objects.splice(g,0,a),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(a){a.dispose&&a.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),e.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),e.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),f(e.StaticCanvas.prototype,e.Observable),f(e.StaticCanvas.prototype,e.Collection),f(e.StaticCanvas.prototype,e.DataURLExporter),f(e.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(a){var g=l();if(!g||!g.getContext)return null;var p=g.getContext("2d");if(!p)return null;switch(a){case"setLineDash":return typeof p.setLineDash<"u";default:return null}}}),e.StaticCanvas.prototype.toJSON=e.StaticCanvas.prototype.toObject,e.isLikelyNode&&(e.StaticCanvas.prototype.createPNGStream=function(){var a=i(this.lowerCanvasEl);return a&&a.createPNGStream()},e.StaticCanvas.prototype.createJPEGStream=function(a){var g=i(this.lowerCanvasEl);return g&&g.createJPEGStream(a)})}(),e.BaseBrush=e.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(f){f.strokeStyle=this.color,f.lineWidth=this.width,f.lineCap=this.strokeLineCap,f.miterLimit=this.strokeMiterLimit,f.lineJoin=this.strokeLineJoin,f.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(f){var s=this.canvas.viewportTransform;f.save(),f.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var f=this.canvas,s=this.shadow,u=f.contextTop,h=f.getZoom();f&&f._isRetinaScaling()&&(h*=e.devicePixelRatio),u.shadowColor=s.color,u.shadowBlur=s.blur*h,u.shadowOffsetX=s.offsetX*h,u.shadowOffsetY=s.offsetY*h}},needsFullRender:function(){var f=new e.Color(this.color);return f.getAlpha()<1||!!this.shadow},_resetShadow:function(){var f=this.canvas.contextTop;f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0},_isOutSideCanvas:function(f){return f.x<0||f.x>this.canvas.getWidth()||f.y<0||f.y>this.canvas.getHeight()}}),function(){e.PencilBrush=e.util.createClass(e.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(f){this.canvas=f,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(f,s,u){var h=s.midPointFrom(u);return f.quadraticCurveTo(s.x,s.y,h.x,h.y),h},onMouseDown:function(f,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(f),this._captureDrawingPath(f),this._render())},onMouseMove:function(f,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(f))&&this._captureDrawingPath(f)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var u=this._points,h=u.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,u[h-2],u[h-1],!0),r.stroke(),r.restore()}},onMouseUp:function(f){return this.canvas._isMainEvent(f.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(f){var s=new e.Point(f.x,f.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(f){return this._points.length>1&&f.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(f),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(f){var s=new e.Point(f.x,f.y);return this._addPoint(s)},_render:function(f){var s,u,h=this._points[0],r=this._points[1];if(f=f||this.canvas.contextTop,this._saveAndTransform(f),f.beginPath(),this._points.length===2&&h.x===r.x&&h.y===r.y){var o=this.width/1e3;h=new e.Point(h.x,h.y),r=new e.Point(r.x,r.y),h.x-=o,r.x+=o}for(f.moveTo(h.x,h.y),s=1,u=this._points.length;s<u;s++)this._drawSegment(f,h,r),h=this._points[s],r=this._points[s+1];f.lineTo(h.x,h.y),f.stroke(),f.restore()},convertPointsToSVGPath:function(f){var s=this.width/1e3;return e.util.getSmoothPathFromPoints(f,s)},_isEmptySVGPath:function(f){var s=e.util.joinPath(f);return s==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(f){var s=new e.Path(f,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new e.Shadow(this.shadow)),s},decimatePoints:function(f,s){if(f.length<=2)return f;var u=this.canvas.getZoom(),h=Math.pow(s/u,2),r,o=f.length-1,i=f[0],l=[i],d;for(r=1;r<o-1;r++)d=Math.pow(i.x-f[r].x,2)+Math.pow(i.y-f[r].y,2),d>=h&&(i=f[r],l.push(i));return l.push(f[o]),l},_finalizeAndAddPath:function(){var f=this.canvas.contextTop;f.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s)){this.canvas.requestRenderAll();return}var u=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.requestRenderAll(),u.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:u})}})}(),e.CircleBrush=e.util.createClass(e.BaseBrush,{width:10,initialize:function(f){this.canvas=f,this.points=[]},drawDot:function(f){var s=this.addPoint(f),u=this.canvas.contextTop;this._saveAndTransform(u),this.dot(u,s),u.restore()},dot:function(f,s){f.fillStyle=s.fill,f.beginPath(),f.arc(s.x,s.y,s.radius,0,Math.PI*2,!1),f.closePath(),f.fill()},onMouseDown:function(f){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(f)},_render:function(){var f=this.canvas.contextTop,s,u,h=this.points;for(this._saveAndTransform(f),s=0,u=h.length;s<u;s++)this.dot(f,h[s]);f.restore()},onMouseMove:function(f){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(f)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(f),this._render()):this.drawDot(f))},onMouseUp:function(){var f=this.canvas.renderOnAddRemove,s,u;this.canvas.renderOnAddRemove=!1;var h=[];for(s=0,u=this.points.length;s<u;s++){var r=this.points[s],o=new e.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(o.shadow=new e.Shadow(this.shadow)),h.push(o)}var i=new e.Group(h);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=f,this.canvas.requestRenderAll()},addPoint:function(f){var s=new e.Point(f.x,f.y),u=e.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,h=new e.Color(this.color).setAlpha(e.util.getRandomInt(0,100)/100).toRgba();return s.radius=u,s.fill=h,this.points.push(s),s}}),e.SprayBrush=e.util.createClass(e.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(f){this.canvas=f,this.sprayChunks=[]},onMouseDown:function(f){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(f),this.render(this.sprayChunkPoints)},onMouseMove:function(f){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(f)||(this.addSprayChunk(f),this.render(this.sprayChunkPoints))},onMouseUp:function(){var f=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],u=0,h=this.sprayChunks.length;u<h;u++)for(var r=this.sprayChunks[u],o=0,i=r.length;o<i;o++){var l=new e.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});s.push(l)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var d=new e.Group(s);this.shadow&&d.set("shadow",new e.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=f,this.canvas.requestRenderAll()},_getOptimizedRects:function(f){var s={},u,h,r;for(h=0,r=f.length;h<r;h++)u=f[h].left+""+f[h].top,s[u]||(s[u]=f[h]);var o=[];for(u in s)o.push(s[u]);return o},render:function(f){var s=this.canvas.contextTop,u,h;for(s.fillStyle=this.color,this._saveAndTransform(s),u=0,h=f.length;u<h;u++){var r=f[u];typeof r.opacity<"u"&&(s.globalAlpha=r.opacity),s.fillRect(r.x,r.y,r.width,r.width)}s.restore()},_render:function(){var f=this.canvas.contextTop,s,u;for(f.fillStyle=this.color,this._saveAndTransform(f),s=0,u=this.sprayChunks.length;s<u;s++)this.render(this.sprayChunks[s]);f.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var s,u,h,r=this.width/2,o;for(o=0;o<this.density;o++){s=e.util.getRandomInt(f.x-r,f.x+r),u=e.util.getRandomInt(f.y-r,f.y+r),this.dotWidthVariance?h=e.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):h=this.dotWidth;var i=new e.Point(s,u);i.width=h,this.randomOpacity&&(i.opacity=e.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),e.PatternBrush=e.util.createClass(e.PencilBrush,{getPatternSrc:function(){var f=20,s=5,u=e.util.createCanvasElement(),h=u.getContext("2d");return u.width=u.height=f+s,h.fillStyle=this.color,h.beginPath(),h.arc(f/2,f/2,f/2,0,Math.PI*2,!1),h.closePath(),h.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(f){return f.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(f){this.callSuper("_setBrushStyles",f),f.strokeStyle=this.getPattern(f)},createPath:function(f){var s=this.callSuper("createPath",f),u=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new e.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-u.x,offsetY:-u.y}),s}}),function(){var f=e.util.getPointer,s=e.util.degreesToRadians,u=e.util.isTouchEvent;e.Canvas=e.util.createClass(e.StaticCanvas,{initialize:function(r,o){o||(o={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,o),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=e.PencilBrush&&new e.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),o,i,l;if(r.length>0&&!this.preserveObjectStacking){i=[],l=[];for(var d=0,a=this._objects.length;d<a;d++)o=this._objects[d],r.indexOf(o)===-1?i.push(o):l.push(o);r.length>1&&(this._activeObject._objects=l),i.push.apply(i,l)}else i=this._objects;return i},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,o){var i=r.calcTransformMatrix(),l=e.util.invertTransform(i),d=this.restorePointerVpt(o);return e.util.transformPoint(d,l)},isTargetTransparent:function(r,o,i){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var l=this._normalizePointer(r,{x:o,y:i}),d=Math.max(r.cacheTranslationX+l.x*r.zoomX,0),a=Math.max(r.cacheTranslationY+l.y*r.zoomY,0),x=e.util.isTransparent(r._cacheContext,Math.round(d),Math.round(a),this.targetFindTolerance);return x}var g=this.contextCache,p=r.selectionBackgroundColor,v=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(g),g.save(),g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),r.render(g),g.restore(),r.selectionBackgroundColor=p;var x=e.util.isTransparent(g,o,i,this.targetFindTolerance);return x},_isSelectionKeyPressed:function(r){var o=!1;return Array.isArray(this.selectionKey)?o=!!this.selectionKey.find(function(i){return r[i]===!0}):o=r[this.selectionKey],o},_shouldClearSelection:function(r,o){var i=this.getActiveObjects(),l=this._activeObject;return!o||o&&l&&i.length>1&&i.indexOf(o)===-1&&l!==o&&!this._isSelectionKeyPressed(r)||o&&!o.evented||o&&!o.selectable&&l&&l!==o},_shouldCenterTransform:function(r,o,i){if(r){var l;return o==="scale"||o==="scaleX"||o==="scaleY"||o==="resizing"?l=this.centeredScaling||r.centeredScaling:o==="rotate"&&(l=this.centeredRotation||r.centeredRotation),l?!i:i}},_getOriginFromCorner:function(r,o){var i={x:r.originX,y:r.originY};return o==="ml"||o==="tl"||o==="bl"?i.x="right":(o==="mr"||o==="tr"||o==="br")&&(i.x="left"),o==="tl"||o==="mt"||o==="tr"?i.y="bottom":(o==="bl"||o==="mb"||o==="br")&&(i.y="top"),i},_getActionFromCorner:function(r,o,i,l){if(!o||!r)return"drag";var d=l.controls[o];return d.getActionName(i,d,l)},_setupCurrentTransform:function(r,o,i){if(o){var l=this.getPointer(r),d=o.__corner,a=o.controls[d],g=i&&d?a.getActionHandler(r,o,a):e.controlsUtils.dragHandler,p=this._getActionFromCorner(i,d,r,o),v=this._getOriginFromCorner(o,d),x=r[this.centeredKey],C={target:o,action:p,actionHandler:g,corner:d,scaleX:o.scaleX,scaleY:o.scaleY,skewX:o.skewX,skewY:o.skewY,offsetX:l.x-o.left,offsetY:l.y-o.top,originX:v.x,originY:v.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,theta:s(o.angle),width:o.width*o.scaleX,shiftKey:r.shiftKey,altKey:x,original:e.util.saveObjectTransform(o)};this._shouldCenterTransform(o,p,x)&&(C.originX="center",C.originY="center"),C.original.originX=v.x,C.original.originY=v.y,this._currentTransform=C,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var o=this._groupSelector,i=new e.Point(o.ex,o.ey),l=e.util.transformPoint(i,this.viewportTransform),d=new e.Point(o.ex+o.left,o.ey+o.top),a=e.util.transformPoint(d,this.viewportTransform),g=Math.min(l.x,a.x),p=Math.min(l.y,a.y),v=Math.max(l.x,a.x),x=Math.max(l.y,a.y),C=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(g,p,v-g,x-p)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,g+=C,p+=C,v-=C,x-=C,e.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(g,p,v-g,x-p))},findTarget:function(r,o){if(!this.skipTargetFind){var i=!0,l=this.getPointer(r,i),d=this._activeObject,a=this.getActiveObjects(),g,p,v=u(r),x=a.length>1&&!o||a.length===1;if(this.targets=[],x&&d._findTargetCorner(l,v)||a.length>1&&!o&&d===this._searchPossibleTargets([d],l))return d;if(a.length===1&&d===this._searchPossibleTargets([d],l))if(this.preserveObjectStacking)g=d,p=this.targets,this.targets=[];else return d;var C=this._searchPossibleTargets(this._objects,l);return r[this.altSelectionKey]&&C&&g&&C!==g&&(C=g,this.targets=p),C}},_checkTarget:function(r,o,i){if(o&&o.visible&&o.evented&&o.containsPoint(r))if((this.perPixelTargetFind||o.perPixelTargetFind)&&!o.isEditing){var l=this.isTargetTransparent(o,i.x,i.y);if(!l)return!0}else return!0},_searchPossibleTargets:function(r,o){for(var i,l=r.length,d;l--;){var a=r[l],g=a.group?this._normalizePointer(a.group,o):o;if(this._checkTarget(g,a,o)){i=r[l],i.subTargetCheck&&i instanceof e.Group&&(d=this._searchPossibleTargets(i._objects,o),d&&this.targets.push(d));break}}return i},restorePointerVpt:function(r){return e.util.transformPoint(r,e.util.invertTransform(this.viewportTransform))},getPointer:function(r,o){if(this._absolutePointer&&!o)return this._absolutePointer;if(this._pointer&&o)return this._pointer;var i=f(r),l=this.upperCanvasEl,d=l.getBoundingClientRect(),a=d.width||0,g=d.height||0,p;(!a||!g)&&("top"in d&&"bottom"in d&&(g=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(a=Math.abs(d.right-d.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,o||(i=this.restorePointerVpt(i));var v=this.getRetinaScaling();return v!==1&&(i.x/=v,i.y/=v),a===0||g===0?p={width:1,height:1}:p={width:l.width/a,height:l.height/g},{x:i.x*p.width,y:i.y*p.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),o=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),e.util.addClass(i,"upper-canvas "+r),this.wrapperEl.appendChild(i),this._copyCanvasStyle(o,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=e.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),e.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),e.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var o=this.width||r.width,i=this.height||r.height;e.util.setStyle(r,{position:"absolute",width:o+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=o,r.height=i,e.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,o){o.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,o){var i=!1,l=this.getActiveObjects(),d=[],a=[];r.forEach(function(g){l.indexOf(g)===-1&&(i=!0,g.fire("deselected",{e:o,target:g}),a.push(g))}),l.forEach(function(g){r.indexOf(g)===-1&&(i=!0,g.fire("selected",{e:o,target:g}),d.push(g))}),r.length>0&&l.length>0?i&&this.fire("selection:updated",{e:o,selected:d,deselected:a}):l.length>0?this.fire("selection:created",{e:o,selected:d}):r.length>0&&this.fire("selection:cleared",{e:o,deselected:a})},setActiveObject:function(r,o){var i=this.getActiveObjects();return this._setActiveObject(r,o),this._fireSelectionEvents(i,o),this},_setActiveObject:function(r,o){return this._activeObject===r||!this._discardActiveObject(o,r)||r.onSelect({e:o})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,o){var i=this._activeObject;if(i){if(i.onDeselect({e:r,object:o}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var o=this.getActiveObjects(),i=this.getActiveObject();return o.length&&this.fire("before:selection:cleared",{target:i,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(o,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(o){e.util.cleanUpJsdomNode(this[o]),this[o]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,e.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var o=this._activeObject;o&&o._renderControls(r)},_toObject:function(r,o,i){var l=this._realizeGroupTransformOnObject(r),d=this.callSuper("_toObject",r,o,i);return this._unwindGroupTransformOnObject(r,l),d},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var o=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],i={};return o.forEach(function(l){i[l]=r[l]}),e.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),i}else return null},_unwindGroupTransformOnObject:function(r,o){o&&r.set(o)},_setSVGObject:function(r,o,i){var l=this._realizeGroupTransformOnObject(o);this.callSuper("_setSVGObject",r,o,i),this._unwindGroupTransformOnObject(o,l)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),e.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var h in e.StaticCanvas)h!=="prototype"&&(e.Canvas[h]=e.StaticCanvas[h])}(),function(){var f=e.util.addListener,s=e.util.removeListener,u=3,h=2,r=1,o={passive:!1};function i(l,d){return l.button&&l.button===d-1}e.util.object.extend(e.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(f,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(l,d){var a=this.upperCanvasEl,g=this._getEventPrefix();l(e.window,"resize",this._onResize),l(a,g+"down",this._onMouseDown),l(a,g+"move",this._onMouseMove,o),l(a,g+"out",this._onMouseOut),l(a,g+"enter",this._onMouseEnter),l(a,"wheel",this._onMouseWheel),l(a,"contextmenu",this._onContextMenu),l(a,"dblclick",this._onDoubleClick),l(a,"dragover",this._onDragOver),l(a,"dragenter",this._onDragEnter),l(a,"dragleave",this._onDragLeave),l(a,"drop",this._onDrop),this.enablePointerEvents||l(a,"touchstart",this._onTouchStart,o),typeof eventjs<"u"&&d in eventjs&&(eventjs[d](a,"gesture",this._onGesture),eventjs[d](a,"drag",this._onDrag),eventjs[d](a,"orientation",this._onOrientationChange),eventjs[d](a,"shake",this._onShake),eventjs[d](a,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var l=this._getEventPrefix();s(e.document,l+"up",this._onMouseUp),s(e.document,"touchend",this._onTouchEnd,o),s(e.document,l+"move",this._onMouseMove,o),s(e.document,"touchmove",this._onMouseMove,o)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(l,d){this.__onTransformGesture&&this.__onTransformGesture(l,d)},_onDrag:function(l,d){this.__onDrag&&this.__onDrag(l,d)},_onMouseWheel:function(l){this.__onMouseWheel(l)},_onMouseOut:function(l){var d=this._hoveredTarget;this.fire("mouse:out",{target:d,e:l}),this._hoveredTarget=null,d&&d.fire("mouseout",{e:l});var a=this;this._hoveredTargets.forEach(function(g){a.fire("mouse:out",{target:g,e:l}),g&&g.fire("mouseout",{e:l})}),this._hoveredTargets=[]},_onMouseEnter:function(l){!this._currentTransform&&!this.findTarget(l)&&(this.fire("mouse:over",{target:null,e:l}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(l,d){this.__onOrientationChange&&this.__onOrientationChange(l,d)},_onShake:function(l,d){this.__onShake&&this.__onShake(l,d)},_onLongPress:function(l,d){this.__onLongPress&&this.__onLongPress(l,d)},_onDragOver:function(l){l.preventDefault();var d=this._simpleEventHandler("dragover",l);this._fireEnterLeaveEvents(d,l)},_onDrop:function(l){return this._simpleEventHandler("drop:before",l),this._simpleEventHandler("drop",l)},_onContextMenu:function(l){return this.stopContextMenu&&(l.stopPropagation(),l.preventDefault()),!1},_onDoubleClick:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"dblclick"),this._resetTransformEventData(l)},getPointerId:function(l){var d=l.changedTouches;return d?d[0]&&d[0].identifier:this.enablePointerEvents?l.pointerId:-1},_isMainEvent:function(l){return l.isPrimary===!0?!0:l.isPrimary===!1?!1:l.type==="touchend"&&l.touches.length===0?!0:l.changedTouches?l.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(l){l.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(l)),this.__onMouseDown(l),this._resetTransformEventData();var d=this.upperCanvasEl,a=this._getEventPrefix();f(e.document,"touchend",this._onTouchEnd,o),f(e.document,"touchmove",this._onMouseMove,o),s(d,a+"down",this._onMouseDown)},_onMouseDown:function(l){this.__onMouseDown(l),this._resetTransformEventData();var d=this.upperCanvasEl,a=this._getEventPrefix();s(d,a+"move",this._onMouseMove,o),f(e.document,a+"up",this._onMouseUp),f(e.document,a+"move",this._onMouseMove,o)},_onTouchEnd:function(l){if(!(l.touches.length>0)){this.__onMouseUp(l),this._resetTransformEventData(),this.mainTouchId=null;var d=this._getEventPrefix();s(e.document,"touchend",this._onTouchEnd,o),s(e.document,"touchmove",this._onMouseMove,o);var a=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){f(a.upperCanvasEl,d+"down",a._onMouseDown),a._willAddMouseDown=0},400)}},_onMouseUp:function(l){this.__onMouseUp(l),this._resetTransformEventData();var d=this.upperCanvasEl,a=this._getEventPrefix();this._isMainEvent(l)&&(s(e.document,a+"up",this._onMouseUp),s(e.document,a+"move",this._onMouseMove,o),f(d,a+"move",this._onMouseMove,o))},_onMouseMove:function(l){!this.allowTouchScrolling&&l.preventDefault&&l.preventDefault(),this.__onMouseMove(l)},_onResize:function(){this.calcOffset()},_shouldRender:function(l){var d=this._activeObject;return!!d!=!!l||d&&l&&d!==l?!0:(d&&d.isEditing,!1)},__onMouseUp:function(l){var d,a=this._currentTransform,g=this._groupSelector,p=!1,v=!g||g.left===0&&g.top===0;if(this._cacheTransformEventData(l),d=this._target,this._handleEvent(l,"up:before"),i(l,u)){this.fireRightClick&&this._handleEvent(l,"up",u,v);return}if(i(l,h)){this.fireMiddleClick&&this._handleEvent(l,"up",h,v),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(l);return}if(this._isMainEvent(l)){if(a&&(this._finalizeCurrentTransform(l),p=a.actionPerformed),!v){var x=d===this._activeObject;this._maybeGroupObjects(l),p||(p=this._shouldRender(d)||!x&&d===this._activeObject)}var C,S;if(d){if(C=d._findTargetCorner(this.getPointer(l,!0),e.util.isTouchEvent(l)),d.selectable&&d!==this._activeObject&&d.activeOn==="up")this.setActiveObject(d,l),p=!0;else{var T=d.controls[C],P=T&&T.getMouseUpHandler(l,d,T);P&&(S=this.getPointer(l),P(l,a,S.x,S.y))}d.isMoving=!1}if(a&&(a.target!==d||a.corner!==C)){var R=a.target&&a.target.controls[a.corner],z=R&&R.getMouseUpHandler(l,d,T);S=S||this.getPointer(l),z&&z(l,a,S.x,S.y)}this._setCursorFromEvent(l,d),this._handleEvent(l,"up",r,v),this._groupSelector=null,this._currentTransform=null,d&&(d.__corner=0),p?this.requestRenderAll():v||this.renderTop()}},_simpleEventHandler:function(l,d){var a=this.findTarget(d),g=this.targets,p={e:d,target:a,subTargets:g};if(this.fire(l,p),a&&a.fire(l,p),!g)return a;for(var v=0;v<g.length;v++)g[v].fire(l,p);return a},_handleEvent:function(l,d,a,g){var p=this._target,v=this.targets||[],x={e:l,target:p,subTargets:v,button:a||r,isClick:g||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};d==="up"&&(x.currentTarget=this.findTarget(l),x.currentSubTargets=this.targets),this.fire("mouse:"+d,x),p&&p.fire("mouse"+d,x);for(var C=0;C<v.length;C++)v[C].fire("mouse"+d,x)},_finalizeCurrentTransform:function(l){var d=this._currentTransform,a=d.target,g={e:l,target:a,transform:d,action:d.action};a._scaling&&(a._scaling=!1),a.setCoords(),(d.actionPerformed||this.stateful&&a.hasStateChanged())&&this._fire("modified",g)},_onMouseDownInDrawingMode:function(l){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(l).requestRenderAll();var d=this.getPointer(l);this.freeDrawingBrush.onMouseDown(d,{e:l,pointer:d}),this._handleEvent(l,"down")},_onMouseMoveInDrawingMode:function(l){if(this._isCurrentlyDrawing){var d=this.getPointer(l);this.freeDrawingBrush.onMouseMove(d,{e:l,pointer:d})}this.setCursor(this.freeDrawingCursor),this._handleEvent(l,"move")},_onMouseUpInDrawingMode:function(l){var d=this.getPointer(l);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:l,pointer:d}),this._handleEvent(l,"up")},__onMouseDown:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"down:before");var d=this._target;if(i(l,u)){this.fireRightClick&&this._handleEvent(l,"down",u);return}if(i(l,h)){this.fireMiddleClick&&this._handleEvent(l,"down",h);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(l);return}if(this._isMainEvent(l)&&!this._currentTransform){var a=this._pointer;this._previousPointer=a;var g=this._shouldRender(d),p=this._shouldGroup(l,d);if(this._shouldClearSelection(l,d)?this.discardActiveObject(l):p&&(this._handleGrouping(l,d),d=this._activeObject),this.selection&&(!d||!d.selectable&&!d.isEditing&&d!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),d){var v=d===this._activeObject;d.selectable&&d.activeOn==="down"&&this.setActiveObject(d,l);var x=d._findTargetCorner(this.getPointer(l,!0),e.util.isTouchEvent(l));if(d.__corner=x,d===this._activeObject&&(x||!p)){this._setupCurrentTransform(l,d,v);var C=d.controls[x],a=this.getPointer(l),S=C&&C.getMouseDownHandler(l,d,C);S&&S(l,this._currentTransform,a.x,a.y)}}this._handleEvent(l,"down"),(g||p)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(l){this._resetTransformEventData(),this._pointer=this.getPointer(l,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(l)||null},_beforeTransform:function(l){var d=this._currentTransform;this.stateful&&d.target.saveState(),this.fire("before:transform",{e:l,transform:d})},__onMouseMove:function(l){this._handleEvent(l,"move:before"),this._cacheTransformEventData(l);var d,a;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(l);return}if(this._isMainEvent(l)){var g=this._groupSelector;g?(a=this._absolutePointer,g.left=a.x-g.ex,g.top=a.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(l):(d=this.findTarget(l)||null,this._setCursorFromEvent(l,d),this._fireOverOutEvents(d,l)),this._handleEvent(l,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(l,d){var a=this._hoveredTarget,g=this._hoveredTargets,p=this.targets,v=Math.max(g.length,p.length);this.fireSyntheticInOutEvents(l,d,{oldTarget:a,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var x=0;x<v;x++)this.fireSyntheticInOutEvents(p[x],d,{oldTarget:g[x],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(l,d){var a=this._draggedoverTarget,g=this._hoveredTargets,p=this.targets,v=Math.max(g.length,p.length);this.fireSyntheticInOutEvents(l,d,{oldTarget:a,evtOut:"dragleave",evtIn:"dragenter"});for(var x=0;x<v;x++)this.fireSyntheticInOutEvents(p[x],d,{oldTarget:g[x],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=l},fireSyntheticInOutEvents:function(l,d,a){var g,p,v=a.oldTarget,x,C,S=v!==l,T=a.canvasEvtIn,P=a.canvasEvtOut;S&&(g={e:d,target:l,previousTarget:v},p={e:d,target:v,nextTarget:l}),C=l&&S,x=v&&S,x&&(P&&this.fire(P,p),v.fire(a.evtOut,p)),C&&(T&&this.fire(T,g),l.fire(a.evtIn,g))},__onMouseWheel:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"wheel"),this._resetTransformEventData()},_transformObject:function(l){var d=this.getPointer(l),a=this._currentTransform;a.reset=!1,a.shiftKey=l.shiftKey,a.altKey=l[this.centeredKey],this._performTransformAction(l,a,d),a.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(l,d,a){var g=a.x,p=a.y,v=d.action,x=!1,C=d.actionHandler;C&&(x=C(l,d,g,p)),v==="drag"&&x&&(d.target.isMoving=!0,this.setCursor(d.target.moveCursor||this.moveCursor)),d.actionPerformed=d.actionPerformed||x},_fire:e.controlsUtils.fireEvent,_setCursorFromEvent:function(l,d){if(!d)return this.setCursor(this.defaultCursor),!1;var a=d.hoverCursor||this.hoverCursor,g=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,p=(!g||!g.contains(d))&&d._findTargetCorner(this.getPointer(l,!0));p?this.setCursor(this.getCornerCursor(p,d,l)):(d.subTargetCheck&&this.targets.concat().reverse().map(function(v){a=v.hoverCursor||a}),this.setCursor(a))},getCornerCursor:function(l,d,a){var g=d.controls[l];return g.cursorStyleHandler(a,g,d)}})}(),function(){var f=Math.min,s=Math.max;e.util.object.extend(e.Canvas.prototype,{_shouldGroup:function(u,h){var r=this._activeObject;return r&&this._isSelectionKeyPressed(u)&&h&&h.selectable&&this.selection&&(r!==h||r.type==="activeSelection")&&!h.onSelect({e:u})},_handleGrouping:function(u,h){var r=this._activeObject;r.__corner||h===r&&(h=this.findTarget(u,!0),!h||!h.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(h,u):this._createActiveSelection(h,u))},_updateActiveSelection:function(u,h){var r=this._activeObject,o=r._objects.slice(0);r.contains(u)?(r.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),h)):(r.addWithUpdate(u),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(o,h)},_createActiveSelection:function(u,h){var r=this.getActiveObjects(),o=this._createGroup(u);this._hoveredTarget=o,this._setActiveObject(o,h),this._fireSelectionEvents(r,h)},_createGroup:function(u){var h=this._objects,r=h.indexOf(this._activeObject)<h.indexOf(u),o=r?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new e.ActiveSelection(o,{canvas:this})},_groupSelectedObjects:function(u){var h=this._collectObjects(u),r;h.length===1?this.setActiveObject(h[0],u):h.length>1&&(r=new e.ActiveSelection(h.reverse(),{canvas:this}),this.setActiveObject(r,u))},_collectObjects:function(u){for(var h=[],r,o=this._groupSelector.ex,i=this._groupSelector.ey,l=o+this._groupSelector.left,d=i+this._groupSelector.top,a=new e.Point(f(o,l),f(i,d)),g=new e.Point(s(o,l),s(i,d)),p=!this.selectionFullyContained,v=o===l&&i===d,x=this._objects.length;x--&&(r=this._objects[x],!(!(!r||!r.selectable||!r.visible)&&(p&&r.intersectsWithRect(a,g,!0)||r.isContainedWithinRect(a,g,!0)||p&&r.containsPoint(a,null,!0)||p&&r.containsPoint(g,null,!0))&&(h.push(r),v))););return h.length>1&&(h=h.filter(function(C){return!C.onSelect({e:u})})),h},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){e.util.object.extend(e.StaticCanvas.prototype,{toDataURL:function(f){f||(f={});var s=f.format||"png",u=f.quality||1,h=(f.multiplier||1)*(f.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(h,f);return e.util.toDataURL(r,s,u)},toCanvasElement:function(f,s){f=f||1,s=s||{};var u=(s.width||this.width)*f,h=(s.height||this.height)*f,r=this.getZoom(),o=this.width,i=this.height,l=r*f,d=this.viewportTransform,a=(d[4]-(s.left||0))*f,g=(d[5]-(s.top||0))*f,p=this.interactive,v=[l,0,0,l,a,g],x=this.enableRetinaScaling,C=e.util.createCanvasElement(),S=this.contextTop;return C.width=u,C.height=h,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=u,this.height=h,this.calcViewportBoundaries(),this.renderCanvas(C.getContext("2d"),this._objects),this.viewportTransform=d,this.width=o,this.height=i,this.calcViewportBoundaries(),this.interactive=p,this.enableRetinaScaling=x,this.contextTop=S,C}})}(),e.util.object.extend(e.StaticCanvas.prototype,{loadFromJSON:function(f,s,u){if(f){var h=typeof f=="string"?JSON.parse(f):e.util.object.clone(f),r=this,o=h.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete h.clipPath,this._enlivenObjects(h.objects,function(l){r.clear(),r._setBgOverlay(h,function(){o?r._enlivenObjects([o],function(d){r.clipPath=d[0],r.__setupCanvas.call(r,h,l,i,s)}):r.__setupCanvas.call(r,h,l,i,s)})},u),this}},__setupCanvas:function(f,s,u,h){var r=this;s.forEach(function(o,i){r.insertAt(o,i)}),this.renderOnAddRemove=u,delete f.objects,delete f.backgroundImage,delete f.overlayImage,delete f.background,delete f.overlay,this._setOptions(f),this.renderAll(),h&&h()},_setBgOverlay:function(f,s){var u={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!f.backgroundImage&&!f.overlayImage&&!f.background&&!f.overlay){s&&s();return}var h=function(){u.backgroundImage&&u.overlayImage&&u.backgroundColor&&u.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",f.backgroundImage,u,h),this.__setBgOverlay("overlayImage",f.overlayImage,u,h),this.__setBgOverlay("backgroundColor",f.background,u,h),this.__setBgOverlay("overlayColor",f.overlay,u,h)},__setBgOverlay:function(f,s,u,h){var r=this;if(!s){u[f]=!0,h&&h();return}f==="backgroundImage"||f==="overlayImage"?e.util.enlivenObjects([s],function(o){r[f]=o[0],u[f]=!0,h&&h()}):this["set"+e.util.string.capitalize(f,!0)](s,function(){u[f]=!0,h&&h()})},_enlivenObjects:function(f,s,u){if(!f||f.length===0){s&&s([]);return}e.util.enlivenObjects(f,function(h){s&&s(h)},null,u)},_toDataURL:function(f,s){this.clone(function(u){s(u.toDataURL(f))})},_toDataURLWithMultiplier:function(f,s,u){this.clone(function(h){u(h.toDataURLWithMultiplier(f,s))})},clone:function(f,s){var u=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(h){h.loadFromJSON(u,function(){f&&f(h)})})},cloneWithoutData:function(f){var s=e.util.createCanvasElement();s.width=this.width,s.height=this.height;var u=new e.Canvas(s);this.backgroundImage?(u.setBackgroundImage(this.backgroundImage.src,function(){u.renderAll(),f&&f(u)}),u.backgroundImageOpacity=this.backgroundImageOpacity,u.backgroundImageStretch=this.backgroundImageStretch):f&&f(u)}}),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend,h=s.util.object.clone,r=s.util.toFixed,o=s.util.string.capitalize,i=s.util.degreesToRadians,l=!s.isLikelyNode,d=2;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:l,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(a){a&&this.setOptions(a)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(a){var g=s.perfLimitSizeTotal,p=a.width,v=a.height,x=s.maxCacheSideLimit,C=s.minCacheSideLimit;if(p<=x&&v<=x&&p*v<=g)return p<C&&(a.width=C),v<C&&(a.height=C),a;var S=p/v,T=s.util.limitDimsByArea(S,g),P=s.util.capValue,R=P(C,T.x,x),z=P(C,T.y,x);return p>R&&(a.zoomX/=p/R,a.width=R,a.capped=!0),v>z&&(a.zoomY/=v/z,a.height=z,a.capped=!0),a},_getCacheCanvasDimensions:function(){var a=this.getTotalObjectScaling(),g=this._getTransformedDimensions(0,0),p=g.x*a.scaleX/this.scaleX,v=g.y*a.scaleY/this.scaleY;return{width:Math.ceil(p+d),height:Math.ceil(v+d),zoomX:a.scaleX,zoomY:a.scaleY,x:p,y:v}},_updateCacheCanvas:function(){var a=this.canvas;if(this.noScaleCache&&a&&a._currentTransform){var g=a._currentTransform.target,p=a._currentTransform.action;if(this===g&&p.slice&&p.slice(0,5)==="scale")return!1}var v=this._cacheCanvas,x=this._limitCacheSize(this._getCacheCanvasDimensions()),C=x.width,S=x.height,T,P,R=x.zoomX,z=x.zoomY,J=C!==this.cacheWidth||S!==this.cacheHeight,ne=this.zoomX!==R||this.zoomY!==z,ie=J||ne;return ie?(J?(v.width=C,v.height=S):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,v.width,v.height)),T=x.x/2,P=x.y/2,this.cacheTranslationX=Math.round(v.width/2-T)+T,this.cacheTranslationY=Math.round(v.height/2-P)+P,this.cacheWidth=C,this.cacheHeight=S,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(R,z),this.zoomX=R,this.zoomY=z,!0):!1},setOptions:function(a){this._setOptions(a),this._initGradient(a.fill,"fill"),this._initGradient(a.stroke,"stroke"),this._initPattern(a.fill,"fill"),this._initPattern(a.stroke,"stroke")},transform:function(a){var g=this.group&&!this.group._transformDone||this.group&&this.canvas&&a===this.canvas.contextTop,p=this.calcTransformMatrix(!g);a.transform(p[0],p[1],p[2],p[3],p[4],p[5])},toObject:function(a){var g=s.Object.NUM_FRACTION_DIGITS,p={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:r(this.left,g),top:r(this.top,g),width:r(this.width,g),height:r(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,g),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,g),scaleX:r(this.scaleX,g),scaleY:r(this.scaleY,g),angle:r(this.angle,g),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,g),skewY:r(this.skewY,g)};return this.clipPath&&!this.clipPath.excludeFromExport&&(p.clipPath=this.clipPath.toObject(a),p.clipPath.inverted=this.clipPath.inverted,p.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,p,a),this.includeDefaultValues||(p=this._removeDefaultValues(p)),p},toDatalessObject:function(a){return this.toObject(a)},_removeDefaultValues:function(a){var g=s.util.getKlass(a.type).prototype,p=g.stateProperties;return p.forEach(function(v){v==="left"||v==="top"||(a[v]===g[v]&&delete a[v],Array.isArray(a[v])&&Array.isArray(g[v])&&a[v].length===0&&g[v].length===0&&delete a[v])}),a},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var a=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(a.scaleX),scaleY:Math.abs(a.scaleY)}},getTotalObjectScaling:function(){var a=this.getObjectScaling(),g=a.scaleX,p=a.scaleY;if(this.canvas){var v=this.canvas.getZoom(),x=this.canvas.getRetinaScaling();g*=v*x,p*=v*x}return{scaleX:g,scaleY:p}},getObjectOpacity:function(){var a=this.opacity;return this.group&&(a*=this.group.getObjectOpacity()),a},_set:function(a,g){var p=a==="scaleX"||a==="scaleY",v=this[a]!==g,x=!1;return p&&(g=this._constrainScale(g)),a==="scaleX"&&g<0?(this.flipX=!this.flipX,g*=-1):a==="scaleY"&&g<0?(this.flipY=!this.flipY,g*=-1):a==="shadow"&&g&&!(g instanceof s.Shadow)?g=new s.Shadow(g):a==="dirty"&&this.group&&this.group.set("dirty",g),this[a]=g,v&&(x=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(a)>-1?(this.dirty=!0,x&&this.group.set("dirty",!0)):x&&this.stateProperties.indexOf(a)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(a){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(a.save(),this._setupCompositeOperation(a),this.drawSelectionBackground(a),this.transform(a),this._setOpacity(a),this._setShadow(a,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(a)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(a),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),a.restore())},renderCache:function(a){a=a||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,a.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(a,g){if(a.save(),g.inverted?a.globalCompositeOperation="destination-out":a.globalCompositeOperation="destination-in",g.absolutePositioned){var p=s.util.invertTransform(this.calcTransformMatrix());a.transform(p[0],p[1],p[2],p[3],p[4],p[5])}g.transform(a),a.scale(1/g.zoomX,1/g.zoomY),a.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),a.restore()},drawObject:function(a,g){var p=this.fill,v=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(a)):this._renderBackground(a),this._render(a),this._drawClipPath(a,this.clipPath),this.fill=p,this.stroke=v},_drawClipPath:function(a,g){g&&(g.canvas=this.canvas,g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(a,g))},drawCacheOnCanvas:function(a){a.scale(1/this.zoomX,1/this.zoomY),a.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(a){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!a&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!a){var g=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-p/2,g,p)}return!0}return!1},_renderBackground:function(a){if(this.backgroundColor){var g=this._getNonTransformedDimensions();a.fillStyle=this.backgroundColor,a.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(a)}},_setOpacity:function(a){this.group&&!this.group._transformDone?a.globalAlpha=this.getObjectOpacity():a.globalAlpha*=this.opacity},_setStrokeStyles:function(a,g){var p=g.stroke;p&&(a.lineWidth=g.strokeWidth,a.lineCap=g.strokeLineCap,a.lineDashOffset=g.strokeDashOffset,a.lineJoin=g.strokeLineJoin,a.miterLimit=g.strokeMiterLimit,p.toLive?p.gradientUnits==="percentage"||p.gradientTransform||p.patternTransform?this._applyPatternForTransformedGradient(a,p):(a.strokeStyle=p.toLive(a,this),this._applyPatternGradientTransform(a,p)):a.strokeStyle=g.stroke)},_setFillStyles:function(a,g){var p=g.fill;p&&(p.toLive?(a.fillStyle=p.toLive(a,this),this._applyPatternGradientTransform(a,g.fill)):a.fillStyle=p)},_setClippingProperties:function(a){a.globalAlpha=1,a.strokeStyle="transparent",a.fillStyle="#000000"},_setLineDash:function(a,g){!g||g.length===0||(1&g.length&&g.push.apply(g,g),a.setLineDash(g))},_renderControls:function(a,g){var p=this.getViewportTransform(),v=this.calcTransformMatrix(),x,C,S;g=g||{},C=typeof g.hasBorders<"u"?g.hasBorders:this.hasBorders,S=typeof g.hasControls<"u"?g.hasControls:this.hasControls,v=s.util.multiplyTransformMatrices(p,v),x=s.util.qrDecompose(v),a.save(),a.translate(x.translateX,x.translateY),a.lineWidth=1*this.borderScaleFactor,this.group||(a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(x.angle-=180),a.rotate(i(this.group?x.angle:this.angle)),g.forActiveSelection||this.group?C&&this.drawBordersInGroup(a,x,g):C&&this.drawBorders(a,g),S&&this.drawControls(a,g),a.restore()},_setShadow:function(a){if(this.shadow){var g=this.shadow,p=this.canvas,v,x=p&&p.viewportTransform[0]||1,C=p&&p.viewportTransform[3]||1;g.nonScaling?v={scaleX:1,scaleY:1}:v=this.getObjectScaling(),p&&p._isRetinaScaling()&&(x*=s.devicePixelRatio,C*=s.devicePixelRatio),a.shadowColor=g.color,a.shadowBlur=g.blur*s.browserShadowBlurConstant*(x+C)*(v.scaleX+v.scaleY)/4,a.shadowOffsetX=g.offsetX*x*v.scaleX,a.shadowOffsetY=g.offsetY*C*v.scaleY}},_removeShadow:function(a){this.shadow&&(a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0)},_applyPatternGradientTransform:function(a,g){if(!g||!g.toLive)return{offsetX:0,offsetY:0};var p=g.gradientTransform||g.patternTransform,v=-this.width/2+g.offsetX||0,x=-this.height/2+g.offsetY||0;return g.gradientUnits==="percentage"?a.transform(this.width,0,0,this.height,v,x):a.transform(1,0,0,1,v,x),p&&a.transform(p[0],p[1],p[2],p[3],p[4],p[5]),{offsetX:v,offsetY:x}},_renderPaintInOrder:function(a){this.paintFirst==="stroke"?(this._renderStroke(a),this._renderFill(a)):(this._renderFill(a),this._renderStroke(a))},_render:function(){},_renderFill:function(a){this.fill&&(a.save(),this._setFillStyles(a,this),this.fillRule==="evenodd"?a.fill("evenodd"):a.fill(),a.restore())},_renderStroke:function(a){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this.strokeUniform&&this.group){var g=this.getObjectScaling();a.scale(1/g.scaleX,1/g.scaleY)}else this.strokeUniform&&a.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(a,this.strokeDashArray),this._setStrokeStyles(a,this),a.stroke(),a.restore()}},_applyPatternForTransformedGradient:function(a,g){var p=this._limitCacheSize(this._getCacheCanvasDimensions()),v=s.util.createCanvasElement(),x,C=this.canvas.getRetinaScaling(),S=p.x/this.scaleX/C,T=p.y/this.scaleY/C;v.width=Math.ceil(S),v.height=Math.ceil(T),x=v.getContext("2d"),x.beginPath(),x.moveTo(0,0),x.lineTo(S,0),x.lineTo(S,T),x.lineTo(0,T),x.closePath(),x.translate(S/2,T/2),x.scale(p.zoomX/this.scaleX/C,p.zoomY/this.scaleY/C),this._applyPatternGradientTransform(x,g),x.fillStyle=g.toLive(a),x.fill(),a.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),a.scale(C*this.scaleX/p.zoomX,C*this.scaleY/p.zoomY),a.strokeStyle=x.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var a=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",a.scaleX),this.set("scaleY",a.scaleY),this.angle=a.angle,this.skewX=a.skewX,this.skewY=0}},_removeTransformMatrix:function(a){var g=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),g=s.util.transformPoint(g,this.transformMatrix)),this.transformMatrix=null,a&&(this.scaleX*=a.scaleX,this.scaleY*=a.scaleY,this.cropX=a.cropX,this.cropY=a.cropY,g.x+=a.offsetLeft,g.y+=a.offsetTop,this.width=a.width,this.height=a.height),this.setPositionByOrigin(g,"center","center")},clone:function(a,g){var p=this.toObject(g);this.constructor.fromObject?this.constructor.fromObject(p,a):s.Object._fromObject("Object",p,a)},cloneAsImage:function(a,g){var p=this.toCanvasElement(g);return a&&a(new s.Image(p)),this},toCanvasElement:function(a){a||(a={});var g=s.util,p=g.saveObjectTransform(this),v=this.group,x=this.shadow,C=Math.abs,S=(a.multiplier||1)*(a.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,a.withoutTransform&&g.resetObjectTransform(this),a.withoutShadow&&(this.shadow=null);var T=s.util.createCanvasElement(),P=this.getBoundingRect(!0,!0),R=this.shadow,z,J={x:0,y:0},ne,ie,te;R&&(ne=R.blur,R.nonScaling?z={scaleX:1,scaleY:1}:z=this.getObjectScaling(),J.x=2*Math.round(C(R.offsetX)+ne)*C(z.scaleX),J.y=2*Math.round(C(R.offsetY)+ne)*C(z.scaleY)),ie=P.width+J.x,te=P.height+J.y,T.width=Math.ceil(ie),T.height=Math.ceil(te);var re=new s.StaticCanvas(T,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});a.format==="jpeg"&&(re.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(re.width/2,re.height/2),"center","center");var oe=this.canvas;re.add(this);var le=re.toCanvasElement(S||1,a);return this.shadow=x,this.set("canvas",oe),v&&(this.group=v),this.set(p).setCoords(),re._objects=[],re.dispose(),re=null,le},toDataURL:function(a){return a||(a={}),s.util.toDataURL(this.toCanvasElement(a),a.format||"png",a.quality||1)},isType:function(a){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===a},complexity:function(){return 1},toJSON:function(a){return this.toObject(a)},rotate:function(a){var g=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return g&&this._setOriginToCenter(),this.set("angle",a),g&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(a,g){g=g||this.canvas.getPointer(a);var p=new s.Point(g.x,g.y),v=this._getLeftTopCoords();return this.angle&&(p=s.util.rotatePoint(p,v,i(-this.angle))),{x:p.x-v.x,y:p.y-v.y}},_setupCompositeOperation:function(a){this.globalCompositeOperation&&(a.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),u(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(a,g,p,v){var x=s[a];g=h(g,!0),s.util.enlivenPatterns([g.fill,g.stroke],function(C){typeof C[0]<"u"&&(g.fill=C[0]),typeof C[1]<"u"&&(g.stroke=C[1]),s.util.enlivenObjectEnlivables(g,g,function(){var S=v?new x(g[v],g):new x(g);p&&p(S)})})},s.Object.__uid=0)}(t),function(){var f=e.util.degreesToRadians,s={left:-.5,center:0,right:.5},u={top:-.5,center:0,bottom:.5};e.util.object.extend(e.Object.prototype,{translateToGivenOrigin:function(h,r,o,i,l){var d=h.x,a=h.y,g,p,v;return typeof r=="string"?r=s[r]:r-=.5,typeof i=="string"?i=s[i]:i-=.5,g=i-r,typeof o=="string"?o=u[o]:o-=.5,typeof l=="string"?l=u[l]:l-=.5,p=l-o,(g||p)&&(v=this._getTransformedDimensions(),d=h.x+g*v.x,a=h.y+p*v.y),new e.Point(d,a)},translateToCenterPoint:function(h,r,o){var i=this.translateToGivenOrigin(h,r,o,"center","center");return this.angle?e.util.rotatePoint(i,h,f(this.angle)):i},translateToOriginPoint:function(h,r,o){var i=this.translateToGivenOrigin(h,"center","center",r,o);return this.angle?e.util.rotatePoint(i,h,f(this.angle)):i},getCenterPoint:function(){var h=new e.Point(this.left,this.top);return this.translateToCenterPoint(h,this.originX,this.originY)},getPointByOrigin:function(h,r){var o=this.getCenterPoint();return this.translateToOriginPoint(o,h,r)},toLocalPoint:function(h,r,o){var i=this.getCenterPoint(),l,d;return typeof r<"u"&&typeof o<"u"?l=this.translateToGivenOrigin(i,"center","center",r,o):l=new e.Point(this.left,this.top),d=new e.Point(h.x,h.y),this.angle&&(d=e.util.rotatePoint(d,i,-f(this.angle))),d.subtractEquals(l)},setPositionByOrigin:function(h,r,o){var i=this.translateToCenterPoint(h,r,o),l=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",l.x),this.set("top",l.y)},adjustPosition:function(h){var r=f(this.angle),o=this.getScaledWidth(),i=e.util.cos(r)*o,l=e.util.sin(r)*o,d,a;typeof this.originX=="string"?d=s[this.originX]:d=this.originX-.5,typeof h=="string"?a=s[h]:a=h-.5,this.left+=i*(a-d),this.top+=l*(a-d),this.setCoords(),this.originX=h},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var h=this.getCenterPoint();this.originX="center",this.originY="center",this.left=h.x,this.top=h.y},_resetOrigin:function(){var h=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=h.x,this.top=h.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function f(o){return[new e.Point(o.tl.x,o.tl.y),new e.Point(o.tr.x,o.tr.y),new e.Point(o.br.x,o.br.y),new e.Point(o.bl.x,o.bl.y)]}var s=e.util,u=s.degreesToRadians,h=s.multiplyTransformMatrices,r=s.transformPoint;s.object.extend(e.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(o,i){return i?o?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),o?this.aCoords:this.lineCoords)},getCoords:function(o,i){return f(this._getCoords(o,i))},intersectsWithRect:function(o,i,l,d){var a=this.getCoords(l,d),g=e.Intersection.intersectPolygonRectangle(a,o,i);return g.status==="Intersection"},intersectsWithObject:function(o,i,l){var d=e.Intersection.intersectPolygonPolygon(this.getCoords(i,l),o.getCoords(i,l));return d.status==="Intersection"||o.isContainedWithinObject(this,i,l)||this.isContainedWithinObject(o,i,l)},isContainedWithinObject:function(o,i,l){for(var d=this.getCoords(i,l),a=i?o.aCoords:o.lineCoords,g=0,p=o._getImageLines(a);g<4;g++)if(!o.containsPoint(d[g],p))return!1;return!0},isContainedWithinRect:function(o,i,l,d){var a=this.getBoundingRect(l,d);return a.left>=o.x&&a.left+a.width<=i.x&&a.top>=o.y&&a.top+a.height<=i.y},containsPoint:function(o,g,l,d){var a=this._getCoords(l,d),g=g||this._getImageLines(a),p=this._findCrossPoints(o,g);return p!==0&&p%2===1},isOnScreen:function(o){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br,d=this.getCoords(!0,o);return d.some(function(a){return a.x<=l.x&&a.x>=i.x&&a.y<=l.y&&a.y>=i.y})||this.intersectsWithRect(i,l,!0,o)?!0:this._containsCenterOfCanvas(i,l,o)},_containsCenterOfCanvas:function(o,i,l){var d={x:(o.x+i.x)/2,y:(o.y+i.y)/2};return!!this.containsPoint(d,null,!0,l)},isPartiallyOnScreen:function(o){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br;if(this.intersectsWithRect(i,l,!0,o))return!0;var d=this.getCoords(!0,o).every(function(a){return(a.x>=l.x||a.x<=i.x)&&(a.y>=l.y||a.y<=i.y)});return d&&this._containsCenterOfCanvas(i,l,o)},_getImageLines:function(o){var i={topline:{o:o.tl,d:o.tr},rightline:{o:o.tr,d:o.br},bottomline:{o:o.br,d:o.bl},leftline:{o:o.bl,d:o.tl}};return i},_findCrossPoints:function(o,i){var l,d,a,g,p,v=0,x;for(var C in i)if(x=i[C],!(x.o.y<o.y&&x.d.y<o.y)&&!(x.o.y>=o.y&&x.d.y>=o.y)&&(x.o.x===x.d.x&&x.o.x>=o.x?p=x.o.x:(l=0,d=(x.d.y-x.o.y)/(x.d.x-x.o.x),a=o.y-l*o.x,g=x.o.y-d*x.o.x,p=-(a-g)/(l-d)),p>=o.x&&(v+=1),v===2))break;return v},getBoundingRect:function(o,i){var l=this.getCoords(o,i);return s.makeBoundingBoxFromPoints(l)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(o){return Math.abs(o)<this.minScaleLimit?o<0?-this.minScaleLimit:this.minScaleLimit:o===0?1e-4:o},scale:function(o){return this._set("scaleX",o),this._set("scaleY",o),this.setCoords()},scaleToWidth:function(o,i){var l=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(o/this.width/l)},scaleToHeight:function(o,i){var l=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(o/this.height/l)},calcLineCoords:function(){var o=this.getViewportTransform(),i=this.padding,l=u(this.angle),d=s.cos(l),a=s.sin(l),g=d*i,p=a*i,v=g+p,x=g-p,C=this.calcACoords(),S={tl:r(C.tl,o),tr:r(C.tr,o),bl:r(C.bl,o),br:r(C.br,o)};return i&&(S.tl.x-=x,S.tl.y-=v,S.tr.x+=v,S.tr.y-=x,S.bl.x-=v,S.bl.y+=x,S.br.x+=x,S.br.y+=v),S},calcOCoords:function(){var o=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),l=this.getViewportTransform(),d=h(l,i),a=h(d,o),a=h(a,[1/l[0],0,0,1/l[3],0,0]),g=this._calculateCurrentDimensions(),p={};return this.forEachControl(function(v,x,C){p[x]=v.positionHandler(g,a,C)}),p},calcACoords:function(){var o=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),l=h(i,o),d=this._getTransformedDimensions(),a=d.x/2,g=d.y/2;return{tl:r({x:-a,y:-g},l),tr:r({x:a,y:-g},l),bl:r({x:-a,y:g},l),br:r({x:a,y:g},l)}},setCoords:function(o){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),o?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var o=this.getCenterPoint();return[1,0,0,1,o.x,o.y]},transformMatrixKey:function(o){var i="_",l="";return!o&&this.group&&(l=this.group.transformMatrixKey(o)+i),l+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(o){var i=this.calcOwnMatrix();if(o||!this.group)return i;var l=this.transformMatrixKey(o),d=this.matrixCache||(this.matrixCache={});return d.key===l?d.value:(this.group&&(i=h(this.group.calcTransformMatrix(!1),i)),d.key=l,d.value=i,i)},calcOwnMatrix:function(){var o=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===o)return i.value;var l=this._calcTranslateMatrix(),d={angle:this.angle,translateX:l[4],translateY:l[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=o,i.value=s.composeMatrix(d),i.value},_getNonTransformedDimensions:function(){var o=this.strokeWidth,i=this.width+o,l=this.height+o;return{x:i,y:l}},_getTransformedDimensions:function(o,i){typeof o>"u"&&(o=this.skewX),typeof i>"u"&&(i=this.skewY);var l,d,a,g=o===0&&i===0;if(this.strokeUniform?(d=this.width,a=this.height):(l=this._getNonTransformedDimensions(),d=l.x,a=l.y),g)return this._finalizeDimensions(d*this.scaleX,a*this.scaleY);var p=s.sizeAfterTransform(d,a,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:o,skewY:i});return this._finalizeDimensions(p.x,p.y)},_finalizeDimensions:function(o,i){return this.strokeUniform?{x:o+this.strokeWidth,y:i+this.strokeWidth}:{x:o,y:i}},_calculateCurrentDimensions:function(){var o=this.getViewportTransform(),i=this._getTransformedDimensions(),l=r(i,o,!0);return l.scalarAdd(2*this.padding)}})}(),e.util.object.extend(e.Object.prototype,{sendToBack:function(){return this.group?e.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?e.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(f){return this.group?e.StaticCanvas.prototype.sendBackwards.call(this.group,this,f):this.canvas&&this.canvas.sendBackwards(this,f),this},bringForward:function(f){return this.group?e.StaticCanvas.prototype.bringForward.call(this.group,this,f):this.canvas&&this.canvas.bringForward(this,f),this},moveTo:function(f){return this.group&&this.group.type!=="activeSelection"?e.StaticCanvas.prototype.moveTo.call(this.group,this,f):this.canvas&&this.canvas.moveTo(this,f),this}}),function(){function f(u,h){if(h){if(h.toLive)return u+": url(#SVGID_"+h.id+"); ";var r=new e.Color(h),o=u+": "+r.toRgb()+"; ",i=r.getAlpha();return i!==1&&(o+=u+"-opacity: "+i.toString()+"; "),o}else return u+": none; "}var s=e.util.toFixed;e.util.object.extend(e.Object.prototype,{getSvgStyles:function(u){var h=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",o=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",l=this.strokeLineCap?this.strokeLineCap:"butt",d=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",g=typeof this.opacity<"u"?this.opacity:"1",p=this.visible?"":" visibility: hidden;",v=u?"":this.getSvgFilter(),x=f("fill",this.fill),C=f("stroke",this.stroke);return[C,"stroke-width: ",r,"; ","stroke-dasharray: ",o,"; ","stroke-linecap: ",l,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",d,"; ","stroke-miterlimit: ",a,"; ",x,"fill-rule: ",h,"; ","opacity: ",g,";",v,p].join("")},getSvgSpanStyles:function(u,h){var r="; ",i=u.fontFamily?"font-family: "+(u.fontFamily.indexOf("'")===-1&&u.fontFamily.indexOf('"')===-1?"'"+u.fontFamily+"'":u.fontFamily)+r:"",o=u.strokeWidth?"stroke-width: "+u.strokeWidth+r:"",i=i,l=u.fontSize?"font-size: "+u.fontSize+"px"+r:"",d=u.fontStyle?"font-style: "+u.fontStyle+r:"",a=u.fontWeight?"font-weight: "+u.fontWeight+r:"",g=u.fill?f("fill",u.fill):"",p=u.stroke?f("stroke",u.stroke):"",v=this.getSvgTextDecoration(u),x=u.deltaY?"baseline-shift: "+-u.deltaY+"; ":"";return v&&(v="text-decoration: "+v+r),[p,o,i,l,d,a,v,g,x,h?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(u){return["overline","underline","line-through"].filter(function(h){return u[h.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(u,h){var r=u?this.calcTransformMatrix():this.calcOwnMatrix(),o='transform="'+e.util.matrixToSVG(r);return o+(h||"")+'" '},_setSVGBg:function(u){if(this.backgroundColor){var h=e.Object.NUM_FRACTION_DIGITS;u.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,h),'" y="',s(-this.height/2,h),'" width="',s(this.width,h),'" height="',s(this.height,h),`"></rect>
`)}},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(u),{reviver:u})},toClipPathSVG:function(u){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(u),{reviver:u})},_createBaseClipPathSVGMarkup:function(u,h){h=h||{};var r=h.reviver,o=h.additionalTransform||"",i=[this.getSvgTransform(!0,o),this.getSvgCommons()].join(""),l=u.indexOf("COMMON_PARTS");return u[l]=i,r?r(u.join("")):u.join("")},_createBaseSVGMarkup:function(u,h){h=h||{};var r=h.noStyle,o=h.reviver,i=r?"":'style="'+this.getSvgStyles()+'" ',l=h.withShadow?'style="'+this.getSvgFilter()+'" ':"",d=this.clipPath,a=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",g=d&&d.absolutePositioned,p=this.stroke,v=this.fill,x=this.shadow,C,S=[],T,P=u.indexOf("COMMON_PARTS"),R=h.additionalTransform;return d&&(d.clipPathId="CLIPPATH_"+e.Object.__uid++,T='<clipPath id="'+d.clipPathId+`" >
`+d.toClipPathSVG(o)+`</clipPath>
`),g&&S.push("<g ",l,this.getSvgCommons(),` >
`),S.push("<g ",this.getSvgTransform(!1),g?"":l+this.getSvgCommons(),` >
`),C=[i,a,r?"":this.addPaintOrder()," ",R?'transform="'+R+'" ':""].join(""),u[P]=C,v&&v.toLive&&S.push(v.toSVG(this)),p&&p.toLive&&S.push(p.toSVG(this)),x&&S.push(x.toSVG(this)),d&&S.push(T),S.push(u.join("")),S.push(`</g>
`),g&&S.push(`</g>
`),o?o(S.join("")):S.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var f=e.util.object.extend,s="stateProperties";function u(r,o,i){var l={},d=!0;i.forEach(function(a){l[a]=r[a]}),f(r[o],l,d)}function h(r,o,i){if(r===o)return!0;if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(var l=0,d=r.length;l<d;l++)if(!h(r[l],o[l]))return!1;return!0}else if(r&&typeof r=="object"){var a=Object.keys(r),g;if(!o||typeof o!="object"||!i&&a.length!==Object.keys(o).length)return!1;for(var l=0,d=a.length;l<d;l++)if(g=a[l],!(g==="canvas"||g==="group")&&!h(r[g],o[g]))return!1;return!0}}e.util.object.extend(e.Object.prototype,{hasStateChanged:function(r){r=r||s;var o="_"+r;return Object.keys(this[o]).length<this[r].length?!0:!h(this[o],this,!0)},saveState:function(r){var o=r&&r.propertySet||s,i="_"+o;return this[i]?(u(this,i,this[o]),r&&r.stateProperties&&u(this,i,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var o=r.propertySet||s;return r.propertySet=o,this["_"+o]={},this.saveState(r),this}})}(),function(){var f=e.util.degreesToRadians;e.util.object.extend(e.Object.prototype,{_findTargetCorner:function(s,u){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var h=s.x,r=s.y,o,i,l=Object.keys(this.oCoords),d=l.length-1,a;for(this.__corner=0;d>=0;d--)if(a=l[d],!!this.isControlVisible(a)&&(i=this._getImageLines(u?this.oCoords[a].touchCorner:this.oCoords[a].corner),o=this._findCrossPoints({x:h,y:r},i),o!==0&&o%2===1))return this.__corner=a,a;return!1},forEachControl:function(s){for(var u in this.controls)s(this.controls[u],u,this)},_setCornerCoords:function(){var s=this.oCoords;for(var u in s){var h=this.controls[u];s[u].corner=h.calcCornerCoords(this.angle,this.cornerSize,s[u].x,s[u].y,!1),s[u].touchCorner=h.calcCornerCoords(this.angle,this.touchCornerSize,s[u].x,s[u].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var u=this.getCenterPoint(),h=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return s.translate(u.x,u.y),s.scale(1/r[0],1/r[3]),s.rotate(f(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-h.x/2,-h.y/2,h.x,h.y),s.restore(),this},drawBorders:function(s,u){u=u||{};var h=this._calculateCurrentDimensions(),r=this.borderScaleFactor,o=h.x+r,i=h.y+r,l=typeof u.hasControls<"u"?u.hasControls:this.hasControls,d=!1;return s.save(),s.strokeStyle=u.borderColor||this.borderColor,this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeRect(-o/2,-i/2,o,i),l&&(s.beginPath(),this.forEachControl(function(a,g,p){a.withConnection&&a.getVisibility(p,g)&&(d=!0,s.moveTo(a.x*o,a.y*i),s.lineTo(a.x*o+a.offsetX,a.y*i+a.offsetY))}),d&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,u,h){h=h||{};var r=e.util.sizeAfterTransform(this.width,this.height,u),o=this.strokeWidth,i=this.strokeUniform,l=this.borderScaleFactor,d=r.x+o*(i?this.canvas.getZoom():u.scaleX)+l,a=r.y+o*(i?this.canvas.getZoom():u.scaleY)+l;return s.save(),this._setLineDash(s,h.borderDashArray||this.borderDashArray),s.strokeStyle=h.borderColor||this.borderColor,s.strokeRect(-d/2,-a/2,d,a),s.restore(),this},drawControls:function(s,u){u=u||{},s.save();var h=1,r,o;return this.canvas&&(h=this.canvas.getRetinaScaling()),s.setTransform(h,0,0,h,0,0),s.strokeStyle=s.fillStyle=u.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=u.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,u.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(i,l,d){o=d.oCoords[l],i.getVisibility(d,l)&&(r&&(o=e.util.transformPoint(o,r)),i.render(s,o.x,o.y,u,d))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,u){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=u,this},setControlsVisibility:function(s){s||(s={});for(var u in s)this.setControlVisible(u,s[u]);return this},onDeselect:function(){},onSelect:function(){}})}(),e.util.object.extend(e.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(f,s){s=s||{};var u=function(){},h=s.onComplete||u,r=s.onChange||u,o=this;return e.util.animate({target:this,startValue:f.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){f.set("left",i),o.requestRenderAll(),r()},onComplete:function(){f.setCoords(),h()}})},fxCenterObjectV:function(f,s){s=s||{};var u=function(){},h=s.onComplete||u,r=s.onChange||u,o=this;return e.util.animate({target:this,startValue:f.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){f.set("top",i),o.requestRenderAll(),r()},onComplete:function(){f.setCoords(),h()}})},fxRemove:function(f,s){s=s||{};var u=function(){},h=s.onComplete||u,r=s.onChange||u,o=this;return e.util.animate({target:this,startValue:f.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){f.set("opacity",i),o.requestRenderAll(),r()},onComplete:function(){o.remove(f),h()}})}}),e.util.object.extend(e.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var f=[],s,u,h=[];for(s in arguments[0])f.push(s);for(var r=0,o=f.length;r<o;r++)s=f[r],u=r!==o-1,h.push(this._animate(s,arguments[0][s],arguments[1],u));return h}else return this._animate.apply(this,arguments)},_animate:function(f,s,u,h){var r=this,o;s=s.toString(),u?u=e.util.object.clone(u):u={},~f.indexOf(".")&&(o=f.split("."));var i=r.colorProperties.indexOf(f)>-1||o&&r.colorProperties.indexOf(o[1])>-1,l=o?this.get(o[0])[o[1]]:this.get(f);"from"in u||(u.from=l),i||(~s.indexOf("=")?s=l+parseFloat(s.replace("=","")):s=parseFloat(s));var d={target:this,startValue:u.from,endValue:s,byValue:u.by,easing:u.easing,duration:u.duration,abort:u.abort&&function(a,g,p){return u.abort.call(r,a,g,p)},onChange:function(a,g,p){o?r[o[0]][o[1]]=a:r.set(f,a),!h&&u.onChange&&u.onChange(a,g,p)},onComplete:function(a,g,p){h||(r.setCoords(),u.onComplete&&u.onComplete(a,g,p))}};return i?e.util.animateColor(d.startValue,d.endValue,d.duration,d):e.util.animate(d)}}),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend,h=s.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(s.Line){s.warn("fabric.Line is already defined");return}s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,l){i||(i=[0,0,0,0]),this.callSuper("initialize",l),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(l)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,l){return this.callSuper("_set",i,l),typeof r[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var l=this.calcLinePoints();i.moveTo(l.x1,l.y1),i.lineTo(l.x2,l.y2),i.lineWidth=this.strokeWidth;var d=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=d},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return u(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(i.y-=this.strokeWidth),this.height===0&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,l=this.y1<=this.y2?-1:1,d=i*this.width*.5,a=l*this.height*.5,g=i*this.width*-.5,p=l*this.height*-.5;return{x1:d,x2:g,y1:a,y2:p}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(i,l,d){d=d||{};var a=s.parseAttributes(i,s.Line.ATTRIBUTE_NAMES),g=[a.x1||0,a.y1||0,a.x2||0,a.y2||0];l(new s.Line(g,u(a,d)))},s.Line.fromObject=function(i,l){function d(g){delete g.points,l&&l(g)}var a=h(i,!0);a.points=[i.x1,i.y1,i.x2,i.y2],s.Object._fromObject("Line",a,d,"points")};function o(i,l){var d=i.origin,a=i.axis1,g=i.axis2,p=i.dimension,v=l.nearest,x=l.center,C=l.farthest;return function(){switch(this.get(d)){case v:return Math.min(this.get(a),this.get(g));case x:return Math.min(this.get(a),this.get(g))+.5*this.get(p);case C:return Math.max(this.get(a),this.get(g))}}}}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.degreesToRadians;if(s.Circle){s.warn("fabric.Circle is already defined.");return}s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,o){return this.callSuper("_set",r,o),r==="radius"&&this.setRadius(o),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,o=0,i=0,l=(this.endAngle-this.startAngle)%360;if(l===0)r=["<circle ","COMMON_PARTS",'cx="'+o+'" cy="'+i+'" ','r="',this.radius,`" />
`];else{var d=u(this.startAngle),a=u(this.endAngle),g=this.radius,p=s.util.cos(d)*g,v=s.util.sin(d)*g,x=s.util.cos(a)*g,C=s.util.sin(a)*g,S=l>180?"1":"0";r=['<path d="M '+p+" "+v," A "+g+" "+g," 0 ",+S+" 1"," "+x+" "+C,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,u(this.startAngle),u(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(r,o){var i=s.parseAttributes(r,s.Circle.ATTRIBUTE_NAMES);if(!h(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,o(new s.Circle(i))};function h(r){return"radius"in r&&r.radius>=0}s.Circle.fromObject=function(r,o){s.Object._fromObject("Circle",r,o)}}(t),function(f){var s=f.fabric||(f.fabric={});if(s.Triangle){s.warn("fabric.Triangle is already defined");return}s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(u){var h=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-h,r),u.lineTo(0,-r),u.lineTo(h,r),u.closePath(),this._renderPaintInOrder(u)},_toSVG:function(){var u=this.width/2,h=this.height/2,r=[-u+" "+h,"0 "+-h,u+" "+h].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),s.Triangle.fromObject=function(u,h){return s.Object._fromObject("Triangle",u,h)}}(t),function(f){var s=f.fabric||(f.fabric={}),u=Math.PI*2;if(s.Ellipse){s.warn("fabric.Ellipse is already defined.");return}s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this.set("rx",h&&h.rx||0),this.set("ry",h&&h.ry||0)},_set:function(h,r){switch(this.callSuper("_set",h,r),h){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(h){h.beginPath(),h.save(),h.transform(1,0,0,this.ry/this.rx,0,0),h.arc(0,0,this.rx,0,u,!1),h.restore(),this._renderPaintInOrder(h)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(h,r){var o=s.parseAttributes(h,s.Ellipse.ATTRIBUTE_NAMES);o.left=(o.left||0)-o.rx,o.top=(o.top||0)-o.ry,r(new s.Ellipse(o))},s.Ellipse.fromObject=function(h,r){s.Object._fromObject("Ellipse",h,r)}}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend;if(s.Rect){s.warn("fabric.Rect is already defined");return}s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(h){var r=this.rx?Math.min(this.rx,this.width/2):0,o=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,l=this.height,d=-this.width/2,a=-this.height/2,g=r!==0||o!==0,p=1-.5522847498;h.beginPath(),h.moveTo(d+r,a),h.lineTo(d+i-r,a),g&&h.bezierCurveTo(d+i-p*r,a,d+i,a+p*o,d+i,a+o),h.lineTo(d+i,a+l-o),g&&h.bezierCurveTo(d+i,a+l-p*o,d+i-p*r,a+l,d+i-r,a+l),h.lineTo(d+r,a+l),g&&h.bezierCurveTo(d+p*r,a+l,d,a+l-p*o,d,a+l-o),h.lineTo(d,a+o),g&&h.bezierCurveTo(d,a+p*o,d+p*r,a,d+r,a),h.closePath(),this._renderPaintInOrder(h)},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){var h=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',h,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(h,r,o){if(!h)return r(null);o=o||{};var i=s.parseAttributes(h,s.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var l=new s.Rect(u(o?s.util.object.clone(o):{},i));l.visible=l.visible&&l.width>0&&l.height>0,r(l)},s.Rect.fromObject=function(h,r){return s.Object._fromObject("Rect",h,r)}}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend,h=s.util.array.min,r=s.util.array.max,o=s.util.toFixed,i=s.util.projectStrokeOnPoints;if(s.Polyline){s.warn("fabric.Polyline is already defined");return}s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(l,d){d=d||{},this.points=l||[],this.callSuper("initialize",d),this._setPositionDimensions(d)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(l){var d=this._calcDimensions(l),a,g=this.exactBoundingBox?this.strokeWidth:0;this.width=d.width-g,this.height=d.height-g,l.fromSVG||(a=this.translateToGivenOrigin({x:d.left-this.strokeWidth/2+g/2,y:d.top-this.strokeWidth/2+g/2},"left","top",this.originX,this.originY)),typeof l.left>"u"&&(this.left=l.fromSVG?d.left:a.x),typeof l.top>"u"&&(this.top=l.fromSVG?d.top:a.y),this.pathOffset={x:d.left+this.width/2+g/2,y:d.top+this.height/2+g/2}},_calcDimensions:function(){var l=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,d=h(l,"x")||0,a=h(l,"y")||0,g=r(l,"x")||0,p=r(l,"y")||0,v=g-d,x=p-a;return{left:d,top:a,width:v,height:x}},toObject:function(l){return u(this.callSuper("toObject",l),{points:this.points.concat()})},_toSVG:function(){for(var l=[],d=this.pathOffset.x,a=this.pathOffset.y,g=s.Object.NUM_FRACTION_DIGITS,p=0,v=this.points.length;p<v;p++)l.push(o(this.points[p].x-d,g),",",o(this.points[p].y-a,g)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',l.join(""),`" />
`]},commonRender:function(l){var d,a=this.points.length,g=this.pathOffset.x,p=this.pathOffset.y;if(!a||isNaN(this.points[a-1].y))return!1;l.beginPath(),l.moveTo(this.points[0].x-g,this.points[0].y-p);for(var v=0;v<a;v++)d=this.points[v],l.lineTo(d.x-g,d.y-p);return!0},_render:function(l){this.commonRender(l)&&this._renderPaintInOrder(l)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(l){return function(d,a,g){if(!d)return a(null);g||(g={});var p=s.parsePointsAttribute(d.getAttribute("points")),v=s.parseAttributes(d,s[l].ATTRIBUTE_NAMES);v.fromSVG=!0,a(new s[l](p,u(v,g)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(l,d){return s.Object._fromObject("Polyline",l,d,"points")}}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.projectStrokeOnPoints;if(s.Polygon){s.warn("fabric.Polygon is already defined");return}s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return u(this.points,this)},_render:function(h){this.commonRender(h)&&(h.closePath(),this._renderPaintInOrder(h))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(h,r){s.Object._fromObject("Polygon",h,r,"points")}}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.array.min,h=s.util.array.max,r=s.util.object.extend,o=s.util.object.clone,i=s.util.toFixed;if(s.Path){s.warn("fabric.Path is already defined");return}s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(l,d){d=o(d||{}),delete d.path,this.callSuper("initialize",d),this._setPath(l||[],d)},_setPath:function(l,d){this.path=s.util.makePathSimpler(Array.isArray(l)?l:s.util.parsePath(l)),s.Polyline.prototype._setPositionDimensions.call(this,d||{})},_renderPathCommands:function(l){var d,a=0,g=0,p=0,v=0,x=0,C=0,S=-this.pathOffset.x,T=-this.pathOffset.y;l.beginPath();for(var P=0,R=this.path.length;P<R;++P)switch(d=this.path[P],d[0]){case"L":p=d[1],v=d[2],l.lineTo(p+S,v+T);break;case"M":p=d[1],v=d[2],a=p,g=v,l.moveTo(p+S,v+T);break;case"C":p=d[5],v=d[6],x=d[3],C=d[4],l.bezierCurveTo(d[1]+S,d[2]+T,x+S,C+T,p+S,v+T);break;case"Q":l.quadraticCurveTo(d[1]+S,d[2]+T,d[3]+S,d[4]+T),p=d[3],v=d[4],x=d[1],C=d[2];break;case"z":case"Z":p=a,v=g,l.closePath();break}},_render:function(l){this._renderPathCommands(l),this._renderPaintInOrder(l)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(l){return r(this.callSuper("toObject",l),{path:this.path.map(function(d){return d.slice()})})},toDatalessObject:function(l){var d=this.toObject(["sourcePath"].concat(l));return d.sourcePath&&delete d.path,d},_toSVG:function(){var l=s.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',l,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var l=s.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,l)+", "+i(-this.pathOffset.y,l)+")"},toClipPathSVG:function(l){var d=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:l,additionalTransform:d})},toSVG:function(l){var d=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,additionalTransform:d})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var l=[],d=[],a,g=0,p=0,v=0,x=0,C,S=0,T=this.path.length;S<T;++S){switch(a=this.path[S],a[0]){case"L":v=a[1],x=a[2],C=[];break;case"M":v=a[1],x=a[2],g=v,p=x,C=[];break;case"C":C=s.util.getBoundsOfCurve(v,x,a[1],a[2],a[3],a[4],a[5],a[6]),v=a[5],x=a[6];break;case"Q":C=s.util.getBoundsOfCurve(v,x,a[1],a[2],a[1],a[2],a[3],a[4]),v=a[3],x=a[4];break;case"z":case"Z":v=g,x=p;break}C.forEach(function(te){l.push(te.x),d.push(te.y)}),l.push(v),d.push(x)}var P=u(l)||0,R=u(d)||0,z=h(l)||0,J=h(d)||0,ne=z-P,ie=J-R;return{left:P,top:R,width:ne,height:ie}}}),s.Path.fromObject=function(l,d){if(typeof l.sourcePath=="string"){var a=l.sourcePath;s.loadSVGFromURL(a,function(g){var p=g[0];p.setOptions(l),l.clipPath?s.util.enlivenObjects([l.clipPath],function(v){p.clipPath=v[0],d&&d(p)}):d&&d(p)})}else s.Object._fromObject("Path",l,d,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(l,d,a){var g=s.parseAttributes(l,s.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,d(new s.Path(g.d,r(g,a)))}}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.array.min,h=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,o,i){o=o||{},this._objects=[],i&&this.callSuper("initialize",o),this._objects=r||[];for(var l=this._objects.length;l--;)this._objects[l].group=this;if(i)this._updateObjectsACoords();else{var d=o&&o.centerPoint;o.originX!==void 0&&(this.originX=o.originX),o.originY!==void 0&&(this.originY=o.originY),d||this._calcBounds(),this._updateObjectsCoords(d),delete o.centerPoint,this.callSuper("initialize",o)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,o=this._objects.length;o--;)this._objects[o].setCoords(r)},_updateObjectsCoords:function(o){for(var o=o||this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],o)},_updateObjectCoords:function(r,o){var i=r.left,l=r.top,d=!0;r.set({left:i-o.x,top:l-o.y}),r.group=this,r.setCoords(d)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var o=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),r&&(o&&s.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,o?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,o){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(r,o);if(r==="canvas")for(;i--;)this._objects[i]._set(r,o);s.Object.prototype._set.call(this,r,o)},toObject:function(r){var o=this.includeDefaultValues,i=this._objects.filter(function(d){return!d.excludeFromExport}).map(function(d){var a=d.includeDefaultValues;d.includeDefaultValues=o;var g=d.toObject(r);return d.includeDefaultValues=a,g}),l=s.Object.prototype.toObject.call(this,r);return l.objects=i,l},toDatalessObject:function(r){var o,i=this.sourcePath;if(i)o=i;else{var l=this.includeDefaultValues;o=this._objects.map(function(a){var g=a.includeDefaultValues;a.includeDefaultValues=l;var p=a.toDatalessObject(r);return a.includeDefaultValues=g,p})}var d=s.Object.prototype.toDatalessObject.call(this,r);return d.objects=o,d},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=s.Object.prototype.shouldCache.call(this);if(r){for(var o=0,i=this._objects.length;o<i;o++)if(this._objects[o].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,o=this._objects.length;r<o;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var o=0,i=this._objects.length;o<i;o++)this._objects[o].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var o=0,i=this._objects.length;o<i;o++)if(this._objects[o].isCacheDirty(!0)){if(this._cacheCanvas){var l=this.cacheWidth/this.zoomX,d=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-l/2,-d/2,l,d)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(o){s.util.addTransformToObject(o,r),delete o.group,o.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,o=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var l=new s.ActiveSelection([]);return l.set(i),l.type="activeSelection",o.remove(this),r.forEach(function(d){d.group=l,d.dirty=!0,o.add(d)}),l.canvas=o,l._objects=r,o._activeObject=l,l.setCoords(),l}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(o){o.setCoords(r)}),this},_calcBounds:function(r){for(var o=[],i=[],l,d,a,g=["tr","br","bl","tl"],p=0,v=this._objects.length,x,C=g.length;p<v;++p){for(l=this._objects[p],a=l.calcACoords(),x=0;x<C;x++)d=g[x],o.push(a[d].x),i.push(a[d].y);l.aCoords=a}this._getBounds(o,i,r)},_getBounds:function(r,o,i){var l=new s.Point(u(r),u(o)),d=new s.Point(h(r),h(o)),a=l.y||0,g=l.x||0,p=d.x-l.x||0,v=d.y-l.y||0;this.width=p,this.height=v,i||this.setPositionByOrigin({x:g,y:a},"left","top")},_toSVG:function(r){for(var o=["<g ","COMMON_PARTS",` >
`],i=0,l=this._objects.length;i<l;i++)o.push("		",this._objects[i].toSVG(r));return o.push(`</g>
`),o},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",o=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),o].join("")},toClipPathSVG:function(r){for(var o=[],i=0,l=this._objects.length;i<l;i++)o.push("	",this._objects[i].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(o,{reviver:r})}}),s.Group.fromObject=function(r,o){var i=r.objects,l=s.util.object.clone(r,!0);if(delete l.objects,typeof i=="string"){s.loadSVGFromURL(i,function(d){var a=s.util.groupSVGElements(d,r,i),g=l.clipPath;delete l.clipPath,a.set(l),g?s.util.enlivenObjects([g],function(p){a.clipPath=p[0],o&&o(a)}):o&&o(a)});return}s.util.enlivenObjects(i,function(d){s.util.enlivenObjectEnlivables(r,l,function(){o&&o(new s.Group(d,l,!0))})})})}(t),function(f){var s=f.fabric||(f.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(u,h){h=h||{},this._objects=u||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;h.originX&&(this.originX=h.originX),h.originY&&(this.originY=h.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,h),this.setCoords()},toGroup:function(){var u=this._objects.concat();this._objects=[];var h=s.Object.prototype.toObject.call(this),r=new s.Group([]);if(delete h.type,r.set(h),u.forEach(function(i){i.canvas.remove(i),i.group=r}),r._objects=u,!this.canvas)return r;var o=this.canvas;return o.add(r),o._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(u,h,r){u.save(),u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var o=0,i=this._objects.length;o<i;o++)this._objects[o]._renderControls(u,r);this.callSuper("_renderControls",u,h),u.restore()}}),s.ActiveSelection.fromObject=function(u,h){s.util.enlivenObjects(u.objects,function(r){delete u.objects,h&&h(new s.ActiveSelection(r,u,!0))})})}(t),function(f){var s=e.util.object.extend;if(f.fabric||(f.fabric={}),f.fabric.Image){e.warn("fabric.Image is already defined.");return}e.Image=e.util.createClass(e.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:e.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:e.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(u,h){h||(h={}),this.filters=[],this.cacheKey="texture"+e.Object.__uid++,this.callSuper("initialize",h),this._initElement(u,h)},getElement:function(){return this._element||{}},setElement:function(u,h){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=u,this._originalElement=u,this._initConfig(h),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(u){var h=e.filterBackend;h&&h.evictCachesForKey&&h.evictCachesForKey(u)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(u){e.util.cleanUpJsdomNode(this[u]),this[u]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var u=this.getElement();return{width:u.naturalWidth||u.width,height:u.naturalHeight||u.height}},_stroke:function(u){if(!(!this.stroke||this.strokeWidth===0)){var h=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-h,-r),u.lineTo(h,-r),u.lineTo(h,r),u.lineTo(-h,r),u.lineTo(-h,-r),u.closePath()}},toObject:function(u){var h=[];this.filters.forEach(function(o){o&&h.push(o.toObject())});var r=s(this.callSuper("toObject",["cropX","cropY"].concat(u)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:h});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var u=[],h=[],r,o=this._element,i=-this.width/2,l=-this.height/2,d="",a="";if(!o)return[];if(this.hasCrop()){var g=e.Object.__uid++;u.push('<clipPath id="imageCrop_'+g+`">
`,'	<rect x="'+i+'" y="'+l+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),d=' clip-path="url(#imageCrop_'+g+')" '}if(this.imageSmoothing||(a='" image-rendering="optimizeSpeed'),h.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',l-this.cropY,'" width="',o.width||o.naturalWidth,'" height="',o.height||o.height,a,'"',d,`></image>
`),this.stroke||this.strokeDashArray){var p=this.fill;this.fill=null,r=["	<rect ",'x="',i,'" y="',l,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=p}return this.paintFirst!=="fill"?u=u.concat(r,h):u=u.concat(h,r),u},getSrc:function(u){var h=u?this._element:this._originalElement;return h?h.toDataURL?h.toDataURL():this.srcFromAttribute?h.getAttribute("src"):h.src:this.src||""},setSrc:function(u,h,r){return e.util.loadImage(u,function(o,i){this.setElement(o,r),this._setWidthHeight(),h&&h(this,i)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var u=this.resizeFilter,h=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),o=r.scaleX,i=r.scaleY,l=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!u||o>h&&i>h){this._element=l,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=o,this._lastScaleY=i;return}e.filterBackend||(e.filterBackend=e.initFilterBackend());var d=e.util.createCanvasElement(),a=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,g=l.width,p=l.height;d.width=g,d.height=p,this._element=d,this._lastScaleX=u.scaleX=o,this._lastScaleY=u.scaleY=i,e.filterBackend.applyFilters([u],l,g,p,this._element,a),this._filterScalingX=d.width/this._originalElement.width,this._filterScalingY=d.height/this._originalElement.height},applyFilters:function(u){if(u=u||this.filters||[],u=u.filter(function(l){return l&&!l.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),u.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var h=this._originalElement,r=h.naturalWidth||h.width,o=h.naturalHeight||h.height;if(this._element===this._originalElement){var i=e.util.createCanvasElement();i.width=r,i.height=o,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,o),this._lastScaleX=1,this._lastScaleY=1;return e.filterBackend||(e.filterBackend=e.initFilterBackend()),e.filterBackend.applyFilters(u,this._originalElement,r,o,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(u),this._renderPaintInOrder(u)},drawCacheOnCanvas:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),e.Object.prototype.drawCacheOnCanvas.call(this,u)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(u){var h=this._element;if(h){var r=this._filterScalingX,o=this._filterScalingY,i=this.width,l=this.height,d=Math.min,a=Math.max,g=a(this.cropX,0),p=a(this.cropY,0),v=h.naturalWidth||h.width,x=h.naturalHeight||h.height,C=g*r,S=p*o,T=d(i*r,v-C),P=d(l*o,x-S),R=-i/2,z=-l/2,J=d(i,v/r-g),ne=d(l,x/o-p);h&&u.drawImage(h,C,S,T,P,R,z,J,ne)}},_needsResize:function(){var u=this.getTotalObjectScaling();return u.scaleX!==this._lastScaleX||u.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(u,h){this.setElement(e.util.getById(u),h),e.util.addClass(this.getElement(),e.Image.CSS_CANVAS)},_initConfig:function(u){u||(u={}),this.setOptions(u),this._setWidthHeight(u)},_initFilters:function(u,h){u&&u.length?e.util.enlivenObjects(u,function(r){h&&h(r)},"fabric.Image.filters"):h&&h()},_setWidthHeight:function(u){u||(u={});var h=this.getElement();this.width=u.width||h.naturalWidth||h.width||0,this.height=u.height||h.naturalHeight||h.height||0},parsePreserveAspectRatioAttribute:function(){var u=e.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),h=this._element.width,r=this._element.height,o=1,i=1,l=0,d=0,a=0,g=0,p,v=this.width,x=this.height,C={width:v,height:x};return u&&(u.alignX!=="none"||u.alignY!=="none")?(u.meetOrSlice==="meet"&&(o=i=e.util.findScaleToFit(this._element,C),p=(v-h*o)/2,u.alignX==="Min"&&(l=-p),u.alignX==="Max"&&(l=p),p=(x-r*i)/2,u.alignY==="Min"&&(d=-p),u.alignY==="Max"&&(d=p)),u.meetOrSlice==="slice"&&(o=i=e.util.findScaleToCover(this._element,C),p=h-v/o,u.alignX==="Mid"&&(a=p/2),u.alignX==="Max"&&(a=p),p=r-x/i,u.alignY==="Mid"&&(g=p/2),u.alignY==="Max"&&(g=p),h=v/o,r=x/i)):(o=v/h,i=x/r),{width:h,height:r,scaleX:o,scaleY:i,offsetLeft:l,offsetTop:d,cropX:a,cropY:g}}}),e.Image.CSS_CANVAS="canvas-img",e.Image.prototype.getSvgSrc=e.Image.prototype.getSrc,e.Image.fromObject=function(u,h){var r=e.util.object.clone(u);e.util.loadImage(r.src,function(o,i){if(i){h&&h(null,!0);return}e.Image.prototype._initFilters.call(r,r.filters,function(l){r.filters=l||[],e.Image.prototype._initFilters.call(r,[r.resizeFilter],function(d){r.resizeFilter=d[0],e.util.enlivenObjectEnlivables(r,r,function(){var a=new e.Image(o,r);h(a,!1)})})})},null,r.crossOrigin)},e.Image.fromURL=function(u,h,r){e.util.loadImage(u,function(o,i){h&&h(new e.Image(o,r),i)},null,r&&r.crossOrigin)},e.Image.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),e.Image.fromElement=function(u,h,r){var o=e.parseAttributes(u,e.Image.ATTRIBUTE_NAMES);e.Image.fromURL(o["xlink:href"],h,s(r?e.util.object.clone(r):{},o))}}(t),e.util.object.extend(e.Object.prototype,{_getAngleValueForStraighten:function(){var f=this.angle%360;return f>0?Math.round((f-1)/90)*90:Math.round(f/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(f){f=f||{};var s=function(){},u=f.onComplete||s,h=f.onChange||s,r=this;return e.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(o){r.rotate(o),h()},onComplete:function(){r.setCoords(),u()}})}}),e.util.object.extend(e.StaticCanvas.prototype,{straightenObject:function(f){return f.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(f){return f.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function f(u,h){var r="precision "+h+` float;
void main(){}`,o=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(o,r),u.compileShader(o),!!u.getShaderParameter(o,u.COMPILE_STATUS)}e.isWebglSupported=function(u){if(e.isLikelyNode)return!1;u=u||e.WebglFilterBackend.prototype.tileSize;var h=document.createElement("canvas"),r=h.getContext("webgl")||h.getContext("experimental-webgl"),o=!1;if(r){e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),o=e.maxTextureSize>=u;for(var i=["highp","mediump","lowp"],l=0;l<3;l++)if(f(r,i[l])){e.webGlPrecision=i[l];break}}return this.isSupported=o,o},e.WebglFilterBackend=s;function s(u){u&&u.tileSize&&(this.tileSize=u.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}s.prototype={tileSize:2048,resources:{},setupGLContext:function(u,h){this.dispose(),this.createWebGLCanvas(u,h),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(u,h)},chooseFastestCopyGLTo2DMethod:function(u,h){var r=typeof window.performance<"u",o;try{new ImageData(1,1),o=!0}catch{o=!1}var i=typeof ArrayBuffer<"u",l=typeof Uint8ClampedArray<"u";if(r&&o&&i&&l){var d=e.util.createCanvasElement(),a=new ArrayBuffer(u*h*4);if(e.forceGLPutImageData){this.imageBuffer=a,this.copyGLTo2D=w;return}var g={imageBuffer:a,destinationWidth:u,destinationHeight:h,targetCanvas:d},p,v,x;d.width=u,d.height=h,p=window.performance.now(),y.call(g,this.gl,g),v=window.performance.now()-p,p=window.performance.now(),w.call(g,this.gl,g),x=window.performance.now()-p,v>x?(this.imageBuffer=a,this.copyGLTo2D=w):this.copyGLTo2D=y}},createWebGLCanvas:function(u,h){var r=e.util.createCanvasElement();r.width=u,r.height=h;var o={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=r.getContext("webgl",o);i||(i=r.getContext("experimental-webgl",o)),i&&(i.clearColor(0,0,0,0),this.canvas=r,this.gl=i)},applyFilters:function(u,h,r,o,i,l){var d=this.gl,a;l&&(a=this.getCachedTexture(l,h));var g={originalWidth:h.width||h.originalWidth,originalHeight:h.height||h.originalHeight,sourceWidth:r,sourceHeight:o,destinationWidth:r,destinationHeight:o,context:d,sourceTexture:this.createTexture(d,r,o,!a&&h),targetTexture:this.createTexture(d,r,o),originalTexture:a||this.createTexture(d,r,o,!a&&h),passes:u.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},p=d.createFramebuffer();return d.bindFramebuffer(d.FRAMEBUFFER,p),u.forEach(function(v){v&&v.applyTo(g)}),m(g),this.copyGLTo2D(d,g),d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(g.sourceTexture),d.deleteTexture(g.targetTexture),d.deleteFramebuffer(p),i.getContext("2d").setTransform(1,0,0,1,0,0),g},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(u,h,r,o,i){var l=u.createTexture();return u.bindTexture(u.TEXTURE_2D,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),o?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,o):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,h,r,0,u.RGBA,u.UNSIGNED_BYTE,null),l},getCachedTexture:function(u,h){if(this.textureCache[u])return this.textureCache[u];var r=this.createTexture(this.gl,h.width,h.height,h);return this.textureCache[u]=r,r},evictCachesForKey:function(u){this.textureCache[u]&&(this.gl.deleteTexture(this.textureCache[u]),delete this.textureCache[u])},copyGLTo2D:y,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var u=this.gl,h={renderer:"",vendor:""};if(!u)return h;var r=u.getExtension("WEBGL_debug_renderer_info");if(r){var o=u.getParameter(r.UNMASKED_RENDERER_WEBGL),i=u.getParameter(r.UNMASKED_VENDOR_WEBGL);o&&(h.renderer=o.toLowerCase()),i&&(h.vendor=i.toLowerCase())}return this.gpuInfo=h,h}}}();function m(f){var s=f.targetCanvas,u=s.width,h=s.height,r=f.destinationWidth,o=f.destinationHeight;(u!==r||h!==o)&&(s.width=r,s.height=o)}function y(f,s){var u=f.canvas,h=s.targetCanvas,r=h.getContext("2d");r.translate(0,h.height),r.scale(1,-1);var o=u.height-h.height;r.drawImage(u,0,o,h.width,h.height,0,0,h.width,h.height)}function w(f,s){var u=s.targetCanvas,h=u.getContext("2d"),r=s.destinationWidth,o=s.destinationHeight,i=r*o*4,l=new Uint8Array(this.imageBuffer,0,i),d=new Uint8ClampedArray(this.imageBuffer,0,i);f.readPixels(0,0,r,o,f.RGBA,f.UNSIGNED_BYTE,l);var a=new ImageData(d,r,o);h.putImageData(a,0,0)}(function(){var f=function(){};e.Canvas2dFilterBackend=s;function s(){}s.prototype={evictCachesForKey:f,dispose:f,clearWebGLCaches:f,resources:{},applyFilters:function(u,h,r,o,i){var l=i.getContext("2d");l.drawImage(h,0,0,r,o);var d=l.getImageData(0,0,r,o),a=l.getImageData(0,0,r,o),g={sourceWidth:r,sourceHeight:o,imageData:d,originalEl:h,originalImageData:a,canvasEl:i,ctx:l,filterBackend:this};return u.forEach(function(p){p.applyTo(g)}),(g.imageData.width!==r||g.imageData.height!==o)&&(i.width=g.imageData.width,i.height=g.imageData.height),l.putImageData(g.imageData,0,0),g}}})(),e.Image=e.Image||{},e.Image.filters=e.Image.filters||{},e.Image.filters.BaseFilter=e.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(f){f&&this.setOptions(f)},setOptions:function(f){for(var s in f)this[s]=f[s]},createProgram:function(f,s,u){s=s||this.fragmentSource,u=u||this.vertexSource,e.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+e.webGlPrecision+" float"));var h=f.createShader(f.VERTEX_SHADER);if(f.shaderSource(h,u),f.compileShader(h),!f.getShaderParameter(h,f.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+f.getShaderInfoLog(h));var r=f.createShader(f.FRAGMENT_SHADER);if(f.shaderSource(r,s),f.compileShader(r),!f.getShaderParameter(r,f.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+f.getShaderInfoLog(r));var o=f.createProgram();if(f.attachShader(o,h),f.attachShader(o,r),f.linkProgram(o),!f.getProgramParameter(o,f.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+f.getProgramInfoLog(o));var i=this.getAttributeLocations(f,o),l=this.getUniformLocations(f,o)||{};return l.uStepW=f.getUniformLocation(o,"uStepW"),l.uStepH=f.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:i,uniformLocations:l}},getAttributeLocations:function(f,s){return{aPosition:f.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(f,s,u){var h=s.aPosition,r=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,r),f.enableVertexAttribArray(h),f.vertexAttribPointer(h,2,f.FLOAT,!1,0,0),f.bufferData(f.ARRAY_BUFFER,u,f.STATIC_DRAW)},_setupFrameBuffer:function(f){var s=f.context,u,h;f.passes>1?(u=f.destinationWidth,h=f.destinationHeight,(f.sourceWidth!==u||f.sourceHeight!==h)&&(s.deleteTexture(f.targetTexture),f.targetTexture=f.filterBackend.createTexture(s,u,h)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,f.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(f){f.passes--,f.pass++;var s=f.targetTexture;f.targetTexture=f.sourceTexture,f.sourceTexture=s},isNeutralState:function(){var f=this.mainParameter,s=e.Image.filters[this.type].prototype;if(f)if(Array.isArray(s[f])){for(var u=s[f].length;u--;)if(this[f][u]!==s[f][u])return!1;return!0}else return s[f]===this[f];else return!1},applyTo:function(f){f.webgl?(this._setupFrameBuffer(f),this.applyToWebGL(f),this._swapTextures(f)):this.applyTo2d(f)},retrieveShader:function(f){return f.programCache.hasOwnProperty(this.type)||(f.programCache[this.type]=this.createProgram(f.context)),f.programCache[this.type]},applyToWebGL:function(f){var s=f.context,u=this.retrieveShader(f);f.pass===0&&f.originalTexture?s.bindTexture(s.TEXTURE_2D,f.originalTexture):s.bindTexture(s.TEXTURE_2D,f.sourceTexture),s.useProgram(u.program),this.sendAttributeData(s,u.attributeLocations,f.aPosition),s.uniform1f(u.uniformLocations.uStepW,1/f.sourceWidth),s.uniform1f(u.uniformLocations.uStepH,1/f.sourceHeight),this.sendUniformData(s,u.uniformLocations),s.viewport(0,0,f.destinationWidth,f.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(f,s,u){f.activeTexture(u),f.bindTexture(f.TEXTURE_2D,s),f.activeTexture(f.TEXTURE0)},unbindAdditionalTexture:function(f,s){f.activeTexture(s),f.bindTexture(f.TEXTURE_2D,null),f.activeTexture(f.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(f){this[this.mainParameter]=f},sendUniformData:function(){},createHelpLayer:function(f){if(!f.helpLayer){var s=document.createElement("canvas");s.width=f.sourceWidth,s.height=f.sourceHeight,f.helpLayer=s}},toObject:function(){var f={type:this.type},s=this.mainParameter;return s&&(f[s]=this[s]),f},toJSON:function(){return this.toObject()}}),e.Image.filters.BaseFilter.fromObject=function(f,s){var u=new e.Image.filters[f.type](f);return s&&s(u),u},function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.ColorMatrix=h(u.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var o=r.imageData,i=o.data,l=i.length,d=this.matrix,a,g,p,v,x,C=this.colorsOnly;for(x=0;x<l;x+=4)a=i[x],g=i[x+1],p=i[x+2],C?(i[x]=a*d[0]+g*d[1]+p*d[2]+d[4]*255,i[x+1]=a*d[5]+g*d[6]+p*d[7]+d[9]*255,i[x+2]=a*d[10]+g*d[11]+p*d[12]+d[14]*255):(v=i[x+3],i[x]=a*d[0]+g*d[1]+p*d[2]+v*d[3]+d[4]*255,i[x+1]=a*d[5]+g*d[6]+p*d[7]+v*d[8]+d[9]*255,i[x+2]=a*d[10]+g*d[11]+p*d[12]+v*d[13]+d[14]*255,i[x+3]=a*d[15]+g*d[16]+p*d[17]+v*d[18]+d[19]*255)},getUniformLocations:function(r,o){return{uColorMatrix:r.getUniformLocation(o,"uColorMatrix"),uConstants:r.getUniformLocation(o,"uConstants")}},sendUniformData:function(r,o){var i=this.matrix,l=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],d=[i[4],i[9],i[14],i[19]];r.uniformMatrix4fv(o.uColorMatrix,!1,l),r.uniform4fv(o.uConstants,d)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Brightness=h(u.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var o=r.imageData,i=o.data,l,d=i.length,a=Math.round(this.brightness*255);for(l=0;l<d;l+=4)i[l]=i[l]+a,i[l+1]=i[l+1]+a,i[l+2]=i[l+2]+a}},getUniformLocations:function(r,o){return{uBrightness:r.getUniformLocation(o,"uBrightness")}},sendUniformData:function(r,o){r.uniform1f(o.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend,h=s.Image.filters,r=s.util.createClass;h.Convolute=r(h.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(o){var i=Math.sqrt(this.matrix.length),l=this.type+"_"+i+"_"+(this.opaque?1:0),d=this.fragmentSource[l];return o.programCache.hasOwnProperty(l)||(o.programCache[l]=this.createProgram(o.context,d)),o.programCache[l]},applyTo2d:function(o){var i=o.imageData,l=i.data,d=this.matrix,a=Math.round(Math.sqrt(d.length)),g=Math.floor(a/2),p=i.width,v=i.height,x=o.ctx.createImageData(p,v),C=x.data,S=this.opaque?1:0,T,P,R,z,J,ne,ie,te,re,oe,le,V,_;for(le=0;le<v;le++)for(oe=0;oe<p;oe++){for(J=(le*p+oe)*4,T=0,P=0,R=0,z=0,_=0;_<a;_++)for(V=0;V<a;V++)ie=le+_-g,ne=oe+V-g,!(ie<0||ie>=v||ne<0||ne>=p)&&(te=(ie*p+ne)*4,re=d[_*a+V],T+=l[te]*re,P+=l[te+1]*re,R+=l[te+2]*re,S||(z+=l[te+3]*re));C[J]=T,C[J+1]=P,C[J+2]=R,S?C[J+3]=l[J+3]:C[J+3]=z}o.imageData=x},getUniformLocations:function(o,i){return{uMatrix:o.getUniformLocation(i,"uMatrix"),uOpaque:o.getUniformLocation(i,"uOpaque"),uHalfSize:o.getUniformLocation(i,"uHalfSize"),uSize:o.getUniformLocation(i,"uSize")}},sendUniformData:function(o,i){o.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return u(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Grayscale=h(u.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var o=r.imageData,i=o.data,l,d=i.length,a,g=this.mode;for(l=0;l<d;l+=4)g==="average"?a=(i[l]+i[l+1]+i[l+2])/3:g==="lightness"?a=(Math.min(i[l],i[l+1],i[l+2])+Math.max(i[l],i[l+1],i[l+2]))/2:g==="luminosity"&&(a=.21*i[l]+.72*i[l+1]+.07*i[l+2]),i[l]=a,i[l+1]=a,i[l+2]=a},retrieveShader:function(r){var o=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(o)){var i=this.fragmentSource[this.mode];r.programCache[o]=this.createProgram(r.context,i)}return r.programCache[o]},getUniformLocations:function(r,o){return{uMode:r.getUniformLocation(o,"uMode")}},sendUniformData:function(r,o){var i=1;r.uniform1i(o.uMode,i)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Invert=h(u.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var o=r.imageData,i=o.data,l,d=i.length;for(l=0;l<d;l+=4)i[l]=255-i[l],i[l+1]=255-i[l+1],i[l+2]=255-i[l+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,o){return{uInvert:r.getUniformLocation(o,"uInvert")}},sendUniformData:function(r,o){r.uniform1i(o.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend,h=s.Image.filters,r=s.util.createClass;h.Noise=r(h.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(o){if(this.noise!==0){var i=o.imageData,l=i.data,d,a=l.length,g=this.noise,p;for(d=0,a=l.length;d<a;d+=4)p=(.5-Math.random())*g,l[d]+=p,l[d+1]+=p,l[d+2]+=p}},getUniformLocations:function(o,i){return{uNoise:o.getUniformLocation(i,"uNoise"),uSeed:o.getUniformLocation(i,"uSeed")}},sendUniformData:function(o,i){o.uniform1f(i.uNoise,this.noise/255),o.uniform1f(i.uSeed,Math.random())},toObject:function(){return u(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Pixelate=h(u.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var o=r.imageData,i=o.data,l=o.height,d=o.width,a,g,p,v,x,C,S,T,P,R,z;for(g=0;g<l;g+=this.blocksize)for(p=0;p<d;p+=this.blocksize)for(a=g*4*d+p*4,v=i[a],x=i[a+1],C=i[a+2],S=i[a+3],R=Math.min(g+this.blocksize,l),z=Math.min(p+this.blocksize,d),T=g;T<R;T++)for(P=p;P<z;P++)a=T*4*d+P*4,i[a]=v,i[a+1]=x,i[a+2]=C,i[a+3]=S},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,o){return{uBlocksize:r.getUniformLocation(o,"uBlocksize"),uStepW:r.getUniformLocation(o,"uStepW"),uStepH:r.getUniformLocation(o,"uStepH")}},sendUniformData:function(r,o){r.uniform1f(o.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.extend,h=s.Image.filters,r=s.util.createClass;h.RemoveColor=r(h.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(o){var i=o.imageData,l=i.data,d,a=this.distance*255,g,p,v,x=new s.Color(this.color).getSource(),C=[x[0]-a,x[1]-a,x[2]-a],S=[x[0]+a,x[1]+a,x[2]+a];for(d=0;d<l.length;d+=4)g=l[d],p=l[d+1],v=l[d+2],g>C[0]&&p>C[1]&&v>C[2]&&g<S[0]&&p<S[1]&&v<S[2]&&(l[d+3]=0)},getUniformLocations:function(o,i){return{uLow:o.getUniformLocation(i,"uLow"),uHigh:o.getUniformLocation(i,"uHigh")}},sendUniformData:function(o,i){var l=new s.Color(this.color).getSource(),d=parseFloat(this.distance),a=[0+l[0]/255-d,0+l[1]/255-d,0+l[2]/255-d,1],g=[l[0]/255+d,l[1]/255+d,l[2]/255+d,1];o.uniform4fv(i.uLow,a),o.uniform4fv(i.uHigh,g)},toObject:function(){return u(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in r)u[o]=h(u.ColorMatrix,{type:o,matrix:r[o],mainParameter:!1,colorsOnly:!0}),s.Image.filters[o].fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric,u=s.Image.filters,h=s.util.createClass;u.BlendColor=h(u.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var o=this.type+"_"+this.mode,i;return r.programCache.hasOwnProperty(o)||(i=this.buildSource(this.mode),r.programCache[o]=this.createProgram(r.context,i)),r.programCache[o]},applyTo2d:function(r){var o=r.imageData,i=o.data,l=i.length,d,a,g,p,v,x,C,S=1-this.alpha;C=new s.Color(this.color).getSource(),d=C[0]*this.alpha,a=C[1]*this.alpha,g=C[2]*this.alpha;for(var T=0;T<l;T+=4)switch(p=i[T],v=i[T+1],x=i[T+2],this.mode){case"multiply":i[T]=p*d/255,i[T+1]=v*a/255,i[T+2]=x*g/255;break;case"screen":i[T]=255-(255-p)*(255-d)/255,i[T+1]=255-(255-v)*(255-a)/255,i[T+2]=255-(255-x)*(255-g)/255;break;case"add":i[T]=p+d,i[T+1]=v+a,i[T+2]=x+g;break;case"diff":case"difference":i[T]=Math.abs(p-d),i[T+1]=Math.abs(v-a),i[T+2]=Math.abs(x-g);break;case"subtract":i[T]=p-d,i[T+1]=v-a,i[T+2]=x-g;break;case"darken":i[T]=Math.min(p,d),i[T+1]=Math.min(v,a),i[T+2]=Math.min(x,g);break;case"lighten":i[T]=Math.max(p,d),i[T+1]=Math.max(v,a),i[T+2]=Math.max(x,g);break;case"overlay":i[T]=d<128?2*p*d/255:255-2*(255-p)*(255-d)/255,i[T+1]=a<128?2*v*a/255:255-2*(255-v)*(255-a)/255,i[T+2]=g<128?2*x*g/255:255-2*(255-x)*(255-g)/255;break;case"exclusion":i[T]=d+p-2*d*p/255,i[T+1]=a+v-2*a*v/255,i[T+2]=g+x-2*g*x/255;break;case"tint":i[T]=d+p*S,i[T+1]=a+v*S,i[T+2]=g+x*S}},getUniformLocations:function(r,o){return{uColor:r.getUniformLocation(o,"uColor")}},sendUniformData:function(r,o){var i=new s.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,r.uniform4fv(o.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric,u=s.Image.filters,h=s.util.createClass;u.BlendImage=h(u.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var o=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(o)||(r.programCache[o]=this.createProgram(r.context,i)),r.programCache[o]},applyToWebGL:function(r){var o=r.context,i=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(o,i,o.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(o,o.TEXTURE1)},createTexture:function(r,o){return r.getCachedTexture(o.cacheKey,o._element)},calculateMatrix:function(){var r=this.image,o=r._element.width,i=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/o,-r.top/i,1]},applyTo2d:function(r){var o=r.imageData,i=r.filterBackend.resources,l=o.data,d=l.length,a=o.width,g=o.height,p,v,x,C,S,T,P,R,z,J,ne=this.image,ie;i.blendImage||(i.blendImage=s.util.createCanvasElement()),z=i.blendImage,J=z.getContext("2d"),z.width!==a||z.height!==g?(z.width=a,z.height=g):J.clearRect(0,0,a,g),J.setTransform(ne.scaleX,0,0,ne.scaleY,ne.left,ne.top),J.drawImage(ne._element,0,0,a,g),ie=J.getImageData(0,0,a,g).data;for(var te=0;te<d;te+=4)switch(S=l[te],T=l[te+1],P=l[te+2],R=l[te+3],p=ie[te],v=ie[te+1],x=ie[te+2],C=ie[te+3],this.mode){case"multiply":l[te]=S*p/255,l[te+1]=T*v/255,l[te+2]=P*x/255,l[te+3]=R*C/255;break;case"mask":l[te+3]=C;break}},getUniformLocations:function(r,o){return{uTransformMatrix:r.getUniformLocation(o,"uTransformMatrix"),uImage:r.getUniformLocation(o,"uImage")}},sendUniformData:function(r,o){var i=this.calculateMatrix();r.uniform1i(o.uImage,1),r.uniformMatrix3fv(o.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(r,o){s.Image.fromObject(r.image,function(i){var l=s.util.object.clone(r);l.image=i,o(new s.Image.filters.BlendImage(l))})}}(t),function(f){var s=f.fabric||(f.fabric={}),u=Math.pow,h=Math.floor,r=Math.sqrt,o=Math.abs,i=Math.round,l=Math.sin,d=Math.ceil,a=s.Image.filters,g=s.util.createClass;a.Resize=g(a.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(p,v){return{uDelta:p.getUniformLocation(v,"uDelta"),uTaps:p.getUniformLocation(v,"uTaps")}},sendUniformData:function(p,v){p.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),p.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(p){var v=this.getFilterWindow(),x=this.type+"_"+v;if(!p.programCache.hasOwnProperty(x)){var C=this.generateShader(v);p.programCache[x]=this.createProgram(p.context,C)}return p.programCache[x]},getFilterWindow:function(){var p=this.tempScale;return Math.ceil(this.lanczosLobes/p)},getTaps:function(){for(var p=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,x=this.getFilterWindow(),C=new Array(x),S=1;S<=x;S++)C[S-1]=p(S*v);return C},generateShader:function(C){for(var v=new Array(C),x=this.fragmentSourceTOP,C,S=1;S<=C;S++)v[S-1]=S+".0 * uDelta";return x+="uniform float uTaps["+C+`];
`,x+=`void main() {
`,x+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,x+=`  float sum = 1.0;
`,v.forEach(function(T,P){x+="  color += texture2D(uTexture, vTexCoord + "+T+") * uTaps["+P+`];
`,x+="  color += texture2D(uTexture, vTexCoord - "+T+") * uTaps["+P+`];
`,x+="  sum += 2.0 * uTaps["+P+`];
`}),x+=`  gl_FragColor = color / sum;
`,x+="}",x},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(p){p.webgl?(p.passes++,this.width=p.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=p.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),p.destinationWidth=this.dW,this._setupFrameBuffer(p),this.applyToWebGL(p),this._swapTextures(p),p.sourceWidth=p.destinationWidth,this.height=p.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),p.destinationHeight=this.dH,this._setupFrameBuffer(p),this.applyToWebGL(p),this._swapTextures(p),p.sourceHeight=p.destinationHeight):this.applyTo2d(p)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(p){return function(v){if(v>=p||v<=-p)return 0;if(v<11920929e-14&&v>-11920929e-14)return 1;v*=Math.PI;var x=v/p;return l(v)/v*l(x)/x}},applyTo2d:function(p){var v=p.imageData,x=this.scaleX,C=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/C;var S=v.width,T=v.height,P=i(S*x),R=i(T*C),z;this.resizeType==="sliceHack"?z=this.sliceByTwo(p,S,T,P,R):this.resizeType==="hermite"?z=this.hermiteFastResize(p,S,T,P,R):this.resizeType==="bilinear"?z=this.bilinearFiltering(p,S,T,P,R):this.resizeType==="lanczos"&&(z=this.lanczosResize(p,S,T,P,R)),p.imageData=z},sliceByTwo:function(p,v,x,C,S){var T=p.imageData,P=.5,R=!1,z=!1,J=v*P,ne=x*P,ie=s.filterBackend.resources,te,re,oe=0,le=0,V=v,_=0;for(ie.sliceByTwo||(ie.sliceByTwo=document.createElement("canvas")),te=ie.sliceByTwo,(te.width<v*1.5||te.height<x)&&(te.width=v*1.5,te.height=x),re=te.getContext("2d"),re.clearRect(0,0,v*1.5,x),re.putImageData(T,0,0),C=h(C),S=h(S);!R||!z;)v=J,x=ne,C<h(J*P)?J=h(J*P):(J=C,R=!0),S<h(ne*P)?ne=h(ne*P):(ne=S,z=!0),re.drawImage(te,oe,le,v,x,V,_,J,ne),oe=V,le=_,_+=ne;return re.getImageData(oe,le,C,S)},lanczosResize:function(p,v,x,C,S){function T(j){var D,X,M,k,L,B,$,E,I,W,q;for(_.x=(j+.5)*ne,O.x=h(_.x),D=0;D<S;D++){for(_.y=(D+.5)*ie,O.y=h(_.y),L=0,B=0,$=0,E=0,I=0,X=O.x-oe;X<=O.x+oe;X++)if(!(X<0||X>=v)){W=h(1e3*o(X-_.x)),V[W]||(V[W]={});for(var U=O.y-le;U<=O.y+le;U++)U<0||U>=x||(q=h(1e3*o(U-_.y)),V[W][q]||(V[W][q]=J(r(u(W*te,2)+u(q*re,2))/1e3)),M=V[W][q],M>0&&(k=(U*v+X)*4,L+=M,B+=M*P[k],$+=M*P[k+1],E+=M*P[k+2],I+=M*P[k+3]))}k=(D*C+j)*4,z[k]=B/L,z[k+1]=$/L,z[k+2]=E/L,z[k+3]=I/L}return++j<C?T(j):R}var P=p.imageData.data,R=p.ctx.createImageData(C,S),z=R.data,J=this.lanczosCreate(this.lanczosLobes),ne=this.rcpScaleX,ie=this.rcpScaleY,te=2/this.rcpScaleX,re=2/this.rcpScaleY,oe=d(ne*this.lanczosLobes/2),le=d(ie*this.lanczosLobes/2),V={},_={},O={};return T(0)},bilinearFiltering:function(p,v,x,C,S){var T,P,R,z,J,ne,ie,te,re,oe,le,V,_=0,O,j=this.rcpScaleX,D=this.rcpScaleY,X=4*(v-1),M=p.imageData,k=M.data,L=p.ctx.createImageData(C,S),B=L.data;for(ie=0;ie<S;ie++)for(te=0;te<C;te++)for(J=h(j*te),ne=h(D*ie),re=j*te-J,oe=D*ie-ne,O=4*(ne*v+J),le=0;le<4;le++)T=k[O+le],P=k[O+4+le],R=k[O+X+le],z=k[O+X+4+le],V=T*(1-re)*(1-oe)+P*re*(1-oe)+R*oe*(1-re)+z*re*oe,B[_++]=V;return L},hermiteFastResize:function(p,v,x,C,S){for(var T=this.rcpScaleX,P=this.rcpScaleY,R=d(T/2),z=d(P/2),J=p.imageData,ne=J.data,ie=p.ctx.createImageData(C,S),te=ie.data,re=0;re<S;re++)for(var oe=0;oe<C;oe++){for(var le=(oe+re*C)*4,V=0,_=0,O=0,j=0,D=0,X=0,M=0,k=(re+.5)*P,L=h(re*P);L<(re+1)*P;L++)for(var B=o(k-(L+.5))/z,$=(oe+.5)*T,E=B*B,I=h(oe*T);I<(oe+1)*T;I++){var W=o($-(I+.5))/R,q=r(E+W*W);q>1&&q<-1||(V=2*q*q*q-3*q*q+1,V>0&&(W=4*(I+L*v),M+=V*ne[W+3],O+=V,ne[W+3]<255&&(V=V*ne[W+3]/250),j+=V*ne[W],D+=V*ne[W+1],X+=V*ne[W+2],_+=V))}te[le]=j/_,te[le+1]=D/_,te[le+2]=X/_,te[le+3]=M/O}return ie},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Contrast=h(u.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var o=r.imageData,i,d,l=o.data,d=l.length,a=Math.floor(this.contrast*255),g=259*(a+255)/(255*(259-a));for(i=0;i<d;i+=4)l[i]=g*(l[i]-128)+128,l[i+1]=g*(l[i+1]-128)+128,l[i+2]=g*(l[i+2]-128)+128}},getUniformLocations:function(r,o){return{uContrast:r.getUniformLocation(o,"uContrast")}},sendUniformData:function(r,o){r.uniform1f(o.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Saturation=h(u.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var o=r.imageData,i=o.data,l=i.length,d=-this.saturation,a,g;for(a=0;a<l;a+=4)g=Math.max(i[a],i[a+1],i[a+2]),i[a]+=g!==i[a]?(g-i[a])*d:0,i[a+1]+=g!==i[a+1]?(g-i[a+1])*d:0,i[a+2]+=g!==i[a+2]?(g-i[a+2])*d:0}},getUniformLocations:function(r,o){return{uSaturation:r.getUniformLocation(o,"uSaturation")}},sendUniformData:function(r,o){r.uniform1f(o.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Vibrance=h(u.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var o=r.imageData,i=o.data,l=i.length,d=-this.vibrance,a,g,p,v;for(a=0;a<l;a+=4)g=Math.max(i[a],i[a+1],i[a+2]),p=(i[a]+i[a+1]+i[a+2])/3,v=Math.abs(g-p)*2/255*d,i[a]+=g!==i[a]?(g-i[a])*v:0,i[a+1]+=g!==i[a+1]?(g-i[a+1])*v:0,i[a+2]+=g!==i[a+2]?(g-i[a+2])*v:0}},getUniformLocations:function(r,o){return{uVibrance:r.getUniformLocation(o,"uVibrance")}},sendUniformData:function(r,o){r.uniform1f(o.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Blur=h(u.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var o=r.filterBackend.resources,i,l,d=r.imageData.width,a=r.imageData.height;o.blurLayer1||(o.blurLayer1=s.util.createCanvasElement(),o.blurLayer2=s.util.createCanvasElement()),i=o.blurLayer1,l=o.blurLayer2,(i.width!==d||i.height!==a)&&(l.width=i.width=d,l.height=i.height=a);var g=i.getContext("2d"),p=l.getContext("2d"),v=15,x,C,S,T,P=this.blur*.06*.5;for(g.putImageData(r.imageData,0,0),p.clearRect(0,0,d,a),T=-v;T<=v;T++)x=(Math.random()-.5)/4,C=T/v,S=P*C*d+x,p.globalAlpha=1-Math.abs(C),p.drawImage(i,S,x),g.drawImage(l,0,0),p.globalAlpha=1,p.clearRect(0,0,l.width,l.height);for(T=-v;T<=v;T++)x=(Math.random()-.5)/4,C=T/v,S=P*C*a+x,p.globalAlpha=1-Math.abs(C),p.drawImage(i,x,S),g.drawImage(l,0,0),p.globalAlpha=1,p.clearRect(0,0,l.width,l.height);r.ctx.drawImage(i,0,0);var R=r.ctx.getImageData(0,0,i.width,i.height);return g.globalAlpha=1,g.clearRect(0,0,i.width,i.height),R},getUniformLocations:function(r,o){return{delta:r.getUniformLocation(o,"uDelta")}},sendUniformData:function(r,o){var i=this.chooseRightDelta();r.uniform2fv(o.delta,i)},chooseRightDelta:function(){var r=1,o=[0,0],i;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),i=r*this.blur*.12,this.horizontal?o[0]=i:o[1]=i,o}}),u.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Gamma=h(u.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],u.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var o=r.imageData,i=o.data,l=this.gamma,d=i.length,a=1/l[0],g=1/l[1],p=1/l[2],v;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,d=256;v<d;v++)this.rVals[v]=Math.pow(v/255,a)*255,this.gVals[v]=Math.pow(v/255,g)*255,this.bVals[v]=Math.pow(v/255,p)*255;for(v=0,d=i.length;v<d;v+=4)i[v]=this.rVals[i[v]],i[v+1]=this.gVals[i[v+1]],i[v+2]=this.bVals[i[v+2]]},getUniformLocations:function(r,o){return{uGamma:r.getUniformLocation(o,"uGamma")}},sendUniformData:function(r,o){r.uniform3fv(o.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Composed=h(u.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(o){o.applyTo(r)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(r,o){var i=r.subFilters||[],l=i.map(function(a){return new s.Image.filters[a.type](a)}),d=new s.Image.filters.Composed({subFilters:l});return o&&o(d),d}}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.Image.filters,h=s.util.createClass;u.HueRotation=h(u.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,o=s.util.cos(r),i=s.util.sin(r),l=1/3,d=Math.sqrt(l)*i,a=1-o;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=o+a/3,this.matrix[1]=l*a-d,this.matrix[2]=l*a+d,this.matrix[5]=l*a+d,this.matrix[6]=o+l*a,this.matrix[7]=l*a-d,this.matrix[10]=l*a-d,this.matrix[11]=l*a+d,this.matrix[12]=o+l*a},isNeutralState:function(r){return this.calculateMatrix(),u.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),u.BaseFilter.prototype.applyTo.call(this,r)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(f){var s=f.fabric||(f.fabric={}),u=s.util.object.clone;if(s.Text){s.warn("fabric.Text is already defined");return}var h="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(h),cacheProperties:s.Object.prototype.cacheProperties.concat(h),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,o){this.styles=o?o.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",o),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=s.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){if(!this.__skipDimension){if(this._splitText(),this._clearCache(),this.path){var r=this.getHeightOfLine(0)*1.1;this.width=this.path.width+r,this.height=this.path.height+r}else this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight();this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"})}},enlargeSpaces:function(){for(var r,o,i,l,d,a,g,p=0,v=this._textLines.length;p<v;p++)if(!(this.textAlign!=="justify"&&(p===v-1||this.isEndOfWrapping(p)))&&(l=0,d=this._textLines[p],o=this.getLineWidth(p),o<this.width&&(g=this.textLines[p].match(this._reSpacesAndTabs)))){i=g.length,r=(this.width-o)/i;for(var x=0,C=d.length;x<=C;x++)a=this.__charBounds[p][x],this._reSpaceAndTab.test(d[x])?(a.width+=r,a.kernedWidth+=r,a.left+=l,l+=r):a.left+=l}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),o=this.fontSize;return r.width+=o*r.zoomX,r.height+=o*r.zoomY,r},_render:function(r){var o=this.path;o&&!o.isNotVisible()&&o._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,o,i){if(r.textBaseline="alphabetic",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(o,i)},calcTextWidth:function(){for(var r=this.getLineWidth(0),o=1,i=this._textLines.length;o<i;o++){var l=this.getLineWidth(o);l>r&&(r=l)}return r},_renderTextLine:function(r,o,i,l,d,a){this._renderChars(r,o,i,l,d,a)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var o,i,l=r.fillStyle,d,a,g=this._getLeftOffset(),p=this._getTopOffset(),v=0,x=0,C,S,T=this.path,P,R=0,z=this._textLines.length;R<z;R++){if(o=this.getHeightOfLine(R),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",R)){p+=o;continue}d=this._textLines[R],i=this._getLineLeftOffset(R),x=0,v=0,a=this.getValueOfPropertyAt(R,0,"textBackgroundColor");for(var J=0,ne=d.length;J<ne;J++)C=this.__charBounds[R][J],S=this.getValueOfPropertyAt(R,J,"textBackgroundColor"),T?(r.save(),r.translate(C.renderLeft,C.renderTop),r.rotate(C.angle),r.fillStyle=S,S&&r.fillRect(-C.width/2,-o/this.lineHeight*(1-this._fontSizeFraction),C.width,o/this.lineHeight),r.restore()):S!==a?(P=g+i+v,this.direction==="rtl"&&(P=this.width-P-x),r.fillStyle=a,a&&r.fillRect(P,p,x,o/this.lineHeight),v=C.left,x=C.width,a=S):x+=C.kernedWidth;S&&!T&&(P=g+i+v,this.direction==="rtl"&&(P=this.width-P-x),r.fillStyle=S,r.fillRect(P,p,x,o/this.lineHeight)),p+=o}r.fillStyle=l,this._removeShadow(r)}},getFontCache:function(r){var o=r.fontFamily.toLowerCase();s.charWidthsCache[o]||(s.charWidthsCache[o]={});var i=s.charWidthsCache[o],l=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return i[l]||(i[l]={}),i[l]},_measureChar:function(r,o,i,l){var d=this.getFontCache(o),a=this._getFontDeclaration(o),g=this._getFontDeclaration(l),p=i+r,v=a===g,x,C,S,T=o.fontSize/this.CACHE_FONT_SIZE,P;if(i&&d[i]!==void 0&&(S=d[i]),d[r]!==void 0&&(P=x=d[r]),v&&d[p]!==void 0&&(C=d[p],P=C-S),x===void 0||S===void 0||C===void 0){var R=this.getMeasuringContext();this._setTextStyles(R,o,!0)}return x===void 0&&(P=x=R.measureText(r).width,d[r]=x),S===void 0&&v&&i&&(S=R.measureText(i).width,d[i]=S),v&&C===void 0&&(C=R.measureText(p).width,d[p]=C,P=C-S),{width:x*T,kernedWidth:P*T}},getHeightOfChar:function(r,o){return this.getValueOfPropertyAt(r,o,"fontSize")},measureLine:function(r){var o=this._measureLine(r);return this.charSpacing!==0&&(o.width-=this._getWidthOfCharSpacing()),o.width<0&&(o.width=0),o},_measureLine:function(r){var o=0,i,l,d=this._textLines[r],a,g,p=0,v=new Array(d.length),x=0,C,S,T=this.path,P=this.pathSide==="right";for(this.__charBounds[r]=v,i=0;i<d.length;i++)l=d[i],g=this._getGraphemeBox(l,r,i,a),v[i]=g,o+=g.kernedWidth,a=l;if(v[i]={left:g?g.left+g.width:0,width:0,kernedWidth:0,height:this.fontSize},T){switch(S=T.segmentsInfo[T.segmentsInfo.length-1].length,C=s.util.getPointOnPath(T.path,0,T.segmentsInfo),C.x+=T.pathOffset.x,C.y+=T.pathOffset.y,this.textAlign){case"left":x=P?S-o:0;break;case"center":x=(S-o)/2;break;case"right":x=P?0:S-o;break}for(x+=this.pathStartOffset*(P?-1:1),i=P?d.length-1:0;P?i>=0:i<d.length;P?i--:i++)g=v[i],x>S?x%=S:x<0&&(x+=S),this._setGraphemeOnPath(x,g,C),x+=g.kernedWidth}return{width:o,numOfSpaces:p}},_setGraphemeOnPath:function(r,o,i){var l=r+o.kernedWidth/2,d=this.path,a=s.util.getPointOnPath(d.path,l,d.segmentsInfo);o.renderLeft=a.x-i.x,o.renderTop=a.y-i.y,o.angle=a.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,o,i,l,d){var a=this.getCompleteStyleDeclaration(o,i),g=l?this.getCompleteStyleDeclaration(o,i-1):{},p=this._measureChar(r,a,l,g),v=p.kernedWidth,x=p.width,C;this.charSpacing!==0&&(C=this._getWidthOfCharSpacing(),x+=C,v+=C);var S={width:x,left:0,height:a.fontSize,kernedWidth:v,deltaY:a.deltaY};if(i>0&&!d){var T=this.__charBounds[o][i-1];S.left=T.left+T.width+p.kernedWidth-p.width}return S},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var o=this._textLines[r],i=this.getHeightOfChar(r,0),l=1,d=o.length;l<d;l++)i=Math.max(this.getHeightOfChar(r,l),i);return this.__lineHeights[r]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,o=0,i=0,l=this._textLines.length;i<l;i++)r=this.getHeightOfLine(i),o+=i===l-1?r/this.lineHeight:r;return o},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,o){r.save();for(var i=0,l=this._getLeftOffset(),d=this._getTopOffset(),a=0,g=this._textLines.length;a<g;a++){var p=this.getHeightOfLine(a),v=p/this.lineHeight,x=this._getLineLeftOffset(a);this._renderTextLine(o,r,this._textLines[a],l+x,d+i+v,a),i+=p}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,o,i,l,d,a){var g=this.getHeightOfLine(a),p=this.textAlign.indexOf("justify")!==-1,v,x,C="",S,T=0,P,R=this.path,z=!p&&this.charSpacing===0&&this.isEmptyStyles(a)&&!R,J=this.direction==="ltr",ne=this.direction==="ltr"?1:-1,ie,te=o.canvas.getAttribute("dir");if(o.save(),te!==this.direction&&(o.canvas.setAttribute("dir",J?"ltr":"rtl"),o.direction=J?"ltr":"rtl",o.textAlign=J?"left":"right"),d-=g*this._fontSizeFraction/this.lineHeight,z){this._renderChar(r,o,a,0,i.join(""),l,d,g),o.restore();return}for(var re=0,oe=i.length-1;re<=oe;re++)P=re===oe||this.charSpacing||R,C+=i[re],S=this.__charBounds[a][re],T===0?(l+=ne*(S.kernedWidth-S.width),T+=S.width):T+=S.kernedWidth,p&&!P&&this._reSpaceAndTab.test(i[re])&&(P=!0),P||(v=v||this.getCompleteStyleDeclaration(a,re),x=this.getCompleteStyleDeclaration(a,re+1),P=s.util.hasStyleChanged(v,x,!1)),P&&(R?(o.save(),o.translate(S.renderLeft,S.renderTop),o.rotate(S.angle),this._renderChar(r,o,a,re,C,-T/2,0,g),o.restore()):(ie=l,this._renderChar(r,o,a,re,C,ie,d,g)),C="",v=x,l+=ne*T,T=0);o.restore()},_applyPatternGradientTransformText:function(r){var o=s.util.createCanvasElement(),i,l=this.width+this.strokeWidth,d=this.height+this.strokeWidth;return o.width=l,o.height=d,i=o.getContext("2d"),i.beginPath(),i.moveTo(0,0),i.lineTo(l,0),i.lineTo(l,d),i.lineTo(0,d),i.closePath(),i.translate(l/2,d/2),i.fillStyle=r.toLive(i),this._applyPatternGradientTransform(i,r),i.fill(),i.createPattern(o,"no-repeat")},handleFiller:function(r,o,i){var l,d;return i.toLive?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(l=-this.width/2,d=-this.height/2,r.translate(l,d),r[o]=this._applyPatternGradientTransformText(i),{offsetX:l,offsetY:d}):(r[o]=i.toLive(r,this),this._applyPatternGradientTransform(r,i)):(r[o]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,o){return r.lineWidth=o.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",o.stroke)},_setFillStyles:function(r,o){return this.handleFiller(r,"fillStyle",o.fill)},_renderChar:function(r,o,i,l,d,a,g){var p=this._getStyleDeclaration(i,l),v=this.getCompleteStyleDeclaration(i,l),x=r==="fillText"&&v.fill,C=r==="strokeText"&&v.stroke&&v.strokeWidth,S,T;!C&&!x||(o.save(),x&&(S=this._setFillStyles(o,v)),C&&(T=this._setStrokeStyles(o,v)),o.font=this._getFontDeclaration(v),p&&p.textBackgroundColor&&this._removeShadow(o),p&&p.deltaY&&(g+=p.deltaY),x&&o.fillText(d,a-S.offsetX,g-S.offsetY),C&&o.strokeText(d,a-T.offsetX,g-T.offsetY),o.restore())},setSuperscript:function(r,o){return this._setScript(r,o,this.superscript)},setSubscript:function(r,o){return this._setScript(r,o,this.subscript)},_setScript:function(r,o,i){var l=this.get2DCursorLocation(r,!0),d=this.getValueOfPropertyAt(l.lineIndex,l.charIndex,"fontSize"),a=this.getValueOfPropertyAt(l.lineIndex,l.charIndex,"deltaY"),g={fontSize:d*i.size,deltaY:a+d*i.baseline};return this.setSelectionStyles(g,r,o),this},_getLineLeftOffset:function(r){var o=this.getLineWidth(r),i=this.width-o,l=this.textAlign,d=this.direction,g,a=0,g=this.isEndOfWrapping(r);return l==="justify"||l==="justify-center"&&!g||l==="justify-right"&&!g||l==="justify-left"&&!g?0:(l==="center"&&(a=i/2),l==="right"&&(a=i),l==="justify-center"&&(a=i/2),l==="justify-right"&&(a=i),d==="rtl"&&(a-=i),a)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var o=this.measureLine(r),i=o.width;return this.__lineWidths[r]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,o,i){var l=this._getStyleDeclaration(r,o);return l&&typeof l[i]<"u"?l[i]:this[i]},_renderTextDecoration:function(r,o){if(!(!this[o]&&!this.styleHas(o))){r.save(),(o==="overline"||o==="linethrough")&&this._removeShadow(r);for(var i,l,d,a,g,p,v,x,C=this._getLeftOffset(),S=this._getTopOffset(),T,P,R,z,J,ne,ie,te,re=this.path,oe=this._getWidthOfCharSpacing(),le=this.offsets[o],V=0,_=this._textLines.length;V<_;V++){if(i=this.getHeightOfLine(V),!this[o]&&!this.styleHas(o,V)){S+=i;continue}v=this._textLines[V],ne=i/this.lineHeight,a=this._getLineLeftOffset(V),P=0,R=0,x=this.getValueOfPropertyAt(V,0,o),te=this.getValueOfPropertyAt(V,0,"fill"),T=S+ne*(1-this._fontSizeFraction),l=this.getHeightOfChar(V,0),g=this.getValueOfPropertyAt(V,0,"deltaY");for(var O=0,j=v.length;O<j;O++)if(z=this.__charBounds[V][O],J=this.getValueOfPropertyAt(V,O,o),ie=this.getValueOfPropertyAt(V,O,"fill"),d=this.getHeightOfChar(V,O),p=this.getValueOfPropertyAt(V,O,"deltaY"),re&&J&&ie)r.save(),r.fillStyle=te,r.translate(z.renderLeft,z.renderTop),r.rotate(z.angle),r.fillRect(-z.kernedWidth/2,le*d+p,z.kernedWidth,this.fontSize/15),r.restore();else if((J!==x||ie!==te||d!==l||p!==g)&&R>0){var D=C+a+P;this.direction==="rtl"&&(D=this.width-D-R),x&&te&&(r.fillStyle=te,r.fillRect(D,T+le*l+g,R,this.fontSize/15)),P=z.left,R=z.width,x=J,te=ie,l=d,g=p}else R+=z.kernedWidth;var D=C+a+P;this.direction==="rtl"&&(D=this.width-D-R),r.fillStyle=ie,J&&ie&&r.fillRect(D,T+le*l+g,R-oe,this.fontSize/15),S+=i}r.restore()}},_getFontDeclaration:function(r,o){var i=r||this,l=this.fontFamily,d=s.Text.genericFonts.indexOf(l.toLowerCase())>-1,a=l===void 0||l.indexOf("'")>-1||l.indexOf(",")>-1||l.indexOf('"')>-1||d?i.fontFamily:'"'+i.fontFamily+'"';return[s.isLikelyNode?i.fontWeight:i.fontStyle,s.isLikelyNode?i.fontStyle:i.fontWeight,o?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",a].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var o=r.split(this._reNewline),i=new Array(o.length),l=[`
`],d=[],a=0;a<o.length;a++)i[a]=s.util.string.graphemeSplit(o[a]),d=d.concat(i[a],l);return d.pop(),{_unwrappedLines:i,lines:o,graphemeText:d,graphemeLines:i}},toObject:function(r){var o=h.concat(r),i=this.callSuper("toObject",o);return i.styles=s.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(r,o){this.callSuper("set",r,o);var i=!1,l=!1;if(typeof r=="object")for(var d in r)d==="path"&&this.setPathInfo(),i=i||this._dimensionAffectingProps.indexOf(d)!==-1,l=l||d==="path";else i=this._dimensionAffectingProps.indexOf(r)!==-1,l=r==="path";return l&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(r,o,i){if(!r)return o(null);var l=s.parseAttributes(r,s.Text.ATTRIBUTE_NAMES),d=l.textAnchor||"left";if(i=s.util.object.extend(i?u(i):{},l),i.top=i.top||0,i.left=i.left||0,l.textDecoration){var a=l.textDecoration;a.indexOf("underline")!==-1&&(i.underline=!0),a.indexOf("overline")!==-1&&(i.overline=!0),a.indexOf("line-through")!==-1&&(i.linethrough=!0),delete i.textDecoration}"dx"in l&&(i.left+=l.dx),"dy"in l&&(i.top+=l.dy),"fontSize"in i||(i.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var g="";"textContent"in r?g=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(g=r.firstChild.data),g=g.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var p=i.strokeWidth;i.strokeWidth=0;var v=new s.Text(g,i),x=v.getScaledHeight()/v.height,C=(v.height+v.strokeWidth)*v.lineHeight-v.height,S=C*x,T=v.getScaledHeight()+S,P=0;d==="center"&&(P=v.getScaledWidth()/2),d==="right"&&(P=v.getScaledWidth()),v.set({left:v.left-P,top:v.top-(T-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:typeof p<"u"?p:1}),o(v)},s.Text.fromObject=function(r,o){var i=u(r),l=r.path;return delete i.path,s.Object._fromObject("Text",i,function(d){d.styles=s.util.stylesFromArray(r.styles,r.text),l?s.Object._fromObject("Path",l,function(a){d.set("path",a),o(d)},"path"):o(d)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}(t),function(){e.util.object.extend(e.Text.prototype,{isEmptyStyles:function(f){if(!this.styles||typeof f<"u"&&!this.styles[f])return!0;var s=typeof f>"u"?this.styles:{line:this.styles[f]};for(var u in s)for(var h in s[u])for(var r in s[u][h])return!1;return!0},styleHas:function(f,s){if(!this.styles||!f||f===""||typeof s<"u"&&!this.styles[s])return!1;var u=typeof s>"u"?this.styles:{0:this.styles[s]};for(var h in u)for(var r in u[h])if(typeof u[h][r][f]<"u")return!0;return!1},cleanStyle:function(f){if(!this.styles||!f||f==="")return!1;var s=this.styles,u=0,h,r,o=!0,i=0,l;for(var d in s){h=0;for(var a in s[d]){var l=s[d][a],g=l.hasOwnProperty(f);u++,g?(r?l[f]!==r&&(o=!1):r=l[f],l[f]===this[f]&&delete l[f]):o=!1,Object.keys(l).length!==0?h++:delete s[d][a]}h===0&&delete s[d]}for(var p=0;p<this._textLines.length;p++)i+=this._textLines[p].length;o&&u===i&&(this[f]=r,this.removeStyle(f))},removeStyle:function(f){if(!(!this.styles||!f||f==="")){var s=this.styles,u,h,r;for(h in s){u=s[h];for(r in u)delete u[r][f],Object.keys(u[r]).length===0&&delete u[r];Object.keys(u).length===0&&delete s[h]}}},_extendStyles:function(f,s){var u=this.get2DCursorLocation(f);this._getLineStyle(u.lineIndex)||this._setLineStyle(u.lineIndex),this._getStyleDeclaration(u.lineIndex,u.charIndex)||this._setStyleDeclaration(u.lineIndex,u.charIndex,{}),e.util.object.extend(this._getStyleDeclaration(u.lineIndex,u.charIndex),s)},get2DCursorLocation:function(f,s){typeof f>"u"&&(f=this.selectionStart);for(var u=s?this._unwrappedTextLines:this._textLines,h=u.length,r=0;r<h;r++){if(f<=u[r].length)return{lineIndex:r,charIndex:f};f-=u[r].length+this.missingNewlineOffset(r,s)}return{lineIndex:r-1,charIndex:u[r-1].length<f?u[r-1].length:f}},getSelectionStyles:function(f,s,u){typeof f>"u"&&(f=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||f);for(var h=[],r=f;r<s;r++)h.push(this.getStyleAtPosition(r,u));return h},getStyleAtPosition:function(f,s){var u=this.get2DCursorLocation(f),h=s?this.getCompleteStyleDeclaration(u.lineIndex,u.charIndex):this._getStyleDeclaration(u.lineIndex,u.charIndex);return h||{}},setSelectionStyles:function(f,s,u){typeof s>"u"&&(s=this.selectionStart||0),typeof u>"u"&&(u=this.selectionEnd||s);for(var h=s;h<u;h++)this._extendStyles(h,f);return this._forceClearCache=!0,this},_getStyleDeclaration:function(f,s){var u=this.styles&&this.styles[f];return u?u[s]:null},getCompleteStyleDeclaration:function(f,s){for(var u=this._getStyleDeclaration(f,s)||{},h={},r,o=0;o<this._styleProperties.length;o++)r=this._styleProperties[o],h[r]=typeof u[r]>"u"?this[r]:u[r];return h},_setStyleDeclaration:function(f,s,u){this.styles[f][s]=u},_deleteStyleDeclaration:function(f,s){delete this.styles[f][s]},_getLineStyle:function(f){return!!this.styles[f]},_setLineStyle:function(f){this.styles[f]={}},_deleteLineStyle:function(f){delete this.styles[f]}})}(),function(){function f(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}e.IText=e.util.createClass(e.Text,e.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,u){this.callSuper("initialize",s,u),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,u){this[s]!==u&&(this._fireSelectionChanged(),this[s]=u),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var u=this.canvas.contextTop,h=this.canvas.viewportTransform;u.save(),u.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this.transform(u),this._clearTextArea(u),s||u.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var s=this._getCursorBoundaries(),u=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,u):this.renderSelection(s,u),u.restore()}},_clearTextArea:function(s){var u=this.width+4,h=this.height+4;s.clearRect(-u/2,-h/2,u,h)},_getCursorBoundaries:function(s){typeof s>"u"&&(s=this.selectionStart);var u=this._getLeftOffset(),h=this._getTopOffset(),r=this._getCursorBoundariesOffsets(s);return{left:u,top:h,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var u,h,r,o=0,i=0,l,d=this.get2DCursorLocation(s);r=d.charIndex,h=d.lineIndex;for(var a=0;a<h;a++)o+=this.getHeightOfLine(a);u=this._getLineLeftOffset(h);var g=this.__charBounds[h][r];return g&&(i=g.left),this.charSpacing!==0&&r===this._textLines[h].length&&(i-=this._getWidthOfCharSpacing()),l={top:o,left:u+(i>0?i:0)},this.direction==="rtl"&&(l.left*=-1),this.cursorOffsetCache=l,this.cursorOffsetCache},renderCursor:function(s,u){var h=this.get2DCursorLocation(),r=h.lineIndex,o=h.charIndex>0?h.charIndex-1:0,i=this.getValueOfPropertyAt(r,o,"fontSize"),l=this.scaleX*this.canvas.getZoom(),d=this.cursorWidth/l,a=s.topOffset,g=this.getValueOfPropertyAt(r,o,"deltaY");a+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,u),u.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,o,"fill"),u.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,u.fillRect(s.left+s.leftOffset-d/2,a+s.top+g,d,i)},renderSelection:function(s,u){for(var h=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,o=this.textAlign.indexOf("justify")!==-1,i=this.get2DCursorLocation(h),l=this.get2DCursorLocation(r),d=i.lineIndex,a=l.lineIndex,g=i.charIndex<0?0:i.charIndex,p=l.charIndex<0?0:l.charIndex,v=d;v<=a;v++){var x=this._getLineLeftOffset(v)||0,C=this.getHeightOfLine(v),S=0,T=0,P=0;if(v===d&&(T=this.__charBounds[d][g].left),v>=d&&v<a)P=o&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===a)if(p===0)P=this.__charBounds[a][p].left;else{var R=this._getWidthOfCharSpacing();P=this.__charBounds[a][p-1].left+this.__charBounds[a][p-1].width-R}S=C,(this.lineHeight<1||v===a&&this.lineHeight>1)&&(C/=this.lineHeight);var z=s.left+x+T,J=P-T,ne=C,ie=0;this.inCompositionMode?(u.fillStyle=this.compositionColor||"black",ne=1,ie=C):u.fillStyle=this.selectionColor,this.direction==="rtl"&&(z=this.width-z-J),u.fillRect(z,s.top+s.topOffset+ie,J,ne),s.topOffset+=S}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),u=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:u}}}),e.IText.fromObject=function(s,u){var h=e.util.stylesFromArray(s.styles,s.text),r=Object.assign({},s,{styles:h});if(delete r.path,f(r),r.styles)for(var o in r.styles)for(var i in r.styles[o])f(r.styles[o][i]);e.Object._fromObject("IText",r,function(l){s.path?e.Object._fromObject("Path",s.path,function(d){l.set("path",d),u(l)},"path"):u(l)},"text")}}(),function(){var f=e.util.object.clone;e.util.object.extend(e.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var u=s.canvas;u&&(u._hasITextHandlers||(u._hasITextHandlers=!0,s._initCanvasHandlers(u)),u._iTextInstances=u._iTextInstances||[],u._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var u=s.canvas;u&&(u._iTextInstances=u._iTextInstances||[],e.util.removeFromArray(u._iTextInstances,s),u._iTextInstances.length===0&&(u._hasITextHandlers=!1,s._removeCanvasHandlers(u)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,u,h,r){var o;return o={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",u,{duration:h,onComplete:function(){o.isAborted||s[r]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return o.isAborted}}),o},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var u=this,h=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){u._tick()},h)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,u=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&u&&u.clearContext(u.contextTop||u.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var u=0,h=s-1;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)u++,h--;for(;/\S/.test(this._text[h])&&h>-1;)u++,h--;return s-u},findWordBoundaryRight:function(s){var u=0,h=s;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)u++,h++;for(;/\S/.test(this._text[h])&&h<this._text.length;)u++,h++;return s+u},findLineBoundaryLeft:function(s){for(var u=0,h=s-1;!/\n/.test(this._text[h])&&h>-1;)u++,h--;return s-u},findLineBoundaryRight:function(s){for(var u=0,h=s;!/\n/.test(this._text[h])&&h<this._text.length;)u++,h++;return s+u},searchWordBoundary:function(s,u){for(var h=this._text,r=this._reSpace.test(h[s])?s-1:s,o=h[r],i=e.reNonWord;!i.test(o)&&r>0&&r<h.length;)r+=u,o=h[r];return i.test(o)&&(r+=u===1?0:1),r},selectWord:function(s){s=s||this.selectionStart;var u=this.searchWordBoundary(s,-1),h=this.searchWordBoundary(s,1);this.selectionStart=u,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var u=this.findLineBoundaryLeft(s),h=this.findLineBoundaryRight(s);return this.selectionStart=u,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.selected=!1,u.isEditing&&u.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var u=this.getSelectionStartFromPointer(s.e),h=this.selectionStart,r=this.selectionEnd;(u!==this.__selectionStartOnMouseDown||h===r)&&(h===u||r===u)||(u>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=u):(this.selectionStart=u,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==h||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,u,h){var r=h.slice(0,s),o=e.util.string.graphemeSplit(r).length;if(s===u)return{selectionStart:o,selectionEnd:o};var i=h.slice(s,u),l=e.util.string.graphemeSplit(i).length;return{selectionStart:o,selectionEnd:o+l}},fromGraphemeToStringSelection:function(s,u,h){var r=h.slice(0,s),o=r.join("").length;if(s===u)return{selectionStart:o,selectionEnd:o};var i=h.slice(s,u),l=i.join("").length;return{selectionStart:o,selectionEnd:o+l}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,u=this._getCursorBoundaries(s),h=this.get2DCursorLocation(s),r=h.lineIndex,o=h.charIndex,i=this.getValueOfPropertyAt(r,o,"fontSize")*this.lineHeight,l=u.leftOffset,d=this.calcTransformMatrix(),a={x:u.left+l,y:u.top+u.topOffset+i},g=this.canvas.getRetinaScaling(),p=this.canvas.upperCanvasEl,v=p.width/g,x=p.height/g,C=v-i,S=x-i,T=p.clientWidth/v,P=p.clientHeight/x;return a=e.util.transformPoint(a,d),a=e.util.transformPoint(a,this.canvas.viewportTransform),a.x*=T,a.y*=P,a.x<0&&(a.x=0),a.x>C&&(a.x=C),a.y<0&&(a.y=0),a.y>S&&(a.y=S),a.x+=this.canvas._offset.left,a.y+=this.canvas._offset.top,{left:a.x+"px",top:a.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,u=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,u&&(u.blur&&u.blur(),u.parentNode&&u.parentNode.removeChild(u)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,u){var h=this.get2DCursorLocation(s,!0),r=this.get2DCursorLocation(u,!0),o=h.lineIndex,i=h.charIndex,l=r.lineIndex,d=r.charIndex,a,g;if(o!==l){if(this.styles[o])for(a=i;a<this._unwrappedTextLines[o].length;a++)delete this.styles[o][a];if(this.styles[l])for(a=d;a<this._unwrappedTextLines[l].length;a++)g=this.styles[l][a],g&&(this.styles[o]||(this.styles[o]={}),this.styles[o][i+a-d]=g);for(a=o+1;a<=l;a++)delete this.styles[a];this.shiftLineStyles(l,o-l)}else if(this.styles[o]){g=this.styles[o];var p=d-i,v,x;for(a=i;a<d;a++)delete g[a];for(x in this.styles[o])v=parseInt(x,10),v>=d&&(g[v-p]=g[x],delete g[x])}},shiftLineStyles:function(s,u){var h=f(this.styles);for(var r in this.styles){var o=parseInt(r,10);o>s&&(this.styles[o+u]=h[o],h[o-u]||delete this.styles[o])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(s,u,h,r){var o,i={},l=!1,d=this._unwrappedTextLines[s].length,a=d===u;h||(h=1),this.shiftLineStyles(s,h),this.styles[s]&&(o=this.styles[s][u===0?u:u-1]);for(var g in this.styles[s]){var p=parseInt(g,10);p>=u&&(l=!0,i[p-u]=this.styles[s][g],a&&u===0||delete this.styles[s][g])}var v=!1;for(l&&!a&&(this.styles[s+h]=i,v=!0),(v||d>u)&&h--;h>0;)r&&r[h-1]?this.styles[s+h]={0:f(r[h-1])}:o?this.styles[s+h]={0:f(o)}:delete this.styles[s+h],h--;this._forceClearCache=!0},insertCharStyleObject:function(s,u,h,r){this.styles||(this.styles={});var o=this.styles[s],i=o?f(o):{};h||(h=1);for(var l in i){var d=parseInt(l,10);d>=u&&(o[d+h]=i[d],i[d-h]||delete o[d])}if(this._forceClearCache=!0,r){for(;h--;)Object.keys(r[h]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][u+h]=f(r[h]));return}if(o)for(var a=o[u?u-1:1];a&&h--;)this.styles[s][u+h]=f(a)},insertNewStyleBlock:function(s,u,h){for(var r=this.get2DCursorLocation(u,!0),o=[0],i=0,l=0;l<s.length;l++)s[l]===`
`?(i++,o[i]=0):o[i]++;o[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,o[0],h),h=h&&h.slice(o[0]+1)),i&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+o[0],i);for(var l=1;l<i;l++)o[l]>0?this.insertCharStyleObject(r.lineIndex+l,0,o[l],h):h&&this.styles[r.lineIndex+l]&&h[0]&&(this.styles[r.lineIndex+l][0]=h[0]),h=h&&h.slice(o[l]+1);o[l]>0&&this.insertCharStyleObject(r.lineIndex+l,0,o[l],h)},setSelectionStartEndWithShift:function(s,u,h){h<=s?(u===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=h):h>s&&h<u?this._selectionDirection==="right"?this.selectionEnd=h:this.selectionStart=h:(u===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=u),this.selectionEnd=h)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),e.util.object.extend(e.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(f){if(this.canvas){this.__newClickTime=+new Date;var s=f.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",f),this._stopEvent(f.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(f){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===f.x&&this.__lastPointer.y===f.y},_stopEvent:function(f){f.preventDefault&&f.preventDefault(),f.stopPropagation&&f.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(f){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(f.e))},tripleClickHandler:function(f){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(f.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(f){!this.canvas||!this.editable||f.e.button&&f.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(f.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(f){!this.canvas||!this.editable||f.e.button&&f.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(f){if(this.__isMousedown=!1,!(!this.editable||this.group||f.transform&&f.transform.actionPerformed||f.e.button&&f.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(f.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(f){var s=this.getSelectionStartFromPointer(f),u=this.selectionStart,h=this.selectionEnd;f.shiftKey?this.setSelectionStartEndWithShift(u,h,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(f){for(var s=this.getLocalPointer(f),u=0,h=0,r=0,o=0,i=0,l,d,a=0,g=this._textLines.length;a<g&&r<=s.y;a++)r+=this.getHeightOfLine(a)*this.scaleY,i=a,a>0&&(o+=this._textLines[a-1].length+this.missingNewlineOffset(a-1));l=this._getLineLeftOffset(i),h=l*this.scaleX,d=this._textLines[i],this.direction==="rtl"&&(s.x=this.width*this.scaleX-s.x+h);for(var p=0,v=d.length;p<v&&(u=h,h+=this.__charBounds[i][p].kernedWidth*this.scaleX,h<=s.x);p++)o++;return this._getNewSelectionStartFromOffset(s,u,h,o,v)},_getNewSelectionStartFromOffset:function(f,s,u,h,r){var o=f.x-s,i=u-f.x,l=i>o||i<0?0:1,d=h+l;return this.flipX&&(d=r-d),d>this._text.length&&(d=this._text.length),d}}),e.util.object.extend(e.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=e.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var f=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+f.top+"; left: "+f.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+f.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):e.document.body.appendChild(this.hiddenTextarea),e.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),e.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),e.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),e.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(e.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(f){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(f.keyCode in s)this[s[f.keyCode]](f);else if(f.keyCode in this.ctrlKeysMapDown&&(f.ctrlKey||f.metaKey))this[this.ctrlKeysMapDown[f.keyCode]](f);else return;f.stopImmediatePropagation(),f.preventDefault(),f.keyCode>=33&&f.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(f){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(f.keyCode in this.ctrlKeysMapUp&&(f.ctrlKey||f.metaKey))this[this.ctrlKeysMapUp[f.keyCode]](f);else return;f.stopImmediatePropagation(),f.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(f){var s=this.fromPaste;if(this.fromPaste=!1,f&&f.stopPropagation(),!!this.isEditing){var u=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,h=this._text.length,r=u.length,o,i,l=r-h,d=this.selectionStart,a=this.selectionEnd,g=d!==a,p,v,x;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var C=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),S=d>C.selectionStart;g?(o=this._text.slice(d,a),l+=a-d):r<h&&(S?o=this._text.slice(a+l,a):o=this._text.slice(d,d-l)),i=u.slice(C.selectionEnd-l,C.selectionEnd),o&&o.length&&(i.length&&(p=this.getSelectionStyles(d,d+1,!1),p=i.map(function(){return p[0]})),g?(v=d,x=a):S?(v=a-o.length,x=a):(v=a,x=a+o.length),this.removeStyleFromTo(v,x)),i.length&&(s&&i.join("")===e.copiedText&&!e.disableStyleCopyPaste&&(p=e.copiedTextStyle),this.insertNewStyleBlock(i,d,p)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(f){this.compositionStart=f.target.selectionStart,this.compositionEnd=f.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(e.copiedText=this.getSelectedText(),e.disableStyleCopyPaste?e.copiedTextStyle=null:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(f){return f&&f.clipboardData||e.window.clipboardData},_getWidthBeforeCursor:function(f,s){var u=this._getLineLeftOffset(f),h;return s>0&&(h=this.__charBounds[f][s-1],u+=h.left+h.width),u},getDownCursorOffset:function(f,s){var u=this._getSelectionForOffset(f,s),h=this.get2DCursorLocation(u),r=h.lineIndex;if(r===this._textLines.length-1||f.metaKey||f.keyCode===34)return this._text.length-u;var o=h.charIndex,i=this._getWidthBeforeCursor(r,o),l=this._getIndexOnLine(r+1,i),d=this._textLines[r].slice(o);return d.length+l+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(f,s){return f.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(f,s){var u=this._getSelectionForOffset(f,s),h=this.get2DCursorLocation(u),r=h.lineIndex;if(r===0||f.metaKey||f.keyCode===33)return-u;var o=h.charIndex,i=this._getWidthBeforeCursor(r,o),l=this._getIndexOnLine(r-1,i),d=this._textLines[r].slice(0,o),a=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+l-d.length+(1-a)},_getIndexOnLine:function(f,s){for(var u=this._textLines[f],h=this._getLineLeftOffset(f),r=h,o=0,i,l,d=0,a=u.length;d<a;d++)if(i=this.__charBounds[f][d].width,r+=i,r>s){l=!0;var g=r-i,p=r,v=Math.abs(g-s),x=Math.abs(p-s);o=x<v?d:d-1;break}return l||(o=u.length-1),o},moveCursorDown:function(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",f)},moveCursorUp:function(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",f)},_moveCursorUpOrDown:function(f,s){var u="get"+f+"CursorOffset",h=this[u](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(h):this.moveCursorWithoutShift(h),h!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(f){var s=this._selectionDirection==="left"?this.selectionStart+f:this.selectionEnd+f;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),f!==0},moveCursorWithoutShift:function(f){return f<0?(this.selectionStart+=f,this.selectionEnd=this.selectionStart):(this.selectionEnd+=f,this.selectionStart=this.selectionEnd),f!==0},moveCursorLeft:function(f){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",f)},_move:function(f,s,u){var h;if(f.altKey)h=this["findWordBoundary"+u](this[s]);else if(f.metaKey||f.keyCode===35||f.keyCode===36)h=this["findLineBoundary"+u](this[s]);else return this[s]+=u==="Left"?-1:1,!0;if(typeof h<"u"&&this[s]!==h)return this[s]=h,!0},_moveLeft:function(f,s){return this._move(f,s,"Left")},_moveRight:function(f,s){return this._move(f,s,"Right")},moveCursorLeftWithoutShift:function(f){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(f,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(f){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(f,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(f,"selectionStart")},moveCursorRight:function(f){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",f)},_moveCursorLeftOrRight:function(f,s){var u="moveCursor"+f+"With";this._currentCursorOpacity=1,s.shiftKey?u+="Shift":u+="outShift",this[u](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(f){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(f,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(f,"selectionEnd")},moveCursorRightWithoutShift:function(f){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(f,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(f,s){typeof s>"u"&&(s=f+1),this.removeStyleFromTo(f,s),this._text.splice(f,s-f),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(f,s,u,h){typeof h>"u"&&(h=u),h>u&&this.removeStyleFromTo(u,h);var r=e.util.string.graphemeSplit(f);this.insertNewStyleBlock(r,u,s),this._text=[].concat(this._text.slice(0,u),r,this._text.slice(h)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var f=e.util.toFixed,s=e.util.radiansToDegrees,u=e.util.calcRotateMatrix,h=e.util.transformPoint,r=/  +/g;e.util.object.extend(e.Text.prototype,{_toSVG:function(){var o=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(o.textTop,o.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(o){var i=this._createBaseSVGMarkup(this._toSVG(),{reviver:o,noStyle:!0,withShadow:!0}),l=this.path;return l?i+l._createBaseSVGMarkup(l._toSVG(),{reviver:o,withShadow:!0}):i},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(o){var i=!0,l=this.getSvgTextDecoration(this);return[o.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",l?'text-decoration="'+l+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",o.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(o,i){var l=[],d=[],a=o,g;this._setSVGBg(d);for(var p=0,v=this._textLines.length;p<v;p++)g=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(d,p,i+g,a),this._setSVGTextLineText(l,p,i+g,a),a+=this.getHeightOfLine(p);return{textSpans:l,textBgRects:d}},_createTextCharSpan:function(o,i,l,d,a){var g=o!==o.trim()||o.match(r),p=this.getSvgSpanStyles(i,g),v=p?'style="'+p+'"':"",x=i.deltaY,C="",S=e.Object.NUM_FRACTION_DIGITS,T="";if(x&&(C=' dy="'+f(x,S)+'" '),a.renderLeft!==void 0){var P=a.angle;T=' rotate="'+f(s(P),e.Object.NUM_FRACTION_DIGITS)+'" ';var R=a.width/2,z=u({angle:s(P)});z[4]=a.renderLeft,z[5]=a.renderTop;var J=h({x:-R,y:0},z);l=J.x,d=J.y}return['<tspan x="',f(l,S),'" y="',f(d,S),'" ',C,v,T,">",e.util.string.escapeXml(o),"</tspan>"].join("")},_setSVGTextLineText:function(o,i,l,d){var a=this.getHeightOfLine(i),g=this.textAlign.indexOf("justify")!==-1,p,v,x="",C,S,T=0,P=this._textLines[i],R;d+=a*(1-this._fontSizeFraction)/this.lineHeight;for(var z=0,J=P.length-1;z<=J;z++)R=z===J||this.charSpacing||this.path,x+=P[z],C=this.__charBounds[i][z],T===0?(l+=C.kernedWidth-C.width,T+=C.width):T+=C.kernedWidth,g&&!R&&this._reSpaceAndTab.test(P[z])&&(R=!0),R||(p=p||this.getCompleteStyleDeclaration(i,z),v=this.getCompleteStyleDeclaration(i,z+1),R=e.util.hasStyleChanged(p,v,!0)),R&&(S=this._getStyleDeclaration(i,z)||{},o.push(this._createTextCharSpan(x,S,l,d,C)),x="",p=v,l+=T,T=0)},_pushTextBgRect:function(o,i,l,d,a,g){var p=e.Object.NUM_FRACTION_DIGITS;o.push("		<rect ",this._getFillAttributes(i),' x="',f(l,p),'" y="',f(d,p),'" width="',f(a,p),'" height="',f(g,p),`"></rect>
`)},_setSVGTextLineBg:function(o,i,l,d){for(var a=this._textLines[i],g=this.getHeightOfLine(i)/this.lineHeight,p=0,v=0,x,C,S=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),T=0,P=a.length;T<P;T++)x=this.__charBounds[i][T],C=this.getValueOfPropertyAt(i,T,"textBackgroundColor"),C!==S?(S&&this._pushTextBgRect(o,S,l+v,d,p,g),v=x.left,p=x.width,S=C):p+=x.kernedWidth;C&&this._pushTextBgRect(o,C,l+v,d,p,g)},_getFillAttributes:function(o){var i=o&&typeof o=="string"?new e.Color(o):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+o+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(o){for(var i=0,l=0,d=0;d<o;d++)i+=this.getHeightOfLine(d);return l=this.getHeightOfLine(d),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*l/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(o){var i=e.Object.prototype.getSvgStyles.call(this,o);return i+" white-space: pre;"}})}(),function(f){var s=f.fabric||(f.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(u){for(var h=0,r=0,o=0,i={},l=0;l<u.graphemeLines.length;l++)u.graphemeText[o]===`
`&&l>0?(r=0,o++,h++):!this.splitByGrapheme&&this._reSpaceAndTab.test(u.graphemeText[o])&&l>0&&(r++,o++),i[l]={line:h,offset:r},o+=u.graphemeLines[l].length,r+=u.graphemeLines[l].length;return i},styleHas:function(u,h){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[h];r&&(h=r.line)}return s.Text.prototype.styleHas.call(this,u,h)},isEmptyStyles:function(u){if(!this.styles)return!0;var h=0,r=u+1,o,i,l=!1,d=this._styleMap[u],a=this._styleMap[u+1];d&&(u=d.line,h=d.offset),a&&(r=a.line,l=r===u,o=a.offset),i=typeof u>"u"?this.styles:{line:this.styles[u]};for(var g in i)for(var p in i[g])if(p>=h&&(!l||p<o))for(var v in i[g][p])return!1;return!0},_getStyleDeclaration:function(u,h){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];if(!r)return null;u=r.line,h=r.offset+h}return this.callSuper("_getStyleDeclaration",u,h)},_setStyleDeclaration:function(u,h,r){var o=this._styleMap[u];u=o.line,h=o.offset+h,this.styles[u][h]=r},_deleteStyleDeclaration:function(u,h){var r=this._styleMap[u];u=r.line,h=r.offset+h,delete this.styles[u][h]},_getLineStyle:function(u){var h=this._styleMap[u];return!!this.styles[h.line]},_setLineStyle:function(u){var h=this._styleMap[u];this.styles[h.line]={}},_wrapText:function(u,h){var r=[],o;for(this.isWrapping=!0,o=0;o<u.length;o++)r=r.concat(this._wrapLine(u[o],o,h));return this.isWrapping=!1,r},_measureWord:function(u,h,r){var o=0,i,l=!0;r=r||0;for(var d=0,a=u.length;d<a;d++){var g=this._getGraphemeBox(u[d],h,d+r,i,l);o+=g.kernedWidth,i=u[d]}return o},_wrapLine:function(u,h,r,z){var i=0,l=this.splitByGrapheme,d=[],a=[],g=l?s.util.string.graphemeSplit(u):u.split(this._wordJoiners),p="",v=0,x=l?"":" ",C=0,S=0,T=0,P=!0,R=this._getWidthOfCharSpacing(),z=z||0;g.length===0&&g.push([]),r-=z;for(var J=0;J<g.length;J++)p=l?g[J]:s.util.string.graphemeSplit(g[J]),C=this._measureWord(p,h,v),v+=p.length,i+=S+C-R,i>r&&!P?(d.push(a),a=[],i=C,P=!0):i+=R,!P&&!l&&a.push(x),a=a.concat(p),S=l?0:this._measureWord([x],h,v),v++,P=!1,C>T&&(T=C);return J&&d.push(a),T+z>this.dynamicMinWidth&&(this.dynamicMinWidth=T-R+z),d},isEndOfWrapping:function(u){return!this._styleMap[u+1]||this._styleMap[u+1].line!==this._styleMap[u].line},missingNewlineOffset:function(u,h){return this.splitByGrapheme&&!h?this.isEndOfWrapping(u)?1:0:1},_splitTextIntoLines:function(u){for(var h=s.Text.prototype._splitTextIntoLines.call(this,u),r=this._wrapText(h.lines,this.width),o=new Array(r.length),i=0;i<r.length;i++)o[i]=r[i].join("");return h.lines=o,h.graphemeLines=r,h},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var u={};for(var h in this._styleMap)this._textLines[h]&&(u[this._styleMap[h].line]=1);for(var h in this.styles)u[h]||delete this.styles[h]},toObject:function(u){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(u))}}),s.Textbox.fromObject=function(u,h){var r=s.util.stylesFromArray(u.styles,u.text),o=Object.assign({},u,{styles:r});return delete o.path,s.Object._fromObject("Textbox",o,function(i){u.path?s.Object._fromObject("Path",u.path,function(l){i.set("path",l),h(i)},"path"):h(i)},"text")}}(t),function(){var f=e.controlsUtils,s=f.scaleSkewCursorStyleHandler,u=f.scaleCursorStyleHandler,h=f.scalingEqually,r=f.scalingYOrSkewingX,o=f.scalingXOrSkewingY,i=f.scaleOrSkewActionName,l=e.Object.prototype.controls;if(l.ml=new e.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:o,getActionName:i}),l.mr=new e.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:o,getActionName:i}),l.mb=new e.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),l.mt=new e.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),l.tl=new e.Control({x:-.5,y:-.5,cursorStyleHandler:u,actionHandler:h}),l.tr=new e.Control({x:.5,y:-.5,cursorStyleHandler:u,actionHandler:h}),l.bl=new e.Control({x:-.5,y:.5,cursorStyleHandler:u,actionHandler:h}),l.br=new e.Control({x:.5,y:.5,cursorStyleHandler:u,actionHandler:h}),l.mtr=new e.Control({x:0,y:-.5,actionHandler:f.rotationWithSnapping,cursorStyleHandler:f.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),e.Textbox){var d=e.Textbox.prototype.controls={};d.mtr=l.mtr,d.tr=l.tr,d.br=l.br,d.tl=l.tl,d.bl=l.bl,d.mt=l.mt,d.mb=l.mb,d.mr=new e.Control({x:.5,y:0,actionHandler:f.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),d.ml=new e.Control({x:-.5,y:0,actionHandler:f.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()})(He);const Nl=t=>{let e;const n=new Set,c=(h,r)=>{const o=typeof h=="function"?h(e):h;if(!Object.is(o,e)){const i=e;e=r??(typeof o!="object"||o===null)?o:Object.assign({},e,o),n.forEach(l=>l(e,i))}},m=()=>e,s={setState:c,getState:m,getInitialState:()=>u,subscribe:h=>(n.add(h),()=>n.delete(h)),destroy:()=>{n.clear()}},u=e=t(c,m,s);return s},fg=t=>t?Nl(t):Nl;var rh={exports:{}},ih={},sh={exports:{}},oh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hn=ue;function dg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var gg=typeof Object.is=="function"?Object.is:dg,pg=Hn.useState,mg=Hn.useEffect,vg=Hn.useLayoutEffect,yg=Hn.useDebugValue;function xg(t,e){var n=e(),c=pg({inst:{value:n,getSnapshot:e}}),m=c[0].inst,y=c[1];return vg(function(){m.value=n,m.getSnapshot=e,Es(m)&&y({inst:m})},[t,n,e]),mg(function(){return Es(m)&&y({inst:m}),t(function(){Es(m)&&y({inst:m})})},[t]),yg(n),n}function Es(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!gg(t,n)}catch{return!0}}function wg(t,e){return e()}var Cg=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?wg:xg;oh.useSyncExternalStore=Hn.useSyncExternalStore!==void 0?Hn.useSyncExternalStore:Cg;sh.exports=oh;var Sg=sh.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var es=ue,_g=Sg;function bg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Tg=typeof Object.is=="function"?Object.is:bg,kg=_g.useSyncExternalStore,Og=es.useRef,Pg=es.useEffect,Eg=es.useMemo,jg=es.useDebugValue;ih.useSyncExternalStoreWithSelector=function(t,e,n,c,m){var y=Og(null);if(y.current===null){var w={hasValue:!1,value:null};y.current=w}else w=y.current;y=Eg(function(){function s(i){if(!u){if(u=!0,h=i,i=c(i),m!==void 0&&w.hasValue){var l=w.value;if(m(l,i))return r=l}return r=i}if(l=r,Tg(h,i))return l;var d=c(i);return m!==void 0&&m(l,d)?(h=i,l):(h=i,r=d)}var u=!1,h,r,o=n===void 0?null:n;return[function(){return s(e())},o===null?void 0:function(){return s(o())}]},[e,n,c,m]);var f=kg(t,y[0],y[1]);return Pg(function(){w.hasValue=!0,w.value=f},[f]),jg(f),f};rh.exports=ih;var Mg=rh.exports;const Dg=zl(Mg),{useDebugValue:Ag}=Ql,{useSyncExternalStoreWithSelector:Ig}=Dg;const Lg=t=>t;function Fg(t,e=Lg,n){const c=Ig(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return Ag(c),c}const Rl=t=>{const e=typeof t=="function"?fg(t):t,n=(c,m)=>Fg(e,c,m);return Object.assign(n,e),n},wa=t=>t?Rl(t):Rl,pr=wa((t,e)=>({canvas:null,tool:"select",brushSize:5,brushColor:"#000000",isDrawing:!1,history:[],historyIndex:-1,zoom:1,panX:0,panY:0,setCanvas:n=>t({canvas:n}),setTool:n=>{const{canvas:c,brushSize:m,brushColor:y}=e();if(c){switch(n){case"select":c.isDrawingMode=!1,c.selection=(!0)(c.getContext()).globalCompositeOperation="source-over";break;case"brush":c.isDrawingMode=!0,c.selection=!1,c.freeDrawingBrush=new He.fabric.PencilBrush(c),c.freeDrawingBrush.width=m,c.freeDrawingBrush.color=y(c.getContext()).globalCompositeOperation="source-over";break;case"eraser":c.isDrawingMode=!0,c.selection=!1,c.freeDrawingBrush=new He.fabric.PencilBrush(c),c.freeDrawingBrush.width=m(c.getContext()).globalCompositeOperation="destination-out",c.freeDrawingBrush.color="rgba(0,0,0,1)";break;default:c.isDrawingMode=!1,c.selection=!0}t({tool:n})}},setBrushSize:n=>{const{canvas:c,tool:m}=e();c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=n,m==="eraser"?c.getContext().globalCompositeOperation="destination-out":c.getContext().globalCompositeOperation="source-over"),t({brushSize:n})},setBrushColor:n=>{const{canvas:c,tool:m}=e();c&&c.freeDrawingBrush&&m!=="eraser"&&(c.freeDrawingBrush.color=n),t({brushColor:n})},setIsDrawing:n=>t({isDrawing:n}),addToHistory:n=>{const{history:c,historyIndex:m}=e(),y={id:Date.now().toString(),timestamp:Date.now(),data:n},s=[...c.slice(0,m+1),y].slice(-50);t({history:s,historyIndex:s.length-1})},undo:()=>{const{canvas:n,history:c,historyIndex:m}=e();if(!n||m<=0)return;const y=c[m-1];n._skipHistory=!0,n.loadFromJSON(y.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:m-1})},redo:()=>{const{canvas:n,history:c,historyIndex:m}=e();if(!n||m>=c.length-1)return;const y=c[m+1];n._skipHistory=!0,n.loadFromJSON(y.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:m+1})},canUndo:()=>{const{historyIndex:n}=e();return n>0},canRedo:()=>{const{history:n,historyIndex:c}=e();return c<n.length-1},clearCanvas:()=>{const{canvas:n}=e();if(n){n.clear(),n.backgroundColor="#ffffff",n.renderAll();const c=JSON.stringify(n.toJSON());e().addToHistory(c)}},exportCanvas:n=>{const{canvas:c}=e();if(!c)return null;switch(n){case"png":return c.toDataURL({format:"png",quality:1,multiplier:2});case"jpg":return c.toDataURL({format:"jpeg",quality:.9,multiplier:2});case"pdf":return console.warn("PDF export not yet implemented"),null;default:return null}},importImage:async(n,c)=>{const{canvas:m}=e();if(m)return console.log("🖼️ Importing image to canvas:",n.substring(0,50)+"..."),new Promise((y,w)=>{try{He.fabric.Image.fromURL(n,f=>{try{if(f&&f.width&&f.height){console.log("✅ Image loaded successfully:",f.width,"x",f.height);const s=f.width||1,u=f.height||1,h=Math.max(s,u);console.log("📏 Original AI image size:",s,"x",u);const r=600;let o=1;h>r?(o=r/h,console.log("🔽 Scaling down large AI image:",o)):console.log("✅ Using original AI image size (good quality)"),f.scale(o),console.log("✅ Final AI image display size:",(s*o).toFixed(0),"x",(u*o).toFixed(0)),(c==null?void 0:c.x)!==void 0&&(c==null?void 0:c.y)!==void 0?(f.set({left:c.x,top:c.y}),console.log("📍 Positioned image at:",c.x,c.y)):(f.center(),console.log("📍 Centered image (no position specified)"));try{n.startsWith("data:image/")&&(f.set("isAIGenerated",!0),f.set("imageId",`ai_generated_${Date.now()}`))}catch(l){console.warn("Failed to set metadata:",l)}m.add(f),m.renderAll(),console.log("✅ Image added to canvas and rendered");const i=JSON.stringify(m.toJSON());e().addToHistory(i),y()}else console.error("❌ Failed to load image - img object is null or has no dimensions"),w(new Error("Failed to load image - invalid image data"))}catch(s){console.error("❌ Error in image load callback:",s),w(s)}},{crossOrigin:"anonymous"})}catch(f){console.error("❌ Error calling fabric.Image.fromURL:",f),w(f)}})},updateBrushSettings:n=>{const{canvas:c,brushSize:m,brushColor:y}=e(),w=n.size??m,f=n.color??y;c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=w,c.freeDrawingBrush.color=f,n.opacity),t({brushSize:w,brushColor:f})},setZoom:n=>{const{canvas:c}=e();if(c){const m=c.getCenter();c.zoomToPoint(new He.fabric.Point(m.left,m.top),n),c.renderAll()}t({zoom:n})},setPan:(n,c)=>{const{canvas:m}=e();m&&(m.absolutePan(new He.fabric.Point(n,c)),m.renderAll()),t({panX:n,panY:c})},zoomIn:()=>{const{zoom:n,setZoom:c}=e(),m=Math.min(n*1.2,5);c(m)},zoomOut:()=>{const{zoom:n,setZoom:c}=e(),m=Math.max(n/1.2,.1);c(m)},resetView:()=>{const{canvas:n,setZoom:c,setPan:m}=e();n&&(c(1),m(0,0),n.setViewportTransform([1,0,0,1,0,0]),n.renderAll())},calculateSmartLayout:(n,c)=>{const{canvas:m}=e();if(!m)return[];const y=m.width||800,w=m.height||600,f=20,s=[];if(console.log("🧮 Calculating smart layout for",n,"images"),console.log("📐 Canvas size:",y,"x",w),console.log("🖼️ Image size:",c.width,"x",c.height),n===1)s.push({x:(y-c.width)/2,y:(w-c.height)/2});else if(n===2){const u=c.width*2+f,h=(y-u)/2,r=(w-c.height)/2;s.push({x:h,y:r},{x:h+c.width+f,y:r})}else if(n===4){const u=c.width*2+f,h=c.height*2+f,r=(y-u)/2,o=(w-h)/2;s.push({x:r,y:o},{x:r+c.width+f,y:o},{x:r,y:o+c.height+f},{x:r+c.width+f,y:o+c.height+f})}else{const u=Math.ceil(Math.sqrt(n)),h=Math.ceil(n/u),r=c.width*u+f*(u-1),o=c.height*h+f*(h-1),i=Math.max(f,(y-r)/2),l=Math.max(f,(w-o)/2);for(let d=0;d<n;d++){const a=Math.floor(d/u),g=d%u;s.push({x:i+g*(c.width+f),y:l+a*(c.height+f)})}}return console.log("✅ Generated positions:",s),s},getSelectedImages:()=>{const{canvas:n}=e();if(console.log("🎯 Canvas selection check:",{hasCanvas:!!n}),!n)return[];const c=n.getActiveObjects();console.log("📋 Active objects:",{count:c.length,objects:c});const m=[];return c.forEach((y,w)=>{var f,s,u,h;console.log(`🖼️ Object ${w}:`,{type:y.type,hasElement:!!y._element,hasSrc:!!((f=y._element)!=null&&f.src),src:((u=(s=y._element)==null?void 0:s.src)==null?void 0:u.substring(0,50))+"..."}),y.type==="image"&&((h=y._element)!=null&&h.src)&&m.push(y._element.src)}),console.log("✅ Selected image URLs:",{count:m.length}),m}})),Ca=wa((t,e)=>({images:[],selectedImages:[],isMultiSelectMode:!1,canvas:null,setCanvas:n=>t({canvas:n}),addImages:async(n,c={autoArrange:!0,spacing:20})=>{const{canvas:m,images:y}=e();if(!m)return;const w=[],f=Array.from(n);for(let s=0;s<f.length;s++){const u=f[s];if(u.type.startsWith("image/"))try{const h=await new Promise(T=>{const P=new FileReader;P.onload=R=>{var z;return T((z=R.target)==null?void 0:z.result)},P.readAsDataURL(u)}),r=await new Promise((T,P)=>{He.fabric.Image.fromURL(h,R=>{R?(R.set({selectable:!0,hasControls:!0,hasBorders:!0,cornerColor:"#2563eb",cornerStyle:"circle",borderColor:"#2563eb"}),T(R)):P(new Error("Failed to load image"))})}),o=r.width||1,i=r.height||1,l=Math.max(o,i);console.log("📏 Original image size:",o,"x",i);const d=600;let a=1;l>d?(a=d/l,console.log("🔽 Scaling down large image:",a)):console.log("✅ Using original size (good quality)"),r.scale(a),console.log("✅ Final display size:",(o*a).toFixed(0),"x",(i*a).toFixed(0));const g=o*a,p=i*a,v=c.spacing||100;let x=100+s%2*(g+v),C=100+Math.floor(s/2)*(p+v);c.autoArrange?r.set({left:x,top:C}):r.center(),m.add(r);const S={id:`img_${Date.now()}_${s}`,name:u.name,url:h,fabricObject:r,width:r.width||0,height:r.height||0,selected:!1,position:{x:r.left||0,y:r.top||0},scale:a,thumbnail:h};w.push(S)}catch(h){console.error(`Failed to load image ${u.name}:`,h)}}m.renderAll(),t({images:[...y,...w]}),m&&w.length>0&&console.log("Added",w.length,"images to canvas")},removeImage:n=>{const{canvas:c,images:m,selectedImages:y}=e();if(!c)return;const w=m.find(f=>f.id===n);w&&w.fabricObject&&(c.remove(w.fabricObject),c.renderAll()),t({images:m.filter(f=>f.id!==n),selectedImages:y.filter(f=>f!==n)})},selectImage:(n,c=!1)=>{const{selectedImages:m,isMultiSelectMode:y}=e();if(c||y){const s=m.includes(n)?m.filter(u=>u!==n):[...m,n];t({selectedImages:s})}else t({selectedImages:[n]});const{images:w,canvas:f}=e();if(f){const s=e().selectedImages;w.forEach(u=>{if(u.fabricObject){const h=s.includes(u.id);u.fabricObject.set({borderColor:h?"#ef4444":"#2563eb",cornerColor:h?"#ef4444":"#2563eb"})}}),f.renderAll()}},selectAllImages:()=>{const{images:n}=e();t({selectedImages:n.map(m=>m.id)});const{canvas:c}=e();c&&(n.forEach(m=>{m.fabricObject&&m.fabricObject.set({borderColor:"#ef4444",cornerColor:"#ef4444"})}),c.renderAll())},clearSelection:()=>{t({selectedImages:[]});const{images:n,canvas:c}=e();c&&(n.forEach(m=>{m.fabricObject&&m.fabricObject.set({borderColor:"#2563eb",cornerColor:"#2563eb"})}),c.renderAll())},deleteSelectedImages:()=>{const{selectedImages:n}=e();n.forEach(c=>{e().removeImage(c)}),t({selectedImages:[]})},toggleMultiSelectMode:()=>{const{isMultiSelectMode:n}=e();t({isMultiSelectMode:!n}),n||e().clearSelection()},arrangeImages:n=>{const{images:c,canvas:m}=e();if(!m||c.length===0)return;const y=m.width||800,w=m.height||600,f=20,s=y-f*2,u=w-f*2;c.forEach((h,r)=>{if(!h.fabricObject)return;let o=f,i=f;switch(n){case"grid":const l=Math.ceil(Math.sqrt(c.length)),d=s/l,a=u/Math.ceil(c.length/l);o=f+r%l*d+d/2,i=f+Math.floor(r/l)*a+a/2;break;case"horizontal":const g=s/c.length;o=f+r*g+g/2,i=w/2;break;case"vertical":const p=u/c.length;o=y/2,i=f+r*p+p/2;break}h.fabricObject.set({left:o,top:i}),h.position={x:o,y:i}}),m.renderAll()},getSelectedImages:()=>{const{images:n,selectedImages:c}=e();return n.filter(m=>c.includes(m.id))},getSelectionBounds:()=>{const n=e().getSelectedImages();if(n.length===0)return null;const c=n.map(y=>y.fabricObject).filter(y=>y!==null);if(c.length===0)return null;const m={left:Math.min(...c.map(y=>y.left||0)),top:Math.min(...c.map(y=>y.top||0)),right:Math.max(...c.map(y=>(y.left||0)+(y.width||0)*(y.scaleX||1))),bottom:Math.max(...c.map(y=>(y.top||0)+(y.height||0)*(y.scaleY||1)))};return{images:n,bounds:{left:m.left,top:m.top,width:m.right-m.left,height:m.bottom-m.top}}}}));function Ln(t){const e=t.split(",")[1]||t;return Math.floor(e.length*.75)}async function It(t,e={}){const{maxWidth:n=1024,maxHeight:c=1024,quality:m=.8,maxSizeKB:y=3500,format:w="jpeg"}=e,f=Ln(t);return new Promise((s,u)=>{const h=new Image;h.onload=async()=>{try{const r=document.createElement("canvas"),o=r.getContext("2d");let{width:i,height:l}=Ng(h.width,h.height,n,c);r.width=i,r.height=l,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.drawImage(h,0,0,i,l);let d=m,a,g;do a=r.toDataURL(`image/${w}`,d),g=Ln(a),console.log(`🔧 Compression attempt: ${Math.round(g/1024)}KB at quality ${d}`),g>y*1024&&(d>.3?d-=.1:(i=Math.floor(i*.8),l=Math.floor(l*.8),r.width=i,r.height=l,o.clearRect(0,0,i,l),o.drawImage(h,0,0,i,l),d=.7));while(g>y*1024&&(d>.2||i>200));const p=f/g;console.log(`✅ Image compressed: ${Math.round(f/1024)}KB → ${Math.round(g/1024)}KB (${Math.round(p*100)/100}x reduction)`),s({dataURL:a,originalSize:f,compressedSize:g,compressionRatio:p})}catch(r){u(r)}},h.onerror=()=>u(new Error("Failed to load image for compression")),h.src=t})}function Ng(t,e,n,c){let m=t,y=e;return m>n&&(y=y*n/m,m=n),y>c&&(m=m*c/y,y=c),{width:Math.floor(m),height:Math.floor(y)}}async function js(t,e={}){const n=[];for(const c of t)try{const m=await It(c,e);n.push(m)}catch(m){console.error("Failed to compress image:",m);const y=Ln(c);n.push({dataURL:c,originalSize:y,compressedSize:y,compressionRatio:1})}return n}class Rg{constructor(){ba(this,"config");this.config={baseUrl:"https://omnicanvas-backend.vercel.app/api",endpoints:{generateImage:"/ai/generate-image",mergeImages:"/ai/merge-images",transferStyle:"/ai/transfer-style",generateSimilar:"/ai/generate-similar",elevenlabs:"/ai/elevenlabs",generateComic:"/ai/generate-comic",editWithWords:"/ai/edit-with-words",blendProduct:"/ai/blend-product",generateVideo:"/ai/generate-video",generateText:"/ai/generate-text"}}}configure(e){e&&(this.config.baseUrl=e)}async generateImage(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt,width:e.width||512,height:e.height||512,provider:"gemini"})});if(!n.ok){const m=await n.text();throw new Error(`Backend API error: ${n.status} - ${m}`)}const c=await n.json();return{url:c.imageUrl||c.url,width:c.width||e.width||512,height:c.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",...c.metadata}}}catch(n){throw console.error("Image generation error:",n),n}}async imageToImage(e){try{console.log("🎨 Frontend AI Image-to-Image called!"),console.log("📝 Request details:",{prompt:e.prompt.substring(0,100)+"...",imageUrl:e.imageUrl.substring(0,50)+"...",width:e.width,height:e.height,strength:e.strength});let n=e.imageUrl;if(e.imageUrl.startsWith("data:")){console.log("🔧 Compressing reference image for image-to-image...");const y=Ln(e.imageUrl);console.log(`📏 Original image size: ${Math.round(y/1024)}KB`);const w=await It(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3});n=w.dataURL,console.log(`✅ Compressed image size: ${Math.round(w.compressedSize/1024)}KB`)}const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt,imageUrl:n,width:e.width||512,height:e.height||512,strength:e.strength||.7,provider:"gemini",mode:"image-to-image"})});if(!c.ok){const y=await c.text();throw new Error(`Backend API error: ${c.status} - ${y}`)}const m=await c.json();return{url:m.imageUrl||m.url,width:m.width||e.width||512,height:m.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",mode:"image-to-image",referenceImage:e.imageUrl,strength:e.strength||.7,...m.metadata}}}catch(n){throw console.error("Image-to-image generation error:",n),n}}async mergeImages(e,n){try{console.log("🎨 Backend AI Merge - Images:",e.length,"Prompt:",n);const c=e.filter(s=>s.startsWith("data:")),m=e.filter(s=>!s.startsWith("data:"));let y=[...m];if(c.length>0){console.log("🔧 Compressing",c.length,"data URLs on client side...");const u=c.map(i=>Ln(i)).reduce((i,l)=>i+l,0);console.log(`📏 Original total size: ${Math.round(u/1024)}KB`);const h=await js(c,{maxWidth:800,maxHeight:800,quality:.6,format:"jpeg",maxSizeKB:1500}),r=h.map(i=>i.dataURL),o=h.reduce((i,l)=>i+l.compressedSize,0);console.log(`✅ Compressed total size: ${Math.round(o/1024)}KB (${Math.round(u/o*100)/100}x reduction)`),y=[...m,...r]}const w=await fetch(`${this.config.baseUrl}${this.config.endpoints.mergeImages}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrls:y,prompt:n,provider:"gemini"})});if(!w.ok){const s=await w.text();throw console.error("Backend merge error:",s),new Error(`Backend merge error: ${w.status}`)}const f=await w.json();return console.log("✅ Backend merge successful:",f),f.imageUrl||f.url}catch(c){throw console.error("Backend merge failed:",c),c}}async transferStyle(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.transferStyle}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.imageUrl,style:e.style,provider:"gemini"})});if(!n.ok){const m=await n.text();throw new Error(`Style transfer error: ${n.status} - ${m}`)}const c=await n.json();return c.imageUrl||c.url}catch(n){throw console.error("Style transfer error:",n),n}}async generateSimilar(e){try{console.log("🌟 Calling generateSimilar API with",e.images.length,"images");const n=e.images.filter(f=>f.startsWith("data:")),c=e.images.filter(f=>!f.startsWith("data:"));let m=[...c];if(n.length>0){console.log("🔧 Compressing",n.length,"data URLs for generateSimilar...");const s=(await js(n,{maxWidth:768,maxHeight:768,quality:.7,format:"jpeg",maxSizeKB:1800})).map(u=>u.dataURL);m=[...c,...s]}const y=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateSimilar}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrls:m,prompt:e.prompt,aspectRatio:e.aspectRatio||"1:1",provider:"gemini"})});if(!y.ok){const f=await y.text();throw console.error("Generate similar API error:",f),new Error(`Generate similar error: ${y.status} - ${f}`)}const w=await y.json();return console.log("✅ Generate similar API response:",w),w.imageUrl||w.url}catch(n){throw console.error("Generate similar error:",n),n}}async generateVoice(e,n){try{const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.elevenlabs}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,voiceId:n||"default",provider:"elevenlabs"})});if(!c.ok){const y=await c.text();throw new Error(`Voice generation error: ${c.status} - ${y}`)}const m=await c.json();return m.audioUrl||m.url}catch(c){throw console.error("Voice generation error:",c),c}}async generateComic(e){try{console.log("📚 Generating comic with StoryShop API");let n=e.characterImage,c=e.productImage;if(e.characterImage&&e.characterImage.startsWith("data:")){console.log("🔧 Compressing character image for comic generation...");const w=await It(e.characterImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});n=w.dataURL,console.log(`✅ Character image compressed: ${Math.round(w.compressedSize/1024)}KB`)}if(e.productImage&&e.productImage.startsWith("data:")){console.log("🔧 Compressing product image for comic generation...");const w=await It(e.productImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});c=w.dataURL,console.log(`✅ Product image compressed: ${Math.round(w.compressedSize/1024)}KB`)}const m=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateComic}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyPrompt:e.storyPrompt,characterImage:n,productImage:c,style:e.style,panelCount:e.panelCount||4,provider:"gemini"})});if(!m.ok){const w=await m.text();throw new Error(`Comic generation error: ${m.status} - ${w}`)}return(await m.json()).panelUrls||[]}catch(n){throw console.error("Comic generation error:",n),n}}async editWithWords(e){try{let n=e.imageUrl,c=e.maskUrl;e.imageUrl.startsWith("data:")&&(console.log("🔧 Compressing image for editWithWords..."),n=(await It(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.maskUrl&&e.maskUrl.startsWith("data:")&&(console.log("🔧 Compressing mask for editWithWords..."),c=(await It(e.maskUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"png",maxSizeKB:1e3})).dataURL);const m=await fetch(`${this.config.baseUrl}${this.config.endpoints.editWithWords}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:n,editPrompt:e.editPrompt,maskUrl:c,provider:"gemini"})});if(!m.ok){const w=await m.text();throw new Error(`Edit with words error: ${m.status} - ${w}`)}const y=await m.json();return y.imageUrl||y.url}catch(n){throw console.error("Edit with words error:",n),n}}async blendProduct(e){try{let n=e.sceneImageUrl,c=e.productImageUrl;e.sceneImageUrl.startsWith("data:")&&(console.log("🔧 Compressing scene image for blendProduct..."),n=(await It(e.sceneImageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.productImageUrl.startsWith("data:")&&(console.log("🔧 Compressing product image for blendProduct..."),c=(await It(e.productImageUrl,{maxWidth:512,maxHeight:512,quality:.8,format:"jpeg",maxSizeKB:1500})).dataURL);const m=await fetch(`${this.config.baseUrl}${this.config.endpoints.blendProduct}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sceneImageUrl:n,productImageUrl:c,blendPrompt:e.blendPrompt,provider:"gemini"})});if(!m.ok){const w=await m.text();throw new Error(`Product blend error: ${m.status} - ${w}`)}const y=await m.json();return y.imageUrl||y.url}catch(n){throw console.error("Product blend error:",n),n}}async generateVideoFromPanels(e){try{console.log("🎬 Generating video from panels...");const n=e.panelUrls.filter(f=>f.startsWith("data:")),c=e.panelUrls.filter(f=>!f.startsWith("data:"));let m=[...c];if(n.length>0){console.log("🔧 Compressing",n.length,"panel images for video generation...");const s=n.map(o=>Ln(o)).reduce((o,i)=>o+i,0);console.log(`📏 Original panels total size: ${Math.round(s/1024)}KB`);const u=await js(n,{maxWidth:720,maxHeight:720,quality:.75,format:"jpeg",maxSizeKB:1e3}),h=u.map(o=>o.dataURL),r=u.reduce((o,i)=>o+i.compressedSize,0);console.log(`✅ Compressed panels total size: ${Math.round(r/1024)}KB (${Math.round(s/r*100)/100}x reduction)`),m=[...c,...h]}const y=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateVideo}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({panelUrls:m,narrationText:e.narrationText,voiceId:e.voiceId||"default",duration:e.duration||8,provider:"fal-ai"})});if(!y.ok){const f=await y.text();throw new Error(`Video generation error: ${y.status} - ${f}`)}const w=await y.json();return w.videoUrl||w.url}catch(n){throw console.error("Video generation error:",n),n}}async generateText(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateText}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt,maxLength:e.maxLength||100})});if(!n.ok){const m=await n.text();throw new Error(`Text generation error: ${n.status} - ${m}`)}return(await n.json()).text}catch(n){throw console.error("Text generation error:",n),n}}async testConnection(){try{return(await fetch(`${this.config.baseUrl}/health`,{method:"GET"})).ok}catch(e){return console.error("Backend connection test failed:",e),!1}}}const xe=new Rg,Bg=({x:t,y:e,visible:n,selectedCount:c,onClose:m,onMergeImages:y,onStyleTransfer:w,onDuplicate:f,onDelete:s,onBringToFront:u,onSendToBack:h,onRotate:r,onGenerateSimilar:o,onExportSelected:i,onGroupSelection:l,onIntelligentCompose:d,onWearAccessory:a,onSceneCompose:g,onCreativeBlend:p,onPlayVideo:v,hasVideoThumbnail:x})=>{if(!n)return null;console.log("🔥🔥🔥 NEW AI CONTEXT MENU RENDERING! Time:",new Date().toLocaleTimeString()),console.log("🔥 NewContextMenu props:",{visible:n,x:t,y:e,selectedCount:c}),console.log("🔥 AI handlers available:",{onIntelligentCompose:!!d,onWearAccessory:!!a,onSceneCompose:!!g,onCreativeBlend:!!p});const C=[...x&&c===1&&v?[{icon:eh,label:"🎬 Play Video",onClick:v,className:"text-orange-600 hover:bg-orange-50 font-semibold",separator:!0}]:[],...c>=2?[{icon:Yd,label:`🧠 AI Smart Compose (${c})`,onClick:d,className:"text-blue-600 hover:bg-blue-50 font-semibold",separator:!1},{icon:nh,label:"✨ Creative Blend",onClick:p,className:"text-pink-600 hover:bg-pink-50",separator:!0}]:[],...c>=1?[{icon:To,label:"🌟 Generate Similar",onClick:o,className:"text-green-600 hover:bg-green-50",separator:!0}]:[],...c>=1?[{icon:Kd,label:"Save Selected",onClick:i,className:"text-blue-600 hover:bg-blue-50",separator:!1},{icon:$d,label:c>1?`Duplicate ${c}`:"Duplicate",onClick:f,className:"hover:bg-gray-50",separator:!1},{icon:th,label:c>1?`Delete ${c}`:"Delete",onClick:s,className:"text-red-600 hover:bg-red-50",separator:!1}]:[]],S={left:Math.min(t,window.innerWidth-250),top:Math.min(e,window.innerHeight-C.length*40)};return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"fixed inset-0 z-10",onClick:m}),b.jsxs("div",{className:"fixed z-20 bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[200px]",style:S,onClick:T=>T.stopPropagation(),children:[b.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 bg-gradient-to-r from-blue-50 to-purple-50",children:["✨ AI Actions - ",c," selected"]}),C.map((T,P)=>{const R=T.icon;return b.jsxs("div",{children:[b.jsxs("button",{onClick:z=>{z.stopPropagation(),T.onClick(),m()},className:`w-full px-3 py-2 text-left text-sm flex items-center space-x-2 transition-colors ${T.className}`,children:[b.jsx(R,{className:"w-4 h-4 flex-shrink-0"}),b.jsx("span",{className:"flex-1",children:T.label})]}),T.separator&&b.jsx("div",{className:"border-t border-gray-100 my-1"})]},P)})]})]})},zg={width:5e3,height:5e3,backgroundColor:"#ffffff",selection:!0,renderOnAddRemove:!0,centeredScaling:!0,centeredRotation:!0,preserveObjectStacking:!0,targetFindTolerance:4},Ug=()=>{const t=ue.useRef(null),e=ue.useRef(null),[n,c]=ue.useState({visible:!1,x:0,y:0,selectedObjects:[]}),[m,y]=ue.useState({x:0,y:0}),[w,f]=ue.useState({x:0,y:0}),[s,u]=ue.useState(!1),h=()=>{r&&(r.absolutePan(new He.fabric.Point(0,0)),r.setZoom(1),T(1),r.renderAll())},{canvas:r,setCanvas:o,tool:i,brushSize:l,brushColor:d,setIsDrawing:a,addToHistory:g,importImage:p,zoom:v,zoomIn:x,zoomOut:C,resetView:S,setZoom:T,setPan:P}=pr(),{setCanvas:R,selectImage:z,isMultiSelectMode:J}=Ca();ue.useEffect(()=>{if(!t.current||!e.current)return;const E=new He.fabric.Canvas(t.current,{...zg,width:e.current.clientWidth,height:e.current.clientHeight,selection:!0,preserveObjectStacking:!0,fireRightClick:!0,fireMiddleClick:!0,skipTargetFind:!1,targetFindTolerance:4,perPixelTargetFind:!1,uniformScaling:!0,stopContextMenu:!1,selectionBorderColor:"rgba(46, 115, 252, 0.8)",selectionLineWidth:2,selectionDashArray:[5,5],objectCaching:!1});E.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),E.selection=!0,E.preserveObjectStacking=!0,console.log("Canvas initialized with multi-selection enabled:",E.selection),E.on("object:added",Q=>{const K=Q.target;console.log("📦 Object added to canvas:",K.type),K&&(K.set({selectable:!0,evented:!0,hasControls:!0,hasBorders:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,hoverCursor:"move",moveCursor:"move"}),console.log("✅ Object configured for selection:",K.type,"selectable:",K.selectable))}),E.setWidth(e.current.clientWidth),E.setHeight(e.current.clientHeight),E.freeDrawingBrush=new He.fabric.PencilBrush(E),E.freeDrawingBrush.width=l,E.freeDrawingBrush.color=d,o(E),R(E);let I=null;const W=()=>{E._skipHistory||(I&&clearTimeout(I),I=setTimeout(()=>{const Q=JSON.stringify(E.toJSON());g(Q)},300))};E.on("path:created",W),E.on("object:modified",W),E.on("selection:created",Q=>{var K;console.log("🎯 Selection created:",((K=Q.selected)==null?void 0:K.length)||0,"objects"),Q.selected&&Q.selected.forEach(H=>{console.log("  - Selected object type:",H.type)}),J&&Q.selected&&Q.selected.forEach(H=>{if(H.type==="image"){const se=H.imageId||`img_${H.cacheKey}`;z(se,!0)}})}),E.on("selection:updated",Q=>{var K;console.log("🔄 Selection updated:",((K=Q.selected)==null?void 0:K.length)||0,"objects"),Q.selected&&Q.selected.forEach(H=>{console.log("  - Updated selection object type:",H.type)})}),E.on("selection:cleared",()=>{console.log("🗑️ Selection cleared"),c(Q=>({...Q,selectedObjects:[]}))}),E.on("mouse:down",Q=>{const K=Q.e;if(console.log("🖱️ Mouse down - Button:",K.button,"Shift:",K.shiftKey,"Ctrl:",K.ctrlKey,"Cmd:",K.metaKey),a(!0),K.button===2){console.log("🔥 RIGHT CLICK DETECTED! Preventing default..."),K.preventDefault(),K.stopPropagation();const H=E.getActiveObject(),se=H?[H]:[];if(H&&H.type==="activeSelection"){const ce=H;se.length=0,ce.forEachObject(fe=>se.push(fe))}console.log("🔥 SHOWING CONTEXT MENU! activeObject:",H,"selectedObjects:",se.length),c({visible:!0,x:K.clientX,y:K.clientY,selectedObjects:se})}else{c(se=>({...se,visible:!1}));const H=E.findTarget(K,!1);console.log("🎯 Target found:",(H==null?void 0:H.type)||"none"),K.shiftKey&&!H?(console.log("🖐️ Starting pan mode (Shift+drag on empty space)"),F=!0,E.isDragging=!0,E.selection=!1,Y=K.clientX,Z=K.clientY):(console.log("✅ Ensuring selection is enabled for multi-selection"),E.selection=!0,E.isDragging=!1,(K.ctrlKey||K.metaKey)&&console.log("🔥 Ctrl/Cmd detected - multi-selection should work!"))}}),E.on("mouse:up",()=>{a(!1),F&&(console.log("🖐️ Ending pan mode"),F=!1,E.isDragging=!1,E.selection=!0)});const q=E.getElement(),U=q.parentElement,N=Q=>(console.log("🔥 PREVENTING CONTEXT MENU on:",Q.target),Q.preventDefault(),Q.stopPropagation(),!1);q.addEventListener("contextmenu",N),U&&U.addEventListener("contextmenu",N),e.current&&e.current.addEventListener("contextmenu",N);const G=()=>{e.current&&(E.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),E.renderAll())};window.addEventListener("resize",G);const A=Q=>{const K=Q.e;if(K.ctrlKey||K.metaKey){K.preventDefault();const H=K.deltaY;let se=E.getZoom();se*=.999**H,se>5&&(se=5),se<.1&&(se=.1);const ce=new He.fabric.Point(Q.e.offsetX,Q.e.offsetY);E.zoomToPoint(ce,se),T(se)}};E.on("mouse:wheel",A);let F=!1,Y=0,Z=0;return E.on("mouse:move",Q=>{const K=E.getPointer(Q.e);y({x:Math.round(K.x),y:Math.round(K.y)});const H=E.getCenter();if(f({x:Math.round(H.left),y:Math.round(H.top)}),F){const se=Q.e,ce=E.viewportTransform;ce[4]+=se.clientX-Y,ce[5]+=se.clientY-Z,E.requestRenderAll(),Y=se.clientX,Z=se.clientY}}),E.on("mouse:wheel",Q=>{const K=Q.e;if(!K.ctrlKey&&!K.metaKey){K.preventDefault();const H=E.viewportTransform;H[4]-=K.deltaX||0,H[5]-=K.deltaY||0,E.requestRenderAll()}}),()=>{window.removeEventListener("resize",G),E.dispose()}},[]),ue.useEffect(()=>{r&&r.freeDrawingBrush&&(r.freeDrawingBrush.width=l,r.freeDrawingBrush.color=d)},[r,l,d]),ue.useEffect(()=>{const E=I=>{if(r){if((I.ctrlKey||I.metaKey)&&["z","y","a","c","v","x","+","-","=","0"].includes(I.key.toLowerCase())&&I.preventDefault(),(I.ctrlKey||I.metaKey)&&I.key==="z"&&!I.shiftKey)pr.getState().undo();else if((I.ctrlKey||I.metaKey)&&I.key==="y"||(I.ctrlKey||I.metaKey)&&I.shiftKey&&I.key==="Z")pr.getState().redo();else if((I.ctrlKey||I.metaKey)&&I.key==="a"){const W=r.getObjects();r.discardActiveObject();const q=new He.fabric.ActiveSelection(W,{canvas:r});r.setActiveObject(q),r.requestRenderAll()}else if((I.ctrlKey||I.metaKey)&&(I.key==="+"||I.key==="="))x();else if((I.ctrlKey||I.metaKey)&&I.key==="-")C();else if((I.ctrlKey||I.metaKey)&&I.key==="0")S();else if(I.key==="Delete"||I.key==="Backspace"){const W=document.activeElement;if(!(W&&(W.tagName==="INPUT"||W.tagName==="TEXTAREA"||W.getAttribute("contenteditable")==="true"))){const U=r.getActiveObject();U&&(U.type==="activeSelection"?(U.forEachObject(G=>{r.remove(G)}),r.discardActiveObject()):r.remove(U),r.requestRenderAll())}}}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[r]);const ne=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(q=>q.type==="image").map(q=>{var U;return((U=q._originalElement)==null?void 0:U.src)||q.src}).filter(Boolean);if(E.length<2){alert("請選擇至少 2 張圖片來合併");return}const I=window.prompt("請輸入合併指令：","將這些圖片融合成藝術拼貼");if(!I)return;const W=await xe.mergeImages(E,I);await p(W),alert("圖片合併完成！")}catch(E){console.error("合併失敗:",E),alert("合併失敗: "+E)}},ie=async()=>{var W;if(n.selectedObjects.length===0)return;const E=n.selectedObjects.find(q=>q.type==="image");if(!E){alert("請選擇一張圖片來套用風格");return}const I=window.prompt("請輸入風格描述：","梵高星夜風格");if(I)try{const q=((W=E._originalElement)==null?void 0:W.src)||E.src,U=await xe.transferStyle({imageUrl:q,style:I});await p(U),alert("風格轉換完成！")}catch(q){alert("風格轉換失敗: "+q)}},te=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{E.clone(I=>{I.set({left:(I.left||0)+20,top:(I.top||0)+20}),r.add(I)})}),r.renderAll())},re=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{r.remove(E)}),r.renderAll())},oe=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{r.bringToFront(E)}),r.renderAll())},le=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{r.sendToBack(E)}),r.renderAll())},V=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{const I=E.angle||0;E.set({angle:I+90})}),r.renderAll())},_=async()=>{if(n.selectedObjects.length===0)return;console.log("🌟 Generating similar images from selected objects:",n.selectedObjects.length);const E="Generate a very similar object or item with the same category, style, and visual characteristics. Keep the same type of object, similar colors, materials, and overall appearance. Maintain the same scene context and background style.";try{const I=j("🌟 Analyzing selected objects and generating similar content...",1),W=[];for(const U of n.selectedObjects)if(U.type==="image"){const N=U;N.getSrc&&W.push(N.getSrc())}if(W.length===0){D(),alert("Please select at least one image to generate similar content");return}console.log("🎯 Using images for similarity generation:",W.length);const q=await xe.generateSimilar({images:W,prompt:`Create an image of the exact same type of object/item as shown in the reference image(s). If it's sunglasses, generate different sunglasses. If it's a car, generate a different car. ${E}. Do NOT change the object category - keep it as the same type of item but with variations in design, color, or style.`,aspectRatio:"1:1"});D(),q?(await p(q),console.log("✅ Similar image generated and added to canvas!")):(console.error("❌ No image generated from similarity API"),alert("Failed to generate similar image - no result returned"))}catch(I){console.error("❌ Generate similar error:",I),D(),alert("Failed to generate similar image: "+I)}},O=async()=>{if(!(!r||n.selectedObjects.length===0)){console.log("🖼️ Exporting selected objects:",n.selectedObjects.length);try{let E=1/0,I=1/0,W=-1/0,q=-1/0;n.selectedObjects.forEach(Z=>{const Q=Z.getBoundingRect();E=Math.min(E,Q.left),I=Math.min(I,Q.top),W=Math.max(W,Q.left+Q.width),q=Math.max(q,Q.top+Q.height)});const U=20,N=W-E+U*2,G=q-I+U*2;console.log("📐 Export bounds:",{minX:E,minY:I,maxX:W,maxY:q,exportWidth:N,exportHeight:G});const A=document.createElement("canvas");A.width=N,A.height=G;const F=new He.fabric.Canvas(A);F.setWidth(N),F.setHeight(G),F.backgroundColor="transparent";const Y=n.selectedObjects.map(Z=>new Promise(Q=>{Z.clone(K=>{const H=Z.getBoundingRect();K.set({left:H.left-E+U,top:H.top-I+U}),F.add(K),console.log("📦 Cloned object:",K.type,"at",K.left,K.top),Q()})}));await Promise.all(Y),F.renderAll(),setTimeout(()=>{const Z=F.toDataURL({format:"png",quality:1,multiplier:2});if(Z&&Z!=="data:,"){const Q=document.createElement("a");Q.download=`selected-objects-${Date.now()}.png`,Q.href=Z,document.body.appendChild(Q),Q.click(),document.body.removeChild(Q),console.log("✅ Export completed successfully")}else console.error("❌ Failed to generate image data");F.dispose()},200)}catch(E){console.error("❌ Export error:",E)}}},j=(E,I=0)=>{if(!r)return null;const W=`
      <svg width="400" height="200" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="progress-bg" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.9" />
            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:0.9" />
          </linearGradient>
          <linearGradient id="progress-bar" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#4ade80;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#22c55e;stop-opacity:1" />
          </linearGradient>
        </defs>
        
        <!-- Background -->
        <rect width="100%" height="100%" rx="12" fill="url(#progress-bg)" stroke="#ffffff" stroke-width="2"/>
        
        <!-- Progress bar background -->
        <rect x="30" y="140" width="340" height="8" rx="4" fill="rgba(255,255,255,0.2)"/>
        
        <!-- Progress bar -->
        <rect x="30" y="140" width="${Math.max(10,I*85)}" height="8" rx="4" fill="url(#progress-bar)">
          <animate attributeName="width" values="${I*85};${(I+.2)*85};${I*85}" dur="2s" repeatCount="indefinite"/>
        </rect>
        
        <!-- Icon -->
        <circle cx="200" cy="80" r="25" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="2">
          <animate attributeName="r" values="25;30;25" dur="2s" repeatCount="indefinite"/>
        </circle>
        <text x="200" y="88" text-anchor="middle" fill="#ffffff" font-size="24">✨</text>
        
        <!-- Message -->
        <text x="200" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">
          ${E}
        </text>
        
        <!-- Dots animation -->
        <text x="330" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14">
          <animate attributeName="opacity" values="0;1;0" dur="1.5s" repeatCount="indefinite"/>
          .
        </text>
        <text x="340" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14">
          <animate attributeName="opacity" values="0;1;0" dur="1.5s" begin="0.5s" repeatCount="indefinite"/>
          .
        </text>
        <text x="350" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14">
          <animate attributeName="opacity" values="0;1;0" dur="1.5s" begin="1s" repeatCount="indefinite"/>
          .
        </text>
      </svg>
    `,q=`data:image/svg+xml,${encodeURIComponent(W)}`;return new Promise(U=>{He.fabric.Image.fromURL(q,N=>{N&&(N.set({left:r.width/2,top:r.height/2,originX:"center",originY:"center",selectable:!1,evented:!1,isProgressImage:!0}),r.add(N),r.bringToFront(N),r.renderAll(),U(N))})})},D=()=>{if(!r)return;r.getObjects().filter(I=>I.isProgressImage).forEach(I=>r.remove(I)),r.renderAll()},X=async(E,I,W)=>{if(!(!r||!E))return r.remove(E),await j(I,W)},M=async()=>{if(n.selectedObjects.length<2)return;let E,I=null;try{const W=n.selectedObjects.filter(U=>U.type==="image").map(U=>{var N;return((N=U._originalElement)==null?void 0:N.src)||U.src}).filter(Boolean);if(W.length<2){alert("Please select at least 2 images for AI composition");return}c(U=>({...U,visible:!1})),I=await j(`Analyzing ${W.length} images`,.1),E=setTimeout(()=>{console.warn("⚠️ Progress timeout - removing progress image"),D(),alert("AI processing took too long - please try again")},3e4),setTimeout(async()=>{I&&(I=await X(I,"AI is composing your masterpiece",.4))},1e3),setTimeout(async()=>{I&&(I=await X(I,"Rendering high-quality result",.7))},2e3);const q=await xe.mergeImages(W,"Intelligent auto-compose - merge the key subjects and elements naturally into a cohesive, professional composition");clearTimeout(E),I&&(I=await X(I,"Adding final touches",.9)),setTimeout(async()=>{try{D(),await p(q),console.log(`✅ AI Smart Composition completed! Merged ${W.length} images intelligently.`)}catch(U){console.error("Failed to import generated image:",U),D(),alert("Image generation completed but failed to display on canvas: "+U)}},500)}catch(W){console.error("AI Composition failed:",W),E&&clearTimeout(E),D(),alert("AI Composition failed: "+W)}},k=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(W=>W.type==="image").map(W=>{var q;return((q=W._originalElement)==null?void 0:q.src)||W.src}).filter(Boolean);if(E.length<2)return;c(W=>({...W,visible:!1}));const I=await xe.mergeImages(E,"Make the person wear or use the accessories/items naturally. Ensure realistic lighting, shadows, and proportions.");await p(I),alert("🥽 Accessory composition completed! Items naturally integrated.")}catch(E){console.error("Accessory composition failed:",E),alert("Accessory composition failed: "+E)}},L=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(W=>W.type==="image").map(W=>{var q;return((q=W._originalElement)==null?void 0:q.src)||W.src}).filter(Boolean);if(E.length<2)return;c(W=>({...W,visible:!1}));const I=await xe.mergeImages(E,"Create a realistic scene by placing subjects into backgrounds naturally. Match lighting, shadows, and perspective perfectly.");await p(I),alert("🏞️ Scene integration completed! Objects naturally placed in scene.")}catch(E){console.error("Scene composition failed:",E),alert("Scene composition failed: "+E)}},B=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(W=>W.type==="image").map(W=>{var q;return((q=W._originalElement)==null?void 0:q.src)||W.src}).filter(Boolean);if(E.length<2)return;c(W=>({...W,visible:!1}));const I=await xe.mergeImages(E,"Create an artistic, creative blend that combines the best elements from all images in an innovative and visually stunning way.");await p(I),alert("✨ Creative blend completed! Innovative artistic fusion created.")}catch(E){console.error("Creative blend failed:",E),alert("Creative blend failed: "+E)}},$=()=>{if(!r||n.selectedObjects.length<=1)return;const E=new He.fabric.Group(n.selectedObjects,{left:Math.min(...n.selectedObjects.map(I=>I.left||0)),top:Math.min(...n.selectedObjects.map(I=>I.top||0))});n.selectedObjects.forEach(I=>r.remove(I)),r.add(E),r.setActiveObject(E),r.renderAll()};return b.jsxs("div",{ref:e,className:"canvas-container flex-1 relative",onContextMenu:E=>(console.log("🔥 CONTAINER RIGHT CLICK!"),E.preventDefault(),E.stopPropagation(),!1),onMouseDown:E=>{console.log("🔥 CONTAINER MOUSE DOWN - Button:",E.button),E.button===2&&(console.log("🔥 CONTAINER RIGHT CLICK DETECTED!"),E.preventDefault(),E.stopPropagation(),c({visible:!0,x:E.clientX,y:E.clientY,selectedObjects:(r==null?void 0:r.getActiveObjects())||[]}))},children:[b.jsx("canvas",{ref:t}),b.jsx("div",{className:"absolute top-4 right-4 bg-white bg-opacity-90 rounded-lg px-3 py-2 shadow-lg border border-gray-200",children:b.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{children:"📍 Mouse:"}),b.jsxs("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:["x:",m.x," y:",m.y]})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{children:"🎯 Center:"}),b.jsxs("span",{className:"font-mono bg-blue-100 px-2 py-0.5 rounded",children:["x:",w.x," y:",w.y]})]}),b.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[b.jsx("button",{onClick:h,className:"text-xs px-2 py-1 bg-green-100 hover:bg-green-200 text-green-700 rounded transition-colors",title:"Go to origin (0,0)",children:"🏠 Origin"}),b.jsx("button",{onClick:()=>u(!s),className:`text-xs px-2 py-1 rounded transition-colors ${s?"bg-purple-200 text-purple-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,title:"Toggle grid",children:"⊞ Grid"})]})]})}),b.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center space-x-2",children:[b.jsx("button",{onClick:C,className:"bg-white bg-opacity-75 hover:bg-opacity-100 rounded p-2 text-gray-600 transition-all",title:"Zoom out (Ctrl+Mouse wheel)",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})})}),b.jsxs("button",{onClick:S,className:"bg-white bg-opacity-75 hover:bg-opacity-100 rounded px-3 py-1 text-sm text-gray-600 min-w-[60px] transition-all",title:"Reset zoom and pan",children:[Math.round(v*100),"%"]}),b.jsx("button",{onClick:x,className:"bg-white bg-opacity-75 hover:bg-opacity-100 rounded p-2 text-gray-600 transition-all",title:"Zoom in (Ctrl+Mouse wheel)",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})]}),b.jsx("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 rounded-lg px-3 py-2 text-xs text-gray-600 shadow-lg border border-gray-200",children:b.jsxs("div",{className:"space-y-1",children:[b.jsxs("div",{children:["🔍 ",b.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Cmd"})," + Trackpad: Zoom"]}),b.jsx("div",{children:"🖐️ Trackpad: Move canvas"}),b.jsxs("div",{children:["✨ ",b.jsx("kbd",{className:"px-1 py-0.5 bg-blue-100 rounded text-xs",children:"Shift"})," + Click: Multi-select"]}),b.jsxs("div",{children:["🎯 ",b.jsx("kbd",{className:"px-1 py-0.5 bg-purple-100 rounded text-xs",children:"Cmd"})," + Click: Add/Remove selection"]})]})}),b.jsx(Bg,{x:n.x,y:n.y,visible:n.visible,selectedCount:n.selectedObjects.length,onClose:()=>c(E=>({...E,visible:!1})),onMergeImages:ne,onStyleTransfer:ie,onDuplicate:te,onDelete:re,onBringToFront:oe,onSendToBack:le,onRotate:V,onGenerateSimilar:_,onExportSelected:O,onIntelligentCompose:M,onWearAccessory:k,onSceneCompose:L,onCreativeBlend:B,onGroupSelection:$})]})},Wg=[],Hg=()=>{const{tool:t,setTool:e,undo:n,redo:c,canUndo:m,canRedo:y,clearCanvas:w}=pr(),{addImages:f}=Ca(),s=h=>{e(h)},u=()=>{const h=document.createElement("input");h.type="file",h.accept="image/*",h.multiple=!0,h.onchange=async r=>{const o=r.target.files;o&&o.length>0&&await f(o,{autoArrange:!0,spacing:20,maxWidth:200,maxHeight:200})},h.click()};return b.jsxs("div",{className:"tool-panel w-16 flex flex-col items-center py-4 space-y-2",children:[b.jsx("div",{className:"flex flex-col space-y-1",children:b.jsx("button",{onClick:u,className:"w-10 h-10 rounded-lg bg-blue-100 hover:bg-blue-200 text-blue-600 flex items-center justify-center transition-all duration-200",title:"Import Multiple Images",children:b.jsx(Qd,{className:"w-5 h-5"})})}),b.jsx("div",{className:"w-8 h-px bg-gray-300 my-2"}),b.jsx("div",{className:"flex flex-col space-y-1",children:Wg.map(h=>{const r=h.icon,o=t===h.id;return b.jsx("button",{onClick:()=>s(h.id),className:`
                w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200
                ${o?"bg-primary-600 text-white shadow-md":"bg-gray-100 hover:bg-gray-200 text-gray-600"}
              `,title:`${h.label} (${h.shortcut})`,children:b.jsx(r,{className:"w-5 h-5"})},h.id)})}),b.jsxs("div",{className:"flex flex-col space-y-1",children:[b.jsx("button",{onClick:n,disabled:!m(),className:`
            w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200
            ${m()?"bg-gray-100 hover:bg-gray-200 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Undo (Ctrl+Z)",children:b.jsx(ag,{className:"w-5 h-5"})}),b.jsx("button",{onClick:c,disabled:!y(),className:`
            w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200
            ${y()?"bg-gray-100 hover:bg-gray-200 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Redo (Ctrl+Y)",children:b.jsx(ng,{className:"w-5 h-5"})})]}),b.jsx("div",{className:"w-8 h-px bg-gray-300 my-2"}),b.jsx("div",{className:"flex flex-col space-y-1",children:b.jsx("button",{onClick:w,className:"w-10 h-10 rounded-lg bg-red-100 hover:bg-red-200 text-red-600 flex items-center justify-center transition-all duration-200",title:"Clear Canvas",children:b.jsx(th,{className:"w-5 h-5"})})})]})};function Xg(t,e){let n;try{n=t()}catch{return}return{getItem:m=>{var y;const w=s=>s===null?null:JSON.parse(s,e==null?void 0:e.reviver),f=(y=n.getItem(m))!=null?y:null;return f instanceof Promise?f.then(w):w(f)},setItem:(m,y)=>n.setItem(m,JSON.stringify(y,e==null?void 0:e.replacer)),removeItem:m=>n.removeItem(m)}}const Ar=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(c){return Ar(c)(n)},catch(c){return this}}}catch(n){return{then(c){return this},catch(c){return Ar(c)(n)}}}},Yg=(t,e)=>(n,c,m)=>{let y={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:a=>a,version:0,merge:(a,g)=>({...g,...a}),...e},w=!1;const f=new Set,s=new Set;let u;try{u=y.getStorage()}catch{}if(!u)return t((...a)=>{console.warn(`[zustand persist middleware] Unable to update item '${y.name}', the given storage is currently unavailable.`),n(...a)},c,m);const h=Ar(y.serialize),r=()=>{const a=y.partialize({...c()});let g;const p=h({state:a,version:y.version}).then(v=>u.setItem(y.name,v)).catch(v=>{g=v});if(g)throw g;return p},o=m.setState;m.setState=(a,g)=>{o(a,g),r()};const i=t((...a)=>{n(...a),r()},c,m);let l;const d=()=>{var a;if(!u)return;w=!1,f.forEach(p=>p(c()));const g=((a=y.onRehydrateStorage)==null?void 0:a.call(y,c()))||void 0;return Ar(u.getItem.bind(u))(y.name).then(p=>{if(p)return y.deserialize(p)}).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==y.version){if(y.migrate)return y.migrate(p.state,p.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return p.state}).then(p=>{var v;return l=y.merge(p,(v=c())!=null?v:i),n(l,!0),r()}).then(()=>{g==null||g(l,void 0),w=!0,s.forEach(p=>p(l))}).catch(p=>{g==null||g(void 0,p)})};return m.persist={setOptions:a=>{y={...y,...a},a.getStorage&&(u=a.getStorage())},clearStorage:()=>{u==null||u.removeItem(y.name)},getOptions:()=>y,rehydrate:()=>d(),hasHydrated:()=>w,onHydrate:a=>(f.add(a),()=>{f.delete(a)}),onFinishHydration:a=>(s.add(a),()=>{s.delete(a)})},d(),l||i},Vg=(t,e)=>(n,c,m)=>{let y={storage:Xg(()=>localStorage),partialize:d=>d,version:0,merge:(d,a)=>({...a,...d}),...e},w=!1;const f=new Set,s=new Set;let u=y.storage;if(!u)return t((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${y.name}', the given storage is currently unavailable.`),n(...d)},c,m);const h=()=>{const d=y.partialize({...c()});return u.setItem(y.name,{state:d,version:y.version})},r=m.setState;m.setState=(d,a)=>{r(d,a),h()};const o=t((...d)=>{n(...d),h()},c,m);m.getInitialState=()=>o;let i;const l=()=>{var d,a;if(!u)return;w=!1,f.forEach(p=>{var v;return p((v=c())!=null?v:o)});const g=((a=y.onRehydrateStorage)==null?void 0:a.call(y,(d=c())!=null?d:o))||void 0;return Ar(u.getItem.bind(u))(y.name).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==y.version){if(y.migrate)return[!0,y.migrate(p.state,p.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,p.state];return[!1,void 0]}).then(p=>{var v;const[x,C]=p;if(i=y.merge(C,(v=c())!=null?v:o),n(i,!0),x)return h()}).then(()=>{g==null||g(i,void 0),i=c(),w=!0,s.forEach(p=>p(i))}).catch(p=>{g==null||g(void 0,p)})};return m.persist={setOptions:d=>{y={...y,...d},d.storage&&(u=d.storage)},clearStorage:()=>{u==null||u.removeItem(y.name)},getOptions:()=>y,rehydrate:()=>l(),hasHydrated:()=>w,onHydrate:d=>(f.add(d),()=>{f.delete(d)}),onFinishHydration:d=>(s.add(d),()=>{s.delete(d)})},y.skipHydration||l(),i||o},Gg=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?Yg(t,e):Vg(t,e),$g=Gg,Sa=wa()($g(t=>({currentLanguage:"en",setLanguage:e=>t({currentLanguage:e})}),{name:"language-storage"})),Kg={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"AI Assistant",tabs:{storyMaker:"Story Maker",generate:"Generate"},generate:{templates:{title:"Popular Nano Banana Templates (Click to use)",withSelection:"+ Selected Images",categories:{all:"All",creative:"🎨 Creative",professional:"💼 Professional",fun:"🎮 Fun"},items:{figurine:{title:"3D Figurine",description:"Desktop model"},handDrawn:{title:"Hand-drawn Process",description:"Sketch to final"},crossSection:{title:"3D Cross-section",description:"Internal structure"},restoration:{title:"Photo Restoration",description:"Colorize & repair"},idPhoto:{title:"Professional ID",description:"Business portrait"},product:{title:"Product Shot",description:"E-commerce photo"},interior:{title:"Interior Design",description:"Space makeover"},marketing:{title:"Marketing Material",description:"Social media"},tryOn:{title:"Virtual Try-on",description:"Outfit swap"},timeTravel:{title:"Time Travel",description:"Different eras"},petAdventure:{title:"Pet Adventures",description:"Fun scenarios"},ingredients:{title:"Food Breakdown",description:"Recipe guide"}},applied:"✨ Template applied! You can generate directly or modify the prompt above"},placeholder:"Describe what you want to generate...",generateButton:"Generate with Nano Banana",generating:"Generating with Nano Banana...",imageToImageMode:"🎨 Image-to-Image Mode",imageToImageDescription:"Your selected images will be combined with your prompt/template to generate new images.",quickEnhancements:"✨ Quick Enhancements (Click to toggle)",enhancementItems:["viral meme style","4K ultra HD","cinematic lighting","trending on artstation","octane render"],selectedImages:"images selected from canvas",invalidForTab:"Invalid for"},storyMaker:{title:"Story Maker",description:"Create 4-panel comic stories with consistent characters",styleLabel:"Art Style",characterLabel:"Main Character",productLabel:"Featured Product",storyPromptLabel:"Story Concept",generateButton:"Generate 4-Panel Comic",useFromCanvas:"Use from Canvas",uploadImage:"Upload Image",generating:"Generating panel",placeholder:`Describe your story in one sentence...

Examples:
• A coffee shop encounter on a snowy Christmas night
• Finding the perfect gift during holiday shopping
• A friendship that blooms in a cozy bookstore`,styles:{comic:"Comic Book",manga:"Manga Style",watercolor:"Watercolor",oil:"Oil Painting",sketch:"Pencil Sketch"},characterSection:{title:"Main Character",description:"Upload or select the main character for your story",required:"Required",optional:"Optional"},productSection:{title:"Featured Product",description:"Add a product to feature in your story (optional)",optional:"Optional"},storySection:{title:"Story Concept",description:"Describe your story idea in one sentence",examples:["A coffee shop encounter on a snowy Christmas night","Finding the perfect gift during holiday shopping","A friendship that blooms in a cozy bookstore"]},generatingPanels:"Generating comic panels...",panelComplete:"Panel completed",storyComplete:"Comic story completed!",errors:{noStory:"Please enter a story prompt first!",characterRequired:"Please upload or select a character image!",generationFailed:"Comic generation failed. Please try again."}}},common:{loading:"Loading...",error:"Error",success:"Success",cancel:"Cancel",confirm:"Confirm",save:"Save",delete:"Delete",edit:"Edit",close:"Close"}},qg={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"AI 助手",tabs:{storyMaker:"故事創作",generate:"生成"},generate:{templates:{title:"Nano Banana 熱門模板 (點擊使用)",withSelection:"+ 已選圖片",categories:{all:"全部",creative:"🎨 創意轉換",professional:"💼 專業商用",fun:"🎮 趣味玩法"},items:{figurine:{title:"3D 模型公仔",description:"桌面擺飾模型"},handDrawn:{title:"手繪過程",description:"草稿到完稿"},crossSection:{title:"3D 剖面圖",description:"內部結構解析"},restoration:{title:"老照片修復",description:"上色與修復"},idPhoto:{title:"專業證件照",description:"商務形象照"},product:{title:"產品攝影",description:"電商專業照"},interior:{title:"室內設計",description:"空間改造"},marketing:{title:"行銷素材",description:"社群媒體圖"},tryOn:{title:"虛擬試穿",description:"服裝換搭"},timeTravel:{title:"時空旅行",description:"不同年代造型"},petAdventure:{title:"寵物冒險",description:"趣味場景"},ingredients:{title:"食材分解",description:"料理教學"}},applied:"✨ 模板已套用！可以直接生成或在上方輸入框中修改提示詞"},placeholder:"描述您想要生成的內容...",generateButton:"使用 Nano Banana 生成",generating:"正在使用 Nano Banana 生成...",imageToImageMode:"🎨 圖生圖模式",imageToImageDescription:"您選擇的圖片將與提示詞/模板結合來生成新圖片。",quickEnhancements:"✨ 快速增強 (點擊切換)",enhancementItems:["病毒迷因風格","4K 超高清","電影級打光","藝術站熱門","Octane 渲染"],selectedImages:"張圖片已從畫布選取",invalidForTab:"不適用於"},storyMaker:{title:"故事創作",description:"創建具有一致角色的四格漫畫故事",styleLabel:"藝術風格",characterLabel:"主要角色",productLabel:"特色產品",storyPromptLabel:"故事概念",generateButton:"生成四格漫畫",useFromCanvas:"從畫布使用",uploadImage:"上傳圖片",generating:"正在生成分鏡",placeholder:`用一句話描述您的故事...

範例：
• 雪夜中的咖啡店邂逅
• 假期購物中尋找完美禮物
• 在溫馨書店中綻放的友誼`,styles:{comic:"漫畫風格",manga:"日式漫畫",watercolor:"水彩畫",oil:"油畫",sketch:"鉛筆素描"},characterSection:{title:"主要角色",description:"上傳或選擇故事的主要角色",required:"必填",optional:"選填"},productSection:{title:"特色產品",description:"添加要在故事中展示的產品（選填）",optional:"選填"},storySection:{title:"故事概念",description:"用一句話描述您的故事想法",examples:["雪夜中的咖啡店邂逅","假期購物中尋找完美禮物","在溫馨書店中綻放的友誼"]},generatingPanels:"正在生成漫畫分鏡...",panelComplete:"分鏡完成",storyComplete:"漫畫故事完成！",errors:{noStory:"請先輸入故事提示！",characterRequired:"請上傳或選擇角色圖片！",generationFailed:"漫畫生成失敗，請重試。"}}},common:{loading:"載入中...",error:"錯誤",success:"成功",cancel:"取消",confirm:"確認",save:"儲存",delete:"刪除",edit:"編輯",close:"關閉"}},Qg={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"Asistente IA",tabs:{storyMaker:"Creador de Historias",generate:"Generar"},generate:{templates:{title:"Plantillas Populares de Nano Banana (Clic para usar)",withSelection:"+ Imágenes Seleccionadas",categories:{all:"Todas",creative:"🎨 Creativo",professional:"💼 Profesional",fun:"🎮 Diversión"},items:{figurine:{title:"Figura 3D",description:"Modelo de escritorio"},handDrawn:{title:"Proceso Dibujado",description:"Boceto a final"},crossSection:{title:"Sección 3D",description:"Estructura interna"},restoration:{title:"Restaurar Foto",description:"Colorear y reparar"},idPhoto:{title:"ID Profesional",description:"Retrato empresarial"},product:{title:"Foto de Producto",description:"Foto e-commerce"},interior:{title:"Diseño Interior",description:"Renovación espacial"},marketing:{title:"Material Marketing",description:"Redes sociales"},tryOn:{title:"Prueba Virtual",description:"Cambio de ropa"},timeTravel:{title:"Viaje en el Tiempo",description:"Diferentes épocas"},petAdventure:{title:"Aventuras Mascota",description:"Escenas divertidas"},ingredients:{title:"Desglose Comida",description:"Guía de receta"}},applied:"✨ ¡Plantilla aplicada! Puedes generar directamente o modificar el prompt arriba"},placeholder:"Describe lo que quieres generar...",generateButton:"Generar con Nano Banana",generating:"Generando con Nano Banana...",imageToImageMode:"🎨 Modo Imagen a Imagen",imageToImageDescription:"Tus imágenes seleccionadas se combinarán con tu prompt/plantilla para generar nuevas imágenes.",quickEnhancements:"✨ Mejoras Rápidas (Clic para alternar)",enhancementItems:["estilo meme viral","4K ultra HD","iluminación cinematográfica","tendencia en artstation","render octane"],selectedImages:"imágenes seleccionadas del lienzo",invalidForTab:"No válido para"},storyMaker:{title:"Creador de Historias",description:"Crea historias de cómic de 4 paneles con personajes consistentes",styleLabel:"Estilo Artístico",characterLabel:"Personaje Principal",productLabel:"Producto Destacado",storyPromptLabel:"Concepto de Historia",generateButton:"Generar Cómic de 4 Paneles",useFromCanvas:"Usar del Lienzo",uploadImage:"Subir Imagen",generating:"Generando panel",placeholder:`Describe tu historia en una oración...

Ejemplos:
• Un encuentro en una cafetería en una noche navideña nevada
• Encontrar el regalo perfecto durante las compras navideñas
• Una amistad que florece en una acogedora librería`,styles:{comic:"Cómic",manga:"Estilo Manga",watercolor:"Acuarela",oil:"Pintura al Óleo",sketch:"Boceto a Lápiz"},characterSection:{title:"Personaje Principal",description:"Sube o selecciona el personaje principal de tu historia",required:"Requerido",optional:"Opcional"},productSection:{title:"Producto Destacado",description:"Agrega un producto para destacar en tu historia (opcional)",optional:"Opcional"},storySection:{title:"Concepto de Historia",description:"Describe tu idea de historia en una oración",examples:["Un encuentro en una cafetería en una noche navideña nevada","Encontrar el regalo perfecto durante las compras navideñas","Una amistad que florece en una acogedora librería"]},generatingPanels:"Generando paneles de cómic...",panelComplete:"Panel completado",storyComplete:"¡Historia de cómic completada!",errors:{noStory:"¡Por favor ingresa una propuesta de historia primero!",characterRequired:"¡Por favor sube o selecciona una imagen de personaje!",generationFailed:"La generación del cómic falló. Por favor intenta de nuevo."}}},common:{loading:"Cargando...",error:"Error",success:"Éxito",cancel:"Cancelar",confirm:"Confirmar",save:"Guardar",delete:"Eliminar",edit:"Editar",close:"Cerrar"}},Jg={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"AIアシスタント",tabs:{storyMaker:"ストーリーメーカー",generate:"生成"},generate:{templates:{title:"Nano Banana 人気テンプレート（クリックで使用）",withSelection:"+ 選択画像",categories:{all:"すべて",creative:"🎨 クリエイティブ",professional:"💼 プロフェッショナル",fun:"🎮 楽しい"},items:{figurine:{title:"3Dフィギュア",description:"デスクトップモデル"},handDrawn:{title:"手描きプロセス",description:"スケッチから完成"},crossSection:{title:"3D断面図",description:"内部構造"},restoration:{title:"写真修復",description:"着色と修復"},idPhoto:{title:"プロフェッショナルID",description:"ビジネスポートレート"},product:{title:"商品撮影",description:"ECサイト写真"},interior:{title:"インテリアデザイン",description:"空間リメイク"},marketing:{title:"マーケティング素材",description:"ソーシャルメディア"},tryOn:{title:"バーチャル試着",description:"衣装チェンジ"},timeTravel:{title:"タイムトラベル",description:"異なる時代"},petAdventure:{title:"ペット冒険",description:"楽しいシーン"},ingredients:{title:"食材分解",description:"レシピガイド"}},applied:"✨ テンプレート適用済み！直接生成するか、上のプロンプトを修正できます"},placeholder:"生成したい内容を説明してください...",generateButton:"Nano Bananaで生成",generating:"Nano Bananaで生成中...",imageToImageMode:"🎨 画像から画像モード",imageToImageDescription:"選択した画像がプロンプト/テンプレートと組み合わされて新しい画像を生成します。",quickEnhancements:"✨ クイック強化（クリックで切り替え）",enhancementItems:["バイラルミームスタイル","4K ウルトラHD","シネマティックライティング","artstation トレンド","octane レンダー"],selectedImages:"枚の画像をキャンバスから選択",invalidForTab:"無効："},storyMaker:{title:"ストーリーメーカー",description:"一貫したキャラクターで4コマ漫画ストーリーを作成",styleLabel:"アートスタイル",characterLabel:"メインキャラクター",productLabel:"フィーチャー商品",storyPromptLabel:"ストーリーコンセプト",generateButton:"4コマ漫画生成",useFromCanvas:"キャンバスから使用",uploadImage:"画像をアップロード",generating:"パネル生成中",placeholder:`ストーリーを一文で説明してください...

例：
• 雪のクリスマスの夜のコーヒーショップでの出会い
• ホリデーショッピングで完璧なギフトを見つける
• 居心地の良い本屋で咲く友情`,styles:{comic:"コミックブック",manga:"マンガスタイル",watercolor:"水彩画",oil:"油絵",sketch:"鉛筆スケッチ"},characterSection:{title:"メインキャラクター",description:"ストーリーのメインキャラクターをアップロードまたは選択",required:"必須",optional:"オプション"},productSection:{title:"フィーチャー商品",description:"ストーリーで紹介する商品を追加（オプション）",optional:"オプション"},storySection:{title:"ストーリーコンセプト",description:"ストーリーのアイデアを一文で説明",examples:["雪のクリスマスの夜のコーヒーショップでの出会い","ホリデーショッピングで完璧なギフトを見つける","居心地の良い本屋で咲く友情"]},generatingPanels:"コミックパネル生成中...",panelComplete:"パネル完了",storyComplete:"コミックストーリー完了！",errors:{noStory:"まずストーリープロンプトを入力してください！",characterRequired:"キャラクター画像をアップロードまたは選択してください！",generationFailed:"コミック生成に失敗しました。もう一度お試しください。"}}},common:{loading:"読み込み中...",error:"エラー",success:"成功",cancel:"キャンセル",confirm:"確認",save:"保存",delete:"削除",edit:"編集",close:"閉じる"}},Zg={language:{en:"English",zhTW:"繁體中文",es:"Español",ja:"日本語",fr:"Français"},aiPanel:{title:"Assistant IA",tabs:{storyMaker:"Créateur d'Histoires",generate:"Générer"},generate:{templates:{title:"Modèles Populaires Nano Banana (Cliquer pour utiliser)",withSelection:"+ Images Sélectionnées",categories:{all:"Tous",creative:"🎨 Créatif",professional:"💼 Professionnel",fun:"🎮 Amusant"},items:{figurine:{title:"Figurine 3D",description:"Modèle de bureau"},handDrawn:{title:"Processus Dessiné",description:"Croquis au final"},crossSection:{title:"Coupe 3D",description:"Structure interne"},restoration:{title:"Restauration Photo",description:"Coloriser et réparer"},idPhoto:{title:"ID Professionnel",description:"Portrait d'affaires"},product:{title:"Photo Produit",description:"Photo e-commerce"},interior:{title:"Design Intérieur",description:"Relooking espace"},marketing:{title:"Matériel Marketing",description:"Médias sociaux"},tryOn:{title:"Essai Virtuel",description:"Changement tenue"},timeTravel:{title:"Voyage Temporel",description:"Époques différentes"},petAdventure:{title:"Aventures Animaux",description:"Scènes amusantes"},ingredients:{title:"Décomposition Plat",description:"Guide recette"}},applied:"✨ Modèle appliqué! Vous pouvez générer directement ou modifier le prompt ci-dessus"},placeholder:"Décrivez ce que vous voulez générer...",generateButton:"Générer avec Nano Banana",generating:"Génération avec Nano Banana...",imageToImageMode:"🎨 Mode Image à Image",imageToImageDescription:"Vos images sélectionnées seront combinées avec votre prompt/modèle pour générer de nouvelles images.",quickEnhancements:"✨ Améliorations Rapides (Cliquer pour basculer)",enhancementItems:["style mème viral","4K ultra HD","éclairage cinématographique","tendance sur artstation","rendu octane"],selectedImages:"images sélectionnées du canevas",invalidForTab:"Non valide pour"},storyMaker:{title:"Créateur d'Histoires",description:"Créez des histoires de bande dessinée à 4 panneaux avec des personnages cohérents",styleLabel:"Style Artistique",characterLabel:"Personnage Principal",productLabel:"Produit Vedette",storyPromptLabel:"Concept d'Histoire",generateButton:"Générer BD 4 Panneaux",useFromCanvas:"Utiliser du Canevas",uploadImage:"Télécharger Image",generating:"Génération panneau",placeholder:`Décrivez votre histoire en une phrase...

Exemples :
• Une rencontre dans un café par une nuit de Noël enneigée
• Trouver le cadeau parfait pendant les achats des fêtes
• Une amitié qui s'épanouit dans une librairie douillette`,styles:{comic:"Bande Dessinée",manga:"Style Manga",watercolor:"Aquarelle",oil:"Peinture à l'Huile",sketch:"Croquis au Crayon"},characterSection:{title:"Personnage Principal",description:"Téléchargez ou sélectionnez le personnage principal de votre histoire",required:"Requis",optional:"Optionnel"},productSection:{title:"Produit Vedette",description:"Ajoutez un produit à mettre en vedette dans votre histoire (optionnel)",optional:"Optionnel"},storySection:{title:"Concept d'Histoire",description:"Décrivez votre idée d'histoire en une phrase",examples:["Une rencontre dans un café par une nuit de Noël enneigée","Trouver le cadeau parfait pendant les achats des fêtes","Une amitié qui s'épanouit dans une librairie douillette"]},generatingPanels:"Génération des panneaux de BD...",panelComplete:"Panneau terminé",storyComplete:"Histoire de BD terminée !",errors:{noStory:"Veuillez d'abord entrer une proposition d'histoire !",characterRequired:"Veuillez télécharger ou sélectionner une image de personnage !",generationFailed:"La génération de la BD a échoué. Veuillez réessayer."}}},common:{loading:"Chargement...",error:"Erreur",success:"Succès",cancel:"Annuler",confirm:"Confirmer",save:"Sauvegarder",delete:"Supprimer",edit:"Modifier",close:"Fermer"}},Bl={en:Kg,"zh-TW":qg,es:Qg,ja:Jg,fr:Zg};function ah(t){return Bl[t]||Bl.en}function ep(){const{currentLanguage:t}=Sa();return ah(t)}const lh=[{id:"figurine",category:"creative",icon:"🎎",withSelection:{en:"Transform the person from the reference image into a hyper-realistic 1/7 scale figurine, placed on an iMac computer desk with a white Apple keyboard. The figurine perfectly captures the person's appearance, clothing, and personality. The figurine stands on a transparent acrylic base. The iMac screen shows the ZBrush modeling process. Next to it is a packaging box designed to match the person's style theme.","zh-TW":"將參考圖片中的人物轉換成超寫實的1/7比例模型，放置在iMac電腦桌上，旁邊有白色Apple鍵盤。模型完美捕捉人物的外觀、服裝和個性。模型站在透明壓克力底座上。iMac螢幕顯示ZBrush建模過程。旁邊放置包裝盒，盒子設計配合人物風格主題。",es:"Transforma a la persona de la imagen de referencia en una figurita hiperrealista a escala 1/7, colocada en un escritorio de iMac con un teclado Apple blanco. La figurita captura perfectamente la apariencia, ropa y personalidad de la persona. La figurita está sobre una base acrílica transparente. La pantalla del iMac muestra el proceso de modelado en ZBrush. Junto a ella hay una caja de embalaje diseñada para coincidir con el tema de estilo de la persona.",ja:"参考画像の人物を、白いAppleキーボードと一緒にiMacコンピューターデスクに置かれた、超リアルな1/7スケールフィギュアに変換します。フィギュアは人物の外観、服装、個性を完璧に捉えています。フィギュアは透明なアクリルベースの上に立っています。iMacの画面にはZBrushモデリングプロセスが表示されています。その隣には、人物のスタイルテーマに合わせてデザインされたパッケージボックスがあります。",fr:"Transformez la personne de l'image de référence en une figurine hyperréaliste à l'échelle 1/7, placée sur un bureau iMac avec un clavier Apple blanc. La figurine capture parfaitement l'apparence, les vêtements et la personnalité de la personne. La figurine se dresse sur une base acrylique transparente. L'écran iMac affiche le processus de modélisation ZBrush. À côté se trouve une boîte d'emballage conçue pour correspondre au thème de style de la personne."},withoutSelection:{en:"Create an exquisite anime character 1/7 scale figurine, placed on a work desk, professional studio lighting, showcasing figurine details.","zh-TW":"創建一個精緻的動漫角色1/7比例模型，放置在工作桌上，專業攝影棚燈光，展現模型細節。",es:"Crea una exquisita figurita de personaje de anime a escala 1/7, colocada en un escritorio de trabajo, iluminación de estudio profesional, mostrando los detalles de la figurita.",ja:"精巧なアニメキャラクター1/7スケールフィギュアを作成し、作業机の上に配置し、プロのスタジオ照明でフィギュアの詳細を紹介します。",fr:"Créez une figurine de personnage d'anime exquise à l'échelle 1/7, placée sur un bureau de travail, éclairage de studio professionnel, mettant en valeur les détails de la figurine."}},{id:"handDrawn",category:"creative",icon:"✏️",withSelection:{en:"Transform the image into a 4-stage hand-drawn illustration process: 1. Pencil sketch outline 2. Add basic lines 3. Add details and shadows 4. Complete color illustration. Show the drawing steps from sketch to finished artwork.","zh-TW":"將圖片轉換成4階段手繪插畫過程：1.鉛筆草稿輪廓 2.加入基本線條 3.添加細節和陰影 4.完成的彩色插畫。展示從草圖到完成品的繪畫步驟。",es:"Transforma la imagen en un proceso de ilustración dibujada a mano de 4 etapas: 1. Contorno de boceto a lápiz 2. Agregar líneas básicas 3. Agregar detalles y sombras 4. Ilustración completa en color. Muestra los pasos de dibujo desde el boceto hasta la obra terminada.",ja:"画像を4段階の手描きイラストプロセスに変換：1.鉛筆スケッチの輪郭 2.基本的な線を追加 3.詳細と影を追加 4.完全なカラーイラスト。スケッチから完成した作品までの描画ステップを示します。",fr:"Transformez l'image en un processus d'illustration dessinée à la main en 4 étapes : 1. Contour de croquis au crayon 2. Ajouter des lignes de base 3. Ajouter des détails et des ombres 4. Illustration couleur complète. Montrez les étapes de dessin du croquis à l'œuvre finie."},withoutSelection:{en:"Create a character's 4-stage hand-drawing process, from simple sketch to complete color illustration","zh-TW":"創建一個角色的4階段手繪過程，從簡單草稿到完整彩色插畫",es:"Crea el proceso de dibujo a mano de 4 etapas de un personaje, desde un boceto simple hasta una ilustración completa en color",ja:"キャラクターの4段階手描きプロセスを作成し、シンプルなスケッチから完全なカラーイラストまで",fr:"Créez le processus de dessin à la main en 4 étapes d'un personnage, du croquis simple à l'illustration couleur complète"}},{id:"crossSection",category:"creative",icon:"🔧",withSelection:{en:"Create a 3D cross-section diagram of the object, showing internal structure and components, technical diagram style, labeling each part, engineering drawing style","zh-TW":"創建物體的3D剖面圖，展示內部結構和組件，技術圖解風格，標註各部分名稱，工程圖紙風格",es:"Crea un diagrama de sección transversal 3D del objeto, mostrando la estructura interna y los componentes, estilo de diagrama técnico, etiquetando cada parte, estilo de dibujo de ingeniería",ja:"オブジェクトの3D断面図を作成し、内部構造とコンポーネントを示し、技術図スタイル、各部分にラベルを付け、エンジニアリング図面スタイル",fr:"Créez un diagramme de coupe transversale 3D de l'objet, montrant la structure interne et les composants, style de diagramme technique, étiquetant chaque partie, style de dessin d'ingénierie"},withoutSelection:{en:"Generate a 3D cross-section diagram of a building, showing internal floor structure","zh-TW":"生成建築物的3D剖面圖，展示內部樓層結構",es:"Genera un diagrama de sección transversal 3D de un edificio, mostrando la estructura interna del piso",ja:"建物の3D断面図を生成し、内部フロア構造を示す",fr:"Générez un diagramme de coupe transversale 3D d'un bâtiment, montrant la structure interne du plancher"}},{id:"restoration",category:"creative",icon:"📸",withSelection:{en:"Restore and colorize this old photo, remove scratches, stains and fading, enhance details, add natural colors, maintain original composition and character features","zh-TW":"修復並上色這張老照片，去除刮痕、污漬和褪色，增強細節，添加自然色彩，保持原始構圖和人物特徵",es:"Restaura y colorea esta foto antigua, elimina rayones, manchas y decoloración, mejora los detalles, agrega colores naturales, mantiene la composición original y las características del personaje",ja:"この古い写真を復元し、着色し、傷、汚れ、色あせを除去し、詳細を強化し、自然な色を追加し、元の構図とキャラクターの特徴を維持します",fr:"Restaurez et coloriez cette vieille photo, supprimez les rayures, les taches et la décoloration, améliorez les détails, ajoutez des couleurs naturelles, maintenez la composition originale et les caractéristiques du personnage"},withoutSelection:{en:"Restore a 1950s black and white family photo, add colors","zh-TW":"修復一張1950年代的黑白家庭照片，添加色彩",es:"Restaura una foto familiar en blanco y negro de los años 1950, agrega colores",ja:"1950年代の白黒家族写真を復元し、色を追加します",fr:"Restaurez une photo de famille en noir et blanc des années 1950, ajoutez des couleurs"}},{id:"idPhoto",category:"professional",icon:"📷",withSelection:{en:"Transform the person into a professional ID photo: white background, formal attire, confident expression, ID photo format, professional studio lighting, maintain person's facial features","zh-TW":"將人物轉換成專業證件照：白色背景、正裝、自信表情、證件照規格、專業攝影棚燈光、保持人物臉部特徵",es:"Transforma a la persona en una foto de identificación profesional: fondo blanco, vestimenta formal, expresión confiada, formato de foto de identificación, iluminación de estudio profesional, mantén las características faciales de la persona",ja:"人物をプロフェッショナルなID写真に変換：白い背景、フォーマルな服装、自信に満ちた表情、ID写真フォーマット、プロのスタジオ照明、人物の顔の特徴を維持",fr:"Transformez la personne en photo d'identité professionnelle : arrière-plan blanc, tenue formelle, expression confiante, format de photo d'identité, éclairage de studio professionnel, maintenez les traits du visage de la personne"},withoutSelection:{en:"Generate professional business ID photo, white background, formal attire","zh-TW":"生成專業商務證件照，白色背景，正裝",es:"Genera una foto de identificación comercial profesional, fondo blanco, vestimenta formal",ja:"プロフェッショナルなビジネスID写真を生成、白い背景、フォーマルな服装",fr:"Générez une photo d'identité commerciale professionnelle, arrière-plan blanc, tenue formelle"}},{id:"product",category:"professional",icon:"📦",withSelection:{en:"Transform the product into professional e-commerce photography: pure white background, multi-angle display, professional lighting, showcase product details and texture","zh-TW":"將產品轉換成專業電商攝影：純白背景、多角度展示、專業打光、展現產品細節和質感",es:"Transforma el producto en fotografía profesional de comercio electrónico: fondo blanco puro, exhibición en múltiples ángulos, iluminación profesional, muestra los detalles y textura del producto",ja:"製品をプロフェッショナルなeコマース写真に変換：純白の背景、多角度表示、プロの照明、製品の詳細と質感を紹介",fr:"Transformez le produit en photographie professionnelle de commerce électronique : arrière-plan blanc pur, affichage multi-angles, éclairage professionnel, mettez en valeur les détails et la texture du produit"},withoutSelection:{en:"Create professional product photography, suitable for e-commerce platforms","zh-TW":"創建專業產品攝影，適合電商平台使用",es:"Crea fotografía profesional de productos, adecuada para plataformas de comercio electrónico",ja:"プロフェッショナルな製品写真を作成し、eコマースプラットフォームに適している",fr:"Créez une photographie de produit professionnelle, adaptée aux plateformes de commerce électronique"}},{id:"interior",category:"professional",icon:"🏠",withSelection:{en:"Redesign the space: add modern furniture, change wall colors, add decorations, professional interior design style","zh-TW":"將空間重新設計：添加現代家具、改變牆面顏色、加入裝飾品、專業室內設計風格",es:"Rediseña el espacio: agrega muebles modernos, cambia los colores de las paredes, agrega decoraciones, estilo de diseño de interiores profesional",ja:"スペースを再設計：モダンな家具を追加、壁の色を変更、装飾を追加、プロのインテリアデザインスタイル",fr:"Redessinez l'espace : ajoutez des meubles modernes, changez les couleurs des murs, ajoutez des décorations, style de design d'intérieur professionnel"},withoutSelection:{en:"Design modern minimalist living room, including sofa, coffee table and decorations","zh-TW":"設計現代簡約風格客廳，包含沙發、茶几和裝飾",es:"Diseña una sala de estar minimalista moderna, incluyendo sofá, mesa de café y decoraciones",ja:"ソファ、コーヒーテーブル、装飾を含むモダンなミニマリストのリビングルームをデザイン",fr:"Concevez un salon minimaliste moderne, comprenant un canapé, une table basse et des décorations"}},{id:"marketing",category:"professional",icon:"📱",withSelection:{en:"Create social media marketing material: add attractive background, text space, brand colors, suitable for Instagram posting","zh-TW":"創建社群媒體行銷素材：加入吸引人的背景、文字空間、品牌色彩、適合Instagram發布",es:"Crea material de marketing para redes sociales: agrega fondo atractivo, espacio de texto, colores de marca, adecuado para publicar en Instagram",ja:"ソーシャルメディアマーケティング素材を作成：魅力的な背景、テキストスペース、ブランドカラーを追加、Instagram投稿に適している",fr:"Créez du matériel de marketing pour les médias sociaux : ajoutez un arrière-plan attrayant, un espace de texte, des couleurs de marque, adapté à la publication Instagram"},withoutSelection:{en:"Design eye-catching social media advertising images","zh-TW":"設計引人注目的社群媒體廣告圖片",es:"Diseña imágenes publicitarias llamativas para redes sociales",ja:"目を引くソーシャルメディア広告画像をデザイン",fr:"Concevez des images publicitaires accrocheuses pour les médias sociaux"}},{id:"tryOn",category:"fun",icon:"👗",withSelection:{en:"Dress the person from the first image in the clothing from the second image, keep the person's pose and background unchanged, clothing should fit naturally","zh-TW":"將第一張圖片的人物穿上第二張圖片的服裝，保持人物姿勢和背景不變，服裝要自然貼合",es:"Viste a la persona de la primera imagen con la ropa de la segunda imagen, mantén la pose y el fondo de la persona sin cambios, la ropa debe quedar naturalmente",ja:"最初の画像の人物に2番目の画像の服を着せ、人物のポーズと背景を変更せず、服は自然にフィットするようにします",fr:"Habillez la personne de la première image avec les vêtements de la deuxième image, gardez la pose et l'arrière-plan de la personne inchangés, les vêtements doivent s'ajuster naturellement"},withoutSelection:{en:"Show model trying on different style outfits","zh-TW":"展示模特兒試穿不同風格服裝",es:"Muestra un modelo probándose diferentes estilos de conjuntos",ja:"モデルが異なるスタイルの衣装を試着している様子を表示",fr:"Montrez un modèle essayant différents styles de tenues"}},{id:"timeTravel",category:"fun",icon:"⏰",withSelection:{en:"Place the person in different eras: 1920s vintage style, 1960s hippie style, 1980s disco, 2000s Y2K style, maintain person's features","zh-TW":"將人物放到不同年代：1920年代復古風、1960年代嬉皮風、1980年代迪斯可、2000年代Y2K風格，保持人物特徵",es:"Coloca a la persona en diferentes épocas: estilo vintage de los años 1920, estilo hippie de los años 1960, disco de los años 1980, estilo Y2K de los años 2000, mantén las características de la persona",ja:"人物を異なる時代に配置：1920年代のヴィンテージスタイル、1960年代のヒッピースタイル、1980年代のディスコ、2000年代のY2Kスタイル、人物の特徴を維持",fr:"Placez la personne dans différentes époques : style vintage des années 1920, style hippie des années 1960, disco des années 1980, style Y2K des années 2000, maintenez les caractéristiques de la personne"},withoutSelection:{en:"Show the same character in different historical period styles","zh-TW":"展示同一角色在不同歷史時期的造型",es:"Muestra el mismo personaje en estilos de diferentes períodos históricos",ja:"同じキャラクターを異なる歴史的時代のスタイルで表示",fr:"Montrez le même personnage dans des styles de différentes périodes historiques"}},{id:"petAdventure",category:"fun",icon:"🐾",withSelection:{en:"Place the pet in adventure scenes: astronaut costume on the moon, pirate captain on a ship, superhero flying, knight armor in a castle","zh-TW":"將寵物放入冒險場景：太空人裝扮在月球、海盜船長在船上、超級英雄飛行、騎士盔甲在城堡",es:"Coloca a la mascota en escenas de aventura: disfraz de astronauta en la luna, capitán pirata en un barco, superhéroe volando, armadura de caballero en un castillo",ja:"ペットを冒険シーンに配置：月の宇宙飛行士のコスチューム、船の海賊船長、飛行するスーパーヒーロー、城の騎士の鎧",fr:"Placez l'animal dans des scènes d'aventure : costume d'astronaute sur la lune, capitaine pirate sur un navire, super-héros volant, armure de chevalier dans un château"},withoutSelection:{en:"Create fantasy adventure scenes for pets","zh-TW":"創造寵物的奇幻冒險場景",es:"Crea escenas de aventura fantástica para mascotas",ja:"ペットのファンタジー冒険シーンを作成",fr:"Créez des scènes d'aventure fantastique pour animaux de compagnie"}},{id:"ingredients",category:"fun",icon:"🍳",withSelection:{en:"Break down the food into ingredients: each ingredient in separate bowls, label names and quantities, cooking tutorial style arrangement","zh-TW":"將食物分解成食材：每個食材放在單獨的碗中，標註名稱和份量，烹飪教學風格排列",es:"Descompón la comida en ingredientes: cada ingrediente en tazones separados, etiqueta nombres y cantidades, disposición estilo tutorial de cocina",ja:"食べ物を材料に分解：各材料を別々のボウルに入れ、名前と分量をラベル付け、料理チュートリアルスタイルの配置",fr:"Décomposez la nourriture en ingrédients : chaque ingrédient dans des bols séparés, étiquetez les noms et les quantités, arrangement de style tutoriel de cuisine"},withoutSelection:{en:"Display all ingredients and seasonings for a dish","zh-TW":"展示料理的所有食材和調味料",es:"Muestra todos los ingredientes y condimentos para un plato",ja:"料理のすべての材料と調味料を表示",fr:"Affichez tous les ingrédients et assaisonnements pour un plat"}}];function tp(t,e,n){const c=lh.find(y=>y.id===t);if(!c)return"";const m=e?c.withSelection:c.withoutSelection;return m[n]||m.en}const np=()=>{var W,q,U,N,G;const t=ep(),{currentLanguage:e}=Sa(),{getSelectedImages:n}=Ca(),{importImage:c,getSelectedImages:m,calculateSmartLayout:y}=pr(),[w,f]=ue.useState(!1),[s,u]=ue.useState(""),[h,r]=ue.useState("storyshop"),[o,i]=ue.useState(null),[l,d]=ue.useState(null),[a,g]=ue.useState(null),[p,v]=ue.useState(""),[x,C]=ue.useState([]),[S,T]=ue.useState("comic"),[P,R]=ue.useState(null),[z,J]=ue.useState("all"),[ne,ie]=ue.useState([]),[te,re]=ue.useState(""),[oe,le]=ue.useState(null),V=m(),_=n(),O=V.length>0?V.map(A=>({url:A})):_;O.length>=2;const j=O.length>0;O.length>1;const D={generate:{maxImages:10,message:"Generate supports any number of reference images or none for fresh creation",canUse:!0},style:{maxImages:1,message:"Style transfer requires exactly 1 image",canUse:O.length===1},merge:{maxImages:10,message:"Merge requires 2+ images",canUse:O.length>=2},storyshop:{maxImages:2,message:"Story can use up to 2 images (character + product)",canUse:O.length<=2}},X=async()=>{if(s.trim()){console.log("🚀 Starting generation process..."),console.log("📊 State check:",{activeTab:h,hasSelection:j,selectedImagesCount:O.length,canvasSelectedImages:m(),imageStoreImages:n(),selectedImages:O.map(A=>({url:A.url.substring(0,50)+"..."}))}),f(!0);try{let A;if(h==="generate")if(j&&O.length>0){console.log("🎯 Using Image-to-Image mode!");const F=O.map(Y=>Y.url);O.length===1?(console.log("📸 Single image generation with:",F[0].substring(0,50)+"..."),A=await xe.imageToImage({prompt:s,imageUrl:F[0],width:512,height:512,strength:.7})):(console.log("🔀 Multi-image merge with",O.length,"images"),A=await xe.mergeImages(F,s)),console.log(`✅ Generated ${O.length===1?"image-to-image":"merged"} result based on selection`)}else console.log("📝 Using Text-to-Image mode (no images selected)"),A=await xe.generateImage({prompt:s,width:512,height:512}),console.log("✅ Generated image from text prompt:",A);else A=await xe.generateImage({prompt:s,width:512,height:512}),console.log("Generated image from text prompt in",h,"tab:",A);await c(typeof A=="string"?A:A.url),i(typeof A=="string"?A:A.url),u("")}catch(A){console.error("Image generation failed:",A),alert("Image generation failed: "+A)}finally{f(!1)}}},M=(A,F)=>{const Y=new FileReader;Y.onload=Z=>{var K;const Q=(K=Z.target)==null?void 0:K.result;A==="character"?d(Q):g(Q)},Y.readAsDataURL(F)},k=A=>{const F=m();if(console.log(`🖼️ Using ${A} from canvas, selected:`,F.length,"images"),F.length===0){alert(t.aiPanel.storyMaker.errors.characterRequired);return}const Y=F[0];A==="character"?(d(Y),console.log("✅ Character image set from canvas")):(g(Y),console.log("✅ Product image set from canvas"))},L=async()=>{if(!p.trim()){alert(t.aiPanel.storyMaker.errors.noStory);return}f(!0);try{console.log("🎬 Starting Story Maker comic generation..."),console.log("📝 Story:",p),console.log("🎨 Style:",S),console.log("👤 Character:",l?"Selected":"None"),console.log("🛍️ Product:",a?"Selected":"None");const A=[],F=["Setup - Introduction and beginning of the story","Development - Story unfolds and builds tension","Climax - The key moment or turning point","Resolution - Conclusion and ending"];for(let Q=0;Q<4;Q++){console.log(`🎨 Generating panel ${Q+1}/4: ${F[Q]}`);let K=`Create a ${S} style comic panel for panel ${Q+1}/4.

STORY CONTEXT: ${p}
PANEL STAGE: ${F[Q]}

VISUAL REQUIREMENTS:
- High-quality ${S} art style
- Consistent character appearance throughout the story
- CONSISTENT SCENE/LOCATION: All panels should take place in the same general setting/environment (can use different camera angles/perspectives but must be recognizably the same location)
- Clear comic panel composition with good visual flow
- Professional comic book quality artwork
- Maintain environmental coherence across all panels`;l&&(K+=`
- IMPORTANT: Use the provided character image as reference to maintain character consistency
- Keep the same person's appearance, facial features, and clothing style throughout`),a&&(K+=`
- IMPORTANT: Naturally integrate the provided product into the scene
- Product should appear contextually appropriate within the story
- Maintain product's visual characteristics and branding`),K+=`

Generate panel ${Q+1}: ${F[Q]} of the story "${p}"`;let H;if(l&&a){console.log("🎭 Merging character and product for comprehensive reference");const se=await xe.mergeImages([l,a],"Composite reference image combining the main character and the featured product. Keep both elements clearly visible.");console.log("🖼️ Using merged reference for image-to-image generation"),H=await xe.imageToImage({prompt:K,imageUrl:se,width:512,height:512,strength:.5})}else l?(console.log("🖼️ Using character reference for image-to-image generation"),H=await xe.imageToImage({prompt:K,imageUrl:l,width:512,height:512,strength:.6})):a?(console.log("📦 Using product reference for image-to-image generation"),H=await xe.imageToImage({prompt:K,imageUrl:a,width:512,height:512,strength:.5})):(console.log("📝 Using text-to-image generation"),H=await xe.generateImage({prompt:K,width:512,height:512}));A.push(H.url),console.log(`✅ Panel ${Q+1} generated successfully`)}C(A),console.log("📋 Adding panels to canvas with smart layout...");const Y={width:300,height:300},Z=y(A.length,Y);for(let Q=0;Q<A.length;Q++){const K=Z[Q]||{x:100+Q*150,y:100};await c(A[Q],K),console.log(`📍 Panel ${Q+1} positioned at:`,K)}console.log("🎉 4-panel comic generated successfully with character consistency!")}catch(A){console.error("❌ Comic generation failed:",A),alert("Comic generation failed. Please try again!")}finally{f(!1)}},B=async()=>{if(!te.trim()){alert("Please enter edit instructions!");return}if(x.length===0){alert("Generate a comic first!");return}f(!0);try{console.log("✨ Editing all panels with:",te);const A=[],F=["Setup - Introduction and beginning of the story","Development - Story unfolds and builds tension","Climax - The key moment or turning point","Resolution - Conclusion and ending"];for(let Y=0;Y<x.length;Y++){console.log(`✨ Editing panel ${Y+1}/4`);let Z=`Edit this ${S} style comic panel for panel ${Y+1}/4.

ORIGINAL STORY: ${p}
PANEL STAGE: ${F[Y]}
EDIT INSTRUCTIONS: ${te}

Apply the edit instructions while maintaining:
- The same ${S} art style
- Character consistency throughout the story
- The panel's role in the story sequence`;l&&(Z+=`
- Character appearance from the reference image`),a&&(Z+=`
- Product integration naturally into the scene`);let Q;if(l&&a){console.log("🎭 Merging character and product for edit reference");const se=await xe.mergeImages([l,a],"Composite reference image combining the main character and the featured product. Keep both elements clearly visible.");Q=await xe.imageToImage({prompt:Z,imageUrl:se,width:512,height:512,strength:.5})}else l?Q=await xe.imageToImage({prompt:Z,imageUrl:l,width:512,height:512,strength:.7}):a?Q=await xe.imageToImage({prompt:Z,imageUrl:a,width:512,height:512,strength:.5}):Q=await xe.generateImage({prompt:Z,width:512,height:512});A.push(Q.url);const H=y(A.length+1,{width:300,height:300})[Y]||{x:100+Y*150,y:100};await c(Q.url,H),console.log(`✅ Panel ${Y+1} edited successfully`)}C(A),re(""),console.log("🎉 All panels edited successfully!")}catch(A){console.error("❌ Panel editing failed:",A),alert("Panel editing failed. Please try again!")}finally{f(!1)}},$=async A=>{f(!0);try{console.log("💡 Generating story idea for category:",A);const F={coffee:"A shy customer accidentally orders in a different language, leading to an unexpected friendship with the barista",shopping:"Someone finds the perfect vintage jacket, only to discover it belongs to their childhood friend working at the shop",friendship:"Two strangers get stuck in an elevator and end up planning their dream vacation together",adventure:"A person follows a mysterious cat through the city and discovers a hidden rooftop garden",surprise:"Someone orders takeout and finds a handwritten note that changes their entire day"};v(F[A]||F.coffee),console.log("✅ Story idea generated:",F[A])}catch(F){console.error("❌ Story idea generation failed:",F),alert("Story idea generation failed. Please try again!")}finally{f(!1)}},E=async()=>{const A=m();console.log("🎯 Canvas selected images:",{count:A.length});let F=[];if(A.length>0)F=A,console.log("🎬 Using",A.length,"selected images from canvas for video");else if(x.length>0)F=x,console.log("🎬 Using",x.length,"generated comic panels for video");else{alert("Please select images on the canvas or generate a comic first!");return}f(!0);try{console.log("🎬 Generating video from",F.length,"panels"),console.log("📹 Using Fal.ai to create animated story video...");const Y=await xe.generateVideoFromPanels({panelUrls:F,narrationText:p,voiceId:"default",duration:8});console.log("✅ Video generated successfully!"),console.log("🎥 Video URL:",Y),le(Y),alert(`🎬 Video generated successfully!
      
✨ Your 8-second video is ready!
• Use the "Watch Video" button below to view
• Generated: ${new Date().toLocaleString()}`)}catch(Y){console.error("❌ Video generation failed:",Y),alert(`Video generation failed: ${Y}

Note: Make sure your Fal.ai API key is configured and has credits.`)}finally{f(!1)}},I=[{id:"storyshop",label:t.aiPanel.tabs.storyMaker,icon:Os},{id:"generate",label:t.aiPanel.tabs.generate,icon:To}];return b.jsxs("div",{className:"flex h-full flex-col bg-gradient-to-br from-white to-purple-50",children:[b.jsxs("div",{className:"p-3 border-b border-gray-200 bg-white/90 backdrop-blur-sm flex-shrink-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("div",{className:"p-1.5 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg",children:b.jsx(nh,{className:"w-4 h-4 text-white"})}),b.jsx("h3",{className:"text-sm font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"AI Assistant"})]}),b.jsx("div",{className:"flex items-center space-x-1",children:j&&b.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${(W=D[h])!=null&&W.canUse?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"}`,children:["🖼️ ",O.length," selected"]})})]}),b.jsx("div",{className:"flex mt-3 bg-gradient-to-r from-purple-100/50 to-pink-100/50 rounded-xl p-1 shadow-inner",children:I.map(A=>{const F=A.icon;return b.jsxs("button",{onClick:()=>r(A.id),className:`
                  flex-1 flex items-center justify-center space-x-1.5 py-2 px-3 rounded-lg text-xs font-medium transition-all duration-200
                  ${h===A.id?"bg-white text-purple-700 shadow-md scale-105 border border-purple-200":"text-gray-600 hover:text-purple-600 hover:bg-white/50"}
                `,children:[b.jsx(F,{className:"w-3 h-3"}),b.jsx("span",{children:A.label})]},A.id)})})]}),b.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[j&&b.jsxs("div",{className:`mb-3 p-2 rounded-lg border ${(q=D[h])!=null&&q.canUse?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200"}`,children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("span",{className:"text-xs font-medium text-gray-700",children:["🖼️ ",O.length," image",O.length!==1?"s":""," selected from canvas"]}),!((U=D[h])!=null&&U.canUse)&&b.jsxs("span",{className:"text-xs text-orange-600 font-medium",children:["⚠️ Invalid for ",h]})]}),b.jsx("p",{className:"text-xs text-gray-600 mt-1",children:(N=D[h])==null?void 0:N.message})]}),h!=="storyshop"&&b.jsxs("div",{className:"mb-3",children:[b.jsx("textarea",{value:s,onChange:A=>{u(A.target.value),R(null),ie([])},placeholder:t.aiPanel.generate.placeholder,className:"w-full h-20 p-2 text-sm border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:w}),j&&b.jsx("p",{className:"text-xs text-purple-600 mt-1",children:"💡 Selected images will be automatically included in the AI request"})]}),h==="generate"&&b.jsxs("div",{className:"space-y-3",children:[b.jsx("p",{className:"text-xs text-gray-600",children:j?`Generate new images based on your ${O.length} selected image${O.length!==1?"s":""}`:"Generate images with Gemini 2.5 Flash (Nano Banana)"}),j&&b.jsxs("div",{className:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 mb-3",children:[b.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[b.jsx("span",{className:"text-sm font-bold text-blue-700",children:"🎨 Image-to-Image Mode"}),b.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-200 text-blue-800 rounded-full",children:"ACTIVE"})]}),b.jsxs("p",{className:"text-xs text-blue-700",children:["Your selected image",O.length!==1?"s":""," will be combined with your prompt/template to generate new images."]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("p",{className:"text-xs font-bold text-purple-700 flex items-center",children:["🔥 ",t.aiPanel.generate.templates.title]}),j&&b.jsx("span",{className:"text-xs text-blue-600 font-medium",children:t.aiPanel.generate.templates.withSelection})]}),b.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap",children:[b.jsx("button",{onClick:()=>J("all"),className:`px-2 py-1 text-xs rounded-full transition-all ${z==="all"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.all}),b.jsx("button",{onClick:()=>J("creative"),className:`px-2 py-1 text-xs rounded-full transition-all ${z==="creative"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.creative}),b.jsx("button",{onClick:()=>J("professional"),className:`px-2 py-1 text-xs rounded-full transition-all ${z==="professional"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.professional}),b.jsx("button",{onClick:()=>J("fun"),className:`px-2 py-1 text-xs rounded-full transition-all ${z==="fun"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.fun})]}),b.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-96 overflow-y-auto",children:lh.filter(A=>z==="all"||A.category===z).map(A=>{var F,Y;return b.jsxs("button",{onClick:()=>{const Z=tp(A.id,j,e);u(Z),R(A.id)},className:`p-2 rounded-lg border text-left transition-all ${P===A.id?"bg-gradient-to-r from-orange-100 to-yellow-100 border-orange-400 ring-1 ring-orange-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[b.jsx("div",{className:"text-lg mb-1",children:A.icon}),b.jsx("div",{className:"text-xs font-bold text-gray-800",children:(F=t.aiPanel.generate.templates.items[A.id])==null?void 0:F.title}),b.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:(Y=t.aiPanel.generate.templates.items[A.id])==null?void 0:Y.description})]},A.id)})}),P&&b.jsx("div",{className:"p-2 bg-purple-50 rounded-lg border border-purple-200",children:b.jsx("p",{className:"text-xs text-purple-700",children:t.aiPanel.generate.templates.applied})})]}),b.jsxs("div",{className:"mt-2 p-2 bg-purple-50 rounded-lg",children:[b.jsxs("p",{className:"text-xs font-medium text-purple-700 mb-1",children:["✨ ",t.aiPanel.generate.quickEnhancements]}),b.jsx("div",{className:"flex flex-wrap gap-1",children:t.aiPanel.generate.enhancementItems.map(A=>{const F=ne.includes(A);return b.jsx("button",{onClick:()=>{const Y=F?ne.filter(K=>K!==A):[...ne,A];ie(Y);const Z=s.split(",").filter(K=>!t.aiPanel.generate.enhancementItems.includes(K.trim())).join(",").trim(),Q=Z+(Y.length>0?(Z?", ":"")+Y.join(", "):"");u(Q)},className:`text-xs px-2 py-1 rounded border transition-all ${F?"bg-purple-200 border-purple-500 text-purple-800 ring-1 ring-purple-400":"bg-white hover:bg-purple-100 border-purple-300 text-gray-700"}`,children:A},A)})})]}),b.jsx("button",{onClick:X,disabled:w||!s.trim()||!((G=D[h])!=null&&G.canUse),className:"w-full py-3 px-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-400 text-white text-sm rounded-xl transition-all flex items-center justify-center space-x-2 font-bold shadow-lg hover:shadow-xl transform hover:scale-105 disabled:scale-100",children:w?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),b.jsx("span",{children:j?`${t.aiPanel.generate.generating} (${O.length} ${t.aiPanel.generate.selectedImages})`:t.aiPanel.generate.generating})]}):b.jsxs(b.Fragment,{children:[b.jsx(To,{className:"w-4 h-4"}),b.jsx("span",{children:j?`${t.aiPanel.generate.generateButton} (${O.length} ${t.aiPanel.generate.selectedImages})`:t.aiPanel.generate.generateButton})]})})]}),!1,!1,h==="storyshop"&&b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"text-center p-5 bg-gradient-to-br from-indigo-500 via-purple-600 to-pink-500 rounded-2xl text-white shadow-xl",children:[b.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-3",children:[b.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm",children:b.jsx(Os,{className:"w-6 h-6 text-white"})}),b.jsx("h4",{className:"text-lg font-black tracking-tight",children:t.aiPanel.storyMaker.title})]}),b.jsxs("p",{className:"text-sm font-semibold mb-3 leading-tight",children:["🪄 ",t.aiPanel.storyMaker.description]}),b.jsxs("p",{className:"text-xs opacity-90 mb-4",children:["Perfect for ",b.jsx("strong",{children:"social media"}),", ",b.jsx("strong",{children:"marketing"}),", and ",b.jsx("strong",{children:"content creation"})]}),b.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[b.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-2 border border-white/20",children:[b.jsx("div",{className:"text-lg mb-1",children:"📱"}),b.jsx("div",{className:"text-xs font-medium",children:"Instagram"}),b.jsx("div",{className:"text-xs opacity-75",children:"Ready"})]}),b.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-2 border border-white/20",children:[b.jsx("div",{className:"text-lg mb-1",children:"🛍️"}),b.jsx("div",{className:"text-xs font-medium",children:"E-commerce"}),b.jsx("div",{className:"text-xs opacity-75",children:"Stories"})]}),b.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-2 border border-white/20",children:[b.jsx("div",{className:"text-lg mb-1",children:"🎯"}),b.jsx("div",{className:"text-xs font-medium",children:"Marketing"}),b.jsx("div",{className:"text-xs opacity-75",children:"Ads"})]})]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-purple-100 rounded-lg",children:b.jsx(Vd,{className:"w-4 h-4 text-purple-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.characterSection.title})]}),b.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.characterSection.required})]}),b.jsx("div",{className:"border-2 border-dashed border-purple-300 rounded-xl p-5 bg-gradient-to-br from-purple-50/50 to-pink-50/50 hover:from-purple-100/50 hover:to-pink-100/50 transition-all duration-300",children:l?b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:l,alt:"Character",className:"w-full h-20 object-cover rounded-lg shadow-md"}),b.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 rounded-lg transition-all duration-200",children:b.jsx("button",{onClick:()=>d(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white text-sm rounded-full flex items-center justify-center shadow-lg transition-colors",children:"×"})}),b.jsx("div",{className:"mt-2 text-center",children:b.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["✅ ",t.aiPanel.storyMaker.characterSection.description]})})]}):b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"mb-3",children:[b.jsx("div",{className:"w-16 h-16 mx-auto bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl flex items-center justify-center mb-2",children:b.jsx(lg,{className:"w-8 h-8 text-purple-500"})}),b.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-1",children:t.aiPanel.storyMaker.characterSection.title}),b.jsx("p",{className:"text-xs text-gray-500 mb-3",children:t.aiPanel.storyMaker.characterSection.description})]}),b.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[b.jsxs("button",{onClick:()=>k("character"),className:"py-2 px-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-xs rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg",children:["📸 ",t.aiPanel.storyMaker.useFromCanvas]}),b.jsxs("label",{className:"cursor-pointer",children:[b.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A=>{var F;return((F=A.target.files)==null?void 0:F[0])&&M("character",A.target.files[0])}}),b.jsxs("div",{className:"py-2 px-4 bg-white hover:bg-gray-50 text-gray-700 text-xs rounded-lg border border-gray-300 font-medium transition-all",children:["📁 ",t.aiPanel.storyMaker.uploadImage]})]})]})]})})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-orange-100 rounded-lg",children:b.jsx(Il,{className:"w-4 h-4 text-orange-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.productSection.title})]}),b.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.productSection.optional})]}),b.jsx("div",{className:"border-2 border-dashed border-orange-200 rounded-xl p-4 bg-gradient-to-br from-orange-50/50 to-yellow-50/50 hover:from-orange-100/50 hover:to-yellow-100/50 transition-all duration-300",children:a?b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:a,alt:"Product",className:"w-full h-16 object-cover rounded-lg shadow-md"}),b.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 rounded-lg transition-all duration-200",children:b.jsx("button",{onClick:()=>g(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white text-sm rounded-full flex items-center justify-center shadow-lg transition-colors",children:"×"})}),b.jsx("div",{className:"mt-2 text-center",children:b.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["🛍️ ",t.aiPanel.storyMaker.productSection.description]})})]}):b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-12 h-12 mx-auto bg-gradient-to-br from-orange-100 to-yellow-100 rounded-lg flex items-center justify-center mb-2",children:b.jsx(Il,{className:"w-6 h-6 text-orange-500"})}),b.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t.aiPanel.storyMaker.productSection.title}),b.jsx("p",{className:"text-xs text-gray-500 mb-2",children:t.aiPanel.storyMaker.productSection.description}),b.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[b.jsxs("button",{onClick:()=>k("product"),className:"py-1.5 px-3 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-orange-500 hover:to-yellow-500 text-white text-xs rounded-lg font-medium transition-all",children:["🛍️ ",t.aiPanel.storyMaker.useFromCanvas]}),b.jsxs("label",{className:"cursor-pointer",children:[b.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A=>{var F;return((F=A.target.files)==null?void 0:F[0])&&M("product",A.target.files[0])}}),b.jsxs("div",{className:"py-1.5 px-3 bg-white hover:bg-gray-50 text-gray-600 text-xs rounded-lg border border-gray-200 font-medium transition-all",children:["📁 ",t.aiPanel.storyMaker.uploadImage]})]})]})]})})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-green-100 rounded-lg",children:b.jsx(og,{className:"w-4 h-4 text-green-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.storySection.title})]}),b.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.characterSection.required})]}),b.jsxs("div",{className:"relative",children:[b.jsx("textarea",{value:p,onChange:A=>v(A.target.value),placeholder:t.aiPanel.storyMaker.placeholder,className:"w-full h-24 p-4 text-sm border-2 border-green-200 rounded-xl resize-none focus:ring-2 focus:ring-green-400 focus:border-green-400 bg-gradient-to-br from-green-50/30 to-emerald-50/30 placeholder-gray-500",disabled:w}),b.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400",children:[p.length,"/200"]})]}),p.trim()&&b.jsx("div",{className:"p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:b.jsxs("p",{className:"text-xs text-green-700 font-medium flex items-center space-x-1",children:[b.jsx("span",{children:"🎬"}),b.jsx("span",{children:"Perfect! This will create 4 compelling panels telling your story."})]})}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("p",{className:"text-xs font-medium text-gray-700",children:"💡 Quick Story Ideas:"}),b.jsx("div",{className:"space-y-1",children:[{text:"A magical coffee shop encounter",category:"coffee"},{text:"Lost pet finds way home",category:"adventure"},{text:"Time traveler in modern world",category:"surprise"},{text:"Robot learns about friendship",category:"friendship"}].map((A,F)=>b.jsx("button",{onClick:()=>$(A.category),className:"w-full text-left text-xs p-2 bg-gray-50 hover:bg-purple-50 text-gray-600 hover:text-purple-600 rounded border transition-colors",children:A.text},F))})]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:b.jsx(Zd,{className:"w-4 h-4 text-blue-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.styleLabel})]}),b.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.characterSection.optional})]}),b.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[{style:"comic",emoji:"💥",getDesc:()=>t.aiPanel.storyMaker.styles.comic},{style:"manga",emoji:"🎌",getDesc:()=>t.aiPanel.storyMaker.styles.manga},{style:"watercolor",emoji:"🏰",getDesc:()=>t.aiPanel.storyMaker.styles.watercolor},{style:"oil",emoji:"📷",getDesc:()=>t.aiPanel.storyMaker.styles.oil},{style:"sketch",emoji:"✨",getDesc:()=>t.aiPanel.storyMaker.styles.sketch}].map(({style:A,emoji:F,getDesc:Y})=>b.jsxs("button",{onClick:()=>T(A),className:`p-3 rounded-xl transition-all duration-200 border-2 ${S===A?"bg-gradient-to-br from-blue-500 to-purple-600 text-white border-blue-400 shadow-lg transform scale-105":"bg-gradient-to-br from-gray-50 to-white text-gray-700 border-gray-200 hover:border-blue-300 hover:shadow-md hover:transform hover:scale-102"}`,children:[b.jsx("div",{className:"text-lg mb-1",children:F}),b.jsx("div",{className:"font-bold capitalize",children:Y()}),b.jsx("div",{className:`text-xs opacity-75 ${S===A?"text-white":"text-gray-500"}`,children:A})]},A))})]}),b.jsxs("div",{className:"space-y-3 p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl border-2 border-dashed border-purple-200",children:[b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm font-bold text-gray-800 mb-2",children:[b.jsx("span",{className:"text-base",children:"🪄"}),b.jsx("span",{children:"Ready to Create Your Story?"})]}),b.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"AI will generate 4 cinematic panels with consistent character & product placement"})]}),b.jsx("button",{onClick:L,disabled:w||!p.trim(),className:"w-full py-4 px-6 bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 hover:from-purple-700 hover:via-pink-700 hover:to-red-600 disabled:from-gray-300 disabled:to-gray-400 text-white text-base rounded-2xl transition-all flex items-center justify-center space-x-3 font-black shadow-2xl hover:shadow-purple-500/25 transform hover:scale-105 disabled:scale-100 disabled:opacity-50",children:w?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),b.jsxs("span",{children:["🎬 ",t.aiPanel.storyMaker.generatingPanels]})]}):b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"flex items-center space-x-2 bg-white/20 rounded-lg px-3 py-1",children:[b.jsx(Os,{className:"w-5 h-5"}),b.jsx("span",{className:"font-bold",children:"4 PANELS"})]}),b.jsxs("span",{children:["✨ ",t.aiPanel.storyMaker.generateButton.toUpperCase()]}),b.jsxs("div",{className:"flex items-center space-x-1 bg-white/20 rounded-lg px-2 py-1",children:[b.jsx(Ll,{className:"w-4 h-4"}),b.jsx("span",{className:"text-xs font-medium",children:"+ Video"})]})]})})]}),x.length>0&&b.jsxs("div",{className:"text-center p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-300 shadow-sm",children:[b.jsxs("p",{className:"text-xs text-green-700 font-medium",children:["✅ Generated ",x.length,"/4 panels"]}),b.jsx("div",{className:"mt-1 text-xs text-green-600",children:"📖 Story broken into: Setup → Development → Climax → Resolution"}),b.jsxs("div",{className:"mt-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-inner",children:[b.jsxs("p",{className:"text-xs font-bold text-blue-700 mb-2 flex items-center",children:[b.jsx("span",{className:"mr-1",children:"✨"})," Quick Edit with Words"]}),b.jsx("input",{type:"text",value:te,onChange:A=>re(A.target.value),placeholder:"Change time to snowy Christmas night, add falling snow...",className:"w-full text-xs p-2.5 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/70",disabled:w}),b.jsx("div",{className:"grid grid-cols-1 gap-2 mt-3",children:b.jsx("button",{onClick:B,disabled:w||!te.trim(),className:"text-xs py-2 px-3 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 disabled:bg-gray-300 text-white rounded-lg transition-all font-medium shadow hover:shadow-md transform hover:scale-105 disabled:scale-100",children:w?"✨ Editing All Panels...":"✨ Edit All Panels"})})]}),b.jsxs("div",{className:"mt-2 space-y-1",children:[b.jsx("button",{onClick:E,disabled:w,className:"w-full py-2 px-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 disabled:bg-gray-300 text-white text-xs rounded-lg transition-all flex items-center justify-center space-x-1",children:w?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),b.jsx("span",{children:"Creating Video..."})]}):b.jsxs(b.Fragment,{children:[b.jsx(Ll,{className:"w-3 h-3"}),b.jsx("span",{children:"🎬 Make 8s Video"})]})}),oe&&b.jsxs("button",{onClick:()=>{console.log("🎬 Opening latest video:",oe),window.open(oe,"_blank")},className:"w-full py-2 px-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white text-xs rounded-lg transition-all flex items-center justify-center space-x-1",children:[b.jsx(eh,{className:"w-3 h-3"}),b.jsx("span",{children:"🎥 Watch Video"})]})]})]})]})]})]})},rp=({isOpen:t,setIsOpen:e})=>{const[n,c]=ue.useState(""),[m,y]=ue.useState("idle");ue.useEffect(()=>{const r=localStorage.getItem("omnicanvas-backend-url");if(r)c(r),xe.configure(r),w(r);else{const o="https://omnicanvas-backend.vercel.app/api";c(o),w(o)}},[]);const w=async r=>{const o=r||n;if(o){y("testing");try{xe.configure(o),await xe.testConnection()?(y("connected"),localStorage.setItem("omnicanvas-backend-url",o)):y("error")}catch(i){console.error("Connection test failed:",i),y("error")}}},f=r=>{c(r),y("idle")},s=()=>{n&&w()},u=()=>{switch(m){case"testing":return b.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"});case"connected":return b.jsx(Gd,{className:"w-4 h-4 text-green-600"});case"error":return b.jsx(Fl,{className:"w-4 h-4 text-red-600"});default:return b.jsx(cg,{className:"w-4 h-4 text-gray-400"})}},h=()=>{switch(m){case"testing":return"Testing connection...";case"connected":return"Connected to backend";case"error":return"Connection failed";default:return"Ready to test"}};return b.jsx(b.Fragment,{children:t&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>e(!1)}),b.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-white rounded-lg shadow-xl p-6 w-full max-w-md",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(rg,{className:"w-5 h-5 text-blue-600"}),b.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Backend API Settings"})]}),b.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-gray-600",children:b.jsx(Fl,{className:"w-5 h-5"})})]}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[b.jsxs("h3",{className:"text-sm font-medium text-blue-900 mb-2 flex items-center",children:[b.jsx(Jd,{className:"w-4 h-4 mr-2"}),"AI Service Configuration"]}),b.jsx("p",{className:"text-xs text-blue-800",children:"API keys are securely managed by your backend service. Configure your backend URL below to connect to your AI services."})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Backend API URL"}),b.jsxs("div",{className:"flex space-x-2",children:[b.jsx("input",{type:"url",value:n,onChange:r=>f(r.target.value),placeholder:"https://your-backend.vercel.app/api",className:"flex-1 text-sm border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),b.jsxs("button",{onClick:s,disabled:!n||m==="testing",className:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 disabled:bg-blue-300 text-white rounded transition-colors flex items-center space-x-2",children:[u(),b.jsx("span",{children:"Test"})]})]}),b.jsxs("div",{className:"flex items-center space-x-2 mt-2",children:[u(),b.jsx("span",{className:`text-xs ${m==="connected"?"text-green-600":m==="error"?"text-red-600":m==="testing"?"text-blue-600":"text-gray-500"}`,children:h()})]})]}),b.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[b.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Backend Services Required:"}),b.jsxs("ul",{className:"text-xs text-gray-700 space-y-1",children:[b.jsxs("li",{children:["• ",b.jsx("strong",{children:"Gemini API:"})," Image generation and AI composition"]}),b.jsxs("li",{children:["• ",b.jsx("strong",{children:"Fal.ai API:"})," Advanced image processing"]}),b.jsxs("li",{children:["• ",b.jsx("strong",{children:"ElevenLabs API:"})," Voice generation"]}),b.jsxs("li",{children:["• ",b.jsx("strong",{children:"Health Check:"})," /health endpoint for status"]})]})]}),b.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[b.jsxs("h3",{className:"text-sm font-medium text-green-900 mb-2 flex items-center",children:[b.jsx(sg,{className:"w-4 h-4 mr-2"}),"Security Benefits"]}),b.jsxs("ul",{className:"text-xs text-green-800 space-y-1",children:[b.jsx("li",{children:"• API keys never leave your backend server"}),b.jsx("li",{children:"• No sensitive data stored in browser"}),b.jsx("li",{children:"• Centralized API key management"}),b.jsx("li",{children:"• Rate limiting and usage control"})]})]}),b.jsx("div",{className:"flex justify-end space-x-2 pt-4",children:b.jsx("button",{onClick:()=>e(!1),className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:"Close"})})]})]})]})})},ip=()=>{const{currentLanguage:t,setLanguage:e}=Sa(),[n,c]=ue.useState(!1),m=ah(t),y=[{code:"en",flag:"🇺🇸",name:m.language.en},{code:"zh-TW",flag:"🇹🇼",name:m.language.zhTW},{code:"es",flag:"🇪🇸",name:m.language.es},{code:"ja",flag:"🇯🇵",name:m.language.ja},{code:"fr",flag:"🇫🇷",name:m.language.fr}],w=y.find(f=>f.code===t)||y[0];return b.jsxs("div",{className:"relative",children:[b.jsxs("button",{onClick:()=>c(!n),className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200",children:[b.jsx(qd,{className:"w-4 h-4"}),b.jsx("span",{className:"text-lg",children:w.flag}),b.jsx("span",{className:"hidden sm:inline",children:w.name}),b.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),b.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-20 overflow-hidden",children:y.map(f=>b.jsxs("button",{onClick:()=>{e(f.code),c(!1)},className:`w-full flex items-center space-x-3 px-4 py-3 text-sm hover:bg-gray-50 transition-colors duration-150 ${t===f.code?"bg-blue-50 text-blue-700 border-r-4 border-blue-500":"text-gray-700"}`,children:[b.jsx("span",{className:"text-lg",children:f.flag}),b.jsx("span",{className:"font-medium",children:f.name}),t===f.code&&b.jsx("div",{className:"ml-auto w-2 h-2 bg-blue-500 rounded-full"})]},f.code))})]})]})};function sp(){const[t,e]=ue.useState(!1),[n,c]=ue.useState(!0);return ue.useEffect(()=>{const m=setTimeout(()=>{window.dispatchEvent(new Event("resize"))},300);return()=>clearTimeout(m)},[n]),b.jsxs("div",{className:"h-screen w-screen flex flex-col bg-gray-100",children:[b.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center space-x-4",children:[b.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"OmniCanvas"}),b.jsx("span",{className:"text-sm text-gray-500",children:"AI Creative Canvas"})]}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(ip,{}),b.jsxs("button",{onClick:()=>c(!n),className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:n?"Hide AI Assistant":"Show AI Assistant",children:[n?b.jsx(eg,{className:"w-4 h-4"}):b.jsx(tg,{className:"w-4 h-4"}),b.jsx("span",{children:n?"Hide Panel":"Show Panel"})]}),b.jsxs("button",{onClick:()=>e(!0),className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[b.jsx(ig,{className:"w-4 h-4"}),b.jsx("span",{children:"Settings"})]})]})]}),b.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[b.jsx(Hg,{}),b.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:b.jsx(Ug,{})}),n&&b.jsx("div",{className:"w-80 lg:w-96 xl:w-[420px] bg-white border-l border-gray-200 flex flex-col overflow-hidden flex-shrink-0 transition-all duration-300 ease-in-out",children:b.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-y-auto",children:b.jsx(np,{})})})]}),b.jsx(rp,{isOpen:t,setIsOpen:e})]})}Ms.createRoot(document.getElementById("root")).render(b.jsx(Ql.StrictMode,{children:b.jsx(sp,{})}));
