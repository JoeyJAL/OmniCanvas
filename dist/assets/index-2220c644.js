var vh=Object.defineProperty;var yh=(t,e,n)=>e in t?vh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var qn=(t,e,n)=>(yh(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const y of m)if(y.type==="childList")for(const w of y.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&c(w)}).observe(document,{childList:!0,subtree:!0});function n(m){const y={};return m.integrity&&(y.integrity=m.integrity),m.referrerPolicy&&(y.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?y.credentials="include":m.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function c(m){if(m.ep)return;m.ep=!0;const y=n(m);fetch(m.href,y)}})();function Xl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function xh(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function c(){return this instanceof c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(c){var m=Object.getOwnPropertyDescriptor(t,c);Object.defineProperty(n,c,m.get?m:{enumerable:!0,get:function(){return t[c]}})}),n}var Yl={exports:{}},Ui={},Vl={exports:{}},fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Nr=Symbol.for("react.element"),wh=Symbol.for("react.portal"),Sh=Symbol.for("react.fragment"),Ch=Symbol.for("react.strict_mode"),_h=Symbol.for("react.profiler"),bh=Symbol.for("react.provider"),Th=Symbol.for("react.context"),kh=Symbol.for("react.forward_ref"),Oh=Symbol.for("react.suspense"),Ph=Symbol.for("react.memo"),Eh=Symbol.for("react.lazy"),Oo=Symbol.iterator;function jh(t){return t===null||typeof t!="object"?null:(t=Oo&&t[Oo]||t["@@iterator"],typeof t=="function"?t:null)}var Gl={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$l=Object.assign,Kl={};function Vn(t,e,n){this.props=t,this.context=e,this.refs=Kl,this.updater=n||Gl}Vn.prototype.isReactComponent={};Vn.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Vn.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function ql(){}ql.prototype=Vn.prototype;function Ea(t,e,n){this.props=t,this.context=e,this.refs=Kl,this.updater=n||Gl}var ja=Ea.prototype=new ql;ja.constructor=Ea;$l(ja,Vn.prototype);ja.isPureReactComponent=!0;var Po=Array.isArray,Ql=Object.prototype.hasOwnProperty,Da={current:null},Jl={key:!0,ref:!0,__self:!0,__source:!0};function Zl(t,e,n){var c,m={},y=null,w=null;if(e!=null)for(c in e.ref!==void 0&&(w=e.ref),e.key!==void 0&&(y=""+e.key),e)Ql.call(e,c)&&!Jl.hasOwnProperty(c)&&(m[c]=e[c]);var h=arguments.length-2;if(h===1)m.children=n;else if(1<h){for(var s=Array(h),u=0;u<h;u++)s[u]=arguments[u+2];m.children=s}if(t&&t.defaultProps)for(c in h=t.defaultProps,h)m[c]===void 0&&(m[c]=h[c]);return{$$typeof:Nr,type:t,key:y,ref:w,props:m,_owner:Da.current}}function Dh(t,e){return{$$typeof:Nr,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ma(t){return typeof t=="object"&&t!==null&&t.$$typeof===Nr}function Mh(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var Eo=/\/+/g;function ss(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Mh(""+t.key):e.toString(36)}function si(t,e,n,c,m){var y=typeof t;(y==="undefined"||y==="boolean")&&(t=null);var w=!1;if(t===null)w=!0;else switch(y){case"string":case"number":w=!0;break;case"object":switch(t.$$typeof){case Nr:case wh:w=!0}}if(w)return w=t,m=m(w),t=c===""?"."+ss(w,0):c,Po(m)?(n="",t!=null&&(n=t.replace(Eo,"$&/")+"/"),si(m,e,n,"",function(u){return u})):m!=null&&(Ma(m)&&(m=Dh(m,n+(!m.key||w&&w.key===m.key?"":(""+m.key).replace(Eo,"$&/")+"/")+t)),e.push(m)),1;if(w=0,c=c===""?".":c+":",Po(t))for(var h=0;h<t.length;h++){y=t[h];var s=c+ss(y,h);w+=si(y,e,n,s,m)}else if(s=jh(t),typeof s=="function")for(t=s.call(t),h=0;!(y=t.next()).done;)y=y.value,s=c+ss(y,h++),w+=si(y,e,n,s,m);else if(y==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return w}function Wr(t,e,n){if(t==null)return t;var c=[],m=0;return si(t,c,"","",function(y){return e.call(n,y,m++)}),c}function Ah(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ye={current:null},ai={transition:null},Ih={ReactCurrentDispatcher:Ye,ReactCurrentBatchConfig:ai,ReactCurrentOwner:Da};function ec(){throw Error("act(...) is not supported in production builds of React.")}fe.Children={map:Wr,forEach:function(t,e,n){Wr(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Wr(t,function(){e++}),e},toArray:function(t){return Wr(t,function(e){return e})||[]},only:function(t){if(!Ma(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};fe.Component=Vn;fe.Fragment=Sh;fe.Profiler=_h;fe.PureComponent=Ea;fe.StrictMode=Ch;fe.Suspense=Oh;fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ih;fe.act=ec;fe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var c=$l({},t.props),m=t.key,y=t.ref,w=t._owner;if(e!=null){if(e.ref!==void 0&&(y=e.ref,w=Da.current),e.key!==void 0&&(m=""+e.key),t.type&&t.type.defaultProps)var h=t.type.defaultProps;for(s in e)Ql.call(e,s)&&!Jl.hasOwnProperty(s)&&(c[s]=e[s]===void 0&&h!==void 0?h[s]:e[s])}var s=arguments.length-2;if(s===1)c.children=n;else if(1<s){h=Array(s);for(var u=0;u<s;u++)h[u]=arguments[u+2];c.children=h}return{$$typeof:Nr,type:t.type,key:m,ref:y,props:c,_owner:w}};fe.createContext=function(t){return t={$$typeof:Th,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:bh,_context:t},t.Consumer=t};fe.createElement=Zl;fe.createFactory=function(t){var e=Zl.bind(null,t);return e.type=t,e};fe.createRef=function(){return{current:null}};fe.forwardRef=function(t){return{$$typeof:kh,render:t}};fe.isValidElement=Ma;fe.lazy=function(t){return{$$typeof:Eh,_payload:{_status:-1,_result:t},_init:Ah}};fe.memo=function(t,e){return{$$typeof:Ph,type:t,compare:e===void 0?null:e}};fe.startTransition=function(t){var e=ai.transition;ai.transition={};try{t()}finally{ai.transition=e}};fe.unstable_act=ec;fe.useCallback=function(t,e){return Ye.current.useCallback(t,e)};fe.useContext=function(t){return Ye.current.useContext(t)};fe.useDebugValue=function(){};fe.useDeferredValue=function(t){return Ye.current.useDeferredValue(t)};fe.useEffect=function(t,e){return Ye.current.useEffect(t,e)};fe.useId=function(){return Ye.current.useId()};fe.useImperativeHandle=function(t,e,n){return Ye.current.useImperativeHandle(t,e,n)};fe.useInsertionEffect=function(t,e){return Ye.current.useInsertionEffect(t,e)};fe.useLayoutEffect=function(t,e){return Ye.current.useLayoutEffect(t,e)};fe.useMemo=function(t,e){return Ye.current.useMemo(t,e)};fe.useReducer=function(t,e,n){return Ye.current.useReducer(t,e,n)};fe.useRef=function(t){return Ye.current.useRef(t)};fe.useState=function(t){return Ye.current.useState(t)};fe.useSyncExternalStore=function(t,e,n){return Ye.current.useSyncExternalStore(t,e,n)};fe.useTransition=function(){return Ye.current.useTransition()};fe.version="18.3.1";Vl.exports=fe;var he=Vl.exports;const tc=Xl(he);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lh=he,Fh=Symbol.for("react.element"),Nh=Symbol.for("react.fragment"),Rh=Object.prototype.hasOwnProperty,zh=Lh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Bh={key:!0,ref:!0,__self:!0,__source:!0};function nc(t,e,n){var c,m={},y=null,w=null;n!==void 0&&(y=""+n),e.key!==void 0&&(y=""+e.key),e.ref!==void 0&&(w=e.ref);for(c in e)Rh.call(e,c)&&!Bh.hasOwnProperty(c)&&(m[c]=e[c]);if(t&&t.defaultProps)for(c in e=t.defaultProps,e)m[c]===void 0&&(m[c]=e[c]);return{$$typeof:Fh,type:t,key:y,ref:w,props:m,_owner:zh.current}}Ui.Fragment=Nh;Ui.jsx=nc;Ui.jsxs=nc;Yl.exports=Ui;var b=Yl.exports,Ls={},rc={exports:{}},nt={},ic={exports:{}},sc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(G,_){var D=G.length;G.push(_);e:for(;0<D;){var P=D-1>>>1,j=G[P];if(0<m(j,_))G[P]=_,G[D]=j,D=P;else break e}}function n(G){return G.length===0?null:G[0]}function c(G){if(G.length===0)return null;var _=G[0],D=G.pop();if(D!==_){G[0]=D;e:for(var P=0,j=G.length,X=j>>>1;P<X;){var M=2*(P+1)-1,k=G[M],L=M+1,R=G[L];if(0>m(k,D))L<j&&0>m(R,k)?(G[P]=R,G[L]=D,P=L):(G[P]=k,G[M]=D,P=M);else if(L<j&&0>m(R,D))G[P]=R,G[L]=D,P=L;else break e}}return _}function m(G,_){var D=G.sortIndex-_.sortIndex;return D!==0?D:G.id-_.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;t.unstable_now=function(){return y.now()}}else{var w=Date,h=w.now();t.unstable_now=function(){return w.now()-h}}var s=[],u=[],f=1,r=null,a=3,i=!1,l=!1,d=!1,o=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(G){for(var _=n(u);_!==null;){if(_.callback===null)c(u);else if(_.startTime<=G)c(u),_.sortIndex=_.expirationTime,e(s,_);else break;_=n(u)}}function x(G){if(d=!1,v(G),!l)if(n(s)!==null)l=!0,ae(S);else{var _=n(u);_!==null&&le(x,_.startTime-G)}}function S(G,_){l=!1,d&&(d=!1,g(O),O=-1),i=!0;var D=a;try{for(v(_),r=n(s);r!==null&&(!(r.expirationTime>_)||G&&!J());){var P=r.callback;if(typeof P=="function"){r.callback=null,a=r.priorityLevel;var j=P(r.expirationTime<=_);_=t.unstable_now(),typeof j=="function"?r.callback=j:r===n(s)&&c(s),v(_)}else c(s);r=n(s)}if(r!==null)var X=!0;else{var M=n(u);M!==null&&le(x,M.startTime-_),X=!1}return X}finally{r=null,a=D,i=!1}}var C=!1,T=null,O=-1,N=5,U=-1;function J(){return!(t.unstable_now()-U<N)}function te(){if(T!==null){var G=t.unstable_now();U=G;var _=!0;try{_=T(!0,G)}finally{_?se():(C=!1,T=null)}}else C=!1}var se;if(typeof p=="function")se=function(){p(te)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,re=ne.port2;ne.port1.onmessage=te,se=function(){re.postMessage(null)}}else se=function(){o(te,0)};function ae(G){T=G,C||(C=!0,se())}function le(G,_){O=o(function(){G(t.unstable_now())},_)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(G){G.callback=null},t.unstable_continueExecution=function(){l||i||(l=!0,ae(S))},t.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<G?Math.floor(1e3/G):5},t.unstable_getCurrentPriorityLevel=function(){return a},t.unstable_getFirstCallbackNode=function(){return n(s)},t.unstable_next=function(G){switch(a){case 1:case 2:case 3:var _=3;break;default:_=a}var D=a;a=_;try{return G()}finally{a=D}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(G,_){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var D=a;a=G;try{return _()}finally{a=D}},t.unstable_scheduleCallback=function(G,_,D){var P=t.unstable_now();switch(typeof D=="object"&&D!==null?(D=D.delay,D=typeof D=="number"&&0<D?P+D:P):D=P,G){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=D+j,G={id:f++,callback:_,priorityLevel:G,startTime:D,expirationTime:j,sortIndex:-1},D>P?(G.sortIndex=D,e(u,G),n(s)===null&&G===n(u)&&(d?(g(O),O=-1):d=!0,le(x,D-P))):(G.sortIndex=j,e(s,G),l||i||(l=!0,ae(S))),G},t.unstable_shouldYield=J,t.unstable_wrapCallback=function(G){var _=a;return function(){var D=a;a=_;try{return G.apply(this,arguments)}finally{a=D}}}})(sc);ic.exports=sc;var Uh=ic.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wh=he,tt=Uh;function ee(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ac=new Set,xr={};function pn(t,e){Rn(t,e),Rn(t+"Capture",e)}function Rn(t,e){for(xr[t]=e,t=0;t<e.length;t++)ac.add(e[t])}var Pt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fs=Object.prototype.hasOwnProperty,Hh=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jo={},Do={};function Xh(t){return Fs.call(Do,t)?!0:Fs.call(jo,t)?!1:Hh.test(t)?Do[t]=!0:(jo[t]=!0,!1)}function Yh(t,e,n,c){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return c?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Vh(t,e,n,c){if(e===null||typeof e>"u"||Yh(t,e,n,c))return!0;if(c)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ve(t,e,n,c,m,y,w){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=c,this.attributeNamespace=m,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=y,this.removeEmptyString=w}var Le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Le[t]=new Ve(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Le[e]=new Ve(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Le[t]=new Ve(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Le[t]=new Ve(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Le[t]=new Ve(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Le[t]=new Ve(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Le[t]=new Ve(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Le[t]=new Ve(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Le[t]=new Ve(t,5,!1,t.toLowerCase(),null,!1,!1)});var Aa=/[\-:]([a-z])/g;function Ia(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Aa,Ia);Le[e]=new Ve(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Aa,Ia);Le[e]=new Ve(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Aa,Ia);Le[e]=new Ve(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Le[t]=new Ve(t,1,!1,t.toLowerCase(),null,!1,!1)});Le.xlinkHref=new Ve("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Le[t]=new Ve(t,1,!1,t.toLowerCase(),null,!0,!0)});function La(t,e,n,c){var m=Le.hasOwnProperty(e)?Le[e]:null;(m!==null?m.type!==0:c||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Vh(e,n,m,c)&&(n=null),c||m===null?Xh(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):m.mustUseProperty?t[m.propertyName]=n===null?m.type===3?!1:"":n:(e=m.attributeName,c=m.attributeNamespace,n===null?t.removeAttribute(e):(m=m.type,n=m===3||m===4&&n===!0?"":""+n,c?t.setAttributeNS(c,e,n):t.setAttribute(e,n))))}var Mt=Wh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Hr=Symbol.for("react.element"),yn=Symbol.for("react.portal"),xn=Symbol.for("react.fragment"),Fa=Symbol.for("react.strict_mode"),Ns=Symbol.for("react.profiler"),oc=Symbol.for("react.provider"),lc=Symbol.for("react.context"),Na=Symbol.for("react.forward_ref"),Rs=Symbol.for("react.suspense"),zs=Symbol.for("react.suspense_list"),Ra=Symbol.for("react.memo"),Lt=Symbol.for("react.lazy"),cc=Symbol.for("react.offscreen"),Mo=Symbol.iterator;function Qn(t){return t===null||typeof t!="object"?null:(t=Mo&&t[Mo]||t["@@iterator"],typeof t=="function"?t:null)}var be=Object.assign,as;function sr(t){if(as===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);as=e&&e[1]||""}return`
`+as+t}var os=!1;function ls(t,e){if(!t||os)return"";os=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var c=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){c=u}t.call(e.prototype)}else{try{throw Error()}catch(u){c=u}t()}}catch(u){if(u&&c&&typeof u.stack=="string"){for(var m=u.stack.split(`
`),y=c.stack.split(`
`),w=m.length-1,h=y.length-1;1<=w&&0<=h&&m[w]!==y[h];)h--;for(;1<=w&&0<=h;w--,h--)if(m[w]!==y[h]){if(w!==1||h!==1)do if(w--,h--,0>h||m[w]!==y[h]){var s=`
`+m[w].replace(" at new "," at ");return t.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",t.displayName)),s}while(1<=w&&0<=h);break}}}finally{os=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?sr(t):""}function Gh(t){switch(t.tag){case 5:return sr(t.type);case 16:return sr("Lazy");case 13:return sr("Suspense");case 19:return sr("SuspenseList");case 0:case 2:case 15:return t=ls(t.type,!1),t;case 11:return t=ls(t.type.render,!1),t;case 1:return t=ls(t.type,!0),t;default:return""}}function Bs(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case xn:return"Fragment";case yn:return"Portal";case Ns:return"Profiler";case Fa:return"StrictMode";case Rs:return"Suspense";case zs:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case lc:return(t.displayName||"Context")+".Consumer";case oc:return(t._context.displayName||"Context")+".Provider";case Na:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ra:return e=t.displayName||null,e!==null?e:Bs(t.type)||"Memo";case Lt:e=t._payload,t=t._init;try{return Bs(t(e))}catch{}}return null}function $h(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bs(e);case 8:return e===Fa?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Kt(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function uc(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Kh(t){var e=uc(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),c=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var m=n.get,y=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return m.call(this)},set:function(w){c=""+w,y.call(this,w)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return c},setValue:function(w){c=""+w},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Xr(t){t._valueTracker||(t._valueTracker=Kh(t))}function hc(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),c="";return t&&(c=uc(t)?t.checked?"true":"false":t.value),t=c,t!==n?(e.setValue(t),!0):!1}function vi(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Us(t,e){var n=e.checked;return be({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Ao(t,e){var n=e.defaultValue==null?"":e.defaultValue,c=e.checked!=null?e.checked:e.defaultChecked;n=Kt(e.value!=null?e.value:n),t._wrapperState={initialChecked:c,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function fc(t,e){e=e.checked,e!=null&&La(t,"checked",e,!1)}function Ws(t,e){fc(t,e);var n=Kt(e.value),c=e.type;if(n!=null)c==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(c==="submit"||c==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Hs(t,e.type,n):e.hasOwnProperty("defaultValue")&&Hs(t,e.type,Kt(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Io(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var c=e.type;if(!(c!=="submit"&&c!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Hs(t,e,n){(e!=="number"||vi(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ar=Array.isArray;function Dn(t,e,n,c){if(t=t.options,e){e={};for(var m=0;m<n.length;m++)e["$"+n[m]]=!0;for(n=0;n<t.length;n++)m=e.hasOwnProperty("$"+t[n].value),t[n].selected!==m&&(t[n].selected=m),m&&c&&(t[n].defaultSelected=!0)}else{for(n=""+Kt(n),e=null,m=0;m<t.length;m++){if(t[m].value===n){t[m].selected=!0,c&&(t[m].defaultSelected=!0);return}e!==null||t[m].disabled||(e=t[m])}e!==null&&(e.selected=!0)}}function Xs(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ee(91));return be({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Lo(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ee(92));if(ar(n)){if(1<n.length)throw Error(ee(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Kt(n)}}function dc(t,e){var n=Kt(e.value),c=Kt(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),c!=null&&(t.defaultValue=""+c)}function Fo(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function gc(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ys(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?gc(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Yr,pc=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,c,m){MSApp.execUnsafeLocalFunction(function(){return t(e,n,c,m)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Yr=Yr||document.createElement("div"),Yr.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Yr.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function wr(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var cr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qh=["Webkit","ms","Moz","O"];Object.keys(cr).forEach(function(t){qh.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),cr[e]=cr[t]})});function mc(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||cr.hasOwnProperty(t)&&cr[t]?(""+e).trim():e+"px"}function vc(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var c=n.indexOf("--")===0,m=mc(n,e[n],c);n==="float"&&(n="cssFloat"),c?t.setProperty(n,m):t[n]=m}}var Qh=be({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vs(t,e){if(e){if(Qh[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ee(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ee(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ee(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ee(62))}}function Gs(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $s=null;function za(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ks=null,Mn=null,An=null;function No(t){if(t=Br(t)){if(typeof Ks!="function")throw Error(ee(280));var e=t.stateNode;e&&(e=Vi(e),Ks(t.stateNode,t.type,e))}}function yc(t){Mn?An?An.push(t):An=[t]:Mn=t}function xc(){if(Mn){var t=Mn,e=An;if(An=Mn=null,No(t),e)for(t=0;t<e.length;t++)No(e[t])}}function wc(t,e){return t(e)}function Sc(){}var cs=!1;function Cc(t,e,n){if(cs)return t(e,n);cs=!0;try{return wc(t,e,n)}finally{cs=!1,(Mn!==null||An!==null)&&(Sc(),xc())}}function Sr(t,e){var n=t.stateNode;if(n===null)return null;var c=Vi(n);if(c===null)return null;n=c[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ee(231,e,typeof n));return n}var qs=!1;if(Pt)try{var Jn={};Object.defineProperty(Jn,"passive",{get:function(){qs=!0}}),window.addEventListener("test",Jn,Jn),window.removeEventListener("test",Jn,Jn)}catch{qs=!1}function Jh(t,e,n,c,m,y,w,h,s){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(f){this.onError(f)}}var ur=!1,yi=null,xi=!1,Qs=null,Zh={onError:function(t){ur=!0,yi=t}};function ef(t,e,n,c,m,y,w,h,s){ur=!1,yi=null,Jh.apply(Zh,arguments)}function tf(t,e,n,c,m,y,w,h,s){if(ef.apply(this,arguments),ur){if(ur){var u=yi;ur=!1,yi=null}else throw Error(ee(198));xi||(xi=!0,Qs=u)}}function mn(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function _c(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Ro(t){if(mn(t)!==t)throw Error(ee(188))}function nf(t){var e=t.alternate;if(!e){if(e=mn(t),e===null)throw Error(ee(188));return e!==t?null:t}for(var n=t,c=e;;){var m=n.return;if(m===null)break;var y=m.alternate;if(y===null){if(c=m.return,c!==null){n=c;continue}break}if(m.child===y.child){for(y=m.child;y;){if(y===n)return Ro(m),t;if(y===c)return Ro(m),e;y=y.sibling}throw Error(ee(188))}if(n.return!==c.return)n=m,c=y;else{for(var w=!1,h=m.child;h;){if(h===n){w=!0,n=m,c=y;break}if(h===c){w=!0,c=m,n=y;break}h=h.sibling}if(!w){for(h=y.child;h;){if(h===n){w=!0,n=y,c=m;break}if(h===c){w=!0,c=y,n=m;break}h=h.sibling}if(!w)throw Error(ee(189))}}if(n.alternate!==c)throw Error(ee(190))}if(n.tag!==3)throw Error(ee(188));return n.stateNode.current===n?t:e}function bc(t){return t=nf(t),t!==null?Tc(t):null}function Tc(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Tc(t);if(e!==null)return e;t=t.sibling}return null}var kc=tt.unstable_scheduleCallback,zo=tt.unstable_cancelCallback,rf=tt.unstable_shouldYield,sf=tt.unstable_requestPaint,ke=tt.unstable_now,af=tt.unstable_getCurrentPriorityLevel,Ba=tt.unstable_ImmediatePriority,Oc=tt.unstable_UserBlockingPriority,wi=tt.unstable_NormalPriority,of=tt.unstable_LowPriority,Pc=tt.unstable_IdlePriority,Wi=null,St=null;function lf(t){if(St&&typeof St.onCommitFiberRoot=="function")try{St.onCommitFiberRoot(Wi,t,void 0,(t.current.flags&128)===128)}catch{}}var gt=Math.clz32?Math.clz32:hf,cf=Math.log,uf=Math.LN2;function hf(t){return t>>>=0,t===0?32:31-(cf(t)/uf|0)|0}var Vr=64,Gr=4194304;function or(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Si(t,e){var n=t.pendingLanes;if(n===0)return 0;var c=0,m=t.suspendedLanes,y=t.pingedLanes,w=n&268435455;if(w!==0){var h=w&~m;h!==0?c=or(h):(y&=w,y!==0&&(c=or(y)))}else w=n&~m,w!==0?c=or(w):y!==0&&(c=or(y));if(c===0)return 0;if(e!==0&&e!==c&&!(e&m)&&(m=c&-c,y=e&-e,m>=y||m===16&&(y&4194240)!==0))return e;if(c&4&&(c|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=c;0<e;)n=31-gt(e),m=1<<n,c|=t[n],e&=~m;return c}function ff(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function df(t,e){for(var n=t.suspendedLanes,c=t.pingedLanes,m=t.expirationTimes,y=t.pendingLanes;0<y;){var w=31-gt(y),h=1<<w,s=m[w];s===-1?(!(h&n)||h&c)&&(m[w]=ff(h,e)):s<=e&&(t.expiredLanes|=h),y&=~h}}function Js(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Ec(){var t=Vr;return Vr<<=1,!(Vr&4194240)&&(Vr=64),t}function us(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Rr(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-gt(e),t[e]=n}function gf(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var c=t.eventTimes;for(t=t.expirationTimes;0<n;){var m=31-gt(n),y=1<<m;e[m]=0,c[m]=-1,t[m]=-1,n&=~y}}function Ua(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var c=31-gt(n),m=1<<c;m&e|t[c]&e&&(t[c]|=e),n&=~m}}var pe=0;function jc(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Dc,Wa,Mc,Ac,Ic,Zs=!1,$r=[],Ut=null,Wt=null,Ht=null,Cr=new Map,_r=new Map,Nt=[],pf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bo(t,e){switch(t){case"focusin":case"focusout":Ut=null;break;case"dragenter":case"dragleave":Wt=null;break;case"mouseover":case"mouseout":Ht=null;break;case"pointerover":case"pointerout":Cr.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":_r.delete(e.pointerId)}}function Zn(t,e,n,c,m,y){return t===null||t.nativeEvent!==y?(t={blockedOn:e,domEventName:n,eventSystemFlags:c,nativeEvent:y,targetContainers:[m]},e!==null&&(e=Br(e),e!==null&&Wa(e)),t):(t.eventSystemFlags|=c,e=t.targetContainers,m!==null&&e.indexOf(m)===-1&&e.push(m),t)}function mf(t,e,n,c,m){switch(e){case"focusin":return Ut=Zn(Ut,t,e,n,c,m),!0;case"dragenter":return Wt=Zn(Wt,t,e,n,c,m),!0;case"mouseover":return Ht=Zn(Ht,t,e,n,c,m),!0;case"pointerover":var y=m.pointerId;return Cr.set(y,Zn(Cr.get(y)||null,t,e,n,c,m)),!0;case"gotpointercapture":return y=m.pointerId,_r.set(y,Zn(_r.get(y)||null,t,e,n,c,m)),!0}return!1}function Lc(t){var e=sn(t.target);if(e!==null){var n=mn(e);if(n!==null){if(e=n.tag,e===13){if(e=_c(n),e!==null){t.blockedOn=e,Ic(t.priority,function(){Mc(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function oi(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ea(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var c=new n.constructor(n.type,n);$s=c,n.target.dispatchEvent(c),$s=null}else return e=Br(n),e!==null&&Wa(e),t.blockedOn=n,!1;e.shift()}return!0}function Uo(t,e,n){oi(t)&&n.delete(e)}function vf(){Zs=!1,Ut!==null&&oi(Ut)&&(Ut=null),Wt!==null&&oi(Wt)&&(Wt=null),Ht!==null&&oi(Ht)&&(Ht=null),Cr.forEach(Uo),_r.forEach(Uo)}function er(t,e){t.blockedOn===e&&(t.blockedOn=null,Zs||(Zs=!0,tt.unstable_scheduleCallback(tt.unstable_NormalPriority,vf)))}function br(t){function e(m){return er(m,t)}if(0<$r.length){er($r[0],t);for(var n=1;n<$r.length;n++){var c=$r[n];c.blockedOn===t&&(c.blockedOn=null)}}for(Ut!==null&&er(Ut,t),Wt!==null&&er(Wt,t),Ht!==null&&er(Ht,t),Cr.forEach(e),_r.forEach(e),n=0;n<Nt.length;n++)c=Nt[n],c.blockedOn===t&&(c.blockedOn=null);for(;0<Nt.length&&(n=Nt[0],n.blockedOn===null);)Lc(n),n.blockedOn===null&&Nt.shift()}var In=Mt.ReactCurrentBatchConfig,Ci=!0;function yf(t,e,n,c){var m=pe,y=In.transition;In.transition=null;try{pe=1,Ha(t,e,n,c)}finally{pe=m,In.transition=y}}function xf(t,e,n,c){var m=pe,y=In.transition;In.transition=null;try{pe=4,Ha(t,e,n,c)}finally{pe=m,In.transition=y}}function Ha(t,e,n,c){if(Ci){var m=ea(t,e,n,c);if(m===null)ws(t,e,c,_i,n),Bo(t,c);else if(mf(m,t,e,n,c))c.stopPropagation();else if(Bo(t,c),e&4&&-1<pf.indexOf(t)){for(;m!==null;){var y=Br(m);if(y!==null&&Dc(y),y=ea(t,e,n,c),y===null&&ws(t,e,c,_i,n),y===m)break;m=y}m!==null&&c.stopPropagation()}else ws(t,e,c,null,n)}}var _i=null;function ea(t,e,n,c){if(_i=null,t=za(c),t=sn(t),t!==null)if(e=mn(t),e===null)t=null;else if(n=e.tag,n===13){if(t=_c(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return _i=t,null}function Fc(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(af()){case Ba:return 1;case Oc:return 4;case wi:case of:return 16;case Pc:return 536870912;default:return 16}default:return 16}}var zt=null,Xa=null,li=null;function Nc(){if(li)return li;var t,e=Xa,n=e.length,c,m="value"in zt?zt.value:zt.textContent,y=m.length;for(t=0;t<n&&e[t]===m[t];t++);var w=n-t;for(c=1;c<=w&&e[n-c]===m[y-c];c++);return li=m.slice(t,1<c?1-c:void 0)}function ci(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Kr(){return!0}function Wo(){return!1}function rt(t){function e(n,c,m,y,w){this._reactName=n,this._targetInst=m,this.type=c,this.nativeEvent=y,this.target=w,this.currentTarget=null;for(var h in t)t.hasOwnProperty(h)&&(n=t[h],this[h]=n?n(y):y[h]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Kr:Wo,this.isPropagationStopped=Wo,this}return be(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Kr)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Kr)},persist:function(){},isPersistent:Kr}),e}var Gn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ya=rt(Gn),zr=be({},Gn,{view:0,detail:0}),wf=rt(zr),hs,fs,tr,Hi=be({},zr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Va,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==tr&&(tr&&t.type==="mousemove"?(hs=t.screenX-tr.screenX,fs=t.screenY-tr.screenY):fs=hs=0,tr=t),hs)},movementY:function(t){return"movementY"in t?t.movementY:fs}}),Ho=rt(Hi),Sf=be({},Hi,{dataTransfer:0}),Cf=rt(Sf),_f=be({},zr,{relatedTarget:0}),ds=rt(_f),bf=be({},Gn,{animationName:0,elapsedTime:0,pseudoElement:0}),Tf=rt(bf),kf=be({},Gn,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Of=rt(kf),Pf=be({},Gn,{data:0}),Xo=rt(Pf),Ef={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},jf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Df={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mf(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Df[t])?!!e[t]:!1}function Va(){return Mf}var Af=be({},zr,{key:function(t){if(t.key){var e=Ef[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ci(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?jf[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Va,charCode:function(t){return t.type==="keypress"?ci(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ci(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),If=rt(Af),Lf=be({},Hi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yo=rt(Lf),Ff=be({},zr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Va}),Nf=rt(Ff),Rf=be({},Gn,{propertyName:0,elapsedTime:0,pseudoElement:0}),zf=rt(Rf),Bf=be({},Hi,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Uf=rt(Bf),Wf=[9,13,27,32],Ga=Pt&&"CompositionEvent"in window,hr=null;Pt&&"documentMode"in document&&(hr=document.documentMode);var Hf=Pt&&"TextEvent"in window&&!hr,Rc=Pt&&(!Ga||hr&&8<hr&&11>=hr),Vo=String.fromCharCode(32),Go=!1;function zc(t,e){switch(t){case"keyup":return Wf.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bc(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var wn=!1;function Xf(t,e){switch(t){case"compositionend":return Bc(e);case"keypress":return e.which!==32?null:(Go=!0,Vo);case"textInput":return t=e.data,t===Vo&&Go?null:t;default:return null}}function Yf(t,e){if(wn)return t==="compositionend"||!Ga&&zc(t,e)?(t=Nc(),li=Xa=zt=null,wn=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Rc&&e.locale!=="ko"?null:e.data;default:return null}}var Vf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $o(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Vf[t.type]:e==="textarea"}function Uc(t,e,n,c){yc(c),e=bi(e,"onChange"),0<e.length&&(n=new Ya("onChange","change",null,n,c),t.push({event:n,listeners:e}))}var fr=null,Tr=null;function Gf(t){Jc(t,0)}function Xi(t){var e=_n(t);if(hc(e))return t}function $f(t,e){if(t==="change")return e}var Wc=!1;if(Pt){var gs;if(Pt){var ps="oninput"in document;if(!ps){var Ko=document.createElement("div");Ko.setAttribute("oninput","return;"),ps=typeof Ko.oninput=="function"}gs=ps}else gs=!1;Wc=gs&&(!document.documentMode||9<document.documentMode)}function qo(){fr&&(fr.detachEvent("onpropertychange",Hc),Tr=fr=null)}function Hc(t){if(t.propertyName==="value"&&Xi(Tr)){var e=[];Uc(e,Tr,t,za(t)),Cc(Gf,e)}}function Kf(t,e,n){t==="focusin"?(qo(),fr=e,Tr=n,fr.attachEvent("onpropertychange",Hc)):t==="focusout"&&qo()}function qf(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Xi(Tr)}function Qf(t,e){if(t==="click")return Xi(e)}function Jf(t,e){if(t==="input"||t==="change")return Xi(e)}function Zf(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var mt=typeof Object.is=="function"?Object.is:Zf;function kr(t,e){if(mt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),c=Object.keys(e);if(n.length!==c.length)return!1;for(c=0;c<n.length;c++){var m=n[c];if(!Fs.call(e,m)||!mt(t[m],e[m]))return!1}return!0}function Qo(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Jo(t,e){var n=Qo(t);t=0;for(var c;n;){if(n.nodeType===3){if(c=t+n.textContent.length,t<=e&&c>=e)return{node:n,offset:e-t};t=c}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Qo(n)}}function Xc(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Xc(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Yc(){for(var t=window,e=vi();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=vi(t.document)}return e}function $a(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ed(t){var e=Yc(),n=t.focusedElem,c=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Xc(n.ownerDocument.documentElement,n)){if(c!==null&&$a(n)){if(e=c.start,t=c.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var m=n.textContent.length,y=Math.min(c.start,m);c=c.end===void 0?y:Math.min(c.end,m),!t.extend&&y>c&&(m=c,c=y,y=m),m=Jo(n,y);var w=Jo(n,c);m&&w&&(t.rangeCount!==1||t.anchorNode!==m.node||t.anchorOffset!==m.offset||t.focusNode!==w.node||t.focusOffset!==w.offset)&&(e=e.createRange(),e.setStart(m.node,m.offset),t.removeAllRanges(),y>c?(t.addRange(e),t.extend(w.node,w.offset)):(e.setEnd(w.node,w.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var td=Pt&&"documentMode"in document&&11>=document.documentMode,Sn=null,ta=null,dr=null,na=!1;function Zo(t,e,n){var c=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;na||Sn==null||Sn!==vi(c)||(c=Sn,"selectionStart"in c&&$a(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),dr&&kr(dr,c)||(dr=c,c=bi(ta,"onSelect"),0<c.length&&(e=new Ya("onSelect","select",null,e,n),t.push({event:e,listeners:c}),e.target=Sn)))}function qr(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Cn={animationend:qr("Animation","AnimationEnd"),animationiteration:qr("Animation","AnimationIteration"),animationstart:qr("Animation","AnimationStart"),transitionend:qr("Transition","TransitionEnd")},ms={},Vc={};Pt&&(Vc=document.createElement("div").style,"AnimationEvent"in window||(delete Cn.animationend.animation,delete Cn.animationiteration.animation,delete Cn.animationstart.animation),"TransitionEvent"in window||delete Cn.transitionend.transition);function Yi(t){if(ms[t])return ms[t];if(!Cn[t])return t;var e=Cn[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Vc)return ms[t]=e[n];return t}var Gc=Yi("animationend"),$c=Yi("animationiteration"),Kc=Yi("animationstart"),qc=Yi("transitionend"),Qc=new Map,el="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Qt(t,e){Qc.set(t,e),pn(e,[t])}for(var vs=0;vs<el.length;vs++){var ys=el[vs],nd=ys.toLowerCase(),rd=ys[0].toUpperCase()+ys.slice(1);Qt(nd,"on"+rd)}Qt(Gc,"onAnimationEnd");Qt($c,"onAnimationIteration");Qt(Kc,"onAnimationStart");Qt("dblclick","onDoubleClick");Qt("focusin","onFocus");Qt("focusout","onBlur");Qt(qc,"onTransitionEnd");Rn("onMouseEnter",["mouseout","mouseover"]);Rn("onMouseLeave",["mouseout","mouseover"]);Rn("onPointerEnter",["pointerout","pointerover"]);Rn("onPointerLeave",["pointerout","pointerover"]);pn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));pn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));pn("onBeforeInput",["compositionend","keypress","textInput","paste"]);pn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));pn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));pn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),id=new Set("cancel close invalid load scroll toggle".split(" ").concat(lr));function tl(t,e,n){var c=t.type||"unknown-event";t.currentTarget=n,tf(c,e,void 0,t),t.currentTarget=null}function Jc(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var c=t[n],m=c.event;c=c.listeners;e:{var y=void 0;if(e)for(var w=c.length-1;0<=w;w--){var h=c[w],s=h.instance,u=h.currentTarget;if(h=h.listener,s!==y&&m.isPropagationStopped())break e;tl(m,h,u),y=s}else for(w=0;w<c.length;w++){if(h=c[w],s=h.instance,u=h.currentTarget,h=h.listener,s!==y&&m.isPropagationStopped())break e;tl(m,h,u),y=s}}}if(xi)throw t=Qs,xi=!1,Qs=null,t}function ye(t,e){var n=e[oa];n===void 0&&(n=e[oa]=new Set);var c=t+"__bubble";n.has(c)||(Zc(e,t,2,!1),n.add(c))}function xs(t,e,n){var c=0;e&&(c|=4),Zc(n,t,c,e)}var Qr="_reactListening"+Math.random().toString(36).slice(2);function Or(t){if(!t[Qr]){t[Qr]=!0,ac.forEach(function(n){n!=="selectionchange"&&(id.has(n)||xs(n,!1,t),xs(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Qr]||(e[Qr]=!0,xs("selectionchange",!1,e))}}function Zc(t,e,n,c){switch(Fc(e)){case 1:var m=yf;break;case 4:m=xf;break;default:m=Ha}n=m.bind(null,e,n,t),m=void 0,!qs||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(m=!0),c?m!==void 0?t.addEventListener(e,n,{capture:!0,passive:m}):t.addEventListener(e,n,!0):m!==void 0?t.addEventListener(e,n,{passive:m}):t.addEventListener(e,n,!1)}function ws(t,e,n,c,m){var y=c;if(!(e&1)&&!(e&2)&&c!==null)e:for(;;){if(c===null)return;var w=c.tag;if(w===3||w===4){var h=c.stateNode.containerInfo;if(h===m||h.nodeType===8&&h.parentNode===m)break;if(w===4)for(w=c.return;w!==null;){var s=w.tag;if((s===3||s===4)&&(s=w.stateNode.containerInfo,s===m||s.nodeType===8&&s.parentNode===m))return;w=w.return}for(;h!==null;){if(w=sn(h),w===null)return;if(s=w.tag,s===5||s===6){c=y=w;continue e}h=h.parentNode}}c=c.return}Cc(function(){var u=y,f=za(n),r=[];e:{var a=Qc.get(t);if(a!==void 0){var i=Ya,l=t;switch(t){case"keypress":if(ci(n)===0)break e;case"keydown":case"keyup":i=If;break;case"focusin":l="focus",i=ds;break;case"focusout":l="blur",i=ds;break;case"beforeblur":case"afterblur":i=ds;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":i=Ho;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":i=Cf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":i=Nf;break;case Gc:case $c:case Kc:i=Tf;break;case qc:i=zf;break;case"scroll":i=wf;break;case"wheel":i=Uf;break;case"copy":case"cut":case"paste":i=Of;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":i=Yo}var d=(e&4)!==0,o=!d&&t==="scroll",g=d?a!==null?a+"Capture":null:a;d=[];for(var p=u,v;p!==null;){v=p;var x=v.stateNode;if(v.tag===5&&x!==null&&(v=x,g!==null&&(x=Sr(p,g),x!=null&&d.push(Pr(p,x,v)))),o)break;p=p.return}0<d.length&&(a=new i(a,l,null,n,f),r.push({event:a,listeners:d}))}}if(!(e&7)){e:{if(a=t==="mouseover"||t==="pointerover",i=t==="mouseout"||t==="pointerout",a&&n!==$s&&(l=n.relatedTarget||n.fromElement)&&(sn(l)||l[Et]))break e;if((i||a)&&(a=f.window===f?f:(a=f.ownerDocument)?a.defaultView||a.parentWindow:window,i?(l=n.relatedTarget||n.toElement,i=u,l=l?sn(l):null,l!==null&&(o=mn(l),l!==o||l.tag!==5&&l.tag!==6)&&(l=null)):(i=null,l=u),i!==l)){if(d=Ho,x="onMouseLeave",g="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(d=Yo,x="onPointerLeave",g="onPointerEnter",p="pointer"),o=i==null?a:_n(i),v=l==null?a:_n(l),a=new d(x,p+"leave",i,n,f),a.target=o,a.relatedTarget=v,x=null,sn(f)===u&&(d=new d(g,p+"enter",l,n,f),d.target=v,d.relatedTarget=o,x=d),o=x,i&&l)t:{for(d=i,g=l,p=0,v=d;v;v=vn(v))p++;for(v=0,x=g;x;x=vn(x))v++;for(;0<p-v;)d=vn(d),p--;for(;0<v-p;)g=vn(g),v--;for(;p--;){if(d===g||g!==null&&d===g.alternate)break t;d=vn(d),g=vn(g)}d=null}else d=null;i!==null&&nl(r,a,i,d,!1),l!==null&&o!==null&&nl(r,o,l,d,!0)}}e:{if(a=u?_n(u):window,i=a.nodeName&&a.nodeName.toLowerCase(),i==="select"||i==="input"&&a.type==="file")var S=$f;else if($o(a))if(Wc)S=Jf;else{S=qf;var C=Kf}else(i=a.nodeName)&&i.toLowerCase()==="input"&&(a.type==="checkbox"||a.type==="radio")&&(S=Qf);if(S&&(S=S(t,u))){Uc(r,S,n,f);break e}C&&C(t,a,u),t==="focusout"&&(C=a._wrapperState)&&C.controlled&&a.type==="number"&&Hs(a,"number",a.value)}switch(C=u?_n(u):window,t){case"focusin":($o(C)||C.contentEditable==="true")&&(Sn=C,ta=u,dr=null);break;case"focusout":dr=ta=Sn=null;break;case"mousedown":na=!0;break;case"contextmenu":case"mouseup":case"dragend":na=!1,Zo(r,n,f);break;case"selectionchange":if(td)break;case"keydown":case"keyup":Zo(r,n,f)}var T;if(Ga)e:{switch(t){case"compositionstart":var O="onCompositionStart";break e;case"compositionend":O="onCompositionEnd";break e;case"compositionupdate":O="onCompositionUpdate";break e}O=void 0}else wn?zc(t,n)&&(O="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(O="onCompositionStart");O&&(Rc&&n.locale!=="ko"&&(wn||O!=="onCompositionStart"?O==="onCompositionEnd"&&wn&&(T=Nc()):(zt=f,Xa="value"in zt?zt.value:zt.textContent,wn=!0)),C=bi(u,O),0<C.length&&(O=new Xo(O,t,null,n,f),r.push({event:O,listeners:C}),T?O.data=T:(T=Bc(n),T!==null&&(O.data=T)))),(T=Hf?Xf(t,n):Yf(t,n))&&(u=bi(u,"onBeforeInput"),0<u.length&&(f=new Xo("onBeforeInput","beforeinput",null,n,f),r.push({event:f,listeners:u}),f.data=T))}Jc(r,e)})}function Pr(t,e,n){return{instance:t,listener:e,currentTarget:n}}function bi(t,e){for(var n=e+"Capture",c=[];t!==null;){var m=t,y=m.stateNode;m.tag===5&&y!==null&&(m=y,y=Sr(t,n),y!=null&&c.unshift(Pr(t,y,m)),y=Sr(t,e),y!=null&&c.push(Pr(t,y,m))),t=t.return}return c}function vn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function nl(t,e,n,c,m){for(var y=e._reactName,w=[];n!==null&&n!==c;){var h=n,s=h.alternate,u=h.stateNode;if(s!==null&&s===c)break;h.tag===5&&u!==null&&(h=u,m?(s=Sr(n,y),s!=null&&w.unshift(Pr(n,s,h))):m||(s=Sr(n,y),s!=null&&w.push(Pr(n,s,h)))),n=n.return}w.length!==0&&t.push({event:e,listeners:w})}var sd=/\r\n?/g,ad=/\u0000|\uFFFD/g;function rl(t){return(typeof t=="string"?t:""+t).replace(sd,`
`).replace(ad,"")}function Jr(t,e,n){if(e=rl(e),rl(t)!==e&&n)throw Error(ee(425))}function Ti(){}var ra=null,ia=null;function sa(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var aa=typeof setTimeout=="function"?setTimeout:void 0,od=typeof clearTimeout=="function"?clearTimeout:void 0,il=typeof Promise=="function"?Promise:void 0,ld=typeof queueMicrotask=="function"?queueMicrotask:typeof il<"u"?function(t){return il.resolve(null).then(t).catch(cd)}:aa;function cd(t){setTimeout(function(){throw t})}function Ss(t,e){var n=e,c=0;do{var m=n.nextSibling;if(t.removeChild(n),m&&m.nodeType===8)if(n=m.data,n==="/$"){if(c===0){t.removeChild(m),br(e);return}c--}else n!=="$"&&n!=="$?"&&n!=="$!"||c++;n=m}while(n);br(e)}function Xt(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function sl(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var $n=Math.random().toString(36).slice(2),wt="__reactFiber$"+$n,Er="__reactProps$"+$n,Et="__reactContainer$"+$n,oa="__reactEvents$"+$n,ud="__reactListeners$"+$n,hd="__reactHandles$"+$n;function sn(t){var e=t[wt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Et]||n[wt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=sl(t);t!==null;){if(n=t[wt])return n;t=sl(t)}return e}t=n,n=t.parentNode}return null}function Br(t){return t=t[wt]||t[Et],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function _n(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ee(33))}function Vi(t){return t[Er]||null}var la=[],bn=-1;function Jt(t){return{current:t}}function xe(t){0>bn||(t.current=la[bn],la[bn]=null,bn--)}function ve(t,e){bn++,la[bn]=t.current,t.current=e}var qt={},ze=Jt(qt),Ke=Jt(!1),un=qt;function zn(t,e){var n=t.type.contextTypes;if(!n)return qt;var c=t.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===e)return c.__reactInternalMemoizedMaskedChildContext;var m={},y;for(y in n)m[y]=e[y];return c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=m),m}function qe(t){return t=t.childContextTypes,t!=null}function ki(){xe(Ke),xe(ze)}function al(t,e,n){if(ze.current!==qt)throw Error(ee(168));ve(ze,e),ve(Ke,n)}function eu(t,e,n){var c=t.stateNode;if(e=e.childContextTypes,typeof c.getChildContext!="function")return n;c=c.getChildContext();for(var m in c)if(!(m in e))throw Error(ee(108,$h(t)||"Unknown",m));return be({},n,c)}function Oi(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||qt,un=ze.current,ve(ze,t),ve(Ke,Ke.current),!0}function ol(t,e,n){var c=t.stateNode;if(!c)throw Error(ee(169));n?(t=eu(t,e,un),c.__reactInternalMemoizedMergedChildContext=t,xe(Ke),xe(ze),ve(ze,t)):xe(Ke),ve(Ke,n)}var bt=null,Gi=!1,Cs=!1;function tu(t){bt===null?bt=[t]:bt.push(t)}function fd(t){Gi=!0,tu(t)}function Zt(){if(!Cs&&bt!==null){Cs=!0;var t=0,e=pe;try{var n=bt;for(pe=1;t<n.length;t++){var c=n[t];do c=c(!0);while(c!==null)}bt=null,Gi=!1}catch(m){throw bt!==null&&(bt=bt.slice(t+1)),kc(Ba,Zt),m}finally{pe=e,Cs=!1}}return null}var Tn=[],kn=0,Pi=null,Ei=0,it=[],st=0,hn=null,Tt=1,kt="";function nn(t,e){Tn[kn++]=Ei,Tn[kn++]=Pi,Pi=t,Ei=e}function nu(t,e,n){it[st++]=Tt,it[st++]=kt,it[st++]=hn,hn=t;var c=Tt;t=kt;var m=32-gt(c)-1;c&=~(1<<m),n+=1;var y=32-gt(e)+m;if(30<y){var w=m-m%5;y=(c&(1<<w)-1).toString(32),c>>=w,m-=w,Tt=1<<32-gt(e)+m|n<<m|c,kt=y+t}else Tt=1<<y|n<<m|c,kt=t}function Ka(t){t.return!==null&&(nn(t,1),nu(t,1,0))}function qa(t){for(;t===Pi;)Pi=Tn[--kn],Tn[kn]=null,Ei=Tn[--kn],Tn[kn]=null;for(;t===hn;)hn=it[--st],it[st]=null,kt=it[--st],it[st]=null,Tt=it[--st],it[st]=null}var et=null,Ze=null,Se=!1,dt=null;function ru(t,e){var n=at(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function ll(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,et=t,Ze=Xt(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,et=t,Ze=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=hn!==null?{id:Tt,overflow:kt}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=at(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,et=t,Ze=null,!0):!1;default:return!1}}function ca(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ua(t){if(Se){var e=Ze;if(e){var n=e;if(!ll(t,e)){if(ca(t))throw Error(ee(418));e=Xt(n.nextSibling);var c=et;e&&ll(t,e)?ru(c,n):(t.flags=t.flags&-4097|2,Se=!1,et=t)}}else{if(ca(t))throw Error(ee(418));t.flags=t.flags&-4097|2,Se=!1,et=t}}}function cl(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;et=t}function Zr(t){if(t!==et)return!1;if(!Se)return cl(t),Se=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!sa(t.type,t.memoizedProps)),e&&(e=Ze)){if(ca(t))throw iu(),Error(ee(418));for(;e;)ru(t,e),e=Xt(e.nextSibling)}if(cl(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ee(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ze=Xt(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ze=null}}else Ze=et?Xt(t.stateNode.nextSibling):null;return!0}function iu(){for(var t=Ze;t;)t=Xt(t.nextSibling)}function Bn(){Ze=et=null,Se=!1}function Qa(t){dt===null?dt=[t]:dt.push(t)}var dd=Mt.ReactCurrentBatchConfig;function nr(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ee(309));var c=n.stateNode}if(!c)throw Error(ee(147,t));var m=c,y=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===y?e.ref:(e=function(w){var h=m.refs;w===null?delete h[y]:h[y]=w},e._stringRef=y,e)}if(typeof t!="string")throw Error(ee(284));if(!n._owner)throw Error(ee(290,t))}return t}function ei(t,e){throw t=Object.prototype.toString.call(e),Error(ee(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ul(t){var e=t._init;return e(t._payload)}function su(t){function e(g,p){if(t){var v=g.deletions;v===null?(g.deletions=[p],g.flags|=16):v.push(p)}}function n(g,p){if(!t)return null;for(;p!==null;)e(g,p),p=p.sibling;return null}function c(g,p){for(g=new Map;p!==null;)p.key!==null?g.set(p.key,p):g.set(p.index,p),p=p.sibling;return g}function m(g,p){return g=$t(g,p),g.index=0,g.sibling=null,g}function y(g,p,v){return g.index=v,t?(v=g.alternate,v!==null?(v=v.index,v<p?(g.flags|=2,p):v):(g.flags|=2,p)):(g.flags|=1048576,p)}function w(g){return t&&g.alternate===null&&(g.flags|=2),g}function h(g,p,v,x){return p===null||p.tag!==6?(p=Es(v,g.mode,x),p.return=g,p):(p=m(p,v),p.return=g,p)}function s(g,p,v,x){var S=v.type;return S===xn?f(g,p,v.props.children,x,v.key):p!==null&&(p.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Lt&&ul(S)===p.type)?(x=m(p,v.props),x.ref=nr(g,p,v),x.return=g,x):(x=mi(v.type,v.key,v.props,null,g.mode,x),x.ref=nr(g,p,v),x.return=g,x)}function u(g,p,v,x){return p===null||p.tag!==4||p.stateNode.containerInfo!==v.containerInfo||p.stateNode.implementation!==v.implementation?(p=js(v,g.mode,x),p.return=g,p):(p=m(p,v.children||[]),p.return=g,p)}function f(g,p,v,x,S){return p===null||p.tag!==7?(p=cn(v,g.mode,x,S),p.return=g,p):(p=m(p,v),p.return=g,p)}function r(g,p,v){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Es(""+p,g.mode,v),p.return=g,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Hr:return v=mi(p.type,p.key,p.props,null,g.mode,v),v.ref=nr(g,null,p),v.return=g,v;case yn:return p=js(p,g.mode,v),p.return=g,p;case Lt:var x=p._init;return r(g,x(p._payload),v)}if(ar(p)||Qn(p))return p=cn(p,g.mode,v,null),p.return=g,p;ei(g,p)}return null}function a(g,p,v,x){var S=p!==null?p.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return S!==null?null:h(g,p,""+v,x);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Hr:return v.key===S?s(g,p,v,x):null;case yn:return v.key===S?u(g,p,v,x):null;case Lt:return S=v._init,a(g,p,S(v._payload),x)}if(ar(v)||Qn(v))return S!==null?null:f(g,p,v,x,null);ei(g,v)}return null}function i(g,p,v,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(v)||null,h(p,g,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case Hr:return g=g.get(x.key===null?v:x.key)||null,s(p,g,x,S);case yn:return g=g.get(x.key===null?v:x.key)||null,u(p,g,x,S);case Lt:var C=x._init;return i(g,p,v,C(x._payload),S)}if(ar(x)||Qn(x))return g=g.get(v)||null,f(p,g,x,S,null);ei(p,x)}return null}function l(g,p,v,x){for(var S=null,C=null,T=p,O=p=0,N=null;T!==null&&O<v.length;O++){T.index>O?(N=T,T=null):N=T.sibling;var U=a(g,T,v[O],x);if(U===null){T===null&&(T=N);break}t&&T&&U.alternate===null&&e(g,T),p=y(U,p,O),C===null?S=U:C.sibling=U,C=U,T=N}if(O===v.length)return n(g,T),Se&&nn(g,O),S;if(T===null){for(;O<v.length;O++)T=r(g,v[O],x),T!==null&&(p=y(T,p,O),C===null?S=T:C.sibling=T,C=T);return Se&&nn(g,O),S}for(T=c(g,T);O<v.length;O++)N=i(T,g,O,v[O],x),N!==null&&(t&&N.alternate!==null&&T.delete(N.key===null?O:N.key),p=y(N,p,O),C===null?S=N:C.sibling=N,C=N);return t&&T.forEach(function(J){return e(g,J)}),Se&&nn(g,O),S}function d(g,p,v,x){var S=Qn(v);if(typeof S!="function")throw Error(ee(150));if(v=S.call(v),v==null)throw Error(ee(151));for(var C=S=null,T=p,O=p=0,N=null,U=v.next();T!==null&&!U.done;O++,U=v.next()){T.index>O?(N=T,T=null):N=T.sibling;var J=a(g,T,U.value,x);if(J===null){T===null&&(T=N);break}t&&T&&J.alternate===null&&e(g,T),p=y(J,p,O),C===null?S=J:C.sibling=J,C=J,T=N}if(U.done)return n(g,T),Se&&nn(g,O),S;if(T===null){for(;!U.done;O++,U=v.next())U=r(g,U.value,x),U!==null&&(p=y(U,p,O),C===null?S=U:C.sibling=U,C=U);return Se&&nn(g,O),S}for(T=c(g,T);!U.done;O++,U=v.next())U=i(T,g,O,U.value,x),U!==null&&(t&&U.alternate!==null&&T.delete(U.key===null?O:U.key),p=y(U,p,O),C===null?S=U:C.sibling=U,C=U);return t&&T.forEach(function(te){return e(g,te)}),Se&&nn(g,O),S}function o(g,p,v,x){if(typeof v=="object"&&v!==null&&v.type===xn&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case Hr:e:{for(var S=v.key,C=p;C!==null;){if(C.key===S){if(S=v.type,S===xn){if(C.tag===7){n(g,C.sibling),p=m(C,v.props.children),p.return=g,g=p;break e}}else if(C.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Lt&&ul(S)===C.type){n(g,C.sibling),p=m(C,v.props),p.ref=nr(g,C,v),p.return=g,g=p;break e}n(g,C);break}else e(g,C);C=C.sibling}v.type===xn?(p=cn(v.props.children,g.mode,x,v.key),p.return=g,g=p):(x=mi(v.type,v.key,v.props,null,g.mode,x),x.ref=nr(g,p,v),x.return=g,g=x)}return w(g);case yn:e:{for(C=v.key;p!==null;){if(p.key===C)if(p.tag===4&&p.stateNode.containerInfo===v.containerInfo&&p.stateNode.implementation===v.implementation){n(g,p.sibling),p=m(p,v.children||[]),p.return=g,g=p;break e}else{n(g,p);break}else e(g,p);p=p.sibling}p=js(v,g.mode,x),p.return=g,g=p}return w(g);case Lt:return C=v._init,o(g,p,C(v._payload),x)}if(ar(v))return l(g,p,v,x);if(Qn(v))return d(g,p,v,x);ei(g,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,p!==null&&p.tag===6?(n(g,p.sibling),p=m(p,v),p.return=g,g=p):(n(g,p),p=Es(v,g.mode,x),p.return=g,g=p),w(g)):n(g,p)}return o}var Un=su(!0),au=su(!1),ji=Jt(null),Di=null,On=null,Ja=null;function Za(){Ja=On=Di=null}function eo(t){var e=ji.current;xe(ji),t._currentValue=e}function ha(t,e,n){for(;t!==null;){var c=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,c!==null&&(c.childLanes|=e)):c!==null&&(c.childLanes&e)!==e&&(c.childLanes|=e),t===n)break;t=t.return}}function Ln(t,e){Di=t,Ja=On=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&($e=!0),t.firstContext=null)}function lt(t){var e=t._currentValue;if(Ja!==t)if(t={context:t,memoizedValue:e,next:null},On===null){if(Di===null)throw Error(ee(308));On=t,Di.dependencies={lanes:0,firstContext:t}}else On=On.next=t;return e}var an=null;function to(t){an===null?an=[t]:an.push(t)}function ou(t,e,n,c){var m=e.interleaved;return m===null?(n.next=n,to(e)):(n.next=m.next,m.next=n),e.interleaved=n,jt(t,c)}function jt(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ft=!1;function no(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lu(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ot(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yt(t,e,n){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,de&2){var m=c.pending;return m===null?e.next=e:(e.next=m.next,m.next=e),c.pending=e,jt(t,n)}return m=c.interleaved,m===null?(e.next=e,to(c)):(e.next=m.next,m.next=e),c.interleaved=e,jt(t,n)}function ui(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,Ua(t,n)}}function hl(t,e){var n=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,n===c)){var m=null,y=null;if(n=n.firstBaseUpdate,n!==null){do{var w={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};y===null?m=y=w:y=y.next=w,n=n.next}while(n!==null);y===null?m=y=e:y=y.next=e}else m=y=e;n={baseState:c.baseState,firstBaseUpdate:m,lastBaseUpdate:y,shared:c.shared,effects:c.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Mi(t,e,n,c){var m=t.updateQueue;Ft=!1;var y=m.firstBaseUpdate,w=m.lastBaseUpdate,h=m.shared.pending;if(h!==null){m.shared.pending=null;var s=h,u=s.next;s.next=null,w===null?y=u:w.next=u,w=s;var f=t.alternate;f!==null&&(f=f.updateQueue,h=f.lastBaseUpdate,h!==w&&(h===null?f.firstBaseUpdate=u:h.next=u,f.lastBaseUpdate=s))}if(y!==null){var r=m.baseState;w=0,f=u=s=null,h=y;do{var a=h.lane,i=h.eventTime;if((c&a)===a){f!==null&&(f=f.next={eventTime:i,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var l=t,d=h;switch(a=e,i=n,d.tag){case 1:if(l=d.payload,typeof l=="function"){r=l.call(i,r,a);break e}r=l;break e;case 3:l.flags=l.flags&-65537|128;case 0:if(l=d.payload,a=typeof l=="function"?l.call(i,r,a):l,a==null)break e;r=be({},r,a);break e;case 2:Ft=!0}}h.callback!==null&&h.lane!==0&&(t.flags|=64,a=m.effects,a===null?m.effects=[h]:a.push(h))}else i={eventTime:i,lane:a,tag:h.tag,payload:h.payload,callback:h.callback,next:null},f===null?(u=f=i,s=r):f=f.next=i,w|=a;if(h=h.next,h===null){if(h=m.shared.pending,h===null)break;a=h,h=a.next,a.next=null,m.lastBaseUpdate=a,m.shared.pending=null}}while(1);if(f===null&&(s=r),m.baseState=s,m.firstBaseUpdate=u,m.lastBaseUpdate=f,e=m.shared.interleaved,e!==null){m=e;do w|=m.lane,m=m.next;while(m!==e)}else y===null&&(m.shared.lanes=0);dn|=w,t.lanes=w,t.memoizedState=r}}function fl(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var c=t[e],m=c.callback;if(m!==null){if(c.callback=null,c=n,typeof m!="function")throw Error(ee(191,m));m.call(c)}}}var Ur={},Ct=Jt(Ur),jr=Jt(Ur),Dr=Jt(Ur);function on(t){if(t===Ur)throw Error(ee(174));return t}function ro(t,e){switch(ve(Dr,e),ve(jr,t),ve(Ct,Ur),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ys(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ys(e,t)}xe(Ct),ve(Ct,e)}function Wn(){xe(Ct),xe(jr),xe(Dr)}function cu(t){on(Dr.current);var e=on(Ct.current),n=Ys(e,t.type);e!==n&&(ve(jr,t),ve(Ct,n))}function io(t){jr.current===t&&(xe(Ct),xe(jr))}var Ce=Jt(0);function Ai(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _s=[];function so(){for(var t=0;t<_s.length;t++)_s[t]._workInProgressVersionPrimary=null;_s.length=0}var hi=Mt.ReactCurrentDispatcher,bs=Mt.ReactCurrentBatchConfig,fn=0,_e=null,Ee=null,De=null,Ii=!1,gr=!1,Mr=0,gd=0;function Fe(){throw Error(ee(321))}function ao(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!mt(t[n],e[n]))return!1;return!0}function oo(t,e,n,c,m,y){if(fn=y,_e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hi.current=t===null||t.memoizedState===null?yd:xd,t=n(c,m),gr){y=0;do{if(gr=!1,Mr=0,25<=y)throw Error(ee(301));y+=1,De=Ee=null,e.updateQueue=null,hi.current=wd,t=n(c,m)}while(gr)}if(hi.current=Li,e=Ee!==null&&Ee.next!==null,fn=0,De=Ee=_e=null,Ii=!1,e)throw Error(ee(300));return t}function lo(){var t=Mr!==0;return Mr=0,t}function xt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return De===null?_e.memoizedState=De=t:De=De.next=t,De}function ct(){if(Ee===null){var t=_e.alternate;t=t!==null?t.memoizedState:null}else t=Ee.next;var e=De===null?_e.memoizedState:De.next;if(e!==null)De=e,Ee=t;else{if(t===null)throw Error(ee(310));Ee=t,t={memoizedState:Ee.memoizedState,baseState:Ee.baseState,baseQueue:Ee.baseQueue,queue:Ee.queue,next:null},De===null?_e.memoizedState=De=t:De=De.next=t}return De}function Ar(t,e){return typeof e=="function"?e(t):e}function Ts(t){var e=ct(),n=e.queue;if(n===null)throw Error(ee(311));n.lastRenderedReducer=t;var c=Ee,m=c.baseQueue,y=n.pending;if(y!==null){if(m!==null){var w=m.next;m.next=y.next,y.next=w}c.baseQueue=m=y,n.pending=null}if(m!==null){y=m.next,c=c.baseState;var h=w=null,s=null,u=y;do{var f=u.lane;if((fn&f)===f)s!==null&&(s=s.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),c=u.hasEagerState?u.eagerState:t(c,u.action);else{var r={lane:f,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};s===null?(h=s=r,w=c):s=s.next=r,_e.lanes|=f,dn|=f}u=u.next}while(u!==null&&u!==y);s===null?w=c:s.next=h,mt(c,e.memoizedState)||($e=!0),e.memoizedState=c,e.baseState=w,e.baseQueue=s,n.lastRenderedState=c}if(t=n.interleaved,t!==null){m=t;do y=m.lane,_e.lanes|=y,dn|=y,m=m.next;while(m!==t)}else m===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ks(t){var e=ct(),n=e.queue;if(n===null)throw Error(ee(311));n.lastRenderedReducer=t;var c=n.dispatch,m=n.pending,y=e.memoizedState;if(m!==null){n.pending=null;var w=m=m.next;do y=t(y,w.action),w=w.next;while(w!==m);mt(y,e.memoizedState)||($e=!0),e.memoizedState=y,e.baseQueue===null&&(e.baseState=y),n.lastRenderedState=y}return[y,c]}function uu(){}function hu(t,e){var n=_e,c=ct(),m=e(),y=!mt(c.memoizedState,m);if(y&&(c.memoizedState=m,$e=!0),c=c.queue,co(gu.bind(null,n,c,t),[t]),c.getSnapshot!==e||y||De!==null&&De.memoizedState.tag&1){if(n.flags|=2048,Ir(9,du.bind(null,n,c,m,e),void 0,null),Me===null)throw Error(ee(349));fn&30||fu(n,e,m)}return m}function fu(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function du(t,e,n,c){e.value=n,e.getSnapshot=c,pu(e)&&mu(t)}function gu(t,e,n){return n(function(){pu(e)&&mu(t)})}function pu(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!mt(t,n)}catch{return!0}}function mu(t){var e=jt(t,1);e!==null&&pt(e,t,1,-1)}function dl(t){var e=xt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ar,lastRenderedState:t},e.queue=t,t=t.dispatch=vd.bind(null,_e,t),[e.memoizedState,t]}function Ir(t,e,n,c){return t={tag:t,create:e,destroy:n,deps:c,next:null},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(c=n.next,n.next=t,t.next=c,e.lastEffect=t)),t}function vu(){return ct().memoizedState}function fi(t,e,n,c){var m=xt();_e.flags|=t,m.memoizedState=Ir(1|e,n,void 0,c===void 0?null:c)}function $i(t,e,n,c){var m=ct();c=c===void 0?null:c;var y=void 0;if(Ee!==null){var w=Ee.memoizedState;if(y=w.destroy,c!==null&&ao(c,w.deps)){m.memoizedState=Ir(e,n,y,c);return}}_e.flags|=t,m.memoizedState=Ir(1|e,n,y,c)}function gl(t,e){return fi(8390656,8,t,e)}function co(t,e){return $i(2048,8,t,e)}function yu(t,e){return $i(4,2,t,e)}function xu(t,e){return $i(4,4,t,e)}function wu(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Su(t,e,n){return n=n!=null?n.concat([t]):null,$i(4,4,wu.bind(null,e,t),n)}function uo(){}function Cu(t,e){var n=ct();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&ao(e,c[1])?c[0]:(n.memoizedState=[t,e],t)}function _u(t,e){var n=ct();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&ao(e,c[1])?c[0]:(t=t(),n.memoizedState=[t,e],t)}function bu(t,e,n){return fn&21?(mt(n,e)||(n=Ec(),_e.lanes|=n,dn|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,$e=!0),t.memoizedState=n)}function pd(t,e){var n=pe;pe=n!==0&&4>n?n:4,t(!0);var c=bs.transition;bs.transition={};try{t(!1),e()}finally{pe=n,bs.transition=c}}function Tu(){return ct().memoizedState}function md(t,e,n){var c=Gt(t);if(n={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null},ku(t))Ou(e,n);else if(n=ou(t,e,n,c),n!==null){var m=Xe();pt(n,t,c,m),Pu(n,e,c)}}function vd(t,e,n){var c=Gt(t),m={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null};if(ku(t))Ou(e,m);else{var y=t.alternate;if(t.lanes===0&&(y===null||y.lanes===0)&&(y=e.lastRenderedReducer,y!==null))try{var w=e.lastRenderedState,h=y(w,n);if(m.hasEagerState=!0,m.eagerState=h,mt(h,w)){var s=e.interleaved;s===null?(m.next=m,to(e)):(m.next=s.next,s.next=m),e.interleaved=m;return}}catch{}finally{}n=ou(t,e,m,c),n!==null&&(m=Xe(),pt(n,t,c,m),Pu(n,e,c))}}function ku(t){var e=t.alternate;return t===_e||e!==null&&e===_e}function Ou(t,e){gr=Ii=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Pu(t,e,n){if(n&4194240){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,Ua(t,n)}}var Li={readContext:lt,useCallback:Fe,useContext:Fe,useEffect:Fe,useImperativeHandle:Fe,useInsertionEffect:Fe,useLayoutEffect:Fe,useMemo:Fe,useReducer:Fe,useRef:Fe,useState:Fe,useDebugValue:Fe,useDeferredValue:Fe,useTransition:Fe,useMutableSource:Fe,useSyncExternalStore:Fe,useId:Fe,unstable_isNewReconciler:!1},yd={readContext:lt,useCallback:function(t,e){return xt().memoizedState=[t,e===void 0?null:e],t},useContext:lt,useEffect:gl,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,fi(4194308,4,wu.bind(null,e,t),n)},useLayoutEffect:function(t,e){return fi(4194308,4,t,e)},useInsertionEffect:function(t,e){return fi(4,2,t,e)},useMemo:function(t,e){var n=xt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var c=xt();return e=n!==void 0?n(e):e,c.memoizedState=c.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},c.queue=t,t=t.dispatch=md.bind(null,_e,t),[c.memoizedState,t]},useRef:function(t){var e=xt();return t={current:t},e.memoizedState=t},useState:dl,useDebugValue:uo,useDeferredValue:function(t){return xt().memoizedState=t},useTransition:function(){var t=dl(!1),e=t[0];return t=pd.bind(null,t[1]),xt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var c=_e,m=xt();if(Se){if(n===void 0)throw Error(ee(407));n=n()}else{if(n=e(),Me===null)throw Error(ee(349));fn&30||fu(c,e,n)}m.memoizedState=n;var y={value:n,getSnapshot:e};return m.queue=y,gl(gu.bind(null,c,y,t),[t]),c.flags|=2048,Ir(9,du.bind(null,c,y,n,e),void 0,null),n},useId:function(){var t=xt(),e=Me.identifierPrefix;if(Se){var n=kt,c=Tt;n=(c&~(1<<32-gt(c)-1)).toString(32)+n,e=":"+e+"R"+n,n=Mr++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=gd++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},xd={readContext:lt,useCallback:Cu,useContext:lt,useEffect:co,useImperativeHandle:Su,useInsertionEffect:yu,useLayoutEffect:xu,useMemo:_u,useReducer:Ts,useRef:vu,useState:function(){return Ts(Ar)},useDebugValue:uo,useDeferredValue:function(t){var e=ct();return bu(e,Ee.memoizedState,t)},useTransition:function(){var t=Ts(Ar)[0],e=ct().memoizedState;return[t,e]},useMutableSource:uu,useSyncExternalStore:hu,useId:Tu,unstable_isNewReconciler:!1},wd={readContext:lt,useCallback:Cu,useContext:lt,useEffect:co,useImperativeHandle:Su,useInsertionEffect:yu,useLayoutEffect:xu,useMemo:_u,useReducer:ks,useRef:vu,useState:function(){return ks(Ar)},useDebugValue:uo,useDeferredValue:function(t){var e=ct();return Ee===null?e.memoizedState=t:bu(e,Ee.memoizedState,t)},useTransition:function(){var t=ks(Ar)[0],e=ct().memoizedState;return[t,e]},useMutableSource:uu,useSyncExternalStore:hu,useId:Tu,unstable_isNewReconciler:!1};function ht(t,e){if(t&&t.defaultProps){e=be({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function fa(t,e,n,c){e=t.memoizedState,n=n(c,e),n=n==null?e:be({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Ki={isMounted:function(t){return(t=t._reactInternals)?mn(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var c=Xe(),m=Gt(t),y=Ot(c,m);y.payload=e,n!=null&&(y.callback=n),e=Yt(t,y,m),e!==null&&(pt(e,t,m,c),ui(e,t,m))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var c=Xe(),m=Gt(t),y=Ot(c,m);y.tag=1,y.payload=e,n!=null&&(y.callback=n),e=Yt(t,y,m),e!==null&&(pt(e,t,m,c),ui(e,t,m))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Xe(),c=Gt(t),m=Ot(n,c);m.tag=2,e!=null&&(m.callback=e),e=Yt(t,m,c),e!==null&&(pt(e,t,c,n),ui(e,t,c))}};function pl(t,e,n,c,m,y,w){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,y,w):e.prototype&&e.prototype.isPureReactComponent?!kr(n,c)||!kr(m,y):!0}function Eu(t,e,n){var c=!1,m=qt,y=e.contextType;return typeof y=="object"&&y!==null?y=lt(y):(m=qe(e)?un:ze.current,c=e.contextTypes,y=(c=c!=null)?zn(t,m):qt),e=new e(n,y),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ki,t.stateNode=e,e._reactInternals=t,c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=m,t.__reactInternalMemoizedMaskedChildContext=y),e}function ml(t,e,n,c){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,c),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,c),e.state!==t&&Ki.enqueueReplaceState(e,e.state,null)}function da(t,e,n,c){var m=t.stateNode;m.props=n,m.state=t.memoizedState,m.refs={},no(t);var y=e.contextType;typeof y=="object"&&y!==null?m.context=lt(y):(y=qe(e)?un:ze.current,m.context=zn(t,y)),m.state=t.memoizedState,y=e.getDerivedStateFromProps,typeof y=="function"&&(fa(t,e,y,n),m.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(e=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),e!==m.state&&Ki.enqueueReplaceState(m,m.state,null),Mi(t,n,m,c),m.state=t.memoizedState),typeof m.componentDidMount=="function"&&(t.flags|=4194308)}function Hn(t,e){try{var n="",c=e;do n+=Gh(c),c=c.return;while(c);var m=n}catch(y){m=`
Error generating stack: `+y.message+`
`+y.stack}return{value:t,source:e,stack:m,digest:null}}function Os(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function ga(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Sd=typeof WeakMap=="function"?WeakMap:Map;function ju(t,e,n){n=Ot(-1,n),n.tag=3,n.payload={element:null};var c=e.value;return n.callback=function(){Ni||(Ni=!0,ba=c),ga(t,e)},n}function Du(t,e,n){n=Ot(-1,n),n.tag=3;var c=t.type.getDerivedStateFromError;if(typeof c=="function"){var m=e.value;n.payload=function(){return c(m)},n.callback=function(){ga(t,e)}}var y=t.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(n.callback=function(){ga(t,e),typeof c!="function"&&(Vt===null?Vt=new Set([this]):Vt.add(this));var w=e.stack;this.componentDidCatch(e.value,{componentStack:w!==null?w:""})}),n}function vl(t,e,n){var c=t.pingCache;if(c===null){c=t.pingCache=new Sd;var m=new Set;c.set(e,m)}else m=c.get(e),m===void 0&&(m=new Set,c.set(e,m));m.has(n)||(m.add(n),t=Ld.bind(null,t,e,n),e.then(t,t))}function yl(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function xl(t,e,n,c,m){return t.mode&1?(t.flags|=65536,t.lanes=m,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ot(-1,1),e.tag=2,Yt(n,e,1))),n.lanes|=1),t)}var Cd=Mt.ReactCurrentOwner,$e=!1;function We(t,e,n,c){e.child=t===null?au(e,null,n,c):Un(e,t.child,n,c)}function wl(t,e,n,c,m){n=n.render;var y=e.ref;return Ln(e,m),c=oo(t,e,n,c,y,m),n=lo(),t!==null&&!$e?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~m,Dt(t,e,m)):(Se&&n&&Ka(e),e.flags|=1,We(t,e,c,m),e.child)}function Sl(t,e,n,c,m){if(t===null){var y=n.type;return typeof y=="function"&&!xo(y)&&y.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=y,Mu(t,e,y,c,m)):(t=mi(n.type,null,c,e,e.mode,m),t.ref=e.ref,t.return=e,e.child=t)}if(y=t.child,!(t.lanes&m)){var w=y.memoizedProps;if(n=n.compare,n=n!==null?n:kr,n(w,c)&&t.ref===e.ref)return Dt(t,e,m)}return e.flags|=1,t=$t(y,c),t.ref=e.ref,t.return=e,e.child=t}function Mu(t,e,n,c,m){if(t!==null){var y=t.memoizedProps;if(kr(y,c)&&t.ref===e.ref)if($e=!1,e.pendingProps=c=y,(t.lanes&m)!==0)t.flags&131072&&($e=!0);else return e.lanes=t.lanes,Dt(t,e,m)}return pa(t,e,n,c,m)}function Au(t,e,n){var c=e.pendingProps,m=c.children,y=t!==null?t.memoizedState:null;if(c.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ve(En,Je),Je|=n;else{if(!(n&1073741824))return t=y!==null?y.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ve(En,Je),Je|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=y!==null?y.baseLanes:n,ve(En,Je),Je|=c}else y!==null?(c=y.baseLanes|n,e.memoizedState=null):c=n,ve(En,Je),Je|=c;return We(t,e,m,n),e.child}function Iu(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function pa(t,e,n,c,m){var y=qe(n)?un:ze.current;return y=zn(e,y),Ln(e,m),n=oo(t,e,n,c,y,m),c=lo(),t!==null&&!$e?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~m,Dt(t,e,m)):(Se&&c&&Ka(e),e.flags|=1,We(t,e,n,m),e.child)}function Cl(t,e,n,c,m){if(qe(n)){var y=!0;Oi(e)}else y=!1;if(Ln(e,m),e.stateNode===null)di(t,e),Eu(e,n,c),da(e,n,c,m),c=!0;else if(t===null){var w=e.stateNode,h=e.memoizedProps;w.props=h;var s=w.context,u=n.contextType;typeof u=="object"&&u!==null?u=lt(u):(u=qe(n)?un:ze.current,u=zn(e,u));var f=n.getDerivedStateFromProps,r=typeof f=="function"||typeof w.getSnapshotBeforeUpdate=="function";r||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(h!==c||s!==u)&&ml(e,w,c,u),Ft=!1;var a=e.memoizedState;w.state=a,Mi(e,c,w,m),s=e.memoizedState,h!==c||a!==s||Ke.current||Ft?(typeof f=="function"&&(fa(e,n,f,c),s=e.memoizedState),(h=Ft||pl(e,n,h,c,a,s,u))?(r||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(e.flags|=4194308)):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=c,e.memoizedState=s),w.props=c,w.state=s,w.context=u,c=h):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),c=!1)}else{w=e.stateNode,lu(t,e),h=e.memoizedProps,u=e.type===e.elementType?h:ht(e.type,h),w.props=u,r=e.pendingProps,a=w.context,s=n.contextType,typeof s=="object"&&s!==null?s=lt(s):(s=qe(n)?un:ze.current,s=zn(e,s));var i=n.getDerivedStateFromProps;(f=typeof i=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(h!==r||a!==s)&&ml(e,w,c,s),Ft=!1,a=e.memoizedState,w.state=a,Mi(e,c,w,m);var l=e.memoizedState;h!==r||a!==l||Ke.current||Ft?(typeof i=="function"&&(fa(e,n,i,c),l=e.memoizedState),(u=Ft||pl(e,n,u,c,a,l,s)||!1)?(f||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(c,l,s),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(c,l,s)),typeof w.componentDidUpdate=="function"&&(e.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof w.componentDidUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=1024),e.memoizedProps=c,e.memoizedState=l),w.props=c,w.state=l,w.context=s,c=u):(typeof w.componentDidUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||h===t.memoizedProps&&a===t.memoizedState||(e.flags|=1024),c=!1)}return ma(t,e,n,c,y,m)}function ma(t,e,n,c,m,y){Iu(t,e);var w=(e.flags&128)!==0;if(!c&&!w)return m&&ol(e,n,!1),Dt(t,e,y);c=e.stateNode,Cd.current=e;var h=w&&typeof n.getDerivedStateFromError!="function"?null:c.render();return e.flags|=1,t!==null&&w?(e.child=Un(e,t.child,null,y),e.child=Un(e,null,h,y)):We(t,e,h,y),e.memoizedState=c.state,m&&ol(e,n,!0),e.child}function Lu(t){var e=t.stateNode;e.pendingContext?al(t,e.pendingContext,e.pendingContext!==e.context):e.context&&al(t,e.context,!1),ro(t,e.containerInfo)}function _l(t,e,n,c,m){return Bn(),Qa(m),e.flags|=256,We(t,e,n,c),e.child}var va={dehydrated:null,treeContext:null,retryLane:0};function ya(t){return{baseLanes:t,cachePool:null,transitions:null}}function Fu(t,e,n){var c=e.pendingProps,m=Ce.current,y=!1,w=(e.flags&128)!==0,h;if((h=w)||(h=t!==null&&t.memoizedState===null?!1:(m&2)!==0),h?(y=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(m|=1),ve(Ce,m&1),t===null)return ua(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(w=c.children,t=c.fallback,y?(c=e.mode,y=e.child,w={mode:"hidden",children:w},!(c&1)&&y!==null?(y.childLanes=0,y.pendingProps=w):y=Ji(w,c,0,null),t=cn(t,c,n,null),y.return=e,t.return=e,y.sibling=t,e.child=y,e.child.memoizedState=ya(n),e.memoizedState=va,t):ho(e,w));if(m=t.memoizedState,m!==null&&(h=m.dehydrated,h!==null))return _d(t,e,w,c,h,m,n);if(y){y=c.fallback,w=e.mode,m=t.child,h=m.sibling;var s={mode:"hidden",children:c.children};return!(w&1)&&e.child!==m?(c=e.child,c.childLanes=0,c.pendingProps=s,e.deletions=null):(c=$t(m,s),c.subtreeFlags=m.subtreeFlags&14680064),h!==null?y=$t(h,y):(y=cn(y,w,n,null),y.flags|=2),y.return=e,c.return=e,c.sibling=y,e.child=c,c=y,y=e.child,w=t.child.memoizedState,w=w===null?ya(n):{baseLanes:w.baseLanes|n,cachePool:null,transitions:w.transitions},y.memoizedState=w,y.childLanes=t.childLanes&~n,e.memoizedState=va,c}return y=t.child,t=y.sibling,c=$t(y,{mode:"visible",children:c.children}),!(e.mode&1)&&(c.lanes=n),c.return=e,c.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=c,e.memoizedState=null,c}function ho(t,e){return e=Ji({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ti(t,e,n,c){return c!==null&&Qa(c),Un(e,t.child,null,n),t=ho(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function _d(t,e,n,c,m,y,w){if(n)return e.flags&256?(e.flags&=-257,c=Os(Error(ee(422))),ti(t,e,w,c)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(y=c.fallback,m=e.mode,c=Ji({mode:"visible",children:c.children},m,0,null),y=cn(y,m,w,null),y.flags|=2,c.return=e,y.return=e,c.sibling=y,e.child=c,e.mode&1&&Un(e,t.child,null,w),e.child.memoizedState=ya(w),e.memoizedState=va,y);if(!(e.mode&1))return ti(t,e,w,null);if(m.data==="$!"){if(c=m.nextSibling&&m.nextSibling.dataset,c)var h=c.dgst;return c=h,y=Error(ee(419)),c=Os(y,c,void 0),ti(t,e,w,c)}if(h=(w&t.childLanes)!==0,$e||h){if(c=Me,c!==null){switch(w&-w){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(c.suspendedLanes|w)?0:m,m!==0&&m!==y.retryLane&&(y.retryLane=m,jt(t,m),pt(c,t,m,-1))}return yo(),c=Os(Error(ee(421))),ti(t,e,w,c)}return m.data==="$?"?(e.flags|=128,e.child=t.child,e=Fd.bind(null,t),m._reactRetry=e,null):(t=y.treeContext,Ze=Xt(m.nextSibling),et=e,Se=!0,dt=null,t!==null&&(it[st++]=Tt,it[st++]=kt,it[st++]=hn,Tt=t.id,kt=t.overflow,hn=e),e=ho(e,c.children),e.flags|=4096,e)}function bl(t,e,n){t.lanes|=e;var c=t.alternate;c!==null&&(c.lanes|=e),ha(t.return,e,n)}function Ps(t,e,n,c,m){var y=t.memoizedState;y===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:c,tail:n,tailMode:m}:(y.isBackwards=e,y.rendering=null,y.renderingStartTime=0,y.last=c,y.tail=n,y.tailMode=m)}function Nu(t,e,n){var c=e.pendingProps,m=c.revealOrder,y=c.tail;if(We(t,e,c.children,n),c=Ce.current,c&2)c=c&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&bl(t,n,e);else if(t.tag===19)bl(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}if(ve(Ce,c),!(e.mode&1))e.memoizedState=null;else switch(m){case"forwards":for(n=e.child,m=null;n!==null;)t=n.alternate,t!==null&&Ai(t)===null&&(m=n),n=n.sibling;n=m,n===null?(m=e.child,e.child=null):(m=n.sibling,n.sibling=null),Ps(e,!1,m,n,y);break;case"backwards":for(n=null,m=e.child,e.child=null;m!==null;){if(t=m.alternate,t!==null&&Ai(t)===null){e.child=m;break}t=m.sibling,m.sibling=n,n=m,m=t}Ps(e,!0,n,null,y);break;case"together":Ps(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function di(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Dt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),dn|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ee(153));if(e.child!==null){for(t=e.child,n=$t(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=$t(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function bd(t,e,n){switch(e.tag){case 3:Lu(e),Bn();break;case 5:cu(e);break;case 1:qe(e.type)&&Oi(e);break;case 4:ro(e,e.stateNode.containerInfo);break;case 10:var c=e.type._context,m=e.memoizedProps.value;ve(ji,c._currentValue),c._currentValue=m;break;case 13:if(c=e.memoizedState,c!==null)return c.dehydrated!==null?(ve(Ce,Ce.current&1),e.flags|=128,null):n&e.child.childLanes?Fu(t,e,n):(ve(Ce,Ce.current&1),t=Dt(t,e,n),t!==null?t.sibling:null);ve(Ce,Ce.current&1);break;case 19:if(c=(n&e.childLanes)!==0,t.flags&128){if(c)return Nu(t,e,n);e.flags|=128}if(m=e.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),ve(Ce,Ce.current),c)break;return null;case 22:case 23:return e.lanes=0,Au(t,e,n)}return Dt(t,e,n)}var Ru,xa,zu,Bu;Ru=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};xa=function(){};zu=function(t,e,n,c){var m=t.memoizedProps;if(m!==c){t=e.stateNode,on(Ct.current);var y=null;switch(n){case"input":m=Us(t,m),c=Us(t,c),y=[];break;case"select":m=be({},m,{value:void 0}),c=be({},c,{value:void 0}),y=[];break;case"textarea":m=Xs(t,m),c=Xs(t,c),y=[];break;default:typeof m.onClick!="function"&&typeof c.onClick=="function"&&(t.onclick=Ti)}Vs(n,c);var w;n=null;for(u in m)if(!c.hasOwnProperty(u)&&m.hasOwnProperty(u)&&m[u]!=null)if(u==="style"){var h=m[u];for(w in h)h.hasOwnProperty(w)&&(n||(n={}),n[w]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(xr.hasOwnProperty(u)?y||(y=[]):(y=y||[]).push(u,null));for(u in c){var s=c[u];if(h=m!=null?m[u]:void 0,c.hasOwnProperty(u)&&s!==h&&(s!=null||h!=null))if(u==="style")if(h){for(w in h)!h.hasOwnProperty(w)||s&&s.hasOwnProperty(w)||(n||(n={}),n[w]="");for(w in s)s.hasOwnProperty(w)&&h[w]!==s[w]&&(n||(n={}),n[w]=s[w])}else n||(y||(y=[]),y.push(u,n)),n=s;else u==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,h=h?h.__html:void 0,s!=null&&h!==s&&(y=y||[]).push(u,s)):u==="children"?typeof s!="string"&&typeof s!="number"||(y=y||[]).push(u,""+s):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(xr.hasOwnProperty(u)?(s!=null&&u==="onScroll"&&ye("scroll",t),y||h===s||(y=[])):(y=y||[]).push(u,s))}n&&(y=y||[]).push("style",n);var u=y;(e.updateQueue=u)&&(e.flags|=4)}};Bu=function(t,e,n,c){n!==c&&(e.flags|=4)};function rr(t,e){if(!Se)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var c=null;n!==null;)n.alternate!==null&&(c=n),n=n.sibling;c===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function Ne(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,c=0;if(e)for(var m=t.child;m!==null;)n|=m.lanes|m.childLanes,c|=m.subtreeFlags&14680064,c|=m.flags&14680064,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)n|=m.lanes|m.childLanes,c|=m.subtreeFlags,c|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=c,t.childLanes=n,e}function Td(t,e,n){var c=e.pendingProps;switch(qa(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ne(e),null;case 1:return qe(e.type)&&ki(),Ne(e),null;case 3:return c=e.stateNode,Wn(),xe(Ke),xe(ze),so(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(t===null||t.child===null)&&(Zr(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dt!==null&&(Oa(dt),dt=null))),xa(t,e),Ne(e),null;case 5:io(e);var m=on(Dr.current);if(n=e.type,t!==null&&e.stateNode!=null)zu(t,e,n,c,m),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!c){if(e.stateNode===null)throw Error(ee(166));return Ne(e),null}if(t=on(Ct.current),Zr(e)){c=e.stateNode,n=e.type;var y=e.memoizedProps;switch(c[wt]=e,c[Er]=y,t=(e.mode&1)!==0,n){case"dialog":ye("cancel",c),ye("close",c);break;case"iframe":case"object":case"embed":ye("load",c);break;case"video":case"audio":for(m=0;m<lr.length;m++)ye(lr[m],c);break;case"source":ye("error",c);break;case"img":case"image":case"link":ye("error",c),ye("load",c);break;case"details":ye("toggle",c);break;case"input":Ao(c,y),ye("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!y.multiple},ye("invalid",c);break;case"textarea":Lo(c,y),ye("invalid",c)}Vs(n,y),m=null;for(var w in y)if(y.hasOwnProperty(w)){var h=y[w];w==="children"?typeof h=="string"?c.textContent!==h&&(y.suppressHydrationWarning!==!0&&Jr(c.textContent,h,t),m=["children",h]):typeof h=="number"&&c.textContent!==""+h&&(y.suppressHydrationWarning!==!0&&Jr(c.textContent,h,t),m=["children",""+h]):xr.hasOwnProperty(w)&&h!=null&&w==="onScroll"&&ye("scroll",c)}switch(n){case"input":Xr(c),Io(c,y,!0);break;case"textarea":Xr(c),Fo(c);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(c.onclick=Ti)}c=m,e.updateQueue=c,c!==null&&(e.flags|=4)}else{w=m.nodeType===9?m:m.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=gc(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=w.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof c.is=="string"?t=w.createElement(n,{is:c.is}):(t=w.createElement(n),n==="select"&&(w=t,c.multiple?w.multiple=!0:c.size&&(w.size=c.size))):t=w.createElementNS(t,n),t[wt]=e,t[Er]=c,Ru(t,e,!1,!1),e.stateNode=t;e:{switch(w=Gs(n,c),n){case"dialog":ye("cancel",t),ye("close",t),m=c;break;case"iframe":case"object":case"embed":ye("load",t),m=c;break;case"video":case"audio":for(m=0;m<lr.length;m++)ye(lr[m],t);m=c;break;case"source":ye("error",t),m=c;break;case"img":case"image":case"link":ye("error",t),ye("load",t),m=c;break;case"details":ye("toggle",t),m=c;break;case"input":Ao(t,c),m=Us(t,c),ye("invalid",t);break;case"option":m=c;break;case"select":t._wrapperState={wasMultiple:!!c.multiple},m=be({},c,{value:void 0}),ye("invalid",t);break;case"textarea":Lo(t,c),m=Xs(t,c),ye("invalid",t);break;default:m=c}Vs(n,m),h=m;for(y in h)if(h.hasOwnProperty(y)){var s=h[y];y==="style"?vc(t,s):y==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,s!=null&&pc(t,s)):y==="children"?typeof s=="string"?(n!=="textarea"||s!=="")&&wr(t,s):typeof s=="number"&&wr(t,""+s):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(xr.hasOwnProperty(y)?s!=null&&y==="onScroll"&&ye("scroll",t):s!=null&&La(t,y,s,w))}switch(n){case"input":Xr(t),Io(t,c,!1);break;case"textarea":Xr(t),Fo(t);break;case"option":c.value!=null&&t.setAttribute("value",""+Kt(c.value));break;case"select":t.multiple=!!c.multiple,y=c.value,y!=null?Dn(t,!!c.multiple,y,!1):c.defaultValue!=null&&Dn(t,!!c.multiple,c.defaultValue,!0);break;default:typeof m.onClick=="function"&&(t.onclick=Ti)}switch(n){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ne(e),null;case 6:if(t&&e.stateNode!=null)Bu(t,e,t.memoizedProps,c);else{if(typeof c!="string"&&e.stateNode===null)throw Error(ee(166));if(n=on(Dr.current),on(Ct.current),Zr(e)){if(c=e.stateNode,n=e.memoizedProps,c[wt]=e,(y=c.nodeValue!==n)&&(t=et,t!==null))switch(t.tag){case 3:Jr(c.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Jr(c.nodeValue,n,(t.mode&1)!==0)}y&&(e.flags|=4)}else c=(n.nodeType===9?n:n.ownerDocument).createTextNode(c),c[wt]=e,e.stateNode=c}return Ne(e),null;case 13:if(xe(Ce),c=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Se&&Ze!==null&&e.mode&1&&!(e.flags&128))iu(),Bn(),e.flags|=98560,y=!1;else if(y=Zr(e),c!==null&&c.dehydrated!==null){if(t===null){if(!y)throw Error(ee(318));if(y=e.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(ee(317));y[wt]=e}else Bn(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ne(e),y=!1}else dt!==null&&(Oa(dt),dt=null),y=!0;if(!y)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(c=c!==null,c!==(t!==null&&t.memoizedState!==null)&&c&&(e.child.flags|=8192,e.mode&1&&(t===null||Ce.current&1?je===0&&(je=3):yo())),e.updateQueue!==null&&(e.flags|=4),Ne(e),null);case 4:return Wn(),xa(t,e),t===null&&Or(e.stateNode.containerInfo),Ne(e),null;case 10:return eo(e.type._context),Ne(e),null;case 17:return qe(e.type)&&ki(),Ne(e),null;case 19:if(xe(Ce),y=e.memoizedState,y===null)return Ne(e),null;if(c=(e.flags&128)!==0,w=y.rendering,w===null)if(c)rr(y,!1);else{if(je!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(w=Ai(t),w!==null){for(e.flags|=128,rr(y,!1),c=w.updateQueue,c!==null&&(e.updateQueue=c,e.flags|=4),e.subtreeFlags=0,c=n,n=e.child;n!==null;)y=n,t=c,y.flags&=14680066,w=y.alternate,w===null?(y.childLanes=0,y.lanes=t,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=w.childLanes,y.lanes=w.lanes,y.child=w.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=w.memoizedProps,y.memoizedState=w.memoizedState,y.updateQueue=w.updateQueue,y.type=w.type,t=w.dependencies,y.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ve(Ce,Ce.current&1|2),e.child}t=t.sibling}y.tail!==null&&ke()>Xn&&(e.flags|=128,c=!0,rr(y,!1),e.lanes=4194304)}else{if(!c)if(t=Ai(w),t!==null){if(e.flags|=128,c=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),rr(y,!0),y.tail===null&&y.tailMode==="hidden"&&!w.alternate&&!Se)return Ne(e),null}else 2*ke()-y.renderingStartTime>Xn&&n!==1073741824&&(e.flags|=128,c=!0,rr(y,!1),e.lanes=4194304);y.isBackwards?(w.sibling=e.child,e.child=w):(n=y.last,n!==null?n.sibling=w:e.child=w,y.last=w)}return y.tail!==null?(e=y.tail,y.rendering=e,y.tail=e.sibling,y.renderingStartTime=ke(),e.sibling=null,n=Ce.current,ve(Ce,c?n&1|2:n&1),e):(Ne(e),null);case 22:case 23:return vo(),c=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==c&&(e.flags|=8192),c&&e.mode&1?Je&1073741824&&(Ne(e),e.subtreeFlags&6&&(e.flags|=8192)):Ne(e),null;case 24:return null;case 25:return null}throw Error(ee(156,e.tag))}function kd(t,e){switch(qa(e),e.tag){case 1:return qe(e.type)&&ki(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Wn(),xe(Ke),xe(ze),so(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return io(e),null;case 13:if(xe(Ce),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ee(340));Bn()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return xe(Ce),null;case 4:return Wn(),null;case 10:return eo(e.type._context),null;case 22:case 23:return vo(),null;case 24:return null;default:return null}}var ni=!1,Re=!1,Od=typeof WeakSet=="function"?WeakSet:Set,oe=null;function Pn(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(c){Te(t,e,c)}else n.current=null}function wa(t,e,n){try{n()}catch(c){Te(t,e,c)}}var Tl=!1;function Pd(t,e){if(ra=Ci,t=Yc(),$a(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var c=n.getSelection&&n.getSelection();if(c&&c.rangeCount!==0){n=c.anchorNode;var m=c.anchorOffset,y=c.focusNode;c=c.focusOffset;try{n.nodeType,y.nodeType}catch{n=null;break e}var w=0,h=-1,s=-1,u=0,f=0,r=t,a=null;t:for(;;){for(var i;r!==n||m!==0&&r.nodeType!==3||(h=w+m),r!==y||c!==0&&r.nodeType!==3||(s=w+c),r.nodeType===3&&(w+=r.nodeValue.length),(i=r.firstChild)!==null;)a=r,r=i;for(;;){if(r===t)break t;if(a===n&&++u===m&&(h=w),a===y&&++f===c&&(s=w),(i=r.nextSibling)!==null)break;r=a,a=r.parentNode}r=i}n=h===-1||s===-1?null:{start:h,end:s}}else n=null}n=n||{start:0,end:0}}else n=null;for(ia={focusedElem:t,selectionRange:n},Ci=!1,oe=e;oe!==null;)if(e=oe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,oe=t;else for(;oe!==null;){e=oe;try{var l=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(l!==null){var d=l.memoizedProps,o=l.memoizedState,g=e.stateNode,p=g.getSnapshotBeforeUpdate(e.elementType===e.type?d:ht(e.type,d),o);g.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ee(163))}}catch(x){Te(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,oe=t;break}oe=e.return}return l=Tl,Tl=!1,l}function pr(t,e,n){var c=e.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var m=c=c.next;do{if((m.tag&t)===t){var y=m.destroy;m.destroy=void 0,y!==void 0&&wa(e,n,y)}m=m.next}while(m!==c)}}function qi(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var c=n.create;n.destroy=c()}n=n.next}while(n!==e)}}function Sa(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Uu(t){var e=t.alternate;e!==null&&(t.alternate=null,Uu(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[wt],delete e[Er],delete e[oa],delete e[ud],delete e[hd])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Wu(t){return t.tag===5||t.tag===3||t.tag===4}function kl(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Wu(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ca(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ti));else if(c!==4&&(t=t.child,t!==null))for(Ca(t,e,n),t=t.sibling;t!==null;)Ca(t,e,n),t=t.sibling}function _a(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(c!==4&&(t=t.child,t!==null))for(_a(t,e,n),t=t.sibling;t!==null;)_a(t,e,n),t=t.sibling}var Ae=null,ft=!1;function At(t,e,n){for(n=n.child;n!==null;)Hu(t,e,n),n=n.sibling}function Hu(t,e,n){if(St&&typeof St.onCommitFiberUnmount=="function")try{St.onCommitFiberUnmount(Wi,n)}catch{}switch(n.tag){case 5:Re||Pn(n,e);case 6:var c=Ae,m=ft;Ae=null,At(t,e,n),Ae=c,ft=m,Ae!==null&&(ft?(t=Ae,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ae.removeChild(n.stateNode));break;case 18:Ae!==null&&(ft?(t=Ae,n=n.stateNode,t.nodeType===8?Ss(t.parentNode,n):t.nodeType===1&&Ss(t,n),br(t)):Ss(Ae,n.stateNode));break;case 4:c=Ae,m=ft,Ae=n.stateNode.containerInfo,ft=!0,At(t,e,n),Ae=c,ft=m;break;case 0:case 11:case 14:case 15:if(!Re&&(c=n.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){m=c=c.next;do{var y=m,w=y.destroy;y=y.tag,w!==void 0&&(y&2||y&4)&&wa(n,e,w),m=m.next}while(m!==c)}At(t,e,n);break;case 1:if(!Re&&(Pn(n,e),c=n.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=n.memoizedProps,c.state=n.memoizedState,c.componentWillUnmount()}catch(h){Te(n,e,h)}At(t,e,n);break;case 21:At(t,e,n);break;case 22:n.mode&1?(Re=(c=Re)||n.memoizedState!==null,At(t,e,n),Re=c):At(t,e,n);break;default:At(t,e,n)}}function Ol(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Od),e.forEach(function(c){var m=Nd.bind(null,t,c);n.has(c)||(n.add(c),c.then(m,m))})}}function ut(t,e){var n=e.deletions;if(n!==null)for(var c=0;c<n.length;c++){var m=n[c];try{var y=t,w=e,h=w;e:for(;h!==null;){switch(h.tag){case 5:Ae=h.stateNode,ft=!1;break e;case 3:Ae=h.stateNode.containerInfo,ft=!0;break e;case 4:Ae=h.stateNode.containerInfo,ft=!0;break e}h=h.return}if(Ae===null)throw Error(ee(160));Hu(y,w,m),Ae=null,ft=!1;var s=m.alternate;s!==null&&(s.return=null),m.return=null}catch(u){Te(m,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Xu(e,t),e=e.sibling}function Xu(t,e){var n=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ut(e,t),yt(t),c&4){try{pr(3,t,t.return),qi(3,t)}catch(d){Te(t,t.return,d)}try{pr(5,t,t.return)}catch(d){Te(t,t.return,d)}}break;case 1:ut(e,t),yt(t),c&512&&n!==null&&Pn(n,n.return);break;case 5:if(ut(e,t),yt(t),c&512&&n!==null&&Pn(n,n.return),t.flags&32){var m=t.stateNode;try{wr(m,"")}catch(d){Te(t,t.return,d)}}if(c&4&&(m=t.stateNode,m!=null)){var y=t.memoizedProps,w=n!==null?n.memoizedProps:y,h=t.type,s=t.updateQueue;if(t.updateQueue=null,s!==null)try{h==="input"&&y.type==="radio"&&y.name!=null&&fc(m,y),Gs(h,w);var u=Gs(h,y);for(w=0;w<s.length;w+=2){var f=s[w],r=s[w+1];f==="style"?vc(m,r):f==="dangerouslySetInnerHTML"?pc(m,r):f==="children"?wr(m,r):La(m,f,r,u)}switch(h){case"input":Ws(m,y);break;case"textarea":dc(m,y);break;case"select":var a=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!y.multiple;var i=y.value;i!=null?Dn(m,!!y.multiple,i,!1):a!==!!y.multiple&&(y.defaultValue!=null?Dn(m,!!y.multiple,y.defaultValue,!0):Dn(m,!!y.multiple,y.multiple?[]:"",!1))}m[Er]=y}catch(d){Te(t,t.return,d)}}break;case 6:if(ut(e,t),yt(t),c&4){if(t.stateNode===null)throw Error(ee(162));m=t.stateNode,y=t.memoizedProps;try{m.nodeValue=y}catch(d){Te(t,t.return,d)}}break;case 3:if(ut(e,t),yt(t),c&4&&n!==null&&n.memoizedState.isDehydrated)try{br(e.containerInfo)}catch(d){Te(t,t.return,d)}break;case 4:ut(e,t),yt(t);break;case 13:ut(e,t),yt(t),m=t.child,m.flags&8192&&(y=m.memoizedState!==null,m.stateNode.isHidden=y,!y||m.alternate!==null&&m.alternate.memoizedState!==null||(po=ke())),c&4&&Ol(t);break;case 22:if(f=n!==null&&n.memoizedState!==null,t.mode&1?(Re=(u=Re)||f,ut(e,t),Re=u):ut(e,t),yt(t),c&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!f&&t.mode&1)for(oe=t,f=t.child;f!==null;){for(r=oe=f;oe!==null;){switch(a=oe,i=a.child,a.tag){case 0:case 11:case 14:case 15:pr(4,a,a.return);break;case 1:Pn(a,a.return);var l=a.stateNode;if(typeof l.componentWillUnmount=="function"){c=a,n=a.return;try{e=c,l.props=e.memoizedProps,l.state=e.memoizedState,l.componentWillUnmount()}catch(d){Te(c,n,d)}}break;case 5:Pn(a,a.return);break;case 22:if(a.memoizedState!==null){El(r);continue}}i!==null?(i.return=a,oe=i):El(r)}f=f.sibling}e:for(f=null,r=t;;){if(r.tag===5){if(f===null){f=r;try{m=r.stateNode,u?(y=m.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(h=r.stateNode,s=r.memoizedProps.style,w=s!=null&&s.hasOwnProperty("display")?s.display:null,h.style.display=mc("display",w))}catch(d){Te(t,t.return,d)}}}else if(r.tag===6){if(f===null)try{r.stateNode.nodeValue=u?"":r.memoizedProps}catch(d){Te(t,t.return,d)}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;f===r&&(f=null),r=r.return}f===r&&(f=null),r.sibling.return=r.return,r=r.sibling}}break;case 19:ut(e,t),yt(t),c&4&&Ol(t);break;case 21:break;default:ut(e,t),yt(t)}}function yt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Wu(n)){var c=n;break e}n=n.return}throw Error(ee(160))}switch(c.tag){case 5:var m=c.stateNode;c.flags&32&&(wr(m,""),c.flags&=-33);var y=kl(t);_a(t,y,m);break;case 3:case 4:var w=c.stateNode.containerInfo,h=kl(t);Ca(t,h,w);break;default:throw Error(ee(161))}}catch(s){Te(t,t.return,s)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Ed(t,e,n){oe=t,Yu(t)}function Yu(t,e,n){for(var c=(t.mode&1)!==0;oe!==null;){var m=oe,y=m.child;if(m.tag===22&&c){var w=m.memoizedState!==null||ni;if(!w){var h=m.alternate,s=h!==null&&h.memoizedState!==null||Re;h=ni;var u=Re;if(ni=w,(Re=s)&&!u)for(oe=m;oe!==null;)w=oe,s=w.child,w.tag===22&&w.memoizedState!==null?jl(m):s!==null?(s.return=w,oe=s):jl(m);for(;y!==null;)oe=y,Yu(y),y=y.sibling;oe=m,ni=h,Re=u}Pl(t)}else m.subtreeFlags&8772&&y!==null?(y.return=m,oe=y):Pl(t)}}function Pl(t){for(;oe!==null;){var e=oe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Re||qi(5,e);break;case 1:var c=e.stateNode;if(e.flags&4&&!Re)if(n===null)c.componentDidMount();else{var m=e.elementType===e.type?n.memoizedProps:ht(e.type,n.memoizedProps);c.componentDidUpdate(m,n.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var y=e.updateQueue;y!==null&&fl(e,y,c);break;case 3:var w=e.updateQueue;if(w!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}fl(e,w,n)}break;case 5:var h=e.stateNode;if(n===null&&e.flags&4){n=h;var s=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break;case"img":s.src&&(n.src=s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var f=u.memoizedState;if(f!==null){var r=f.dehydrated;r!==null&&br(r)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ee(163))}Re||e.flags&512&&Sa(e)}catch(a){Te(e,e.return,a)}}if(e===t){oe=null;break}if(n=e.sibling,n!==null){n.return=e.return,oe=n;break}oe=e.return}}function El(t){for(;oe!==null;){var e=oe;if(e===t){oe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,oe=n;break}oe=e.return}}function jl(t){for(;oe!==null;){var e=oe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{qi(4,e)}catch(s){Te(e,n,s)}break;case 1:var c=e.stateNode;if(typeof c.componentDidMount=="function"){var m=e.return;try{c.componentDidMount()}catch(s){Te(e,m,s)}}var y=e.return;try{Sa(e)}catch(s){Te(e,y,s)}break;case 5:var w=e.return;try{Sa(e)}catch(s){Te(e,w,s)}}}catch(s){Te(e,e.return,s)}if(e===t){oe=null;break}var h=e.sibling;if(h!==null){h.return=e.return,oe=h;break}oe=e.return}}var jd=Math.ceil,Fi=Mt.ReactCurrentDispatcher,fo=Mt.ReactCurrentOwner,ot=Mt.ReactCurrentBatchConfig,de=0,Me=null,Pe=null,Ie=0,Je=0,En=Jt(0),je=0,Lr=null,dn=0,Qi=0,go=0,mr=null,Ge=null,po=0,Xn=1/0,_t=null,Ni=!1,ba=null,Vt=null,ri=!1,Bt=null,Ri=0,vr=0,Ta=null,gi=-1,pi=0;function Xe(){return de&6?ke():gi!==-1?gi:gi=ke()}function Gt(t){return t.mode&1?de&2&&Ie!==0?Ie&-Ie:dd.transition!==null?(pi===0&&(pi=Ec()),pi):(t=pe,t!==0||(t=window.event,t=t===void 0?16:Fc(t.type)),t):1}function pt(t,e,n,c){if(50<vr)throw vr=0,Ta=null,Error(ee(185));Rr(t,n,c),(!(de&2)||t!==Me)&&(t===Me&&(!(de&2)&&(Qi|=n),je===4&&Rt(t,Ie)),Qe(t,c),n===1&&de===0&&!(e.mode&1)&&(Xn=ke()+500,Gi&&Zt()))}function Qe(t,e){var n=t.callbackNode;df(t,e);var c=Si(t,t===Me?Ie:0);if(c===0)n!==null&&zo(n),t.callbackNode=null,t.callbackPriority=0;else if(e=c&-c,t.callbackPriority!==e){if(n!=null&&zo(n),e===1)t.tag===0?fd(Dl.bind(null,t)):tu(Dl.bind(null,t)),ld(function(){!(de&6)&&Zt()}),n=null;else{switch(jc(c)){case 1:n=Ba;break;case 4:n=Oc;break;case 16:n=wi;break;case 536870912:n=Pc;break;default:n=wi}n=Zu(n,Vu.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Vu(t,e){if(gi=-1,pi=0,de&6)throw Error(ee(327));var n=t.callbackNode;if(Fn()&&t.callbackNode!==n)return null;var c=Si(t,t===Me?Ie:0);if(c===0)return null;if(c&30||c&t.expiredLanes||e)e=zi(t,c);else{e=c;var m=de;de|=2;var y=$u();(Me!==t||Ie!==e)&&(_t=null,Xn=ke()+500,ln(t,e));do try{Ad();break}catch(h){Gu(t,h)}while(1);Za(),Fi.current=y,de=m,Pe!==null?e=0:(Me=null,Ie=0,e=je)}if(e!==0){if(e===2&&(m=Js(t),m!==0&&(c=m,e=ka(t,m))),e===1)throw n=Lr,ln(t,0),Rt(t,c),Qe(t,ke()),n;if(e===6)Rt(t,c);else{if(m=t.current.alternate,!(c&30)&&!Dd(m)&&(e=zi(t,c),e===2&&(y=Js(t),y!==0&&(c=y,e=ka(t,y))),e===1))throw n=Lr,ln(t,0),Rt(t,c),Qe(t,ke()),n;switch(t.finishedWork=m,t.finishedLanes=c,e){case 0:case 1:throw Error(ee(345));case 2:rn(t,Ge,_t);break;case 3:if(Rt(t,c),(c&130023424)===c&&(e=po+500-ke(),10<e)){if(Si(t,0)!==0)break;if(m=t.suspendedLanes,(m&c)!==c){Xe(),t.pingedLanes|=t.suspendedLanes&m;break}t.timeoutHandle=aa(rn.bind(null,t,Ge,_t),e);break}rn(t,Ge,_t);break;case 4:if(Rt(t,c),(c&4194240)===c)break;for(e=t.eventTimes,m=-1;0<c;){var w=31-gt(c);y=1<<w,w=e[w],w>m&&(m=w),c&=~y}if(c=m,c=ke()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*jd(c/1960))-c,10<c){t.timeoutHandle=aa(rn.bind(null,t,Ge,_t),c);break}rn(t,Ge,_t);break;case 5:rn(t,Ge,_t);break;default:throw Error(ee(329))}}}return Qe(t,ke()),t.callbackNode===n?Vu.bind(null,t):null}function ka(t,e){var n=mr;return t.current.memoizedState.isDehydrated&&(ln(t,e).flags|=256),t=zi(t,e),t!==2&&(e=Ge,Ge=n,e!==null&&Oa(e)),t}function Oa(t){Ge===null?Ge=t:Ge.push.apply(Ge,t)}function Dd(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var c=0;c<n.length;c++){var m=n[c],y=m.getSnapshot;m=m.value;try{if(!mt(y(),m))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Rt(t,e){for(e&=~go,e&=~Qi,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-gt(e),c=1<<n;t[n]=-1,e&=~c}}function Dl(t){if(de&6)throw Error(ee(327));Fn();var e=Si(t,0);if(!(e&1))return Qe(t,ke()),null;var n=zi(t,e);if(t.tag!==0&&n===2){var c=Js(t);c!==0&&(e=c,n=ka(t,c))}if(n===1)throw n=Lr,ln(t,0),Rt(t,e),Qe(t,ke()),n;if(n===6)throw Error(ee(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,rn(t,Ge,_t),Qe(t,ke()),null}function mo(t,e){var n=de;de|=1;try{return t(e)}finally{de=n,de===0&&(Xn=ke()+500,Gi&&Zt())}}function gn(t){Bt!==null&&Bt.tag===0&&!(de&6)&&Fn();var e=de;de|=1;var n=ot.transition,c=pe;try{if(ot.transition=null,pe=1,t)return t()}finally{pe=c,ot.transition=n,de=e,!(de&6)&&Zt()}}function vo(){Je=En.current,xe(En)}function ln(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,od(n)),Pe!==null)for(n=Pe.return;n!==null;){var c=n;switch(qa(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&ki();break;case 3:Wn(),xe(Ke),xe(ze),so();break;case 5:io(c);break;case 4:Wn();break;case 13:xe(Ce);break;case 19:xe(Ce);break;case 10:eo(c.type._context);break;case 22:case 23:vo()}n=n.return}if(Me=t,Pe=t=$t(t.current,null),Ie=Je=e,je=0,Lr=null,go=Qi=dn=0,Ge=mr=null,an!==null){for(e=0;e<an.length;e++)if(n=an[e],c=n.interleaved,c!==null){n.interleaved=null;var m=c.next,y=n.pending;if(y!==null){var w=y.next;y.next=m,c.next=w}n.pending=c}an=null}return t}function Gu(t,e){do{var n=Pe;try{if(Za(),hi.current=Li,Ii){for(var c=_e.memoizedState;c!==null;){var m=c.queue;m!==null&&(m.pending=null),c=c.next}Ii=!1}if(fn=0,De=Ee=_e=null,gr=!1,Mr=0,fo.current=null,n===null||n.return===null){je=1,Lr=e,Pe=null;break}e:{var y=t,w=n.return,h=n,s=e;if(e=Ie,h.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){var u=s,f=h,r=f.tag;if(!(f.mode&1)&&(r===0||r===11||r===15)){var a=f.alternate;a?(f.updateQueue=a.updateQueue,f.memoizedState=a.memoizedState,f.lanes=a.lanes):(f.updateQueue=null,f.memoizedState=null)}var i=yl(w);if(i!==null){i.flags&=-257,xl(i,w,h,y,e),i.mode&1&&vl(y,u,e),e=i,s=u;var l=e.updateQueue;if(l===null){var d=new Set;d.add(s),e.updateQueue=d}else l.add(s);break e}else{if(!(e&1)){vl(y,u,e),yo();break e}s=Error(ee(426))}}else if(Se&&h.mode&1){var o=yl(w);if(o!==null){!(o.flags&65536)&&(o.flags|=256),xl(o,w,h,y,e),Qa(Hn(s,h));break e}}y=s=Hn(s,h),je!==4&&(je=2),mr===null?mr=[y]:mr.push(y),y=w;do{switch(y.tag){case 3:y.flags|=65536,e&=-e,y.lanes|=e;var g=ju(y,s,e);hl(y,g);break e;case 1:h=s;var p=y.type,v=y.stateNode;if(!(y.flags&128)&&(typeof p.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Vt===null||!Vt.has(v)))){y.flags|=65536,e&=-e,y.lanes|=e;var x=Du(y,h,e);hl(y,x);break e}}y=y.return}while(y!==null)}qu(n)}catch(S){e=S,Pe===n&&n!==null&&(Pe=n=n.return);continue}break}while(1)}function $u(){var t=Fi.current;return Fi.current=Li,t===null?Li:t}function yo(){(je===0||je===3||je===2)&&(je=4),Me===null||!(dn&268435455)&&!(Qi&268435455)||Rt(Me,Ie)}function zi(t,e){var n=de;de|=2;var c=$u();(Me!==t||Ie!==e)&&(_t=null,ln(t,e));do try{Md();break}catch(m){Gu(t,m)}while(1);if(Za(),de=n,Fi.current=c,Pe!==null)throw Error(ee(261));return Me=null,Ie=0,je}function Md(){for(;Pe!==null;)Ku(Pe)}function Ad(){for(;Pe!==null&&!rf();)Ku(Pe)}function Ku(t){var e=Ju(t.alternate,t,Je);t.memoizedProps=t.pendingProps,e===null?qu(t):Pe=e,fo.current=null}function qu(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=kd(n,e),n!==null){n.flags&=32767,Pe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{je=6,Pe=null;return}}else if(n=Td(n,e,Je),n!==null){Pe=n;return}if(e=e.sibling,e!==null){Pe=e;return}Pe=e=t}while(e!==null);je===0&&(je=5)}function rn(t,e,n){var c=pe,m=ot.transition;try{ot.transition=null,pe=1,Id(t,e,n,c)}finally{ot.transition=m,pe=c}return null}function Id(t,e,n,c){do Fn();while(Bt!==null);if(de&6)throw Error(ee(327));n=t.finishedWork;var m=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ee(177));t.callbackNode=null,t.callbackPriority=0;var y=n.lanes|n.childLanes;if(gf(t,y),t===Me&&(Pe=Me=null,Ie=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ri||(ri=!0,Zu(wi,function(){return Fn(),null})),y=(n.flags&15990)!==0,n.subtreeFlags&15990||y){y=ot.transition,ot.transition=null;var w=pe;pe=1;var h=de;de|=4,fo.current=null,Pd(t,n),Xu(n,t),ed(ia),Ci=!!ra,ia=ra=null,t.current=n,Ed(n),sf(),de=h,pe=w,ot.transition=y}else t.current=n;if(ri&&(ri=!1,Bt=t,Ri=m),y=t.pendingLanes,y===0&&(Vt=null),lf(n.stateNode),Qe(t,ke()),e!==null)for(c=t.onRecoverableError,n=0;n<e.length;n++)m=e[n],c(m.value,{componentStack:m.stack,digest:m.digest});if(Ni)throw Ni=!1,t=ba,ba=null,t;return Ri&1&&t.tag!==0&&Fn(),y=t.pendingLanes,y&1?t===Ta?vr++:(vr=0,Ta=t):vr=0,Zt(),null}function Fn(){if(Bt!==null){var t=jc(Ri),e=ot.transition,n=pe;try{if(ot.transition=null,pe=16>t?16:t,Bt===null)var c=!1;else{if(t=Bt,Bt=null,Ri=0,de&6)throw Error(ee(331));var m=de;for(de|=4,oe=t.current;oe!==null;){var y=oe,w=y.child;if(oe.flags&16){var h=y.deletions;if(h!==null){for(var s=0;s<h.length;s++){var u=h[s];for(oe=u;oe!==null;){var f=oe;switch(f.tag){case 0:case 11:case 15:pr(8,f,y)}var r=f.child;if(r!==null)r.return=f,oe=r;else for(;oe!==null;){f=oe;var a=f.sibling,i=f.return;if(Uu(f),f===u){oe=null;break}if(a!==null){a.return=i,oe=a;break}oe=i}}}var l=y.alternate;if(l!==null){var d=l.child;if(d!==null){l.child=null;do{var o=d.sibling;d.sibling=null,d=o}while(d!==null)}}oe=y}}if(y.subtreeFlags&2064&&w!==null)w.return=y,oe=w;else e:for(;oe!==null;){if(y=oe,y.flags&2048)switch(y.tag){case 0:case 11:case 15:pr(9,y,y.return)}var g=y.sibling;if(g!==null){g.return=y.return,oe=g;break e}oe=y.return}}var p=t.current;for(oe=p;oe!==null;){w=oe;var v=w.child;if(w.subtreeFlags&2064&&v!==null)v.return=w,oe=v;else e:for(w=p;oe!==null;){if(h=oe,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:qi(9,h)}}catch(S){Te(h,h.return,S)}if(h===w){oe=null;break e}var x=h.sibling;if(x!==null){x.return=h.return,oe=x;break e}oe=h.return}}if(de=m,Zt(),St&&typeof St.onPostCommitFiberRoot=="function")try{St.onPostCommitFiberRoot(Wi,t)}catch{}c=!0}return c}finally{pe=n,ot.transition=e}}return!1}function Ml(t,e,n){e=Hn(n,e),e=ju(t,e,1),t=Yt(t,e,1),e=Xe(),t!==null&&(Rr(t,1,e),Qe(t,e))}function Te(t,e,n){if(t.tag===3)Ml(t,t,n);else for(;e!==null;){if(e.tag===3){Ml(e,t,n);break}else if(e.tag===1){var c=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Vt===null||!Vt.has(c))){t=Hn(n,t),t=Du(e,t,1),e=Yt(e,t,1),t=Xe(),e!==null&&(Rr(e,1,t),Qe(e,t));break}}e=e.return}}function Ld(t,e,n){var c=t.pingCache;c!==null&&c.delete(e),e=Xe(),t.pingedLanes|=t.suspendedLanes&n,Me===t&&(Ie&n)===n&&(je===4||je===3&&(Ie&130023424)===Ie&&500>ke()-po?ln(t,0):go|=n),Qe(t,e)}function Qu(t,e){e===0&&(t.mode&1?(e=Gr,Gr<<=1,!(Gr&130023424)&&(Gr=4194304)):e=1);var n=Xe();t=jt(t,e),t!==null&&(Rr(t,e,n),Qe(t,n))}function Fd(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Qu(t,n)}function Nd(t,e){var n=0;switch(t.tag){case 13:var c=t.stateNode,m=t.memoizedState;m!==null&&(n=m.retryLane);break;case 19:c=t.stateNode;break;default:throw Error(ee(314))}c!==null&&c.delete(e),Qu(t,n)}var Ju;Ju=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ke.current)$e=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return $e=!1,bd(t,e,n);$e=!!(t.flags&131072)}else $e=!1,Se&&e.flags&1048576&&nu(e,Ei,e.index);switch(e.lanes=0,e.tag){case 2:var c=e.type;di(t,e),t=e.pendingProps;var m=zn(e,ze.current);Ln(e,n),m=oo(null,e,c,t,m,n);var y=lo();return e.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qe(c)?(y=!0,Oi(e)):y=!1,e.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,no(e),m.updater=Ki,e.stateNode=m,m._reactInternals=e,da(e,c,t,n),e=ma(null,e,c,!0,y,n)):(e.tag=0,Se&&y&&Ka(e),We(null,e,m,n),e=e.child),e;case 16:c=e.elementType;e:{switch(di(t,e),t=e.pendingProps,m=c._init,c=m(c._payload),e.type=c,m=e.tag=zd(c),t=ht(c,t),m){case 0:e=pa(null,e,c,t,n);break e;case 1:e=Cl(null,e,c,t,n);break e;case 11:e=wl(null,e,c,t,n);break e;case 14:e=Sl(null,e,c,ht(c.type,t),n);break e}throw Error(ee(306,c,""))}return e;case 0:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),pa(t,e,c,m,n);case 1:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),Cl(t,e,c,m,n);case 3:e:{if(Lu(e),t===null)throw Error(ee(387));c=e.pendingProps,y=e.memoizedState,m=y.element,lu(t,e),Mi(e,c,null,n);var w=e.memoizedState;if(c=w.element,y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},e.updateQueue.baseState=y,e.memoizedState=y,e.flags&256){m=Hn(Error(ee(423)),e),e=_l(t,e,c,n,m);break e}else if(c!==m){m=Hn(Error(ee(424)),e),e=_l(t,e,c,n,m);break e}else for(Ze=Xt(e.stateNode.containerInfo.firstChild),et=e,Se=!0,dt=null,n=au(e,null,c,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Bn(),c===m){e=Dt(t,e,n);break e}We(t,e,c,n)}e=e.child}return e;case 5:return cu(e),t===null&&ua(e),c=e.type,m=e.pendingProps,y=t!==null?t.memoizedProps:null,w=m.children,sa(c,m)?w=null:y!==null&&sa(c,y)&&(e.flags|=32),Iu(t,e),We(t,e,w,n),e.child;case 6:return t===null&&ua(e),null;case 13:return Fu(t,e,n);case 4:return ro(e,e.stateNode.containerInfo),c=e.pendingProps,t===null?e.child=Un(e,null,c,n):We(t,e,c,n),e.child;case 11:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),wl(t,e,c,m,n);case 7:return We(t,e,e.pendingProps,n),e.child;case 8:return We(t,e,e.pendingProps.children,n),e.child;case 12:return We(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(c=e.type._context,m=e.pendingProps,y=e.memoizedProps,w=m.value,ve(ji,c._currentValue),c._currentValue=w,y!==null)if(mt(y.value,w)){if(y.children===m.children&&!Ke.current){e=Dt(t,e,n);break e}}else for(y=e.child,y!==null&&(y.return=e);y!==null;){var h=y.dependencies;if(h!==null){w=y.child;for(var s=h.firstContext;s!==null;){if(s.context===c){if(y.tag===1){s=Ot(-1,n&-n),s.tag=2;var u=y.updateQueue;if(u!==null){u=u.shared;var f=u.pending;f===null?s.next=s:(s.next=f.next,f.next=s),u.pending=s}}y.lanes|=n,s=y.alternate,s!==null&&(s.lanes|=n),ha(y.return,n,e),h.lanes|=n;break}s=s.next}}else if(y.tag===10)w=y.type===e.type?null:y.child;else if(y.tag===18){if(w=y.return,w===null)throw Error(ee(341));w.lanes|=n,h=w.alternate,h!==null&&(h.lanes|=n),ha(w,n,e),w=y.sibling}else w=y.child;if(w!==null)w.return=y;else for(w=y;w!==null;){if(w===e){w=null;break}if(y=w.sibling,y!==null){y.return=w.return,w=y;break}w=w.return}y=w}We(t,e,m.children,n),e=e.child}return e;case 9:return m=e.type,c=e.pendingProps.children,Ln(e,n),m=lt(m),c=c(m),e.flags|=1,We(t,e,c,n),e.child;case 14:return c=e.type,m=ht(c,e.pendingProps),m=ht(c.type,m),Sl(t,e,c,m,n);case 15:return Mu(t,e,e.type,e.pendingProps,n);case 17:return c=e.type,m=e.pendingProps,m=e.elementType===c?m:ht(c,m),di(t,e),e.tag=1,qe(c)?(t=!0,Oi(e)):t=!1,Ln(e,n),Eu(e,c,m),da(e,c,m,n),ma(null,e,c,!0,t,n);case 19:return Nu(t,e,n);case 22:return Au(t,e,n)}throw Error(ee(156,e.tag))};function Zu(t,e){return kc(t,e)}function Rd(t,e,n,c){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function at(t,e,n,c){return new Rd(t,e,n,c)}function xo(t){return t=t.prototype,!(!t||!t.isReactComponent)}function zd(t){if(typeof t=="function")return xo(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Na)return 11;if(t===Ra)return 14}return 2}function $t(t,e){var n=t.alternate;return n===null?(n=at(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function mi(t,e,n,c,m,y){var w=2;if(c=t,typeof t=="function")xo(t)&&(w=1);else if(typeof t=="string")w=5;else e:switch(t){case xn:return cn(n.children,m,y,e);case Fa:w=8,m|=8;break;case Ns:return t=at(12,n,e,m|2),t.elementType=Ns,t.lanes=y,t;case Rs:return t=at(13,n,e,m),t.elementType=Rs,t.lanes=y,t;case zs:return t=at(19,n,e,m),t.elementType=zs,t.lanes=y,t;case cc:return Ji(n,m,y,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case oc:w=10;break e;case lc:w=9;break e;case Na:w=11;break e;case Ra:w=14;break e;case Lt:w=16,c=null;break e}throw Error(ee(130,t==null?t:typeof t,""))}return e=at(w,n,e,m),e.elementType=t,e.type=c,e.lanes=y,e}function cn(t,e,n,c){return t=at(7,t,c,e),t.lanes=n,t}function Ji(t,e,n,c){return t=at(22,t,c,e),t.elementType=cc,t.lanes=n,t.stateNode={isHidden:!1},t}function Es(t,e,n){return t=at(6,t,null,e),t.lanes=n,t}function js(t,e,n){return e=at(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Bd(t,e,n,c,m){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=us(0),this.expirationTimes=us(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=us(0),this.identifierPrefix=c,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function wo(t,e,n,c,m,y,w,h,s){return t=new Bd(t,e,n,h,s),e===1?(e=1,y===!0&&(e|=8)):e=0,y=at(3,null,null,e),t.current=y,y.stateNode=t,y.memoizedState={element:c,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},no(y),t}function Ud(t,e,n){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yn,key:c==null?null:""+c,children:t,containerInfo:e,implementation:n}}function eh(t){if(!t)return qt;t=t._reactInternals;e:{if(mn(t)!==t||t.tag!==1)throw Error(ee(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ee(171))}if(t.tag===1){var n=t.type;if(qe(n))return eu(t,n,e)}return e}function th(t,e,n,c,m,y,w,h,s){return t=wo(n,c,!0,t,m,y,w,h,s),t.context=eh(null),n=t.current,c=Xe(),m=Gt(n),y=Ot(c,m),y.callback=e??null,Yt(n,y,m),t.current.lanes=m,Rr(t,m,c),Qe(t,c),t}function Zi(t,e,n,c){var m=e.current,y=Xe(),w=Gt(m);return n=eh(n),e.context===null?e.context=n:e.pendingContext=n,e=Ot(y,w),e.payload={element:t},c=c===void 0?null:c,c!==null&&(e.callback=c),t=Yt(m,e,w),t!==null&&(pt(t,m,w,y),ui(t,m,w)),w}function Bi(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Al(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function So(t,e){Al(t,e),(t=t.alternate)&&Al(t,e)}function Wd(){return null}var nh=typeof reportError=="function"?reportError:function(t){console.error(t)};function Co(t){this._internalRoot=t}es.prototype.render=Co.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ee(409));Zi(t,e,null,null)};es.prototype.unmount=Co.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;gn(function(){Zi(null,t,null,null)}),e[Et]=null}};function es(t){this._internalRoot=t}es.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ac();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Nt.length&&e!==0&&e<Nt[n].priority;n++);Nt.splice(n,0,t),n===0&&Lc(t)}};function _o(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ts(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Il(){}function Hd(t,e,n,c,m){if(m){if(typeof c=="function"){var y=c;c=function(){var u=Bi(w);y.call(u)}}var w=th(e,c,t,0,null,!1,!1,"",Il);return t._reactRootContainer=w,t[Et]=w.current,Or(t.nodeType===8?t.parentNode:t),gn(),w}for(;m=t.lastChild;)t.removeChild(m);if(typeof c=="function"){var h=c;c=function(){var u=Bi(s);h.call(u)}}var s=wo(t,0,!1,null,null,!1,!1,"",Il);return t._reactRootContainer=s,t[Et]=s.current,Or(t.nodeType===8?t.parentNode:t),gn(function(){Zi(e,s,n,c)}),s}function ns(t,e,n,c,m){var y=n._reactRootContainer;if(y){var w=y;if(typeof m=="function"){var h=m;m=function(){var s=Bi(w);h.call(s)}}Zi(e,w,t,m)}else w=Hd(n,e,t,m,c);return Bi(w)}Dc=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=or(e.pendingLanes);n!==0&&(Ua(e,n|1),Qe(e,ke()),!(de&6)&&(Xn=ke()+500,Zt()))}break;case 13:gn(function(){var c=jt(t,1);if(c!==null){var m=Xe();pt(c,t,1,m)}}),So(t,1)}};Wa=function(t){if(t.tag===13){var e=jt(t,134217728);if(e!==null){var n=Xe();pt(e,t,134217728,n)}So(t,134217728)}};Mc=function(t){if(t.tag===13){var e=Gt(t),n=jt(t,e);if(n!==null){var c=Xe();pt(n,t,e,c)}So(t,e)}};Ac=function(){return pe};Ic=function(t,e){var n=pe;try{return pe=t,e()}finally{pe=n}};Ks=function(t,e,n){switch(e){case"input":if(Ws(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var c=n[e];if(c!==t&&c.form===t.form){var m=Vi(c);if(!m)throw Error(ee(90));hc(c),Ws(c,m)}}}break;case"textarea":dc(t,n);break;case"select":e=n.value,e!=null&&Dn(t,!!n.multiple,e,!1)}};wc=mo;Sc=gn;var Xd={usingClientEntryPoint:!1,Events:[Br,_n,Vi,yc,xc,mo]},ir={findFiberByHostInstance:sn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Yd={bundleType:ir.bundleType,version:ir.version,rendererPackageName:ir.rendererPackageName,rendererConfig:ir.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Mt.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=bc(t),t===null?null:t.stateNode},findFiberByHostInstance:ir.findFiberByHostInstance||Wd,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ii=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ii.isDisabled&&ii.supportsFiber)try{Wi=ii.inject(Yd),St=ii}catch{}}nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xd;nt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!_o(e))throw Error(ee(200));return Ud(t,e,null,n)};nt.createRoot=function(t,e){if(!_o(t))throw Error(ee(299));var n=!1,c="",m=nh;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(c=e.identifierPrefix),e.onRecoverableError!==void 0&&(m=e.onRecoverableError)),e=wo(t,1,!1,null,null,n,!1,c,m),t[Et]=e.current,Or(t.nodeType===8?t.parentNode:t),new Co(e)};nt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ee(188)):(t=Object.keys(t).join(","),Error(ee(268,t)));return t=bc(e),t=t===null?null:t.stateNode,t};nt.flushSync=function(t){return gn(t)};nt.hydrate=function(t,e,n){if(!ts(e))throw Error(ee(200));return ns(null,t,e,!0,n)};nt.hydrateRoot=function(t,e,n){if(!_o(t))throw Error(ee(405));var c=n!=null&&n.hydratedSources||null,m=!1,y="",w=nh;if(n!=null&&(n.unstable_strictMode===!0&&(m=!0),n.identifierPrefix!==void 0&&(y=n.identifierPrefix),n.onRecoverableError!==void 0&&(w=n.onRecoverableError)),e=th(e,null,t,1,n??null,m,!1,y,w),t[Et]=e.current,Or(t),c)for(t=0;t<c.length;t++)n=c[t],m=n._getVersion,m=m(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,m]:e.mutableSourceEagerHydrationData.push(n,m);return new es(e)};nt.render=function(t,e,n){if(!ts(e))throw Error(ee(200));return ns(null,t,e,!1,n)};nt.unmountComponentAtNode=function(t){if(!ts(t))throw Error(ee(40));return t._reactRootContainer?(gn(function(){ns(null,null,t,!1,function(){t._reactRootContainer=null,t[Et]=null})}),!0):!1};nt.unstable_batchedUpdates=mo;nt.unstable_renderSubtreeIntoContainer=function(t,e,n,c){if(!ts(n))throw Error(ee(200));if(t==null||t._reactInternals===void 0)throw Error(ee(38));return ns(t,e,n,!1,c)};nt.version="18.3.1-next-f1338f8080-20240426";function rh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rh)}catch(t){console.error(t)}}rh(),rc.exports=nt;var Vd=rc.exports,Ll=Vd;Ls.createRoot=Ll.createRoot,Ls.hydrateRoot=Ll.hydrateRoot;var Gd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const $d=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Kd=(t,e)=>{const n=he.forwardRef(({color:c="currentColor",size:m=24,strokeWidth:y=2,absoluteStrokeWidth:w,children:h,...s},u)=>he.createElement("svg",{ref:u,...Gd,width:m,height:m,stroke:c,strokeWidth:w?Number(y)*24/Number(m):y,className:`lucide lucide-${$d(t)}`,...s},[...e.map(([f,r])=>he.createElement(f,r)),...(Array.isArray(h)?h:[h])||[]]));return n.displayName=`${t}`,n};var me=Kd;const qd=me("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),Ds=me("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),Qd=me("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),Jd=me("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),Zd=me("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),eg=me("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),tg=me("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),ng=me("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),rg=me("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Fl=me("FileImage",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["circle",{cx:"10",cy:"13",r:"2",key:"6v46hv"}],["path",{d:"m20 17-1.09-1.09a2 2 0 0 0-2.82 0L10 22",key:"17vly1"}]]),ig=me("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),sg=me("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),ag=me("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),og=me("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]),lg=me("PanelRightOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]),ih=me("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),cg=me("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),ug=me("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),bo=me("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),hg=me("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Pa=me("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),fg=me("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),sh=me("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),dg=me("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),gg=me("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),Nl=me("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),ah=me("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),Rl=me("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var He={};const pg={},mg=Object.freeze(Object.defineProperty({__proto__:null,default:pg},Symbol.toStringTag,{value:"Module"})),Ms=xh(mg);(function(t){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var e=e||{version:"5.5.2"};if(t.fabric=e,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?e.document=document:e.document=document.implementation.createHTMLDocument(""),e.window=window;else{var n=Ms,c=new n.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;e.document=c.document,e.jsdomImplForWrapper=Ms.implForWrapper,e.nodeCanvas=Ms.Canvas,e.window=c,DOMParser=e.window.DOMParser}e.isTouchSupported="ontouchstart"in e.window||"ontouchstart"in e.document||e.window&&e.window.navigator&&e.window.navigator.maxTouchPoints>0,e.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",e.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],e.DPI=96,e.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",e.commaWsp="(?:\\s+,?\\s*|,\\s*)",e.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,e.reNonWord=/[ \n\.,;!\?\-]/,e.fontPaths={},e.iMatrix=[1,0,0,1,0,0],e.svgNS="http://www.w3.org/2000/svg",e.perfLimitSizeTotal=2097152,e.maxCacheSideLimit=4096,e.minCacheSideLimit=256,e.charWidthsCache={},e.textureSize=2048,e.disableStyleCopyPaste=!1,e.enableGLFiltering=!0,e.devicePixelRatio=e.window.devicePixelRatio||e.window.webkitDevicePixelRatio||e.window.mozDevicePixelRatio||1,e.browserShadowBlurConstant=1,e.arcToSegmentsCache={},e.boundsOfCurveCache={},e.cachesBoundsOfCurve=!0,e.forceGLPutImageData=!1,e.initFilterBackend=function(){if(e.enableGLFiltering&&e.isWebglSupported&&e.isWebglSupported(e.textureSize))return console.log("max texture size: "+e.maxTextureSize),new e.WebglFilterBackend({tileSize:e.textureSize});if(e.Canvas2dFilterBackend)return new e.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=e),function(){function h(i,l){if(this.__eventListeners[i]){var d=this.__eventListeners[i];l?d[d.indexOf(l)]=!1:e.util.array.fill(d,!1)}}function s(i,l){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var d in i)this.on(d,i[d]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(l);return this}function u(i,l){var d=(function(){l.apply(this,arguments),this.off(i,d)}).bind(this);this.on(i,d)}function f(i,l){if(arguments.length===1)for(var d in i)u.call(this,d,i[d]);else u.call(this,i,l);return this}function r(i,l){if(!this.__eventListeners)return this;if(arguments.length===0)for(i in this.__eventListeners)h.call(this,i);else if(arguments.length===1&&typeof arguments[0]=="object")for(var d in i)h.call(this,d,i[d]);else h.call(this,i,l);return this}function a(i,l){if(!this.__eventListeners)return this;var d=this.__eventListeners[i];if(!d)return this;for(var o=0,g=d.length;o<g;o++)d[o]&&d[o].call(this,l||{});return this.__eventListeners[i]=d.filter(function(p){return p!==!1}),this}e.Observable={fire:a,on:s,once:f,off:r}}(),e.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var h=0,s=arguments.length;h<s;h++)this._onObjectAdded(arguments[h]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(h,s,u){var f=this._objects;return u?f[s]=h:f.splice(s,0,h),this._onObjectAdded&&this._onObjectAdded(h),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var h=this._objects,s,u=!1,f=0,r=arguments.length;f<r;f++)s=h.indexOf(arguments[f]),s!==-1&&(u=!0,h.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[f]));return this.renderOnAddRemove&&u&&this.requestRenderAll(),this},forEachObject:function(h,s){for(var u=this.getObjects(),f=0,r=u.length;f<r;f++)h.call(s,u[f],f,u);return this},getObjects:function(h){return typeof h>"u"?this._objects.concat():this._objects.filter(function(s){return s.type===h})},item:function(h){return this._objects[h]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(h,s){return this._objects.indexOf(h)>-1?!0:s?this._objects.some(function(u){return typeof u.contains=="function"&&u.contains(h,!0)}):!1},complexity:function(){return this._objects.reduce(function(h,s){return h+=s.complexity?s.complexity():0,h},0)}},e.CommonMethods={_setOptions:function(h){for(var s in h)this.set(s,h[s])},_initGradient:function(h,s){h&&h.colorStops&&!(h instanceof e.Gradient)&&this.set(s,new e.Gradient(h))},_initPattern:function(h,s,u){h&&h.source&&!(h instanceof e.Pattern)?this.set(s,new e.Pattern(h,u)):u&&u()},_setObject:function(h){for(var s in h)this._set(s,h[s])},set:function(h,s){return typeof h=="object"?this._setObject(h):this._set(h,s),this},_set:function(h,s){this[h]=s},toggle:function(h){var s=this.get(h);return typeof s=="boolean"&&this.set(h,!s),this},get:function(h){return this[h]}},function(h){var s=Math.sqrt,u=Math.atan2,f=Math.pow,r=Math.PI/180,a=Math.PI/2;e.util={cos:function(i){if(i===0)return 1;i<0&&(i=-i);var l=i/a;switch(l){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(i===0)return 0;var l=i/a,d=1;switch(i<0&&(d=-1),l){case 1:return d;case 2:return 0;case 3:return-d}return Math.sin(i)},removeFromArray:function(i,l){var d=i.indexOf(l);return d!==-1&&i.splice(d,1),i},getRandomInt:function(i,l){return Math.floor(Math.random()*(l-i+1))+i},degreesToRadians:function(i){return i*r},radiansToDegrees:function(i){return i/r},rotatePoint:function(i,l,d){var o=new e.Point(i.x-l.x,i.y-l.y),g=e.util.rotateVector(o,d);return new e.Point(g.x,g.y).addEquals(l)},rotateVector:function(i,l){var d=e.util.sin(l),o=e.util.cos(l),g=i.x*o-i.y*d,p=i.x*d+i.y*o;return{x:g,y:p}},createVector:function(i,l){return new e.Point(l.x-i.x,l.y-i.y)},calcAngleBetweenVectors:function(i,l){return Math.acos((i.x*l.x+i.y*l.y)/(Math.hypot(i.x,i.y)*Math.hypot(l.x,l.y)))},getHatVector:function(i){return new e.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,l,d){var o=e.util.createVector(i,l),g=e.util.createVector(i,d),p=e.util.calcAngleBetweenVectors(o,g),v=e.util.calcAngleBetweenVectors(e.util.rotateVector(o,p),g),x=p*(v===0?1:-1)/2;return{vector:e.util.getHatVector(e.util.rotateVector(o,x)),angle:p}},projectStrokeOnPoints:function(i,l,d){var o=[],g=l.strokeWidth/2,p=l.strokeUniform?new e.Point(1/l.scaleX,1/l.scaleY):new e.Point(1,1),v=function(x){var S=g/Math.hypot(x.x,x.y);return new e.Point(x.x*S*p.x,x.y*S*p.y)};return i.length<=1||i.forEach(function(x,S){var C=new e.Point(x.x,x.y),T,O;S===0?(O=i[S+1],T=d?v(e.util.createVector(O,C)).addEquals(C):i[i.length-1]):S===i.length-1?(T=i[S-1],O=d?v(e.util.createVector(T,C)).addEquals(C):i[0]):(T=i[S-1],O=i[S+1]);var N=e.util.getBisector(C,T,O),U=N.vector,J=N.angle,te,se;if(l.strokeLineJoin==="miter"&&(te=-g/Math.sin(J/2),se=new e.Point(U.x*te*p.x,U.y*te*p.y),Math.hypot(se.x,se.y)/g<=l.strokeMiterLimit)){o.push(C.add(se)),o.push(C.subtract(se));return}te=-g*Math.SQRT2,se=new e.Point(U.x*te*p.x,U.y*te*p.y),o.push(C.add(se)),o.push(C.subtract(se))}),o},transformPoint:function(i,l,d){return d?new e.Point(l[0]*i.x+l[2]*i.y,l[1]*i.x+l[3]*i.y):new e.Point(l[0]*i.x+l[2]*i.y+l[4],l[1]*i.x+l[3]*i.y+l[5])},makeBoundingBoxFromPoints:function(i,l){if(l)for(var d=0;d<i.length;d++)i[d]=e.util.transformPoint(i[d],l);var o=[i[0].x,i[1].x,i[2].x,i[3].x],g=e.util.array.min(o),p=e.util.array.max(o),v=p-g,x=[i[0].y,i[1].y,i[2].y,i[3].y],S=e.util.array.min(x),C=e.util.array.max(x),T=C-S;return{left:g,top:S,width:v,height:T}},invertTransform:function(i){var l=1/(i[0]*i[3]-i[1]*i[2]),d=[l*i[3],-l*i[1],-l*i[2],l*i[0]],o=e.util.transformPoint({x:i[4],y:i[5]},d,!0);return d[4]=-o.x,d[5]=-o.y,d},toFixed:function(i,l){return parseFloat(Number(i).toFixed(l))},parseUnit:function(i,l){var d=/\D{0,2}$/.exec(i),o=parseFloat(i);switch(l||(l=e.Text.DEFAULT_SVG_FONT_SIZE),d[0]){case"mm":return o*e.DPI/25.4;case"cm":return o*e.DPI/2.54;case"in":return o*e.DPI;case"pt":return o*e.DPI/72;case"pc":return o*e.DPI/72*12;case"em":return o*l;default:return o}},falseFunction:function(){return!1},getKlass:function(i,l){return i=e.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),e.util.resolveNamespace(l)[i]},getSvgAttributes:function(i){var l=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":l=l.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":l=l.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":l=l.concat(["offset","stop-color","stop-opacity"]);break}return l},resolveNamespace:function(i){if(!i)return e;var l=i.split("."),d=l.length,o,g=h||e.window;for(o=0;o<d;++o)g=g[l[o]];return g},loadImage:function(i,l,d,o){if(!i){l&&l.call(d,i);return}var g=e.util.createImage(),p=function(){l&&l.call(d,g,!1),g=g.onload=g.onerror=null};g.onload=p,g.onerror=function(){e.log("Error loading "+g.src),l&&l.call(d,null,!0),g=g.onload=g.onerror=null},i.indexOf("data")!==0&&o!==void 0&&o!==null&&(g.crossOrigin=o),i.substring(0,14)==="data:image/svg"&&(g.onload=null,e.util.loadImageInDom(g,p)),g.src=i},loadImageInDom:function(i,l){var d=e.document.createElement("div");d.style.width=d.style.height="1px",d.style.left=d.style.top="-100%",d.style.position="absolute",d.appendChild(i),e.document.querySelector("body").appendChild(d),i.onload=function(){l(),d.parentNode.removeChild(d),d=null}},enlivenObjects:function(i,l,d,o){i=i||[];var g=[],p=0,v=i.length;function x(){++p===v&&l&&l(g.filter(function(S){return S}))}if(!v){l&&l(g);return}i.forEach(function(S,C){if(!S||!S.type){x();return}var T=e.util.getKlass(S.type,d);T.fromObject(S,function(O,N){N||(g[C]=O),o&&o(S,O,N),x()})})},enlivenObjectEnlivables:function(i,l,d){var o=e.Object.ENLIVEN_PROPS.filter(function(g){return!!i[g]});e.util.enlivenObjects(o.map(function(g){return i[g]}),function(g){var p={};o.forEach(function(v,x){p[v]=g[x],l&&(l[v]=g[x])}),d&&d(p)})},enlivenPatterns:function(i,l){i=i||[];function d(){++g===p&&l&&l(o)}var o=[],g=0,p=i.length;if(!p){l&&l(o);return}i.forEach(function(v,x){v&&v.source?new e.Pattern(v,function(S){o[x]=S,d()}):(o[x]=v,d())})},groupSVGElements:function(i,l,d){var o;return i&&i.length===1?(typeof d<"u"&&(i[0].sourcePath=d),i[0]):(l&&(l.width&&l.height?l.centerPoint={x:l.width/2,y:l.height/2}:(delete l.width,delete l.height)),o=new e.Group(i,l),typeof d<"u"&&(o.sourcePath=d),o)},populateWithProperties:function(i,l,d){if(d&&Array.isArray(d))for(var o=0,g=d.length;o<g;o++)d[o]in i&&(l[d[o]]=i[d[o]])},createCanvasElement:function(){return e.document.createElement("canvas")},copyCanvasElement:function(i){var l=e.util.createCanvasElement();return l.width=i.width,l.height=i.height,l.getContext("2d").drawImage(i,0,0),l},toDataURL:function(i,l,d){return i.toDataURL("image/"+l,d)},createImage:function(){return e.document.createElement("img")},multiplyTransformMatrices:function(i,l,d){return[i[0]*l[0]+i[2]*l[1],i[1]*l[0]+i[3]*l[1],i[0]*l[2]+i[2]*l[3],i[1]*l[2]+i[3]*l[3],d?0:i[0]*l[4]+i[2]*l[5]+i[4],d?0:i[1]*l[4]+i[3]*l[5]+i[5]]},qrDecompose:function(i){var l=u(i[1],i[0]),d=f(i[0],2)+f(i[1],2),o=s(d),g=(i[0]*i[3]-i[2]*i[1])/o,p=u(i[0]*i[2]+i[1]*i[3],d);return{angle:l/r,scaleX:o,scaleY:g,skewX:p/r,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return e.iMatrix.concat();var l=e.util.degreesToRadians(i.angle),d=e.util.cos(l),o=e.util.sin(l);return[d,o,-o,d,0,0]},calcDimensionsMatrix:function(i){var l=typeof i.scaleX>"u"?1:i.scaleX,d=typeof i.scaleY>"u"?1:i.scaleY,o=[i.flipX?-l:l,0,0,i.flipY?-d:d,0,0],g=e.util.multiplyTransformMatrices,p=e.util.degreesToRadians;return i.skewX&&(o=g(o,[1,0,Math.tan(p(i.skewX)),1],!0)),i.skewY&&(o=g(o,[1,Math.tan(p(i.skewY)),0,1],!0)),o},composeMatrix:function(i){var l=[1,0,0,1,i.translateX||0,i.translateY||0],d=e.util.multiplyTransformMatrices;return i.angle&&(l=d(l,e.util.calcRotateMatrix(i))),(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY)&&(l=d(l,e.util.calcDimensionsMatrix(i))),l},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,l,d,o){o>0&&(l>o?l-=o:l=0,d>o?d-=o:d=0);var g=!0,p,v,x=i.getImageData(l,d,o*2||1,o*2||1),S=x.data.length;for(p=3;p<S&&(v=x.data[p],g=v<=0,g!==!1);p+=4);return x=null,g},parsePreserveAspectRatioAttribute:function(i){var l="meet",d="Mid",o="Mid",g=i.split(" "),p;return g&&g.length&&(l=g.pop(),l!=="meet"&&l!=="slice"?(p=l,l="meet"):g.length&&(p=g.pop())),d=p!=="none"?p.slice(1,4):"none",o=p!=="none"?p.slice(5,8):"none",{meetOrSlice:l,alignX:d,alignY:o}},clearFabricFontCache:function(i){i=(i||"").toLowerCase(),i?e.charWidthsCache[i]&&delete e.charWidthsCache[i]:e.charWidthsCache={}},limitDimsByArea:function(i,l){var d=Math.sqrt(l*i),o=Math.floor(l/d);return{x:Math.floor(d),y:o}},capValue:function(i,l,d){return Math.max(i,Math.min(l,d))},findScaleToFit:function(i,l){return Math.min(l.width/i.width,l.height/i.height)},findScaleToCover:function(i,l){return Math.max(l.width/i.width,l.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(l){return e.util.toFixed(l,e.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,l){var d=e.util.invertTransform(l),o=e.util.multiplyTransformMatrices(d,i.calcOwnMatrix());e.util.applyTransformToObject(i,o)},addTransformToObject:function(i,l){e.util.applyTransformToObject(i,e.util.multiplyTransformMatrices(l,i.calcOwnMatrix()))},applyTransformToObject:function(i,l){var d=e.util.qrDecompose(l),o=new e.Point(d.translateX,d.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",d.scaleX),i.set("scaleY",d.scaleY),i.skewX=d.skewX,i.skewY=d.skewY,i.angle=d.angle,i.setPositionByOrigin(o,"center","center")},sizeAfterTransform:function(i,l,d){var o=i/2,g=l/2,p=[{x:-o,y:-g},{x:o,y:-g},{x:-o,y:g},{x:o,y:g}],v=e.util.calcDimensionsMatrix(d),x=e.util.makeBoundingBoxFromPoints(p,v);return{x:x.width,y:x.height}},mergeClipPaths:function(i,l){var d=i,o=l;d.inverted&&!o.inverted&&(d=l,o=i),e.util.applyTransformToObject(o,e.util.multiplyTransformMatrices(e.util.invertTransform(d.calcTransformMatrix()),o.calcTransformMatrix()));var g=d.inverted&&o.inverted;return g&&(d.inverted=o.inverted=!1),new e.Group([d],{clipPath:o,inverted:g})},hasStyleChanged:function(i,l,d){return d=d||!1,i.fill!==l.fill||i.stroke!==l.stroke||i.strokeWidth!==l.strokeWidth||i.fontSize!==l.fontSize||i.fontFamily!==l.fontFamily||i.fontWeight!==l.fontWeight||i.fontStyle!==l.fontStyle||i.textBackgroundColor!==l.textBackgroundColor||i.deltaY!==l.deltaY||d&&(i.overline!==l.overline||i.underline!==l.underline||i.linethrough!==l.linethrough)},stylesToArray:function(d,l){for(var d=e.util.object.clone(d,!0),o=l.split(`
`),g=-1,p={},v=[],x=0;x<o.length;x++){if(!d[x]){g+=o[x].length;continue}for(var S=0;S<o[x].length;S++){g++;var C=d[x][S];if(C&&Object.keys(C).length>0){var T=e.util.hasStyleChanged(p,C,!0);T?v.push({start:g,end:g+1,style:C}):v[v.length-1].end++}p=C||{}}}return v},stylesFromArray:function(i,l){if(!Array.isArray(i))return i;for(var d=l.split(`
`),o=-1,g=0,p={},v=0;v<d.length;v++)for(var x=0;x<d[v].length;x++)o++,i[g]&&i[g].start<=o&&o<i[g].end&&(p[v]=p[v]||{},p[v][x]=Object.assign({},i[g].style),o===i[g].end-1&&g++);return p}}}(t),function(){var h=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},u={m:"l",M:"L"};function f(_,D,P,j,X,M,k,L,R,$,E){var I=e.util.cos(_),H=e.util.sin(_),Q=e.util.cos(D),z=e.util.sin(D),F=P*X*Q-j*M*z+k,V=j*X*Q+P*M*z+L,q=$+R*(-P*X*H-j*M*I),A=E+R*(-j*X*H+P*M*I),W=F+R*(P*X*z+j*M*Q),K=V+R*(j*X*z-P*M*Q);return["C",q,A,W,K,F,V]}function r(_,D,P,j,X,M,k){var L=Math.PI,R=k*L/180,$=e.util.sin(R),E=e.util.cos(R),I=0,H=0;P=Math.abs(P),j=Math.abs(j);var Q=-E*_*.5-$*D*.5,z=-E*D*.5+$*_*.5,F=P*P,V=j*j,q=z*z,A=Q*Q,W=F*V-F*q-V*A,K=0;if(W<0){var Z=Math.sqrt(1-W/(F*V));P*=Z,j*=Z}else K=(X===M?-1:1)*Math.sqrt(W/(F*q+V*A));var Y=K*P*z/j,B=-K*j*Q/P,ie=E*Y-$*B+_*.5,ce=$*Y+E*B+D*.5,ue=a(1,0,(Q-Y)/P,(z-B)/j),we=a((Q-Y)/P,(z-B)/j,(-Q-Y)/P,(-z-B)/j);M===0&&we>0?we-=2*L:M===1&&we<0&&(we+=2*L);for(var ge=Math.ceil(Math.abs(we/L*2)),Be=[],Oe=we/ge,en=8/3*Math.sin(Oe/4)*Math.sin(Oe/4)/Math.sin(Oe/2),Kn=ue+Oe,vt=0;vt<ge;vt++)Be[vt]=f(ue,Kn,E,$,P,j,ie,ce,en,I,H),I=Be[vt][5],H=Be[vt][6],ue=Kn,Kn+=Oe;return Be}function a(_,D,P,j){var X=Math.atan2(D,_),M=Math.atan2(j,P);return M>=X?M-X:2*Math.PI-(X-M)}function i(_,D,P,j,X,M,k,L){var R;if(e.cachesBoundsOfCurve&&(R=h.call(arguments),e.boundsOfCurveCache[R]))return e.boundsOfCurveCache[R];var $=Math.sqrt,E=Math.min,I=Math.max,H=Math.abs,Q=[],z=[[],[]],F,V,q,A,W,K,Z,Y;V=6*_-12*P+6*X,F=-3*_+9*P-9*X+3*k,q=3*P-3*_;for(var B=0;B<2;++B){if(B>0&&(V=6*D-12*j+6*M,F=-3*D+9*j-9*M+3*L,q=3*j-3*D),H(F)<1e-12){if(H(V)<1e-12)continue;A=-q/V,0<A&&A<1&&Q.push(A);continue}Z=V*V-4*q*F,!(Z<0)&&(Y=$(Z),W=(-V+Y)/(2*F),0<W&&W<1&&Q.push(W),K=(-V-Y)/(2*F),0<K&&K<1&&Q.push(K))}for(var ie,ce,ue=Q.length,we=ue,ge;ue--;)A=Q[ue],ge=1-A,ie=ge*ge*ge*_+3*ge*ge*A*P+3*ge*A*A*X+A*A*A*k,z[0][ue]=ie,ce=ge*ge*ge*D+3*ge*ge*A*j+3*ge*A*A*M+A*A*A*L,z[1][ue]=ce;z[0][we]=_,z[1][we]=D,z[0][we+1]=k,z[1][we+1]=L;var Be=[{x:E.apply(null,z[0]),y:E.apply(null,z[1])},{x:I.apply(null,z[0]),y:I.apply(null,z[1])}];return e.cachesBoundsOfCurve&&(e.boundsOfCurveCache[R]=Be),Be}function l(_,D,P){for(var j=P[1],X=P[2],M=P[3],k=P[4],L=P[5],R=P[6],$=P[7],E=r(R-_,$-D,j,X,k,L,M),I=0,H=E.length;I<H;I++)E[I][1]+=_,E[I][2]+=D,E[I][3]+=_,E[I][4]+=D,E[I][5]+=_,E[I][6]+=D;return E}function d(_){var D=0,P=0,j=_.length,X=0,M=0,k,L,R,$=[],E,I,H;for(L=0;L<j;++L){switch(R=!1,k=_[L].slice(0),k[0]){case"l":k[0]="L",k[1]+=D,k[2]+=P;case"L":D=k[1],P=k[2];break;case"h":k[1]+=D;case"H":k[0]="L",k[2]=P,D=k[1];break;case"v":k[1]+=P;case"V":k[0]="L",P=k[1],k[1]=D,k[2]=P;break;case"m":k[0]="M",k[1]+=D,k[2]+=P;case"M":D=k[1],P=k[2],X=k[1],M=k[2];break;case"c":k[0]="C",k[1]+=D,k[2]+=P,k[3]+=D,k[4]+=P,k[5]+=D,k[6]+=P;case"C":I=k[3],H=k[4],D=k[5],P=k[6];break;case"s":k[0]="S",k[1]+=D,k[2]+=P,k[3]+=D,k[4]+=P;case"S":E==="C"?(I=2*D-I,H=2*P-H):(I=D,H=P),D=k[3],P=k[4],k[0]="C",k[5]=k[3],k[6]=k[4],k[3]=k[1],k[4]=k[2],k[1]=I,k[2]=H,I=k[3],H=k[4];break;case"q":k[0]="Q",k[1]+=D,k[2]+=P,k[3]+=D,k[4]+=P;case"Q":I=k[1],H=k[2],D=k[3],P=k[4];break;case"t":k[0]="T",k[1]+=D,k[2]+=P;case"T":E==="Q"?(I=2*D-I,H=2*P-H):(I=D,H=P),k[0]="Q",D=k[1],P=k[2],k[1]=I,k[2]=H,k[3]=D,k[4]=P;break;case"a":k[0]="A",k[6]+=D,k[7]+=P;case"A":R=!0,$=$.concat(l(D,P,k)),D=k[6],P=k[7];break;case"z":case"Z":D=X,P=M;break}R||$.push(k),E=k[0]}return $}function o(_,D,P,j){return Math.sqrt((P-_)*(P-_)+(j-D)*(j-D))}function g(_){return _*_*_}function p(_){return 3*_*_*(1-_)}function v(_){return 3*_*(1-_)*(1-_)}function x(_){return(1-_)*(1-_)*(1-_)}function S(_,D,P,j,X,M,k,L){return function(R){var $=g(R),E=p(R),I=v(R),H=x(R);return{x:k*$+X*E+P*I+_*H,y:L*$+M*E+j*I+D*H}}}function C(_,D,P,j,X,M,k,L){return function(R){var $=1-R,E=3*$*$*(P-_)+6*$*R*(X-P)+3*R*R*(k-X),I=3*$*$*(j-D)+6*$*R*(M-j)+3*R*R*(L-M);return Math.atan2(I,E)}}function T(_){return _*_}function O(_){return 2*_*(1-_)}function N(_){return(1-_)*(1-_)}function U(_,D,P,j,X,M){return function(k){var L=T(k),R=O(k),$=N(k);return{x:X*L+P*R+_*$,y:M*L+j*R+D*$}}}function J(_,D,P,j,X,M){return function(k){var L=1-k,R=2*L*(P-_)+2*k*(X-P),$=2*L*(j-D)+2*k*(M-j);return Math.atan2($,R)}}function te(_,D,P){var j={x:D,y:P},X,M=0,k;for(k=1;k<=100;k+=1)X=_(k/100),M+=o(j.x,j.y,X.x,X.y),j=X;return M}function se(_,D){for(var P=0,j=0,X=_.iterator,M={x:_.x,y:_.y},k,L,R=.01,$=_.angleFinder,E;j<D&&R>1e-4;)k=X(P),E=P,L=o(M.x,M.y,k.x,k.y),L+j>D?(P-=R,R/=2):(M=k,P+=R,j+=L);return k.angle=$(E),k}function ne(_){for(var D=0,P=_.length,j,X=0,M=0,k=0,L=0,R=[],$,E,I,H=0;H<P;H++){switch(j=_[H],E={x:X,y:M,command:j[0]},j[0]){case"M":E.length=0,k=X=j[1],L=M=j[2];break;case"L":E.length=o(X,M,j[1],j[2]),X=j[1],M=j[2];break;case"C":$=S(X,M,j[1],j[2],j[3],j[4],j[5],j[6]),I=C(X,M,j[1],j[2],j[3],j[4],j[5],j[6]),E.iterator=$,E.angleFinder=I,E.length=te($,X,M),X=j[5],M=j[6];break;case"Q":$=U(X,M,j[1],j[2],j[3],j[4]),I=J(X,M,j[1],j[2],j[3],j[4]),E.iterator=$,E.angleFinder=I,E.length=te($,X,M),X=j[3],M=j[4];break;case"Z":case"z":E.destX=k,E.destY=L,E.length=o(X,M,k,L),X=k,M=L;break}D+=E.length,R.push(E)}return R.push({length:D,x:X,y:M}),R}function re(_,D,P){P||(P=ne(_));for(var j=0;D-P[j].length>0&&j<P.length-2;)D-=P[j].length,j++;var X=P[j],M=D/X.length,k=X.command,L=_[j],R;switch(k){case"M":return{x:X.x,y:X.y,angle:0};case"Z":case"z":return R=new e.Point(X.x,X.y).lerp(new e.Point(X.destX,X.destY),M),R.angle=Math.atan2(X.destY-X.y,X.destX-X.x),R;case"L":return R=new e.Point(X.x,X.y).lerp(new e.Point(L[1],L[2]),M),R.angle=Math.atan2(L[2]-X.y,L[1]-X.x),R;case"C":return se(X,D);case"Q":return se(X,D)}}function ae(_){var D=[],P=[],j,X,M=e.rePathCommand,k="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",L="("+k+")"+e.commaWsp,R="([01])"+e.commaWsp+"?",$=L+"?"+L+"?"+L+R+R+L+"?("+k+")",E=new RegExp($,"g"),I,H,Q;if(!_||!_.match)return D;Q=_.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var z=0,F,V=Q.length;z<V;z++){j=Q[z],H=j.slice(1).trim(),P.length=0;var q=j.charAt(0);if(F=[q],q.toLowerCase()==="a")for(var A;A=E.exec(H);)for(var W=1;W<A.length;W++)P.push(A[W]);else for(;I=M.exec(H);)P.push(I[0]);for(var W=0,K=P.length;W<K;W++)X=parseFloat(P[W]),isNaN(X)||F.push(X);var Z=s[q.toLowerCase()],Y=u[q]||q;if(F.length-1>Z)for(var B=1,ie=F.length;B<ie;B+=Z)D.push([q].concat(F.slice(B,B+Z))),q=Y;else D.push(F)}return D}function le(_,D){var P=[],j,X=new e.Point(_[0].x,_[0].y),M=new e.Point(_[1].x,_[1].y),k=_.length,L=1,R=0,$=k>2;for(D=D||0,$&&(L=_[2].x<M.x?-1:_[2].x===M.x?0:1,R=_[2].y<M.y?-1:_[2].y===M.y?0:1),P.push(["M",X.x-L*D,X.y-R*D]),j=1;j<k;j++){if(!X.eq(M)){var E=X.midPointFrom(M);P.push(["Q",X.x,X.y,E.x,E.y])}X=_[j],j+1<_.length&&(M=_[j+1])}return $&&(L=X.x>_[j-2].x?1:X.x===_[j-2].x?0:-1,R=X.y>_[j-2].y?1:X.y===_[j-2].y?0:-1),P.push(["L",X.x+L*D,X.y+R*D]),P}function G(_,D,P){return P&&(D=e.util.multiplyTransformMatrices(D,[1,0,0,1,-P.x,-P.y])),_.map(function(j){for(var X=j.slice(0),M={},k=1;k<j.length-1;k+=2)M.x=j[k],M.y=j[k+1],M=e.util.transformPoint(M,D),X[k]=M.x,X[k+1]=M.y;return X})}e.util.joinPath=function(_){return _.map(function(D){return D.join(" ")}).join(" ")},e.util.parsePath=ae,e.util.makePathSimpler=d,e.util.getSmoothPathFromPoints=le,e.util.getPathSegmentsInfo=ne,e.util.getBoundsOfCurve=i,e.util.getPointOnPath=re,e.util.transformPath=G}(),function(){var h=Array.prototype.slice;function s(i,l){for(var d=h.call(arguments,2),o=[],g=0,p=i.length;g<p;g++)o[g]=d.length?i[g][l].apply(i[g],d):i[g][l].call(i[g]);return o}function u(i,l){return a(i,l,function(d,o){return d>=o})}function f(i,l){return a(i,l,function(d,o){return d<o})}function r(i,l){for(var d=i.length;d--;)i[d]=l;return i}function a(i,l,d){if(!(!i||i.length===0)){var o=i.length-1,g=l?i[o][l]:i[o];if(l)for(;o--;)d(i[o][l],g)&&(g=i[o][l]);else for(;o--;)d(i[o],g)&&(g=i[o]);return g}}e.util.array={fill:r,invoke:s,min:f,max:u}}(),function(){function h(u,f,r){if(r)if(!e.isLikelyNode&&f instanceof Element)u=f;else if(f instanceof Array){u=[];for(var a=0,i=f.length;a<i;a++)u[a]=h({},f[a],r)}else if(f&&typeof f=="object")for(var l in f)l==="canvas"||l==="group"?u[l]=null:f.hasOwnProperty(l)&&(u[l]=h({},f[l],r));else u=f;else for(var l in f)u[l]=f[l];return u}function s(u,f){return h({},u,f)}e.util.object={extend:h,clone:s},e.util.object.extend(e.util,e.Observable)}(),function(){function h(a){return a.replace(/-+(.)?/g,function(i,l){return l?l.toUpperCase():""})}function s(a,i){return a.charAt(0).toUpperCase()+(i?a.slice(1):a.slice(1).toLowerCase())}function u(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function f(a){var i=0,l,d=[];for(i=0,l;i<a.length;i++)(l=r(a,i))!==!1&&d.push(l);return d}function r(a,i){var l=a.charCodeAt(i);if(isNaN(l))return"";if(l<55296||l>57343)return a.charAt(i);if(55296<=l&&l<=56319){if(a.length<=i+1)throw"High surrogate without following low surrogate";var d=a.charCodeAt(i+1);if(56320>d||d>57343)throw"High surrogate without following low surrogate";return a.charAt(i)+a.charAt(i+1)}if(i===0)throw"Low surrogate without preceding high surrogate";var o=a.charCodeAt(i-1);if(55296>o||o>56319)throw"Low surrogate without preceding high surrogate";return!1}e.util.string={camelize:h,capitalize:s,escapeXml:u,graphemeSplit:f}}(),function(){var h=Array.prototype.slice,s=function(){},u=function(){for(var l in{toString:1})if(l==="toString")return!1;return!0}(),f=function(l,d,o){for(var g in d)g in l.prototype&&typeof l.prototype[g]=="function"&&(d[g]+"").indexOf("callSuper")>-1?l.prototype[g]=function(p){return function(){var v=this.constructor.superclass;this.constructor.superclass=o;var x=d[p].apply(this,arguments);if(this.constructor.superclass=v,p!=="initialize")return x}}(g):l.prototype[g]=d[g],u&&(d.toString!==Object.prototype.toString&&(l.prototype.toString=d.toString),d.valueOf!==Object.prototype.valueOf&&(l.prototype.valueOf=d.valueOf))};function r(){}function a(l){for(var d=null,o=this;o.constructor.superclass;){var g=o.constructor.superclass.prototype[l];if(o[l]!==g){d=g;break}o=o.constructor.superclass.prototype}return d?arguments.length>1?d.apply(this,h.call(arguments,1)):d.call(this):console.log("tried to callSuper "+l+", method not found in prototype chain",this)}function i(){var l=null,d=h.call(arguments,0);typeof d[0]=="function"&&(l=d.shift());function o(){this.initialize.apply(this,arguments)}o.superclass=l,o.subclasses=[],l&&(r.prototype=l.prototype,o.prototype=new r,l.subclasses.push(o));for(var g=0,p=d.length;g<p;g++)f(o,d[g],l);return o.prototype.initialize||(o.prototype.initialize=s),o.prototype.constructor=o,o.prototype.callSuper=a,o}e.util.createClass=i}(),function(){var h=!!e.document.createElement("div").attachEvent,s=["touchstart","touchmove","touchend"];e.util.addListener=function(f,r,a,i){f&&f.addEventListener(r,a,h?!1:i)},e.util.removeListener=function(f,r,a,i){f&&f.removeEventListener(r,a,h?!1:i)};function u(f){var r=f.changedTouches;return r&&r[0]?r[0]:f}e.util.getPointer=function(f){var r=f.target,a=e.util.getScrollLeftTop(r),i=u(f);return{x:i.clientX+a.left,y:i.clientY+a.top}},e.util.isTouchEvent=function(f){return s.indexOf(f.type)>-1||f.pointerType==="touch"}}(),function(){function h(i,l){var d=i.style;if(!d)return i;if(typeof l=="string")return i.style.cssText+=";"+l,l.indexOf("opacity")>-1?a(i,l.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var o in l)if(o==="opacity")a(i,l[o]);else{var g=o==="float"||o==="cssFloat"?typeof d.styleFloat>"u"?"cssFloat":"styleFloat":o;d.setProperty(g,l[o])}return i}var s=e.document.createElement("div"),u=typeof s.style.opacity=="string",f=typeof s.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(i){return i};u?a=function(i,l){return i.style.opacity=l,i}:f&&(a=function(i,l){var d=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(d.zoom=1),r.test(d.filter)?(l=l>=.9999?"":"alpha(opacity="+l*100+")",d.filter=d.filter.replace(r,l)):d.filter+=" alpha(opacity="+l*100+")",i}),e.util.setStyle=h}(),function(){var h=Array.prototype.slice;function s(x){return typeof x=="string"?e.document.getElementById(x):x}var u,f=function(x){return h.call(x,0)};try{u=f(e.document.childNodes)instanceof Array}catch{}u||(f=function(x){for(var S=new Array(x.length),C=x.length;C--;)S[C]=x[C];return S});function r(x,S){var C=e.document.createElement(x);for(var T in S)T==="class"?C.className=S[T]:T==="for"?C.htmlFor=S[T]:C.setAttribute(T,S[T]);return C}function a(x,S){x&&(" "+x.className+" ").indexOf(" "+S+" ")===-1&&(x.className+=(x.className?" ":"")+S)}function i(x,S,C){return typeof S=="string"&&(S=r(S,C)),x.parentNode&&x.parentNode.replaceChild(S,x),S.appendChild(x),S}function l(x){for(var S=0,C=0,T=e.document.documentElement,O=e.document.body||{scrollLeft:0,scrollTop:0};x&&(x.parentNode||x.host)&&(x=x.parentNode||x.host,x===e.document?(S=O.scrollLeft||T.scrollLeft||0,C=O.scrollTop||T.scrollTop||0):(S+=x.scrollLeft||0,C+=x.scrollTop||0),!(x.nodeType===1&&x.style.position==="fixed")););return{left:S,top:C}}function d(x){var S,C=x&&x.ownerDocument,T={left:0,top:0},O={left:0,top:0},N,U={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!C)return O;for(var J in U)O[U[J]]+=parseInt(o(x,J),10)||0;return S=C.documentElement,typeof x.getBoundingClientRect<"u"&&(T=x.getBoundingClientRect()),N=l(x),{left:T.left+N.left-(S.clientLeft||0)+O.left,top:T.top+N.top-(S.clientTop||0)+O.top}}var o;e.document.defaultView&&e.document.defaultView.getComputedStyle?o=function(x,S){var C=e.document.defaultView.getComputedStyle(x,null);return C?C[S]:void 0}:o=function(x,S){var C=x.style[S];return!C&&x.currentStyle&&(C=x.currentStyle[S]),C},function(){var x=e.document.documentElement.style,S="userSelect"in x?"userSelect":"MozUserSelect"in x?"MozUserSelect":"WebkitUserSelect"in x?"WebkitUserSelect":"KhtmlUserSelect"in x?"KhtmlUserSelect":"";function C(O){return typeof O.onselectstart<"u"&&(O.onselectstart=e.util.falseFunction),S?O.style[S]="none":typeof O.unselectable=="string"&&(O.unselectable="on"),O}function T(O){return typeof O.onselectstart<"u"&&(O.onselectstart=null),S?O.style[S]="":typeof O.unselectable=="string"&&(O.unselectable=""),O}e.util.makeElementUnselectable=C,e.util.makeElementSelectable=T}();function g(x){var S=e.jsdomImplForWrapper(x);return S._canvas||S._image}function p(x){if(e.isLikelyNode){var S=e.jsdomImplForWrapper(x);S&&(S._image=null,S._canvas=null,S._currentSrc=null,S._attributes=null,S._classList=null)}}function v(x,S){x.imageSmoothingEnabled=x.imageSmoothingEnabled||x.webkitImageSmoothingEnabled||x.mozImageSmoothingEnabled||x.msImageSmoothingEnabled||x.oImageSmoothingEnabled,x.imageSmoothingEnabled=S}e.util.setImageSmoothing=v,e.util.getById=s,e.util.toArray=f,e.util.addClass=a,e.util.makeElement=r,e.util.wrapElement=i,e.util.getScrollLeftTop=l,e.util.getElementOffset=d,e.util.getNodeCanvas=g,e.util.cleanUpJsdomNode=p}(),function(){function h(f,r){return f+(/\?/.test(f)?"&":"?")+r}function s(){}function u(f,r){r||(r={});var a=r.method?r.method.toUpperCase():"GET",i=r.onComplete||function(){},l=new e.window.XMLHttpRequest,d=r.body||r.parameters;return l.onreadystatechange=function(){l.readyState===4&&(i(l),l.onreadystatechange=s)},a==="GET"&&(d=null,typeof r.parameters=="string"&&(f=h(f,r.parameters))),l.open(a,f,!0),(a==="POST"||a==="PUT")&&l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(d),l}e.util.request=u}(),e.log=console.log,e.warn=console.warn,function(){var h=e.util.object.extend,s=e.util.object.clone,u=[];e.util.object.extend(u,{cancelAll:function(){var g=this.splice(0);return g.forEach(function(p){p.cancel()}),g},cancelByCanvas:function(g){if(!g)return[];var p=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===g});return p.forEach(function(v){v.cancel()}),p},cancelByTarget:function(g){var p=this.findAnimationsByTarget(g);return p.forEach(function(v){v.cancel()}),p},findAnimationIndex:function(g){return this.indexOf(this.findAnimation(g))},findAnimation:function(g){return this.find(function(p){return p.cancel===g})},findAnimationsByTarget:function(g){return g?this.filter(function(p){return p.target===g}):[]}});function f(){return!1}function r(g,p,v,x){return-v*Math.cos(g/x*(Math.PI/2))+v+p}function a(g){g||(g={});var p=!1,v,x=function(){var S=e.runningAnimations.indexOf(v);return S>-1&&e.runningAnimations.splice(S,1)[0]};return v=h(s(g),{cancel:function(){return p=!0,x()},currentValue:"startValue"in g?g.startValue:0,completionRate:0,durationRate:0}),e.runningAnimations.push(v),d(function(S){var C=S||+new Date,T=g.duration||500,O=C+T,N,U=g.onChange||f,J=g.abort||f,te=g.onComplete||f,se=g.easing||r,ne="startValue"in g?g.startValue.length>0:!1,re="startValue"in g?g.startValue:0,ae="endValue"in g?g.endValue:100,le=g.byValue||(ne?re.map(function(G,_){return ae[_]-re[_]}):ae-re);g.onStart&&g.onStart(),function G(_){N=_||+new Date;var D=N>O?T:N-C,P=D/T,j=ne?re.map(function(M,k){return se(D,re[k],le[k],T)}):se(D,re,le,T),X=Math.abs(ne?(j[0]-re[0])/le[0]:(j-re)/le);if(v.currentValue=ne?j.slice():j,v.completionRate=X,v.durationRate=P,!p){if(J(j,X,P)){x();return}if(N>O){v.currentValue=ne?ae.slice():ae,v.completionRate=1,v.durationRate=1,U(ne?ae.slice():ae,1,1),te(ae,1,1),x();return}else U(j,X,P),d(G)}}(C)}),v.cancel}var i=e.window.requestAnimationFrame||e.window.webkitRequestAnimationFrame||e.window.mozRequestAnimationFrame||e.window.oRequestAnimationFrame||e.window.msRequestAnimationFrame||function(g){return e.window.setTimeout(g,1e3/60)},l=e.window.cancelAnimationFrame||e.window.clearTimeout;function d(){return i.apply(e.window,arguments)}function o(){return l.apply(e.window,arguments)}e.util.animate=a,e.util.requestAnimFrame=d,e.util.cancelAnimFrame=o,e.runningAnimations=u}(),function(){function h(u,f,r){var a="rgba("+parseInt(u[0]+r*(f[0]-u[0]),10)+","+parseInt(u[1]+r*(f[1]-u[1]),10)+","+parseInt(u[2]+r*(f[2]-u[2]),10);return a+=","+(u&&f?parseFloat(u[3]+r*(f[3]-u[3])):1),a+=")",a}function s(u,f,r,a){var i=new e.Color(u).getSource(),l=new e.Color(f).getSource(),d=a.onComplete,o=a.onChange;return a=a||{},e.util.animate(e.util.object.extend(a,{duration:r||500,startValue:i,endValue:l,byValue:l,easing:function(g,p,v,x){var S=a.colorEasing?a.colorEasing(g,x):1-Math.cos(g/x*(Math.PI/2));return h(p,v,S)},onComplete:function(g,p,v){if(d)return d(h(l,l,0),p,v)},onChange:function(g,p,v){if(o){if(Array.isArray(g))return o(h(g,g,0),p,v);o(g,p,v)}}}))}e.util.animateColor=s}(),function(){function h(_,D,P,j){return _<Math.abs(D)?(_=D,j=P/4):D===0&&_===0?j=P/(2*Math.PI)*Math.asin(1):j=P/(2*Math.PI)*Math.asin(D/_),{a:_,c:D,p:P,s:j}}function s(_,D,P){return _.a*Math.pow(2,10*(D-=1))*Math.sin((D*P-_.s)*(2*Math.PI)/_.p)}function u(_,D,P,j){return P*((_=_/j-1)*_*_+1)+D}function f(_,D,P,j){return _/=j/2,_<1?P/2*_*_*_+D:P/2*((_-=2)*_*_+2)+D}function r(_,D,P,j){return P*(_/=j)*_*_*_+D}function a(_,D,P,j){return-P*((_=_/j-1)*_*_*_-1)+D}function i(_,D,P,j){return _/=j/2,_<1?P/2*_*_*_*_+D:-P/2*((_-=2)*_*_*_-2)+D}function l(_,D,P,j){return P*(_/=j)*_*_*_*_+D}function d(_,D,P,j){return P*((_=_/j-1)*_*_*_*_+1)+D}function o(_,D,P,j){return _/=j/2,_<1?P/2*_*_*_*_*_+D:P/2*((_-=2)*_*_*_*_+2)+D}function g(_,D,P,j){return-P*Math.cos(_/j*(Math.PI/2))+P+D}function p(_,D,P,j){return P*Math.sin(_/j*(Math.PI/2))+D}function v(_,D,P,j){return-P/2*(Math.cos(Math.PI*_/j)-1)+D}function x(_,D,P,j){return _===0?D:P*Math.pow(2,10*(_/j-1))+D}function S(_,D,P,j){return _===j?D+P:P*(-Math.pow(2,-10*_/j)+1)+D}function C(_,D,P,j){return _===0?D:_===j?D+P:(_/=j/2,_<1?P/2*Math.pow(2,10*(_-1))+D:P/2*(-Math.pow(2,-10*--_)+2)+D)}function T(_,D,P,j){return-P*(Math.sqrt(1-(_/=j)*_)-1)+D}function O(_,D,P,j){return P*Math.sqrt(1-(_=_/j-1)*_)+D}function N(_,D,P,j){return _/=j/2,_<1?-P/2*(Math.sqrt(1-_*_)-1)+D:P/2*(Math.sqrt(1-(_-=2)*_)+1)+D}function U(_,D,P,j){var X=1.70158,M=0,k=P;if(_===0)return D;if(_/=j,_===1)return D+P;M||(M=j*.3);var L=h(k,P,M,X);return-s(L,_,j)+D}function J(_,D,P,j){var X=1.70158,M=0,k=P;if(_===0)return D;if(_/=j,_===1)return D+P;M||(M=j*.3);var L=h(k,P,M,X);return L.a*Math.pow(2,-10*_)*Math.sin((_*j-L.s)*(2*Math.PI)/L.p)+L.c+D}function te(_,D,P,j){var X=1.70158,M=0,k=P;if(_===0)return D;if(_/=j/2,_===2)return D+P;M||(M=j*(.3*1.5));var L=h(k,P,M,X);return _<1?-.5*s(L,_,j)+D:L.a*Math.pow(2,-10*(_-=1))*Math.sin((_*j-L.s)*(2*Math.PI)/L.p)*.5+L.c+D}function se(_,D,P,j,X){return X===void 0&&(X=1.70158),P*(_/=j)*_*((X+1)*_-X)+D}function ne(_,D,P,j,X){return X===void 0&&(X=1.70158),P*((_=_/j-1)*_*((X+1)*_+X)+1)+D}function re(_,D,P,j,X){return X===void 0&&(X=1.70158),_/=j/2,_<1?P/2*(_*_*(((X*=1.525)+1)*_-X))+D:P/2*((_-=2)*_*(((X*=1.525)+1)*_+X)+2)+D}function ae(_,D,P,j){return P-le(j-_,0,P,j)+D}function le(_,D,P,j){return(_/=j)<1/2.75?P*(7.5625*_*_)+D:_<2/2.75?P*(7.5625*(_-=1.5/2.75)*_+.75)+D:_<2.5/2.75?P*(7.5625*(_-=2.25/2.75)*_+.9375)+D:P*(7.5625*(_-=2.625/2.75)*_+.984375)+D}function G(_,D,P,j){return _<j/2?ae(_*2,0,P,j)*.5+D:le(_*2-j,0,P,j)*.5+P*.5+D}e.util.ease={easeInQuad:function(_,D,P,j){return P*(_/=j)*_+D},easeOutQuad:function(_,D,P,j){return-P*(_/=j)*(_-2)+D},easeInOutQuad:function(_,D,P,j){return _/=j/2,_<1?P/2*_*_+D:-P/2*(--_*(_-2)-1)+D},easeInCubic:function(_,D,P,j){return P*(_/=j)*_*_+D},easeOutCubic:u,easeInOutCubic:f,easeInQuart:r,easeOutQuart:a,easeInOutQuart:i,easeInQuint:l,easeOutQuint:d,easeInOutQuint:o,easeInSine:g,easeOutSine:p,easeInOutSine:v,easeInExpo:x,easeOutExpo:S,easeInOutExpo:C,easeInCirc:T,easeOutCirc:O,easeInOutCirc:N,easeInElastic:U,easeOutElastic:J,easeInOutElastic:te,easeInBack:se,easeOutBack:ne,easeInOutBack:re,easeInBounce:ae,easeOutBounce:le,easeInOutBounce:G}}(),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,f=s.util.object.clone,r=s.util.toFixed,a=s.util.parseUnit,i=s.util.multiplyTransformMatrices,l=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],d=["symbol","image","marker","pattern","view","svg"],o=["pattern","defs","symbol","metadata","clipPath","mask","desc"],g=["symbol","g","a","svg","clipPath","defs"],p={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},v={stroke:"strokeOpacity",fill:"fillOpacity"},x="font-size",S="clip-path";s.svgValidTagNamesRegEx=O(l),s.svgViewBoxElementsRegEx=O(d),s.svgInvalidAncestorsRegEx=O(o),s.svgValidParentsRegEx=O(g),s.cssRules={},s.gradientDefs={},s.clipPaths={};function C(M){return M in p?p[M]:M}function T(M,k,L,R){var $=Array.isArray(k),E;if((M==="fill"||M==="stroke")&&k==="none")k="";else{if(M==="strokeUniform")return k==="non-scaling-stroke";if(M==="strokeDashArray")k==="none"?k=null:k=k.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(M==="transformMatrix")L&&L.transformMatrix?k=i(L.transformMatrix,s.parseTransformAttribute(k)):k=s.parseTransformAttribute(k);else if(M==="visible")k=k!=="none"&&k!=="hidden",L&&L.visible===!1&&(k=!1);else if(M==="opacity")k=parseFloat(k),L&&typeof L.opacity<"u"&&(k*=L.opacity);else if(M==="textAnchor")k=k==="start"?"left":k==="end"?"right":"center";else if(M==="charSpacing")E=a(k,R)/R*1e3;else if(M==="paintFirst"){var I=k.indexOf("fill"),H=k.indexOf("stroke"),k="fill";(I>-1&&H>-1&&H<I||I===-1&&H>-1)&&(k="stroke")}else{if(M==="href"||M==="xlink:href"||M==="font")return k;if(M==="imageSmoothing")return k==="optimizeQuality";E=$?k.map(a):a(k,R)}}return!$&&isNaN(E)?k:E}function O(M){return new RegExp("^("+M.join("|")+")\\b","i")}function N(M){for(var k in v)if(!(typeof M[v[k]]>"u"||M[k]==="")){if(typeof M[k]>"u"){if(!s.Object.prototype[k])continue;M[k]=s.Object.prototype[k]}if(M[k].indexOf("url(")!==0){var L=new s.Color(M[k]);M[k]=L.setAlpha(r(L.getAlpha()*M[v[k]],2)).toRgba()}}return M}function U(M,k){var L,R=[],$,E,I;for(E=0,I=k.length;E<I;E++)L=k[E],$=M.getElementsByTagName(L),R=R.concat(Array.prototype.slice.call($));return R}s.parseTransformAttribute=function(){function M(B,ie){var ce=s.util.cos(ie[0]),ue=s.util.sin(ie[0]),we=0,ge=0;ie.length===3&&(we=ie[1],ge=ie[2]),B[0]=ce,B[1]=ue,B[2]=-ue,B[3]=ce,B[4]=we-(ce*we-ue*ge),B[5]=ge-(ue*we+ce*ge)}function k(B,ie){var ce=ie[0],ue=ie.length===2?ie[1]:ie[0];B[0]=ce,B[3]=ue}function L(B,ie,ce){B[ce]=Math.tan(s.util.degreesToRadians(ie[0]))}function R(B,ie){B[4]=ie[0],ie.length===2&&(B[5]=ie[1])}var $=s.iMatrix,E=s.reNum,I=s.commaWsp,H="(?:(skewX)\\s*\\(\\s*("+E+")\\s*\\))",Q="(?:(skewY)\\s*\\(\\s*("+E+")\\s*\\))",z="(?:(rotate)\\s*\\(\\s*("+E+")(?:"+I+"("+E+")"+I+"("+E+"))?\\s*\\))",F="(?:(scale)\\s*\\(\\s*("+E+")(?:"+I+"("+E+"))?\\s*\\))",V="(?:(translate)\\s*\\(\\s*("+E+")(?:"+I+"("+E+"))?\\s*\\))",q="(?:(matrix)\\s*\\(\\s*("+E+")"+I+"("+E+")"+I+"("+E+")"+I+"("+E+")"+I+"("+E+")"+I+"("+E+")\\s*\\))",A="(?:"+q+"|"+V+"|"+F+"|"+z+"|"+H+"|"+Q+")",W="(?:"+A+"(?:"+I+"*"+A+")*)",K="^\\s*(?:"+W+"?)\\s*$",Z=new RegExp(K),Y=new RegExp(A,"g");return function(B){var ie=$.concat(),ce=[];if(!B||B&&!Z.test(B))return ie;B.replace(Y,function(we){var ge=new RegExp(A).exec(we).filter(function(en){return!!en}),Be=ge[1],Oe=ge.slice(2).map(parseFloat);switch(Be){case"translate":R(ie,Oe);break;case"rotate":Oe[0]=s.util.degreesToRadians(Oe[0]),M(ie,Oe);break;case"scale":k(ie,Oe);break;case"skewX":L(ie,Oe,2);break;case"skewY":L(ie,Oe,1);break;case"matrix":ie=Oe;break}ce.push(ie.concat()),ie=$.concat()});for(var ue=ce[0];ce.length>1;)ce.shift(),ue=s.util.multiplyTransformMatrices(ue,ce[0]);return ue}}();function J(M,k){var L,R;M.replace(/;\s*$/,"").split(";").forEach(function($){var E=$.split(":");L=E[0].trim().toLowerCase(),R=E[1].trim(),k[L]=R})}function te(M,k){var L,R;for(var $ in M)typeof M[$]>"u"||(L=$.toLowerCase(),R=M[$],k[L]=R)}function se(M,k){var L={};for(var R in s.cssRules[k])if(ne(M,R.split(" ")))for(var $ in s.cssRules[k][R])L[$]=s.cssRules[k][R][$];return L}function ne(M,k){var L,R=!0;return L=ae(M,k.pop()),L&&k.length&&(R=re(M,k)),L&&R&&k.length===0}function re(M,k){for(var L,R=!0;M.parentNode&&M.parentNode.nodeType===1&&k.length;)R&&(L=k.pop()),M=M.parentNode,R=ae(M,L);return k.length===0}function ae(M,k){var L=M.nodeName,R=M.getAttribute("class"),$=M.getAttribute("id"),E,I;if(E=new RegExp("^"+L,"i"),k=k.replace(E,""),$&&k.length&&(E=new RegExp("#"+$+"(?![a-zA-Z\\-]+)","i"),k=k.replace(E,"")),R&&k.length)for(R=R.split(" "),I=R.length;I--;)E=new RegExp("\\."+R[I]+"(?![a-zA-Z\\-]+)","i"),k=k.replace(E,"");return k.length===0}function le(M,k){var L;if(M.getElementById&&(L=M.getElementById(k)),L)return L;var R,$,E,I=M.getElementsByTagName("*");for($=0,E=I.length;$<E;$++)if(R=I[$],k===R.getAttribute("id"))return R}function G(M){for(var k=U(M,["use","svg:use"]),L=0;k.length&&L<k.length;){var R=k[L],$=R.getAttribute("xlink:href")||R.getAttribute("href");if($===null)return;var E=$.slice(1),I=R.getAttribute("x")||0,H=R.getAttribute("y")||0,Q=le(M,E).cloneNode(!0),z=(Q.getAttribute("transform")||"")+" translate("+I+", "+H+")",F,V=k.length,q,A,W,K,Z=s.svgNS;if(D(Q),/^svg$/i.test(Q.nodeName)){var Y=Q.ownerDocument.createElementNS(Z,"g");for(A=0,W=Q.attributes,K=W.length;A<K;A++)q=W.item(A),Y.setAttributeNS(Z,q.nodeName,q.nodeValue);for(;Q.firstChild;)Y.appendChild(Q.firstChild);Q=Y}for(A=0,W=R.attributes,K=W.length;A<K;A++)q=W.item(A),!(q.nodeName==="x"||q.nodeName==="y"||q.nodeName==="xlink:href"||q.nodeName==="href")&&(q.nodeName==="transform"?z=q.nodeValue+" "+z:Q.setAttribute(q.nodeName,q.nodeValue));Q.setAttribute("transform",z),Q.setAttribute("instantiated_by_use","1"),Q.removeAttribute("id"),F=R.parentNode,F.replaceChild(Q,R),k.length===V&&L++}}var _=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function D(M){if(!s.svgViewBoxElementsRegEx.test(M.nodeName))return{};var k=M.getAttribute("viewBox"),L=1,R=1,$=0,E=0,I,H,Q,z,F=M.getAttribute("width"),V=M.getAttribute("height"),q=M.getAttribute("x")||0,A=M.getAttribute("y")||0,W=M.getAttribute("preserveAspectRatio")||"",K=!k||!(k=k.match(_)),Z=!F||!V||F==="100%"||V==="100%",Y=K&&Z,B={},ie="",ce=0,ue=0;if(B.width=0,B.height=0,B.toBeParsed=Y,K&&(q||A)&&M.parentNode&&M.parentNode.nodeName!=="#document"&&(ie=" translate("+a(q)+" "+a(A)+") ",Q=(M.getAttribute("transform")||"")+ie,M.setAttribute("transform",Q),M.removeAttribute("x"),M.removeAttribute("y")),Y)return B;if(K)return B.width=a(F),B.height=a(V),B;if($=-parseFloat(k[1]),E=-parseFloat(k[2]),I=parseFloat(k[3]),H=parseFloat(k[4]),B.minX=$,B.minY=E,B.viewBoxWidth=I,B.viewBoxHeight=H,Z?(B.width=I,B.height=H):(B.width=a(F),B.height=a(V),L=B.width/I,R=B.height/H),W=s.util.parsePreserveAspectRatioAttribute(W),W.alignX!=="none"&&(W.meetOrSlice==="meet"&&(R=L=L>R?R:L),W.meetOrSlice==="slice"&&(R=L=L>R?L:R),ce=B.width-I*L,ue=B.height-H*L,W.alignX==="Mid"&&(ce/=2),W.alignY==="Mid"&&(ue/=2),W.alignX==="Min"&&(ce=0),W.alignY==="Min"&&(ue=0)),L===1&&R===1&&$===0&&E===0&&q===0&&A===0)return B;if((q||A)&&M.parentNode.nodeName!=="#document"&&(ie=" translate("+a(q)+" "+a(A)+") "),Q=ie+" matrix("+L+" 0 0 "+R+" "+($*L+ce)+" "+(E*R+ue)+") ",M.nodeName==="svg"){for(z=M.ownerDocument.createElementNS(s.svgNS,"g");M.firstChild;)z.appendChild(M.firstChild);M.appendChild(z)}else z=M,z.removeAttribute("x"),z.removeAttribute("y"),Q=z.getAttribute("transform")+Q;return z.setAttribute("transform",Q),B}function P(M,k){for(;M&&(M=M.parentNode);)if(M.nodeName&&k.test(M.nodeName.replace("svg:",""))&&!M.getAttribute("instantiated_by_use"))return!0;return!1}s.parseSVGDocument=function(M,k,L,R){if(M){G(M);var $=s.Object.__uid++,E,I,H=D(M),Q=s.util.toArray(M.getElementsByTagName("*"));if(H.crossOrigin=R&&R.crossOrigin,H.svgUid=$,Q.length===0&&s.isLikelyNode){Q=M.selectNodes('//*[name(.)!="svg"]');var z=[];for(E=0,I=Q.length;E<I;E++)z[E]=Q[E];Q=z}var F=Q.filter(function(q){return D(q),s.svgValidTagNamesRegEx.test(q.nodeName.replace("svg:",""))&&!P(q,s.svgInvalidAncestorsRegEx)});if(!F||F&&!F.length){k&&k([],{});return}var V={};Q.filter(function(q){return q.nodeName.replace("svg:","")==="clipPath"}).forEach(function(q){var A=q.getAttribute("id");V[A]=s.util.toArray(q.getElementsByTagName("*")).filter(function(W){return s.svgValidTagNamesRegEx.test(W.nodeName.replace("svg:",""))})}),s.gradientDefs[$]=s.getGradientDefs(M),s.cssRules[$]=s.getCSSRules(M),s.clipPaths[$]=V,s.parseElements(F,function(q,A){k&&(k(q,H,A,Q),delete s.gradientDefs[$],delete s.cssRules[$],delete s.clipPaths[$])},f(H),L,R)}};function j(M,k){var L=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],R="xlink:href",$=k.getAttribute(R).slice(1),E=le(M,$);if(E&&E.getAttribute(R)&&j(M,E),L.forEach(function(H){E&&!k.hasAttribute(H)&&E.hasAttribute(H)&&k.setAttribute(H,E.getAttribute(H))}),!k.children.length)for(var I=E.cloneNode(!0);I.firstChild;)k.appendChild(I.firstChild);k.removeAttribute(R)}var X=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");u(s,{parseFontDeclaration:function(M,k){var L=M.match(X);if(L){var R=L[1],$=L[3],E=L[4],I=L[5],H=L[6];R&&(k.fontStyle=R),$&&(k.fontWeight=isNaN(parseFloat($))?$:parseFloat($)),E&&(k.fontSize=a(E)),H&&(k.fontFamily=H),I&&(k.lineHeight=I==="normal"?1:I)}},getGradientDefs:function(M){var k=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],L=U(M,k),R,$=0,E={};for($=L.length;$--;)R=L[$],R.getAttribute("xlink:href")&&j(M,R),E[R.getAttribute("id")]=R;return E},parseAttributes:function(M,k,L){if(M){var R,$={},E,I;typeof L>"u"&&(L=M.getAttribute("svgUid")),M.parentNode&&s.svgValidParentsRegEx.test(M.parentNode.nodeName)&&($=s.parseAttributes(M.parentNode,k,L));var H=k.reduce(function(W,K){return R=M.getAttribute(K),R&&(W[K]=R),W},{}),Q=u(se(M,L),s.parseStyleAttribute(M));H=u(H,Q),Q[S]&&M.setAttribute(S,Q[S]),E=I=$.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,H[x]&&(H[x]=E=a(H[x],I));var z,F,V={};for(var q in H)z=C(q),F=T(z,H[q],$,E),V[z]=F;V&&V.font&&s.parseFontDeclaration(V.font,V);var A=u($,V);return s.svgValidParentsRegEx.test(M.nodeName)?A:N(A)}},parseElements:function(M,k,L,R,$){new s.ElementsParser(M,k,L,R,$).parse()},parseStyleAttribute:function(M){var k={},L=M.getAttribute("style");return L&&(typeof L=="string"?J(L,k):te(L,k)),k},parsePointsAttribute:function(M){if(!M)return null;M=M.replace(/,/g," ").trim(),M=M.split(/\s+/);var k=[],L,R;for(L=0,R=M.length;L<R;L+=2)k.push({x:parseFloat(M[L]),y:parseFloat(M[L+1])});return k},getCSSRules:function(M){var k=M.getElementsByTagName("style"),L,R,$={},E;for(L=0,R=k.length;L<R;L++){var I=k[L].textContent;I=I.replace(/\/\*[\s\S]*?\*\//g,""),I.trim()!==""&&(E=I.split("}"),E=E.filter(function(H){return H.trim()}),E.forEach(function(H){var Q=H.split("{"),z={},F=Q[1].trim(),V=F.split(";").filter(function(K){return K.trim()});for(L=0,R=V.length;L<R;L++){var q=V[L].split(":"),A=q[0].trim(),W=q[1].trim();z[A]=W}H=Q[0].trim(),H.split(",").forEach(function(K){K=K.replace(/^svg/i,"").trim(),K!==""&&($[K]?s.util.object.extend($[K],z):$[K]=s.util.object.clone(z))})}))}return $},loadSVGFromURL:function(M,k,L,R){M=M.replace(/^\n\s*/,"").trim(),new s.util.request(M,{method:"get",onComplete:$});function $(E){var I=E.responseXML;if(!I||!I.documentElement)return k&&k(null),!1;s.parseSVGDocument(I.documentElement,function(H,Q,z,F){k&&k(H,Q,z,F)},L,R)}},loadSVGFromString:function(M,k,L,R){var $=new s.window.DOMParser,E=$.parseFromString(M.trim(),"text/xml");s.parseSVGDocument(E.documentElement,function(I,H,Q,z){k(I,H,Q,z)},L,R)}})}(t),e.ElementsParser=function(h,s,u,f,r,a){this.elements=h,this.callback=s,this.options=u,this.reviver=f,this.svgUid=u&&u.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a},function(h){h.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},h.createObjects=function(){var s=this;this.elements.forEach(function(u,f){u.setAttribute("svgUid",s.svgUid),s.createObject(u,f)})},h.findTag=function(s){return e[e.util.string.capitalize(s.tagName.replace("svg:",""))]},h.createObject=function(s,u){var f=this.findTag(s);if(f&&f.fromElement)try{f.fromElement(s,this.createCallback(u,s),this.options)}catch(r){e.log(r)}else this.checkIfDone()},h.createCallback=function(s,u){var f=this;return function(r){var a;f.resolveGradient(r,u,"fill"),f.resolveGradient(r,u,"stroke"),r instanceof e.Image&&r._originalElement&&(a=r.parsePreserveAspectRatioAttribute(u)),r._removeTransformMatrix(a),f.resolveClipPath(r,u),f.reviver&&f.reviver(u,r),f.instances[s]=r,f.checkIfDone()}},h.extractPropertyDefinition=function(s,u,f){var r=s[u],a=this.regexUrl;if(a.test(r)){a.lastIndex=0;var i=a.exec(r)[1];return a.lastIndex=0,e[f][this.svgUid][i]}},h.resolveGradient=function(s,u,f){var r=this.extractPropertyDefinition(s,f,"gradientDefs");if(r){var a=u.getAttribute(f+"-opacity"),i=e.Gradient.fromElement(r,s,a,this.options);s.set(f,i)}},h.createClipPathCallback=function(s,u){return function(f){f._removeTransformMatrix(),f.fillRule=f.clipRule,u.push(f)}},h.resolveClipPath=function(s,u){var f=this.extractPropertyDefinition(s,"clipPath","clipPaths"),r,a,i,l,d,o;if(f){l=[],i=e.util.invertTransform(s.calcTransformMatrix());for(var g=f[0].parentNode,p=u;p.parentNode&&p.getAttribute("clip-path")!==s.clipPath;)p=p.parentNode;p.parentNode.appendChild(g);for(var v=0;v<f.length;v++)r=f[v],a=this.findTag(r),a.fromElement(r,this.createClipPathCallback(s,l),this.options);l.length===1?f=l[0]:f=new e.Group(l),d=e.util.multiplyTransformMatrices(i,f.calcTransformMatrix()),f.clipPath&&this.resolveClipPath(f,p);var o=e.util.qrDecompose(d);f.flipX=!1,f.flipY=!1,f.set("scaleX",o.scaleX),f.set("scaleY",o.scaleY),f.angle=o.angle,f.skewX=o.skewX,f.skewY=0,f.setPositionByOrigin({x:o.translateX,y:o.translateY},"center","center"),s.clipPath=f}else delete s.clipPath},h.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))}}(e.ElementsParser.prototype),function(h){var s=h.fabric||(h.fabric={});if(s.Point){s.warn("fabric.Point is already defined");return}s.Point=u;function u(f,r){this.x=f,this.y=r}u.prototype={type:"point",constructor:u,add:function(f){return new u(this.x+f.x,this.y+f.y)},addEquals:function(f){return this.x+=f.x,this.y+=f.y,this},scalarAdd:function(f){return new u(this.x+f,this.y+f)},scalarAddEquals:function(f){return this.x+=f,this.y+=f,this},subtract:function(f){return new u(this.x-f.x,this.y-f.y)},subtractEquals:function(f){return this.x-=f.x,this.y-=f.y,this},scalarSubtract:function(f){return new u(this.x-f,this.y-f)},scalarSubtractEquals:function(f){return this.x-=f,this.y-=f,this},multiply:function(f){return new u(this.x*f,this.y*f)},multiplyEquals:function(f){return this.x*=f,this.y*=f,this},divide:function(f){return new u(this.x/f,this.y/f)},divideEquals:function(f){return this.x/=f,this.y/=f,this},eq:function(f){return this.x===f.x&&this.y===f.y},lt:function(f){return this.x<f.x&&this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new u(this.x+(f.x-this.x)*r,this.y+(f.y-this.y)*r)},distanceFrom:function(f){var r=this.x-f.x,a=this.y-f.y;return Math.sqrt(r*r+a*a)},midPointFrom:function(f){return this.lerp(f)},min:function(f){return new u(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new u(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+","+this.y},setXY:function(f,r){return this.x=f,this.y=r,this},setX:function(f){return this.x=f,this},setY:function(f){return this.y=f,this},setFromPoint:function(f){return this.x=f.x,this.y=f.y,this},swap:function(f){var r=this.x,a=this.y;this.x=f.x,this.y=f.y,f.x=r,f.y=a},clone:function(){return new u(this.x,this.y)}}}(t),function(h){var s=h.fabric||(h.fabric={});if(s.Intersection){s.warn("fabric.Intersection is already defined");return}function u(f){this.status=f,this.points=[]}s.Intersection=u,s.Intersection.prototype={constructor:u,appendPoint:function(f){return this.points.push(f),this},appendPoints:function(f){return this.points=this.points.concat(f),this}},s.Intersection.intersectLineLine=function(f,r,a,i){var l,d=(i.x-a.x)*(f.y-a.y)-(i.y-a.y)*(f.x-a.x),o=(r.x-f.x)*(f.y-a.y)-(r.y-f.y)*(f.x-a.x),g=(i.y-a.y)*(r.x-f.x)-(i.x-a.x)*(r.y-f.y);if(g!==0){var p=d/g,v=o/g;0<=p&&p<=1&&0<=v&&v<=1?(l=new u("Intersection"),l.appendPoint(new s.Point(f.x+p*(r.x-f.x),f.y+p*(r.y-f.y)))):l=new u}else d===0||o===0?l=new u("Coincident"):l=new u("Parallel");return l},s.Intersection.intersectLinePolygon=function(f,r,a){var i=new u,l=a.length,d,o,g,p;for(p=0;p<l;p++)d=a[p],o=a[(p+1)%l],g=u.intersectLineLine(f,r,d,o),i.appendPoints(g.points);return i.points.length>0&&(i.status="Intersection"),i},s.Intersection.intersectPolygonPolygon=function(f,r){var a=new u,i=f.length,l;for(l=0;l<i;l++){var d=f[l],o=f[(l+1)%i],g=u.intersectLinePolygon(d,o,r);a.appendPoints(g.points)}return a.points.length>0&&(a.status="Intersection"),a},s.Intersection.intersectPolygonRectangle=function(f,r,a){var i=r.min(a),l=r.max(a),d=new s.Point(l.x,i.y),o=new s.Point(i.x,l.y),g=u.intersectLinePolygon(i,d,f),p=u.intersectLinePolygon(d,l,f),v=u.intersectLinePolygon(l,o,f),x=u.intersectLinePolygon(o,i,f),S=new u;return S.appendPoints(g.points),S.appendPoints(p.points),S.appendPoints(v.points),S.appendPoints(x.points),S.points.length>0&&(S.status="Intersection"),S}}(t),function(h){var s=h.fabric||(h.fabric={});if(s.Color){s.warn("fabric.Color is already defined.");return}function u(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}s.Color=u,s.Color.prototype={_tryParsingColor:function(r){var a;r in u.colorNameMap&&(r=u.colorNameMap[r]),r==="transparent"&&(a=[255,255,255,0]),a||(a=u.sourceFromHex(r)),a||(a=u.sourceFromRgb(r)),a||(a=u.sourceFromHsl(r)),a||(a=[0,0,0,1]),a&&this.setSource(a)},_rgbToHsl:function(r,a,i){r/=255,a/=255,i/=255;var l,d,o,g=s.util.array.max([r,a,i]),p=s.util.array.min([r,a,i]);if(o=(g+p)/2,g===p)l=d=0;else{var v=g-p;switch(d=o>.5?v/(2-g-p):v/(g+p),g){case r:l=(a-i)/v+(a<i?6:0);break;case a:l=(i-r)/v+2;break;case i:l=(r-a)/v+4;break}l/=6}return[Math.round(l*360),Math.round(d*100),Math.round(o*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),a=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var r=this.getSource(),a=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),a,i,l;return a=r[0].toString(16),a=a.length===1?"0"+a:a,i=r[1].toString(16),i=i.length===1?"0"+i:i,l=r[2].toString(16),l=l.length===1?"0"+l:l,a.toUpperCase()+i.toUpperCase()+l.toUpperCase()},toHexa:function(){var r=this.getSource(),a;return a=Math.round(r[3]*255),a=a.toString(16),a=a.length===1?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var a=this.getSource();return a[3]=r,this.setSource(a),this},toGrayscale:function(){var r=this.getSource(),a=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),i=r[3];return this.setSource([a,a,a,i]),this},toBlackWhite:function(r){var a=this.getSource(),i=(a[0]*.3+a[1]*.59+a[2]*.11).toFixed(0),l=a[3];return r=r||127,i=Number(i)<Number(r)?0:255,this.setSource([i,i,i,l]),this},overlayWith:function(r){r instanceof u||(r=new u(r));var a=[],i=this.getAlpha(),l=.5,d=this.getSource(),o=r.getSource(),g;for(g=0;g<3;g++)a.push(Math.round(d[g]*(1-l)+o[g]*l));return a[3]=i,this.setSource(a),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function f(r,a,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(a-r)*6*i:i<1/2?a:i<2/3?r+(a-r)*(2/3-i)*6:r}s.Color.fromRgb=function(r){return u.fromSource(u.sourceFromRgb(r))},s.Color.sourceFromRgb=function(r){var a=r.match(u.reRGBa);if(a){var i=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),l=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),d=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(i,10),parseInt(l,10),parseInt(d,10),a[4]?parseFloat(a[4]):1]}},s.Color.fromRgba=u.fromRgb,s.Color.fromHsl=function(r){return u.fromSource(u.sourceFromHsl(r))},s.Color.sourceFromHsl=function(r){var a=r.match(u.reHSLa);if(a){var i=(parseFloat(a[1])%360+360)%360/360,l=parseFloat(a[2])/(/%$/.test(a[2])?100:1),d=parseFloat(a[3])/(/%$/.test(a[3])?100:1),o,g,p;if(l===0)o=g=p=d;else{var v=d<=.5?d*(l+1):d+l-d*l,x=d*2-v;o=f(x,v,i+1/3),g=f(x,v,i),p=f(x,v,i-1/3)}return[Math.round(o*255),Math.round(g*255),Math.round(p*255),a[4]?parseFloat(a[4]):1]}},s.Color.fromHsla=u.fromHsl,s.Color.fromHex=function(r){return u.fromSource(u.sourceFromHex(r))},s.Color.sourceFromHex=function(r){if(r.match(u.reHex)){var a=r.slice(r.indexOf("#")+1),i=a.length===3||a.length===4,l=a.length===8||a.length===4,d=i?a.charAt(0)+a.charAt(0):a.substring(0,2),o=i?a.charAt(1)+a.charAt(1):a.substring(2,4),g=i?a.charAt(2)+a.charAt(2):a.substring(4,6),p=l?i?a.charAt(3)+a.charAt(3):a.substring(6,8):"FF";return[parseInt(d,16),parseInt(o,16),parseInt(g,16),parseFloat((parseInt(p,16)/255).toFixed(2))]}},s.Color.fromSource=function(r){var a=new u;return a.setSource(r),a}}(t),function(h){var s=h.fabric||(h.fabric={}),u=["e","se","s","sw","w","nw","n","ne","e"],f=["ns","nesw","ew","nwse"],r={},a="left",i="top",l="right",d="bottom",o="center",g={top:d,bottom:i,left:l,right:a,center:o},p=s.util.radiansToDegrees,v=Math.sign||function(z){return(z>0)-(z<0)||+z};function x(z,F){var V=z.angle+p(Math.atan2(F.y,F.x))+360;return Math.round(V%360/45)}function S(z,F){var V=F.transform.target,q=V.canvas,A=s.util.object.clone(F);A.target=V,q&&q.fire("object:"+z,A),V.fire(z,F)}function C(z,F){var V=F.canvas,q=V.uniScaleKey,A=z[q];return V.uniformScaling&&!A||!V.uniformScaling&&A}function T(z){return z.originX===o&&z.originY===o}function O(z,F,V){var q=z.lockScalingX,A=z.lockScalingY;return!!(q&&A||!F&&(q||A)&&V||q&&F==="x"||A&&F==="y")}function N(z,F,V){var q="not-allowed",A=C(z,V),W="";if(F.x!==0&&F.y===0?W="x":F.x===0&&F.y!==0&&(W="y"),O(V,W,A))return q;var K=x(V,F);return u[K]+"-resize"}function U(z,F,V){var q="not-allowed";if(F.x!==0&&V.lockSkewingY||F.y!==0&&V.lockSkewingX)return q;var A=x(V,F)%4;return f[A]+"-resize"}function J(z,F,V){return z[V.canvas.altActionKey]?r.skewCursorStyleHandler(z,F,V):r.scaleCursorStyleHandler(z,F,V)}function te(z,F,V){var q=z[V.canvas.altActionKey];if(F.x===0)return q?"skewX":"scaleY";if(F.y===0)return q?"skewY":"scaleX"}function se(z,F,V){return V.lockRotation?"not-allowed":F.cursorStyle}function ne(z,F,V,q){return{e:z,transform:F,pointer:{x:V,y:q}}}function re(z){return function(F,V,q,A){var W=V.target,K=W.getCenterPoint(),Z=W.translateToOriginPoint(K,V.originX,V.originY),Y=z(F,V,q,A);return W.setPositionByOrigin(Z,V.originX,V.originY),Y}}function ae(z,F){return function(V,q,A,W){var K=F(V,q,A,W);return K&&S(z,ne(V,q,A,W)),K}}function le(z,F,V,q,A){var W=z.target,K=W.controls[z.corner],Z=W.canvas.getZoom(),Y=W.padding/Z,B=W.toLocalPoint(new s.Point(q,A),F,V);return B.x>=Y&&(B.x-=Y),B.x<=-Y&&(B.x+=Y),B.y>=Y&&(B.y-=Y),B.y<=Y&&(B.y+=Y),B.x-=K.offsetX,B.y-=K.offsetY,B}function G(z){return z.flipX!==z.flipY}function _(z,F,V,q,A){if(z[F]!==0){var W=z._getTransformedDimensions()[q],K=A/W*z[V];z.set(V,K)}}function D(z,F,V,q){var A=F.target,W=A._getTransformedDimensions(0,A.skewY),K=le(F,F.originX,F.originY,V,q),Z=Math.abs(K.x*2)-W.x,Y=A.skewX,B;Z<2?B=0:(B=p(Math.atan2(Z/A.scaleX,W.y/A.scaleY)),F.originX===a&&F.originY===d&&(B=-B),F.originX===l&&F.originY===i&&(B=-B),G(A)&&(B=-B));var ie=Y!==B;if(ie){var ce=A._getTransformedDimensions().y;A.set("skewX",B),_(A,"skewY","scaleY","y",ce)}return ie}function P(z,F,V,q){var A=F.target,W=A._getTransformedDimensions(A.skewX,0),K=le(F,F.originX,F.originY,V,q),Z=Math.abs(K.y*2)-W.y,Y=A.skewY,B;Z<2?B=0:(B=p(Math.atan2(Z/A.scaleY,W.x/A.scaleX)),F.originX===a&&F.originY===d&&(B=-B),F.originX===l&&F.originY===i&&(B=-B),G(A)&&(B=-B));var ie=Y!==B;if(ie){var ce=A._getTransformedDimensions().x;A.set("skewY",B),_(A,"skewX","scaleX","x",ce)}return ie}function j(z,F,V,q){var A=F.target,W=A.skewX,K,Z=F.originY;if(A.lockSkewingX)return!1;if(W===0){var Y=le(F,o,o,V,q);Y.x>0?K=a:K=l}else W>0&&(K=Z===i?a:l),W<0&&(K=Z===i?l:a),G(A)&&(K=K===a?l:a);F.originX=K;var B=ae("skewing",re(D));return B(z,F,V,q)}function X(z,F,V,q){var A=F.target,W=A.skewY,K,Z=F.originX;if(A.lockSkewingY)return!1;if(W===0){var Y=le(F,o,o,V,q);Y.y>0?K=i:K=d}else W>0&&(K=Z===a?i:d),W<0&&(K=Z===a?d:i),G(A)&&(K=K===i?d:i);F.originY=K;var B=ae("skewing",re(P));return B(z,F,V,q)}function M(z,F,V,q){var A=F,W=A.target,K=W.translateToOriginPoint(W.getCenterPoint(),A.originX,A.originY);if(W.lockRotation)return!1;var Z=Math.atan2(A.ey-K.y,A.ex-K.x),Y=Math.atan2(q-K.y,V-K.x),B=p(Y-Z+A.theta),ie=!0;if(W.snapAngle>0){var ce=W.snapAngle,ue=W.snapThreshold||ce,we=Math.ceil(B/ce)*ce,ge=Math.floor(B/ce)*ce;Math.abs(B-ge)<ue?B=ge:Math.abs(B-we)<ue&&(B=we)}return B<0&&(B=360+B),B%=360,ie=W.angle!==B,W.angle=B,ie}function k(z,F,V,q,A){A=A||{};var W=F.target,K=W.lockScalingX,Z=W.lockScalingY,Y=A.by,B,ie,ce,ue,we=C(z,W),ge=O(W,Y,we),Be,Oe,en=F.gestureScale;if(ge)return!1;if(en)ie=F.scaleX*en,ce=F.scaleY*en;else{if(B=le(F,F.originX,F.originY,V,q),Be=Y!=="y"?v(B.x):1,Oe=Y!=="x"?v(B.y):1,F.signX||(F.signX=Be),F.signY||(F.signY=Oe),W.lockScalingFlip&&(F.signX!==Be||F.signY!==Oe))return!1;if(ue=W._getTransformedDimensions(),we&&!Y){var Kn=Math.abs(B.x)+Math.abs(B.y),vt=F.original,gh=Math.abs(ue.x*vt.scaleX/W.scaleX)+Math.abs(ue.y*vt.scaleY/W.scaleY),ko=Kn/gh;ie=vt.scaleX*ko,ce=vt.scaleY*ko}else ie=Math.abs(B.x*W.scaleX/ue.x),ce=Math.abs(B.y*W.scaleY/ue.y);T(F)&&(ie*=2,ce*=2),F.signX!==Be&&Y!=="y"&&(F.originX=g[F.originX],ie*=-1,F.signX=Be),F.signY!==Oe&&Y!=="x"&&(F.originY=g[F.originY],ce*=-1,F.signY=Oe)}var ph=W.scaleX,mh=W.scaleY;return Y?(Y==="x"&&W.set("scaleX",ie),Y==="y"&&W.set("scaleY",ce)):(!K&&W.set("scaleX",ie),!Z&&W.set("scaleY",ce)),ph!==W.scaleX||mh!==W.scaleY}function L(z,F,V,q){return k(z,F,V,q)}function R(z,F,V,q){return k(z,F,V,q,{by:"x"})}function $(z,F,V,q){return k(z,F,V,q,{by:"y"})}function E(z,F,V,q){return z[F.target.canvas.altActionKey]?r.skewHandlerX(z,F,V,q):r.scalingY(z,F,V,q)}function I(z,F,V,q){return z[F.target.canvas.altActionKey]?r.skewHandlerY(z,F,V,q):r.scalingX(z,F,V,q)}function H(z,F,V,q){var A=F.target,W=le(F,F.originX,F.originY,V,q),K=A.strokeWidth/(A.strokeUniform?A.scaleX:1),Z=T(F)?2:1,Y=A.width,B=Math.abs(W.x*Z/A.scaleX)-K;return A.set("width",Math.max(B,0)),Y!==B}function Q(z,F,V,q){var A=F.target,W=V-F.offsetX,K=q-F.offsetY,Z=!A.get("lockMovementX")&&A.left!==W,Y=!A.get("lockMovementY")&&A.top!==K;return Z&&A.set("left",W),Y&&A.set("top",K),(Z||Y)&&S("moving",ne(z,F,V,q)),Z||Y}r.scaleCursorStyleHandler=N,r.skewCursorStyleHandler=U,r.scaleSkewCursorStyleHandler=J,r.rotationWithSnapping=ae("rotating",re(M)),r.scalingEqually=ae("scaling",re(L)),r.scalingX=ae("scaling",re(R)),r.scalingY=ae("scaling",re($)),r.scalingYOrSkewingX=E,r.scalingXOrSkewingY=I,r.changeWidth=ae("resizing",re(H)),r.skewHandlerX=j,r.skewHandlerY=X,r.dragHandler=Q,r.scaleOrSkewActionName=te,r.rotationStyleHandler=se,r.fireEvent=S,r.wrapWithFixedAnchor=re,r.wrapWithFireEvent=ae,r.getLocalPoint=le,s.controlsUtils=r}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.degreesToRadians,f=s.controlsUtils;function r(i,l,d,o,g){o=o||{};var p=this.sizeX||o.cornerSize||g.cornerSize,v=this.sizeY||o.cornerSize||g.cornerSize,x=typeof o.transparentCorners<"u"?o.transparentCorners:g.transparentCorners,S=x?"stroke":"fill",C=!x&&(o.cornerStrokeColor||g.cornerStrokeColor),T=l,O=d,N;i.save(),i.fillStyle=o.cornerColor||g.cornerColor,i.strokeStyle=o.cornerStrokeColor||g.cornerStrokeColor,p>v?(N=p,i.scale(1,v/p),O=d*p/v):v>p?(N=v,i.scale(p/v,1),T=l*v/p):N=p,i.lineWidth=1,i.beginPath(),i.arc(T,O,N/2,0,2*Math.PI,!1),i[S](),C&&i.stroke(),i.restore()}function a(i,l,d,o,g){o=o||{};var p=this.sizeX||o.cornerSize||g.cornerSize,v=this.sizeY||o.cornerSize||g.cornerSize,x=typeof o.transparentCorners<"u"?o.transparentCorners:g.transparentCorners,S=x?"stroke":"fill",C=!x&&(o.cornerStrokeColor||g.cornerStrokeColor),T=p/2,O=v/2;i.save(),i.fillStyle=o.cornerColor||g.cornerColor,i.strokeStyle=o.cornerStrokeColor||g.cornerStrokeColor,i.lineWidth=1,i.translate(l,d),i.rotate(u(g.angle)),i[S+"Rect"](-T,-O,p,v),C&&i.strokeRect(-T,-O,p,v),i.restore()}f.renderCircleControl=r,f.renderSquareControl=a}(t),function(h){var s=h.fabric||(h.fabric={});function u(f){for(var r in f)this[r]=f[r]}s.Control=u,s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(f,r){return r.cursorStyle},getActionName:function(f,r){return r.actionName},getVisibility:function(f,r){var a=f._controlsVisibility;return a&&typeof a[r]<"u"?a[r]:this.visible},setVisibility:function(f){this.visible=f},positionHandler:function(f,r){var a=s.util.transformPoint({x:this.x*f.x+this.offsetX,y:this.y*f.y+this.offsetY},r);return a},calcCornerCoords:function(f,r,a,i,l){var d,o,g,p,v=l?this.touchSizeX:this.sizeX,x=l?this.touchSizeY:this.sizeY;if(v&&x&&v!==x){var S=Math.atan2(x,v),C=Math.sqrt(v*v+x*x)/2,T=S-s.util.degreesToRadians(f),O=Math.PI/2-S-s.util.degreesToRadians(f);d=C*s.util.cos(T),o=C*s.util.sin(T),g=C*s.util.cos(O),p=C*s.util.sin(O)}else{var N=v&&x?v:r;C=N*.7071067812;var T=s.util.degreesToRadians(45-f);d=g=C*s.util.cos(T),o=p=C*s.util.sin(T)}return{tl:{x:a-p,y:i-g},tr:{x:a+d,y:i-o},bl:{x:a-d,y:i+o},br:{x:a+p,y:i+g}}},render:function(f,r,a,i,l){switch(i=i||{},i.cornerStyle||l.cornerStyle){case"circle":s.controlsUtils.renderCircleControl.call(this,f,r,a,i,l);break;default:s.controlsUtils.renderSquareControl.call(this,f,r,a,i,l)}}}}(t),function(){function h(a,i){var l=a.getAttribute("style"),d=a.getAttribute("offset")||0,o,g,p,v;if(d=parseFloat(d)/(/%$/.test(d)?100:1),d=d<0?0:d>1?1:d,l){var x=l.split(/\s*;\s*/);for(x[x.length-1]===""&&x.pop(),v=x.length;v--;){var S=x[v].split(/\s*:\s*/),C=S[0].trim(),T=S[1].trim();C==="stop-color"?o=T:C==="stop-opacity"&&(p=T)}}return o||(o=a.getAttribute("stop-color")||"rgb(0,0,0)"),p||(p=a.getAttribute("stop-opacity")),o=new e.Color(o),g=o.getAlpha(),p=isNaN(parseFloat(p))?1:parseFloat(p),p*=g*i,{offset:d,color:o.toRgb(),opacity:p}}function s(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function u(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}var f=e.util.object.clone;e.Gradient=e.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var i,l=this;Object.keys(a).forEach(function(d){l[d]=a[d]}),this.id?this.id+="_"+e.Object.__uid++:this.id=e.Object.__uid++,i={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(i.r1=a.coords.r1||0,i.r2=a.coords.r2||0),this.coords=i,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var i in a){var l=new e.Color(a[i]);this.colorStops.push({offset:parseFloat(i),color:l.toRgb(),opacity:l.getAlpha()})}return this},toObject:function(a){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return e.util.populateWithProperties(this,i,a),i},toSVG:function(a,g){var l=f(this.coords,!0),d,o,g=g||{},p,v,x=f(this.colorStops,!0),S=l.r1>l.r2,C=this.gradientTransform?this.gradientTransform.concat():e.iMatrix.concat(),T=-this.offsetX,O=-this.offsetY,N=!!g.additionalTransform,U=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(x.sort(function(re,ae){return re.offset-ae.offset}),U==="objectBoundingBox"?(T/=a.width,O/=a.height):(T+=a.width/2,O+=a.height/2),a.type==="path"&&this.gradientUnits!=="percentage"&&(T-=a.pathOffset.x,O-=a.pathOffset.y),C[4]-=T,C[5]-=O,v='id="SVGID_'+this.id+'" gradientUnits="'+U+'"',v+=' gradientTransform="'+(N?g.additionalTransform+" ":"")+e.util.matrixToSVG(C)+'" ',this.type==="linear"?p=["<linearGradient ",v,' x1="',l.x1,'" y1="',l.y1,'" x2="',l.x2,'" y2="',l.y2,`">
`]:this.type==="radial"&&(p=["<radialGradient ",v,' cx="',S?l.x1:l.x2,'" cy="',S?l.y1:l.y2,'" r="',S?l.r1:l.r2,'" fx="',S?l.x2:l.x1,'" fy="',S?l.y2:l.y1,`">
`]),this.type==="radial"){if(S)for(x=x.concat(),x.reverse(),d=0,o=x.length;d<o;d++)x[d].offset=1-x[d].offset;var J=Math.min(l.r1,l.r2);if(J>0){var te=Math.max(l.r1,l.r2),se=J/te;for(d=0,o=x.length;d<o;d++)x[d].offset+=se*(1-x[d].offset)}}for(d=0,o=x.length;d<o;d++){var ne=x[d];p.push("<stop ",'offset="',ne.offset*100+"%",'" style="stop-color:',ne.color,typeof ne.opacity<"u"?";stop-opacity: "+ne.opacity:";",`"/>
`)}return p.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),p.join("")},toLive:function(a){var i,l=e.util.object.clone(this.coords),d,o;if(this.type){for(this.type==="linear"?i=a.createLinearGradient(l.x1,l.y1,l.x2,l.y2):this.type==="radial"&&(i=a.createRadialGradient(l.x1,l.y1,l.r1,l.x2,l.y2,l.r2)),d=0,o=this.colorStops.length;d<o;d++){var g=this.colorStops[d].color,p=this.colorStops[d].opacity,v=this.colorStops[d].offset;typeof p<"u"&&(g=new e.Color(g).setAlpha(p).toRgba()),i.addColorStop(v,g)}return i}}}),e.util.object.extend(e.Gradient,{fromElement:function(a,i,l,d){var o=parseFloat(l)/(/%$/.test(l)?100:1);o=o<0?0:o>1?1:o,isNaN(o)&&(o=1);var g=a.getElementsByTagName("stop"),p,v=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",x=a.getAttribute("gradientTransform")||"",S=[],C,T,O=0,N=0,U;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(p="linear",C=s(a)):(p="radial",C=u(a)),T=g.length;T--;)S.push(h(g[T],o));U=e.parseTransformAttribute(x),r(i,C,d,v),v==="pixels"&&(O=-i.left,N=-i.top);var J=new e.Gradient({id:a.getAttribute("id"),type:p,coords:C,colorStops:S,gradientUnits:v,gradientTransform:U,offsetX:O,offsetY:N});return J}});function r(a,i,l,d){var o,g;Object.keys(i).forEach(function(p){o=i[p],o==="Infinity"?g=1:o==="-Infinity"?g=0:(g=parseFloat(i[p],10),typeof o=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(o)&&(g*=.01,d==="pixels"&&((p==="x1"||p==="x2"||p==="r2")&&(g*=l.viewBoxWidth||l.width),(p==="y1"||p==="y2")&&(g*=l.viewBoxHeight||l.height)))),i[p]=g})}}(),function(){var h=e.util.toFixed;e.Pattern=e.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,u){if(s||(s={}),this.id=e.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string"){u&&u(this);return}else{var f=this;this.source=e.util.createImage(),e.util.loadImage(s.source,function(r,a){f.source=r,u&&u(f,a)},null,this.crossOrigin)}},toObject:function(s){var u=e.Object.NUM_FRACTION_DIGITS,f,r;return typeof this.source.src=="string"?f=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(f=this.source.toDataURL()),r={type:"pattern",source:f,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:h(this.offsetX,u),offsetY:h(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},e.util.populateWithProperties(this,r,s),r},toSVG:function(s){var u=typeof this.source=="function"?this.source():this.source,f=u.width/s.width,r=u.height/s.height,a=this.offsetX/s.width,i=this.offsetY/s.height,l="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,i&&(r+=Math.abs(i))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(f=1,a&&(f+=Math.abs(a))),u.src?l=u.src:u.toDataURL&&(l=u.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+i+'" width="'+f+'" height="'+r+`">
<image x="0" y="0" width="`+u.width+'" height="'+u.height+'" xlink:href="'+l+`"></image>
</pattern>
`},setOptions:function(s){for(var u in s)this[u]=s[u]},toLive:function(s){var u=this.source;return!u||typeof u.src<"u"&&(!u.complete||u.naturalWidth===0||u.naturalHeight===0)?"":s.createPattern(u,this.repeat)}})}(),function(h){var s=h.fabric||(h.fabric={}),u=s.util.toFixed;if(s.Shadow){s.warn("fabric.Shadow is already defined.");return}s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(f){typeof f=="string"&&(f=this._parseShadow(f));for(var r in f)this[r]=f[r];this.id=s.Object.__uid++},_parseShadow:function(f){var r=f.trim(),a=s.Shadow.reOffsetsAndBlur.exec(r)||[],i=r.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseFloat(a[1],10)||0,offsetY:parseFloat(a[2],10)||0,blur:parseFloat(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(f){var r=40,a=40,i=s.Object.NUM_FRACTION_DIGITS,l=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-f.angle)),d=20,o=new s.Color(this.color);return f.width&&f.height&&(r=u((Math.abs(l.x)+this.blur)/f.width,i)*100+d,a=u((Math.abs(l.y)+this.blur)/f.height,i)*100+d),f.flipX&&(l.x*=-1),f.flipY&&(l.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+u(this.blur?this.blur/2:0,i)+`"></feGaussianBlur>
	<feOffset dx="`+u(l.x,i)+'" dy="'+u(l.y,i)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+o.toRgb()+'" flood-opacity="'+o.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var f={},r=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(a){this[a]!==r[a]&&(f[a]=this[a])},this),f}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(t),function(){if(e.StaticCanvas){e.warn("fabric.StaticCanvas is already defined.");return}var h=e.util.object.extend,s=e.util.getElementOffset,u=e.util.removeFromArray,f=e.util.toFixed,r=e.util.transformPoint,a=e.util.invertTransform,i=e.util.getNodeCanvas,l=e.util.createCanvasElement,d=new Error("Could not initialize `canvas` element");e.StaticCanvas=e.util.createClass(e.CommonMethods,{initialize:function(o,g){g||(g={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(o,g)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:e.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(o,g){var p=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(o),this._initOptions(g),this.interactive||this._initRetinaScaling(),g.overlayImage&&this.setOverlayImage(g.overlayImage,p),g.backgroundImage&&this.setBackgroundImage(g.backgroundImage,p),g.backgroundColor&&this.setBackgroundColor(g.backgroundColor,p),g.overlayColor&&this.setOverlayColor(g.overlayColor,p),this.calcOffset()},_isRetinaScaling:function(){return e.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,e.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var o=e.devicePixelRatio;this.__initRetinaScaling(o,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(o,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(o,g,p){g.setAttribute("width",this.width*o),g.setAttribute("height",this.height*o),p.scale(o,o)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(o,g,p){return this.__setBgOverlayImage("overlayImage",o,g,p)},setBackgroundImage:function(o,g,p){return this.__setBgOverlayImage("backgroundImage",o,g,p)},setOverlayColor:function(o,g){return this.__setBgOverlayColor("overlayColor",o,g)},setBackgroundColor:function(o,g){return this.__setBgOverlayColor("backgroundColor",o,g)},__setBgOverlayImage:function(o,g,p,v){return typeof g=="string"?e.util.loadImage(g,function(x,S){if(x){var C=new e.Image(x,v);this[o]=C,C.canvas=this}p&&p(x,S)},this,v&&v.crossOrigin):(v&&g.setOptions(v),this[o]=g,g&&(g.canvas=this),p&&p(g,!1)),this},__setBgOverlayColor:function(o,g,p){return this[o]=g,this._initGradient(g,o),this._initPattern(g,o,p),this},_createCanvasElement:function(){var o=l();if(!o||(o.style||(o.style={}),typeof o.getContext>"u"))throw d;return o},_initOptions:function(o){var g=this.lowerCanvasEl;this._setOptions(o),this.width=this.width||parseInt(g.width,10)||0,this.height=this.height||parseInt(g.height,10)||0,this.lowerCanvasEl.style&&(g.width=this.width,g.height=this.height,g.style.width=this.width+"px",g.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(o){o&&o.getContext?this.lowerCanvasEl=o:this.lowerCanvasEl=e.util.getById(o)||this._createCanvasElement(),e.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(o,g){return this.setDimensions({width:o},g)},setHeight:function(o,g){return this.setDimensions({height:o},g)},setDimensions:function(o,g){var p;g=g||{};for(var v in o)p=o[v],g.cssOnly||(this._setBackstoreDimension(v,o[v]),p+="px",this.hasLostContext=!0),g.backstoreOnly||this._setCssDimension(v,p);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),g.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(o,g){return this.lowerCanvasEl[o]=g,this.upperCanvasEl&&(this.upperCanvasEl[o]=g),this.cacheCanvasEl&&(this.cacheCanvasEl[o]=g),this[o]=g,this},_setCssDimension:function(o,g){return this.lowerCanvasEl.style[o]=g,this.upperCanvasEl&&(this.upperCanvasEl.style[o]=g),this.wrapperEl&&(this.wrapperEl.style[o]=g),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(o){var g=this._activeObject,p=this.backgroundImage,v=this.overlayImage,x,S,C;for(this.viewportTransform=o,S=0,C=this._objects.length;S<C;S++)x=this._objects[S],x.group||x.setCoords(!0);return g&&g.setCoords(),p&&p.setCoords(!0),v&&v.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(o,g){var p=o,v=this.viewportTransform.slice(0);o=r(o,a(this.viewportTransform)),v[0]=g,v[3]=g;var x=r(o,v);return v[4]+=p.x-x.x,v[5]+=p.y-x.y,this.setViewportTransform(v)},setZoom:function(o){return this.zoomToPoint(new e.Point(0,0),o),this},absolutePan:function(o){var g=this.viewportTransform.slice(0);return g[4]=-o.x,g[5]=-o.y,this.setViewportTransform(g)},relativePan:function(o){return this.absolutePan(new e.Point(-o.x-this.viewportTransform[4],-o.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(o){this.stateful&&o.setupState(),o._set("canvas",this),o.setCoords(),this.fire("object:added",{target:o}),o.fire("added")},_onObjectRemoved:function(o){this.fire("object:removed",{target:o}),o.fire("removed"),delete o.canvas},clearContext:function(o){return o.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var o=this.contextContainer;return this.renderCanvas(o,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=e.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var o={},g=this.width,p=this.height,v=a(this.viewportTransform);return o.tl=r({x:0,y:0},v),o.br=r({x:g,y:p},v),o.tr=new e.Point(o.br.x,o.tl.y),o.bl=new e.Point(o.tl.x,o.br.y),this.vptCoords=o,o},cancelRequestedRender:function(){this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(o,g){var p=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(o),e.util.setImageSmoothing(o,this.imageSmoothingEnabled),this.fire("before:render",{ctx:o}),this._renderBackground(o),o.save(),o.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._renderObjects(o,g),o.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(o),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(o)),this._renderOverlay(o),this.controlsAboveOverlay&&this.interactive&&this.drawControls(o),this.fire("after:render",{ctx:o})},drawClipPathOnCanvas:function(o){var g=this.viewportTransform,p=this.clipPath;o.save(),o.transform(g[0],g[1],g[2],g[3],g[4],g[5]),o.globalCompositeOperation="destination-in",p.transform(o),o.scale(1/p.zoomX,1/p.zoomY),o.drawImage(p._cacheCanvas,-p.cacheTranslationX,-p.cacheTranslationY),o.restore()},_renderObjects:function(o,g){var p,v;for(p=0,v=g.length;p<v;++p)g[p]&&g[p].render(o)},_renderBackgroundOrOverlay:function(o,g){var p=this[g+"Color"],v=this[g+"Image"],x=this.viewportTransform,S=this[g+"Vpt"];if(!(!p&&!v)){if(p){o.save(),o.beginPath(),o.moveTo(0,0),o.lineTo(this.width,0),o.lineTo(this.width,this.height),o.lineTo(0,this.height),o.closePath(),o.fillStyle=p.toLive?p.toLive(o,this):p,S&&o.transform(x[0],x[1],x[2],x[3],x[4],x[5]),o.transform(1,0,0,1,p.offsetX||0,p.offsetY||0);var C=p.gradientTransform||p.patternTransform;C&&o.transform(C[0],C[1],C[2],C[3],C[4],C[5]),o.fill(),o.restore()}if(v){o.save();var T=this.skipOffscreen;this.skipOffscreen=S,S&&o.transform(x[0],x[1],x[2],x[3],x[4],x[5]),v.render(o),this.skipOffscreen=T,o.restore()}}},_renderBackground:function(o){this._renderBackgroundOrOverlay(o,"background")},_renderOverlay:function(o){this._renderBackgroundOrOverlay(o,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new e.Point(this.width/2,this.height/2)},centerObjectH:function(o){return this._centerObject(o,new e.Point(this.getCenterPoint().x,o.getCenterPoint().y))},centerObjectV:function(o){return this._centerObject(o,new e.Point(o.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(o){var g=this.getCenterPoint();return this._centerObject(o,g)},viewportCenterObject:function(o){var g=this.getVpCenter();return this._centerObject(o,g)},viewportCenterObjectH:function(o){var g=this.getVpCenter();return this._centerObject(o,new e.Point(g.x,o.getCenterPoint().y)),this},viewportCenterObjectV:function(o){var g=this.getVpCenter();return this._centerObject(o,new e.Point(o.getCenterPoint().x,g.y))},getVpCenter:function(){var o=this.getCenterPoint(),g=a(this.viewportTransform);return r(o,g)},_centerObject:function(o,g){return o.setPositionByOrigin(g,"center","center"),o.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(o){return this.toDatalessObject(o)},toObject:function(o){return this._toObjectMethod("toObject",o)},toDatalessObject:function(o){return this._toObjectMethod("toDatalessObject",o)},_toObjectMethod:function(o,g){var p=this.clipPath,v={version:e.version,objects:this._toObjects(o,g)};return p&&!p.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,o,g)),h(v,this.__serializeBgOverlay(o,g)),e.util.populateWithProperties(this,v,g),v},_toObjects:function(o,g){return this._objects.filter(function(p){return!p.excludeFromExport}).map(function(p){return this._toObject(p,o,g)},this)},_toObject:function(o,g,p){var v;this.includeDefaultValues||(v=o.includeDefaultValues,o.includeDefaultValues=!1);var x=o[g](p);return this.includeDefaultValues||(o.includeDefaultValues=v),x},__serializeBgOverlay:function(o,g){var p={},v=this.backgroundImage,x=this.overlayImage,S=this.backgroundColor,C=this.overlayColor;return S&&S.toObject?S.excludeFromExport||(p.background=S.toObject(g)):S&&(p.background=S),C&&C.toObject?C.excludeFromExport||(p.overlay=C.toObject(g)):C&&(p.overlay=C),v&&!v.excludeFromExport&&(p.backgroundImage=this._toObject(v,o,g)),x&&!x.excludeFromExport&&(p.overlayImage=this._toObject(x,o,g)),p},svgViewportTransformation:!0,toSVG:function(o,g){o||(o={}),o.reviver=g;var p=[];return this._setSVGPreamble(p,o),this._setSVGHeader(p,o),this.clipPath&&p.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(p,"background"),this._setSVGBgOverlayImage(p,"backgroundImage",g),this._setSVGObjects(p,g),this.clipPath&&p.push(`</g>
`),this._setSVGBgOverlayColor(p,"overlay"),this._setSVGBgOverlayImage(p,"overlayImage",g),p.push("</svg>"),p.join("")},_setSVGPreamble:function(o,g){g.suppressPreamble||o.push('<?xml version="1.0" encoding="',g.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(o,g){var p=g.width||this.width,v=g.height||this.height,x,S='viewBox="0 0 '+this.width+" "+this.height+'" ',C=e.Object.NUM_FRACTION_DIGITS;g.viewBox?S='viewBox="'+g.viewBox.x+" "+g.viewBox.y+" "+g.viewBox.width+" "+g.viewBox.height+'" ':this.svgViewportTransformation&&(x=this.viewportTransform,S='viewBox="'+f(-x[4]/x[0],C)+" "+f(-x[5]/x[3],C)+" "+f(this.width/x[0],C)+" "+f(this.height/x[3],C)+'" '),o.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',p,'" ','height="',v,'" ',S,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",e.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(g),`</defs>
`)},createSVGClipPathMarkup:function(o){var g=this.clipPath;return g?(g.clipPathId="CLIPPATH_"+e.Object.__uid++,'<clipPath id="'+g.clipPathId+`" >
`+this.clipPath.toClipPathSVG(o.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var o=this,g=["background","overlay"].map(function(p){var v=o[p+"Color"];if(v&&v.toLive){var x=o[p+"Vpt"],S=o.viewportTransform,C={width:o.width/(x?S[0]:1),height:o.height/(x?S[3]:1)};return v.toSVG(C,{additionalTransform:x?e.util.matrixToSVG(S):""})}});return g.join("")},createSVGFontFacesMarkup:function(){var o="",g={},p,v,x,S,C,T,O,N,U,J=e.fontPaths,te=[];for(this._objects.forEach(function ne(re){te.push(re),re._objects&&re._objects.forEach(ne)}),N=0,U=te.length;N<U;N++)if(p=te[N],v=p.fontFamily,!(p.type.indexOf("text")===-1||g[v]||!J[v])&&(g[v]=!0,!!p.styles)){x=p.styles;for(C in x){S=x[C];for(O in S)T=S[O],v=T.fontFamily,!g[v]&&J[v]&&(g[v]=!0)}}for(var se in g)o+=[`		@font-face {
`,"			font-family: '",se,`';
`,"			src: url('",J[se],`');
`,`		}
`].join("");return o&&(o=['	<style type="text/css">',`<![CDATA[
`,o,"]]>",`</style>
`].join("")),o},_setSVGObjects:function(o,g){var p,v,x,S=this._objects;for(v=0,x=S.length;v<x;v++)p=S[v],!p.excludeFromExport&&this._setSVGObject(o,p,g)},_setSVGObject:function(o,g,p){o.push(g.toSVG(p))},_setSVGBgOverlayImage:function(o,g,p){this[g]&&!this[g].excludeFromExport&&this[g].toSVG&&o.push(this[g].toSVG(p))},_setSVGBgOverlayColor:function(o,g){var p=this[g+"Color"],v=this.viewportTransform,x=this.width,S=this.height;if(p)if(p.toLive){var C=p.repeat,T=e.util.invertTransform(v),O=this[g+"Vpt"],N=O?e.util.matrixToSVG(T):"";o.push('<rect transform="'+N+" translate(",x/2,",",S/2,')"',' x="',p.offsetX-x/2,'" y="',p.offsetY-S/2,'" ','width="',C==="repeat-y"||C==="no-repeat"?p.source.width:x,'" height="',C==="repeat-x"||C==="no-repeat"?p.source.height:S,'" fill="url(#SVGID_'+p.id+')"',`></rect>
`)}else o.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',p,'"',`></rect>
`)},sendToBack:function(o){if(!o)return this;var g=this._activeObject,p,v,x;if(o===g&&o.type==="activeSelection")for(x=g._objects,p=x.length;p--;)v=x[p],u(this._objects,v),this._objects.unshift(v);else u(this._objects,o),this._objects.unshift(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(o){if(!o)return this;var g=this._activeObject,p,v,x;if(o===g&&o.type==="activeSelection")for(x=g._objects,p=0;p<x.length;p++)v=x[p],u(this._objects,v),this._objects.push(v);else u(this._objects,o),this._objects.push(o);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(o,g){if(!o)return this;var p=this._activeObject,v,x,S,C,T,O=0;if(o===p&&o.type==="activeSelection")for(T=p._objects,v=0;v<T.length;v++)x=T[v],S=this._objects.indexOf(x),S>0+O&&(C=S-1,u(this._objects,x),this._objects.splice(C,0,x)),O++;else S=this._objects.indexOf(o),S!==0&&(C=this._findNewLowerIndex(o,S,g),u(this._objects,o),this._objects.splice(C,0,o));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(o,g,p){var v,x;if(p)for(v=g,x=g-1;x>=0;--x){var S=o.intersectsWithObject(this._objects[x])||o.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(o);if(S){v=x;break}}else v=g-1;return v},bringForward:function(o,g){if(!o)return this;var p=this._activeObject,v,x,S,C,T,O=0;if(o===p&&o.type==="activeSelection")for(T=p._objects,v=T.length;v--;)x=T[v],S=this._objects.indexOf(x),S<this._objects.length-1-O&&(C=S+1,u(this._objects,x),this._objects.splice(C,0,x)),O++;else S=this._objects.indexOf(o),S!==this._objects.length-1&&(C=this._findNewUpperIndex(o,S,g),u(this._objects,o),this._objects.splice(C,0,o));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(o,g,p){var v,x,S;if(p)for(v=g,x=g+1,S=this._objects.length;x<S;++x){var C=o.intersectsWithObject(this._objects[x])||o.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(o);if(C){v=x;break}}else v=g+1;return v},moveTo:function(o,g){return u(this._objects,o),this._objects.splice(g,0,o),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(o){o.dispose&&o.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),e.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),e.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),h(e.StaticCanvas.prototype,e.Observable),h(e.StaticCanvas.prototype,e.Collection),h(e.StaticCanvas.prototype,e.DataURLExporter),h(e.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(o){var g=l();if(!g||!g.getContext)return null;var p=g.getContext("2d");if(!p)return null;switch(o){case"setLineDash":return typeof p.setLineDash<"u";default:return null}}}),e.StaticCanvas.prototype.toJSON=e.StaticCanvas.prototype.toObject,e.isLikelyNode&&(e.StaticCanvas.prototype.createPNGStream=function(){var o=i(this.lowerCanvasEl);return o&&o.createPNGStream()},e.StaticCanvas.prototype.createJPEGStream=function(o){var g=i(this.lowerCanvasEl);return g&&g.createJPEGStream(o)})}(),e.BaseBrush=e.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(h){h.strokeStyle=this.color,h.lineWidth=this.width,h.lineCap=this.strokeLineCap,h.miterLimit=this.strokeMiterLimit,h.lineJoin=this.strokeLineJoin,h.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(h){var s=this.canvas.viewportTransform;h.save(),h.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var h=this.canvas,s=this.shadow,u=h.contextTop,f=h.getZoom();h&&h._isRetinaScaling()&&(f*=e.devicePixelRatio),u.shadowColor=s.color,u.shadowBlur=s.blur*f,u.shadowOffsetX=s.offsetX*f,u.shadowOffsetY=s.offsetY*f}},needsFullRender:function(){var h=new e.Color(this.color);return h.getAlpha()<1||!!this.shadow},_resetShadow:function(){var h=this.canvas.contextTop;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_isOutSideCanvas:function(h){return h.x<0||h.x>this.canvas.getWidth()||h.y<0||h.y>this.canvas.getHeight()}}),function(){e.PencilBrush=e.util.createClass(e.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(h){this.canvas=h,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(h,s,u){var f=s.midPointFrom(u);return h.quadraticCurveTo(s.x,s.y,f.x,f.y),f},onMouseDown:function(h,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(h),this._captureDrawingPath(h),this._render())},onMouseMove:function(h,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h))&&this._captureDrawingPath(h)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var u=this._points,f=u.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,u[f-2],u[f-1],!0),r.stroke(),r.restore()}},onMouseUp:function(h){return this.canvas._isMainEvent(h.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(h){var s=new e.Point(h.x,h.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(h){return this._points.length>1&&h.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(h),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(h){var s=new e.Point(h.x,h.y);return this._addPoint(s)},_render:function(h){var s,u,f=this._points[0],r=this._points[1];if(h=h||this.canvas.contextTop,this._saveAndTransform(h),h.beginPath(),this._points.length===2&&f.x===r.x&&f.y===r.y){var a=this.width/1e3;f=new e.Point(f.x,f.y),r=new e.Point(r.x,r.y),f.x-=a,r.x+=a}for(h.moveTo(f.x,f.y),s=1,u=this._points.length;s<u;s++)this._drawSegment(h,f,r),f=this._points[s],r=this._points[s+1];h.lineTo(f.x,f.y),h.stroke(),h.restore()},convertPointsToSVGPath:function(h){var s=this.width/1e3;return e.util.getSmoothPathFromPoints(h,s)},_isEmptySVGPath:function(h){var s=e.util.joinPath(h);return s==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(h){var s=new e.Path(h,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new e.Shadow(this.shadow)),s},decimatePoints:function(h,s){if(h.length<=2)return h;var u=this.canvas.getZoom(),f=Math.pow(s/u,2),r,a=h.length-1,i=h[0],l=[i],d;for(r=1;r<a-1;r++)d=Math.pow(i.x-h[r].x,2)+Math.pow(i.y-h[r].y,2),d>=f&&(i=h[r],l.push(i));return l.push(h[a]),l},_finalizeAndAddPath:function(){var h=this.canvas.contextTop;h.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s)){this.canvas.requestRenderAll();return}var u=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.requestRenderAll(),u.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:u})}})}(),e.CircleBrush=e.util.createClass(e.BaseBrush,{width:10,initialize:function(h){this.canvas=h,this.points=[]},drawDot:function(h){var s=this.addPoint(h),u=this.canvas.contextTop;this._saveAndTransform(u),this.dot(u,s),u.restore()},dot:function(h,s){h.fillStyle=s.fill,h.beginPath(),h.arc(s.x,s.y,s.radius,0,Math.PI*2,!1),h.closePath(),h.fill()},onMouseDown:function(h){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(h)},_render:function(){var h=this.canvas.contextTop,s,u,f=this.points;for(this._saveAndTransform(h),s=0,u=f.length;s<u;s++)this.dot(h,f[s]);h.restore()},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(h),this._render()):this.drawDot(h))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove,s,u;this.canvas.renderOnAddRemove=!1;var f=[];for(s=0,u=this.points.length;s<u;s++){var r=this.points[s],a=new e.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(a.shadow=new e.Shadow(this.shadow)),f.push(a)}var i=new e.Group(f);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},addPoint:function(h){var s=new e.Point(h.x,h.y),u=e.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,f=new e.Color(this.color).setAlpha(e.util.getRandomInt(0,100)/100).toRgba();return s.radius=u,s.fill=f,this.points.push(s),s}}),e.SprayBrush=e.util.createClass(e.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(h){this.canvas=h,this.sprayChunks=[]},onMouseDown:function(h){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(h),this.render(this.sprayChunkPoints)},onMouseMove:function(h){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(h)||(this.addSprayChunk(h),this.render(this.sprayChunkPoints))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],u=0,f=this.sprayChunks.length;u<f;u++)for(var r=this.sprayChunks[u],a=0,i=r.length;a<i;a++){var l=new e.Rect({width:r[a].width,height:r[a].width,left:r[a].x+1,top:r[a].y+1,originX:"center",originY:"center",fill:this.color});s.push(l)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var d=new e.Group(s);this.shadow&&d.set("shadow",new e.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},_getOptimizedRects:function(h){var s={},u,f,r;for(f=0,r=h.length;f<r;f++)u=h[f].left+""+h[f].top,s[u]||(s[u]=h[f]);var a=[];for(u in s)a.push(s[u]);return a},render:function(h){var s=this.canvas.contextTop,u,f;for(s.fillStyle=this.color,this._saveAndTransform(s),u=0,f=h.length;u<f;u++){var r=h[u];typeof r.opacity<"u"&&(s.globalAlpha=r.opacity),s.fillRect(r.x,r.y,r.width,r.width)}s.restore()},_render:function(){var h=this.canvas.contextTop,s,u;for(h.fillStyle=this.color,this._saveAndTransform(h),s=0,u=this.sprayChunks.length;s<u;s++)this.render(this.sprayChunks[s]);h.restore()},addSprayChunk:function(h){this.sprayChunkPoints=[];var s,u,f,r=this.width/2,a;for(a=0;a<this.density;a++){s=e.util.getRandomInt(h.x-r,h.x+r),u=e.util.getRandomInt(h.y-r,h.y+r),this.dotWidthVariance?f=e.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):f=this.dotWidth;var i=new e.Point(s,u);i.width=f,this.randomOpacity&&(i.opacity=e.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),e.PatternBrush=e.util.createClass(e.PencilBrush,{getPatternSrc:function(){var h=20,s=5,u=e.util.createCanvasElement(),f=u.getContext("2d");return u.width=u.height=h+s,f.fillStyle=this.color,f.beginPath(),f.arc(h/2,h/2,h/2,0,Math.PI*2,!1),f.closePath(),f.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(h){return h.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(h){this.callSuper("_setBrushStyles",h),h.strokeStyle=this.getPattern(h)},createPath:function(h){var s=this.callSuper("createPath",h),u=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new e.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-u.x,offsetY:-u.y}),s}}),function(){var h=e.util.getPointer,s=e.util.degreesToRadians,u=e.util.isTouchEvent;e.Canvas=e.util.createClass(e.StaticCanvas,{initialize:function(r,a){a||(a={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,a),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=e.PencilBrush&&new e.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),a,i,l;if(r.length>0&&!this.preserveObjectStacking){i=[],l=[];for(var d=0,o=this._objects.length;d<o;d++)a=this._objects[d],r.indexOf(a)===-1?i.push(a):l.push(a);r.length>1&&(this._activeObject._objects=l),i.push.apply(i,l)}else i=this._objects;return i},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,a){var i=r.calcTransformMatrix(),l=e.util.invertTransform(i),d=this.restorePointerVpt(a);return e.util.transformPoint(d,l)},isTargetTransparent:function(r,a,i){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var l=this._normalizePointer(r,{x:a,y:i}),d=Math.max(r.cacheTranslationX+l.x*r.zoomX,0),o=Math.max(r.cacheTranslationY+l.y*r.zoomY,0),x=e.util.isTransparent(r._cacheContext,Math.round(d),Math.round(o),this.targetFindTolerance);return x}var g=this.contextCache,p=r.selectionBackgroundColor,v=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(g),g.save(),g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),r.render(g),g.restore(),r.selectionBackgroundColor=p;var x=e.util.isTransparent(g,a,i,this.targetFindTolerance);return x},_isSelectionKeyPressed:function(r){var a=!1;return Array.isArray(this.selectionKey)?a=!!this.selectionKey.find(function(i){return r[i]===!0}):a=r[this.selectionKey],a},_shouldClearSelection:function(r,a){var i=this.getActiveObjects(),l=this._activeObject;return!a||a&&l&&i.length>1&&i.indexOf(a)===-1&&l!==a&&!this._isSelectionKeyPressed(r)||a&&!a.evented||a&&!a.selectable&&l&&l!==a},_shouldCenterTransform:function(r,a,i){if(r){var l;return a==="scale"||a==="scaleX"||a==="scaleY"||a==="resizing"?l=this.centeredScaling||r.centeredScaling:a==="rotate"&&(l=this.centeredRotation||r.centeredRotation),l?!i:i}},_getOriginFromCorner:function(r,a){var i={x:r.originX,y:r.originY};return a==="ml"||a==="tl"||a==="bl"?i.x="right":(a==="mr"||a==="tr"||a==="br")&&(i.x="left"),a==="tl"||a==="mt"||a==="tr"?i.y="bottom":(a==="bl"||a==="mb"||a==="br")&&(i.y="top"),i},_getActionFromCorner:function(r,a,i,l){if(!a||!r)return"drag";var d=l.controls[a];return d.getActionName(i,d,l)},_setupCurrentTransform:function(r,a,i){if(a){var l=this.getPointer(r),d=a.__corner,o=a.controls[d],g=i&&d?o.getActionHandler(r,a,o):e.controlsUtils.dragHandler,p=this._getActionFromCorner(i,d,r,a),v=this._getOriginFromCorner(a,d),x=r[this.centeredKey],S={target:a,action:p,actionHandler:g,corner:d,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,offsetX:l.x-a.left,offsetY:l.y-a.top,originX:v.x,originY:v.y,ex:l.x,ey:l.y,lastX:l.x,lastY:l.y,theta:s(a.angle),width:a.width*a.scaleX,shiftKey:r.shiftKey,altKey:x,original:e.util.saveObjectTransform(a)};this._shouldCenterTransform(a,p,x)&&(S.originX="center",S.originY="center"),S.original.originX=v.x,S.original.originY=v.y,this._currentTransform=S,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var a=this._groupSelector,i=new e.Point(a.ex,a.ey),l=e.util.transformPoint(i,this.viewportTransform),d=new e.Point(a.ex+a.left,a.ey+a.top),o=e.util.transformPoint(d,this.viewportTransform),g=Math.min(l.x,o.x),p=Math.min(l.y,o.y),v=Math.max(l.x,o.x),x=Math.max(l.y,o.y),S=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(g,p,v-g,x-p)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,g+=S,p+=S,v-=S,x-=S,e.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(g,p,v-g,x-p))},findTarget:function(r,a){if(!this.skipTargetFind){var i=!0,l=this.getPointer(r,i),d=this._activeObject,o=this.getActiveObjects(),g,p,v=u(r),x=o.length>1&&!a||o.length===1;if(this.targets=[],x&&d._findTargetCorner(l,v)||o.length>1&&!a&&d===this._searchPossibleTargets([d],l))return d;if(o.length===1&&d===this._searchPossibleTargets([d],l))if(this.preserveObjectStacking)g=d,p=this.targets,this.targets=[];else return d;var S=this._searchPossibleTargets(this._objects,l);return r[this.altSelectionKey]&&S&&g&&S!==g&&(S=g,this.targets=p),S}},_checkTarget:function(r,a,i){if(a&&a.visible&&a.evented&&a.containsPoint(r))if((this.perPixelTargetFind||a.perPixelTargetFind)&&!a.isEditing){var l=this.isTargetTransparent(a,i.x,i.y);if(!l)return!0}else return!0},_searchPossibleTargets:function(r,a){for(var i,l=r.length,d;l--;){var o=r[l],g=o.group?this._normalizePointer(o.group,a):a;if(this._checkTarget(g,o,a)){i=r[l],i.subTargetCheck&&i instanceof e.Group&&(d=this._searchPossibleTargets(i._objects,a),d&&this.targets.push(d));break}}return i},restorePointerVpt:function(r){return e.util.transformPoint(r,e.util.invertTransform(this.viewportTransform))},getPointer:function(r,a){if(this._absolutePointer&&!a)return this._absolutePointer;if(this._pointer&&a)return this._pointer;var i=h(r),l=this.upperCanvasEl,d=l.getBoundingClientRect(),o=d.width||0,g=d.height||0,p;(!o||!g)&&("top"in d&&"bottom"in d&&(g=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(o=Math.abs(d.right-d.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,a||(i=this.restorePointerVpt(i));var v=this.getRetinaScaling();return v!==1&&(i.x/=v,i.y/=v),o===0||g===0?p={width:1,height:1}:p={width:l.width/o,height:l.height/g},{x:i.x*p.width,y:i.y*p.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),a=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),e.util.addClass(i,"upper-canvas "+r),this.wrapperEl.appendChild(i),this._copyCanvasStyle(a,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=e.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),e.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),e.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var a=this.width||r.width,i=this.height||r.height;e.util.setStyle(r,{position:"absolute",width:a+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=a,r.height=i,e.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,a){a.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,a){var i=!1,l=this.getActiveObjects(),d=[],o=[];r.forEach(function(g){l.indexOf(g)===-1&&(i=!0,g.fire("deselected",{e:a,target:g}),o.push(g))}),l.forEach(function(g){r.indexOf(g)===-1&&(i=!0,g.fire("selected",{e:a,target:g}),d.push(g))}),r.length>0&&l.length>0?i&&this.fire("selection:updated",{e:a,selected:d,deselected:o}):l.length>0?this.fire("selection:created",{e:a,selected:d}):r.length>0&&this.fire("selection:cleared",{e:a,deselected:o})},setActiveObject:function(r,a){var i=this.getActiveObjects();return this._setActiveObject(r,a),this._fireSelectionEvents(i,a),this},_setActiveObject:function(r,a){return this._activeObject===r||!this._discardActiveObject(a,r)||r.onSelect({e:a})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,a){var i=this._activeObject;if(i){if(i.onDeselect({e:r,object:a}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var a=this.getActiveObjects(),i=this.getActiveObject();return a.length&&this.fire("before:selection:cleared",{target:i,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(a,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(a){e.util.cleanUpJsdomNode(this[a]),this[a]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,e.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var a=this._activeObject;a&&a._renderControls(r)},_toObject:function(r,a,i){var l=this._realizeGroupTransformOnObject(r),d=this.callSuper("_toObject",r,a,i);return this._unwindGroupTransformOnObject(r,l),d},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var a=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],i={};return a.forEach(function(l){i[l]=r[l]}),e.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),i}else return null},_unwindGroupTransformOnObject:function(r,a){a&&r.set(a)},_setSVGObject:function(r,a,i){var l=this._realizeGroupTransformOnObject(a);this.callSuper("_setSVGObject",r,a,i),this._unwindGroupTransformOnObject(a,l)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),e.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var f in e.StaticCanvas)f!=="prototype"&&(e.Canvas[f]=e.StaticCanvas[f])}(),function(){var h=e.util.addListener,s=e.util.removeListener,u=3,f=2,r=1,a={passive:!1};function i(l,d){return l.button&&l.button===d-1}e.util.object.extend(e.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(h,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(l,d){var o=this.upperCanvasEl,g=this._getEventPrefix();l(e.window,"resize",this._onResize),l(o,g+"down",this._onMouseDown),l(o,g+"move",this._onMouseMove,a),l(o,g+"out",this._onMouseOut),l(o,g+"enter",this._onMouseEnter),l(o,"wheel",this._onMouseWheel),l(o,"contextmenu",this._onContextMenu),l(o,"dblclick",this._onDoubleClick),l(o,"dragover",this._onDragOver),l(o,"dragenter",this._onDragEnter),l(o,"dragleave",this._onDragLeave),l(o,"drop",this._onDrop),this.enablePointerEvents||l(o,"touchstart",this._onTouchStart,a),typeof eventjs<"u"&&d in eventjs&&(eventjs[d](o,"gesture",this._onGesture),eventjs[d](o,"drag",this._onDrag),eventjs[d](o,"orientation",this._onOrientationChange),eventjs[d](o,"shake",this._onShake),eventjs[d](o,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var l=this._getEventPrefix();s(e.document,l+"up",this._onMouseUp),s(e.document,"touchend",this._onTouchEnd,a),s(e.document,l+"move",this._onMouseMove,a),s(e.document,"touchmove",this._onMouseMove,a)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(l,d){this.__onTransformGesture&&this.__onTransformGesture(l,d)},_onDrag:function(l,d){this.__onDrag&&this.__onDrag(l,d)},_onMouseWheel:function(l){this.__onMouseWheel(l)},_onMouseOut:function(l){var d=this._hoveredTarget;this.fire("mouse:out",{target:d,e:l}),this._hoveredTarget=null,d&&d.fire("mouseout",{e:l});var o=this;this._hoveredTargets.forEach(function(g){o.fire("mouse:out",{target:g,e:l}),g&&g.fire("mouseout",{e:l})}),this._hoveredTargets=[]},_onMouseEnter:function(l){!this._currentTransform&&!this.findTarget(l)&&(this.fire("mouse:over",{target:null,e:l}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(l,d){this.__onOrientationChange&&this.__onOrientationChange(l,d)},_onShake:function(l,d){this.__onShake&&this.__onShake(l,d)},_onLongPress:function(l,d){this.__onLongPress&&this.__onLongPress(l,d)},_onDragOver:function(l){l.preventDefault();var d=this._simpleEventHandler("dragover",l);this._fireEnterLeaveEvents(d,l)},_onDrop:function(l){return this._simpleEventHandler("drop:before",l),this._simpleEventHandler("drop",l)},_onContextMenu:function(l){return this.stopContextMenu&&(l.stopPropagation(),l.preventDefault()),!1},_onDoubleClick:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"dblclick"),this._resetTransformEventData(l)},getPointerId:function(l){var d=l.changedTouches;return d?d[0]&&d[0].identifier:this.enablePointerEvents?l.pointerId:-1},_isMainEvent:function(l){return l.isPrimary===!0?!0:l.isPrimary===!1?!1:l.type==="touchend"&&l.touches.length===0?!0:l.changedTouches?l.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(l){l.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(l)),this.__onMouseDown(l),this._resetTransformEventData();var d=this.upperCanvasEl,o=this._getEventPrefix();h(e.document,"touchend",this._onTouchEnd,a),h(e.document,"touchmove",this._onMouseMove,a),s(d,o+"down",this._onMouseDown)},_onMouseDown:function(l){this.__onMouseDown(l),this._resetTransformEventData();var d=this.upperCanvasEl,o=this._getEventPrefix();s(d,o+"move",this._onMouseMove,a),h(e.document,o+"up",this._onMouseUp),h(e.document,o+"move",this._onMouseMove,a)},_onTouchEnd:function(l){if(!(l.touches.length>0)){this.__onMouseUp(l),this._resetTransformEventData(),this.mainTouchId=null;var d=this._getEventPrefix();s(e.document,"touchend",this._onTouchEnd,a),s(e.document,"touchmove",this._onMouseMove,a);var o=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){h(o.upperCanvasEl,d+"down",o._onMouseDown),o._willAddMouseDown=0},400)}},_onMouseUp:function(l){this.__onMouseUp(l),this._resetTransformEventData();var d=this.upperCanvasEl,o=this._getEventPrefix();this._isMainEvent(l)&&(s(e.document,o+"up",this._onMouseUp),s(e.document,o+"move",this._onMouseMove,a),h(d,o+"move",this._onMouseMove,a))},_onMouseMove:function(l){!this.allowTouchScrolling&&l.preventDefault&&l.preventDefault(),this.__onMouseMove(l)},_onResize:function(){this.calcOffset()},_shouldRender:function(l){var d=this._activeObject;return!!d!=!!l||d&&l&&d!==l?!0:(d&&d.isEditing,!1)},__onMouseUp:function(l){var d,o=this._currentTransform,g=this._groupSelector,p=!1,v=!g||g.left===0&&g.top===0;if(this._cacheTransformEventData(l),d=this._target,this._handleEvent(l,"up:before"),i(l,u)){this.fireRightClick&&this._handleEvent(l,"up",u,v);return}if(i(l,f)){this.fireMiddleClick&&this._handleEvent(l,"up",f,v),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(l);return}if(this._isMainEvent(l)){if(o&&(this._finalizeCurrentTransform(l),p=o.actionPerformed),!v){var x=d===this._activeObject;this._maybeGroupObjects(l),p||(p=this._shouldRender(d)||!x&&d===this._activeObject)}var S,C;if(d){if(S=d._findTargetCorner(this.getPointer(l,!0),e.util.isTouchEvent(l)),d.selectable&&d!==this._activeObject&&d.activeOn==="up")this.setActiveObject(d,l),p=!0;else{var T=d.controls[S],O=T&&T.getMouseUpHandler(l,d,T);O&&(C=this.getPointer(l),O(l,o,C.x,C.y))}d.isMoving=!1}if(o&&(o.target!==d||o.corner!==S)){var N=o.target&&o.target.controls[o.corner],U=N&&N.getMouseUpHandler(l,d,T);C=C||this.getPointer(l),U&&U(l,o,C.x,C.y)}this._setCursorFromEvent(l,d),this._handleEvent(l,"up",r,v),this._groupSelector=null,this._currentTransform=null,d&&(d.__corner=0),p?this.requestRenderAll():v||this.renderTop()}},_simpleEventHandler:function(l,d){var o=this.findTarget(d),g=this.targets,p={e:d,target:o,subTargets:g};if(this.fire(l,p),o&&o.fire(l,p),!g)return o;for(var v=0;v<g.length;v++)g[v].fire(l,p);return o},_handleEvent:function(l,d,o,g){var p=this._target,v=this.targets||[],x={e:l,target:p,subTargets:v,button:o||r,isClick:g||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};d==="up"&&(x.currentTarget=this.findTarget(l),x.currentSubTargets=this.targets),this.fire("mouse:"+d,x),p&&p.fire("mouse"+d,x);for(var S=0;S<v.length;S++)v[S].fire("mouse"+d,x)},_finalizeCurrentTransform:function(l){var d=this._currentTransform,o=d.target,g={e:l,target:o,transform:d,action:d.action};o._scaling&&(o._scaling=!1),o.setCoords(),(d.actionPerformed||this.stateful&&o.hasStateChanged())&&this._fire("modified",g)},_onMouseDownInDrawingMode:function(l){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(l).requestRenderAll();var d=this.getPointer(l);this.freeDrawingBrush.onMouseDown(d,{e:l,pointer:d}),this._handleEvent(l,"down")},_onMouseMoveInDrawingMode:function(l){if(this._isCurrentlyDrawing){var d=this.getPointer(l);this.freeDrawingBrush.onMouseMove(d,{e:l,pointer:d})}this.setCursor(this.freeDrawingCursor),this._handleEvent(l,"move")},_onMouseUpInDrawingMode:function(l){var d=this.getPointer(l);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:l,pointer:d}),this._handleEvent(l,"up")},__onMouseDown:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"down:before");var d=this._target;if(i(l,u)){this.fireRightClick&&this._handleEvent(l,"down",u);return}if(i(l,f)){this.fireMiddleClick&&this._handleEvent(l,"down",f);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(l);return}if(this._isMainEvent(l)&&!this._currentTransform){var o=this._pointer;this._previousPointer=o;var g=this._shouldRender(d),p=this._shouldGroup(l,d);if(this._shouldClearSelection(l,d)?this.discardActiveObject(l):p&&(this._handleGrouping(l,d),d=this._activeObject),this.selection&&(!d||!d.selectable&&!d.isEditing&&d!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),d){var v=d===this._activeObject;d.selectable&&d.activeOn==="down"&&this.setActiveObject(d,l);var x=d._findTargetCorner(this.getPointer(l,!0),e.util.isTouchEvent(l));if(d.__corner=x,d===this._activeObject&&(x||!p)){this._setupCurrentTransform(l,d,v);var S=d.controls[x],o=this.getPointer(l),C=S&&S.getMouseDownHandler(l,d,S);C&&C(l,this._currentTransform,o.x,o.y)}}this._handleEvent(l,"down"),(g||p)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(l){this._resetTransformEventData(),this._pointer=this.getPointer(l,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(l)||null},_beforeTransform:function(l){var d=this._currentTransform;this.stateful&&d.target.saveState(),this.fire("before:transform",{e:l,transform:d})},__onMouseMove:function(l){this._handleEvent(l,"move:before"),this._cacheTransformEventData(l);var d,o;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(l);return}if(this._isMainEvent(l)){var g=this._groupSelector;g?(o=this._absolutePointer,g.left=o.x-g.ex,g.top=o.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(l):(d=this.findTarget(l)||null,this._setCursorFromEvent(l,d),this._fireOverOutEvents(d,l)),this._handleEvent(l,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(l,d){var o=this._hoveredTarget,g=this._hoveredTargets,p=this.targets,v=Math.max(g.length,p.length);this.fireSyntheticInOutEvents(l,d,{oldTarget:o,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var x=0;x<v;x++)this.fireSyntheticInOutEvents(p[x],d,{oldTarget:g[x],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(l,d){var o=this._draggedoverTarget,g=this._hoveredTargets,p=this.targets,v=Math.max(g.length,p.length);this.fireSyntheticInOutEvents(l,d,{oldTarget:o,evtOut:"dragleave",evtIn:"dragenter"});for(var x=0;x<v;x++)this.fireSyntheticInOutEvents(p[x],d,{oldTarget:g[x],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=l},fireSyntheticInOutEvents:function(l,d,o){var g,p,v=o.oldTarget,x,S,C=v!==l,T=o.canvasEvtIn,O=o.canvasEvtOut;C&&(g={e:d,target:l,previousTarget:v},p={e:d,target:v,nextTarget:l}),S=l&&C,x=v&&C,x&&(O&&this.fire(O,p),v.fire(o.evtOut,p)),S&&(T&&this.fire(T,g),l.fire(o.evtIn,g))},__onMouseWheel:function(l){this._cacheTransformEventData(l),this._handleEvent(l,"wheel"),this._resetTransformEventData()},_transformObject:function(l){var d=this.getPointer(l),o=this._currentTransform;o.reset=!1,o.shiftKey=l.shiftKey,o.altKey=l[this.centeredKey],this._performTransformAction(l,o,d),o.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(l,d,o){var g=o.x,p=o.y,v=d.action,x=!1,S=d.actionHandler;S&&(x=S(l,d,g,p)),v==="drag"&&x&&(d.target.isMoving=!0,this.setCursor(d.target.moveCursor||this.moveCursor)),d.actionPerformed=d.actionPerformed||x},_fire:e.controlsUtils.fireEvent,_setCursorFromEvent:function(l,d){if(!d)return this.setCursor(this.defaultCursor),!1;var o=d.hoverCursor||this.hoverCursor,g=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,p=(!g||!g.contains(d))&&d._findTargetCorner(this.getPointer(l,!0));p?this.setCursor(this.getCornerCursor(p,d,l)):(d.subTargetCheck&&this.targets.concat().reverse().map(function(v){o=v.hoverCursor||o}),this.setCursor(o))},getCornerCursor:function(l,d,o){var g=d.controls[l];return g.cursorStyleHandler(o,g,d)}})}(),function(){var h=Math.min,s=Math.max;e.util.object.extend(e.Canvas.prototype,{_shouldGroup:function(u,f){var r=this._activeObject;return r&&this._isSelectionKeyPressed(u)&&f&&f.selectable&&this.selection&&(r!==f||r.type==="activeSelection")&&!f.onSelect({e:u})},_handleGrouping:function(u,f){var r=this._activeObject;r.__corner||f===r&&(f=this.findTarget(u,!0),!f||!f.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(f,u):this._createActiveSelection(f,u))},_updateActiveSelection:function(u,f){var r=this._activeObject,a=r._objects.slice(0);r.contains(u)?(r.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),f)):(r.addWithUpdate(u),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(a,f)},_createActiveSelection:function(u,f){var r=this.getActiveObjects(),a=this._createGroup(u);this._hoveredTarget=a,this._setActiveObject(a,f),this._fireSelectionEvents(r,f)},_createGroup:function(u){var f=this._objects,r=f.indexOf(this._activeObject)<f.indexOf(u),a=r?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new e.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(u){var f=this._collectObjects(u),r;f.length===1?this.setActiveObject(f[0],u):f.length>1&&(r=new e.ActiveSelection(f.reverse(),{canvas:this}),this.setActiveObject(r,u))},_collectObjects:function(u){for(var f=[],r,a=this._groupSelector.ex,i=this._groupSelector.ey,l=a+this._groupSelector.left,d=i+this._groupSelector.top,o=new e.Point(h(a,l),h(i,d)),g=new e.Point(s(a,l),s(i,d)),p=!this.selectionFullyContained,v=a===l&&i===d,x=this._objects.length;x--&&(r=this._objects[x],!(!(!r||!r.selectable||!r.visible)&&(p&&r.intersectsWithRect(o,g,!0)||r.isContainedWithinRect(o,g,!0)||p&&r.containsPoint(o,null,!0)||p&&r.containsPoint(g,null,!0))&&(f.push(r),v))););return f.length>1&&(f=f.filter(function(S){return!S.onSelect({e:u})})),f},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){e.util.object.extend(e.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var s=h.format||"png",u=h.quality||1,f=(h.multiplier||1)*(h.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(f,h);return e.util.toDataURL(r,s,u)},toCanvasElement:function(h,s){h=h||1,s=s||{};var u=(s.width||this.width)*h,f=(s.height||this.height)*h,r=this.getZoom(),a=this.width,i=this.height,l=r*h,d=this.viewportTransform,o=(d[4]-(s.left||0))*h,g=(d[5]-(s.top||0))*h,p=this.interactive,v=[l,0,0,l,o,g],x=this.enableRetinaScaling,S=e.util.createCanvasElement(),C=this.contextTop;return S.width=u,S.height=f,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=u,this.height=f,this.calcViewportBoundaries(),this.renderCanvas(S.getContext("2d"),this._objects),this.viewportTransform=d,this.width=a,this.height=i,this.calcViewportBoundaries(),this.interactive=p,this.enableRetinaScaling=x,this.contextTop=C,S}})}(),e.util.object.extend(e.StaticCanvas.prototype,{loadFromJSON:function(h,s,u){if(h){var f=typeof h=="string"?JSON.parse(h):e.util.object.clone(h),r=this,a=f.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete f.clipPath,this._enlivenObjects(f.objects,function(l){r.clear(),r._setBgOverlay(f,function(){a?r._enlivenObjects([a],function(d){r.clipPath=d[0],r.__setupCanvas.call(r,f,l,i,s)}):r.__setupCanvas.call(r,f,l,i,s)})},u),this}},__setupCanvas:function(h,s,u,f){var r=this;s.forEach(function(a,i){r.insertAt(a,i)}),this.renderOnAddRemove=u,delete h.objects,delete h.backgroundImage,delete h.overlayImage,delete h.background,delete h.overlay,this._setOptions(h),this.renderAll(),f&&f()},_setBgOverlay:function(h,s){var u={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!h.backgroundImage&&!h.overlayImage&&!h.background&&!h.overlay){s&&s();return}var f=function(){u.backgroundImage&&u.overlayImage&&u.backgroundColor&&u.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",h.backgroundImage,u,f),this.__setBgOverlay("overlayImage",h.overlayImage,u,f),this.__setBgOverlay("backgroundColor",h.background,u,f),this.__setBgOverlay("overlayColor",h.overlay,u,f)},__setBgOverlay:function(h,s,u,f){var r=this;if(!s){u[h]=!0,f&&f();return}h==="backgroundImage"||h==="overlayImage"?e.util.enlivenObjects([s],function(a){r[h]=a[0],u[h]=!0,f&&f()}):this["set"+e.util.string.capitalize(h,!0)](s,function(){u[h]=!0,f&&f()})},_enlivenObjects:function(h,s,u){if(!h||h.length===0){s&&s([]);return}e.util.enlivenObjects(h,function(f){s&&s(f)},null,u)},_toDataURL:function(h,s){this.clone(function(u){s(u.toDataURL(h))})},_toDataURLWithMultiplier:function(h,s,u){this.clone(function(f){u(f.toDataURLWithMultiplier(h,s))})},clone:function(h,s){var u=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(f){f.loadFromJSON(u,function(){h&&h(f)})})},cloneWithoutData:function(h){var s=e.util.createCanvasElement();s.width=this.width,s.height=this.height;var u=new e.Canvas(s);this.backgroundImage?(u.setBackgroundImage(this.backgroundImage.src,function(){u.renderAll(),h&&h(u)}),u.backgroundImageOpacity=this.backgroundImageOpacity,u.backgroundImageStretch=this.backgroundImageStretch):h&&h(u)}}),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,f=s.util.object.clone,r=s.util.toFixed,a=s.util.string.capitalize,i=s.util.degreesToRadians,l=!s.isLikelyNode,d=2;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:l,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(o){o&&this.setOptions(o)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(o){var g=s.perfLimitSizeTotal,p=o.width,v=o.height,x=s.maxCacheSideLimit,S=s.minCacheSideLimit;if(p<=x&&v<=x&&p*v<=g)return p<S&&(o.width=S),v<S&&(o.height=S),o;var C=p/v,T=s.util.limitDimsByArea(C,g),O=s.util.capValue,N=O(S,T.x,x),U=O(S,T.y,x);return p>N&&(o.zoomX/=p/N,o.width=N,o.capped=!0),v>U&&(o.zoomY/=v/U,o.height=U,o.capped=!0),o},_getCacheCanvasDimensions:function(){var o=this.getTotalObjectScaling(),g=this._getTransformedDimensions(0,0),p=g.x*o.scaleX/this.scaleX,v=g.y*o.scaleY/this.scaleY;return{width:Math.ceil(p+d),height:Math.ceil(v+d),zoomX:o.scaleX,zoomY:o.scaleY,x:p,y:v}},_updateCacheCanvas:function(){var o=this.canvas;if(this.noScaleCache&&o&&o._currentTransform){var g=o._currentTransform.target,p=o._currentTransform.action;if(this===g&&p.slice&&p.slice(0,5)==="scale")return!1}var v=this._cacheCanvas,x=this._limitCacheSize(this._getCacheCanvasDimensions()),S=x.width,C=x.height,T,O,N=x.zoomX,U=x.zoomY,J=S!==this.cacheWidth||C!==this.cacheHeight,te=this.zoomX!==N||this.zoomY!==U,se=J||te;return se?(J?(v.width=S,v.height=C):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,v.width,v.height)),T=x.x/2,O=x.y/2,this.cacheTranslationX=Math.round(v.width/2-T)+T,this.cacheTranslationY=Math.round(v.height/2-O)+O,this.cacheWidth=S,this.cacheHeight=C,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(N,U),this.zoomX=N,this.zoomY=U,!0):!1},setOptions:function(o){this._setOptions(o),this._initGradient(o.fill,"fill"),this._initGradient(o.stroke,"stroke"),this._initPattern(o.fill,"fill"),this._initPattern(o.stroke,"stroke")},transform:function(o){var g=this.group&&!this.group._transformDone||this.group&&this.canvas&&o===this.canvas.contextTop,p=this.calcTransformMatrix(!g);o.transform(p[0],p[1],p[2],p[3],p[4],p[5])},toObject:function(o){var g=s.Object.NUM_FRACTION_DIGITS,p={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:r(this.left,g),top:r(this.top,g),width:r(this.width,g),height:r(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,g),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,g),scaleX:r(this.scaleX,g),scaleY:r(this.scaleY,g),angle:r(this.angle,g),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,g),skewY:r(this.skewY,g)};return this.clipPath&&!this.clipPath.excludeFromExport&&(p.clipPath=this.clipPath.toObject(o),p.clipPath.inverted=this.clipPath.inverted,p.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,p,o),this.includeDefaultValues||(p=this._removeDefaultValues(p)),p},toDatalessObject:function(o){return this.toObject(o)},_removeDefaultValues:function(o){var g=s.util.getKlass(o.type).prototype,p=g.stateProperties;return p.forEach(function(v){v==="left"||v==="top"||(o[v]===g[v]&&delete o[v],Array.isArray(o[v])&&Array.isArray(g[v])&&o[v].length===0&&g[v].length===0&&delete o[v])}),o},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var o=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(o.scaleX),scaleY:Math.abs(o.scaleY)}},getTotalObjectScaling:function(){var o=this.getObjectScaling(),g=o.scaleX,p=o.scaleY;if(this.canvas){var v=this.canvas.getZoom(),x=this.canvas.getRetinaScaling();g*=v*x,p*=v*x}return{scaleX:g,scaleY:p}},getObjectOpacity:function(){var o=this.opacity;return this.group&&(o*=this.group.getObjectOpacity()),o},_set:function(o,g){var p=o==="scaleX"||o==="scaleY",v=this[o]!==g,x=!1;return p&&(g=this._constrainScale(g)),o==="scaleX"&&g<0?(this.flipX=!this.flipX,g*=-1):o==="scaleY"&&g<0?(this.flipY=!this.flipY,g*=-1):o==="shadow"&&g&&!(g instanceof s.Shadow)?g=new s.Shadow(g):o==="dirty"&&this.group&&this.group.set("dirty",g),this[o]=g,v&&(x=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(o)>-1?(this.dirty=!0,x&&this.group.set("dirty",!0)):x&&this.stateProperties.indexOf(o)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(o){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(o.save(),this._setupCompositeOperation(o),this.drawSelectionBackground(o),this.transform(o),this._setOpacity(o),this._setShadow(o,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(o)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(o),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),o.restore())},renderCache:function(o){o=o||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,o.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(o,g){if(o.save(),g.inverted?o.globalCompositeOperation="destination-out":o.globalCompositeOperation="destination-in",g.absolutePositioned){var p=s.util.invertTransform(this.calcTransformMatrix());o.transform(p[0],p[1],p[2],p[3],p[4],p[5])}g.transform(o),o.scale(1/g.zoomX,1/g.zoomY),o.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),o.restore()},drawObject:function(o,g){var p=this.fill,v=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(o)):this._renderBackground(o),this._render(o),this._drawClipPath(o,this.clipPath),this.fill=p,this.stroke=v},_drawClipPath:function(o,g){g&&(g.canvas=this.canvas,g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(o,g))},drawCacheOnCanvas:function(o){o.scale(1/this.zoomX,1/this.zoomY),o.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(o){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!o&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!o){var g=this.cacheWidth/this.zoomX,p=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-p/2,g,p)}return!0}return!1},_renderBackground:function(o){if(this.backgroundColor){var g=this._getNonTransformedDimensions();o.fillStyle=this.backgroundColor,o.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(o)}},_setOpacity:function(o){this.group&&!this.group._transformDone?o.globalAlpha=this.getObjectOpacity():o.globalAlpha*=this.opacity},_setStrokeStyles:function(o,g){var p=g.stroke;p&&(o.lineWidth=g.strokeWidth,o.lineCap=g.strokeLineCap,o.lineDashOffset=g.strokeDashOffset,o.lineJoin=g.strokeLineJoin,o.miterLimit=g.strokeMiterLimit,p.toLive?p.gradientUnits==="percentage"||p.gradientTransform||p.patternTransform?this._applyPatternForTransformedGradient(o,p):(o.strokeStyle=p.toLive(o,this),this._applyPatternGradientTransform(o,p)):o.strokeStyle=g.stroke)},_setFillStyles:function(o,g){var p=g.fill;p&&(p.toLive?(o.fillStyle=p.toLive(o,this),this._applyPatternGradientTransform(o,g.fill)):o.fillStyle=p)},_setClippingProperties:function(o){o.globalAlpha=1,o.strokeStyle="transparent",o.fillStyle="#000000"},_setLineDash:function(o,g){!g||g.length===0||(1&g.length&&g.push.apply(g,g),o.setLineDash(g))},_renderControls:function(o,g){var p=this.getViewportTransform(),v=this.calcTransformMatrix(),x,S,C;g=g||{},S=typeof g.hasBorders<"u"?g.hasBorders:this.hasBorders,C=typeof g.hasControls<"u"?g.hasControls:this.hasControls,v=s.util.multiplyTransformMatrices(p,v),x=s.util.qrDecompose(v),o.save(),o.translate(x.translateX,x.translateY),o.lineWidth=1*this.borderScaleFactor,this.group||(o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(x.angle-=180),o.rotate(i(this.group?x.angle:this.angle)),g.forActiveSelection||this.group?S&&this.drawBordersInGroup(o,x,g):S&&this.drawBorders(o,g),C&&this.drawControls(o,g),o.restore()},_setShadow:function(o){if(this.shadow){var g=this.shadow,p=this.canvas,v,x=p&&p.viewportTransform[0]||1,S=p&&p.viewportTransform[3]||1;g.nonScaling?v={scaleX:1,scaleY:1}:v=this.getObjectScaling(),p&&p._isRetinaScaling()&&(x*=s.devicePixelRatio,S*=s.devicePixelRatio),o.shadowColor=g.color,o.shadowBlur=g.blur*s.browserShadowBlurConstant*(x+S)*(v.scaleX+v.scaleY)/4,o.shadowOffsetX=g.offsetX*x*v.scaleX,o.shadowOffsetY=g.offsetY*S*v.scaleY}},_removeShadow:function(o){this.shadow&&(o.shadowColor="",o.shadowBlur=o.shadowOffsetX=o.shadowOffsetY=0)},_applyPatternGradientTransform:function(o,g){if(!g||!g.toLive)return{offsetX:0,offsetY:0};var p=g.gradientTransform||g.patternTransform,v=-this.width/2+g.offsetX||0,x=-this.height/2+g.offsetY||0;return g.gradientUnits==="percentage"?o.transform(this.width,0,0,this.height,v,x):o.transform(1,0,0,1,v,x),p&&o.transform(p[0],p[1],p[2],p[3],p[4],p[5]),{offsetX:v,offsetY:x}},_renderPaintInOrder:function(o){this.paintFirst==="stroke"?(this._renderStroke(o),this._renderFill(o)):(this._renderFill(o),this._renderStroke(o))},_render:function(){},_renderFill:function(o){this.fill&&(o.save(),this._setFillStyles(o,this),this.fillRule==="evenodd"?o.fill("evenodd"):o.fill(),o.restore())},_renderStroke:function(o){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(o),o.save(),this.strokeUniform&&this.group){var g=this.getObjectScaling();o.scale(1/g.scaleX,1/g.scaleY)}else this.strokeUniform&&o.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(o,this.strokeDashArray),this._setStrokeStyles(o,this),o.stroke(),o.restore()}},_applyPatternForTransformedGradient:function(o,g){var p=this._limitCacheSize(this._getCacheCanvasDimensions()),v=s.util.createCanvasElement(),x,S=this.canvas.getRetinaScaling(),C=p.x/this.scaleX/S,T=p.y/this.scaleY/S;v.width=Math.ceil(C),v.height=Math.ceil(T),x=v.getContext("2d"),x.beginPath(),x.moveTo(0,0),x.lineTo(C,0),x.lineTo(C,T),x.lineTo(0,T),x.closePath(),x.translate(C/2,T/2),x.scale(p.zoomX/this.scaleX/S,p.zoomY/this.scaleY/S),this._applyPatternGradientTransform(x,g),x.fillStyle=g.toLive(o),x.fill(),o.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),o.scale(S*this.scaleX/p.zoomX,S*this.scaleY/p.zoomY),o.strokeStyle=x.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var o=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",o.scaleX),this.set("scaleY",o.scaleY),this.angle=o.angle,this.skewX=o.skewX,this.skewY=0}},_removeTransformMatrix:function(o){var g=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),g=s.util.transformPoint(g,this.transformMatrix)),this.transformMatrix=null,o&&(this.scaleX*=o.scaleX,this.scaleY*=o.scaleY,this.cropX=o.cropX,this.cropY=o.cropY,g.x+=o.offsetLeft,g.y+=o.offsetTop,this.width=o.width,this.height=o.height),this.setPositionByOrigin(g,"center","center")},clone:function(o,g){var p=this.toObject(g);this.constructor.fromObject?this.constructor.fromObject(p,o):s.Object._fromObject("Object",p,o)},cloneAsImage:function(o,g){var p=this.toCanvasElement(g);return o&&o(new s.Image(p)),this},toCanvasElement:function(o){o||(o={});var g=s.util,p=g.saveObjectTransform(this),v=this.group,x=this.shadow,S=Math.abs,C=(o.multiplier||1)*(o.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,o.withoutTransform&&g.resetObjectTransform(this),o.withoutShadow&&(this.shadow=null);var T=s.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),N=this.shadow,U,J={x:0,y:0},te,se,ne;N&&(te=N.blur,N.nonScaling?U={scaleX:1,scaleY:1}:U=this.getObjectScaling(),J.x=2*Math.round(S(N.offsetX)+te)*S(U.scaleX),J.y=2*Math.round(S(N.offsetY)+te)*S(U.scaleY)),se=O.width+J.x,ne=O.height+J.y,T.width=Math.ceil(se),T.height=Math.ceil(ne);var re=new s.StaticCanvas(T,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});o.format==="jpeg"&&(re.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(re.width/2,re.height/2),"center","center");var ae=this.canvas;re.add(this);var le=re.toCanvasElement(C||1,o);return this.shadow=x,this.set("canvas",ae),v&&(this.group=v),this.set(p).setCoords(),re._objects=[],re.dispose(),re=null,le},toDataURL:function(o){return o||(o={}),s.util.toDataURL(this.toCanvasElement(o),o.format||"png",o.quality||1)},isType:function(o){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===o},complexity:function(){return 1},toJSON:function(o){return this.toObject(o)},rotate:function(o){var g=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return g&&this._setOriginToCenter(),this.set("angle",o),g&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(o,g){g=g||this.canvas.getPointer(o);var p=new s.Point(g.x,g.y),v=this._getLeftTopCoords();return this.angle&&(p=s.util.rotatePoint(p,v,i(-this.angle))),{x:p.x-v.x,y:p.y-v.y}},_setupCompositeOperation:function(o){this.globalCompositeOperation&&(o.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),u(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(o,g,p,v){var x=s[o];g=f(g,!0),s.util.enlivenPatterns([g.fill,g.stroke],function(S){typeof S[0]<"u"&&(g.fill=S[0]),typeof S[1]<"u"&&(g.stroke=S[1]),s.util.enlivenObjectEnlivables(g,g,function(){var C=v?new x(g[v],g):new x(g);p&&p(C)})})},s.Object.__uid=0)}(t),function(){var h=e.util.degreesToRadians,s={left:-.5,center:0,right:.5},u={top:-.5,center:0,bottom:.5};e.util.object.extend(e.Object.prototype,{translateToGivenOrigin:function(f,r,a,i,l){var d=f.x,o=f.y,g,p,v;return typeof r=="string"?r=s[r]:r-=.5,typeof i=="string"?i=s[i]:i-=.5,g=i-r,typeof a=="string"?a=u[a]:a-=.5,typeof l=="string"?l=u[l]:l-=.5,p=l-a,(g||p)&&(v=this._getTransformedDimensions(),d=f.x+g*v.x,o=f.y+p*v.y),new e.Point(d,o)},translateToCenterPoint:function(f,r,a){var i=this.translateToGivenOrigin(f,r,a,"center","center");return this.angle?e.util.rotatePoint(i,f,h(this.angle)):i},translateToOriginPoint:function(f,r,a){var i=this.translateToGivenOrigin(f,"center","center",r,a);return this.angle?e.util.rotatePoint(i,f,h(this.angle)):i},getCenterPoint:function(){var f=new e.Point(this.left,this.top);return this.translateToCenterPoint(f,this.originX,this.originY)},getPointByOrigin:function(f,r){var a=this.getCenterPoint();return this.translateToOriginPoint(a,f,r)},toLocalPoint:function(f,r,a){var i=this.getCenterPoint(),l,d;return typeof r<"u"&&typeof a<"u"?l=this.translateToGivenOrigin(i,"center","center",r,a):l=new e.Point(this.left,this.top),d=new e.Point(f.x,f.y),this.angle&&(d=e.util.rotatePoint(d,i,-h(this.angle))),d.subtractEquals(l)},setPositionByOrigin:function(f,r,a){var i=this.translateToCenterPoint(f,r,a),l=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",l.x),this.set("top",l.y)},adjustPosition:function(f){var r=h(this.angle),a=this.getScaledWidth(),i=e.util.cos(r)*a,l=e.util.sin(r)*a,d,o;typeof this.originX=="string"?d=s[this.originX]:d=this.originX-.5,typeof f=="string"?o=s[f]:o=f-.5,this.left+=i*(o-d),this.top+=l*(o-d),this.setCoords(),this.originX=f},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var f=this.getCenterPoint();this.originX="center",this.originY="center",this.left=f.x,this.top=f.y},_resetOrigin:function(){var f=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=f.x,this.top=f.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function h(a){return[new e.Point(a.tl.x,a.tl.y),new e.Point(a.tr.x,a.tr.y),new e.Point(a.br.x,a.br.y),new e.Point(a.bl.x,a.bl.y)]}var s=e.util,u=s.degreesToRadians,f=s.multiplyTransformMatrices,r=s.transformPoint;s.object.extend(e.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(a,i){return i?a?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),a?this.aCoords:this.lineCoords)},getCoords:function(a,i){return h(this._getCoords(a,i))},intersectsWithRect:function(a,i,l,d){var o=this.getCoords(l,d),g=e.Intersection.intersectPolygonRectangle(o,a,i);return g.status==="Intersection"},intersectsWithObject:function(a,i,l){var d=e.Intersection.intersectPolygonPolygon(this.getCoords(i,l),a.getCoords(i,l));return d.status==="Intersection"||a.isContainedWithinObject(this,i,l)||this.isContainedWithinObject(a,i,l)},isContainedWithinObject:function(a,i,l){for(var d=this.getCoords(i,l),o=i?a.aCoords:a.lineCoords,g=0,p=a._getImageLines(o);g<4;g++)if(!a.containsPoint(d[g],p))return!1;return!0},isContainedWithinRect:function(a,i,l,d){var o=this.getBoundingRect(l,d);return o.left>=a.x&&o.left+o.width<=i.x&&o.top>=a.y&&o.top+o.height<=i.y},containsPoint:function(a,g,l,d){var o=this._getCoords(l,d),g=g||this._getImageLines(o),p=this._findCrossPoints(a,g);return p!==0&&p%2===1},isOnScreen:function(a){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br,d=this.getCoords(!0,a);return d.some(function(o){return o.x<=l.x&&o.x>=i.x&&o.y<=l.y&&o.y>=i.y})||this.intersectsWithRect(i,l,!0,a)?!0:this._containsCenterOfCanvas(i,l,a)},_containsCenterOfCanvas:function(a,i,l){var d={x:(a.x+i.x)/2,y:(a.y+i.y)/2};return!!this.containsPoint(d,null,!0,l)},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,l=this.canvas.vptCoords.br;if(this.intersectsWithRect(i,l,!0,a))return!0;var d=this.getCoords(!0,a).every(function(o){return(o.x>=l.x||o.x<=i.x)&&(o.y>=l.y||o.y<=i.y)});return d&&this._containsCenterOfCanvas(i,l,a)},_getImageLines:function(a){var i={topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}};return i},_findCrossPoints:function(a,i){var l,d,o,g,p,v=0,x;for(var S in i)if(x=i[S],!(x.o.y<a.y&&x.d.y<a.y)&&!(x.o.y>=a.y&&x.d.y>=a.y)&&(x.o.x===x.d.x&&x.o.x>=a.x?p=x.o.x:(l=0,d=(x.d.y-x.o.y)/(x.d.x-x.o.x),o=a.y-l*a.x,g=x.o.y-d*x.o.x,p=-(o-g)/(l-d)),p>=a.x&&(v+=1),v===2))break;return v},getBoundingRect:function(a,i){var l=this.getCoords(a,i);return s.makeBoundingBoxFromPoints(l)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a===0?1e-4:a},scale:function(a){return this._set("scaleX",a),this._set("scaleY",a),this.setCoords()},scaleToWidth:function(a,i){var l=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(a/this.width/l)},scaleToHeight:function(a,i){var l=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(a/this.height/l)},calcLineCoords:function(){var a=this.getViewportTransform(),i=this.padding,l=u(this.angle),d=s.cos(l),o=s.sin(l),g=d*i,p=o*i,v=g+p,x=g-p,S=this.calcACoords(),C={tl:r(S.tl,a),tr:r(S.tr,a),bl:r(S.bl,a),br:r(S.br,a)};return i&&(C.tl.x-=x,C.tl.y-=v,C.tr.x+=v,C.tr.y-=x,C.bl.x-=v,C.bl.y+=x,C.br.x+=x,C.br.y+=v),C},calcOCoords:function(){var a=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),l=this.getViewportTransform(),d=f(l,i),o=f(d,a),o=f(o,[1/l[0],0,0,1/l[3],0,0]),g=this._calculateCurrentDimensions(),p={};return this.forEachControl(function(v,x,S){p[x]=v.positionHandler(g,o,S)}),p},calcACoords:function(){var a=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),l=f(i,a),d=this._getTransformedDimensions(),o=d.x/2,g=d.y/2;return{tl:r({x:-o,y:-g},l),tr:r({x:o,y:-g},l),bl:r({x:-o,y:g},l),br:r({x:o,y:g},l)}},setCoords:function(a){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),a?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var i="_",l="";return!a&&this.group&&(l=this.group.transformMatrixKey(a)+i),l+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){var i=this.calcOwnMatrix();if(a||!this.group)return i;var l=this.transformMatrixKey(a),d=this.matrixCache||(this.matrixCache={});return d.key===l?d.value:(this.group&&(i=f(this.group.calcTransformMatrix(!1),i)),d.key=l,d.value=i,i)},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===a)return i.value;var l=this._calcTranslateMatrix(),d={angle:this.angle,translateX:l[4],translateY:l[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=a,i.value=s.composeMatrix(d),i.value},_getNonTransformedDimensions:function(){var a=this.strokeWidth,i=this.width+a,l=this.height+a;return{x:i,y:l}},_getTransformedDimensions:function(a,i){typeof a>"u"&&(a=this.skewX),typeof i>"u"&&(i=this.skewY);var l,d,o,g=a===0&&i===0;if(this.strokeUniform?(d=this.width,o=this.height):(l=this._getNonTransformedDimensions(),d=l.x,o=l.y),g)return this._finalizeDimensions(d*this.scaleX,o*this.scaleY);var p=s.sizeAfterTransform(d,o,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:a,skewY:i});return this._finalizeDimensions(p.x,p.y)},_finalizeDimensions:function(a,i){return this.strokeUniform?{x:a+this.strokeWidth,y:i+this.strokeWidth}:{x:a,y:i}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),i=this._getTransformedDimensions(),l=r(i,a,!0);return l.scalarAdd(2*this.padding)}})}(),e.util.object.extend(e.Object.prototype,{sendToBack:function(){return this.group?e.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?e.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(h){return this.group?e.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas&&this.canvas.sendBackwards(this,h),this},bringForward:function(h){return this.group?e.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas&&this.canvas.bringForward(this,h),this},moveTo:function(h){return this.group&&this.group.type!=="activeSelection"?e.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas&&this.canvas.moveTo(this,h),this}}),function(){function h(u,f){if(f){if(f.toLive)return u+": url(#SVGID_"+f.id+"); ";var r=new e.Color(f),a=u+": "+r.toRgb()+"; ",i=r.getAlpha();return i!==1&&(a+=u+"-opacity: "+i.toString()+"; "),a}else return u+": none; "}var s=e.util.toFixed;e.util.object.extend(e.Object.prototype,{getSvgStyles:function(u){var f=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",l=this.strokeLineCap?this.strokeLineCap:"butt",d=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",g=typeof this.opacity<"u"?this.opacity:"1",p=this.visible?"":" visibility: hidden;",v=u?"":this.getSvgFilter(),x=h("fill",this.fill),S=h("stroke",this.stroke);return[S,"stroke-width: ",r,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",l,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",d,"; ","stroke-miterlimit: ",o,"; ",x,"fill-rule: ",f,"; ","opacity: ",g,";",v,p].join("")},getSvgSpanStyles:function(u,f){var r="; ",i=u.fontFamily?"font-family: "+(u.fontFamily.indexOf("'")===-1&&u.fontFamily.indexOf('"')===-1?"'"+u.fontFamily+"'":u.fontFamily)+r:"",a=u.strokeWidth?"stroke-width: "+u.strokeWidth+r:"",i=i,l=u.fontSize?"font-size: "+u.fontSize+"px"+r:"",d=u.fontStyle?"font-style: "+u.fontStyle+r:"",o=u.fontWeight?"font-weight: "+u.fontWeight+r:"",g=u.fill?h("fill",u.fill):"",p=u.stroke?h("stroke",u.stroke):"",v=this.getSvgTextDecoration(u),x=u.deltaY?"baseline-shift: "+-u.deltaY+"; ":"";return v&&(v="text-decoration: "+v+r),[p,a,i,l,d,o,v,g,x,f?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(u){return["overline","underline","line-through"].filter(function(f){return u[f.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(u,f){var r=u?this.calcTransformMatrix():this.calcOwnMatrix(),a='transform="'+e.util.matrixToSVG(r);return a+(f||"")+'" '},_setSVGBg:function(u){if(this.backgroundColor){var f=e.Object.NUM_FRACTION_DIGITS;u.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,f),'" y="',s(-this.height/2,f),'" width="',s(this.width,f),'" height="',s(this.height,f),`"></rect>
`)}},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(u),{reviver:u})},toClipPathSVG:function(u){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(u),{reviver:u})},_createBaseClipPathSVGMarkup:function(u,f){f=f||{};var r=f.reviver,a=f.additionalTransform||"",i=[this.getSvgTransform(!0,a),this.getSvgCommons()].join(""),l=u.indexOf("COMMON_PARTS");return u[l]=i,r?r(u.join("")):u.join("")},_createBaseSVGMarkup:function(u,f){f=f||{};var r=f.noStyle,a=f.reviver,i=r?"":'style="'+this.getSvgStyles()+'" ',l=f.withShadow?'style="'+this.getSvgFilter()+'" ':"",d=this.clipPath,o=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",g=d&&d.absolutePositioned,p=this.stroke,v=this.fill,x=this.shadow,S,C=[],T,O=u.indexOf("COMMON_PARTS"),N=f.additionalTransform;return d&&(d.clipPathId="CLIPPATH_"+e.Object.__uid++,T='<clipPath id="'+d.clipPathId+`" >
`+d.toClipPathSVG(a)+`</clipPath>
`),g&&C.push("<g ",l,this.getSvgCommons(),` >
`),C.push("<g ",this.getSvgTransform(!1),g?"":l+this.getSvgCommons(),` >
`),S=[i,o,r?"":this.addPaintOrder()," ",N?'transform="'+N+'" ':""].join(""),u[O]=S,v&&v.toLive&&C.push(v.toSVG(this)),p&&p.toLive&&C.push(p.toSVG(this)),x&&C.push(x.toSVG(this)),d&&C.push(T),C.push(u.join("")),C.push(`</g>
`),g&&C.push(`</g>
`),a?a(C.join("")):C.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var h=e.util.object.extend,s="stateProperties";function u(r,a,i){var l={},d=!0;i.forEach(function(o){l[o]=r[o]}),h(r[a],l,d)}function f(r,a,i){if(r===a)return!0;if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(var l=0,d=r.length;l<d;l++)if(!f(r[l],a[l]))return!1;return!0}else if(r&&typeof r=="object"){var o=Object.keys(r),g;if(!a||typeof a!="object"||!i&&o.length!==Object.keys(a).length)return!1;for(var l=0,d=o.length;l<d;l++)if(g=o[l],!(g==="canvas"||g==="group")&&!f(r[g],a[g]))return!1;return!0}}e.util.object.extend(e.Object.prototype,{hasStateChanged:function(r){r=r||s;var a="_"+r;return Object.keys(this[a]).length<this[r].length?!0:!f(this[a],this,!0)},saveState:function(r){var a=r&&r.propertySet||s,i="_"+a;return this[i]?(u(this,i,this[a]),r&&r.stateProperties&&u(this,i,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var a=r.propertySet||s;return r.propertySet=a,this["_"+a]={},this.saveState(r),this}})}(),function(){var h=e.util.degreesToRadians;e.util.object.extend(e.Object.prototype,{_findTargetCorner:function(s,u){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var f=s.x,r=s.y,a,i,l=Object.keys(this.oCoords),d=l.length-1,o;for(this.__corner=0;d>=0;d--)if(o=l[d],!!this.isControlVisible(o)&&(i=this._getImageLines(u?this.oCoords[o].touchCorner:this.oCoords[o].corner),a=this._findCrossPoints({x:f,y:r},i),a!==0&&a%2===1))return this.__corner=o,o;return!1},forEachControl:function(s){for(var u in this.controls)s(this.controls[u],u,this)},_setCornerCoords:function(){var s=this.oCoords;for(var u in s){var f=this.controls[u];s[u].corner=f.calcCornerCoords(this.angle,this.cornerSize,s[u].x,s[u].y,!1),s[u].touchCorner=f.calcCornerCoords(this.angle,this.touchCornerSize,s[u].x,s[u].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var u=this.getCenterPoint(),f=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return s.translate(u.x,u.y),s.scale(1/r[0],1/r[3]),s.rotate(h(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-f.x/2,-f.y/2,f.x,f.y),s.restore(),this},drawBorders:function(s,u){u=u||{};var f=this._calculateCurrentDimensions(),r=this.borderScaleFactor,a=f.x+r,i=f.y+r,l=typeof u.hasControls<"u"?u.hasControls:this.hasControls,d=!1;return s.save(),s.strokeStyle=u.borderColor||this.borderColor,this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeRect(-a/2,-i/2,a,i),l&&(s.beginPath(),this.forEachControl(function(o,g,p){o.withConnection&&o.getVisibility(p,g)&&(d=!0,s.moveTo(o.x*a,o.y*i),s.lineTo(o.x*a+o.offsetX,o.y*i+o.offsetY))}),d&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,u,f){f=f||{};var r=e.util.sizeAfterTransform(this.width,this.height,u),a=this.strokeWidth,i=this.strokeUniform,l=this.borderScaleFactor,d=r.x+a*(i?this.canvas.getZoom():u.scaleX)+l,o=r.y+a*(i?this.canvas.getZoom():u.scaleY)+l;return s.save(),this._setLineDash(s,f.borderDashArray||this.borderDashArray),s.strokeStyle=f.borderColor||this.borderColor,s.strokeRect(-d/2,-o/2,d,o),s.restore(),this},drawControls:function(s,u){u=u||{},s.save();var f=1,r,a;return this.canvas&&(f=this.canvas.getRetinaScaling()),s.setTransform(f,0,0,f,0,0),s.strokeStyle=s.fillStyle=u.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=u.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,u.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(i,l,d){a=d.oCoords[l],i.getVisibility(d,l)&&(r&&(a=e.util.transformPoint(a,r)),i.render(s,a.x,a.y,u,d))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,u){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=u,this},setControlsVisibility:function(s){s||(s={});for(var u in s)this.setControlVisible(u,s[u]);return this},onDeselect:function(){},onSelect:function(){}})}(),e.util.object.extend(e.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(h,s){s=s||{};var u=function(){},f=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:h.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){h.set("left",i),a.requestRenderAll(),r()},onComplete:function(){h.setCoords(),f()}})},fxCenterObjectV:function(h,s){s=s||{};var u=function(){},f=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:h.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){h.set("top",i),a.requestRenderAll(),r()},onComplete:function(){h.setCoords(),f()}})},fxRemove:function(h,s){s=s||{};var u=function(){},f=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:h.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){h.set("opacity",i),a.requestRenderAll(),r()},onComplete:function(){a.remove(h),f()}})}}),e.util.object.extend(e.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var h=[],s,u,f=[];for(s in arguments[0])h.push(s);for(var r=0,a=h.length;r<a;r++)s=h[r],u=r!==a-1,f.push(this._animate(s,arguments[0][s],arguments[1],u));return f}else return this._animate.apply(this,arguments)},_animate:function(h,s,u,f){var r=this,a;s=s.toString(),u?u=e.util.object.clone(u):u={},~h.indexOf(".")&&(a=h.split("."));var i=r.colorProperties.indexOf(h)>-1||a&&r.colorProperties.indexOf(a[1])>-1,l=a?this.get(a[0])[a[1]]:this.get(h);"from"in u||(u.from=l),i||(~s.indexOf("=")?s=l+parseFloat(s.replace("=","")):s=parseFloat(s));var d={target:this,startValue:u.from,endValue:s,byValue:u.by,easing:u.easing,duration:u.duration,abort:u.abort&&function(o,g,p){return u.abort.call(r,o,g,p)},onChange:function(o,g,p){a?r[a[0]][a[1]]=o:r.set(h,o),!f&&u.onChange&&u.onChange(o,g,p)},onComplete:function(o,g,p){f||(r.setCoords(),u.onComplete&&u.onComplete(o,g,p))}};return i?e.util.animateColor(d.startValue,d.endValue,d.duration,d):e.util.animate(d)}}),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,f=s.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(s.Line){s.warn("fabric.Line is already defined");return}s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,l){i||(i=[0,0,0,0]),this.callSuper("initialize",l),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(l)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,l){return this.callSuper("_set",i,l),typeof r[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var l=this.calcLinePoints();i.moveTo(l.x1,l.y1),i.lineTo(l.x2,l.y2),i.lineWidth=this.strokeWidth;var d=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=d},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return u(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(i.y-=this.strokeWidth),this.height===0&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,l=this.y1<=this.y2?-1:1,d=i*this.width*.5,o=l*this.height*.5,g=i*this.width*-.5,p=l*this.height*-.5;return{x1:d,x2:g,y1:o,y2:p}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(i,l,d){d=d||{};var o=s.parseAttributes(i,s.Line.ATTRIBUTE_NAMES),g=[o.x1||0,o.y1||0,o.x2||0,o.y2||0];l(new s.Line(g,u(o,d)))},s.Line.fromObject=function(i,l){function d(g){delete g.points,l&&l(g)}var o=f(i,!0);o.points=[i.x1,i.y1,i.x2,i.y2],s.Object._fromObject("Line",o,d,"points")};function a(i,l){var d=i.origin,o=i.axis1,g=i.axis2,p=i.dimension,v=l.nearest,x=l.center,S=l.farthest;return function(){switch(this.get(d)){case v:return Math.min(this.get(o),this.get(g));case x:return Math.min(this.get(o),this.get(g))+.5*this.get(p);case S:return Math.max(this.get(o),this.get(g))}}}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.degreesToRadians;if(s.Circle){s.warn("fabric.Circle is already defined.");return}s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,a){return this.callSuper("_set",r,a),r==="radius"&&this.setRadius(a),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,a=0,i=0,l=(this.endAngle-this.startAngle)%360;if(l===0)r=["<circle ","COMMON_PARTS",'cx="'+a+'" cy="'+i+'" ','r="',this.radius,`" />
`];else{var d=u(this.startAngle),o=u(this.endAngle),g=this.radius,p=s.util.cos(d)*g,v=s.util.sin(d)*g,x=s.util.cos(o)*g,S=s.util.sin(o)*g,C=l>180?"1":"0";r=['<path d="M '+p+" "+v," A "+g+" "+g," 0 ",+C+" 1"," "+x+" "+S,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,u(this.startAngle),u(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(r,a){var i=s.parseAttributes(r,s.Circle.ATTRIBUTE_NAMES);if(!f(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,a(new s.Circle(i))};function f(r){return"radius"in r&&r.radius>=0}s.Circle.fromObject=function(r,a){s.Object._fromObject("Circle",r,a)}}(t),function(h){var s=h.fabric||(h.fabric={});if(s.Triangle){s.warn("fabric.Triangle is already defined");return}s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(u){var f=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-f,r),u.lineTo(0,-r),u.lineTo(f,r),u.closePath(),this._renderPaintInOrder(u)},_toSVG:function(){var u=this.width/2,f=this.height/2,r=[-u+" "+f,"0 "+-f,u+" "+f].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),s.Triangle.fromObject=function(u,f){return s.Object._fromObject("Triangle",u,f)}}(t),function(h){var s=h.fabric||(h.fabric={}),u=Math.PI*2;if(s.Ellipse){s.warn("fabric.Ellipse is already defined.");return}s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this.set("rx",f&&f.rx||0),this.set("ry",f&&f.ry||0)},_set:function(f,r){switch(this.callSuper("_set",f,r),f){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(f){f.beginPath(),f.save(),f.transform(1,0,0,this.ry/this.rx,0,0),f.arc(0,0,this.rx,0,u,!1),f.restore(),this._renderPaintInOrder(f)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(f,r){var a=s.parseAttributes(f,s.Ellipse.ATTRIBUTE_NAMES);a.left=(a.left||0)-a.rx,a.top=(a.top||0)-a.ry,r(new s.Ellipse(a))},s.Ellipse.fromObject=function(f,r){s.Object._fromObject("Ellipse",f,r)}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend;if(s.Rect){s.warn("fabric.Rect is already defined");return}s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(f){this.callSuper("initialize",f),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(f){var r=this.rx?Math.min(this.rx,this.width/2):0,a=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,l=this.height,d=-this.width/2,o=-this.height/2,g=r!==0||a!==0,p=1-.5522847498;f.beginPath(),f.moveTo(d+r,o),f.lineTo(d+i-r,o),g&&f.bezierCurveTo(d+i-p*r,o,d+i,o+p*a,d+i,o+a),f.lineTo(d+i,o+l-a),g&&f.bezierCurveTo(d+i,o+l-p*a,d+i-p*r,o+l,d+i-r,o+l),f.lineTo(d+r,o+l),g&&f.bezierCurveTo(d+p*r,o+l,d,o+l-p*a,d,o+l-a),f.lineTo(d,o+a),g&&f.bezierCurveTo(d,o+p*a,d+p*r,o,d+r,o),f.closePath(),this._renderPaintInOrder(f)},toObject:function(f){return this.callSuper("toObject",["rx","ry"].concat(f))},_toSVG:function(){var f=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',f,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(f,r,a){if(!f)return r(null);a=a||{};var i=s.parseAttributes(f,s.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var l=new s.Rect(u(a?s.util.object.clone(a):{},i));l.visible=l.visible&&l.width>0&&l.height>0,r(l)},s.Rect.fromObject=function(f,r){return s.Object._fromObject("Rect",f,r)}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,f=s.util.array.min,r=s.util.array.max,a=s.util.toFixed,i=s.util.projectStrokeOnPoints;if(s.Polyline){s.warn("fabric.Polyline is already defined");return}s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(l,d){d=d||{},this.points=l||[],this.callSuper("initialize",d),this._setPositionDimensions(d)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(l){var d=this._calcDimensions(l),o,g=this.exactBoundingBox?this.strokeWidth:0;this.width=d.width-g,this.height=d.height-g,l.fromSVG||(o=this.translateToGivenOrigin({x:d.left-this.strokeWidth/2+g/2,y:d.top-this.strokeWidth/2+g/2},"left","top",this.originX,this.originY)),typeof l.left>"u"&&(this.left=l.fromSVG?d.left:o.x),typeof l.top>"u"&&(this.top=l.fromSVG?d.top:o.y),this.pathOffset={x:d.left+this.width/2+g/2,y:d.top+this.height/2+g/2}},_calcDimensions:function(){var l=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,d=f(l,"x")||0,o=f(l,"y")||0,g=r(l,"x")||0,p=r(l,"y")||0,v=g-d,x=p-o;return{left:d,top:o,width:v,height:x}},toObject:function(l){return u(this.callSuper("toObject",l),{points:this.points.concat()})},_toSVG:function(){for(var l=[],d=this.pathOffset.x,o=this.pathOffset.y,g=s.Object.NUM_FRACTION_DIGITS,p=0,v=this.points.length;p<v;p++)l.push(a(this.points[p].x-d,g),",",a(this.points[p].y-o,g)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',l.join(""),`" />
`]},commonRender:function(l){var d,o=this.points.length,g=this.pathOffset.x,p=this.pathOffset.y;if(!o||isNaN(this.points[o-1].y))return!1;l.beginPath(),l.moveTo(this.points[0].x-g,this.points[0].y-p);for(var v=0;v<o;v++)d=this.points[v],l.lineTo(d.x-g,d.y-p);return!0},_render:function(l){this.commonRender(l)&&this._renderPaintInOrder(l)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(l){return function(d,o,g){if(!d)return o(null);g||(g={});var p=s.parsePointsAttribute(d.getAttribute("points")),v=s.parseAttributes(d,s[l].ATTRIBUTE_NAMES);v.fromSVG=!0,o(new s[l](p,u(v,g)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(l,d){return s.Object._fromObject("Polyline",l,d,"points")}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.projectStrokeOnPoints;if(s.Polygon){s.warn("fabric.Polygon is already defined");return}s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return u(this.points,this)},_render:function(f){this.commonRender(f)&&(f.closePath(),this._renderPaintInOrder(f))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(f,r){s.Object._fromObject("Polygon",f,r,"points")}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.array.min,f=s.util.array.max,r=s.util.object.extend,a=s.util.object.clone,i=s.util.toFixed;if(s.Path){s.warn("fabric.Path is already defined");return}s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(l,d){d=a(d||{}),delete d.path,this.callSuper("initialize",d),this._setPath(l||[],d)},_setPath:function(l,d){this.path=s.util.makePathSimpler(Array.isArray(l)?l:s.util.parsePath(l)),s.Polyline.prototype._setPositionDimensions.call(this,d||{})},_renderPathCommands:function(l){var d,o=0,g=0,p=0,v=0,x=0,S=0,C=-this.pathOffset.x,T=-this.pathOffset.y;l.beginPath();for(var O=0,N=this.path.length;O<N;++O)switch(d=this.path[O],d[0]){case"L":p=d[1],v=d[2],l.lineTo(p+C,v+T);break;case"M":p=d[1],v=d[2],o=p,g=v,l.moveTo(p+C,v+T);break;case"C":p=d[5],v=d[6],x=d[3],S=d[4],l.bezierCurveTo(d[1]+C,d[2]+T,x+C,S+T,p+C,v+T);break;case"Q":l.quadraticCurveTo(d[1]+C,d[2]+T,d[3]+C,d[4]+T),p=d[3],v=d[4],x=d[1],S=d[2];break;case"z":case"Z":p=o,v=g,l.closePath();break}},_render:function(l){this._renderPathCommands(l),this._renderPaintInOrder(l)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(l){return r(this.callSuper("toObject",l),{path:this.path.map(function(d){return d.slice()})})},toDatalessObject:function(l){var d=this.toObject(["sourcePath"].concat(l));return d.sourcePath&&delete d.path,d},_toSVG:function(){var l=s.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',l,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var l=s.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,l)+", "+i(-this.pathOffset.y,l)+")"},toClipPathSVG:function(l){var d=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:l,additionalTransform:d})},toSVG:function(l){var d=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,additionalTransform:d})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var l=[],d=[],o,g=0,p=0,v=0,x=0,S,C=0,T=this.path.length;C<T;++C){switch(o=this.path[C],o[0]){case"L":v=o[1],x=o[2],S=[];break;case"M":v=o[1],x=o[2],g=v,p=x,S=[];break;case"C":S=s.util.getBoundsOfCurve(v,x,o[1],o[2],o[3],o[4],o[5],o[6]),v=o[5],x=o[6];break;case"Q":S=s.util.getBoundsOfCurve(v,x,o[1],o[2],o[1],o[2],o[3],o[4]),v=o[3],x=o[4];break;case"z":case"Z":v=g,x=p;break}S.forEach(function(ne){l.push(ne.x),d.push(ne.y)}),l.push(v),d.push(x)}var O=u(l)||0,N=u(d)||0,U=f(l)||0,J=f(d)||0,te=U-O,se=J-N;return{left:O,top:N,width:te,height:se}}}),s.Path.fromObject=function(l,d){if(typeof l.sourcePath=="string"){var o=l.sourcePath;s.loadSVGFromURL(o,function(g){var p=g[0];p.setOptions(l),l.clipPath?s.util.enlivenObjects([l.clipPath],function(v){p.clipPath=v[0],d&&d(p)}):d&&d(p)})}else s.Object._fromObject("Path",l,d,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(l,d,o){var g=s.parseAttributes(l,s.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,d(new s.Path(g.d,r(g,o)))}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.array.min,f=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,a,i){a=a||{},this._objects=[],i&&this.callSuper("initialize",a),this._objects=r||[];for(var l=this._objects.length;l--;)this._objects[l].group=this;if(i)this._updateObjectsACoords();else{var d=a&&a.centerPoint;a.originX!==void 0&&(this.originX=a.originX),a.originY!==void 0&&(this.originY=a.originY),d||this._calcBounds(),this._updateObjectsCoords(d),delete a.centerPoint,this.callSuper("initialize",a)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,a=this._objects.length;a--;)this._objects[a].setCoords(r)},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],a)},_updateObjectCoords:function(r,a){var i=r.left,l=r.top,d=!0;r.set({left:i-a.x,top:l-a.y}),r.group=this,r.setCoords(d)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var a=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),r&&(a&&s.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,a?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,a){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(r,a);if(r==="canvas")for(;i--;)this._objects[i]._set(r,a);s.Object.prototype._set.call(this,r,a)},toObject:function(r){var a=this.includeDefaultValues,i=this._objects.filter(function(d){return!d.excludeFromExport}).map(function(d){var o=d.includeDefaultValues;d.includeDefaultValues=a;var g=d.toObject(r);return d.includeDefaultValues=o,g}),l=s.Object.prototype.toObject.call(this,r);return l.objects=i,l},toDatalessObject:function(r){var a,i=this.sourcePath;if(i)a=i;else{var l=this.includeDefaultValues;a=this._objects.map(function(o){var g=o.includeDefaultValues;o.includeDefaultValues=l;var p=o.toDatalessObject(r);return o.includeDefaultValues=g,p})}var d=s.Object.prototype.toDatalessObject.call(this,r);return d.objects=a,d},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=s.Object.prototype.shouldCache.call(this);if(r){for(var a=0,i=this._objects.length;a<i;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,a=this._objects.length;r<a;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var a=0,i=this._objects.length;a<i;a++)this._objects[a].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var a=0,i=this._objects.length;a<i;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var l=this.cacheWidth/this.zoomX,d=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-l/2,-d/2,l,d)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(a){s.util.addTransformToObject(a,r),delete a.group,a.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,a=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var l=new s.ActiveSelection([]);return l.set(i),l.type="activeSelection",a.remove(this),r.forEach(function(d){d.group=l,d.dirty=!0,a.add(d)}),l.canvas=a,l._objects=r,a._activeObject=l,l.setCoords(),l}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(a){a.setCoords(r)}),this},_calcBounds:function(r){for(var a=[],i=[],l,d,o,g=["tr","br","bl","tl"],p=0,v=this._objects.length,x,S=g.length;p<v;++p){for(l=this._objects[p],o=l.calcACoords(),x=0;x<S;x++)d=g[x],a.push(o[d].x),i.push(o[d].y);l.aCoords=o}this._getBounds(a,i,r)},_getBounds:function(r,a,i){var l=new s.Point(u(r),u(a)),d=new s.Point(f(r),f(a)),o=l.y||0,g=l.x||0,p=d.x-l.x||0,v=d.y-l.y||0;this.width=p,this.height=v,i||this.setPositionByOrigin({x:g,y:o},"left","top")},_toSVG:function(r){for(var a=["<g ","COMMON_PARTS",` >
`],i=0,l=this._objects.length;i<l;i++)a.push("		",this._objects[i].toSVG(r));return a.push(`</g>
`),a},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",a=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),a].join("")},toClipPathSVG:function(r){for(var a=[],i=0,l=this._objects.length;i<l;i++)a.push("	",this._objects[i].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(a,{reviver:r})}}),s.Group.fromObject=function(r,a){var i=r.objects,l=s.util.object.clone(r,!0);if(delete l.objects,typeof i=="string"){s.loadSVGFromURL(i,function(d){var o=s.util.groupSVGElements(d,r,i),g=l.clipPath;delete l.clipPath,o.set(l),g?s.util.enlivenObjects([g],function(p){o.clipPath=p[0],a&&a(o)}):a&&a(o)});return}s.util.enlivenObjects(i,function(d){s.util.enlivenObjectEnlivables(r,l,function(){a&&a(new s.Group(d,l,!0))})})})}(t),function(h){var s=h.fabric||(h.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(u,f){f=f||{},this._objects=u||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;f.originX&&(this.originX=f.originX),f.originY&&(this.originY=f.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,f),this.setCoords()},toGroup:function(){var u=this._objects.concat();this._objects=[];var f=s.Object.prototype.toObject.call(this),r=new s.Group([]);if(delete f.type,r.set(f),u.forEach(function(i){i.canvas.remove(i),i.group=r}),r._objects=u,!this.canvas)return r;var a=this.canvas;return a.add(r),a._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(u,f,r){u.save(),u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var a=0,i=this._objects.length;a<i;a++)this._objects[a]._renderControls(u,r);this.callSuper("_renderControls",u,f),u.restore()}}),s.ActiveSelection.fromObject=function(u,f){s.util.enlivenObjects(u.objects,function(r){delete u.objects,f&&f(new s.ActiveSelection(r,u,!0))})})}(t),function(h){var s=e.util.object.extend;if(h.fabric||(h.fabric={}),h.fabric.Image){e.warn("fabric.Image is already defined.");return}e.Image=e.util.createClass(e.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:e.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:e.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(u,f){f||(f={}),this.filters=[],this.cacheKey="texture"+e.Object.__uid++,this.callSuper("initialize",f),this._initElement(u,f)},getElement:function(){return this._element||{}},setElement:function(u,f){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=u,this._originalElement=u,this._initConfig(f),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(u){var f=e.filterBackend;f&&f.evictCachesForKey&&f.evictCachesForKey(u)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(u){e.util.cleanUpJsdomNode(this[u]),this[u]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var u=this.getElement();return{width:u.naturalWidth||u.width,height:u.naturalHeight||u.height}},_stroke:function(u){if(!(!this.stroke||this.strokeWidth===0)){var f=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-f,-r),u.lineTo(f,-r),u.lineTo(f,r),u.lineTo(-f,r),u.lineTo(-f,-r),u.closePath()}},toObject:function(u){var f=[];this.filters.forEach(function(a){a&&f.push(a.toObject())});var r=s(this.callSuper("toObject",["cropX","cropY"].concat(u)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:f});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var u=[],f=[],r,a=this._element,i=-this.width/2,l=-this.height/2,d="",o="";if(!a)return[];if(this.hasCrop()){var g=e.Object.__uid++;u.push('<clipPath id="imageCrop_'+g+`">
`,'	<rect x="'+i+'" y="'+l+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),d=' clip-path="url(#imageCrop_'+g+')" '}if(this.imageSmoothing||(o='" image-rendering="optimizeSpeed'),f.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',l-this.cropY,'" width="',a.width||a.naturalWidth,'" height="',a.height||a.height,o,'"',d,`></image>
`),this.stroke||this.strokeDashArray){var p=this.fill;this.fill=null,r=["	<rect ",'x="',i,'" y="',l,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=p}return this.paintFirst!=="fill"?u=u.concat(r,f):u=u.concat(f,r),u},getSrc:function(u){var f=u?this._element:this._originalElement;return f?f.toDataURL?f.toDataURL():this.srcFromAttribute?f.getAttribute("src"):f.src:this.src||""},setSrc:function(u,f,r){return e.util.loadImage(u,function(a,i){this.setElement(a,r),this._setWidthHeight(),f&&f(this,i)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var u=this.resizeFilter,f=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),a=r.scaleX,i=r.scaleY,l=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!u||a>f&&i>f){this._element=l,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=a,this._lastScaleY=i;return}e.filterBackend||(e.filterBackend=e.initFilterBackend());var d=e.util.createCanvasElement(),o=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,g=l.width,p=l.height;d.width=g,d.height=p,this._element=d,this._lastScaleX=u.scaleX=a,this._lastScaleY=u.scaleY=i,e.filterBackend.applyFilters([u],l,g,p,this._element,o),this._filterScalingX=d.width/this._originalElement.width,this._filterScalingY=d.height/this._originalElement.height},applyFilters:function(u){if(u=u||this.filters||[],u=u.filter(function(l){return l&&!l.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),u.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var f=this._originalElement,r=f.naturalWidth||f.width,a=f.naturalHeight||f.height;if(this._element===this._originalElement){var i=e.util.createCanvasElement();i.width=r,i.height=a,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,a),this._lastScaleX=1,this._lastScaleY=1;return e.filterBackend||(e.filterBackend=e.initFilterBackend()),e.filterBackend.applyFilters(u,this._originalElement,r,a,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(u),this._renderPaintInOrder(u)},drawCacheOnCanvas:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),e.Object.prototype.drawCacheOnCanvas.call(this,u)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(u){var f=this._element;if(f){var r=this._filterScalingX,a=this._filterScalingY,i=this.width,l=this.height,d=Math.min,o=Math.max,g=o(this.cropX,0),p=o(this.cropY,0),v=f.naturalWidth||f.width,x=f.naturalHeight||f.height,S=g*r,C=p*a,T=d(i*r,v-S),O=d(l*a,x-C),N=-i/2,U=-l/2,J=d(i,v/r-g),te=d(l,x/a-p);f&&u.drawImage(f,S,C,T,O,N,U,J,te)}},_needsResize:function(){var u=this.getTotalObjectScaling();return u.scaleX!==this._lastScaleX||u.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(u,f){this.setElement(e.util.getById(u),f),e.util.addClass(this.getElement(),e.Image.CSS_CANVAS)},_initConfig:function(u){u||(u={}),this.setOptions(u),this._setWidthHeight(u)},_initFilters:function(u,f){u&&u.length?e.util.enlivenObjects(u,function(r){f&&f(r)},"fabric.Image.filters"):f&&f()},_setWidthHeight:function(u){u||(u={});var f=this.getElement();this.width=u.width||f.naturalWidth||f.width||0,this.height=u.height||f.naturalHeight||f.height||0},parsePreserveAspectRatioAttribute:function(){var u=e.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),f=this._element.width,r=this._element.height,a=1,i=1,l=0,d=0,o=0,g=0,p,v=this.width,x=this.height,S={width:v,height:x};return u&&(u.alignX!=="none"||u.alignY!=="none")?(u.meetOrSlice==="meet"&&(a=i=e.util.findScaleToFit(this._element,S),p=(v-f*a)/2,u.alignX==="Min"&&(l=-p),u.alignX==="Max"&&(l=p),p=(x-r*i)/2,u.alignY==="Min"&&(d=-p),u.alignY==="Max"&&(d=p)),u.meetOrSlice==="slice"&&(a=i=e.util.findScaleToCover(this._element,S),p=f-v/a,u.alignX==="Mid"&&(o=p/2),u.alignX==="Max"&&(o=p),p=r-x/i,u.alignY==="Mid"&&(g=p/2),u.alignY==="Max"&&(g=p),f=v/a,r=x/i)):(a=v/f,i=x/r),{width:f,height:r,scaleX:a,scaleY:i,offsetLeft:l,offsetTop:d,cropX:o,cropY:g}}}),e.Image.CSS_CANVAS="canvas-img",e.Image.prototype.getSvgSrc=e.Image.prototype.getSrc,e.Image.fromObject=function(u,f){var r=e.util.object.clone(u);e.util.loadImage(r.src,function(a,i){if(i){f&&f(null,!0);return}e.Image.prototype._initFilters.call(r,r.filters,function(l){r.filters=l||[],e.Image.prototype._initFilters.call(r,[r.resizeFilter],function(d){r.resizeFilter=d[0],e.util.enlivenObjectEnlivables(r,r,function(){var o=new e.Image(a,r);f(o,!1)})})})},null,r.crossOrigin)},e.Image.fromURL=function(u,f,r){e.util.loadImage(u,function(a,i){f&&f(new e.Image(a,r),i)},null,r&&r.crossOrigin)},e.Image.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),e.Image.fromElement=function(u,f,r){var a=e.parseAttributes(u,e.Image.ATTRIBUTE_NAMES);e.Image.fromURL(a["xlink:href"],f,s(r?e.util.object.clone(r):{},a))}}(t),e.util.object.extend(e.Object.prototype,{_getAngleValueForStraighten:function(){var h=this.angle%360;return h>0?Math.round((h-1)/90)*90:Math.round(h/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(h){h=h||{};var s=function(){},u=h.onComplete||s,f=h.onChange||s,r=this;return e.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){r.rotate(a),f()},onComplete:function(){r.setCoords(),u()}})}}),e.util.object.extend(e.StaticCanvas.prototype,{straightenObject:function(h){return h.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(h){return h.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function h(u,f){var r="precision "+f+` float;
void main(){}`,a=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(a,r),u.compileShader(a),!!u.getShaderParameter(a,u.COMPILE_STATUS)}e.isWebglSupported=function(u){if(e.isLikelyNode)return!1;u=u||e.WebglFilterBackend.prototype.tileSize;var f=document.createElement("canvas"),r=f.getContext("webgl")||f.getContext("experimental-webgl"),a=!1;if(r){e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),a=e.maxTextureSize>=u;for(var i=["highp","mediump","lowp"],l=0;l<3;l++)if(h(r,i[l])){e.webGlPrecision=i[l];break}}return this.isSupported=a,a},e.WebglFilterBackend=s;function s(u){u&&u.tileSize&&(this.tileSize=u.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}s.prototype={tileSize:2048,resources:{},setupGLContext:function(u,f){this.dispose(),this.createWebGLCanvas(u,f),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(u,f)},chooseFastestCopyGLTo2DMethod:function(u,f){var r=typeof window.performance<"u",a;try{new ImageData(1,1),a=!0}catch{a=!1}var i=typeof ArrayBuffer<"u",l=typeof Uint8ClampedArray<"u";if(r&&a&&i&&l){var d=e.util.createCanvasElement(),o=new ArrayBuffer(u*f*4);if(e.forceGLPutImageData){this.imageBuffer=o,this.copyGLTo2D=w;return}var g={imageBuffer:o,destinationWidth:u,destinationHeight:f,targetCanvas:d},p,v,x;d.width=u,d.height=f,p=window.performance.now(),y.call(g,this.gl,g),v=window.performance.now()-p,p=window.performance.now(),w.call(g,this.gl,g),x=window.performance.now()-p,v>x?(this.imageBuffer=o,this.copyGLTo2D=w):this.copyGLTo2D=y}},createWebGLCanvas:function(u,f){var r=e.util.createCanvasElement();r.width=u,r.height=f;var a={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=r.getContext("webgl",a);i||(i=r.getContext("experimental-webgl",a)),i&&(i.clearColor(0,0,0,0),this.canvas=r,this.gl=i)},applyFilters:function(u,f,r,a,i,l){var d=this.gl,o;l&&(o=this.getCachedTexture(l,f));var g={originalWidth:f.width||f.originalWidth,originalHeight:f.height||f.originalHeight,sourceWidth:r,sourceHeight:a,destinationWidth:r,destinationHeight:a,context:d,sourceTexture:this.createTexture(d,r,a,!o&&f),targetTexture:this.createTexture(d,r,a),originalTexture:o||this.createTexture(d,r,a,!o&&f),passes:u.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},p=d.createFramebuffer();return d.bindFramebuffer(d.FRAMEBUFFER,p),u.forEach(function(v){v&&v.applyTo(g)}),m(g),this.copyGLTo2D(d,g),d.bindTexture(d.TEXTURE_2D,null),d.deleteTexture(g.sourceTexture),d.deleteTexture(g.targetTexture),d.deleteFramebuffer(p),i.getContext("2d").setTransform(1,0,0,1,0,0),g},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(u,f,r,a,i){var l=u.createTexture();return u.bindTexture(u.TEXTURE_2D,l),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),a?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,a):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,f,r,0,u.RGBA,u.UNSIGNED_BYTE,null),l},getCachedTexture:function(u,f){if(this.textureCache[u])return this.textureCache[u];var r=this.createTexture(this.gl,f.width,f.height,f);return this.textureCache[u]=r,r},evictCachesForKey:function(u){this.textureCache[u]&&(this.gl.deleteTexture(this.textureCache[u]),delete this.textureCache[u])},copyGLTo2D:y,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var u=this.gl,f={renderer:"",vendor:""};if(!u)return f;var r=u.getExtension("WEBGL_debug_renderer_info");if(r){var a=u.getParameter(r.UNMASKED_RENDERER_WEBGL),i=u.getParameter(r.UNMASKED_VENDOR_WEBGL);a&&(f.renderer=a.toLowerCase()),i&&(f.vendor=i.toLowerCase())}return this.gpuInfo=f,f}}}();function m(h){var s=h.targetCanvas,u=s.width,f=s.height,r=h.destinationWidth,a=h.destinationHeight;(u!==r||f!==a)&&(s.width=r,s.height=a)}function y(h,s){var u=h.canvas,f=s.targetCanvas,r=f.getContext("2d");r.translate(0,f.height),r.scale(1,-1);var a=u.height-f.height;r.drawImage(u,0,a,f.width,f.height,0,0,f.width,f.height)}function w(h,s){var u=s.targetCanvas,f=u.getContext("2d"),r=s.destinationWidth,a=s.destinationHeight,i=r*a*4,l=new Uint8Array(this.imageBuffer,0,i),d=new Uint8ClampedArray(this.imageBuffer,0,i);h.readPixels(0,0,r,a,h.RGBA,h.UNSIGNED_BYTE,l);var o=new ImageData(d,r,a);f.putImageData(o,0,0)}(function(){var h=function(){};e.Canvas2dFilterBackend=s;function s(){}s.prototype={evictCachesForKey:h,dispose:h,clearWebGLCaches:h,resources:{},applyFilters:function(u,f,r,a,i){var l=i.getContext("2d");l.drawImage(f,0,0,r,a);var d=l.getImageData(0,0,r,a),o=l.getImageData(0,0,r,a),g={sourceWidth:r,sourceHeight:a,imageData:d,originalEl:f,originalImageData:o,canvasEl:i,ctx:l,filterBackend:this};return u.forEach(function(p){p.applyTo(g)}),(g.imageData.width!==r||g.imageData.height!==a)&&(i.width=g.imageData.width,i.height=g.imageData.height),l.putImageData(g.imageData,0,0),g}}})(),e.Image=e.Image||{},e.Image.filters=e.Image.filters||{},e.Image.filters.BaseFilter=e.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(h){h&&this.setOptions(h)},setOptions:function(h){for(var s in h)this[s]=h[s]},createProgram:function(h,s,u){s=s||this.fragmentSource,u=u||this.vertexSource,e.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+e.webGlPrecision+" float"));var f=h.createShader(h.VERTEX_SHADER);if(h.shaderSource(f,u),h.compileShader(f),!h.getShaderParameter(f,h.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+h.getShaderInfoLog(f));var r=h.createShader(h.FRAGMENT_SHADER);if(h.shaderSource(r,s),h.compileShader(r),!h.getShaderParameter(r,h.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+h.getShaderInfoLog(r));var a=h.createProgram();if(h.attachShader(a,f),h.attachShader(a,r),h.linkProgram(a),!h.getProgramParameter(a,h.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+h.getProgramInfoLog(a));var i=this.getAttributeLocations(h,a),l=this.getUniformLocations(h,a)||{};return l.uStepW=h.getUniformLocation(a,"uStepW"),l.uStepH=h.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:i,uniformLocations:l}},getAttributeLocations:function(h,s){return{aPosition:h.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(h,s,u){var f=s.aPosition,r=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,r),h.enableVertexAttribArray(f),h.vertexAttribPointer(f,2,h.FLOAT,!1,0,0),h.bufferData(h.ARRAY_BUFFER,u,h.STATIC_DRAW)},_setupFrameBuffer:function(h){var s=h.context,u,f;h.passes>1?(u=h.destinationWidth,f=h.destinationHeight,(h.sourceWidth!==u||h.sourceHeight!==f)&&(s.deleteTexture(h.targetTexture),h.targetTexture=h.filterBackend.createTexture(s,u,f)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,h.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(h){h.passes--,h.pass++;var s=h.targetTexture;h.targetTexture=h.sourceTexture,h.sourceTexture=s},isNeutralState:function(){var h=this.mainParameter,s=e.Image.filters[this.type].prototype;if(h)if(Array.isArray(s[h])){for(var u=s[h].length;u--;)if(this[h][u]!==s[h][u])return!1;return!0}else return s[h]===this[h];else return!1},applyTo:function(h){h.webgl?(this._setupFrameBuffer(h),this.applyToWebGL(h),this._swapTextures(h)):this.applyTo2d(h)},retrieveShader:function(h){return h.programCache.hasOwnProperty(this.type)||(h.programCache[this.type]=this.createProgram(h.context)),h.programCache[this.type]},applyToWebGL:function(h){var s=h.context,u=this.retrieveShader(h);h.pass===0&&h.originalTexture?s.bindTexture(s.TEXTURE_2D,h.originalTexture):s.bindTexture(s.TEXTURE_2D,h.sourceTexture),s.useProgram(u.program),this.sendAttributeData(s,u.attributeLocations,h.aPosition),s.uniform1f(u.uniformLocations.uStepW,1/h.sourceWidth),s.uniform1f(u.uniformLocations.uStepH,1/h.sourceHeight),this.sendUniformData(s,u.uniformLocations),s.viewport(0,0,h.destinationWidth,h.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(h,s,u){h.activeTexture(u),h.bindTexture(h.TEXTURE_2D,s),h.activeTexture(h.TEXTURE0)},unbindAdditionalTexture:function(h,s){h.activeTexture(s),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(h){this[this.mainParameter]=h},sendUniformData:function(){},createHelpLayer:function(h){if(!h.helpLayer){var s=document.createElement("canvas");s.width=h.sourceWidth,s.height=h.sourceHeight,h.helpLayer=s}},toObject:function(){var h={type:this.type},s=this.mainParameter;return s&&(h[s]=this[s]),h},toJSON:function(){return this.toObject()}}),e.Image.filters.BaseFilter.fromObject=function(h,s){var u=new e.Image.filters[h.type](h);return s&&s(u),u},function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.ColorMatrix=f(u.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var a=r.imageData,i=a.data,l=i.length,d=this.matrix,o,g,p,v,x,S=this.colorsOnly;for(x=0;x<l;x+=4)o=i[x],g=i[x+1],p=i[x+2],S?(i[x]=o*d[0]+g*d[1]+p*d[2]+d[4]*255,i[x+1]=o*d[5]+g*d[6]+p*d[7]+d[9]*255,i[x+2]=o*d[10]+g*d[11]+p*d[12]+d[14]*255):(v=i[x+3],i[x]=o*d[0]+g*d[1]+p*d[2]+v*d[3]+d[4]*255,i[x+1]=o*d[5]+g*d[6]+p*d[7]+v*d[8]+d[9]*255,i[x+2]=o*d[10]+g*d[11]+p*d[12]+v*d[13]+d[14]*255,i[x+3]=o*d[15]+g*d[16]+p*d[17]+v*d[18]+d[19]*255)},getUniformLocations:function(r,a){return{uColorMatrix:r.getUniformLocation(a,"uColorMatrix"),uConstants:r.getUniformLocation(a,"uConstants")}},sendUniformData:function(r,a){var i=this.matrix,l=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],d=[i[4],i[9],i[14],i[19]];r.uniformMatrix4fv(a.uColorMatrix,!1,l),r.uniform4fv(a.uConstants,d)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Brightness=f(u.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var a=r.imageData,i=a.data,l,d=i.length,o=Math.round(this.brightness*255);for(l=0;l<d;l+=4)i[l]=i[l]+o,i[l+1]=i[l+1]+o,i[l+2]=i[l+2]+o}},getUniformLocations:function(r,a){return{uBrightness:r.getUniformLocation(a,"uBrightness")}},sendUniformData:function(r,a){r.uniform1f(a.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,f=s.Image.filters,r=s.util.createClass;f.Convolute=r(f.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(a){var i=Math.sqrt(this.matrix.length),l=this.type+"_"+i+"_"+(this.opaque?1:0),d=this.fragmentSource[l];return a.programCache.hasOwnProperty(l)||(a.programCache[l]=this.createProgram(a.context,d)),a.programCache[l]},applyTo2d:function(a){var i=a.imageData,l=i.data,d=this.matrix,o=Math.round(Math.sqrt(d.length)),g=Math.floor(o/2),p=i.width,v=i.height,x=a.ctx.createImageData(p,v),S=x.data,C=this.opaque?1:0,T,O,N,U,J,te,se,ne,re,ae,le,G,_;for(le=0;le<v;le++)for(ae=0;ae<p;ae++){for(J=(le*p+ae)*4,T=0,O=0,N=0,U=0,_=0;_<o;_++)for(G=0;G<o;G++)se=le+_-g,te=ae+G-g,!(se<0||se>=v||te<0||te>=p)&&(ne=(se*p+te)*4,re=d[_*o+G],T+=l[ne]*re,O+=l[ne+1]*re,N+=l[ne+2]*re,C||(U+=l[ne+3]*re));S[J]=T,S[J+1]=O,S[J+2]=N,C?S[J+3]=l[J+3]:S[J+3]=U}a.imageData=x},getUniformLocations:function(a,i){return{uMatrix:a.getUniformLocation(i,"uMatrix"),uOpaque:a.getUniformLocation(i,"uOpaque"),uHalfSize:a.getUniformLocation(i,"uHalfSize"),uSize:a.getUniformLocation(i,"uSize")}},sendUniformData:function(a,i){a.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return u(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Grayscale=f(u.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var a=r.imageData,i=a.data,l,d=i.length,o,g=this.mode;for(l=0;l<d;l+=4)g==="average"?o=(i[l]+i[l+1]+i[l+2])/3:g==="lightness"?o=(Math.min(i[l],i[l+1],i[l+2])+Math.max(i[l],i[l+1],i[l+2]))/2:g==="luminosity"&&(o=.21*i[l]+.72*i[l+1]+.07*i[l+2]),i[l]=o,i[l+1]=o,i[l+2]=o},retrieveShader:function(r){var a=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(a)){var i=this.fragmentSource[this.mode];r.programCache[a]=this.createProgram(r.context,i)}return r.programCache[a]},getUniformLocations:function(r,a){return{uMode:r.getUniformLocation(a,"uMode")}},sendUniformData:function(r,a){var i=1;r.uniform1i(a.uMode,i)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Invert=f(u.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var a=r.imageData,i=a.data,l,d=i.length;for(l=0;l<d;l+=4)i[l]=255-i[l],i[l+1]=255-i[l+1],i[l+2]=255-i[l+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,a){return{uInvert:r.getUniformLocation(a,"uInvert")}},sendUniformData:function(r,a){r.uniform1i(a.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,f=s.Image.filters,r=s.util.createClass;f.Noise=r(f.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(a){if(this.noise!==0){var i=a.imageData,l=i.data,d,o=l.length,g=this.noise,p;for(d=0,o=l.length;d<o;d+=4)p=(.5-Math.random())*g,l[d]+=p,l[d+1]+=p,l[d+2]+=p}},getUniformLocations:function(a,i){return{uNoise:a.getUniformLocation(i,"uNoise"),uSeed:a.getUniformLocation(i,"uSeed")}},sendUniformData:function(a,i){a.uniform1f(i.uNoise,this.noise/255),a.uniform1f(i.uSeed,Math.random())},toObject:function(){return u(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Pixelate=f(u.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var a=r.imageData,i=a.data,l=a.height,d=a.width,o,g,p,v,x,S,C,T,O,N,U;for(g=0;g<l;g+=this.blocksize)for(p=0;p<d;p+=this.blocksize)for(o=g*4*d+p*4,v=i[o],x=i[o+1],S=i[o+2],C=i[o+3],N=Math.min(g+this.blocksize,l),U=Math.min(p+this.blocksize,d),T=g;T<N;T++)for(O=p;O<U;O++)o=T*4*d+O*4,i[o]=v,i[o+1]=x,i[o+2]=S,i[o+3]=C},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,a){return{uBlocksize:r.getUniformLocation(a,"uBlocksize"),uStepW:r.getUniformLocation(a,"uStepW"),uStepH:r.getUniformLocation(a,"uStepH")}},sendUniformData:function(r,a){r.uniform1f(a.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.extend,f=s.Image.filters,r=s.util.createClass;f.RemoveColor=r(f.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(a){var i=a.imageData,l=i.data,d,o=this.distance*255,g,p,v,x=new s.Color(this.color).getSource(),S=[x[0]-o,x[1]-o,x[2]-o],C=[x[0]+o,x[1]+o,x[2]+o];for(d=0;d<l.length;d+=4)g=l[d],p=l[d+1],v=l[d+2],g>S[0]&&p>S[1]&&v>S[2]&&g<C[0]&&p<C[1]&&v<C[2]&&(l[d+3]=0)},getUniformLocations:function(a,i){return{uLow:a.getUniformLocation(i,"uLow"),uHigh:a.getUniformLocation(i,"uHigh")}},sendUniformData:function(a,i){var l=new s.Color(this.color).getSource(),d=parseFloat(this.distance),o=[0+l[0]/255-d,0+l[1]/255-d,0+l[2]/255-d,1],g=[l[0]/255+d,l[1]/255+d,l[2]/255+d,1];a.uniform4fv(i.uLow,o),a.uniform4fv(i.uHigh,g)},toObject:function(){return u(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in r)u[a]=f(u.ColorMatrix,{type:a,matrix:r[a],mainParameter:!1,colorsOnly:!0}),s.Image.filters[a].fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric,u=s.Image.filters,f=s.util.createClass;u.BlendColor=f(u.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var a=this.type+"_"+this.mode,i;return r.programCache.hasOwnProperty(a)||(i=this.buildSource(this.mode),r.programCache[a]=this.createProgram(r.context,i)),r.programCache[a]},applyTo2d:function(r){var a=r.imageData,i=a.data,l=i.length,d,o,g,p,v,x,S,C=1-this.alpha;S=new s.Color(this.color).getSource(),d=S[0]*this.alpha,o=S[1]*this.alpha,g=S[2]*this.alpha;for(var T=0;T<l;T+=4)switch(p=i[T],v=i[T+1],x=i[T+2],this.mode){case"multiply":i[T]=p*d/255,i[T+1]=v*o/255,i[T+2]=x*g/255;break;case"screen":i[T]=255-(255-p)*(255-d)/255,i[T+1]=255-(255-v)*(255-o)/255,i[T+2]=255-(255-x)*(255-g)/255;break;case"add":i[T]=p+d,i[T+1]=v+o,i[T+2]=x+g;break;case"diff":case"difference":i[T]=Math.abs(p-d),i[T+1]=Math.abs(v-o),i[T+2]=Math.abs(x-g);break;case"subtract":i[T]=p-d,i[T+1]=v-o,i[T+2]=x-g;break;case"darken":i[T]=Math.min(p,d),i[T+1]=Math.min(v,o),i[T+2]=Math.min(x,g);break;case"lighten":i[T]=Math.max(p,d),i[T+1]=Math.max(v,o),i[T+2]=Math.max(x,g);break;case"overlay":i[T]=d<128?2*p*d/255:255-2*(255-p)*(255-d)/255,i[T+1]=o<128?2*v*o/255:255-2*(255-v)*(255-o)/255,i[T+2]=g<128?2*x*g/255:255-2*(255-x)*(255-g)/255;break;case"exclusion":i[T]=d+p-2*d*p/255,i[T+1]=o+v-2*o*v/255,i[T+2]=g+x-2*g*x/255;break;case"tint":i[T]=d+p*C,i[T+1]=o+v*C,i[T+2]=g+x*C}},getUniformLocations:function(r,a){return{uColor:r.getUniformLocation(a,"uColor")}},sendUniformData:function(r,a){var i=new s.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,r.uniform4fv(a.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric,u=s.Image.filters,f=s.util.createClass;u.BlendImage=f(u.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var a=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(a)||(r.programCache[a]=this.createProgram(r.context,i)),r.programCache[a]},applyToWebGL:function(r){var a=r.context,i=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(a,i,a.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(r,a){return r.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var r=this.image,a=r._element.width,i=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/a,-r.top/i,1]},applyTo2d:function(r){var a=r.imageData,i=r.filterBackend.resources,l=a.data,d=l.length,o=a.width,g=a.height,p,v,x,S,C,T,O,N,U,J,te=this.image,se;i.blendImage||(i.blendImage=s.util.createCanvasElement()),U=i.blendImage,J=U.getContext("2d"),U.width!==o||U.height!==g?(U.width=o,U.height=g):J.clearRect(0,0,o,g),J.setTransform(te.scaleX,0,0,te.scaleY,te.left,te.top),J.drawImage(te._element,0,0,o,g),se=J.getImageData(0,0,o,g).data;for(var ne=0;ne<d;ne+=4)switch(C=l[ne],T=l[ne+1],O=l[ne+2],N=l[ne+3],p=se[ne],v=se[ne+1],x=se[ne+2],S=se[ne+3],this.mode){case"multiply":l[ne]=C*p/255,l[ne+1]=T*v/255,l[ne+2]=O*x/255,l[ne+3]=N*S/255;break;case"mask":l[ne+3]=S;break}},getUniformLocations:function(r,a){return{uTransformMatrix:r.getUniformLocation(a,"uTransformMatrix"),uImage:r.getUniformLocation(a,"uImage")}},sendUniformData:function(r,a){var i=this.calculateMatrix();r.uniform1i(a.uImage,1),r.uniformMatrix3fv(a.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(r,a){s.Image.fromObject(r.image,function(i){var l=s.util.object.clone(r);l.image=i,a(new s.Image.filters.BlendImage(l))})}}(t),function(h){var s=h.fabric||(h.fabric={}),u=Math.pow,f=Math.floor,r=Math.sqrt,a=Math.abs,i=Math.round,l=Math.sin,d=Math.ceil,o=s.Image.filters,g=s.util.createClass;o.Resize=g(o.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(p,v){return{uDelta:p.getUniformLocation(v,"uDelta"),uTaps:p.getUniformLocation(v,"uTaps")}},sendUniformData:function(p,v){p.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),p.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(p){var v=this.getFilterWindow(),x=this.type+"_"+v;if(!p.programCache.hasOwnProperty(x)){var S=this.generateShader(v);p.programCache[x]=this.createProgram(p.context,S)}return p.programCache[x]},getFilterWindow:function(){var p=this.tempScale;return Math.ceil(this.lanczosLobes/p)},getTaps:function(){for(var p=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,x=this.getFilterWindow(),S=new Array(x),C=1;C<=x;C++)S[C-1]=p(C*v);return S},generateShader:function(S){for(var v=new Array(S),x=this.fragmentSourceTOP,S,C=1;C<=S;C++)v[C-1]=C+".0 * uDelta";return x+="uniform float uTaps["+S+`];
`,x+=`void main() {
`,x+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,x+=`  float sum = 1.0;
`,v.forEach(function(T,O){x+="  color += texture2D(uTexture, vTexCoord + "+T+") * uTaps["+O+`];
`,x+="  color += texture2D(uTexture, vTexCoord - "+T+") * uTaps["+O+`];
`,x+="  sum += 2.0 * uTaps["+O+`];
`}),x+=`  gl_FragColor = color / sum;
`,x+="}",x},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(p){p.webgl?(p.passes++,this.width=p.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=p.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),p.destinationWidth=this.dW,this._setupFrameBuffer(p),this.applyToWebGL(p),this._swapTextures(p),p.sourceWidth=p.destinationWidth,this.height=p.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),p.destinationHeight=this.dH,this._setupFrameBuffer(p),this.applyToWebGL(p),this._swapTextures(p),p.sourceHeight=p.destinationHeight):this.applyTo2d(p)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(p){return function(v){if(v>=p||v<=-p)return 0;if(v<11920929e-14&&v>-11920929e-14)return 1;v*=Math.PI;var x=v/p;return l(v)/v*l(x)/x}},applyTo2d:function(p){var v=p.imageData,x=this.scaleX,S=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/S;var C=v.width,T=v.height,O=i(C*x),N=i(T*S),U;this.resizeType==="sliceHack"?U=this.sliceByTwo(p,C,T,O,N):this.resizeType==="hermite"?U=this.hermiteFastResize(p,C,T,O,N):this.resizeType==="bilinear"?U=this.bilinearFiltering(p,C,T,O,N):this.resizeType==="lanczos"&&(U=this.lanczosResize(p,C,T,O,N)),p.imageData=U},sliceByTwo:function(p,v,x,S,C){var T=p.imageData,O=.5,N=!1,U=!1,J=v*O,te=x*O,se=s.filterBackend.resources,ne,re,ae=0,le=0,G=v,_=0;for(se.sliceByTwo||(se.sliceByTwo=document.createElement("canvas")),ne=se.sliceByTwo,(ne.width<v*1.5||ne.height<x)&&(ne.width=v*1.5,ne.height=x),re=ne.getContext("2d"),re.clearRect(0,0,v*1.5,x),re.putImageData(T,0,0),S=f(S),C=f(C);!N||!U;)v=J,x=te,S<f(J*O)?J=f(J*O):(J=S,N=!0),C<f(te*O)?te=f(te*O):(te=C,U=!0),re.drawImage(ne,ae,le,v,x,G,_,J,te),ae=G,le=_,_+=te;return re.getImageData(ae,le,S,C)},lanczosResize:function(p,v,x,S,C){function T(P){var j,X,M,k,L,R,$,E,I,H,Q;for(_.x=(P+.5)*te,D.x=f(_.x),j=0;j<C;j++){for(_.y=(j+.5)*se,D.y=f(_.y),L=0,R=0,$=0,E=0,I=0,X=D.x-ae;X<=D.x+ae;X++)if(!(X<0||X>=v)){H=f(1e3*a(X-_.x)),G[H]||(G[H]={});for(var z=D.y-le;z<=D.y+le;z++)z<0||z>=x||(Q=f(1e3*a(z-_.y)),G[H][Q]||(G[H][Q]=J(r(u(H*ne,2)+u(Q*re,2))/1e3)),M=G[H][Q],M>0&&(k=(z*v+X)*4,L+=M,R+=M*O[k],$+=M*O[k+1],E+=M*O[k+2],I+=M*O[k+3]))}k=(j*S+P)*4,U[k]=R/L,U[k+1]=$/L,U[k+2]=E/L,U[k+3]=I/L}return++P<S?T(P):N}var O=p.imageData.data,N=p.ctx.createImageData(S,C),U=N.data,J=this.lanczosCreate(this.lanczosLobes),te=this.rcpScaleX,se=this.rcpScaleY,ne=2/this.rcpScaleX,re=2/this.rcpScaleY,ae=d(te*this.lanczosLobes/2),le=d(se*this.lanczosLobes/2),G={},_={},D={};return T(0)},bilinearFiltering:function(p,v,x,S,C){var T,O,N,U,J,te,se,ne,re,ae,le,G,_=0,D,P=this.rcpScaleX,j=this.rcpScaleY,X=4*(v-1),M=p.imageData,k=M.data,L=p.ctx.createImageData(S,C),R=L.data;for(se=0;se<C;se++)for(ne=0;ne<S;ne++)for(J=f(P*ne),te=f(j*se),re=P*ne-J,ae=j*se-te,D=4*(te*v+J),le=0;le<4;le++)T=k[D+le],O=k[D+4+le],N=k[D+X+le],U=k[D+X+4+le],G=T*(1-re)*(1-ae)+O*re*(1-ae)+N*ae*(1-re)+U*re*ae,R[_++]=G;return L},hermiteFastResize:function(p,v,x,S,C){for(var T=this.rcpScaleX,O=this.rcpScaleY,N=d(T/2),U=d(O/2),J=p.imageData,te=J.data,se=p.ctx.createImageData(S,C),ne=se.data,re=0;re<C;re++)for(var ae=0;ae<S;ae++){for(var le=(ae+re*S)*4,G=0,_=0,D=0,P=0,j=0,X=0,M=0,k=(re+.5)*O,L=f(re*O);L<(re+1)*O;L++)for(var R=a(k-(L+.5))/U,$=(ae+.5)*T,E=R*R,I=f(ae*T);I<(ae+1)*T;I++){var H=a($-(I+.5))/N,Q=r(E+H*H);Q>1&&Q<-1||(G=2*Q*Q*Q-3*Q*Q+1,G>0&&(H=4*(I+L*v),M+=G*te[H+3],D+=G,te[H+3]<255&&(G=G*te[H+3]/250),P+=G*te[H],j+=G*te[H+1],X+=G*te[H+2],_+=G))}ne[le]=P/_,ne[le+1]=j/_,ne[le+2]=X/_,ne[le+3]=M/D}return se},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Contrast=f(u.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var a=r.imageData,i,d,l=a.data,d=l.length,o=Math.floor(this.contrast*255),g=259*(o+255)/(255*(259-o));for(i=0;i<d;i+=4)l[i]=g*(l[i]-128)+128,l[i+1]=g*(l[i+1]-128)+128,l[i+2]=g*(l[i+2]-128)+128}},getUniformLocations:function(r,a){return{uContrast:r.getUniformLocation(a,"uContrast")}},sendUniformData:function(r,a){r.uniform1f(a.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Saturation=f(u.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var a=r.imageData,i=a.data,l=i.length,d=-this.saturation,o,g;for(o=0;o<l;o+=4)g=Math.max(i[o],i[o+1],i[o+2]),i[o]+=g!==i[o]?(g-i[o])*d:0,i[o+1]+=g!==i[o+1]?(g-i[o+1])*d:0,i[o+2]+=g!==i[o+2]?(g-i[o+2])*d:0}},getUniformLocations:function(r,a){return{uSaturation:r.getUniformLocation(a,"uSaturation")}},sendUniformData:function(r,a){r.uniform1f(a.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Vibrance=f(u.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var a=r.imageData,i=a.data,l=i.length,d=-this.vibrance,o,g,p,v;for(o=0;o<l;o+=4)g=Math.max(i[o],i[o+1],i[o+2]),p=(i[o]+i[o+1]+i[o+2])/3,v=Math.abs(g-p)*2/255*d,i[o]+=g!==i[o]?(g-i[o])*v:0,i[o+1]+=g!==i[o+1]?(g-i[o+1])*v:0,i[o+2]+=g!==i[o+2]?(g-i[o+2])*v:0}},getUniformLocations:function(r,a){return{uVibrance:r.getUniformLocation(a,"uVibrance")}},sendUniformData:function(r,a){r.uniform1f(a.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Blur=f(u.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var a=r.filterBackend.resources,i,l,d=r.imageData.width,o=r.imageData.height;a.blurLayer1||(a.blurLayer1=s.util.createCanvasElement(),a.blurLayer2=s.util.createCanvasElement()),i=a.blurLayer1,l=a.blurLayer2,(i.width!==d||i.height!==o)&&(l.width=i.width=d,l.height=i.height=o);var g=i.getContext("2d"),p=l.getContext("2d"),v=15,x,S,C,T,O=this.blur*.06*.5;for(g.putImageData(r.imageData,0,0),p.clearRect(0,0,d,o),T=-v;T<=v;T++)x=(Math.random()-.5)/4,S=T/v,C=O*S*d+x,p.globalAlpha=1-Math.abs(S),p.drawImage(i,C,x),g.drawImage(l,0,0),p.globalAlpha=1,p.clearRect(0,0,l.width,l.height);for(T=-v;T<=v;T++)x=(Math.random()-.5)/4,S=T/v,C=O*S*o+x,p.globalAlpha=1-Math.abs(S),p.drawImage(i,x,C),g.drawImage(l,0,0),p.globalAlpha=1,p.clearRect(0,0,l.width,l.height);r.ctx.drawImage(i,0,0);var N=r.ctx.getImageData(0,0,i.width,i.height);return g.globalAlpha=1,g.clearRect(0,0,i.width,i.height),N},getUniformLocations:function(r,a){return{delta:r.getUniformLocation(a,"uDelta")}},sendUniformData:function(r,a){var i=this.chooseRightDelta();r.uniform2fv(a.delta,i)},chooseRightDelta:function(){var r=1,a=[0,0],i;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),i=r*this.blur*.12,this.horizontal?a[0]=i:a[1]=i,a}}),u.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Gamma=f(u.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],u.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var a=r.imageData,i=a.data,l=this.gamma,d=i.length,o=1/l[0],g=1/l[1],p=1/l[2],v;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,d=256;v<d;v++)this.rVals[v]=Math.pow(v/255,o)*255,this.gVals[v]=Math.pow(v/255,g)*255,this.bVals[v]=Math.pow(v/255,p)*255;for(v=0,d=i.length;v<d;v+=4)i[v]=this.rVals[i[v]],i[v+1]=this.gVals[i[v+1]],i[v+2]=this.bVals[i[v+2]]},getUniformLocations:function(r,a){return{uGamma:r.getUniformLocation(a,"uGamma")}},sendUniformData:function(r,a){r.uniform3fv(a.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.Composed=f(u.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(a){a.applyTo(r)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(r,a){var i=r.subFilters||[],l=i.map(function(o){return new s.Image.filters[o.type](o)}),d=new s.Image.filters.Composed({subFilters:l});return a&&a(d),d}}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.Image.filters,f=s.util.createClass;u.HueRotation=f(u.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,a=s.util.cos(r),i=s.util.sin(r),l=1/3,d=Math.sqrt(l)*i,o=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=a+o/3,this.matrix[1]=l*o-d,this.matrix[2]=l*o+d,this.matrix[5]=l*o+d,this.matrix[6]=a+l*o,this.matrix[7]=l*o-d,this.matrix[10]=l*o-d,this.matrix[11]=l*o+d,this.matrix[12]=a+l*o},isNeutralState:function(r){return this.calculateMatrix(),u.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),u.BaseFilter.prototype.applyTo.call(this,r)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(h){var s=h.fabric||(h.fabric={}),u=s.util.object.clone;if(s.Text){s.warn("fabric.Text is already defined");return}var f="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(f),cacheProperties:s.Object.prototype.cacheProperties.concat(f),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,a){this.styles=a?a.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",a),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=s.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){if(!this.__skipDimension){if(this._splitText(),this._clearCache(),this.path){var r=this.getHeightOfLine(0)*1.1;this.width=this.path.width+r,this.height=this.path.height+r}else this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight();this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"})}},enlargeSpaces:function(){for(var r,a,i,l,d,o,g,p=0,v=this._textLines.length;p<v;p++)if(!(this.textAlign!=="justify"&&(p===v-1||this.isEndOfWrapping(p)))&&(l=0,d=this._textLines[p],a=this.getLineWidth(p),a<this.width&&(g=this.textLines[p].match(this._reSpacesAndTabs)))){i=g.length,r=(this.width-a)/i;for(var x=0,S=d.length;x<=S;x++)o=this.__charBounds[p][x],this._reSpaceAndTab.test(d[x])?(o.width+=r,o.kernedWidth+=r,o.left+=l,l+=r):o.left+=l}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),a=this.fontSize;return r.width+=a*r.zoomX,r.height+=a*r.zoomY,r},_render:function(r){var a=this.path;a&&!a.isNotVisible()&&a._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,a,i){if(r.textBaseline="alphabetic",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(a,i)},calcTextWidth:function(){for(var r=this.getLineWidth(0),a=1,i=this._textLines.length;a<i;a++){var l=this.getLineWidth(a);l>r&&(r=l)}return r},_renderTextLine:function(r,a,i,l,d,o){this._renderChars(r,a,i,l,d,o)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var a,i,l=r.fillStyle,d,o,g=this._getLeftOffset(),p=this._getTopOffset(),v=0,x=0,S,C,T=this.path,O,N=0,U=this._textLines.length;N<U;N++){if(a=this.getHeightOfLine(N),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",N)){p+=a;continue}d=this._textLines[N],i=this._getLineLeftOffset(N),x=0,v=0,o=this.getValueOfPropertyAt(N,0,"textBackgroundColor");for(var J=0,te=d.length;J<te;J++)S=this.__charBounds[N][J],C=this.getValueOfPropertyAt(N,J,"textBackgroundColor"),T?(r.save(),r.translate(S.renderLeft,S.renderTop),r.rotate(S.angle),r.fillStyle=C,C&&r.fillRect(-S.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),S.width,a/this.lineHeight),r.restore()):C!==o?(O=g+i+v,this.direction==="rtl"&&(O=this.width-O-x),r.fillStyle=o,o&&r.fillRect(O,p,x,a/this.lineHeight),v=S.left,x=S.width,o=C):x+=S.kernedWidth;C&&!T&&(O=g+i+v,this.direction==="rtl"&&(O=this.width-O-x),r.fillStyle=C,r.fillRect(O,p,x,a/this.lineHeight)),p+=a}r.fillStyle=l,this._removeShadow(r)}},getFontCache:function(r){var a=r.fontFamily.toLowerCase();s.charWidthsCache[a]||(s.charWidthsCache[a]={});var i=s.charWidthsCache[a],l=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return i[l]||(i[l]={}),i[l]},_measureChar:function(r,a,i,l){var d=this.getFontCache(a),o=this._getFontDeclaration(a),g=this._getFontDeclaration(l),p=i+r,v=o===g,x,S,C,T=a.fontSize/this.CACHE_FONT_SIZE,O;if(i&&d[i]!==void 0&&(C=d[i]),d[r]!==void 0&&(O=x=d[r]),v&&d[p]!==void 0&&(S=d[p],O=S-C),x===void 0||C===void 0||S===void 0){var N=this.getMeasuringContext();this._setTextStyles(N,a,!0)}return x===void 0&&(O=x=N.measureText(r).width,d[r]=x),C===void 0&&v&&i&&(C=N.measureText(i).width,d[i]=C),v&&S===void 0&&(S=N.measureText(p).width,d[p]=S,O=S-C),{width:x*T,kernedWidth:O*T}},getHeightOfChar:function(r,a){return this.getValueOfPropertyAt(r,a,"fontSize")},measureLine:function(r){var a=this._measureLine(r);return this.charSpacing!==0&&(a.width-=this._getWidthOfCharSpacing()),a.width<0&&(a.width=0),a},_measureLine:function(r){var a=0,i,l,d=this._textLines[r],o,g,p=0,v=new Array(d.length),x=0,S,C,T=this.path,O=this.pathSide==="right";for(this.__charBounds[r]=v,i=0;i<d.length;i++)l=d[i],g=this._getGraphemeBox(l,r,i,o),v[i]=g,a+=g.kernedWidth,o=l;if(v[i]={left:g?g.left+g.width:0,width:0,kernedWidth:0,height:this.fontSize},T){switch(C=T.segmentsInfo[T.segmentsInfo.length-1].length,S=s.util.getPointOnPath(T.path,0,T.segmentsInfo),S.x+=T.pathOffset.x,S.y+=T.pathOffset.y,this.textAlign){case"left":x=O?C-a:0;break;case"center":x=(C-a)/2;break;case"right":x=O?0:C-a;break}for(x+=this.pathStartOffset*(O?-1:1),i=O?d.length-1:0;O?i>=0:i<d.length;O?i--:i++)g=v[i],x>C?x%=C:x<0&&(x+=C),this._setGraphemeOnPath(x,g,S),x+=g.kernedWidth}return{width:a,numOfSpaces:p}},_setGraphemeOnPath:function(r,a,i){var l=r+a.kernedWidth/2,d=this.path,o=s.util.getPointOnPath(d.path,l,d.segmentsInfo);a.renderLeft=o.x-i.x,a.renderTop=o.y-i.y,a.angle=o.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,a,i,l,d){var o=this.getCompleteStyleDeclaration(a,i),g=l?this.getCompleteStyleDeclaration(a,i-1):{},p=this._measureChar(r,o,l,g),v=p.kernedWidth,x=p.width,S;this.charSpacing!==0&&(S=this._getWidthOfCharSpacing(),x+=S,v+=S);var C={width:x,left:0,height:o.fontSize,kernedWidth:v,deltaY:o.deltaY};if(i>0&&!d){var T=this.__charBounds[a][i-1];C.left=T.left+T.width+p.kernedWidth-p.width}return C},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var a=this._textLines[r],i=this.getHeightOfChar(r,0),l=1,d=a.length;l<d;l++)i=Math.max(this.getHeightOfChar(r,l),i);return this.__lineHeights[r]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,a=0,i=0,l=this._textLines.length;i<l;i++)r=this.getHeightOfLine(i),a+=i===l-1?r/this.lineHeight:r;return a},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,a){r.save();for(var i=0,l=this._getLeftOffset(),d=this._getTopOffset(),o=0,g=this._textLines.length;o<g;o++){var p=this.getHeightOfLine(o),v=p/this.lineHeight,x=this._getLineLeftOffset(o);this._renderTextLine(a,r,this._textLines[o],l+x,d+i+v,o),i+=p}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,a,i,l,d,o){var g=this.getHeightOfLine(o),p=this.textAlign.indexOf("justify")!==-1,v,x,S="",C,T=0,O,N=this.path,U=!p&&this.charSpacing===0&&this.isEmptyStyles(o)&&!N,J=this.direction==="ltr",te=this.direction==="ltr"?1:-1,se,ne=a.canvas.getAttribute("dir");if(a.save(),ne!==this.direction&&(a.canvas.setAttribute("dir",J?"ltr":"rtl"),a.direction=J?"ltr":"rtl",a.textAlign=J?"left":"right"),d-=g*this._fontSizeFraction/this.lineHeight,U){this._renderChar(r,a,o,0,i.join(""),l,d,g),a.restore();return}for(var re=0,ae=i.length-1;re<=ae;re++)O=re===ae||this.charSpacing||N,S+=i[re],C=this.__charBounds[o][re],T===0?(l+=te*(C.kernedWidth-C.width),T+=C.width):T+=C.kernedWidth,p&&!O&&this._reSpaceAndTab.test(i[re])&&(O=!0),O||(v=v||this.getCompleteStyleDeclaration(o,re),x=this.getCompleteStyleDeclaration(o,re+1),O=s.util.hasStyleChanged(v,x,!1)),O&&(N?(a.save(),a.translate(C.renderLeft,C.renderTop),a.rotate(C.angle),this._renderChar(r,a,o,re,S,-T/2,0,g),a.restore()):(se=l,this._renderChar(r,a,o,re,S,se,d,g)),S="",v=x,l+=te*T,T=0);a.restore()},_applyPatternGradientTransformText:function(r){var a=s.util.createCanvasElement(),i,l=this.width+this.strokeWidth,d=this.height+this.strokeWidth;return a.width=l,a.height=d,i=a.getContext("2d"),i.beginPath(),i.moveTo(0,0),i.lineTo(l,0),i.lineTo(l,d),i.lineTo(0,d),i.closePath(),i.translate(l/2,d/2),i.fillStyle=r.toLive(i),this._applyPatternGradientTransform(i,r),i.fill(),i.createPattern(a,"no-repeat")},handleFiller:function(r,a,i){var l,d;return i.toLive?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(l=-this.width/2,d=-this.height/2,r.translate(l,d),r[a]=this._applyPatternGradientTransformText(i),{offsetX:l,offsetY:d}):(r[a]=i.toLive(r,this),this._applyPatternGradientTransform(r,i)):(r[a]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,a){return r.lineWidth=a.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",a.stroke)},_setFillStyles:function(r,a){return this.handleFiller(r,"fillStyle",a.fill)},_renderChar:function(r,a,i,l,d,o,g){var p=this._getStyleDeclaration(i,l),v=this.getCompleteStyleDeclaration(i,l),x=r==="fillText"&&v.fill,S=r==="strokeText"&&v.stroke&&v.strokeWidth,C,T;!S&&!x||(a.save(),x&&(C=this._setFillStyles(a,v)),S&&(T=this._setStrokeStyles(a,v)),a.font=this._getFontDeclaration(v),p&&p.textBackgroundColor&&this._removeShadow(a),p&&p.deltaY&&(g+=p.deltaY),x&&a.fillText(d,o-C.offsetX,g-C.offsetY),S&&a.strokeText(d,o-T.offsetX,g-T.offsetY),a.restore())},setSuperscript:function(r,a){return this._setScript(r,a,this.superscript)},setSubscript:function(r,a){return this._setScript(r,a,this.subscript)},_setScript:function(r,a,i){var l=this.get2DCursorLocation(r,!0),d=this.getValueOfPropertyAt(l.lineIndex,l.charIndex,"fontSize"),o=this.getValueOfPropertyAt(l.lineIndex,l.charIndex,"deltaY"),g={fontSize:d*i.size,deltaY:o+d*i.baseline};return this.setSelectionStyles(g,r,a),this},_getLineLeftOffset:function(r){var a=this.getLineWidth(r),i=this.width-a,l=this.textAlign,d=this.direction,g,o=0,g=this.isEndOfWrapping(r);return l==="justify"||l==="justify-center"&&!g||l==="justify-right"&&!g||l==="justify-left"&&!g?0:(l==="center"&&(o=i/2),l==="right"&&(o=i),l==="justify-center"&&(o=i/2),l==="justify-right"&&(o=i),d==="rtl"&&(o-=i),o)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var a=this.measureLine(r),i=a.width;return this.__lineWidths[r]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,a,i){var l=this._getStyleDeclaration(r,a);return l&&typeof l[i]<"u"?l[i]:this[i]},_renderTextDecoration:function(r,a){if(!(!this[a]&&!this.styleHas(a))){r.save(),(a==="overline"||a==="linethrough")&&this._removeShadow(r);for(var i,l,d,o,g,p,v,x,S=this._getLeftOffset(),C=this._getTopOffset(),T,O,N,U,J,te,se,ne,re=this.path,ae=this._getWidthOfCharSpacing(),le=this.offsets[a],G=0,_=this._textLines.length;G<_;G++){if(i=this.getHeightOfLine(G),!this[a]&&!this.styleHas(a,G)){C+=i;continue}v=this._textLines[G],te=i/this.lineHeight,o=this._getLineLeftOffset(G),O=0,N=0,x=this.getValueOfPropertyAt(G,0,a),ne=this.getValueOfPropertyAt(G,0,"fill"),T=C+te*(1-this._fontSizeFraction),l=this.getHeightOfChar(G,0),g=this.getValueOfPropertyAt(G,0,"deltaY");for(var D=0,P=v.length;D<P;D++)if(U=this.__charBounds[G][D],J=this.getValueOfPropertyAt(G,D,a),se=this.getValueOfPropertyAt(G,D,"fill"),d=this.getHeightOfChar(G,D),p=this.getValueOfPropertyAt(G,D,"deltaY"),re&&J&&se)r.save(),r.fillStyle=ne,r.translate(U.renderLeft,U.renderTop),r.rotate(U.angle),r.fillRect(-U.kernedWidth/2,le*d+p,U.kernedWidth,this.fontSize/15),r.restore();else if((J!==x||se!==ne||d!==l||p!==g)&&N>0){var j=S+o+O;this.direction==="rtl"&&(j=this.width-j-N),x&&ne&&(r.fillStyle=ne,r.fillRect(j,T+le*l+g,N,this.fontSize/15)),O=U.left,N=U.width,x=J,ne=se,l=d,g=p}else N+=U.kernedWidth;var j=S+o+O;this.direction==="rtl"&&(j=this.width-j-N),r.fillStyle=se,J&&se&&r.fillRect(j,T+le*l+g,N-ae,this.fontSize/15),C+=i}r.restore()}},_getFontDeclaration:function(r,a){var i=r||this,l=this.fontFamily,d=s.Text.genericFonts.indexOf(l.toLowerCase())>-1,o=l===void 0||l.indexOf("'")>-1||l.indexOf(",")>-1||l.indexOf('"')>-1||d?i.fontFamily:'"'+i.fontFamily+'"';return[s.isLikelyNode?i.fontWeight:i.fontStyle,s.isLikelyNode?i.fontStyle:i.fontWeight,a?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",o].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var a=r.split(this._reNewline),i=new Array(a.length),l=[`
`],d=[],o=0;o<a.length;o++)i[o]=s.util.string.graphemeSplit(a[o]),d=d.concat(i[o],l);return d.pop(),{_unwrappedLines:i,lines:a,graphemeText:d,graphemeLines:i}},toObject:function(r){var a=f.concat(r),i=this.callSuper("toObject",a);return i.styles=s.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(r,a){this.callSuper("set",r,a);var i=!1,l=!1;if(typeof r=="object")for(var d in r)d==="path"&&this.setPathInfo(),i=i||this._dimensionAffectingProps.indexOf(d)!==-1,l=l||d==="path";else i=this._dimensionAffectingProps.indexOf(r)!==-1,l=r==="path";return l&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(r,a,i){if(!r)return a(null);var l=s.parseAttributes(r,s.Text.ATTRIBUTE_NAMES),d=l.textAnchor||"left";if(i=s.util.object.extend(i?u(i):{},l),i.top=i.top||0,i.left=i.left||0,l.textDecoration){var o=l.textDecoration;o.indexOf("underline")!==-1&&(i.underline=!0),o.indexOf("overline")!==-1&&(i.overline=!0),o.indexOf("line-through")!==-1&&(i.linethrough=!0),delete i.textDecoration}"dx"in l&&(i.left+=l.dx),"dy"in l&&(i.top+=l.dy),"fontSize"in i||(i.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var g="";"textContent"in r?g=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(g=r.firstChild.data),g=g.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var p=i.strokeWidth;i.strokeWidth=0;var v=new s.Text(g,i),x=v.getScaledHeight()/v.height,S=(v.height+v.strokeWidth)*v.lineHeight-v.height,C=S*x,T=v.getScaledHeight()+C,O=0;d==="center"&&(O=v.getScaledWidth()/2),d==="right"&&(O=v.getScaledWidth()),v.set({left:v.left-O,top:v.top-(T-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:typeof p<"u"?p:1}),a(v)},s.Text.fromObject=function(r,a){var i=u(r),l=r.path;return delete i.path,s.Object._fromObject("Text",i,function(d){d.styles=s.util.stylesFromArray(r.styles,r.text),l?s.Object._fromObject("Path",l,function(o){d.set("path",o),a(d)},"path"):a(d)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}(t),function(){e.util.object.extend(e.Text.prototype,{isEmptyStyles:function(h){if(!this.styles||typeof h<"u"&&!this.styles[h])return!0;var s=typeof h>"u"?this.styles:{line:this.styles[h]};for(var u in s)for(var f in s[u])for(var r in s[u][f])return!1;return!0},styleHas:function(h,s){if(!this.styles||!h||h===""||typeof s<"u"&&!this.styles[s])return!1;var u=typeof s>"u"?this.styles:{0:this.styles[s]};for(var f in u)for(var r in u[f])if(typeof u[f][r][h]<"u")return!0;return!1},cleanStyle:function(h){if(!this.styles||!h||h==="")return!1;var s=this.styles,u=0,f,r,a=!0,i=0,l;for(var d in s){f=0;for(var o in s[d]){var l=s[d][o],g=l.hasOwnProperty(h);u++,g?(r?l[h]!==r&&(a=!1):r=l[h],l[h]===this[h]&&delete l[h]):a=!1,Object.keys(l).length!==0?f++:delete s[d][o]}f===0&&delete s[d]}for(var p=0;p<this._textLines.length;p++)i+=this._textLines[p].length;a&&u===i&&(this[h]=r,this.removeStyle(h))},removeStyle:function(h){if(!(!this.styles||!h||h==="")){var s=this.styles,u,f,r;for(f in s){u=s[f];for(r in u)delete u[r][h],Object.keys(u[r]).length===0&&delete u[r];Object.keys(u).length===0&&delete s[f]}}},_extendStyles:function(h,s){var u=this.get2DCursorLocation(h);this._getLineStyle(u.lineIndex)||this._setLineStyle(u.lineIndex),this._getStyleDeclaration(u.lineIndex,u.charIndex)||this._setStyleDeclaration(u.lineIndex,u.charIndex,{}),e.util.object.extend(this._getStyleDeclaration(u.lineIndex,u.charIndex),s)},get2DCursorLocation:function(h,s){typeof h>"u"&&(h=this.selectionStart);for(var u=s?this._unwrappedTextLines:this._textLines,f=u.length,r=0;r<f;r++){if(h<=u[r].length)return{lineIndex:r,charIndex:h};h-=u[r].length+this.missingNewlineOffset(r,s)}return{lineIndex:r-1,charIndex:u[r-1].length<h?u[r-1].length:h}},getSelectionStyles:function(h,s,u){typeof h>"u"&&(h=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||h);for(var f=[],r=h;r<s;r++)f.push(this.getStyleAtPosition(r,u));return f},getStyleAtPosition:function(h,s){var u=this.get2DCursorLocation(h),f=s?this.getCompleteStyleDeclaration(u.lineIndex,u.charIndex):this._getStyleDeclaration(u.lineIndex,u.charIndex);return f||{}},setSelectionStyles:function(h,s,u){typeof s>"u"&&(s=this.selectionStart||0),typeof u>"u"&&(u=this.selectionEnd||s);for(var f=s;f<u;f++)this._extendStyles(f,h);return this._forceClearCache=!0,this},_getStyleDeclaration:function(h,s){var u=this.styles&&this.styles[h];return u?u[s]:null},getCompleteStyleDeclaration:function(h,s){for(var u=this._getStyleDeclaration(h,s)||{},f={},r,a=0;a<this._styleProperties.length;a++)r=this._styleProperties[a],f[r]=typeof u[r]>"u"?this[r]:u[r];return f},_setStyleDeclaration:function(h,s,u){this.styles[h][s]=u},_deleteStyleDeclaration:function(h,s){delete this.styles[h][s]},_getLineStyle:function(h){return!!this.styles[h]},_setLineStyle:function(h){this.styles[h]={}},_deleteLineStyle:function(h){delete this.styles[h]}})}(),function(){function h(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}e.IText=e.util.createClass(e.Text,e.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,u){this.callSuper("initialize",s,u),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,u){this[s]!==u&&(this._fireSelectionChanged(),this[s]=u),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var u=this.canvas.contextTop,f=this.canvas.viewportTransform;u.save(),u.transform(f[0],f[1],f[2],f[3],f[4],f[5]),this.transform(u),this._clearTextArea(u),s||u.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var s=this._getCursorBoundaries(),u=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,u):this.renderSelection(s,u),u.restore()}},_clearTextArea:function(s){var u=this.width+4,f=this.height+4;s.clearRect(-u/2,-f/2,u,f)},_getCursorBoundaries:function(s){typeof s>"u"&&(s=this.selectionStart);var u=this._getLeftOffset(),f=this._getTopOffset(),r=this._getCursorBoundariesOffsets(s);return{left:u,top:f,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var u,f,r,a=0,i=0,l,d=this.get2DCursorLocation(s);r=d.charIndex,f=d.lineIndex;for(var o=0;o<f;o++)a+=this.getHeightOfLine(o);u=this._getLineLeftOffset(f);var g=this.__charBounds[f][r];return g&&(i=g.left),this.charSpacing!==0&&r===this._textLines[f].length&&(i-=this._getWidthOfCharSpacing()),l={top:a,left:u+(i>0?i:0)},this.direction==="rtl"&&(l.left*=-1),this.cursorOffsetCache=l,this.cursorOffsetCache},renderCursor:function(s,u){var f=this.get2DCursorLocation(),r=f.lineIndex,a=f.charIndex>0?f.charIndex-1:0,i=this.getValueOfPropertyAt(r,a,"fontSize"),l=this.scaleX*this.canvas.getZoom(),d=this.cursorWidth/l,o=s.topOffset,g=this.getValueOfPropertyAt(r,a,"deltaY");o+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,u),u.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,a,"fill"),u.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,u.fillRect(s.left+s.leftOffset-d/2,o+s.top+g,d,i)},renderSelection:function(s,u){for(var f=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=this.textAlign.indexOf("justify")!==-1,i=this.get2DCursorLocation(f),l=this.get2DCursorLocation(r),d=i.lineIndex,o=l.lineIndex,g=i.charIndex<0?0:i.charIndex,p=l.charIndex<0?0:l.charIndex,v=d;v<=o;v++){var x=this._getLineLeftOffset(v)||0,S=this.getHeightOfLine(v),C=0,T=0,O=0;if(v===d&&(T=this.__charBounds[d][g].left),v>=d&&v<o)O=a&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===o)if(p===0)O=this.__charBounds[o][p].left;else{var N=this._getWidthOfCharSpacing();O=this.__charBounds[o][p-1].left+this.__charBounds[o][p-1].width-N}C=S,(this.lineHeight<1||v===o&&this.lineHeight>1)&&(S/=this.lineHeight);var U=s.left+x+T,J=O-T,te=S,se=0;this.inCompositionMode?(u.fillStyle=this.compositionColor||"black",te=1,se=S):u.fillStyle=this.selectionColor,this.direction==="rtl"&&(U=this.width-U-J),u.fillRect(U,s.top+s.topOffset+se,J,te),s.topOffset+=C}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),u=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:u}}}),e.IText.fromObject=function(s,u){var f=e.util.stylesFromArray(s.styles,s.text),r=Object.assign({},s,{styles:f});if(delete r.path,h(r),r.styles)for(var a in r.styles)for(var i in r.styles[a])h(r.styles[a][i]);e.Object._fromObject("IText",r,function(l){s.path?e.Object._fromObject("Path",s.path,function(d){l.set("path",d),u(l)},"path"):u(l)},"text")}}(),function(){var h=e.util.object.clone;e.util.object.extend(e.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var u=s.canvas;u&&(u._hasITextHandlers||(u._hasITextHandlers=!0,s._initCanvasHandlers(u)),u._iTextInstances=u._iTextInstances||[],u._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var u=s.canvas;u&&(u._iTextInstances=u._iTextInstances||[],e.util.removeFromArray(u._iTextInstances,s),u._iTextInstances.length===0&&(u._hasITextHandlers=!1,s._removeCanvasHandlers(u)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,u,f,r){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",u,{duration:f,onComplete:function(){a.isAborted||s[r]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var u=this,f=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){u._tick()},f)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,u=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&u&&u.clearContext(u.contextTop||u.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var u=0,f=s-1;if(this._reSpace.test(this._text[f]))for(;this._reSpace.test(this._text[f]);)u++,f--;for(;/\S/.test(this._text[f])&&f>-1;)u++,f--;return s-u},findWordBoundaryRight:function(s){var u=0,f=s;if(this._reSpace.test(this._text[f]))for(;this._reSpace.test(this._text[f]);)u++,f++;for(;/\S/.test(this._text[f])&&f<this._text.length;)u++,f++;return s+u},findLineBoundaryLeft:function(s){for(var u=0,f=s-1;!/\n/.test(this._text[f])&&f>-1;)u++,f--;return s-u},findLineBoundaryRight:function(s){for(var u=0,f=s;!/\n/.test(this._text[f])&&f<this._text.length;)u++,f++;return s+u},searchWordBoundary:function(s,u){for(var f=this._text,r=this._reSpace.test(f[s])?s-1:s,a=f[r],i=e.reNonWord;!i.test(a)&&r>0&&r<f.length;)r+=u,a=f[r];return i.test(a)&&(r+=u===1?0:1),r},selectWord:function(s){s=s||this.selectionStart;var u=this.searchWordBoundary(s,-1),f=this.searchWordBoundary(s,1);this.selectionStart=u,this.selectionEnd=f,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var u=this.findLineBoundaryLeft(s),f=this.findLineBoundaryRight(s);return this.selectionStart=u,this.selectionEnd=f,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.selected=!1,u.isEditing&&u.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var u=this.getSelectionStartFromPointer(s.e),f=this.selectionStart,r=this.selectionEnd;(u!==this.__selectionStartOnMouseDown||f===r)&&(f===u||r===u)||(u>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=u):(this.selectionStart=u,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==f||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,u,f){var r=f.slice(0,s),a=e.util.string.graphemeSplit(r).length;if(s===u)return{selectionStart:a,selectionEnd:a};var i=f.slice(s,u),l=e.util.string.graphemeSplit(i).length;return{selectionStart:a,selectionEnd:a+l}},fromGraphemeToStringSelection:function(s,u,f){var r=f.slice(0,s),a=r.join("").length;if(s===u)return{selectionStart:a,selectionEnd:a};var i=f.slice(s,u),l=i.join("").length;return{selectionStart:a,selectionEnd:a+l}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,u=this._getCursorBoundaries(s),f=this.get2DCursorLocation(s),r=f.lineIndex,a=f.charIndex,i=this.getValueOfPropertyAt(r,a,"fontSize")*this.lineHeight,l=u.leftOffset,d=this.calcTransformMatrix(),o={x:u.left+l,y:u.top+u.topOffset+i},g=this.canvas.getRetinaScaling(),p=this.canvas.upperCanvasEl,v=p.width/g,x=p.height/g,S=v-i,C=x-i,T=p.clientWidth/v,O=p.clientHeight/x;return o=e.util.transformPoint(o,d),o=e.util.transformPoint(o,this.canvas.viewportTransform),o.x*=T,o.y*=O,o.x<0&&(o.x=0),o.x>S&&(o.x=S),o.y<0&&(o.y=0),o.y>C&&(o.y=C),o.x+=this.canvas._offset.left,o.y+=this.canvas._offset.top,{left:o.x+"px",top:o.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,u=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,u&&(u.blur&&u.blur(),u.parentNode&&u.parentNode.removeChild(u)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,u){var f=this.get2DCursorLocation(s,!0),r=this.get2DCursorLocation(u,!0),a=f.lineIndex,i=f.charIndex,l=r.lineIndex,d=r.charIndex,o,g;if(a!==l){if(this.styles[a])for(o=i;o<this._unwrappedTextLines[a].length;o++)delete this.styles[a][o];if(this.styles[l])for(o=d;o<this._unwrappedTextLines[l].length;o++)g=this.styles[l][o],g&&(this.styles[a]||(this.styles[a]={}),this.styles[a][i+o-d]=g);for(o=a+1;o<=l;o++)delete this.styles[o];this.shiftLineStyles(l,a-l)}else if(this.styles[a]){g=this.styles[a];var p=d-i,v,x;for(o=i;o<d;o++)delete g[o];for(x in this.styles[a])v=parseInt(x,10),v>=d&&(g[v-p]=g[x],delete g[x])}},shiftLineStyles:function(s,u){var f=h(this.styles);for(var r in this.styles){var a=parseInt(r,10);a>s&&(this.styles[a+u]=f[a],f[a-u]||delete this.styles[a])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(s,u,f,r){var a,i={},l=!1,d=this._unwrappedTextLines[s].length,o=d===u;f||(f=1),this.shiftLineStyles(s,f),this.styles[s]&&(a=this.styles[s][u===0?u:u-1]);for(var g in this.styles[s]){var p=parseInt(g,10);p>=u&&(l=!0,i[p-u]=this.styles[s][g],o&&u===0||delete this.styles[s][g])}var v=!1;for(l&&!o&&(this.styles[s+f]=i,v=!0),(v||d>u)&&f--;f>0;)r&&r[f-1]?this.styles[s+f]={0:h(r[f-1])}:a?this.styles[s+f]={0:h(a)}:delete this.styles[s+f],f--;this._forceClearCache=!0},insertCharStyleObject:function(s,u,f,r){this.styles||(this.styles={});var a=this.styles[s],i=a?h(a):{};f||(f=1);for(var l in i){var d=parseInt(l,10);d>=u&&(a[d+f]=i[d],i[d-f]||delete a[d])}if(this._forceClearCache=!0,r){for(;f--;)Object.keys(r[f]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][u+f]=h(r[f]));return}if(a)for(var o=a[u?u-1:1];o&&f--;)this.styles[s][u+f]=h(o)},insertNewStyleBlock:function(s,u,f){for(var r=this.get2DCursorLocation(u,!0),a=[0],i=0,l=0;l<s.length;l++)s[l]===`
`?(i++,a[i]=0):a[i]++;a[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,a[0],f),f=f&&f.slice(a[0]+1)),i&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+a[0],i);for(var l=1;l<i;l++)a[l]>0?this.insertCharStyleObject(r.lineIndex+l,0,a[l],f):f&&this.styles[r.lineIndex+l]&&f[0]&&(this.styles[r.lineIndex+l][0]=f[0]),f=f&&f.slice(a[l]+1);a[l]>0&&this.insertCharStyleObject(r.lineIndex+l,0,a[l],f)},setSelectionStartEndWithShift:function(s,u,f){f<=s?(u===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=f):f>s&&f<u?this._selectionDirection==="right"?this.selectionEnd=f:this.selectionStart=f:(u===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=u),this.selectionEnd=f)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),e.util.object.extend(e.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(h){if(this.canvas){this.__newClickTime=+new Date;var s=h.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",h),this._stopEvent(h.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(h){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===h.x&&this.__lastPointer.y===h.y},_stopEvent:function(h){h.preventDefault&&h.preventDefault(),h.stopPropagation&&h.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(h){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(h.e))},tripleClickHandler:function(h){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(h.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(h.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(h){!this.canvas||!this.editable||h.e.button&&h.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(h){if(this.__isMousedown=!1,!(!this.editable||this.group||h.transform&&h.transform.actionPerformed||h.e.button&&h.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(h.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(h){var s=this.getSelectionStartFromPointer(h),u=this.selectionStart,f=this.selectionEnd;h.shiftKey?this.setSelectionStartEndWithShift(u,f,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(h){for(var s=this.getLocalPointer(h),u=0,f=0,r=0,a=0,i=0,l,d,o=0,g=this._textLines.length;o<g&&r<=s.y;o++)r+=this.getHeightOfLine(o)*this.scaleY,i=o,o>0&&(a+=this._textLines[o-1].length+this.missingNewlineOffset(o-1));l=this._getLineLeftOffset(i),f=l*this.scaleX,d=this._textLines[i],this.direction==="rtl"&&(s.x=this.width*this.scaleX-s.x+f);for(var p=0,v=d.length;p<v&&(u=f,f+=this.__charBounds[i][p].kernedWidth*this.scaleX,f<=s.x);p++)a++;return this._getNewSelectionStartFromOffset(s,u,f,a,v)},_getNewSelectionStartFromOffset:function(h,s,u,f,r){var a=h.x-s,i=u-h.x,l=i>a||i<0?0:1,d=f+l;return this.flipX&&(d=r-d),d>this._text.length&&(d=this._text.length),d}}),e.util.object.extend(e.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=e.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var h=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+h.top+"; left: "+h.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+h.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):e.document.body.appendChild(this.hiddenTextarea),e.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),e.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),e.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),e.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(e.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(h){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(h.keyCode in s)this[s[h.keyCode]](h);else if(h.keyCode in this.ctrlKeysMapDown&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapDown[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),h.keyCode>=33&&h.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(h){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(h.keyCode in this.ctrlKeysMapUp&&(h.ctrlKey||h.metaKey))this[this.ctrlKeysMapUp[h.keyCode]](h);else return;h.stopImmediatePropagation(),h.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(h){var s=this.fromPaste;if(this.fromPaste=!1,h&&h.stopPropagation(),!!this.isEditing){var u=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,f=this._text.length,r=u.length,a,i,l=r-f,d=this.selectionStart,o=this.selectionEnd,g=d!==o,p,v,x;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var S=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),C=d>S.selectionStart;g?(a=this._text.slice(d,o),l+=o-d):r<f&&(C?a=this._text.slice(o+l,o):a=this._text.slice(d,d-l)),i=u.slice(S.selectionEnd-l,S.selectionEnd),a&&a.length&&(i.length&&(p=this.getSelectionStyles(d,d+1,!1),p=i.map(function(){return p[0]})),g?(v=d,x=o):C?(v=o-a.length,x=o):(v=o,x=o+a.length),this.removeStyleFromTo(v,x)),i.length&&(s&&i.join("")===e.copiedText&&!e.disableStyleCopyPaste&&(p=e.copiedTextStyle),this.insertNewStyleBlock(i,d,p)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(h){this.compositionStart=h.target.selectionStart,this.compositionEnd=h.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(e.copiedText=this.getSelectedText(),e.disableStyleCopyPaste?e.copiedTextStyle=null:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(h){return h&&h.clipboardData||e.window.clipboardData},_getWidthBeforeCursor:function(h,s){var u=this._getLineLeftOffset(h),f;return s>0&&(f=this.__charBounds[h][s-1],u+=f.left+f.width),u},getDownCursorOffset:function(h,s){var u=this._getSelectionForOffset(h,s),f=this.get2DCursorLocation(u),r=f.lineIndex;if(r===this._textLines.length-1||h.metaKey||h.keyCode===34)return this._text.length-u;var a=f.charIndex,i=this._getWidthBeforeCursor(r,a),l=this._getIndexOnLine(r+1,i),d=this._textLines[r].slice(a);return d.length+l+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(h,s){return h.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(h,s){var u=this._getSelectionForOffset(h,s),f=this.get2DCursorLocation(u),r=f.lineIndex;if(r===0||h.metaKey||h.keyCode===33)return-u;var a=f.charIndex,i=this._getWidthBeforeCursor(r,a),l=this._getIndexOnLine(r-1,i),d=this._textLines[r].slice(0,a),o=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+l-d.length+(1-o)},_getIndexOnLine:function(h,s){for(var u=this._textLines[h],f=this._getLineLeftOffset(h),r=f,a=0,i,l,d=0,o=u.length;d<o;d++)if(i=this.__charBounds[h][d].width,r+=i,r>s){l=!0;var g=r-i,p=r,v=Math.abs(g-s),x=Math.abs(p-s);a=x<v?d:d-1;break}return l||(a=u.length-1),a},moveCursorDown:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",h)},moveCursorUp:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",h)},_moveCursorUpOrDown:function(h,s){var u="get"+h+"CursorOffset",f=this[u](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(f):this.moveCursorWithoutShift(f),f!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(h){var s=this._selectionDirection==="left"?this.selectionStart+h:this.selectionEnd+h;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),h!==0},moveCursorWithoutShift:function(h){return h<0?(this.selectionStart+=h,this.selectionEnd=this.selectionStart):(this.selectionEnd+=h,this.selectionStart=this.selectionEnd),h!==0},moveCursorLeft:function(h){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",h)},_move:function(h,s,u){var f;if(h.altKey)f=this["findWordBoundary"+u](this[s]);else if(h.metaKey||h.keyCode===35||h.keyCode===36)f=this["findLineBoundary"+u](this[s]);else return this[s]+=u==="Left"?-1:1,!0;if(typeof f<"u"&&this[s]!==f)return this[s]=f,!0},_moveLeft:function(h,s){return this._move(h,s,"Left")},_moveRight:function(h,s){return this._move(h,s,"Right")},moveCursorLeftWithoutShift:function(h){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(h,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(h){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(h,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(h,"selectionStart")},moveCursorRight:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",h)},_moveCursorLeftOrRight:function(h,s){var u="moveCursor"+h+"With";this._currentCursorOpacity=1,s.shiftKey?u+="Shift":u+="outShift",this[u](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(h){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(h,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(h,"selectionEnd")},moveCursorRightWithoutShift:function(h){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(h,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(h,s){typeof s>"u"&&(s=h+1),this.removeStyleFromTo(h,s),this._text.splice(h,s-h),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(h,s,u,f){typeof f>"u"&&(f=u),f>u&&this.removeStyleFromTo(u,f);var r=e.util.string.graphemeSplit(h);this.insertNewStyleBlock(r,u,s),this._text=[].concat(this._text.slice(0,u),r,this._text.slice(f)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var h=e.util.toFixed,s=e.util.radiansToDegrees,u=e.util.calcRotateMatrix,f=e.util.transformPoint,r=/  +/g;e.util.object.extend(e.Text.prototype,{_toSVG:function(){var a=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(a){var i=this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0}),l=this.path;return l?i+l._createBaseSVGMarkup(l._toSVG(),{reviver:a,withShadow:!0}):i},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var i=!0,l=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",l?'text-decoration="'+l+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",a.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(a,i){var l=[],d=[],o=a,g;this._setSVGBg(d);for(var p=0,v=this._textLines.length;p<v;p++)g=this._getLineLeftOffset(p),(this.textBackgroundColor||this.styleHas("textBackgroundColor",p))&&this._setSVGTextLineBg(d,p,i+g,o),this._setSVGTextLineText(l,p,i+g,o),o+=this.getHeightOfLine(p);return{textSpans:l,textBgRects:d}},_createTextCharSpan:function(a,i,l,d,o){var g=a!==a.trim()||a.match(r),p=this.getSvgSpanStyles(i,g),v=p?'style="'+p+'"':"",x=i.deltaY,S="",C=e.Object.NUM_FRACTION_DIGITS,T="";if(x&&(S=' dy="'+h(x,C)+'" '),o.renderLeft!==void 0){var O=o.angle;T=' rotate="'+h(s(O),e.Object.NUM_FRACTION_DIGITS)+'" ';var N=o.width/2,U=u({angle:s(O)});U[4]=o.renderLeft,U[5]=o.renderTop;var J=f({x:-N,y:0},U);l=J.x,d=J.y}return['<tspan x="',h(l,C),'" y="',h(d,C),'" ',S,v,T,">",e.util.string.escapeXml(a),"</tspan>"].join("")},_setSVGTextLineText:function(a,i,l,d){var o=this.getHeightOfLine(i),g=this.textAlign.indexOf("justify")!==-1,p,v,x="",S,C,T=0,O=this._textLines[i],N;d+=o*(1-this._fontSizeFraction)/this.lineHeight;for(var U=0,J=O.length-1;U<=J;U++)N=U===J||this.charSpacing||this.path,x+=O[U],S=this.__charBounds[i][U],T===0?(l+=S.kernedWidth-S.width,T+=S.width):T+=S.kernedWidth,g&&!N&&this._reSpaceAndTab.test(O[U])&&(N=!0),N||(p=p||this.getCompleteStyleDeclaration(i,U),v=this.getCompleteStyleDeclaration(i,U+1),N=e.util.hasStyleChanged(p,v,!0)),N&&(C=this._getStyleDeclaration(i,U)||{},a.push(this._createTextCharSpan(x,C,l,d,S)),x="",p=v,l+=T,T=0)},_pushTextBgRect:function(a,i,l,d,o,g){var p=e.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(i),' x="',h(l,p),'" y="',h(d,p),'" width="',h(o,p),'" height="',h(g,p),`"></rect>
`)},_setSVGTextLineBg:function(a,i,l,d){for(var o=this._textLines[i],g=this.getHeightOfLine(i)/this.lineHeight,p=0,v=0,x,S,C=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),T=0,O=o.length;T<O;T++)x=this.__charBounds[i][T],S=this.getValueOfPropertyAt(i,T,"textBackgroundColor"),S!==C?(C&&this._pushTextBgRect(a,C,l+v,d,p,g),v=x.left,p=x.width,C=S):p+=x.kernedWidth;S&&this._pushTextBgRect(a,S,l+v,d,p,g)},_getFillAttributes:function(a){var i=a&&typeof a=="string"?new e.Color(a):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+a+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(a){for(var i=0,l=0,d=0;d<a;d++)i+=this.getHeightOfLine(d);return l=this.getHeightOfLine(d),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*l/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){var i=e.Object.prototype.getSvgStyles.call(this,a);return i+" white-space: pre;"}})}(),function(h){var s=h.fabric||(h.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(u){for(var f=0,r=0,a=0,i={},l=0;l<u.graphemeLines.length;l++)u.graphemeText[a]===`
`&&l>0?(r=0,a++,f++):!this.splitByGrapheme&&this._reSpaceAndTab.test(u.graphemeText[a])&&l>0&&(r++,a++),i[l]={line:f,offset:r},a+=u.graphemeLines[l].length,r+=u.graphemeLines[l].length;return i},styleHas:function(u,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[f];r&&(f=r.line)}return s.Text.prototype.styleHas.call(this,u,f)},isEmptyStyles:function(u){if(!this.styles)return!0;var f=0,r=u+1,a,i,l=!1,d=this._styleMap[u],o=this._styleMap[u+1];d&&(u=d.line,f=d.offset),o&&(r=o.line,l=r===u,a=o.offset),i=typeof u>"u"?this.styles:{line:this.styles[u]};for(var g in i)for(var p in i[g])if(p>=f&&(!l||p<a))for(var v in i[g][p])return!1;return!0},_getStyleDeclaration:function(u,f){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];if(!r)return null;u=r.line,f=r.offset+f}return this.callSuper("_getStyleDeclaration",u,f)},_setStyleDeclaration:function(u,f,r){var a=this._styleMap[u];u=a.line,f=a.offset+f,this.styles[u][f]=r},_deleteStyleDeclaration:function(u,f){var r=this._styleMap[u];u=r.line,f=r.offset+f,delete this.styles[u][f]},_getLineStyle:function(u){var f=this._styleMap[u];return!!this.styles[f.line]},_setLineStyle:function(u){var f=this._styleMap[u];this.styles[f.line]={}},_wrapText:function(u,f){var r=[],a;for(this.isWrapping=!0,a=0;a<u.length;a++)r=r.concat(this._wrapLine(u[a],a,f));return this.isWrapping=!1,r},_measureWord:function(u,f,r){var a=0,i,l=!0;r=r||0;for(var d=0,o=u.length;d<o;d++){var g=this._getGraphemeBox(u[d],f,d+r,i,l);a+=g.kernedWidth,i=u[d]}return a},_wrapLine:function(u,f,r,U){var i=0,l=this.splitByGrapheme,d=[],o=[],g=l?s.util.string.graphemeSplit(u):u.split(this._wordJoiners),p="",v=0,x=l?"":" ",S=0,C=0,T=0,O=!0,N=this._getWidthOfCharSpacing(),U=U||0;g.length===0&&g.push([]),r-=U;for(var J=0;J<g.length;J++)p=l?g[J]:s.util.string.graphemeSplit(g[J]),S=this._measureWord(p,f,v),v+=p.length,i+=C+S-N,i>r&&!O?(d.push(o),o=[],i=S,O=!0):i+=N,!O&&!l&&o.push(x),o=o.concat(p),C=l?0:this._measureWord([x],f,v),v++,O=!1,S>T&&(T=S);return J&&d.push(o),T+U>this.dynamicMinWidth&&(this.dynamicMinWidth=T-N+U),d},isEndOfWrapping:function(u){return!this._styleMap[u+1]||this._styleMap[u+1].line!==this._styleMap[u].line},missingNewlineOffset:function(u,f){return this.splitByGrapheme&&!f?this.isEndOfWrapping(u)?1:0:1},_splitTextIntoLines:function(u){for(var f=s.Text.prototype._splitTextIntoLines.call(this,u),r=this._wrapText(f.lines,this.width),a=new Array(r.length),i=0;i<r.length;i++)a[i]=r[i].join("");return f.lines=a,f.graphemeLines=r,f},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var u={};for(var f in this._styleMap)this._textLines[f]&&(u[this._styleMap[f].line]=1);for(var f in this.styles)u[f]||delete this.styles[f]},toObject:function(u){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(u))}}),s.Textbox.fromObject=function(u,f){var r=s.util.stylesFromArray(u.styles,u.text),a=Object.assign({},u,{styles:r});return delete a.path,s.Object._fromObject("Textbox",a,function(i){u.path?s.Object._fromObject("Path",u.path,function(l){i.set("path",l),f(i)},"path"):f(i)},"text")}}(t),function(){var h=e.controlsUtils,s=h.scaleSkewCursorStyleHandler,u=h.scaleCursorStyleHandler,f=h.scalingEqually,r=h.scalingYOrSkewingX,a=h.scalingXOrSkewingY,i=h.scaleOrSkewActionName,l=e.Object.prototype.controls;if(l.ml=new e.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:a,getActionName:i}),l.mr=new e.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:a,getActionName:i}),l.mb=new e.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),l.mt=new e.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),l.tl=new e.Control({x:-.5,y:-.5,cursorStyleHandler:u,actionHandler:f}),l.tr=new e.Control({x:.5,y:-.5,cursorStyleHandler:u,actionHandler:f}),l.bl=new e.Control({x:-.5,y:.5,cursorStyleHandler:u,actionHandler:f}),l.br=new e.Control({x:.5,y:.5,cursorStyleHandler:u,actionHandler:f}),l.mtr=new e.Control({x:0,y:-.5,actionHandler:h.rotationWithSnapping,cursorStyleHandler:h.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),e.Textbox){var d=e.Textbox.prototype.controls={};d.mtr=l.mtr,d.tr=l.tr,d.br=l.br,d.tl=l.tl,d.bl=l.bl,d.mt=l.mt,d.mb=l.mb,d.mr=new e.Control({x:.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),d.ml=new e.Control({x:-.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()})(He);const zl=t=>{let e;const n=new Set,c=(f,r)=>{const a=typeof f=="function"?f(e):f;if(!Object.is(a,e)){const i=e;e=r??(typeof a!="object"||a===null)?a:Object.assign({},e,a),n.forEach(l=>l(e,i))}},m=()=>e,s={setState:c,getState:m,getInitialState:()=>u,subscribe:f=>(n.add(f),()=>n.delete(f)),destroy:()=>{n.clear()}},u=e=t(c,m,s);return s},vg=t=>t?zl(t):zl;var oh={exports:{}},lh={},ch={exports:{}},uh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yn=he;function yg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var xg=typeof Object.is=="function"?Object.is:yg,wg=Yn.useState,Sg=Yn.useEffect,Cg=Yn.useLayoutEffect,_g=Yn.useDebugValue;function bg(t,e){var n=e(),c=wg({inst:{value:n,getSnapshot:e}}),m=c[0].inst,y=c[1];return Cg(function(){m.value=n,m.getSnapshot=e,As(m)&&y({inst:m})},[t,n,e]),Sg(function(){return As(m)&&y({inst:m}),t(function(){As(m)&&y({inst:m})})},[t]),_g(n),n}function As(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!xg(t,n)}catch{return!0}}function Tg(t,e){return e()}var kg=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Tg:bg;uh.useSyncExternalStore=Yn.useSyncExternalStore!==void 0?Yn.useSyncExternalStore:kg;ch.exports=uh;var Og=ch.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rs=he,Pg=Og;function Eg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var jg=typeof Object.is=="function"?Object.is:Eg,Dg=Pg.useSyncExternalStore,Mg=rs.useRef,Ag=rs.useEffect,Ig=rs.useMemo,Lg=rs.useDebugValue;lh.useSyncExternalStoreWithSelector=function(t,e,n,c,m){var y=Mg(null);if(y.current===null){var w={hasValue:!1,value:null};y.current=w}else w=y.current;y=Ig(function(){function s(i){if(!u){if(u=!0,f=i,i=c(i),m!==void 0&&w.hasValue){var l=w.value;if(m(l,i))return r=l}return r=i}if(l=r,jg(f,i))return l;var d=c(i);return m!==void 0&&m(l,d)?(f=i,l):(f=i,r=d)}var u=!1,f,r,a=n===void 0?null:n;return[function(){return s(e())},a===null?void 0:function(){return s(a())}]},[e,n,c,m]);var h=Dg(t,y[0],y[1]);return Ag(function(){w.hasValue=!0,w.value=h},[h]),Lg(h),h};oh.exports=lh;var Fg=oh.exports;const Ng=Xl(Fg),{useDebugValue:Rg}=tc,{useSyncExternalStoreWithSelector:zg}=Ng;const Bg=t=>t;function Ug(t,e=Bg,n){const c=zg(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return Rg(c),c}const Bl=t=>{const e=typeof t=="function"?vg(t):t,n=(c,m)=>Ug(e,c,m);return Object.assign(n,e),n},is=t=>t?Bl(t):Bl,yr=is((t,e)=>({canvas:null,tool:"select",brushSize:5,brushColor:"#000000",isDrawing:!1,history:[],historyIndex:-1,zoom:1,panX:0,panY:0,setCanvas:n=>t({canvas:n}),setTool:n=>{const{canvas:c,brushSize:m,brushColor:y}=e();if(c){switch(n){case"select":c.isDrawingMode=!1,c.selection=(!0)(c.getContext()).globalCompositeOperation="source-over";break;case"brush":c.isDrawingMode=!0,c.selection=!1,c.freeDrawingBrush=new He.fabric.PencilBrush(c),c.freeDrawingBrush.width=m,c.freeDrawingBrush.color=y(c.getContext()).globalCompositeOperation="source-over";break;case"eraser":c.isDrawingMode=!0,c.selection=!1,c.freeDrawingBrush=new He.fabric.PencilBrush(c),c.freeDrawingBrush.width=m(c.getContext()).globalCompositeOperation="destination-out",c.freeDrawingBrush.color="rgba(0,0,0,1)";break;default:c.isDrawingMode=!1,c.selection=!0}t({tool:n})}},setBrushSize:n=>{const{canvas:c,tool:m}=e();c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=n,m==="eraser"?c.getContext().globalCompositeOperation="destination-out":c.getContext().globalCompositeOperation="source-over"),t({brushSize:n})},setBrushColor:n=>{const{canvas:c,tool:m}=e();c&&c.freeDrawingBrush&&m!=="eraser"&&(c.freeDrawingBrush.color=n),t({brushColor:n})},setIsDrawing:n=>t({isDrawing:n}),addToHistory:n=>{const{history:c,historyIndex:m}=e(),y={id:Date.now().toString(),timestamp:Date.now(),data:n},s=[...c.slice(0,m+1),y].slice(-50);t({history:s,historyIndex:s.length-1})},undo:()=>{const{canvas:n,history:c,historyIndex:m}=e();if(!n||m<=0)return;const y=c[m-1];n._skipHistory=!0,n.loadFromJSON(y.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:m-1})},redo:()=>{const{canvas:n,history:c,historyIndex:m}=e();if(!n||m>=c.length-1)return;const y=c[m+1];n._skipHistory=!0,n.loadFromJSON(y.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:m+1})},canUndo:()=>{const{historyIndex:n}=e();return n>0},canRedo:()=>{const{history:n,historyIndex:c}=e();return c<n.length-1},clearCanvas:()=>{const{canvas:n}=e();if(n){n.clear(),n.backgroundColor="#ffffff",n.renderAll();const c=JSON.stringify(n.toJSON());e().addToHistory(c)}},exportCanvas:n=>{const{canvas:c}=e();if(!c)return null;switch(n){case"png":return c.toDataURL({format:"png",quality:1,multiplier:2});case"jpg":return c.toDataURL({format:"jpeg",quality:.9,multiplier:2});case"pdf":return console.warn("PDF export not yet implemented"),null;default:return null}},importImage:async(n,c)=>{const{canvas:m}=e();if(m)return console.log(" Importing image to canvas:",n.substring(0,50)+"..."),new Promise((y,w)=>{try{He.fabric.Image.fromURL(n,h=>{try{if(h&&h.width&&h.height){console.log(" Image loaded successfully:",h.width,"x",h.height);const s=h.width||1,u=h.height||1,f=Math.max(s,u);console.log(" Original AI image size:",s,"x",u);const r=600;let a=1;f>r?(a=r/f,console.log(" Scaling down large AI image:",a)):console.log(" Using original AI image size (good quality)"),h.scale(a),console.log(" Final AI image display size:",(s*a).toFixed(0),"x",(u*a).toFixed(0)),(c==null?void 0:c.x)!==void 0&&(c==null?void 0:c.y)!==void 0?(h.set({left:c.x,top:c.y}),console.log(" Positioned image at:",c.x,c.y)):(h.center(),console.log(" Centered image (no position specified)"));try{n.startsWith("data:image/")&&(h.set("isAIGenerated",!0),h.set("imageId",`ai_generated_${Date.now()}`))}catch(l){console.warn("Failed to set metadata:",l)}m.add(h),m.renderAll(),console.log(" Image added to canvas and rendered");const i=JSON.stringify(m.toJSON());e().addToHistory(i),y()}else console.error(" Failed to load image - img object is null or has no dimensions"),w(new Error("Failed to load image - invalid image data"))}catch(s){console.error(" Error in image load callback:",s),w(s)}},{crossOrigin:"anonymous"})}catch(h){console.error(" Error calling fabric.Image.fromURL:",h),w(h)}})},updateBrushSettings:n=>{const{canvas:c,brushSize:m,brushColor:y}=e(),w=n.size??m,h=n.color??y;c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=w,c.freeDrawingBrush.color=h,n.opacity),t({brushSize:w,brushColor:h})},setZoom:n=>{const{canvas:c}=e();if(c){const m=c.getCenter();c.zoomToPoint(new He.fabric.Point(m.left,m.top),n),c.renderAll()}t({zoom:n})},setPan:(n,c)=>{const{canvas:m}=e();m&&(m.absolutePan(new He.fabric.Point(n,c)),m.renderAll()),t({panX:n,panY:c})},zoomIn:()=>{const{zoom:n,setZoom:c}=e(),m=Math.min(n*1.2,5);c(m)},zoomOut:()=>{const{zoom:n,setZoom:c}=e(),m=Math.max(n/1.2,.1);c(m)},resetView:()=>{const{canvas:n,setZoom:c,setPan:m}=e();n&&(c(1),m(0,0),n.setViewportTransform([1,0,0,1,0,0]),n.renderAll())},calculateSmartLayout:(n,c)=>{const{canvas:m}=e();if(!m)return[];const y=m.width||800,w=m.height||600,h=20,s=[];if(console.log(" Calculating smart layout for",n,"images"),console.log(" Canvas size:",y,"x",w),console.log(" Image size:",c.width,"x",c.height),n===1)s.push({x:(y-c.width)/2,y:(w-c.height)/2});else if(n===2){const u=c.width*2+h,f=(y-u)/2,r=(w-c.height)/2;s.push({x:f,y:r},{x:f+c.width+h,y:r})}else if(n===4){const u=c.width*2+h,f=c.height*2+h,r=(y-u)/2,a=(w-f)/2;s.push({x:r,y:a},{x:r+c.width+h,y:a},{x:r,y:a+c.height+h},{x:r+c.width+h,y:a+c.height+h})}else{const u=Math.ceil(Math.sqrt(n)),f=Math.ceil(n/u),r=c.width*u+h*(u-1),a=c.height*f+h*(f-1),i=Math.max(h,(y-r)/2),l=Math.max(h,(w-a)/2);for(let d=0;d<n;d++){const o=Math.floor(d/u),g=d%u;s.push({x:i+g*(c.width+h),y:l+o*(c.height+h)})}}return console.log(" Generated positions:",s),s},getSelectedImages:()=>{const{canvas:n}=e();if(console.log(" Canvas selection check:",{hasCanvas:!!n}),!n)return[];const c=n.getActiveObjects();console.log(" Active objects:",{count:c.length,objects:c});const m=[];return c.forEach((y,w)=>{var h,s,u,f;console.log(` Object ${w}:`,{type:y.type,hasElement:!!y._element,hasSrc:!!((h=y._element)!=null&&h.src),src:((u=(s=y._element)==null?void 0:s.src)==null?void 0:u.substring(0,50))+"..."}),y.type==="image"&&((f=y._element)!=null&&f.src)&&m.push(y._element.src)}),console.log(" Selected image URLs:",{count:m.length}),m}})),To=is((t,e)=>({images:[],selectedImages:[],isMultiSelectMode:!1,canvas:null,setCanvas:n=>t({canvas:n}),addImages:async(n,c={autoArrange:!0,spacing:20})=>{const{canvas:m,images:y}=e();if(!m)return;const w=[],h=Array.from(n);for(let s=0;s<h.length;s++){const u=h[s];if(u.type.startsWith("image/"))try{const f=await new Promise(T=>{const O=new FileReader;O.onload=N=>{var U;return T((U=N.target)==null?void 0:U.result)},O.readAsDataURL(u)}),r=await new Promise((T,O)=>{He.fabric.Image.fromURL(f,N=>{N?(N.set({selectable:!0,hasControls:!0,hasBorders:!0,cornerColor:"#2563eb",cornerStyle:"circle",borderColor:"#2563eb"}),T(N)):O(new Error("Failed to load image"))})}),a=r.width||1,i=r.height||1,l=Math.max(a,i);console.log(" Original image size:",a,"x",i);const d=600;let o=1;l>d?(o=d/l,console.log(" Scaling down large image:",o)):console.log(" Using original size (good quality)"),r.scale(o),console.log(" Final display size:",(a*o).toFixed(0),"x",(i*o).toFixed(0));const g=a*o,p=i*o,v=c.spacing||100;let x=100+s%2*(g+v),S=100+Math.floor(s/2)*(p+v);c.autoArrange?r.set({left:x,top:S}):r.center(),m.add(r);const C={id:`img_${Date.now()}_${s}`,name:u.name,url:f,fabricObject:r,width:r.width||0,height:r.height||0,selected:!1,position:{x:r.left||0,y:r.top||0},scale:o,thumbnail:f};w.push(C)}catch(f){console.error(`Failed to load image ${u.name}:`,f)}}m.renderAll(),t({images:[...y,...w]}),m&&w.length>0&&console.log("Added",w.length,"images to canvas")},removeImage:n=>{const{canvas:c,images:m,selectedImages:y}=e();if(!c)return;const w=m.find(h=>h.id===n);w&&w.fabricObject&&(c.remove(w.fabricObject),c.renderAll()),t({images:m.filter(h=>h.id!==n),selectedImages:y.filter(h=>h!==n)})},selectImage:(n,c=!1)=>{const{selectedImages:m,isMultiSelectMode:y}=e();if(c||y){const s=m.includes(n)?m.filter(u=>u!==n):[...m,n];t({selectedImages:s})}else t({selectedImages:[n]});const{images:w,canvas:h}=e();if(h){const s=e().selectedImages;w.forEach(u=>{if(u.fabricObject){const f=s.includes(u.id);u.fabricObject.set({borderColor:f?"#ef4444":"#2563eb",cornerColor:f?"#ef4444":"#2563eb"})}}),h.renderAll()}},selectAllImages:()=>{const{images:n}=e();t({selectedImages:n.map(m=>m.id)});const{canvas:c}=e();c&&(n.forEach(m=>{m.fabricObject&&m.fabricObject.set({borderColor:"#ef4444",cornerColor:"#ef4444"})}),c.renderAll())},clearSelection:()=>{t({selectedImages:[]});const{images:n,canvas:c}=e();c&&(n.forEach(m=>{m.fabricObject&&m.fabricObject.set({borderColor:"#2563eb",cornerColor:"#2563eb"})}),c.renderAll())},deleteSelectedImages:()=>{const{selectedImages:n}=e();n.forEach(c=>{e().removeImage(c)}),t({selectedImages:[]})},toggleMultiSelectMode:()=>{const{isMultiSelectMode:n}=e();t({isMultiSelectMode:!n}),n||e().clearSelection()},arrangeImages:n=>{const{images:c,canvas:m}=e();if(!m||c.length===0)return;const y=m.width||800,w=m.height||600,h=20,s=y-h*2,u=w-h*2;c.forEach((f,r)=>{if(!f.fabricObject)return;let a=h,i=h;switch(n){case"grid":const l=Math.ceil(Math.sqrt(c.length)),d=s/l,o=u/Math.ceil(c.length/l);a=h+r%l*d+d/2,i=h+Math.floor(r/l)*o+o/2;break;case"horizontal":const g=s/c.length;a=h+r*g+g/2,i=w/2;break;case"vertical":const p=u/c.length;a=y/2,i=h+r*p+p/2;break}f.fabricObject.set({left:a,top:i}),f.position={x:a,y:i}}),m.renderAll()},getSelectedImages:()=>{const{images:n,selectedImages:c}=e();return n.filter(m=>c.includes(m.id))},getSelectionBounds:()=>{const n=e().getSelectedImages();if(n.length===0)return null;const c=n.map(y=>y.fabricObject).filter(y=>y!==null);if(c.length===0)return null;const m={left:Math.min(...c.map(y=>y.left||0)),top:Math.min(...c.map(y=>y.top||0)),right:Math.max(...c.map(y=>(y.left||0)+(y.width||0)*(y.scaleX||1))),bottom:Math.max(...c.map(y=>(y.top||0)+(y.height||0)*(y.scaleY||1)))};return{images:n,bounds:{left:m.left,top:m.top,width:m.right-m.left,height:m.bottom-m.top}}}}));function Nn(t){const e=t.split(",")[1]||t;return Math.floor(e.length*.75)}async function It(t,e={}){const{maxWidth:n=1024,maxHeight:c=1024,quality:m=.8,maxSizeKB:y=3500,format:w="jpeg"}=e,h=Nn(t);return new Promise((s,u)=>{const f=new Image;f.onload=async()=>{try{const r=document.createElement("canvas"),a=r.getContext("2d");let{width:i,height:l}=Wg(f.width,f.height,n,c);r.width=i,r.height=l,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(f,0,0,i,l);let d=m,o,g;do o=r.toDataURL(`image/${w}`,d),g=Nn(o),console.log(` Compression attempt: ${Math.round(g/1024)}KB at quality ${d}`),g>y*1024&&(d>.3?d-=.1:(i=Math.floor(i*.8),l=Math.floor(l*.8),r.width=i,r.height=l,a.clearRect(0,0,i,l),a.drawImage(f,0,0,i,l),d=.7));while(g>y*1024&&(d>.2||i>200));const p=h/g;console.log(` Image compressed: ${Math.round(h/1024)}KB  ${Math.round(g/1024)}KB (${Math.round(p*100)/100}x reduction)`),s({dataURL:o,originalSize:h,compressedSize:g,compressionRatio:p})}catch(r){u(r)}},f.onerror=()=>u(new Error("Failed to load image for compression")),f.src=t})}function Wg(t,e,n,c){let m=t,y=e;return m>n&&(y=y*n/m,m=n),y>c&&(m=m*c/y,y=c),{width:Math.floor(m),height:Math.floor(y)}}async function Is(t,e={}){const n=[];for(const c of t)try{const m=await It(c,e);n.push(m)}catch(m){console.error("Failed to compress image:",m);const y=Nn(c);n.push({dataURL:c,originalSize:y,compressedSize:y,compressionRatio:1})}return n}class Hg{constructor(){qn(this,"config");this.config={baseUrl:"https://omnicanvas-backend.vercel.app/api",endpoints:{generateImage:"/ai/generate-image",mergeImages:"/ai/merge-images",transferStyle:"/ai/transfer-style",generateSimilar:"/ai/generate-similar",elevenlabs:"/ai/elevenlabs",generateComic:"/ai/generate-comic",editWithWords:"/ai/edit-with-words",blendProduct:"/ai/blend-product",generateVideo:"/ai/generate-video",generateText:"/ai/generate-text"}}}configure(e){e&&(this.config.baseUrl=e)}async generateImage(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt,width:e.width||512,height:e.height||512,provider:"gemini"})});if(!n.ok){const m=await n.text();throw new Error(`Backend API error: ${n.status} - ${m}`)}const c=await n.json();return{url:c.imageUrl||c.url,width:c.width||e.width||512,height:c.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",...c.metadata}}}catch(n){throw console.error("Image generation error:",n),n}}async imageToImage(e){try{console.log(" Frontend AI Image-to-Image called!"),console.log(" Request details:",{prompt:e.prompt.substring(0,100)+"...",imageUrl:e.imageUrl.substring(0,50)+"...",width:e.width,height:e.height,strength:e.strength});let n=e.imageUrl;if(e.imageUrl.startsWith("data:")){console.log(" Compressing reference image for image-to-image...");const y=Nn(e.imageUrl);console.log(` Original image size: ${Math.round(y/1024)}KB`);const w=await It(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3});n=w.dataURL,console.log(` Compressed image size: ${Math.round(w.compressedSize/1024)}KB`)}const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt,imageUrl:n,width:e.width||512,height:e.height||512,strength:e.strength||.7,provider:"gemini",mode:"image-to-image"})});if(!c.ok){const y=await c.text();throw new Error(`Backend API error: ${c.status} - ${y}`)}const m=await c.json();return{url:m.imageUrl||m.url,width:m.width||e.width||512,height:m.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",mode:"image-to-image",referenceImage:e.imageUrl,strength:e.strength||.7,...m.metadata}}}catch(n){throw console.error("Image-to-image generation error:",n),n}}async mergeImages(e,n){try{console.log(" Backend AI Merge - Images:",e.length,"Prompt:",n);const c=e.filter(s=>s.startsWith("data:")),m=e.filter(s=>!s.startsWith("data:"));let y=[...m];if(c.length>0){console.log(" Compressing",c.length,"data URLs on client side...");const u=c.map(i=>Nn(i)).reduce((i,l)=>i+l,0);console.log(` Original total size: ${Math.round(u/1024)}KB`);const f=await Is(c,{maxWidth:800,maxHeight:800,quality:.6,format:"jpeg",maxSizeKB:1500}),r=f.map(i=>i.dataURL),a=f.reduce((i,l)=>i+l.compressedSize,0);console.log(` Compressed total size: ${Math.round(a/1024)}KB (${Math.round(u/a*100)/100}x reduction)`),y=[...m,...r]}const w=await fetch(`${this.config.baseUrl}${this.config.endpoints.mergeImages}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrls:y,prompt:n,provider:"gemini"})});if(!w.ok){const s=await w.text();throw console.error("Backend merge error:",s),new Error(`Backend merge error: ${w.status}`)}const h=await w.json();return console.log(" Backend merge successful:",h),h.imageUrl||h.url}catch(c){throw console.error("Backend merge failed:",c),c}}async transferStyle(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.transferStyle}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e.imageUrl,style:e.style,provider:"gemini"})});if(!n.ok){const m=await n.text();throw new Error(`Style transfer error: ${n.status} - ${m}`)}const c=await n.json();return c.imageUrl||c.url}catch(n){throw console.error("Style transfer error:",n),n}}async generateSimilar(e){try{console.log(" Calling generateSimilar API with",e.images.length,"images");const n=e.images.filter(h=>h.startsWith("data:")),c=e.images.filter(h=>!h.startsWith("data:"));let m=[...c];if(n.length>0){console.log(" Compressing",n.length,"data URLs for generateSimilar...");const s=(await Is(n,{maxWidth:768,maxHeight:768,quality:.7,format:"jpeg",maxSizeKB:1800})).map(u=>u.dataURL);m=[...c,...s]}const y=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateSimilar}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrls:m,prompt:e.prompt,aspectRatio:e.aspectRatio||"1:1",provider:"gemini"})});if(!y.ok){const h=await y.text();throw console.error("Generate similar API error:",h),new Error(`Generate similar error: ${y.status} - ${h}`)}const w=await y.json();return console.log(" Generate similar API response:",w),w.imageUrl||w.url}catch(n){throw console.error("Generate similar error:",n),n}}async generateVoice(e,n){try{const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.elevenlabs}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,voiceId:n||"default",provider:"elevenlabs"})});if(!c.ok){const y=await c.text();throw new Error(`Voice generation error: ${c.status} - ${y}`)}const m=await c.json();return m.audioUrl||m.url}catch(c){throw console.error("Voice generation error:",c),c}}async generateComic(e){try{console.log(" Generating comic with StoryShop API");let n=e.characterImage,c=e.productImage;if(e.characterImage&&e.characterImage.startsWith("data:")){console.log(" Compressing character image for comic generation...");const w=await It(e.characterImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});n=w.dataURL,console.log(` Character image compressed: ${Math.round(w.compressedSize/1024)}KB`)}if(e.productImage&&e.productImage.startsWith("data:")){console.log(" Compressing product image for comic generation...");const w=await It(e.productImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});c=w.dataURL,console.log(` Product image compressed: ${Math.round(w.compressedSize/1024)}KB`)}const m=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateComic}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storyPrompt:e.storyPrompt,characterImage:n,productImage:c,style:e.style,panelCount:e.panelCount||4,provider:"gemini"})});if(!m.ok){const w=await m.text();throw new Error(`Comic generation error: ${m.status} - ${w}`)}return(await m.json()).panelUrls||[]}catch(n){throw console.error("Comic generation error:",n),n}}async editWithWords(e){try{let n=e.imageUrl,c=e.maskUrl;e.imageUrl.startsWith("data:")&&(console.log(" Compressing image for editWithWords..."),n=(await It(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.maskUrl&&e.maskUrl.startsWith("data:")&&(console.log(" Compressing mask for editWithWords..."),c=(await It(e.maskUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"png",maxSizeKB:1e3})).dataURL);const m=await fetch(`${this.config.baseUrl}${this.config.endpoints.editWithWords}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:n,editPrompt:e.editPrompt,maskUrl:c,provider:"gemini"})});if(!m.ok){const w=await m.text();throw new Error(`Edit with words error: ${m.status} - ${w}`)}const y=await m.json();return y.imageUrl||y.url}catch(n){throw console.error("Edit with words error:",n),n}}async blendProduct(e){try{let n=e.sceneImageUrl,c=e.productImageUrl;e.sceneImageUrl.startsWith("data:")&&(console.log(" Compressing scene image for blendProduct..."),n=(await It(e.sceneImageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.productImageUrl.startsWith("data:")&&(console.log(" Compressing product image for blendProduct..."),c=(await It(e.productImageUrl,{maxWidth:512,maxHeight:512,quality:.8,format:"jpeg",maxSizeKB:1500})).dataURL);const m=await fetch(`${this.config.baseUrl}${this.config.endpoints.blendProduct}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sceneImageUrl:n,productImageUrl:c,blendPrompt:e.blendPrompt,provider:"gemini"})});if(!m.ok){const w=await m.text();throw new Error(`Product blend error: ${m.status} - ${w}`)}const y=await m.json();return y.imageUrl||y.url}catch(n){throw console.error("Product blend error:",n),n}}async generateVideoFromPanels(e){try{console.log(" Generating video from panels...");const n=e.panelUrls.filter(h=>h.startsWith("data:")),c=e.panelUrls.filter(h=>!h.startsWith("data:"));let m=[...c];if(n.length>0){console.log(" Compressing",n.length,"panel images for video generation...");const s=n.map(a=>Nn(a)).reduce((a,i)=>a+i,0);console.log(` Original panels total size: ${Math.round(s/1024)}KB`);const u=await Is(n,{maxWidth:720,maxHeight:720,quality:.75,format:"jpeg",maxSizeKB:1e3}),f=u.map(a=>a.dataURL),r=u.reduce((a,i)=>a+i.compressedSize,0);console.log(` Compressed panels total size: ${Math.round(r/1024)}KB (${Math.round(s/r*100)/100}x reduction)`),m=[...c,...f]}const y=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateVideo}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({panelUrls:m,narrationText:e.narrationText,voiceId:e.voiceId||"default",duration:e.duration||8,provider:"fal-ai"})});if(!y.ok){const h=await y.text();throw new Error(`Video generation error: ${y.status} - ${h}`)}const w=await y.json();return w.videoUrl||w.url}catch(n){throw console.error("Video generation error:",n),n}}async generateText(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateText}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e.prompt,maxLength:e.maxLength||100})});if(!n.ok){const m=await n.text();throw new Error(`Text generation error: ${n.status} - ${m}`)}return(await n.json()).text}catch(n){throw console.error("Text generation error:",n),n}}async testConnection(){try{return(await fetch(`${this.config.baseUrl}/health`,{method:"GET"})).ok}catch(e){return console.error("Backend connection test failed:",e),!1}}}const tn=new Hg,Xg=({x:t,y:e,visible:n,selectedCount:c,onClose:m,onMergeImages:y,onStyleTransfer:w,onDuplicate:h,onDelete:s,onBringToFront:u,onSendToBack:f,onRotate:r,onGenerateSimilar:a,onExportSelected:i,onGroupSelection:l,onIntelligentCompose:d,onWearAccessory:o,onSceneCompose:g,onCreativeBlend:p,onPlayVideo:v,hasVideoThumbnail:x})=>{if(!n)return null;console.log(" NEW AI CONTEXT MENU RENDERING! Time:",new Date().toLocaleTimeString()),console.log(" NewContextMenu props:",{visible:n,x:t,y:e,selectedCount:c}),console.log(" AI handlers available:",{onIntelligentCompose:!!d,onWearAccessory:!!o,onSceneCompose:!!g,onCreativeBlend:!!p});const S=[...x&&c===1&&v?[{icon:ih,label:" Play Video",onClick:v,className:"text-orange-600 hover:bg-orange-50 font-semibold",separator:!0}]:[],...c>=2?[{icon:Qd,label:` AI Smart Compose (${c})`,onClick:d,className:"text-blue-600 hover:bg-blue-50 font-semibold",separator:!1},{icon:ah,label:" Creative Blend",onClick:p,className:"text-pink-600 hover:bg-pink-50",separator:!0}]:[],...c>=1?[{icon:Pa,label:" Generate Similar",onClick:a,className:"text-green-600 hover:bg-green-50",separator:!0}]:[],...c>=1?[{icon:tg,label:"Save Selected",onClick:i,className:"text-blue-600 hover:bg-blue-50",separator:!1},{icon:eg,label:c>1?`Duplicate ${c}`:"Duplicate",onClick:h,className:"hover:bg-gray-50",separator:!1},{icon:sh,label:c>1?`Delete ${c}`:"Delete",onClick:s,className:"text-red-600 hover:bg-red-50",separator:!1}]:[]],C={left:Math.min(t,window.innerWidth-250),top:Math.min(e,window.innerHeight-S.length*40)};return b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"fixed inset-0 z-10",onClick:m}),b.jsxs("div",{className:"fixed z-20 bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[200px]",style:C,onClick:T=>T.stopPropagation(),children:[b.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 bg-gradient-to-r from-blue-50 to-purple-50",children:[" AI Actions - ",c," selected"]}),S.map((T,O)=>{const N=T.icon;return b.jsxs("div",{children:[b.jsxs("button",{onClick:U=>{U.stopPropagation(),T.onClick(),m()},className:`w-full px-3 py-2 text-left text-sm flex items-center space-x-2 transition-colors ${T.className}`,children:[b.jsx(N,{className:"w-4 h-4 flex-shrink-0"}),b.jsx("span",{className:"flex-1",children:T.label})]}),T.separator&&b.jsx("div",{className:"border-t border-gray-100 my-1"})]},O)})]})]})},Yg={width:5e3,height:5e3,backgroundColor:"#ffffff",selection:!0,renderOnAddRemove:!0,centeredScaling:!0,centeredRotation:!0,preserveObjectStacking:!0,targetFindTolerance:4},Vg=()=>{const t=he.useRef(null),e=he.useRef(null),[n,c]=he.useState({visible:!1,x:0,y:0,selectedObjects:[]}),[m,y]=he.useState({x:0,y:0}),[w,h]=he.useState({x:0,y:0}),[s,u]=he.useState(!1),f=()=>{r&&(r.absolutePan(new He.fabric.Point(0,0)),r.setZoom(1),T(1),r.renderAll())},{canvas:r,setCanvas:a,tool:i,brushSize:l,brushColor:d,setIsDrawing:o,addToHistory:g,importImage:p,zoom:v,zoomIn:x,zoomOut:S,resetView:C,setZoom:T,setPan:O}=yr(),{setCanvas:N,selectImage:U,isMultiSelectMode:J}=To();he.useEffect(()=>{if(!t.current||!e.current)return;const E=new He.fabric.Canvas(t.current,{...Yg,width:e.current.clientWidth,height:e.current.clientHeight,selection:!0,preserveObjectStacking:!0,fireRightClick:!0,fireMiddleClick:!0,skipTargetFind:!1,targetFindTolerance:4,perPixelTargetFind:!1,uniformScaling:!0,stopContextMenu:!1,selectionBorderColor:"rgba(46, 115, 252, 0.8)",selectionLineWidth:2,selectionDashArray:[5,5],objectCaching:!1});E.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),E.selection=!0,E.preserveObjectStacking=!0,console.log("Canvas initialized with multi-selection enabled:",E.selection),E.on("object:added",Z=>{const Y=Z.target;console.log(" Object added to canvas:",Y.type),Y&&(Y.set({selectable:!0,evented:!0,hasControls:!0,hasBorders:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,hoverCursor:"move",moveCursor:"move"}),console.log(" Object configured for selection:",Y.type,"selectable:",Y.selectable))}),E.setWidth(e.current.clientWidth),E.setHeight(e.current.clientHeight),E.freeDrawingBrush=new He.fabric.PencilBrush(E),E.freeDrawingBrush.width=l,E.freeDrawingBrush.color=d,a(E),N(E);let I=null;const H=()=>{E._skipHistory||(I&&clearTimeout(I),I=setTimeout(()=>{const Z=JSON.stringify(E.toJSON());g(Z)},300))};E.on("path:created",H),E.on("object:modified",H),E.on("selection:created",Z=>{var Y;console.log(" Selection created:",((Y=Z.selected)==null?void 0:Y.length)||0,"objects"),Z.selected&&Z.selected.forEach(B=>{console.log("  - Selected object type:",B.type)}),J&&Z.selected&&Z.selected.forEach(B=>{if(B.type==="image"){const ie=B.imageId||`img_${B.cacheKey}`;U(ie,!0)}})}),E.on("selection:updated",Z=>{var Y;console.log(" Selection updated:",((Y=Z.selected)==null?void 0:Y.length)||0,"objects"),Z.selected&&Z.selected.forEach(B=>{console.log("  - Updated selection object type:",B.type)})}),E.on("selection:cleared",()=>{console.log(" Selection cleared"),c(Z=>({...Z,selectedObjects:[]}))}),E.on("mouse:down",Z=>{const Y=Z.e;if(console.log(" Mouse down - Button:",Y.button,"Shift:",Y.shiftKey,"Ctrl:",Y.ctrlKey,"Cmd:",Y.metaKey),o(!0),Y.button===2){console.log(" RIGHT CLICK DETECTED! Preventing default..."),Y.preventDefault(),Y.stopPropagation();const B=E.getActiveObject(),ie=B?[B]:[];if(B&&B.type==="activeSelection"){const ce=B;ie.length=0,ce.forEachObject(ue=>ie.push(ue))}console.log(" SHOWING CONTEXT MENU! activeObject:",B,"selectedObjects:",ie.length),c({visible:!0,x:Y.clientX,y:Y.clientY,selectedObjects:ie})}else{c(ie=>({...ie,visible:!1}));const B=E.findTarget(Y,!1);console.log(" Target found:",(B==null?void 0:B.type)||"none"),Y.shiftKey&&!B?(console.log(" Starting pan mode (Shift+drag on empty space)"),A=!0,E.isDragging=!0,E.selection=!1,W=Y.clientX,K=Y.clientY):(console.log(" Ensuring selection is enabled for multi-selection"),E.selection=!0,E.isDragging=!1,(Y.ctrlKey||Y.metaKey)&&console.log(" Ctrl/Cmd detected - multi-selection should work!"))}}),E.on("mouse:up",()=>{o(!1),A&&(console.log(" Ending pan mode"),A=!1,E.isDragging=!1,E.selection=!0)});const Q=E.getElement(),z=Q.parentElement,F=Z=>(console.log(" PREVENTING CONTEXT MENU on:",Z.target),Z.preventDefault(),Z.stopPropagation(),!1);Q.addEventListener("contextmenu",F),z&&z.addEventListener("contextmenu",F),e.current&&e.current.addEventListener("contextmenu",F);const V=()=>{e.current&&(E.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),E.renderAll())};window.addEventListener("resize",V);const q=Z=>{const Y=Z.e;if(Y.ctrlKey||Y.metaKey){Y.preventDefault();const B=Y.deltaY;let ie=E.getZoom();ie*=.999**B,ie>5&&(ie=5),ie<.1&&(ie=.1);const ce=new He.fabric.Point(Z.e.offsetX,Z.e.offsetY);E.zoomToPoint(ce,ie),T(ie)}};E.on("mouse:wheel",q);let A=!1,W=0,K=0;return E.on("mouse:move",Z=>{const Y=E.getPointer(Z.e);y({x:Math.round(Y.x),y:Math.round(Y.y)});const B=E.getCenter();if(h({x:Math.round(B.left),y:Math.round(B.top)}),A){const ie=Z.e,ce=E.viewportTransform;ce[4]+=ie.clientX-W,ce[5]+=ie.clientY-K,E.requestRenderAll(),W=ie.clientX,K=ie.clientY}}),E.on("mouse:wheel",Z=>{const Y=Z.e;if(!Y.ctrlKey&&!Y.metaKey){Y.preventDefault();const B=E.viewportTransform;B[4]-=Y.deltaX||0,B[5]-=Y.deltaY||0,E.requestRenderAll()}}),()=>{window.removeEventListener("resize",V),E.dispose()}},[]),he.useEffect(()=>{r&&r.freeDrawingBrush&&(r.freeDrawingBrush.width=l,r.freeDrawingBrush.color=d)},[r,l,d]),he.useEffect(()=>{const E=I=>{if(r){if((I.ctrlKey||I.metaKey)&&["z","y","a","c","v","x","+","-","=","0"].includes(I.key.toLowerCase())&&I.preventDefault(),(I.ctrlKey||I.metaKey)&&I.key==="z"&&!I.shiftKey)yr.getState().undo();else if((I.ctrlKey||I.metaKey)&&I.key==="y"||(I.ctrlKey||I.metaKey)&&I.shiftKey&&I.key==="Z")yr.getState().redo();else if((I.ctrlKey||I.metaKey)&&I.key==="a"){const H=r.getObjects();r.discardActiveObject();const Q=new He.fabric.ActiveSelection(H,{canvas:r});r.setActiveObject(Q),r.requestRenderAll()}else if((I.ctrlKey||I.metaKey)&&(I.key==="+"||I.key==="="))x();else if((I.ctrlKey||I.metaKey)&&I.key==="-")S();else if((I.ctrlKey||I.metaKey)&&I.key==="0")C();else if(I.key==="Delete"||I.key==="Backspace"){const H=document.activeElement;if(!(H&&(H.tagName==="INPUT"||H.tagName==="TEXTAREA"||H.getAttribute("contenteditable")==="true"))){const z=r.getActiveObject();z&&(z.type==="activeSelection"?(z.forEachObject(V=>{r.remove(V)}),r.discardActiveObject()):r.remove(z),r.requestRenderAll())}}}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[r]);const te=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(Q=>Q.type==="image").map(Q=>{var z;return((z=Q._originalElement)==null?void 0:z.src)||Q.src}).filter(Boolean);if(E.length<2){alert(" 2 ");return}const I=window.prompt("","");if(!I)return;const H=await tn.mergeImages(E,I);await p(H),alert("")}catch(E){console.error(":",E),alert(": "+E)}},se=async()=>{var H;if(n.selectedObjects.length===0)return;const E=n.selectedObjects.find(Q=>Q.type==="image");if(!E){alert("");return}const I=window.prompt("","");if(I)try{const Q=((H=E._originalElement)==null?void 0:H.src)||E.src,z=await tn.transferStyle({imageUrl:Q,style:I});await p(z),alert("")}catch(Q){alert(": "+Q)}},ne=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{E.clone(I=>{I.set({left:(I.left||0)+20,top:(I.top||0)+20}),r.add(I)})}),r.renderAll())},re=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{r.remove(E)}),r.renderAll())},ae=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{r.bringToFront(E)}),r.renderAll())},le=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{r.sendToBack(E)}),r.renderAll())},G=()=>{!r||n.selectedObjects.length===0||(n.selectedObjects.forEach(E=>{const I=E.angle||0;E.set({angle:I+90})}),r.renderAll())},_=async()=>{if(n.selectedObjects.length===0)return;console.log(" Generating similar images from selected objects:",n.selectedObjects.length);const E="Generate a very similar object or item with the same category, style, and visual characteristics. Keep the same type of object, similar colors, materials, and overall appearance. Maintain the same scene context and background style.";try{const I=P(" Analyzing selected objects and generating similar content...",1),H=[];for(const z of n.selectedObjects)if(z.type==="image"){const F=z;F.getSrc&&H.push(F.getSrc())}if(H.length===0){j(),alert("Please select at least one image to generate similar content");return}console.log(" Using images for similarity generation:",H.length);const Q=await tn.generateSimilar({images:H,prompt:`Create an image of the exact same type of object/item as shown in the reference image(s). If it's sunglasses, generate different sunglasses. If it's a car, generate a different car. ${E}. Do NOT change the object category - keep it as the same type of item but with variations in design, color, or style.`,aspectRatio:"1:1"});j(),Q?(await p(Q),console.log(" Similar image generated and added to canvas!")):(console.error(" No image generated from similarity API"),alert("Failed to generate similar image - no result returned"))}catch(I){console.error(" Generate similar error:",I),j(),alert("Failed to generate similar image: "+I)}},D=async()=>{if(!(!r||n.selectedObjects.length===0)){console.log(" Exporting selected objects:",n.selectedObjects.length);try{let E=1/0,I=1/0,H=-1/0,Q=-1/0;n.selectedObjects.forEach(K=>{const Z=K.getBoundingRect();E=Math.min(E,Z.left),I=Math.min(I,Z.top),H=Math.max(H,Z.left+Z.width),Q=Math.max(Q,Z.top+Z.height)});const z=20,F=H-E+z*2,V=Q-I+z*2;console.log(" Export bounds:",{minX:E,minY:I,maxX:H,maxY:Q,exportWidth:F,exportHeight:V});const q=document.createElement("canvas");q.width=F,q.height=V;const A=new He.fabric.Canvas(q);A.setWidth(F),A.setHeight(V),A.backgroundColor="transparent";const W=n.selectedObjects.map(K=>new Promise(Z=>{K.clone(Y=>{const B=K.getBoundingRect();Y.set({left:B.left-E+z,top:B.top-I+z}),A.add(Y),console.log(" Cloned object:",Y.type,"at",Y.left,Y.top),Z()})}));await Promise.all(W),A.renderAll(),setTimeout(()=>{const K=A.toDataURL({format:"png",quality:1,multiplier:2});if(K&&K!=="data:,"){const Z=document.createElement("a");Z.download=`selected-objects-${Date.now()}.png`,Z.href=K,document.body.appendChild(Z),Z.click(),document.body.removeChild(Z),console.log(" Export completed successfully")}else console.error(" Failed to generate image data");A.dispose()},200)}catch(E){console.error(" Export error:",E)}}},P=(E,I=0)=>{if(!r)return null;const H=`
      <svg width="400" height="200" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="progress-bg" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#667eea;stop-opacity:0.9" />
            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:0.9" />
          </linearGradient>
          <linearGradient id="progress-bar" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#4ade80;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#22c55e;stop-opacity:1" />
          </linearGradient>
        </defs>
        
        <!-- Background -->
        <rect width="100%" height="100%" rx="12" fill="url(#progress-bg)" stroke="#ffffff" stroke-width="2"/>
        
        <!-- Progress bar background -->
        <rect x="30" y="140" width="340" height="8" rx="4" fill="rgba(255,255,255,0.2)"/>
        
        <!-- Progress bar -->
        <rect x="30" y="140" width="${Math.max(10,I*85)}" height="8" rx="4" fill="url(#progress-bar)">
          <animate attributeName="width" values="${I*85};${(I+.2)*85};${I*85}" dur="2s" repeatCount="indefinite"/>
        </rect>
        
        <!-- Icon -->
        <circle cx="200" cy="80" r="25" fill="rgba(255,255,255,0.2)" stroke="#ffffff" stroke-width="2">
          <animate attributeName="r" values="25;30;25" dur="2s" repeatCount="indefinite"/>
        </circle>
        <text x="200" y="88" text-anchor="middle" fill="#ffffff" font-size="24"></text>
        
        <!-- Message -->
        <text x="200" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14" font-weight="bold">
          ${E}
        </text>
        
        <!-- Dots animation -->
        <text x="330" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14">
          <animate attributeName="opacity" values="0;1;0" dur="1.5s" repeatCount="indefinite"/>
          .
        </text>
        <text x="340" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14">
          <animate attributeName="opacity" values="0;1;0" dur="1.5s" begin="0.5s" repeatCount="indefinite"/>
          .
        </text>
        <text x="350" y="125" text-anchor="middle" fill="#ffffff" font-family="Arial, sans-serif" font-size="14">
          <animate attributeName="opacity" values="0;1;0" dur="1.5s" begin="1s" repeatCount="indefinite"/>
          .
        </text>
      </svg>
    `,Q=`data:image/svg+xml,${encodeURIComponent(H)}`;return new Promise(z=>{He.fabric.Image.fromURL(Q,F=>{F&&(F.set({left:r.width/2,top:r.height/2,originX:"center",originY:"center",selectable:!1,evented:!1,isProgressImage:!0}),r.add(F),r.bringToFront(F),r.renderAll(),z(F))})})},j=()=>{if(!r)return;r.getObjects().filter(I=>I.isProgressImage).forEach(I=>r.remove(I)),r.renderAll()},X=async(E,I,H)=>{if(!(!r||!E))return r.remove(E),await P(I,H)},M=async()=>{if(n.selectedObjects.length<2)return;let E,I=null;try{const H=n.selectedObjects.filter(z=>z.type==="image").map(z=>{var F;return((F=z._originalElement)==null?void 0:F.src)||z.src}).filter(Boolean);if(H.length<2){alert("Please select at least 2 images for AI composition");return}c(z=>({...z,visible:!1})),I=await P(`Analyzing ${H.length} images`,.1),E=setTimeout(()=>{console.warn(" Progress timeout - removing progress image"),j(),alert("AI processing took too long - please try again")},3e4),setTimeout(async()=>{I&&(I=await X(I,"AI is composing your masterpiece",.4))},1e3),setTimeout(async()=>{I&&(I=await X(I,"Rendering high-quality result",.7))},2e3);const Q=await tn.mergeImages(H,"Intelligent auto-compose - merge the key subjects and elements naturally into a cohesive, professional composition");clearTimeout(E),I&&(I=await X(I,"Adding final touches",.9)),setTimeout(async()=>{try{j(),await p(Q),console.log(` AI Smart Composition completed! Merged ${H.length} images intelligently.`)}catch(z){console.error("Failed to import generated image:",z),j(),alert("Image generation completed but failed to display on canvas: "+z)}},500)}catch(H){console.error("AI Composition failed:",H),E&&clearTimeout(E),j(),alert("AI Composition failed: "+H)}},k=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(H=>H.type==="image").map(H=>{var Q;return((Q=H._originalElement)==null?void 0:Q.src)||H.src}).filter(Boolean);if(E.length<2)return;c(H=>({...H,visible:!1}));const I=await tn.mergeImages(E,"Make the person wear or use the accessories/items naturally. Ensure realistic lighting, shadows, and proportions.");await p(I),alert(" Accessory composition completed! Items naturally integrated.")}catch(E){console.error("Accessory composition failed:",E),alert("Accessory composition failed: "+E)}},L=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(H=>H.type==="image").map(H=>{var Q;return((Q=H._originalElement)==null?void 0:Q.src)||H.src}).filter(Boolean);if(E.length<2)return;c(H=>({...H,visible:!1}));const I=await tn.mergeImages(E,"Create a realistic scene by placing subjects into backgrounds naturally. Match lighting, shadows, and perspective perfectly.");await p(I),alert(" Scene integration completed! Objects naturally placed in scene.")}catch(E){console.error("Scene composition failed:",E),alert("Scene composition failed: "+E)}},R=async()=>{if(!(n.selectedObjects.length<2))try{const E=n.selectedObjects.filter(H=>H.type==="image").map(H=>{var Q;return((Q=H._originalElement)==null?void 0:Q.src)||H.src}).filter(Boolean);if(E.length<2)return;c(H=>({...H,visible:!1}));const I=await tn.mergeImages(E,"Create an artistic, creative blend that combines the best elements from all images in an innovative and visually stunning way.");await p(I),alert(" Creative blend completed! Innovative artistic fusion created.")}catch(E){console.error("Creative blend failed:",E),alert("Creative blend failed: "+E)}},$=()=>{if(!r||n.selectedObjects.length<=1)return;const E=new He.fabric.Group(n.selectedObjects,{left:Math.min(...n.selectedObjects.map(I=>I.left||0)),top:Math.min(...n.selectedObjects.map(I=>I.top||0))});n.selectedObjects.forEach(I=>r.remove(I)),r.add(E),r.setActiveObject(E),r.renderAll()};return b.jsxs("div",{ref:e,className:"canvas-container flex-1 relative",onContextMenu:E=>(console.log(" CONTAINER RIGHT CLICK!"),E.preventDefault(),E.stopPropagation(),!1),onMouseDown:E=>{console.log(" CONTAINER MOUSE DOWN - Button:",E.button),E.button===2&&(console.log(" CONTAINER RIGHT CLICK DETECTED!"),E.preventDefault(),E.stopPropagation(),c({visible:!0,x:E.clientX,y:E.clientY,selectedObjects:(r==null?void 0:r.getActiveObjects())||[]}))},children:[b.jsx("canvas",{ref:t}),b.jsx("div",{className:"absolute top-4 right-4 bg-white bg-opacity-90 rounded-lg px-3 py-2 shadow-lg border border-gray-200",children:b.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{children:" Mouse:"}),b.jsxs("span",{className:"font-mono bg-gray-100 px-2 py-0.5 rounded",children:["x:",m.x," y:",m.y]})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{children:" Center:"}),b.jsxs("span",{className:"font-mono bg-blue-100 px-2 py-0.5 rounded",children:["x:",w.x," y:",w.y]})]}),b.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[b.jsx("button",{onClick:f,className:"text-xs px-2 py-1 bg-green-100 hover:bg-green-200 text-green-700 rounded transition-colors",title:"Go to origin (0,0)",children:" Origin"}),b.jsx("button",{onClick:()=>u(!s),className:`text-xs px-2 py-1 rounded transition-colors ${s?"bg-purple-200 text-purple-700":"bg-gray-100 hover:bg-gray-200 text-gray-700"}`,title:"Toggle grid",children:" Grid"})]})]})}),b.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center space-x-2",children:[b.jsx("button",{onClick:S,className:"bg-white bg-opacity-75 hover:bg-opacity-100 rounded p-2 text-gray-600 transition-all",title:"Zoom out (Ctrl+Mouse wheel)",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})})}),b.jsxs("button",{onClick:C,className:"bg-white bg-opacity-75 hover:bg-opacity-100 rounded px-3 py-1 text-sm text-gray-600 min-w-[60px] transition-all",title:"Reset zoom and pan",children:[Math.round(v*100),"%"]}),b.jsx("button",{onClick:x,className:"bg-white bg-opacity-75 hover:bg-opacity-100 rounded p-2 text-gray-600 transition-all",title:"Zoom in (Ctrl+Mouse wheel)",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})]}),b.jsx("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 rounded-lg px-3 py-2 text-xs text-gray-600 shadow-lg border border-gray-200",children:b.jsxs("div",{className:"space-y-1",children:[b.jsxs("div",{children:[" ",b.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Cmd"})," + Trackpad: Zoom"]}),b.jsx("div",{children:" Trackpad: Move canvas"}),b.jsxs("div",{children:[" ",b.jsx("kbd",{className:"px-1 py-0.5 bg-blue-100 rounded text-xs",children:"Shift"})," + Click: Multi-select"]}),b.jsxs("div",{children:[" ",b.jsx("kbd",{className:"px-1 py-0.5 bg-purple-100 rounded text-xs",children:"Cmd"})," + Click: Add/Remove selection"]})]})}),b.jsx(Xg,{x:n.x,y:n.y,visible:n.visible,selectedCount:n.selectedObjects.length,onClose:()=>c(E=>({...E,visible:!1})),onMergeImages:te,onStyleTransfer:se,onDuplicate:ne,onDelete:re,onBringToFront:ae,onSendToBack:le,onRotate:G,onGenerateSimilar:_,onExportSelected:D,onIntelligentCompose:M,onWearAccessory:k,onSceneCompose:L,onCreativeBlend:R,onGroupSelection:$})]})},Gg=[],$g=()=>{const{tool:t,setTool:e,undo:n,redo:c,canUndo:m,canRedo:y,clearCanvas:w}=yr(),{addImages:h}=To(),s=f=>{e(f)},u=()=>{const f=document.createElement("input");f.type="file",f.accept="image/*",f.multiple=!0,f.onchange=async r=>{const a=r.target.files;a&&a.length>0&&await h(a,{autoArrange:!0,spacing:20,maxWidth:200,maxHeight:200})},f.click()};return b.jsxs("div",{className:"tool-panel w-16 flex flex-col items-center py-4 space-y-2",children:[b.jsx("div",{className:"flex flex-col space-y-1",children:b.jsx("button",{onClick:u,className:"w-10 h-10 rounded-lg bg-blue-100 hover:bg-blue-200 text-blue-600 flex items-center justify-center transition-all duration-200",title:"Import Multiple Images",children:b.jsx(ig,{className:"w-5 h-5"})})}),b.jsx("div",{className:"w-8 h-px bg-gray-300 my-2"}),b.jsx("div",{className:"flex flex-col space-y-1",children:Gg.map(f=>{const r=f.icon,a=t===f.id;return b.jsx("button",{onClick:()=>s(f.id),className:`
                w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200
                ${a?"bg-primary-600 text-white shadow-md":"bg-gray-100 hover:bg-gray-200 text-gray-600"}
              `,title:`${f.label} (${f.shortcut})`,children:b.jsx(r,{className:"w-5 h-5"})},f.id)})}),b.jsxs("div",{className:"flex flex-col space-y-1",children:[b.jsx("button",{onClick:n,disabled:!m(),className:`
            w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200
            ${m()?"bg-gray-100 hover:bg-gray-200 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Undo (Ctrl+Z)",children:b.jsx(dg,{className:"w-5 h-5"})}),b.jsx("button",{onClick:c,disabled:!y(),className:`
            w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200
            ${y()?"bg-gray-100 hover:bg-gray-200 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Redo (Ctrl+Y)",children:b.jsx(cg,{className:"w-5 h-5"})})]}),b.jsx("div",{className:"w-8 h-px bg-gray-300 my-2"}),b.jsx("div",{className:"flex flex-col space-y-1",children:b.jsx("button",{onClick:w,className:"w-10 h-10 rounded-lg bg-red-100 hover:bg-red-200 text-red-600 flex items-center justify-center transition-all duration-200",title:"Clear Canvas",children:b.jsx(sh,{className:"w-5 h-5"})})})]})};function Kg(t,e){let n;try{n=t()}catch{return}return{getItem:m=>{var y;const w=s=>s===null?null:JSON.parse(s,e==null?void 0:e.reviver),h=(y=n.getItem(m))!=null?y:null;return h instanceof Promise?h.then(w):w(h)},setItem:(m,y)=>n.setItem(m,JSON.stringify(y,e==null?void 0:e.replacer)),removeItem:m=>n.removeItem(m)}}const Fr=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(c){return Fr(c)(n)},catch(c){return this}}}catch(n){return{then(c){return this},catch(c){return Fr(c)(n)}}}},qg=(t,e)=>(n,c,m)=>{let y={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:o=>o,version:0,merge:(o,g)=>({...g,...o}),...e},w=!1;const h=new Set,s=new Set;let u;try{u=y.getStorage()}catch{}if(!u)return t((...o)=>{console.warn(`[zustand persist middleware] Unable to update item '${y.name}', the given storage is currently unavailable.`),n(...o)},c,m);const f=Fr(y.serialize),r=()=>{const o=y.partialize({...c()});let g;const p=f({state:o,version:y.version}).then(v=>u.setItem(y.name,v)).catch(v=>{g=v});if(g)throw g;return p},a=m.setState;m.setState=(o,g)=>{a(o,g),r()};const i=t((...o)=>{n(...o),r()},c,m);let l;const d=()=>{var o;if(!u)return;w=!1,h.forEach(p=>p(c()));const g=((o=y.onRehydrateStorage)==null?void 0:o.call(y,c()))||void 0;return Fr(u.getItem.bind(u))(y.name).then(p=>{if(p)return y.deserialize(p)}).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==y.version){if(y.migrate)return y.migrate(p.state,p.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return p.state}).then(p=>{var v;return l=y.merge(p,(v=c())!=null?v:i),n(l,!0),r()}).then(()=>{g==null||g(l,void 0),w=!0,s.forEach(p=>p(l))}).catch(p=>{g==null||g(void 0,p)})};return m.persist={setOptions:o=>{y={...y,...o},o.getStorage&&(u=o.getStorage())},clearStorage:()=>{u==null||u.removeItem(y.name)},getOptions:()=>y,rehydrate:()=>d(),hasHydrated:()=>w,onHydrate:o=>(h.add(o),()=>{h.delete(o)}),onFinishHydration:o=>(s.add(o),()=>{s.delete(o)})},d(),l||i},Qg=(t,e)=>(n,c,m)=>{let y={storage:Kg(()=>localStorage),partialize:d=>d,version:0,merge:(d,o)=>({...o,...d}),...e},w=!1;const h=new Set,s=new Set;let u=y.storage;if(!u)return t((...d)=>{console.warn(`[zustand persist middleware] Unable to update item '${y.name}', the given storage is currently unavailable.`),n(...d)},c,m);const f=()=>{const d=y.partialize({...c()});return u.setItem(y.name,{state:d,version:y.version})},r=m.setState;m.setState=(d,o)=>{r(d,o),f()};const a=t((...d)=>{n(...d),f()},c,m);m.getInitialState=()=>a;let i;const l=()=>{var d,o;if(!u)return;w=!1,h.forEach(p=>{var v;return p((v=c())!=null?v:a)});const g=((o=y.onRehydrateStorage)==null?void 0:o.call(y,(d=c())!=null?d:a))||void 0;return Fr(u.getItem.bind(u))(y.name).then(p=>{if(p)if(typeof p.version=="number"&&p.version!==y.version){if(y.migrate)return[!0,y.migrate(p.state,p.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,p.state];return[!1,void 0]}).then(p=>{var v;const[x,S]=p;if(i=y.merge(S,(v=c())!=null?v:a),n(i,!0),x)return f()}).then(()=>{g==null||g(i,void 0),i=c(),w=!0,s.forEach(p=>p(i))}).catch(p=>{g==null||g(void 0,p)})};return m.persist={setOptions:d=>{y={...y,...d},d.storage&&(u=d.storage)},clearStorage:()=>{u==null||u.removeItem(y.name)},getOptions:()=>y,rehydrate:()=>l(),hasHydrated:()=>w,onHydrate:d=>(h.add(d),()=>{h.delete(d)}),onFinishHydration:d=>(s.add(d),()=>{s.delete(d)})},y.skipHydration||l(),i||a},Jg=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?qg(t,e):Qg(t,e),hh=Jg,Zg=t=>!t||t.length<=8?"":`${t.slice(0,4)}${t.slice(-4)}`,Ul=t=>t.trim().replace(/[\x00-\x1F\x7F]/g,""),Wl=(t,e)=>{if(!/^[a-zA-Z0-9\-_]+$/.test(e))return!1;switch(t){case"openai":return/^sk-[a-zA-Z0-9]{48,}$/.test(e);case"anthropic":return/^sk-ant-api[0-9]{2}-[a-zA-Z0-9\-]{32,}$/.test(e);case"falai":return e.length>=32&&e.length<=128;case"replicate":return/^r8_[a-zA-Z0-9]{39}$/.test(e)||e.length>=40;case"stabilityai":return/^sk-[a-zA-Z0-9]{48,}$/.test(e);default:return!1}},ep=async t=>{try{const n=new TextEncoder().encode(t),c=window.location.origin.repeat(Math.ceil(t.length/window.location.origin.length)),m=Array.from(n).map((y,w)=>y^c.charCodeAt(w%c.length));return btoa(String.fromCharCode(...m))}catch{return btoa(t)}},tp=async t=>{try{const e=atob(t),n=Array.from(e).map(w=>w.charCodeAt(0)),c=window.location.origin.repeat(Math.ceil(n.length/window.location.origin.length)),m=n.map((w,h)=>w^c.charCodeAt(h%c.length));return new TextDecoder().decode(new Uint8Array(m))}catch{try{return atob(t)}catch{return""}}},jn=is()(hh((t,e)=>({apiKeys:{},isConfigured:!1,setAPIKey:(n,c)=>{const m=Ul(c);if(!Wl(n,m)){console.error(`Invalid API key format for ${n}`);return}t(y=>({apiKeys:{...y.apiKeys,[n]:m},isConfigured:!0}))},removeAPIKey:n=>{t(c=>{const m={...c.apiKeys};return delete m[n],{apiKeys:m,isConfigured:Object.keys(m).length>0}})},clearAllKeys:()=>{t({apiKeys:{},isConfigured:!1}),localStorage.removeItem("api-keys-storage")},validateAPIKey:async(n,c)=>{const m=Ul(c);return!!Wl(n,m)},getObfuscatedKey:n=>{const c=e().apiKeys[n];return c?Zg(c):void 0}}),{name:"api-keys-storage",storage:{getItem:async t=>{const e=localStorage.getItem(t);if(!e)return null;try{const n=JSON.parse(e),c=await tp(n.state);return{state:JSON.parse(c)}}catch(n){return console.error("Failed to decrypt API keys:",n),localStorage.removeItem(t),null}},setItem:async(t,e)=>{try{const n=await ep(JSON.stringify(e.state));localStorage.setItem(t,JSON.stringify({state:n,version:"1.0",timestamp:Date.now()}))}catch(n){console.error("Failed to encrypt API keys:",n)}},removeItem:t=>{localStorage.removeItem(t)}}}));class np{constructor(){qn(this,"rateLimits",new Map);qn(this,"RATE_LIMIT_WINDOW",6e4);qn(this,"MAX_REQUESTS_PER_WINDOW",10)}getAPIKey(e){const n=jn.getState().apiKeys[e];if(n&&!this.isKeyValid(n)){console.error(`Invalid API key detected for ${e}`);return}return n}isKeyValid(e){return!(e.includes("<script")||e.includes("javascript:")||e.includes("onclick"))}checkRateLimit(e){const n=Date.now(),c=this.rateLimits.get(e);return!c||n>c.resetTime?(this.rateLimits.set(e,{count:1,resetTime:n+this.RATE_LIMIT_WINDOW}),!0):c.count>=this.MAX_REQUESTS_PER_WINDOW?!1:(c.count++,!0)}async generateImage(e){var m,y;if(!this.checkRateLimit("falai"))throw new Error("Rate limit exceeded. Please wait a moment before trying again.");const n=this.getAPIKey("falai");if(!n)throw new Error("Please configure your Fal.ai API key in Settings to generate images");const c=this.sanitizeInput(e.prompt);try{const w=await fetch("https://fal.run/fal-ai/flux-lora",{method:"POST",headers:{Authorization:`Key ${n}`,"Content-Type":"application/json"},body:JSON.stringify({prompt:c,image_size:{width:e.width||1024,height:e.height||1024},num_inference_steps:e.quality==="high"?50:25,guidance_scale:7.5,num_images:1,enable_safety_checker:!0})});if(!w.ok){const u=await w.text();throw new Error(`Fal.ai API error: ${w.status} - ${u}`)}const h=await w.json(),s=((y=(m=h.images)==null?void 0:m[0])==null?void 0:y.url)||h.url;if(!s)throw new Error("No image URL returned from Fal.ai");return{url:s,width:e.width||1024,height:e.height||1024,prompt:c,provider:"fal",metadata:{timestamp:Date.now(),model:"flux-lora",...h.metadata}}}catch(w){throw console.error("Image generation error:",w),w}}async imageToImage(e){var y;if(!this.checkRateLimit("falai"))throw new Error("Rate limit exceeded. Please wait a moment before trying again.");const n=this.getAPIKey("falai");if(!n)throw new Error("Please configure your Fal.ai API key in Settings to use image-to-image generation");const c=this.sanitizeInput(e.prompt),m=this.sanitizeUrl(e.imageUrl);try{const w=await fetch("https://fal.run/fal-ai/creative-upscaler",{method:"POST",headers:{Authorization:`Key ${n}`,"Content-Type":"application/json"},body:JSON.stringify({image_url:m,prompt:c,creativity:e.strength||.5,resemblance:1-(e.strength||.5),scale:2})});if(!w.ok){const u=await w.text();throw new Error(`Fal.ai API error: ${w.status} - ${u}`)}const h=await w.json(),s=((y=h.image)==null?void 0:y.url)||h.url;if(!s)throw new Error("No image URL returned from Fal.ai");return{url:s,width:e.width||1024,height:e.height||1024,prompt:c,provider:"fal",metadata:{timestamp:Date.now(),model:"creative-upscaler",originalImage:m}}}catch(w){throw console.error("Image-to-image error:",w),w}}async generateVideo(e,n,c=5){var w;if(!this.checkRateLimit("falai"))throw new Error("Rate limit exceeded. Please wait a moment before trying again.");const m=this.getAPIKey("falai");if(!m)throw new Error("Please configure your Fal.ai API key in Settings to generate videos");const y=n?this.sanitizeUrl(n):void 0;try{const h=await fetch("https://fal.run/fal-ai/stable-video",{method:"POST",headers:{Authorization:`Key ${m}`,"Content-Type":"application/json"},body:JSON.stringify({image_url:y,motion_bucket_id:127,cond_aug:.02,fps:25,num_inference_steps:25})});if(!h.ok){const u=await h.text();throw new Error(`Fal.ai API error: ${h.status} - ${u}`)}const s=await h.json();return{url:((w=s.video)==null?void 0:w.url)||s.url}}catch(h){throw console.error("Video generation error:",h),h}}async generateText(e,n){if(!this.checkRateLimit("text-generation"))throw new Error("Rate limit exceeded. Please wait a moment before trying again.");const c=this.getAPIKey("openai"),m=this.getAPIKey("anthropic"),y=this.sanitizeInput(e),w=n?this.sanitizeInput(n):void 0;if(c)try{const h=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4-turbo-preview",messages:[{role:"system",content:w||"You are a helpful assistant."},{role:"user",content:y}],max_tokens:500,temperature:.7})});if(!h.ok)throw new Error(`OpenAI API error: ${h.status}`);return(await h.json()).choices[0].message.content}catch(h){console.error("OpenAI error:",h)}if(m)try{const h=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":m,"anthropic-version":"2023-06-01","Content-Type":"application/json"},body:JSON.stringify({model:"claude-3-sonnet-20240229",max_tokens:500,messages:[{role:"user",content:w?`${w}

${y}`:y}]})});if(!h.ok)throw new Error(`Anthropic API error: ${h.status}`);return(await h.json()).content[0].text}catch(h){console.error("Anthropic error:",h)}throw new Error("Please configure either an OpenAI or Anthropic API key in Settings to generate text")}async testConnection(){const e=jn.getState().apiKeys;return Object.keys(e).length===0?!1:!!e.falai}isConfigured(){const{isConfigured:e}=jn.getState();return e}getConfiguredServices(){const e=jn.getState().apiKeys;return Object.keys(e).filter(n=>!!e[n])}sanitizeInput(e){return e.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim().substring(0,2e3)}sanitizeUrl(e){try{const n=new URL(e);if(!["http:","https:","data:"].includes(n.protocol))throw new Error("Invalid URL protocol");return e}catch{if(e.startsWith("data:image/"))return e;throw new Error("Invalid image URL")}}}const Ue=new np,fh=is()(hh(t=>({currentLanguage:"en",setLanguage:e=>t({currentLanguage:e})}),{name:"language-storage"})),rp={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"AI Assistant",tabs:{storyMaker:"Story Maker",generate:"Generate"},generate:{templates:{title:"Popular Nano Banana Templates (Click to use)",withSelection:"+ Selected Images",categories:{all:"All",creative:" Creative",professional:" Professional",fun:" Fun"},items:{figurine:{title:"3D Figurine",description:"Desktop model"},handDrawn:{title:"Hand-drawn Process",description:"Sketch to final"},crossSection:{title:"3D Cross-section",description:"Internal structure"},restoration:{title:"Photo Restoration",description:"Colorize & repair"},idPhoto:{title:"Professional ID",description:"Business portrait"},product:{title:"Product Shot",description:"E-commerce photo"},interior:{title:"Interior Design",description:"Space makeover"},marketing:{title:"Marketing Material",description:"Social media"},tryOn:{title:"Virtual Try-on",description:"Outfit swap"},timeTravel:{title:"Time Travel",description:"Different eras"},petAdventure:{title:"Pet Adventures",description:"Fun scenarios"},ingredients:{title:"Food Breakdown",description:"Recipe guide"}},applied:" Template applied! You can generate directly or modify the prompt above"},placeholder:"Describe what you want to generate...",generateButton:"Generate with Nano Banana",generating:"Generating with Nano Banana...",imageToImageMode:" Image-to-Image Mode",imageToImageDescription:"Your selected images will be combined with your prompt/template to generate new images.",quickEnhancements:" Quick Enhancements (Click to toggle)",enhancementItems:["viral meme style","4K ultra HD","cinematic lighting","trending on artstation","octane render"],selectedImages:"images selected from canvas",invalidForTab:"Invalid for"},storyMaker:{title:"Story Maker",description:"Create 4-panel comic stories with consistent characters",styleLabel:"Art Style",characterLabel:"Main Character",productLabel:"Featured Product",storyPromptLabel:"Story Concept",generateButton:"Generate 4-Panel Comic",useFromCanvas:"Use from Canvas",uploadImage:"Upload Image",generating:"Generating panel",placeholder:`Describe your story in one sentence...

Examples:
 A coffee shop encounter on a snowy Christmas night
 Finding the perfect gift during holiday shopping
 A friendship that blooms in a cozy bookstore`,styles:{comic:"Comic Book",manga:"Manga Style",watercolor:"Watercolor",oil:"Oil Painting",sketch:"Pencil Sketch"},characterSection:{title:"Main Character",description:"Upload or select the main character for your story",required:"Required",optional:"Optional"},productSection:{title:"Featured Product",description:"Add a product to feature in your story (optional)",optional:"Optional"},storySection:{title:"Story Concept",description:"Describe your story idea in one sentence",examples:["A coffee shop encounter on a snowy Christmas night","Finding the perfect gift during holiday shopping","A friendship that blooms in a cozy bookstore"]},generatingPanels:"Generating comic panels...",panelComplete:"Panel completed",storyComplete:"Comic story completed!",errors:{noStory:"Please enter a story prompt first!",characterRequired:"Please upload or select a character image!",generationFailed:"Comic generation failed. Please try again."}}},common:{loading:"Loading...",error:"Error",success:"Success",cancel:"Cancel",confirm:"Confirm",save:"Save",delete:"Delete",edit:"Edit",close:"Close"}},ip={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"AI ",tabs:{storyMaker:"",generate:""},generate:{templates:{title:"Nano Banana  ()",withSelection:"+ ",categories:{all:"",creative:" ",professional:" ",fun:" "},items:{figurine:{title:"3D ",description:""},handDrawn:{title:"",description:""},crossSection:{title:"3D ",description:""},restoration:{title:"",description:""},idPhoto:{title:"",description:""},product:{title:"",description:""},interior:{title:"",description:""},marketing:{title:"",description:""},tryOn:{title:"",description:""},timeTravel:{title:"",description:""},petAdventure:{title:"",description:""},ingredients:{title:"",description:""}},applied:" "},placeholder:"...",generateButton:" Nano Banana ",generating:" Nano Banana ...",imageToImageMode:" ",imageToImageDescription:"/",quickEnhancements:"  ()",enhancementItems:["","4K ","","","Octane "],selectedImages:"",invalidForTab:""},storyMaker:{title:"",description:"",styleLabel:"",characterLabel:"",productLabel:"",storyPromptLabel:"",generateButton:"",useFromCanvas:"",uploadImage:"",generating:"",placeholder:`...


 
 
 `,styles:{comic:"",manga:"",watercolor:"",oil:"",sketch:""},characterSection:{title:"",description:"",required:"",optional:""},productSection:{title:"",description:"",optional:""},storySection:{title:"",description:"",examples:["","",""]},generatingPanels:"...",panelComplete:"",storyComplete:"",errors:{noStory:"",characterRequired:"",generationFailed:""}}},common:{loading:"...",error:"",success:"",cancel:"",confirm:"",save:"",delete:"",edit:"",close:""}},sp={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"Asistente IA",tabs:{storyMaker:"Creador de Historias",generate:"Generar"},generate:{templates:{title:"Plantillas Populares de Nano Banana (Clic para usar)",withSelection:"+ Imgenes Seleccionadas",categories:{all:"Todas",creative:" Creativo",professional:" Profesional",fun:" Diversin"},items:{figurine:{title:"Figura 3D",description:"Modelo de escritorio"},handDrawn:{title:"Proceso Dibujado",description:"Boceto a final"},crossSection:{title:"Seccin 3D",description:"Estructura interna"},restoration:{title:"Restaurar Foto",description:"Colorear y reparar"},idPhoto:{title:"ID Profesional",description:"Retrato empresarial"},product:{title:"Foto de Producto",description:"Foto e-commerce"},interior:{title:"Diseo Interior",description:"Renovacin espacial"},marketing:{title:"Material Marketing",description:"Redes sociales"},tryOn:{title:"Prueba Virtual",description:"Cambio de ropa"},timeTravel:{title:"Viaje en el Tiempo",description:"Diferentes pocas"},petAdventure:{title:"Aventuras Mascota",description:"Escenas divertidas"},ingredients:{title:"Desglose Comida",description:"Gua de receta"}},applied:" Plantilla aplicada! Puedes generar directamente o modificar el prompt arriba"},placeholder:"Describe lo que quieres generar...",generateButton:"Generar con Nano Banana",generating:"Generando con Nano Banana...",imageToImageMode:" Modo Imagen a Imagen",imageToImageDescription:"Tus imgenes seleccionadas se combinarn con tu prompt/plantilla para generar nuevas imgenes.",quickEnhancements:" Mejoras Rpidas (Clic para alternar)",enhancementItems:["estilo meme viral","4K ultra HD","iluminacin cinematogrfica","tendencia en artstation","render octane"],selectedImages:"imgenes seleccionadas del lienzo",invalidForTab:"No vlido para"},storyMaker:{title:"Creador de Historias",description:"Crea historias de cmic de 4 paneles con personajes consistentes",styleLabel:"Estilo Artstico",characterLabel:"Personaje Principal",productLabel:"Producto Destacado",storyPromptLabel:"Concepto de Historia",generateButton:"Generar Cmic de 4 Paneles",useFromCanvas:"Usar del Lienzo",uploadImage:"Subir Imagen",generating:"Generando panel",placeholder:`Describe tu historia en una oracin...

Ejemplos:
 Un encuentro en una cafetera en una noche navidea nevada
 Encontrar el regalo perfecto durante las compras navideas
 Una amistad que florece en una acogedora librera`,styles:{comic:"Cmic",manga:"Estilo Manga",watercolor:"Acuarela",oil:"Pintura al leo",sketch:"Boceto a Lpiz"},characterSection:{title:"Personaje Principal",description:"Sube o selecciona el personaje principal de tu historia",required:"Requerido",optional:"Opcional"},productSection:{title:"Producto Destacado",description:"Agrega un producto para destacar en tu historia (opcional)",optional:"Opcional"},storySection:{title:"Concepto de Historia",description:"Describe tu idea de historia en una oracin",examples:["Un encuentro en una cafetera en una noche navidea nevada","Encontrar el regalo perfecto durante las compras navideas","Una amistad que florece en una acogedora librera"]},generatingPanels:"Generando paneles de cmic...",panelComplete:"Panel completado",storyComplete:"Historia de cmic completada!",errors:{noStory:"Por favor ingresa una propuesta de historia primero!",characterRequired:"Por favor sube o selecciona una imagen de personaje!",generationFailed:"La generacin del cmic fall. Por favor intenta de nuevo."}}},common:{loading:"Cargando...",error:"Error",success:"xito",cancel:"Cancelar",confirm:"Confirmar",save:"Guardar",delete:"Eliminar",edit:"Editar",close:"Cerrar"}},ap={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"AI",tabs:{storyMaker:"",generate:""},generate:{templates:{title:"Nano Banana ",withSelection:"+ ",categories:{all:"",creative:" ",professional:" ",fun:" "},items:{figurine:{title:"3D",description:""},handDrawn:{title:"",description:""},crossSection:{title:"3D",description:""},restoration:{title:"",description:""},idPhoto:{title:"ID",description:""},product:{title:"",description:"EC"},interior:{title:"",description:""},marketing:{title:"",description:""},tryOn:{title:"",description:""},timeTravel:{title:"",description:""},petAdventure:{title:"",description:""},ingredients:{title:"",description:""}},applied:" "},placeholder:"...",generateButton:"Nano Banana",generating:"Nano Banana...",imageToImageMode:" ",imageToImageDescription:"/",quickEnhancements:" ",enhancementItems:["","4K HD","","artstation ","octane "],selectedImages:"",invalidForTab:""},storyMaker:{title:"",description:"4",styleLabel:"",characterLabel:"",productLabel:"",storyPromptLabel:"",generateButton:"4",useFromCanvas:"",uploadImage:"",generating:"",placeholder:`...


 
 
 `,styles:{comic:"",manga:"",watercolor:"",oil:"",sketch:""},characterSection:{title:"",description:"",required:"",optional:""},productSection:{title:"",description:"",optional:""},storySection:{title:"",description:"",examples:["","",""]},generatingPanels:"...",panelComplete:"",storyComplete:"",errors:{noStory:"",characterRequired:"",generationFailed:""}}},common:{loading:"...",error:"",success:"",cancel:"",confirm:"",save:"",delete:"",edit:"",close:""}},op={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"Assistant IA",tabs:{storyMaker:"Crateur d'Histoires",generate:"Gnrer"},generate:{templates:{title:"Modles Populaires Nano Banana (Cliquer pour utiliser)",withSelection:"+ Images Slectionnes",categories:{all:"Tous",creative:" Cratif",professional:" Professionnel",fun:" Amusant"},items:{figurine:{title:"Figurine 3D",description:"Modle de bureau"},handDrawn:{title:"Processus Dessin",description:"Croquis au final"},crossSection:{title:"Coupe 3D",description:"Structure interne"},restoration:{title:"Restauration Photo",description:"Coloriser et rparer"},idPhoto:{title:"ID Professionnel",description:"Portrait d'affaires"},product:{title:"Photo Produit",description:"Photo e-commerce"},interior:{title:"Design Intrieur",description:"Relooking espace"},marketing:{title:"Matriel Marketing",description:"Mdias sociaux"},tryOn:{title:"Essai Virtuel",description:"Changement tenue"},timeTravel:{title:"Voyage Temporel",description:"poques diffrentes"},petAdventure:{title:"Aventures Animaux",description:"Scnes amusantes"},ingredients:{title:"Dcomposition Plat",description:"Guide recette"}},applied:" Modle appliqu! Vous pouvez gnrer directement ou modifier le prompt ci-dessus"},placeholder:"Dcrivez ce que vous voulez gnrer...",generateButton:"Gnrer avec Nano Banana",generating:"Gnration avec Nano Banana...",imageToImageMode:" Mode Image  Image",imageToImageDescription:"Vos images slectionnes seront combines avec votre prompt/modle pour gnrer de nouvelles images.",quickEnhancements:" Amliorations Rapides (Cliquer pour basculer)",enhancementItems:["style mme viral","4K ultra HD","clairage cinmatographique","tendance sur artstation","rendu octane"],selectedImages:"images slectionnes du canevas",invalidForTab:"Non valide pour"},storyMaker:{title:"Crateur d'Histoires",description:"Crez des histoires de bande dessine  4 panneaux avec des personnages cohrents",styleLabel:"Style Artistique",characterLabel:"Personnage Principal",productLabel:"Produit Vedette",storyPromptLabel:"Concept d'Histoire",generateButton:"Gnrer BD 4 Panneaux",useFromCanvas:"Utiliser du Canevas",uploadImage:"Tlcharger Image",generating:"Gnration panneau",placeholder:`Dcrivez votre histoire en une phrase...

Exemples :
 Une rencontre dans un caf par une nuit de Nol enneige
 Trouver le cadeau parfait pendant les achats des ftes
 Une amiti qui s'panouit dans une librairie douillette`,styles:{comic:"Bande Dessine",manga:"Style Manga",watercolor:"Aquarelle",oil:"Peinture  l'Huile",sketch:"Croquis au Crayon"},characterSection:{title:"Personnage Principal",description:"Tlchargez ou slectionnez le personnage principal de votre histoire",required:"Requis",optional:"Optionnel"},productSection:{title:"Produit Vedette",description:"Ajoutez un produit  mettre en vedette dans votre histoire (optionnel)",optional:"Optionnel"},storySection:{title:"Concept d'Histoire",description:"Dcrivez votre ide d'histoire en une phrase",examples:["Une rencontre dans un caf par une nuit de Nol enneige","Trouver le cadeau parfait pendant les achats des ftes","Une amiti qui s'panouit dans une librairie douillette"]},generatingPanels:"Gnration des panneaux de BD...",panelComplete:"Panneau termin",storyComplete:"Histoire de BD termine !",errors:{noStory:"Veuillez d'abord entrer une proposition d'histoire !",characterRequired:"Veuillez tlcharger ou slectionner une image de personnage !",generationFailed:"La gnration de la BD a chou. Veuillez ressayer."}}},common:{loading:"Chargement...",error:"Erreur",success:"Succs",cancel:"Annuler",confirm:"Confirmer",save:"Sauvegarder",delete:"Supprimer",edit:"Modifier",close:"Fermer"}},Hl={en:rp,"zh-TW":ip,es:sp,ja:ap,fr:op};function lp(t){return Hl[t]||Hl.en}function cp(){const{currentLanguage:t}=fh();return lp(t)}const dh=[{id:"figurine",category:"creative",icon:"",withSelection:{en:"Transform the person from the reference image into a hyper-realistic 1/7 scale figurine, placed on an iMac computer desk with a white Apple keyboard. The figurine perfectly captures the person's appearance, clothing, and personality. The figurine stands on a transparent acrylic base. The iMac screen shows the ZBrush modeling process. Next to it is a packaging box designed to match the person's style theme.","zh-TW":"1/7iMacAppleiMacZBrush",es:"Transforma a la persona de la imagen de referencia en una figurita hiperrealista a escala 1/7, colocada en un escritorio de iMac con un teclado Apple blanco. La figurita captura perfectamente la apariencia, ropa y personalidad de la persona. La figurita est sobre una base acrlica transparente. La pantalla del iMac muestra el proceso de modelado en ZBrush. Junto a ella hay una caja de embalaje diseada para coincidir con el tema de estilo de la persona.",ja:"AppleiMac1/7iMacZBrush",fr:"Transformez la personne de l'image de rfrence en une figurine hyperraliste  l'chelle 1/7, place sur un bureau iMac avec un clavier Apple blanc. La figurine capture parfaitement l'apparence, les vtements et la personnalit de la personne. La figurine se dresse sur une base acrylique transparente. L'cran iMac affiche le processus de modlisation ZBrush.  ct se trouve une bote d'emballage conue pour correspondre au thme de style de la personne."},withoutSelection:{en:"Create an exquisite anime character 1/7 scale figurine, placed on a work desk, professional studio lighting, showcasing figurine details.","zh-TW":"1/7",es:"Crea una exquisita figurita de personaje de anime a escala 1/7, colocada en un escritorio de trabajo, iluminacin de estudio profesional, mostrando los detalles de la figurita.",ja:"1/7",fr:"Crez une figurine de personnage d'anime exquise  l'chelle 1/7, place sur un bureau de travail, clairage de studio professionnel, mettant en valeur les dtails de la figurine."}},{id:"handDrawn",category:"creative",icon:"",withSelection:{en:"Transform the image into a 4-stage hand-drawn illustration process: 1. Pencil sketch outline 2. Add basic lines 3. Add details and shadows 4. Complete color illustration. Show the drawing steps from sketch to finished artwork.","zh-TW":"41. 2. 3. 4.",es:"Transforma la imagen en un proceso de ilustracin dibujada a mano de 4 etapas: 1. Contorno de boceto a lpiz 2. Agregar lneas bsicas 3. Agregar detalles y sombras 4. Ilustracin completa en color. Muestra los pasos de dibujo desde el boceto hasta la obra terminada.",ja:"41. 2. 3. 4.",fr:"Transformez l'image en un processus d'illustration dessine  la main en 4 tapes : 1. Contour de croquis au crayon 2. Ajouter des lignes de base 3. Ajouter des dtails et des ombres 4. Illustration couleur complte. Montrez les tapes de dessin du croquis  l'uvre finie."},withoutSelection:{en:"Create a character's 4-stage hand-drawing process, from simple sketch to complete color illustration","zh-TW":"4",es:"Crea el proceso de dibujo a mano de 4 etapas de un personaje, desde un boceto simple hasta una ilustracin completa en color",ja:"4",fr:"Crez le processus de dessin  la main en 4 tapes d'un personnage, du croquis simple  l'illustration couleur complte"}},{id:"crossSection",category:"creative",icon:"",withSelection:{en:"Create a 3D cross-section diagram of the object, showing internal structure and components, technical diagram style, labeling each part, engineering drawing style","zh-TW":"3D",es:"Crea un diagrama de seccin transversal 3D del objeto, mostrando la estructura interna y los componentes, estilo de diagrama tcnico, etiquetando cada parte, estilo de dibujo de ingeniera",ja:"3D",fr:"Crez un diagramme de coupe transversale 3D de l'objet, montrant la structure interne et les composants, style de diagramme technique, tiquetant chaque partie, style de dessin d'ingnierie"},withoutSelection:{en:"Generate a 3D cross-section diagram of a building, showing internal floor structure","zh-TW":"3D",es:"Genera un diagrama de seccin transversal 3D de un edificio, mostrando la estructura interna del piso",ja:"3D",fr:"Gnrez un diagramme de coupe transversale 3D d'un btiment, montrant la structure interne du plancher"}},{id:"restoration",category:"creative",icon:"",withSelection:{en:"Restore and colorize this old photo, remove scratches, stains and fading, enhance details, add natural colors, maintain original composition and character features","zh-TW":"",es:"Restaura y colorea esta foto antigua, elimina rayones, manchas y decoloracin, mejora los detalles, agrega colores naturales, mantiene la composicin original y las caractersticas del personaje",ja:"",fr:"Restaurez et coloriez cette vieille photo, supprimez les rayures, les taches et la dcoloration, amliorez les dtails, ajoutez des couleurs naturelles, maintenez la composition originale et les caractristiques du personnage"},withoutSelection:{en:"Restore a 1950s black and white family photo, add colors","zh-TW":"1950",es:"Restaura una foto familiar en blanco y negro de los aos 1950, agrega colores",ja:"1950",fr:"Restaurez une photo de famille en noir et blanc des annes 1950, ajoutez des couleurs"}},{id:"idPhoto",category:"professional",icon:"",withSelection:{en:"Transform the person into a professional ID photo: white background, formal attire, confident expression, ID photo format, professional studio lighting, maintain person's facial features","zh-TW":"",es:"Transforma a la persona en una foto de identificacin profesional: fondo blanco, vestimenta formal, expresin confiada, formato de foto de identificacin, iluminacin de estudio profesional, mantn las caractersticas faciales de la persona",ja:"IDID",fr:"Transformez la personne en photo d'identit professionnelle : arrire-plan blanc, tenue formelle, expression confiante, format de photo d'identit, clairage de studio professionnel, maintenez les traits du visage de la personne"},withoutSelection:{en:"Generate professional business ID photo, white background, formal attire","zh-TW":"",es:"Genera una foto de identificacin comercial profesional, fondo blanco, vestimenta formal",ja:"ID",fr:"Gnrez une photo d'identit commerciale professionnelle, arrire-plan blanc, tenue formelle"}},{id:"product",category:"professional",icon:"",withSelection:{en:"Transform the product into professional e-commerce photography: pure white background, multi-angle display, professional lighting, showcase product details and texture","zh-TW":"",es:"Transforma el producto en fotografa profesional de comercio electrnico: fondo blanco puro, exhibicin en mltiples ngulos, iluminacin profesional, muestra los detalles y textura del producto",ja:"e",fr:"Transformez le produit en photographie professionnelle de commerce lectronique : arrire-plan blanc pur, affichage multi-angles, clairage professionnel, mettez en valeur les dtails et la texture du produit"},withoutSelection:{en:"Create professional product photography, suitable for e-commerce platforms","zh-TW":"",es:"Crea fotografa profesional de productos, adecuada para plataformas de comercio electrnico",ja:"e",fr:"Crez une photographie de produit professionnelle, adapte aux plateformes de commerce lectronique"}},{id:"interior",category:"professional",icon:"",withSelection:{en:"Redesign the space: add modern furniture, change wall colors, add decorations, professional interior design style","zh-TW":"",es:"Redisea el espacio: agrega muebles modernos, cambia los colores de las paredes, agrega decoraciones, estilo de diseo de interiores profesional",ja:"",fr:"Redessinez l'espace : ajoutez des meubles modernes, changez les couleurs des murs, ajoutez des dcorations, style de design d'intrieur professionnel"},withoutSelection:{en:"Design modern minimalist living room, including sofa, coffee table and decorations","zh-TW":"",es:"Disea una sala de estar minimalista moderna, incluyendo sof, mesa de caf y decoraciones",ja:"",fr:"Concevez un salon minimaliste moderne, comprenant un canap, une table basse et des dcorations"}},{id:"marketing",category:"professional",icon:"",withSelection:{en:"Create social media marketing material: add attractive background, text space, brand colors, suitable for Instagram posting","zh-TW":"Instagram",es:"Crea material de marketing para redes sociales: agrega fondo atractivo, espacio de texto, colores de marca, adecuado para publicar en Instagram",ja:"Instagram",fr:"Crez du matriel de marketing pour les mdias sociaux : ajoutez un arrire-plan attrayant, un espace de texte, des couleurs de marque, adapt  la publication Instagram"},withoutSelection:{en:"Design eye-catching social media advertising images","zh-TW":"",es:"Disea imgenes publicitarias llamativas para redes sociales",ja:"",fr:"Concevez des images publicitaires accrocheuses pour les mdias sociaux"}},{id:"tryOn",category:"fun",icon:"",withSelection:{en:"Dress the person from the first image in the clothing from the second image, keep the person's pose and background unchanged, clothing should fit naturally","zh-TW":"",es:"Viste a la persona de la primera imagen con la ropa de la segunda imagen, mantn la pose y el fondo de la persona sin cambios, la ropa debe quedar naturalmente",ja:"2",fr:"Habillez la personne de la premire image avec les vtements de la deuxime image, gardez la pose et l'arrire-plan de la personne inchangs, les vtements doivent s'ajuster naturellement"},withoutSelection:{en:"Show model trying on different style outfits","zh-TW":"",es:"Muestra un modelo probndose diferentes estilos de conjuntos",ja:"",fr:"Montrez un modle essayant diffrents styles de tenues"}},{id:"timeTravel",category:"fun",icon:"",withSelection:{en:"Place the person in different eras: 1920s vintage style, 1960s hippie style, 1980s disco, 2000s Y2K style, maintain person's features","zh-TW":"1920196019802000Y2K",es:"Coloca a la persona en diferentes pocas: estilo vintage de los aos 1920, estilo hippie de los aos 1960, disco de los aos 1980, estilo Y2K de los aos 2000, mantn las caractersticas de la persona",ja:"1920196019802000Y2K",fr:"Placez la personne dans diffrentes poques : style vintage des annes 1920, style hippie des annes 1960, disco des annes 1980, style Y2K des annes 2000, maintenez les caractristiques de la personne"},withoutSelection:{en:"Show the same character in different historical period styles","zh-TW":"",es:"Muestra el mismo personaje en estilos de diferentes perodos histricos",ja:"",fr:"Montrez le mme personnage dans des styles de diffrentes priodes historiques"}},{id:"petAdventure",category:"fun",icon:"",withSelection:{en:"Place the pet in adventure scenes: astronaut costume on the moon, pirate captain on a ship, superhero flying, knight armor in a castle","zh-TW":"",es:"Coloca a la mascota en escenas de aventura: disfraz de astronauta en la luna, capitn pirata en un barco, superhroe volando, armadura de caballero en un castillo",ja:"",fr:"Placez l'animal dans des scnes d'aventure : costume d'astronaute sur la lune, capitaine pirate sur un navire, super-hros volant, armure de chevalier dans un chteau"},withoutSelection:{en:"Create fantasy adventure scenes for pets","zh-TW":"",es:"Crea escenas de aventura fantstica para mascotas",ja:"",fr:"Crez des scnes d'aventure fantastique pour animaux de compagnie"}},{id:"ingredients",category:"fun",icon:"",withSelection:{en:"Break down the food into ingredients: each ingredient in separate bowls, label names and quantities, cooking tutorial style arrangement","zh-TW":"",es:"Descompn la comida en ingredientes: cada ingrediente en tazones separados, etiqueta nombres y cantidades, disposicin estilo tutorial de cocina",ja:"",fr:"Dcomposez la nourriture en ingrdients : chaque ingrdient dans des bols spars, tiquetez les noms et les quantits, arrangement de style tutoriel de cuisine"},withoutSelection:{en:"Display all ingredients and seasonings for a dish","zh-TW":"",es:"Muestra todos los ingredientes y condimentos para un plato",ja:"",fr:"Affichez tous les ingrdients et assaisonnements pour un plat"}}];function up(t,e,n){const c=dh.find(y=>y.id===t);if(!c)return"";const m=e?c.withSelection:c.withoutSelection;return m[n]||m.en}const hp=()=>{var Q,z,F,V,q;const t=cp(),{currentLanguage:e}=fh(),{isConfigured:n}=jn(),{getSelectedImages:c}=To(),{importImage:m,getSelectedImages:y,calculateSmartLayout:w}=yr(),[h,s]=he.useState(!1),[u,f]=he.useState(""),[r,a]=he.useState("storyshop"),[i,l]=he.useState(null),[d,o]=he.useState(null),[g,p]=he.useState(null),[v,x]=he.useState(""),[S,C]=he.useState([]),[T,O]=he.useState("comic"),[N,U]=he.useState(null),[J,te]=he.useState("all"),[se,ne]=he.useState([]),[re,ae]=he.useState(""),[le,G]=he.useState(null),_=y(),D=c(),P=_.length>0?_.map(A=>({url:A})):D;P.length>=2;const j=P.length>0;P.length>1;const X={generate:{maxImages:10,message:"Generate supports any number of reference images or none for fresh creation",canUse:!0},style:{maxImages:1,message:"Style transfer requires exactly 1 image",canUse:P.length===1},merge:{maxImages:10,message:"Merge requires 2+ images",canUse:P.length>=2},storyshop:{maxImages:2,message:"Story can use up to 2 images (character + product)",canUse:P.length<=2}},M=async()=>{if(u.trim()){console.log(" Starting generation process..."),console.log(" State check:",{activeTab:r,hasSelection:j,selectedImagesCount:P.length,canvasSelectedImages:y(),imageStoreImages:c(),selectedImages:P.map(A=>({url:A.url.substring(0,50)+"..."}))}),s(!0);try{let A;if(r==="generate")if(j&&P.length>0){console.log(" Using Image-to-Image mode!");const W=P.map(K=>K.url);P.length===1?(console.log(" Single image generation with:",W[0].substring(0,50)+"..."),A=await Ue.imageToImage({prompt:u,imageUrl:W[0],width:512,height:512,strength:.7})):(console.log(" Multi-image merge with",P.length,"images"),A=await Ue.imageToImage({prompt:`Merge these ${P.length} images: ${u}`,imageUrl:W[0],width:512,height:512,strength:.5})),console.log(` Generated ${P.length===1?"image-to-image":"merged"} result based on selection`)}else console.log(" Using Text-to-Image mode (no images selected)"),A=await Ue.generateImage({prompt:u,width:512,height:512}),console.log(" Generated image from text prompt:",A);else A=await Ue.generateImage({prompt:u,width:512,height:512}),console.log("Generated image from text prompt in",r,"tab:",A);await m(typeof A=="string"?A:A.url),l(typeof A=="string"?A:A.url),f("")}catch(A){console.error("Image generation failed:",A),alert("Image generation failed: "+A)}finally{s(!1)}}},k=(A,W)=>{const K=new FileReader;K.onload=Z=>{var B;const Y=(B=Z.target)==null?void 0:B.result;A==="character"?o(Y):p(Y)},K.readAsDataURL(W)},L=A=>{const W=y();if(console.log(` Using ${A} from canvas, selected:`,W.length,"images"),W.length===0){alert(t.aiPanel.storyMaker.errors.characterRequired);return}const K=W[0];A==="character"?(o(K),console.log(" Character image set from canvas")):(p(K),console.log(" Product image set from canvas"))},R=async()=>{if(!v.trim()){alert(t.aiPanel.storyMaker.errors.noStory);return}s(!0);try{console.log(" Starting Story Maker comic generation..."),console.log(" Story:",v),console.log(" Style:",T),console.log(" Character:",d?"Selected":"None"),console.log(" Product:",g?"Selected":"None");const A=[],W=["Setup - Introduction and beginning of the story","Development - Story unfolds and builds tension","Climax - The key moment or turning point","Resolution - Conclusion and ending"];for(let Y=0;Y<4;Y++){console.log(` Generating panel ${Y+1}/4: ${W[Y]}`);let B=`Create a ${T} style comic panel for panel ${Y+1}/4.

STORY CONTEXT: ${v}
PANEL STAGE: ${W[Y]}

VISUAL REQUIREMENTS:
- High-quality ${T} art style
- Consistent character appearance throughout the story
- CONSISTENT SCENE/LOCATION: All panels should take place in the same general setting/environment (can use different camera angles/perspectives but must be recognizably the same location)
- Clear comic panel composition with good visual flow
- Professional comic book quality artwork
- Maintain environmental coherence across all panels`;d&&(B+=`
- IMPORTANT: Use the provided character image as reference to maintain character consistency
- Keep the same person's appearance, facial features, and clothing style throughout`),g&&(B+=`
- IMPORTANT: Naturally integrate the provided product into the scene
- Product should appear contextually appropriate within the story
- Maintain product's visual characteristics and branding`),B+=`

Generate panel ${Y+1}: ${W[Y]} of the story "${v}"`;let ie;if(d&&g){console.log(" Merging character and product for comprehensive reference");const ce=await Ue.imageToImage({prompt:"Composite reference image combining the main character and the featured product. Keep both elements clearly visible.",imageUrl:d,width:512,height:512,strength:.5}).then(ue=>ue.url);console.log(" Using merged reference for image-to-image generation"),ie=await Ue.imageToImage({prompt:B,imageUrl:ce,width:512,height:512,strength:.5})}else d?(console.log(" Using character reference for image-to-image generation"),ie=await Ue.imageToImage({prompt:B,imageUrl:d,width:512,height:512,strength:.6})):g?(console.log(" Using product reference for image-to-image generation"),ie=await Ue.imageToImage({prompt:B,imageUrl:g,width:512,height:512,strength:.5})):(console.log(" Using text-to-image generation"),ie=await Ue.generateImage({prompt:B,width:512,height:512}));A.push(ie.url),console.log(` Panel ${Y+1} generated successfully`)}C(A),console.log(" Adding panels to canvas with smart layout...");const K={width:300,height:300},Z=w(A.length,K);for(let Y=0;Y<A.length;Y++){const B=Z[Y]||{x:100+Y*150,y:100};await m(A[Y],B),console.log(` Panel ${Y+1} positioned at:`,B)}console.log(" 4-panel comic generated successfully with character consistency!")}catch(A){console.error(" Comic generation failed:",A),alert("Comic generation failed. Please try again!")}finally{s(!1)}},$=async()=>{if(!re.trim()){alert("Please enter edit instructions!");return}if(S.length===0){alert("Generate a comic first!");return}s(!0);try{console.log(" Editing all panels with:",re);const A=[],W=["Setup - Introduction and beginning of the story","Development - Story unfolds and builds tension","Climax - The key moment or turning point","Resolution - Conclusion and ending"];for(let K=0;K<S.length;K++){console.log(` Editing panel ${K+1}/4`);let Z=`Edit this ${T} style comic panel for panel ${K+1}/4.

ORIGINAL STORY: ${v}
PANEL STAGE: ${W[K]}
EDIT INSTRUCTIONS: ${re}

Apply the edit instructions while maintaining:
- The same ${T} art style
- Character consistency throughout the story
- The panel's role in the story sequence`;d&&(Z+=`
- Character appearance from the reference image`),g&&(Z+=`
- Product integration naturally into the scene`);let Y;if(d&&g){console.log(" Merging character and product for edit reference");const ce=await Ue.imageToImage({prompt:"Composite reference image combining the main character and the featured product. Keep both elements clearly visible.",imageUrl:d,width:512,height:512,strength:.5}).then(ue=>ue.url);Y=await Ue.imageToImage({prompt:Z,imageUrl:ce,width:512,height:512,strength:.5})}else d?Y=await Ue.imageToImage({prompt:Z,imageUrl:d,width:512,height:512,strength:.7}):g?Y=await Ue.imageToImage({prompt:Z,imageUrl:g,width:512,height:512,strength:.5}):Y=await Ue.generateImage({prompt:Z,width:512,height:512});A.push(Y.url);const ie=w(A.length+1,{width:300,height:300})[K]||{x:100+K*150,y:100};await m(Y.url,ie),console.log(` Panel ${K+1} edited successfully`)}C(A),ae(""),console.log(" All panels edited successfully!")}catch(A){console.error(" Panel editing failed:",A),alert("Panel editing failed. Please try again!")}finally{s(!1)}},E=async A=>{s(!0);try{console.log(" Generating story idea for category:",A);const W={coffee:"A shy customer accidentally orders in a different language, leading to an unexpected friendship with the barista",shopping:"Someone finds the perfect vintage jacket, only to discover it belongs to their childhood friend working at the shop",friendship:"Two strangers get stuck in an elevator and end up planning their dream vacation together",adventure:"A person follows a mysterious cat through the city and discovers a hidden rooftop garden",surprise:"Someone orders takeout and finds a handwritten note that changes their entire day"};x(W[A]||W.coffee),console.log(" Story idea generated:",W[A])}catch(W){console.error(" Story idea generation failed:",W),alert("Story idea generation failed. Please try again!")}finally{s(!1)}},I=async()=>{const A=y();console.log(" Canvas selected images:",{count:A.length});let W=[];if(A.length>0)W=A,console.log(" Using",A.length,"selected images from canvas for video");else if(S.length>0)W=S,console.log(" Using",S.length,"generated comic panels for video");else{alert("Please select images on the canvas or generate a comic first!");return}s(!0);try{console.log(" Generating video from",W.length,"panels"),console.log(" Using Fal.ai to create animated story video...");const Z=(await Ue.generateVideo(v||"Create an animated story video",W[0],8)).url;console.log(" Video generated successfully!"),console.log(" Video URL:",Z),G(Z),alert(` Video generated successfully!
      
 Your 8-second video is ready!
 Use the "Watch Video" button below to view
 Generated: ${new Date().toLocaleString()}`)}catch(K){console.error(" Video generation failed:",K),alert(`Video generation failed: ${K}

Note: Make sure your Fal.ai API key is configured and has credits.`)}finally{s(!1)}},H=[{id:"storyshop",label:t.aiPanel.tabs.storyMaker,icon:Ds},{id:"generate",label:t.aiPanel.tabs.generate,icon:Pa}];return b.jsxs("div",{className:"flex h-full flex-col bg-gradient-to-br from-white to-purple-50",children:[b.jsxs("div",{className:"p-3 border-b border-gray-200 bg-white/90 backdrop-blur-sm flex-shrink-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("div",{className:"p-1.5 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg",children:b.jsx(ah,{className:"w-4 h-4 text-white"})}),b.jsx("h3",{className:"text-sm font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:"AI Assistant"})]}),b.jsx("div",{className:"flex items-center space-x-1",children:j&&b.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${(Q=X[r])!=null&&Q.canUse?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"}`,children:[" ",P.length," selected"]})})]}),b.jsx("div",{className:"flex mt-3 bg-gradient-to-r from-purple-100/50 to-pink-100/50 rounded-xl p-1 shadow-inner",children:H.map(A=>{const W=A.icon;return b.jsxs("button",{onClick:()=>a(A.id),className:`
                  flex-1 flex items-center justify-center space-x-1.5 py-2 px-3 rounded-lg text-xs font-medium transition-all duration-200
                  ${r===A.id?"bg-white text-purple-700 shadow-md scale-105 border border-purple-200":"text-gray-600 hover:text-purple-600 hover:bg-white/50"}
                `,children:[b.jsx(W,{className:"w-3 h-3"}),b.jsx("span",{children:A.label})]},A.id)})})]}),b.jsxs("div",{className:"p-4 flex-1 overflow-y-auto",children:[!n&&b.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:b.jsxs("div",{className:"flex items-start space-x-2",children:[b.jsx(bo,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),b.jsxs("div",{children:[b.jsx("p",{className:"text-sm font-medium text-amber-900 mb-1",children:"API Keys Required"}),b.jsx("p",{className:"text-xs text-amber-800",children:"Please configure your API keys in Settings to use AI features. You need at least a Fal.ai API key to get started."}),b.jsx("button",{onClick:()=>{const A=document.querySelector('[onclick*="setIsSettingsOpen"]');A==null||A.click()},className:"mt-2 text-xs px-3 py-1 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors",children:"Open Settings"})]})]})}),j&&b.jsxs("div",{className:`mb-3 p-2 rounded-lg border ${(z=X[r])!=null&&z.canUse?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200"}`,children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("span",{className:"text-xs font-medium text-gray-700",children:[" ",P.length," image",P.length!==1?"s":""," selected from canvas"]}),!((F=X[r])!=null&&F.canUse)&&b.jsxs("span",{className:"text-xs text-orange-600 font-medium",children:[" Invalid for ",r]})]}),b.jsx("p",{className:"text-xs text-gray-600 mt-1",children:(V=X[r])==null?void 0:V.message})]}),r!=="storyshop"&&b.jsxs("div",{className:"mb-3",children:[b.jsx("textarea",{value:u,onChange:A=>{f(A.target.value),U(null),ne([])},placeholder:t.aiPanel.generate.placeholder,className:"w-full h-20 p-2 text-sm border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:h}),j&&b.jsx("p",{className:"text-xs text-purple-600 mt-1",children:" Selected images will be automatically included in the AI request"})]}),r==="generate"&&b.jsxs("div",{className:"space-y-3",children:[b.jsx("p",{className:"text-xs text-gray-600",children:j?`Generate new images based on your ${P.length} selected image${P.length!==1?"s":""}`:"Generate images with Gemini 2.5 Flash (Nano Banana)"}),j&&b.jsxs("div",{className:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 mb-3",children:[b.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[b.jsx("span",{className:"text-sm font-bold text-blue-700",children:" Image-to-Image Mode"}),b.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-200 text-blue-800 rounded-full",children:"ACTIVE"})]}),b.jsxs("p",{className:"text-xs text-blue-700",children:["Your selected image",P.length!==1?"s":""," will be combined with your prompt/template to generate new images."]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("p",{className:"text-xs font-bold text-purple-700 flex items-center",children:[" ",t.aiPanel.generate.templates.title]}),j&&b.jsx("span",{className:"text-xs text-blue-600 font-medium",children:t.aiPanel.generate.templates.withSelection})]}),b.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap",children:[b.jsx("button",{onClick:()=>te("all"),className:`px-2 py-1 text-xs rounded-full transition-all ${J==="all"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.all}),b.jsx("button",{onClick:()=>te("creative"),className:`px-2 py-1 text-xs rounded-full transition-all ${J==="creative"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.creative}),b.jsx("button",{onClick:()=>te("professional"),className:`px-2 py-1 text-xs rounded-full transition-all ${J==="professional"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.professional}),b.jsx("button",{onClick:()=>te("fun"),className:`px-2 py-1 text-xs rounded-full transition-all ${J==="fun"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:t.aiPanel.generate.templates.categories.fun})]}),b.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-96 overflow-y-auto",children:dh.filter(A=>J==="all"||A.category===J).map(A=>{var W,K;return b.jsxs("button",{onClick:()=>{const Z=up(A.id,j,e);f(Z),U(A.id)},className:`p-2 rounded-lg border text-left transition-all ${N===A.id?"bg-gradient-to-r from-orange-100 to-yellow-100 border-orange-400 ring-1 ring-orange-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[b.jsx("div",{className:"text-lg mb-1",children:A.icon}),b.jsx("div",{className:"text-xs font-bold text-gray-800",children:(W=t.aiPanel.generate.templates.items[A.id])==null?void 0:W.title}),b.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:(K=t.aiPanel.generate.templates.items[A.id])==null?void 0:K.description})]},A.id)})}),N&&b.jsx("div",{className:"p-2 bg-purple-50 rounded-lg border border-purple-200",children:b.jsx("p",{className:"text-xs text-purple-700",children:t.aiPanel.generate.templates.applied})})]}),b.jsxs("div",{className:"mt-2 p-2 bg-purple-50 rounded-lg",children:[b.jsxs("p",{className:"text-xs font-medium text-purple-700 mb-1",children:[" ",t.aiPanel.generate.quickEnhancements]}),b.jsx("div",{className:"flex flex-wrap gap-1",children:t.aiPanel.generate.enhancementItems.map(A=>{const W=se.includes(A);return b.jsx("button",{onClick:()=>{const K=W?se.filter(B=>B!==A):[...se,A];ne(K);const Z=u.split(",").filter(B=>!t.aiPanel.generate.enhancementItems.includes(B.trim())).join(",").trim(),Y=Z+(K.length>0?(Z?", ":"")+K.join(", "):"");f(Y)},className:`text-xs px-2 py-1 rounded border transition-all ${W?"bg-purple-200 border-purple-500 text-purple-800 ring-1 ring-purple-400":"bg-white hover:bg-purple-100 border-purple-300 text-gray-700"}`,children:A},A)})})]}),b.jsx("button",{onClick:M,disabled:h||!u.trim()||!((q=X[r])!=null&&q.canUse),className:"w-full py-3 px-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 disabled:from-gray-300 disabled:to-gray-400 text-white text-sm rounded-xl transition-all flex items-center justify-center space-x-2 font-bold shadow-lg hover:shadow-xl transform hover:scale-105 disabled:scale-100",children:h?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),b.jsx("span",{children:j?`${t.aiPanel.generate.generating} (${P.length} ${t.aiPanel.generate.selectedImages})`:t.aiPanel.generate.generating})]}):b.jsxs(b.Fragment,{children:[b.jsx(Pa,{className:"w-4 h-4"}),b.jsx("span",{children:j?`${t.aiPanel.generate.generateButton} (${P.length} ${t.aiPanel.generate.selectedImages})`:t.aiPanel.generate.generateButton})]})})]}),!1,!1,r==="storyshop"&&b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"text-center p-5 bg-gradient-to-br from-indigo-500 via-purple-600 to-pink-500 rounded-2xl text-white shadow-xl",children:[b.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-3",children:[b.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm",children:b.jsx(Ds,{className:"w-6 h-6 text-white"})}),b.jsx("h4",{className:"text-lg font-black tracking-tight",children:t.aiPanel.storyMaker.title})]}),b.jsxs("p",{className:"text-sm font-semibold mb-3 leading-tight",children:[" ",t.aiPanel.storyMaker.description]}),b.jsxs("p",{className:"text-xs opacity-90 mb-4",children:["Perfect for ",b.jsx("strong",{children:"social media"}),", ",b.jsx("strong",{children:"marketing"}),", and ",b.jsx("strong",{children:"content creation"})]}),b.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[b.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-2 border border-white/20",children:[b.jsx("div",{className:"text-lg mb-1",children:""}),b.jsx("div",{className:"text-xs font-medium",children:"Instagram"}),b.jsx("div",{className:"text-xs opacity-75",children:"Ready"})]}),b.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-2 border border-white/20",children:[b.jsx("div",{className:"text-lg mb-1",children:""}),b.jsx("div",{className:"text-xs font-medium",children:"E-commerce"}),b.jsx("div",{className:"text-xs opacity-75",children:"Stories"})]}),b.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-lg p-2 border border-white/20",children:[b.jsx("div",{className:"text-lg mb-1",children:""}),b.jsx("div",{className:"text-xs font-medium",children:"Marketing"}),b.jsx("div",{className:"text-xs opacity-75",children:"Ads"})]})]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-purple-100 rounded-lg",children:b.jsx(Jd,{className:"w-4 h-4 text-purple-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.characterSection.title})]}),b.jsx("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.characterSection.required})]}),b.jsx("div",{className:"border-2 border-dashed border-purple-300 rounded-xl p-5 bg-gradient-to-br from-purple-50/50 to-pink-50/50 hover:from-purple-100/50 hover:to-pink-100/50 transition-all duration-300",children:d?b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:d,alt:"Character",className:"w-full h-20 object-cover rounded-lg shadow-md"}),b.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 rounded-lg transition-all duration-200",children:b.jsx("button",{onClick:()=>o(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white text-sm rounded-full flex items-center justify-center shadow-lg transition-colors",children:""})}),b.jsx("div",{className:"mt-2 text-center",children:b.jsxs("p",{className:"text-xs text-green-600 font-medium",children:[" ",t.aiPanel.storyMaker.characterSection.description]})})]}):b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"mb-3",children:[b.jsx("div",{className:"w-16 h-16 mx-auto bg-gradient-to-br from-purple-100 to-pink-100 rounded-xl flex items-center justify-center mb-2",children:b.jsx(gg,{className:"w-8 h-8 text-purple-500"})}),b.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-1",children:t.aiPanel.storyMaker.characterSection.title}),b.jsx("p",{className:"text-xs text-gray-500 mb-3",children:t.aiPanel.storyMaker.characterSection.description})]}),b.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[b.jsxs("button",{onClick:()=>L("character"),className:"py-2 px-4 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white text-xs rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg",children:[" ",t.aiPanel.storyMaker.useFromCanvas]}),b.jsxs("label",{className:"cursor-pointer",children:[b.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A=>{var W;return((W=A.target.files)==null?void 0:W[0])&&k("character",A.target.files[0])}}),b.jsxs("div",{className:"py-2 px-4 bg-white hover:bg-gray-50 text-gray-700 text-xs rounded-lg border border-gray-300 font-medium transition-all",children:[" ",t.aiPanel.storyMaker.uploadImage]})]})]})]})})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-orange-100 rounded-lg",children:b.jsx(Fl,{className:"w-4 h-4 text-orange-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.productSection.title})]}),b.jsx("span",{className:"text-xs bg-orange-100 text-orange-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.productSection.optional})]}),b.jsx("div",{className:"border-2 border-dashed border-orange-200 rounded-xl p-4 bg-gradient-to-br from-orange-50/50 to-yellow-50/50 hover:from-orange-100/50 hover:to-yellow-100/50 transition-all duration-300",children:g?b.jsxs("div",{className:"relative group",children:[b.jsx("img",{src:g,alt:"Product",className:"w-full h-16 object-cover rounded-lg shadow-md"}),b.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/20 rounded-lg transition-all duration-200",children:b.jsx("button",{onClick:()=>p(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white text-sm rounded-full flex items-center justify-center shadow-lg transition-colors",children:""})}),b.jsx("div",{className:"mt-2 text-center",children:b.jsxs("p",{className:"text-xs text-green-600 font-medium",children:[" ",t.aiPanel.storyMaker.productSection.description]})})]}):b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"w-12 h-12 mx-auto bg-gradient-to-br from-orange-100 to-yellow-100 rounded-lg flex items-center justify-center mb-2",children:b.jsx(Fl,{className:"w-6 h-6 text-orange-500"})}),b.jsx("p",{className:"text-xs font-semibold text-gray-700 mb-1",children:t.aiPanel.storyMaker.productSection.title}),b.jsx("p",{className:"text-xs text-gray-500 mb-2",children:t.aiPanel.storyMaker.productSection.description}),b.jsxs("div",{className:"grid grid-cols-1 gap-1",children:[b.jsxs("button",{onClick:()=>L("product"),className:"py-1.5 px-3 bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-orange-500 hover:to-yellow-500 text-white text-xs rounded-lg font-medium transition-all",children:[" ",t.aiPanel.storyMaker.useFromCanvas]}),b.jsxs("label",{className:"cursor-pointer",children:[b.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:A=>{var W;return((W=A.target.files)==null?void 0:W[0])&&k("product",A.target.files[0])}}),b.jsxs("div",{className:"py-1.5 px-3 bg-white hover:bg-gray-50 text-gray-600 text-xs rounded-lg border border-gray-200 font-medium transition-all",children:[" ",t.aiPanel.storyMaker.uploadImage]})]})]})]})})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-green-100 rounded-lg",children:b.jsx(fg,{className:"w-4 h-4 text-green-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.storySection.title})]}),b.jsx("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.characterSection.required})]}),b.jsxs("div",{className:"relative",children:[b.jsx("textarea",{value:v,onChange:A=>x(A.target.value),placeholder:t.aiPanel.storyMaker.placeholder,className:"w-full h-24 p-4 text-sm border-2 border-green-200 rounded-xl resize-none focus:ring-2 focus:ring-green-400 focus:border-green-400 bg-gradient-to-br from-green-50/30 to-emerald-50/30 placeholder-gray-500",disabled:h}),b.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-400",children:[v.length,"/200"]})]}),v.trim()&&b.jsx("div",{className:"p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:b.jsxs("p",{className:"text-xs text-green-700 font-medium flex items-center space-x-1",children:[b.jsx("span",{children:""}),b.jsx("span",{children:"Perfect! This will create 4 compelling panels telling your story."})]})}),b.jsxs("div",{className:"space-y-2",children:[b.jsx("p",{className:"text-xs font-medium text-gray-700",children:" Quick Story Ideas:"}),b.jsx("div",{className:"space-y-1",children:[{text:"A magical coffee shop encounter",category:"coffee"},{text:"Lost pet finds way home",category:"adventure"},{text:"Time traveler in modern world",category:"surprise"},{text:"Robot learns about friendship",category:"friendship"}].map((A,W)=>b.jsx("button",{onClick:()=>E(A.category),className:"w-full text-left text-xs p-2 bg-gray-50 hover:bg-purple-50 text-gray-600 hover:text-purple-600 rounded border transition-colors",children:A.text},W))})]})]}),b.jsxs("div",{className:"space-y-3",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-bold text-gray-800 flex items-center space-x-2",children:[b.jsx("div",{className:"p-1 bg-blue-100 rounded-lg",children:b.jsx(ag,{className:"w-4 h-4 text-blue-600"})}),b.jsx("span",{children:t.aiPanel.storyMaker.styleLabel})]}),b.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium",children:t.aiPanel.storyMaker.characterSection.optional})]}),b.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[{style:"comic",emoji:"",getDesc:()=>t.aiPanel.storyMaker.styles.comic},{style:"manga",emoji:"",getDesc:()=>t.aiPanel.storyMaker.styles.manga},{style:"watercolor",emoji:"",getDesc:()=>t.aiPanel.storyMaker.styles.watercolor},{style:"oil",emoji:"",getDesc:()=>t.aiPanel.storyMaker.styles.oil},{style:"sketch",emoji:"",getDesc:()=>t.aiPanel.storyMaker.styles.sketch}].map(({style:A,emoji:W,getDesc:K})=>b.jsxs("button",{onClick:()=>O(A),className:`p-3 rounded-xl transition-all duration-200 border-2 ${T===A?"bg-gradient-to-br from-blue-500 to-purple-600 text-white border-blue-400 shadow-lg transform scale-105":"bg-gradient-to-br from-gray-50 to-white text-gray-700 border-gray-200 hover:border-blue-300 hover:shadow-md hover:transform hover:scale-102"}`,children:[b.jsx("div",{className:"text-lg mb-1",children:W}),b.jsx("div",{className:"font-bold capitalize",children:K()}),b.jsx("div",{className:`text-xs opacity-75 ${T===A?"text-white":"text-gray-500"}`,children:A})]},A))})]}),b.jsxs("div",{className:"space-y-3 p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl border-2 border-dashed border-purple-200",children:[b.jsxs("div",{className:"text-center",children:[b.jsxs("div",{className:"inline-flex items-center space-x-2 text-sm font-bold text-gray-800 mb-2",children:[b.jsx("span",{className:"text-base",children:""}),b.jsx("span",{children:"Ready to Create Your Story?"})]}),b.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"AI will generate 4 cinematic panels with consistent character & product placement"})]}),b.jsx("button",{onClick:R,disabled:h||!v.trim(),className:"w-full py-4 px-6 bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 hover:from-purple-700 hover:via-pink-700 hover:to-red-600 disabled:from-gray-300 disabled:to-gray-400 text-white text-base rounded-2xl transition-all flex items-center justify-center space-x-3 font-black shadow-2xl hover:shadow-purple-500/25 transform hover:scale-105 disabled:scale-100 disabled:opacity-50",children:h?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),b.jsxs("span",{children:[" ",t.aiPanel.storyMaker.generatingPanels]})]}):b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"flex items-center space-x-2 bg-white/20 rounded-lg px-3 py-1",children:[b.jsx(Ds,{className:"w-5 h-5"}),b.jsx("span",{className:"font-bold",children:"4 PANELS"})]}),b.jsxs("span",{children:[" ",t.aiPanel.storyMaker.generateButton.toUpperCase()]}),b.jsxs("div",{className:"flex items-center space-x-1 bg-white/20 rounded-lg px-2 py-1",children:[b.jsx(Nl,{className:"w-4 h-4"}),b.jsx("span",{className:"text-xs font-medium",children:"+ Video"})]})]})})]}),S.length>0&&b.jsxs("div",{className:"text-center p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-300 shadow-sm",children:[b.jsxs("p",{className:"text-xs text-green-700 font-medium",children:[" Generated ",S.length,"/4 panels"]}),b.jsx("div",{className:"mt-1 text-xs text-green-600",children:" Story broken into: Setup  Development  Climax  Resolution"}),b.jsxs("div",{className:"mt-3 p-3 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-200 shadow-inner",children:[b.jsxs("p",{className:"text-xs font-bold text-blue-700 mb-2 flex items-center",children:[b.jsx("span",{className:"mr-1",children:""})," Quick Edit with Words"]}),b.jsx("input",{type:"text",value:re,onChange:A=>ae(A.target.value),placeholder:"Change time to snowy Christmas night, add falling snow...",className:"w-full text-xs p-2.5 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white/70",disabled:h}),b.jsx("div",{className:"grid grid-cols-1 gap-2 mt-3",children:b.jsx("button",{onClick:$,disabled:h||!re.trim(),className:"text-xs py-2 px-3 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 disabled:bg-gray-300 text-white rounded-lg transition-all font-medium shadow hover:shadow-md transform hover:scale-105 disabled:scale-100",children:h?" Editing All Panels...":" Edit All Panels"})})]}),b.jsxs("div",{className:"mt-2 space-y-1",children:[b.jsx("button",{onClick:I,disabled:h,className:"w-full py-2 px-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 disabled:bg-gray-300 text-white text-xs rounded-lg transition-all flex items-center justify-center space-x-1",children:h?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),b.jsx("span",{children:"Creating Video..."})]}):b.jsxs(b.Fragment,{children:[b.jsx(Nl,{className:"w-3 h-3"}),b.jsx("span",{children:" Make 8s Video"})]})}),le&&b.jsxs("button",{onClick:()=>{console.log(" Opening latest video:",le),window.open(le,"_blank")},className:"w-full py-2 px-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white text-xs rounded-lg transition-all flex items-center justify-center space-x-1",children:[b.jsx(ih,{className:"w-3 h-3"}),b.jsx("span",{children:" Watch Video"})]})]})]})]})]})]})},fp=({isOpen:t,setIsOpen:e})=>{const{apiKeys:n,setAPIKey:c,removeAPIKey:m,validateAPIKey:y,getObfuscatedKey:w,isConfigured:h}=jn(),[s,u]=he.useState({}),[f,r]=he.useState({}),[a,i]=he.useState({});he.useState("apikeys"),he.useEffect(()=>{u(n);const p={};Object.keys(n).forEach(v=>{p[v]="unchecked"}),i(p)},[n]);const l=(p,v)=>{u(x=>({...x,[p]:v})),i(x=>({...x,[p]:"unchecked"}))},d=async p=>{const v=s[p];if(!v){m(p),i(S=>({...S,[p]:"unchecked"}));return}await y(p,v)?(c(p,v),i(S=>({...S,[p]:"valid"}))):i(S=>({...S,[p]:"invalid"}))},o=p=>{r(v=>({...v,[p]:!v[p]}))},g=[{key:"openai",name:"OpenAI",placeholder:"sk-...",description:"For GPT models and DALL-E image generation",required:!1},{key:"anthropic",name:"Anthropic Claude",placeholder:"sk-ant-...",description:"For Claude AI models",required:!1},{key:"falai",name:"Fal.ai",placeholder:"Your Fal.ai API key",description:"For advanced image and video generation",required:!0},{key:"replicate",name:"Replicate",placeholder:"Your Replicate API token",description:"For open-source AI models",required:!1},{key:"stabilityai",name:"Stability AI",placeholder:"sk-...",description:"For Stable Diffusion models",required:!1}];return b.jsx(b.Fragment,{children:t&&b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>e(!1)}),b.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx(bo,{className:"w-5 h-5 text-blue-600"}),b.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"API Configuration"})]}),b.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-gray-600",children:b.jsx(Rl,{className:"w-5 h-5"})})]}),b.jsxs("div",{className:"space-y-4",children:[b.jsx("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:b.jsxs("div",{className:"flex items-start",children:[b.jsx(qd,{className:"w-5 h-5 text-amber-600 mr-2 flex-shrink-0 mt-0.5"}),b.jsxs("div",{children:[b.jsx("h3",{className:"text-sm font-medium text-amber-900 mb-1",children:"Important: Use Your Own API Keys"}),b.jsx("p",{className:"text-xs text-amber-800",children:"This application requires you to provide your own API keys. Your keys are stored locally in your browser and never sent to our servers. At minimum, you need a Fal.ai API key to use the core features."})]})]})}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("h3",{className:"text-sm font-semibold text-gray-900 flex items-center",children:[b.jsx(sg,{className:"w-4 h-4 mr-2"}),"API Keys Configuration"]}),g.map(p=>b.jsxs("div",{className:"space-y-2 p-4 bg-gray-50 rounded-lg",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[p.name,p.required&&b.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),a[p.key]==="valid"&&b.jsxs("span",{className:"text-xs text-green-600 flex items-center",children:[b.jsx(Zd,{className:"w-3 h-3 mr-1"})," Valid"]}),a[p.key]==="invalid"&&b.jsxs("span",{className:"text-xs text-red-600 flex items-center",children:[b.jsx(Rl,{className:"w-3 h-3 mr-1"})," Invalid"]})]}),b.jsx("p",{className:"text-xs text-gray-600",children:p.description}),b.jsxs("div",{className:"flex space-x-2",children:[b.jsxs("div",{className:"flex-1 relative",children:[b.jsx("input",{type:f[p.key]?"text":"password",value:s[p.key]||"",onChange:v=>l(p.key,v.target.value),placeholder:p.placeholder,className:"w-full text-sm border border-gray-300 rounded px-3 py-2 pr-10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),b.jsx("button",{type:"button",onClick:()=>o(p.key),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:f[p.key]?b.jsx(ng,{className:"w-4 h-4"}):b.jsx(rg,{className:"w-4 h-4"})})]}),b.jsx("button",{onClick:()=>d(p.key),className:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center",children:b.jsx(ug,{className:"w-4 h-4"})})]}),n[p.key]&&b.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Current: ",w(p.key)]})]},p.key))]}),b.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[b.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"Getting Started:"}),b.jsxs("ol",{className:"text-xs text-blue-800 space-y-1",children:[b.jsx("li",{children:"1. Get your API keys from the respective platforms"}),b.jsxs("li",{children:["2. ",b.jsx("strong",{children:"Required:"})," Sign up at ",b.jsx("a",{href:"https://fal.ai",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"fal.ai"})," for image generation"]}),b.jsxs("li",{children:["3. ",b.jsx("strong",{children:"Optional:"})," Add other API keys for enhanced features"]}),b.jsx("li",{children:"4. Save your keys and start creating!"})]})]}),b.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[b.jsxs("h3",{className:"text-sm font-medium text-green-900 mb-2 flex items-center",children:[b.jsx(hg,{className:"w-4 h-4 mr-2"}),"Security & Privacy"]}),b.jsxs("ul",{className:"text-xs text-green-800 space-y-1",children:[b.jsx("li",{children:" Your API keys are stored locally in your browser"}),b.jsx("li",{children:" Keys are never sent to our servers"}),b.jsx("li",{children:" You have full control over your API usage and costs"}),b.jsx("li",{children:" Keys are obfuscated in local storage"}),b.jsx("li",{children:" Clear your browser data to remove stored keys"})]})]}),b.jsx("div",{className:"flex justify-end space-x-2 pt-4",children:b.jsx("button",{onClick:()=>e(!1),className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:"Close"})})]})]})]})})};function dp(){const[t,e]=he.useState(!1),[n,c]=he.useState(!0);return he.useEffect(()=>{const m=setTimeout(()=>{window.dispatchEvent(new Event("resize"))},300);return()=>clearTimeout(m)},[n]),b.jsxs("div",{className:"h-screen w-screen flex flex-col bg-gray-100",children:[b.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 py-2 flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center space-x-4",children:[b.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"OmniCanvas"}),b.jsx("span",{className:"text-sm text-gray-500",children:"AI Creative Canvas"})]}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsxs("button",{onClick:()=>c(!n),className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:n?"Hide AI Assistant":"Show AI Assistant",children:[n?b.jsx(og,{className:"w-4 h-4"}):b.jsx(lg,{className:"w-4 h-4"}),b.jsx("span",{children:n?"Hide Panel":"Show Panel"})]}),b.jsxs("button",{onClick:()=>e(!0),className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[b.jsx(bo,{className:"w-4 h-4"}),b.jsx("span",{children:"Settings"})]})]})]}),b.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[b.jsx($g,{}),b.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:b.jsx(Vg,{})}),n&&b.jsx("div",{className:"w-80 lg:w-96 xl:w-[420px] bg-white border-l border-gray-200 flex flex-col overflow-hidden flex-shrink-0 transition-all duration-300 ease-in-out",children:b.jsx("div",{className:"flex-1 flex flex-col min-h-0 overflow-y-auto",children:b.jsx(hp,{})})})]}),b.jsx(fp,{isOpen:t,setIsOpen:e})]})}Ls.createRoot(document.getElementById("root")).render(b.jsx(tc.StrictMode,{children:b.jsx(dp,{})}));
