var Wh=Object.defineProperty;var Hh=(t,e,n)=>e in t?Wh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ft=(t,e,n)=>(Hh(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))c(p);new MutationObserver(p=>{for(const y of p)if(y.type==="childList")for(const w of y.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&c(w)}).observe(document,{childList:!0,subtree:!0});function n(p){const y={};return p.integrity&&(y.integrity=p.integrity),p.referrerPolicy&&(y.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?y.credentials="include":p.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function c(p){if(p.ep)return;p.ep=!0;const y=n(p);fetch(p.href,y)}})();function pc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Vh(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function c(){return this instanceof c?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(c){var p=Object.getOwnPropertyDescriptor(t,c);Object.defineProperty(n,c,p.get?p:{enumerable:!0,get:function(){return t[c]}})}),n}var vc={exports:{}},rs={},yc={exports:{}},me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xi=Symbol.for("react.element"),Xh=Symbol.for("react.portal"),Yh=Symbol.for("react.fragment"),$h=Symbol.for("react.strict_mode"),Kh=Symbol.for("react.profiler"),qh=Symbol.for("react.provider"),Qh=Symbol.for("react.context"),Jh=Symbol.for("react.forward_ref"),Zh=Symbol.for("react.suspense"),ed=Symbol.for("react.memo"),td=Symbol.for("react.lazy"),$o=Symbol.iterator;function nd(t){return t===null||typeof t!="object"?null:(t=$o&&t[$o]||t["@@iterator"],typeof t=="function"?t:null)}var xc={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},wc=Object.assign,Sc={};function ti(t,e,n){this.props=t,this.context=e,this.refs=Sc,this.updater=n||xc}ti.prototype.isReactComponent={};ti.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ti.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Cc(){}Cc.prototype=ti.prototype;function qa(t,e,n){this.props=t,this.context=e,this.refs=Sc,this.updater=n||xc}var Qa=qa.prototype=new Cc;Qa.constructor=qa;wc(Qa,ti.prototype);Qa.isPureReactComponent=!0;var Ko=Array.isArray,bc=Object.prototype.hasOwnProperty,Ja={current:null},_c={key:!0,ref:!0,__self:!0,__source:!0};function Tc(t,e,n){var c,p={},y=null,w=null;if(e!=null)for(c in e.ref!==void 0&&(w=e.ref),e.key!==void 0&&(y=""+e.key),e)bc.call(e,c)&&!_c.hasOwnProperty(c)&&(p[c]=e[c]);var d=arguments.length-2;if(d===1)p.children=n;else if(1<d){for(var s=Array(d),u=0;u<d;u++)s[u]=arguments[u+2];p.children=s}if(t&&t.defaultProps)for(c in d=t.defaultProps,d)p[c]===void 0&&(p[c]=d[c]);return{$$typeof:Xi,type:t,key:y,ref:w,props:p,_owner:Ja.current}}function id(t,e){return{$$typeof:Xi,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Za(t){return typeof t=="object"&&t!==null&&t.$$typeof===Xi}function rd(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var qo=/\/+/g;function _s(t,e){return typeof t=="object"&&t!==null&&t.key!=null?rd(""+t.key):e.toString(36)}function yr(t,e,n,c,p){var y=typeof t;(y==="undefined"||y==="boolean")&&(t=null);var w=!1;if(t===null)w=!0;else switch(y){case"string":case"number":w=!0;break;case"object":switch(t.$$typeof){case Xi:case Xh:w=!0}}if(w)return w=t,p=p(w),t=c===""?"."+_s(w,0):c,Ko(p)?(n="",t!=null&&(n=t.replace(qo,"$&/")+"/"),yr(p,e,n,"",function(u){return u})):p!=null&&(Za(p)&&(p=id(p,n+(!p.key||w&&w.key===p.key?"":(""+p.key).replace(qo,"$&/")+"/")+t)),e.push(p)),1;if(w=0,c=c===""?".":c+":",Ko(t))for(var d=0;d<t.length;d++){y=t[d];var s=c+_s(y,d);w+=yr(y,e,n,s,p)}else if(s=nd(t),typeof s=="function")for(t=s.call(t),d=0;!(y=t.next()).done;)y=y.value,s=c+_s(y,d++),w+=yr(y,e,n,s,p);else if(y==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return w}function er(t,e,n){if(t==null)return t;var c=[],p=0;return yr(t,c,"","",function(y){return e.call(n,y,p++)}),c}function sd(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var He={current:null},xr={transition:null},ad={ReactCurrentDispatcher:He,ReactCurrentBatchConfig:xr,ReactCurrentOwner:Ja};function kc(){throw Error("act(...) is not supported in production builds of React.")}me.Children={map:er,forEach:function(t,e,n){er(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return er(t,function(){e++}),e},toArray:function(t){return er(t,function(e){return e})||[]},only:function(t){if(!Za(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};me.Component=ti;me.Fragment=Yh;me.Profiler=Kh;me.PureComponent=qa;me.StrictMode=$h;me.Suspense=Zh;me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ad;me.act=kc;me.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var c=wc({},t.props),p=t.key,y=t.ref,w=t._owner;if(e!=null){if(e.ref!==void 0&&(y=e.ref,w=Ja.current),e.key!==void 0&&(p=""+e.key),t.type&&t.type.defaultProps)var d=t.type.defaultProps;for(s in e)bc.call(e,s)&&!_c.hasOwnProperty(s)&&(c[s]=e[s]===void 0&&d!==void 0?d[s]:e[s])}var s=arguments.length-2;if(s===1)c.children=n;else if(1<s){d=Array(s);for(var u=0;u<s;u++)d[u]=arguments[u+2];c.children=d}return{$$typeof:Xi,type:t.type,key:p,ref:y,props:c,_owner:w}};me.createContext=function(t){return t={$$typeof:Qh,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:qh,_context:t},t.Consumer=t};me.createElement=Tc;me.createFactory=function(t){var e=Tc.bind(null,t);return e.type=t,e};me.createRef=function(){return{current:null}};me.forwardRef=function(t){return{$$typeof:Jh,render:t}};me.isValidElement=Za;me.lazy=function(t){return{$$typeof:td,_payload:{_status:-1,_result:t},_init:sd}};me.memo=function(t,e){return{$$typeof:ed,type:t,compare:e===void 0?null:e}};me.startTransition=function(t){var e=xr.transition;xr.transition={};try{t()}finally{xr.transition=e}};me.unstable_act=kc;me.useCallback=function(t,e){return He.current.useCallback(t,e)};me.useContext=function(t){return He.current.useContext(t)};me.useDebugValue=function(){};me.useDeferredValue=function(t){return He.current.useDeferredValue(t)};me.useEffect=function(t,e){return He.current.useEffect(t,e)};me.useId=function(){return He.current.useId()};me.useImperativeHandle=function(t,e,n){return He.current.useImperativeHandle(t,e,n)};me.useInsertionEffect=function(t,e){return He.current.useInsertionEffect(t,e)};me.useLayoutEffect=function(t,e){return He.current.useLayoutEffect(t,e)};me.useMemo=function(t,e){return He.current.useMemo(t,e)};me.useReducer=function(t,e,n){return He.current.useReducer(t,e,n)};me.useRef=function(t){return He.current.useRef(t)};me.useState=function(t){return He.current.useState(t)};me.useSyncExternalStore=function(t,e,n){return He.current.useSyncExternalStore(t,e,n)};me.useTransition=function(){return He.current.useTransition()};me.version="18.3.1";yc.exports=me;var fe=yc.exports;const Pc=pc(fe);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var od=fe,ld=Symbol.for("react.element"),cd=Symbol.for("react.fragment"),ud=Object.prototype.hasOwnProperty,hd=od.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,dd={key:!0,ref:!0,__self:!0,__source:!0};function Ec(t,e,n){var c,p={},y=null,w=null;n!==void 0&&(y=""+n),e.key!==void 0&&(y=""+e.key),e.ref!==void 0&&(w=e.ref);for(c in e)ud.call(e,c)&&!dd.hasOwnProperty(c)&&(p[c]=e[c]);if(t&&t.defaultProps)for(c in e=t.defaultProps,e)p[c]===void 0&&(p[c]=e[c]);return{$$typeof:ld,type:t,key:y,ref:w,props:p,_owner:hd.current}}rs.Fragment=cd;rs.jsx=Ec;rs.jsxs=Ec;vc.exports=rs;var C=vc.exports,ea={},Oc={exports:{}},it={},Ic={exports:{}},jc={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Y,_){var O=Y.length;Y.push(_);e:for(;0<O;){var A=O-1>>>1,M=Y[A];if(0<p(M,_))Y[A]=_,Y[O]=M,O=A;else break e}}function n(Y){return Y.length===0?null:Y[0]}function c(Y){if(Y.length===0)return null;var _=Y[0],O=Y.pop();if(O!==_){Y[0]=O;e:for(var A=0,M=Y.length,B=M>>>1;A<B;){var P=2*(A+1)-1,k=Y[P],D=P+1,F=Y[D];if(0>p(k,O))D<M&&0>p(F,k)?(Y[A]=F,Y[D]=O,A=D):(Y[A]=k,Y[P]=O,A=P);else if(D<M&&0>p(F,O))Y[A]=F,Y[D]=O,A=D;else break e}}return _}function p(Y,_){var O=Y.sortIndex-_.sortIndex;return O!==0?O:Y.id-_.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;t.unstable_now=function(){return y.now()}}else{var w=Date,d=w.now();t.unstable_now=function(){return w.now()-d}}var s=[],u=[],h=1,r=null,a=3,i=!1,o=!1,f=!1,l=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(Y){for(var _=n(u);_!==null;){if(_.callback===null)c(u);else if(_.startTime<=Y)c(u),_.sortIndex=_.expirationTime,e(s,_);else break;_=n(u)}}function x(Y){if(f=!1,v(Y),!o)if(n(s)!==null)o=!0,ne(S);else{var _=n(u);_!==null&&le(x,_.startTime-Y)}}function S(Y,_){o=!1,f&&(f=!1,g(E),E=-1),i=!0;var O=a;try{for(v(_),r=n(s);r!==null&&(!(r.expirationTime>_)||Y&&!G());){var A=r.callback;if(typeof A=="function"){r.callback=null,a=r.priorityLevel;var M=A(r.expirationTime<=_);_=t.unstable_now(),typeof M=="function"?r.callback=M:r===n(s)&&c(s),v(_)}else c(s);r=n(s)}if(r!==null)var B=!0;else{var P=n(u);P!==null&&le(x,P.startTime-_),B=!1}return B}finally{r=null,a=O,i=!1}}var b=!1,T=null,E=-1,N=5,L=-1;function G(){return!(t.unstable_now()-L<N)}function Q(){if(T!==null){var Y=t.unstable_now();L=Y;var _=!0;try{_=T(!0,Y)}finally{_?Z():(b=!1,T=null)}}else b=!1}var Z;if(typeof m=="function")Z=function(){m(Q)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,K=te.port2;te.port1.onmessage=Q,Z=function(){K.postMessage(null)}}else Z=function(){l(Q,0)};function ne(Y){T=Y,b||(b=!0,Z())}function le(Y,_){E=l(function(){Y(t.unstable_now())},_)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Y){Y.callback=null},t.unstable_continueExecution=function(){o||i||(o=!0,ne(S))},t.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<Y?Math.floor(1e3/Y):5},t.unstable_getCurrentPriorityLevel=function(){return a},t.unstable_getFirstCallbackNode=function(){return n(s)},t.unstable_next=function(Y){switch(a){case 1:case 2:case 3:var _=3;break;default:_=a}var O=a;a=_;try{return Y()}finally{a=O}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Y,_){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var O=a;a=Y;try{return _()}finally{a=O}},t.unstable_scheduleCallback=function(Y,_,O){var A=t.unstable_now();switch(typeof O=="object"&&O!==null?(O=O.delay,O=typeof O=="number"&&0<O?A+O:A):O=A,Y){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=O+M,Y={id:h++,callback:_,priorityLevel:Y,startTime:O,expirationTime:M,sortIndex:-1},O>A?(Y.sortIndex=O,e(u,Y),n(s)===null&&Y===n(u)&&(f?(g(E),E=-1):f=!0,le(x,O-A))):(Y.sortIndex=M,e(s,Y),o||i||(o=!0,ne(S))),Y},t.unstable_shouldYield=G,t.unstable_wrapCallback=function(Y){var _=a;return function(){var O=a;a=_;try{return Y.apply(this,arguments)}finally{a=O}}}})(jc);Ic.exports=jc;var fd=Ic.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gd=fe,nt=fd;function re(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ac=new Set,Pi={};function Cn(t,e){Xn(t,e),Xn(t+"Capture",e)}function Xn(t,e){for(Pi[t]=e,t=0;t<e.length;t++)Ac.add(e[t])}var Mt=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ta=Object.prototype.hasOwnProperty,md=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qo={},Jo={};function pd(t){return ta.call(Jo,t)?!0:ta.call(Qo,t)?!1:md.test(t)?Jo[t]=!0:(Qo[t]=!0,!1)}function vd(t,e,n,c){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return c?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function yd(t,e,n,c){if(e===null||typeof e>"u"||vd(t,e,n,c))return!0;if(c)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ve(t,e,n,c,p,y,w){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=c,this.attributeNamespace=p,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=y,this.removeEmptyString=w}var Fe={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fe[t]=new Ve(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fe[e]=new Ve(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fe[t]=new Ve(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fe[t]=new Ve(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fe[t]=new Ve(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fe[t]=new Ve(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fe[t]=new Ve(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fe[t]=new Ve(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fe[t]=new Ve(t,5,!1,t.toLowerCase(),null,!1,!1)});var eo=/[\-:]([a-z])/g;function to(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(eo,to);Fe[e]=new Ve(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(eo,to);Fe[e]=new Ve(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(eo,to);Fe[e]=new Ve(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fe[t]=new Ve(t,1,!1,t.toLowerCase(),null,!1,!1)});Fe.xlinkHref=new Ve("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fe[t]=new Ve(t,1,!1,t.toLowerCase(),null,!0,!0)});function no(t,e,n,c){var p=Fe.hasOwnProperty(e)?Fe[e]:null;(p!==null?p.type!==0:c||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(yd(e,n,p,c)&&(n=null),c||p===null?pd(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):p.mustUseProperty?t[p.propertyName]=n===null?p.type===3?!1:"":n:(e=p.attributeName,c=p.attributeNamespace,n===null?t.removeAttribute(e):(p=p.type,n=p===3||p===4&&n===!0?"":""+n,c?t.setAttributeNS(c,e,n):t.setAttribute(e,n))))}var Ft=gd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,tr=Symbol.for("react.element"),Pn=Symbol.for("react.portal"),En=Symbol.for("react.fragment"),io=Symbol.for("react.strict_mode"),na=Symbol.for("react.profiler"),Mc=Symbol.for("react.provider"),Dc=Symbol.for("react.context"),ro=Symbol.for("react.forward_ref"),ia=Symbol.for("react.suspense"),ra=Symbol.for("react.suspense_list"),so=Symbol.for("react.memo"),Bt=Symbol.for("react.lazy"),Nc=Symbol.for("react.offscreen"),Zo=Symbol.iterator;function si(t){return t===null||typeof t!="object"?null:(t=Zo&&t[Zo]||t["@@iterator"],typeof t=="function"?t:null)}var ke=Object.assign,Ts;function fi(t){if(Ts===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Ts=e&&e[1]||""}return`
`+Ts+t}var ks=!1;function Ps(t,e){if(!t||ks)return"";ks=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var c=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){c=u}t.call(e.prototype)}else{try{throw Error()}catch(u){c=u}t()}}catch(u){if(u&&c&&typeof u.stack=="string"){for(var p=u.stack.split(`
`),y=c.stack.split(`
`),w=p.length-1,d=y.length-1;1<=w&&0<=d&&p[w]!==y[d];)d--;for(;1<=w&&0<=d;w--,d--)if(p[w]!==y[d]){if(w!==1||d!==1)do if(w--,d--,0>d||p[w]!==y[d]){var s=`
`+p[w].replace(" at new "," at ");return t.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",t.displayName)),s}while(1<=w&&0<=d);break}}}finally{ks=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?fi(t):""}function xd(t){switch(t.tag){case 5:return fi(t.type);case 16:return fi("Lazy");case 13:return fi("Suspense");case 19:return fi("SuspenseList");case 0:case 2:case 15:return t=Ps(t.type,!1),t;case 11:return t=Ps(t.type.render,!1),t;case 1:return t=Ps(t.type,!0),t;default:return""}}function sa(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case En:return"Fragment";case Pn:return"Portal";case na:return"Profiler";case io:return"StrictMode";case ia:return"Suspense";case ra:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Dc:return(t.displayName||"Context")+".Consumer";case Mc:return(t._context.displayName||"Context")+".Provider";case ro:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case so:return e=t.displayName||null,e!==null?e:sa(t.type)||"Memo";case Bt:e=t._payload,t=t._init;try{return sa(t(e))}catch{}}return null}function wd(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return sa(e);case 8:return e===io?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function tn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Lc(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Sd(t){var e=Lc(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),c=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var p=n.get,y=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return p.call(this)},set:function(w){c=""+w,y.call(this,w)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return c},setValue:function(w){c=""+w},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function nr(t){t._valueTracker||(t._valueTracker=Sd(t))}function Fc(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),c="";return t&&(c=Lc(t)?t.checked?"true":"false":t.value),t=c,t!==n?(e.setValue(t),!0):!1}function Ir(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function aa(t,e){var n=e.checked;return ke({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function el(t,e){var n=e.defaultValue==null?"":e.defaultValue,c=e.checked!=null?e.checked:e.defaultChecked;n=tn(e.value!=null?e.value:n),t._wrapperState={initialChecked:c,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Rc(t,e){e=e.checked,e!=null&&no(t,"checked",e,!1)}function oa(t,e){Rc(t,e);var n=tn(e.value),c=e.type;if(n!=null)c==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(c==="submit"||c==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?la(t,e.type,n):e.hasOwnProperty("defaultValue")&&la(t,e.type,tn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function tl(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var c=e.type;if(!(c!=="submit"&&c!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function la(t,e,n){(e!=="number"||Ir(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var gi=Array.isArray;function zn(t,e,n,c){if(t=t.options,e){e={};for(var p=0;p<n.length;p++)e["$"+n[p]]=!0;for(n=0;n<t.length;n++)p=e.hasOwnProperty("$"+t[n].value),t[n].selected!==p&&(t[n].selected=p),p&&c&&(t[n].defaultSelected=!0)}else{for(n=""+tn(n),e=null,p=0;p<t.length;p++){if(t[p].value===n){t[p].selected=!0,c&&(t[p].defaultSelected=!0);return}e!==null||t[p].disabled||(e=t[p])}e!==null&&(e.selected=!0)}}function ca(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(re(91));return ke({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function nl(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(re(92));if(gi(n)){if(1<n.length)throw Error(re(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:tn(n)}}function zc(t,e){var n=tn(e.value),c=tn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),c!=null&&(t.defaultValue=""+c)}function il(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Bc(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ua(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Bc(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ir,Uc=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,c,p){MSApp.execUnsafeLocalFunction(function(){return t(e,n,c,p)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ir=ir||document.createElement("div"),ir.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ir.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ei(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var vi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Cd=["Webkit","ms","Moz","O"];Object.keys(vi).forEach(function(t){Cd.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),vi[e]=vi[t]})});function Gc(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||vi.hasOwnProperty(t)&&vi[t]?(""+e).trim():e+"px"}function Wc(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var c=n.indexOf("--")===0,p=Gc(n,e[n],c);n==="float"&&(n="cssFloat"),c?t.setProperty(n,p):t[n]=p}}var bd=ke({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ha(t,e){if(e){if(bd[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(re(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(re(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(re(61))}if(e.style!=null&&typeof e.style!="object")throw Error(re(62))}}function da(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fa=null;function ao(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ga=null,Bn=null,Un=null;function rl(t){if(t=Ki(t)){if(typeof ga!="function")throw Error(re(280));var e=t.stateNode;e&&(e=cs(e),ga(t.stateNode,t.type,e))}}function Hc(t){Bn?Un?Un.push(t):Un=[t]:Bn=t}function Vc(){if(Bn){var t=Bn,e=Un;if(Un=Bn=null,rl(t),e)for(t=0;t<e.length;t++)rl(e[t])}}function Xc(t,e){return t(e)}function Yc(){}var Es=!1;function $c(t,e,n){if(Es)return t(e,n);Es=!0;try{return Xc(t,e,n)}finally{Es=!1,(Bn!==null||Un!==null)&&(Yc(),Vc())}}function Oi(t,e){var n=t.stateNode;if(n===null)return null;var c=cs(n);if(c===null)return null;n=c[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(t=t.type,c=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!c;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(re(231,e,typeof n));return n}var ma=!1;if(Mt)try{var ai={};Object.defineProperty(ai,"passive",{get:function(){ma=!0}}),window.addEventListener("test",ai,ai),window.removeEventListener("test",ai,ai)}catch{ma=!1}function _d(t,e,n,c,p,y,w,d,s){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var yi=!1,jr=null,Ar=!1,pa=null,Td={onError:function(t){yi=!0,jr=t}};function kd(t,e,n,c,p,y,w,d,s){yi=!1,jr=null,_d.apply(Td,arguments)}function Pd(t,e,n,c,p,y,w,d,s){if(kd.apply(this,arguments),yi){if(yi){var u=jr;yi=!1,jr=null}else throw Error(re(198));Ar||(Ar=!0,pa=u)}}function bn(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Kc(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function sl(t){if(bn(t)!==t)throw Error(re(188))}function Ed(t){var e=t.alternate;if(!e){if(e=bn(t),e===null)throw Error(re(188));return e!==t?null:t}for(var n=t,c=e;;){var p=n.return;if(p===null)break;var y=p.alternate;if(y===null){if(c=p.return,c!==null){n=c;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===n)return sl(p),t;if(y===c)return sl(p),e;y=y.sibling}throw Error(re(188))}if(n.return!==c.return)n=p,c=y;else{for(var w=!1,d=p.child;d;){if(d===n){w=!0,n=p,c=y;break}if(d===c){w=!0,c=p,n=y;break}d=d.sibling}if(!w){for(d=y.child;d;){if(d===n){w=!0,n=y,c=p;break}if(d===c){w=!0,c=y,n=p;break}d=d.sibling}if(!w)throw Error(re(189))}}if(n.alternate!==c)throw Error(re(190))}if(n.tag!==3)throw Error(re(188));return n.stateNode.current===n?t:e}function qc(t){return t=Ed(t),t!==null?Qc(t):null}function Qc(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Qc(t);if(e!==null)return e;t=t.sibling}return null}var Jc=nt.unstable_scheduleCallback,al=nt.unstable_cancelCallback,Od=nt.unstable_shouldYield,Id=nt.unstable_requestPaint,Ee=nt.unstable_now,jd=nt.unstable_getCurrentPriorityLevel,oo=nt.unstable_ImmediatePriority,Zc=nt.unstable_UserBlockingPriority,Mr=nt.unstable_NormalPriority,Ad=nt.unstable_LowPriority,eu=nt.unstable_IdlePriority,ss=null,_t=null;function Md(t){if(_t&&typeof _t.onCommitFiberRoot=="function")try{_t.onCommitFiberRoot(ss,t,void 0,(t.current.flags&128)===128)}catch{}}var yt=Math.clz32?Math.clz32:Ld,Dd=Math.log,Nd=Math.LN2;function Ld(t){return t>>>=0,t===0?32:31-(Dd(t)/Nd|0)|0}var rr=64,sr=4194304;function mi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Dr(t,e){var n=t.pendingLanes;if(n===0)return 0;var c=0,p=t.suspendedLanes,y=t.pingedLanes,w=n&268435455;if(w!==0){var d=w&~p;d!==0?c=mi(d):(y&=w,y!==0&&(c=mi(y)))}else w=n&~p,w!==0?c=mi(w):y!==0&&(c=mi(y));if(c===0)return 0;if(e!==0&&e!==c&&!(e&p)&&(p=c&-c,y=e&-e,p>=y||p===16&&(y&4194240)!==0))return e;if(c&4&&(c|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=c;0<e;)n=31-yt(e),p=1<<n,c|=t[n],e&=~p;return c}function Fd(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Rd(t,e){for(var n=t.suspendedLanes,c=t.pingedLanes,p=t.expirationTimes,y=t.pendingLanes;0<y;){var w=31-yt(y),d=1<<w,s=p[w];s===-1?(!(d&n)||d&c)&&(p[w]=Fd(d,e)):s<=e&&(t.expiredLanes|=d),y&=~d}}function va(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function tu(){var t=rr;return rr<<=1,!(rr&4194240)&&(rr=64),t}function Os(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Yi(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-yt(e),t[e]=n}function zd(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var c=t.eventTimes;for(t=t.expirationTimes;0<n;){var p=31-yt(n),y=1<<p;e[p]=0,c[p]=-1,t[p]=-1,n&=~y}}function lo(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var c=31-yt(n),p=1<<c;p&e|t[c]&e&&(t[c]|=e),n&=~p}}var ve=0;function nu(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var iu,co,ru,su,au,ya=!1,ar=[],Xt=null,Yt=null,$t=null,Ii=new Map,ji=new Map,Gt=[],Bd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ol(t,e){switch(t){case"focusin":case"focusout":Xt=null;break;case"dragenter":case"dragleave":Yt=null;break;case"mouseover":case"mouseout":$t=null;break;case"pointerover":case"pointerout":Ii.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ji.delete(e.pointerId)}}function oi(t,e,n,c,p,y){return t===null||t.nativeEvent!==y?(t={blockedOn:e,domEventName:n,eventSystemFlags:c,nativeEvent:y,targetContainers:[p]},e!==null&&(e=Ki(e),e!==null&&co(e)),t):(t.eventSystemFlags|=c,e=t.targetContainers,p!==null&&e.indexOf(p)===-1&&e.push(p),t)}function Ud(t,e,n,c,p){switch(e){case"focusin":return Xt=oi(Xt,t,e,n,c,p),!0;case"dragenter":return Yt=oi(Yt,t,e,n,c,p),!0;case"mouseover":return $t=oi($t,t,e,n,c,p),!0;case"pointerover":var y=p.pointerId;return Ii.set(y,oi(Ii.get(y)||null,t,e,n,c,p)),!0;case"gotpointercapture":return y=p.pointerId,ji.set(y,oi(ji.get(y)||null,t,e,n,c,p)),!0}return!1}function ou(t){var e=dn(t.target);if(e!==null){var n=bn(e);if(n!==null){if(e=n.tag,e===13){if(e=Kc(n),e!==null){t.blockedOn=e,au(t.priority,function(){ru(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function wr(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=xa(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var c=new n.constructor(n.type,n);fa=c,n.target.dispatchEvent(c),fa=null}else return e=Ki(n),e!==null&&co(e),t.blockedOn=n,!1;e.shift()}return!0}function ll(t,e,n){wr(t)&&n.delete(e)}function Gd(){ya=!1,Xt!==null&&wr(Xt)&&(Xt=null),Yt!==null&&wr(Yt)&&(Yt=null),$t!==null&&wr($t)&&($t=null),Ii.forEach(ll),ji.forEach(ll)}function li(t,e){t.blockedOn===e&&(t.blockedOn=null,ya||(ya=!0,nt.unstable_scheduleCallback(nt.unstable_NormalPriority,Gd)))}function Ai(t){function e(p){return li(p,t)}if(0<ar.length){li(ar[0],t);for(var n=1;n<ar.length;n++){var c=ar[n];c.blockedOn===t&&(c.blockedOn=null)}}for(Xt!==null&&li(Xt,t),Yt!==null&&li(Yt,t),$t!==null&&li($t,t),Ii.forEach(e),ji.forEach(e),n=0;n<Gt.length;n++)c=Gt[n],c.blockedOn===t&&(c.blockedOn=null);for(;0<Gt.length&&(n=Gt[0],n.blockedOn===null);)ou(n),n.blockedOn===null&&Gt.shift()}var Gn=Ft.ReactCurrentBatchConfig,Nr=!0;function Wd(t,e,n,c){var p=ve,y=Gn.transition;Gn.transition=null;try{ve=1,uo(t,e,n,c)}finally{ve=p,Gn.transition=y}}function Hd(t,e,n,c){var p=ve,y=Gn.transition;Gn.transition=null;try{ve=4,uo(t,e,n,c)}finally{ve=p,Gn.transition=y}}function uo(t,e,n,c){if(Nr){var p=xa(t,e,n,c);if(p===null)zs(t,e,c,Lr,n),ol(t,c);else if(Ud(p,t,e,n,c))c.stopPropagation();else if(ol(t,c),e&4&&-1<Bd.indexOf(t)){for(;p!==null;){var y=Ki(p);if(y!==null&&iu(y),y=xa(t,e,n,c),y===null&&zs(t,e,c,Lr,n),y===p)break;p=y}p!==null&&c.stopPropagation()}else zs(t,e,c,null,n)}}var Lr=null;function xa(t,e,n,c){if(Lr=null,t=ao(c),t=dn(t),t!==null)if(e=bn(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Kc(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Lr=t,null}function lu(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jd()){case oo:return 1;case Zc:return 4;case Mr:case Ad:return 16;case eu:return 536870912;default:return 16}default:return 16}}var Ht=null,ho=null,Sr=null;function cu(){if(Sr)return Sr;var t,e=ho,n=e.length,c,p="value"in Ht?Ht.value:Ht.textContent,y=p.length;for(t=0;t<n&&e[t]===p[t];t++);var w=n-t;for(c=1;c<=w&&e[n-c]===p[y-c];c++);return Sr=p.slice(t,1<c?1-c:void 0)}function Cr(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function or(){return!0}function cl(){return!1}function rt(t){function e(n,c,p,y,w){this._reactName=n,this._targetInst=p,this.type=c,this.nativeEvent=y,this.target=w,this.currentTarget=null;for(var d in t)t.hasOwnProperty(d)&&(n=t[d],this[d]=n?n(y):y[d]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?or:cl,this.isPropagationStopped=cl,this}return ke(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=or)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=or)},persist:function(){},isPersistent:or}),e}var ni={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fo=rt(ni),$i=ke({},ni,{view:0,detail:0}),Vd=rt($i),Is,js,ci,as=ke({},$i,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:go,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ci&&(ci&&t.type==="mousemove"?(Is=t.screenX-ci.screenX,js=t.screenY-ci.screenY):js=Is=0,ci=t),Is)},movementY:function(t){return"movementY"in t?t.movementY:js}}),ul=rt(as),Xd=ke({},as,{dataTransfer:0}),Yd=rt(Xd),$d=ke({},$i,{relatedTarget:0}),As=rt($d),Kd=ke({},ni,{animationName:0,elapsedTime:0,pseudoElement:0}),qd=rt(Kd),Qd=ke({},ni,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Jd=rt(Qd),Zd=ke({},ni,{data:0}),hl=rt(Zd),ef={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tf={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nf={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rf(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=nf[t])?!!e[t]:!1}function go(){return rf}var sf=ke({},$i,{key:function(t){if(t.key){var e=ef[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Cr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?tf[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:go,charCode:function(t){return t.type==="keypress"?Cr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Cr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),af=rt(sf),of=ke({},as,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dl=rt(of),lf=ke({},$i,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:go}),cf=rt(lf),uf=ke({},ni,{propertyName:0,elapsedTime:0,pseudoElement:0}),hf=rt(uf),df=ke({},as,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ff=rt(df),gf=[9,13,27,32],mo=Mt&&"CompositionEvent"in window,xi=null;Mt&&"documentMode"in document&&(xi=document.documentMode);var mf=Mt&&"TextEvent"in window&&!xi,uu=Mt&&(!mo||xi&&8<xi&&11>=xi),fl=String.fromCharCode(32),gl=!1;function hu(t,e){switch(t){case"keyup":return gf.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function du(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var On=!1;function pf(t,e){switch(t){case"compositionend":return du(e);case"keypress":return e.which!==32?null:(gl=!0,fl);case"textInput":return t=e.data,t===fl&&gl?null:t;default:return null}}function vf(t,e){if(On)return t==="compositionend"||!mo&&hu(t,e)?(t=cu(),Sr=ho=Ht=null,On=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uu&&e.locale!=="ko"?null:e.data;default:return null}}var yf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ml(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!yf[t.type]:e==="textarea"}function fu(t,e,n,c){Hc(c),e=Fr(e,"onChange"),0<e.length&&(n=new fo("onChange","change",null,n,c),t.push({event:n,listeners:e}))}var wi=null,Mi=null;function xf(t){_u(t,0)}function os(t){var e=An(t);if(Fc(e))return t}function wf(t,e){if(t==="change")return e}var gu=!1;if(Mt){var Ms;if(Mt){var Ds="oninput"in document;if(!Ds){var pl=document.createElement("div");pl.setAttribute("oninput","return;"),Ds=typeof pl.oninput=="function"}Ms=Ds}else Ms=!1;gu=Ms&&(!document.documentMode||9<document.documentMode)}function vl(){wi&&(wi.detachEvent("onpropertychange",mu),Mi=wi=null)}function mu(t){if(t.propertyName==="value"&&os(Mi)){var e=[];fu(e,Mi,t,ao(t)),$c(xf,e)}}function Sf(t,e,n){t==="focusin"?(vl(),wi=e,Mi=n,wi.attachEvent("onpropertychange",mu)):t==="focusout"&&vl()}function Cf(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return os(Mi)}function bf(t,e){if(t==="click")return os(e)}function _f(t,e){if(t==="input"||t==="change")return os(e)}function Tf(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var wt=typeof Object.is=="function"?Object.is:Tf;function Di(t,e){if(wt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),c=Object.keys(e);if(n.length!==c.length)return!1;for(c=0;c<n.length;c++){var p=n[c];if(!ta.call(e,p)||!wt(t[p],e[p]))return!1}return!0}function yl(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function xl(t,e){var n=yl(t);t=0;for(var c;n;){if(n.nodeType===3){if(c=t+n.textContent.length,t<=e&&c>=e)return{node:n,offset:e-t};t=c}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=yl(n)}}function pu(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pu(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function vu(){for(var t=window,e=Ir();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ir(t.document)}return e}function po(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function kf(t){var e=vu(),n=t.focusedElem,c=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&pu(n.ownerDocument.documentElement,n)){if(c!==null&&po(n)){if(e=c.start,t=c.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var p=n.textContent.length,y=Math.min(c.start,p);c=c.end===void 0?y:Math.min(c.end,p),!t.extend&&y>c&&(p=c,c=y,y=p),p=xl(n,y);var w=xl(n,c);p&&w&&(t.rangeCount!==1||t.anchorNode!==p.node||t.anchorOffset!==p.offset||t.focusNode!==w.node||t.focusOffset!==w.offset)&&(e=e.createRange(),e.setStart(p.node,p.offset),t.removeAllRanges(),y>c?(t.addRange(e),t.extend(w.node,w.offset)):(e.setEnd(w.node,w.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Pf=Mt&&"documentMode"in document&&11>=document.documentMode,In=null,wa=null,Si=null,Sa=!1;function wl(t,e,n){var c=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Sa||In==null||In!==Ir(c)||(c=In,"selectionStart"in c&&po(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),Si&&Di(Si,c)||(Si=c,c=Fr(wa,"onSelect"),0<c.length&&(e=new fo("onSelect","select",null,e,n),t.push({event:e,listeners:c}),e.target=In)))}function lr(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var jn={animationend:lr("Animation","AnimationEnd"),animationiteration:lr("Animation","AnimationIteration"),animationstart:lr("Animation","AnimationStart"),transitionend:lr("Transition","TransitionEnd")},Ns={},yu={};Mt&&(yu=document.createElement("div").style,"AnimationEvent"in window||(delete jn.animationend.animation,delete jn.animationiteration.animation,delete jn.animationstart.animation),"TransitionEvent"in window||delete jn.transitionend.transition);function ls(t){if(Ns[t])return Ns[t];if(!jn[t])return t;var e=jn[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in yu)return Ns[t]=e[n];return t}var xu=ls("animationend"),wu=ls("animationiteration"),Su=ls("animationstart"),Cu=ls("transitionend"),bu=new Map,Sl="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rn(t,e){bu.set(t,e),Cn(e,[t])}for(var Ls=0;Ls<Sl.length;Ls++){var Fs=Sl[Ls],Ef=Fs.toLowerCase(),Of=Fs[0].toUpperCase()+Fs.slice(1);rn(Ef,"on"+Of)}rn(xu,"onAnimationEnd");rn(wu,"onAnimationIteration");rn(Su,"onAnimationStart");rn("dblclick","onDoubleClick");rn("focusin","onFocus");rn("focusout","onBlur");rn(Cu,"onTransitionEnd");Xn("onMouseEnter",["mouseout","mouseover"]);Xn("onMouseLeave",["mouseout","mouseover"]);Xn("onPointerEnter",["pointerout","pointerover"]);Xn("onPointerLeave",["pointerout","pointerover"]);Cn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Cn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Cn("onBeforeInput",["compositionend","keypress","textInput","paste"]);Cn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Cn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Cn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pi="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),If=new Set("cancel close invalid load scroll toggle".split(" ").concat(pi));function Cl(t,e,n){var c=t.type||"unknown-event";t.currentTarget=n,Pd(c,e,void 0,t),t.currentTarget=null}function _u(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var c=t[n],p=c.event;c=c.listeners;e:{var y=void 0;if(e)for(var w=c.length-1;0<=w;w--){var d=c[w],s=d.instance,u=d.currentTarget;if(d=d.listener,s!==y&&p.isPropagationStopped())break e;Cl(p,d,u),y=s}else for(w=0;w<c.length;w++){if(d=c[w],s=d.instance,u=d.currentTarget,d=d.listener,s!==y&&p.isPropagationStopped())break e;Cl(p,d,u),y=s}}}if(Ar)throw t=pa,Ar=!1,pa=null,t}function xe(t,e){var n=e[ka];n===void 0&&(n=e[ka]=new Set);var c=t+"__bubble";n.has(c)||(Tu(e,t,2,!1),n.add(c))}function Rs(t,e,n){var c=0;e&&(c|=4),Tu(n,t,c,e)}var cr="_reactListening"+Math.random().toString(36).slice(2);function Ni(t){if(!t[cr]){t[cr]=!0,Ac.forEach(function(n){n!=="selectionchange"&&(If.has(n)||Rs(n,!1,t),Rs(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[cr]||(e[cr]=!0,Rs("selectionchange",!1,e))}}function Tu(t,e,n,c){switch(lu(e)){case 1:var p=Wd;break;case 4:p=Hd;break;default:p=uo}n=p.bind(null,e,n,t),p=void 0,!ma||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(p=!0),c?p!==void 0?t.addEventListener(e,n,{capture:!0,passive:p}):t.addEventListener(e,n,!0):p!==void 0?t.addEventListener(e,n,{passive:p}):t.addEventListener(e,n,!1)}function zs(t,e,n,c,p){var y=c;if(!(e&1)&&!(e&2)&&c!==null)e:for(;;){if(c===null)return;var w=c.tag;if(w===3||w===4){var d=c.stateNode.containerInfo;if(d===p||d.nodeType===8&&d.parentNode===p)break;if(w===4)for(w=c.return;w!==null;){var s=w.tag;if((s===3||s===4)&&(s=w.stateNode.containerInfo,s===p||s.nodeType===8&&s.parentNode===p))return;w=w.return}for(;d!==null;){if(w=dn(d),w===null)return;if(s=w.tag,s===5||s===6){c=y=w;continue e}d=d.parentNode}}c=c.return}$c(function(){var u=y,h=ao(n),r=[];e:{var a=bu.get(t);if(a!==void 0){var i=fo,o=t;switch(t){case"keypress":if(Cr(n)===0)break e;case"keydown":case"keyup":i=af;break;case"focusin":o="focus",i=As;break;case"focusout":o="blur",i=As;break;case"beforeblur":case"afterblur":i=As;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":i=ul;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":i=Yd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":i=cf;break;case xu:case wu:case Su:i=qd;break;case Cu:i=hf;break;case"scroll":i=Vd;break;case"wheel":i=ff;break;case"copy":case"cut":case"paste":i=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":i=dl}var f=(e&4)!==0,l=!f&&t==="scroll",g=f?a!==null?a+"Capture":null:a;f=[];for(var m=u,v;m!==null;){v=m;var x=v.stateNode;if(v.tag===5&&x!==null&&(v=x,g!==null&&(x=Oi(m,g),x!=null&&f.push(Li(m,x,v)))),l)break;m=m.return}0<f.length&&(a=new i(a,o,null,n,h),r.push({event:a,listeners:f}))}}if(!(e&7)){e:{if(a=t==="mouseover"||t==="pointerover",i=t==="mouseout"||t==="pointerout",a&&n!==fa&&(o=n.relatedTarget||n.fromElement)&&(dn(o)||o[Dt]))break e;if((i||a)&&(a=h.window===h?h:(a=h.ownerDocument)?a.defaultView||a.parentWindow:window,i?(o=n.relatedTarget||n.toElement,i=u,o=o?dn(o):null,o!==null&&(l=bn(o),o!==l||o.tag!==5&&o.tag!==6)&&(o=null)):(i=null,o=u),i!==o)){if(f=ul,x="onMouseLeave",g="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(f=dl,x="onPointerLeave",g="onPointerEnter",m="pointer"),l=i==null?a:An(i),v=o==null?a:An(o),a=new f(x,m+"leave",i,n,h),a.target=l,a.relatedTarget=v,x=null,dn(h)===u&&(f=new f(g,m+"enter",o,n,h),f.target=v,f.relatedTarget=l,x=f),l=x,i&&o)t:{for(f=i,g=o,m=0,v=f;v;v=Tn(v))m++;for(v=0,x=g;x;x=Tn(x))v++;for(;0<m-v;)f=Tn(f),m--;for(;0<v-m;)g=Tn(g),v--;for(;m--;){if(f===g||g!==null&&f===g.alternate)break t;f=Tn(f),g=Tn(g)}f=null}else f=null;i!==null&&bl(r,a,i,f,!1),o!==null&&l!==null&&bl(r,l,o,f,!0)}}e:{if(a=u?An(u):window,i=a.nodeName&&a.nodeName.toLowerCase(),i==="select"||i==="input"&&a.type==="file")var S=wf;else if(ml(a))if(gu)S=_f;else{S=Cf;var b=Sf}else(i=a.nodeName)&&i.toLowerCase()==="input"&&(a.type==="checkbox"||a.type==="radio")&&(S=bf);if(S&&(S=S(t,u))){fu(r,S,n,h);break e}b&&b(t,a,u),t==="focusout"&&(b=a._wrapperState)&&b.controlled&&a.type==="number"&&la(a,"number",a.value)}switch(b=u?An(u):window,t){case"focusin":(ml(b)||b.contentEditable==="true")&&(In=b,wa=u,Si=null);break;case"focusout":Si=wa=In=null;break;case"mousedown":Sa=!0;break;case"contextmenu":case"mouseup":case"dragend":Sa=!1,wl(r,n,h);break;case"selectionchange":if(Pf)break;case"keydown":case"keyup":wl(r,n,h)}var T;if(mo)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else On?hu(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(uu&&n.locale!=="ko"&&(On||E!=="onCompositionStart"?E==="onCompositionEnd"&&On&&(T=cu()):(Ht=h,ho="value"in Ht?Ht.value:Ht.textContent,On=!0)),b=Fr(u,E),0<b.length&&(E=new hl(E,t,null,n,h),r.push({event:E,listeners:b}),T?E.data=T:(T=du(n),T!==null&&(E.data=T)))),(T=mf?pf(t,n):vf(t,n))&&(u=Fr(u,"onBeforeInput"),0<u.length&&(h=new hl("onBeforeInput","beforeinput",null,n,h),r.push({event:h,listeners:u}),h.data=T))}_u(r,e)})}function Li(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fr(t,e){for(var n=e+"Capture",c=[];t!==null;){var p=t,y=p.stateNode;p.tag===5&&y!==null&&(p=y,y=Oi(t,n),y!=null&&c.unshift(Li(t,y,p)),y=Oi(t,e),y!=null&&c.push(Li(t,y,p))),t=t.return}return c}function Tn(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function bl(t,e,n,c,p){for(var y=e._reactName,w=[];n!==null&&n!==c;){var d=n,s=d.alternate,u=d.stateNode;if(s!==null&&s===c)break;d.tag===5&&u!==null&&(d=u,p?(s=Oi(n,y),s!=null&&w.unshift(Li(n,s,d))):p||(s=Oi(n,y),s!=null&&w.push(Li(n,s,d)))),n=n.return}w.length!==0&&t.push({event:e,listeners:w})}var jf=/\r\n?/g,Af=/\u0000|\uFFFD/g;function _l(t){return(typeof t=="string"?t:""+t).replace(jf,`
`).replace(Af,"")}function ur(t,e,n){if(e=_l(e),_l(t)!==e&&n)throw Error(re(425))}function Rr(){}var Ca=null,ba=null;function _a(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ta=typeof setTimeout=="function"?setTimeout:void 0,Mf=typeof clearTimeout=="function"?clearTimeout:void 0,Tl=typeof Promise=="function"?Promise:void 0,Df=typeof queueMicrotask=="function"?queueMicrotask:typeof Tl<"u"?function(t){return Tl.resolve(null).then(t).catch(Nf)}:Ta;function Nf(t){setTimeout(function(){throw t})}function Bs(t,e){var n=e,c=0;do{var p=n.nextSibling;if(t.removeChild(n),p&&p.nodeType===8)if(n=p.data,n==="/$"){if(c===0){t.removeChild(p),Ai(e);return}c--}else n!=="$"&&n!=="$?"&&n!=="$!"||c++;n=p}while(n);Ai(e)}function Kt(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function kl(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ii=Math.random().toString(36).slice(2),bt="__reactFiber$"+ii,Fi="__reactProps$"+ii,Dt="__reactContainer$"+ii,ka="__reactEvents$"+ii,Lf="__reactListeners$"+ii,Ff="__reactHandles$"+ii;function dn(t){var e=t[bt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Dt]||n[bt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=kl(t);t!==null;){if(n=t[bt])return n;t=kl(t)}return e}t=n,n=t.parentNode}return null}function Ki(t){return t=t[bt]||t[Dt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function An(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(re(33))}function cs(t){return t[Fi]||null}var Pa=[],Mn=-1;function sn(t){return{current:t}}function we(t){0>Mn||(t.current=Pa[Mn],Pa[Mn]=null,Mn--)}function ye(t,e){Mn++,Pa[Mn]=t.current,t.current=e}var nn={},Ue=sn(nn),qe=sn(!1),vn=nn;function Yn(t,e){var n=t.type.contextTypes;if(!n)return nn;var c=t.stateNode;if(c&&c.__reactInternalMemoizedUnmaskedChildContext===e)return c.__reactInternalMemoizedMaskedChildContext;var p={},y;for(y in n)p[y]=e[y];return c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=p),p}function Qe(t){return t=t.childContextTypes,t!=null}function zr(){we(qe),we(Ue)}function Pl(t,e,n){if(Ue.current!==nn)throw Error(re(168));ye(Ue,e),ye(qe,n)}function ku(t,e,n){var c=t.stateNode;if(e=e.childContextTypes,typeof c.getChildContext!="function")return n;c=c.getChildContext();for(var p in c)if(!(p in e))throw Error(re(108,wd(t)||"Unknown",p));return ke({},n,c)}function Br(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||nn,vn=Ue.current,ye(Ue,t),ye(qe,qe.current),!0}function El(t,e,n){var c=t.stateNode;if(!c)throw Error(re(169));n?(t=ku(t,e,vn),c.__reactInternalMemoizedMergedChildContext=t,we(qe),we(Ue),ye(Ue,t)):we(qe),ye(qe,n)}var Ot=null,us=!1,Us=!1;function Pu(t){Ot===null?Ot=[t]:Ot.push(t)}function Rf(t){us=!0,Pu(t)}function an(){if(!Us&&Ot!==null){Us=!0;var t=0,e=ve;try{var n=Ot;for(ve=1;t<n.length;t++){var c=n[t];do c=c(!0);while(c!==null)}Ot=null,us=!1}catch(p){throw Ot!==null&&(Ot=Ot.slice(t+1)),Jc(oo,an),p}finally{ve=e,Us=!1}}return null}var Dn=[],Nn=0,Ur=null,Gr=0,at=[],ot=0,yn=null,It=1,jt="";function ln(t,e){Dn[Nn++]=Gr,Dn[Nn++]=Ur,Ur=t,Gr=e}function Eu(t,e,n){at[ot++]=It,at[ot++]=jt,at[ot++]=yn,yn=t;var c=It;t=jt;var p=32-yt(c)-1;c&=~(1<<p),n+=1;var y=32-yt(e)+p;if(30<y){var w=p-p%5;y=(c&(1<<w)-1).toString(32),c>>=w,p-=w,It=1<<32-yt(e)+p|n<<p|c,jt=y+t}else It=1<<y|n<<p|c,jt=t}function vo(t){t.return!==null&&(ln(t,1),Eu(t,1,0))}function yo(t){for(;t===Ur;)Ur=Dn[--Nn],Dn[Nn]=null,Gr=Dn[--Nn],Dn[Nn]=null;for(;t===yn;)yn=at[--ot],at[ot]=null,jt=at[--ot],at[ot]=null,It=at[--ot],at[ot]=null}var tt=null,et=null,be=!1,vt=null;function Ou(t,e){var n=lt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Ol(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,tt=t,et=Kt(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,tt=t,et=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=yn!==null?{id:It,overflow:jt}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=lt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,tt=t,et=null,!0):!1;default:return!1}}function Ea(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Oa(t){if(be){var e=et;if(e){var n=e;if(!Ol(t,e)){if(Ea(t))throw Error(re(418));e=Kt(n.nextSibling);var c=tt;e&&Ol(t,e)?Ou(c,n):(t.flags=t.flags&-4097|2,be=!1,tt=t)}}else{if(Ea(t))throw Error(re(418));t.flags=t.flags&-4097|2,be=!1,tt=t}}}function Il(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;tt=t}function hr(t){if(t!==tt)return!1;if(!be)return Il(t),be=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!_a(t.type,t.memoizedProps)),e&&(e=et)){if(Ea(t))throw Iu(),Error(re(418));for(;e;)Ou(t,e),e=Kt(e.nextSibling)}if(Il(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(re(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){et=Kt(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}et=null}}else et=tt?Kt(t.stateNode.nextSibling):null;return!0}function Iu(){for(var t=et;t;)t=Kt(t.nextSibling)}function $n(){et=tt=null,be=!1}function xo(t){vt===null?vt=[t]:vt.push(t)}var zf=Ft.ReactCurrentBatchConfig;function ui(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(re(309));var c=n.stateNode}if(!c)throw Error(re(147,t));var p=c,y=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===y?e.ref:(e=function(w){var d=p.refs;w===null?delete d[y]:d[y]=w},e._stringRef=y,e)}if(typeof t!="string")throw Error(re(284));if(!n._owner)throw Error(re(290,t))}return t}function dr(t,e){throw t=Object.prototype.toString.call(e),Error(re(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function jl(t){var e=t._init;return e(t._payload)}function ju(t){function e(g,m){if(t){var v=g.deletions;v===null?(g.deletions=[m],g.flags|=16):v.push(m)}}function n(g,m){if(!t)return null;for(;m!==null;)e(g,m),m=m.sibling;return null}function c(g,m){for(g=new Map;m!==null;)m.key!==null?g.set(m.key,m):g.set(m.index,m),m=m.sibling;return g}function p(g,m){return g=Zt(g,m),g.index=0,g.sibling=null,g}function y(g,m,v){return g.index=v,t?(v=g.alternate,v!==null?(v=v.index,v<m?(g.flags|=2,m):v):(g.flags|=2,m)):(g.flags|=1048576,m)}function w(g){return t&&g.alternate===null&&(g.flags|=2),g}function d(g,m,v,x){return m===null||m.tag!==6?(m=$s(v,g.mode,x),m.return=g,m):(m=p(m,v),m.return=g,m)}function s(g,m,v,x){var S=v.type;return S===En?h(g,m,v.props.children,x,v.key):m!==null&&(m.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Bt&&jl(S)===m.type)?(x=p(m,v.props),x.ref=ui(g,m,v),x.return=g,x):(x=Or(v.type,v.key,v.props,null,g.mode,x),x.ref=ui(g,m,v),x.return=g,x)}function u(g,m,v,x){return m===null||m.tag!==4||m.stateNode.containerInfo!==v.containerInfo||m.stateNode.implementation!==v.implementation?(m=Ks(v,g.mode,x),m.return=g,m):(m=p(m,v.children||[]),m.return=g,m)}function h(g,m,v,x,S){return m===null||m.tag!==7?(m=pn(v,g.mode,x,S),m.return=g,m):(m=p(m,v),m.return=g,m)}function r(g,m,v){if(typeof m=="string"&&m!==""||typeof m=="number")return m=$s(""+m,g.mode,v),m.return=g,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case tr:return v=Or(m.type,m.key,m.props,null,g.mode,v),v.ref=ui(g,null,m),v.return=g,v;case Pn:return m=Ks(m,g.mode,v),m.return=g,m;case Bt:var x=m._init;return r(g,x(m._payload),v)}if(gi(m)||si(m))return m=pn(m,g.mode,v,null),m.return=g,m;dr(g,m)}return null}function a(g,m,v,x){var S=m!==null?m.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return S!==null?null:d(g,m,""+v,x);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case tr:return v.key===S?s(g,m,v,x):null;case Pn:return v.key===S?u(g,m,v,x):null;case Bt:return S=v._init,a(g,m,S(v._payload),x)}if(gi(v)||si(v))return S!==null?null:h(g,m,v,x,null);dr(g,v)}return null}function i(g,m,v,x,S){if(typeof x=="string"&&x!==""||typeof x=="number")return g=g.get(v)||null,d(m,g,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case tr:return g=g.get(x.key===null?v:x.key)||null,s(m,g,x,S);case Pn:return g=g.get(x.key===null?v:x.key)||null,u(m,g,x,S);case Bt:var b=x._init;return i(g,m,v,b(x._payload),S)}if(gi(x)||si(x))return g=g.get(v)||null,h(m,g,x,S,null);dr(m,x)}return null}function o(g,m,v,x){for(var S=null,b=null,T=m,E=m=0,N=null;T!==null&&E<v.length;E++){T.index>E?(N=T,T=null):N=T.sibling;var L=a(g,T,v[E],x);if(L===null){T===null&&(T=N);break}t&&T&&L.alternate===null&&e(g,T),m=y(L,m,E),b===null?S=L:b.sibling=L,b=L,T=N}if(E===v.length)return n(g,T),be&&ln(g,E),S;if(T===null){for(;E<v.length;E++)T=r(g,v[E],x),T!==null&&(m=y(T,m,E),b===null?S=T:b.sibling=T,b=T);return be&&ln(g,E),S}for(T=c(g,T);E<v.length;E++)N=i(T,g,E,v[E],x),N!==null&&(t&&N.alternate!==null&&T.delete(N.key===null?E:N.key),m=y(N,m,E),b===null?S=N:b.sibling=N,b=N);return t&&T.forEach(function(G){return e(g,G)}),be&&ln(g,E),S}function f(g,m,v,x){var S=si(v);if(typeof S!="function")throw Error(re(150));if(v=S.call(v),v==null)throw Error(re(151));for(var b=S=null,T=m,E=m=0,N=null,L=v.next();T!==null&&!L.done;E++,L=v.next()){T.index>E?(N=T,T=null):N=T.sibling;var G=a(g,T,L.value,x);if(G===null){T===null&&(T=N);break}t&&T&&G.alternate===null&&e(g,T),m=y(G,m,E),b===null?S=G:b.sibling=G,b=G,T=N}if(L.done)return n(g,T),be&&ln(g,E),S;if(T===null){for(;!L.done;E++,L=v.next())L=r(g,L.value,x),L!==null&&(m=y(L,m,E),b===null?S=L:b.sibling=L,b=L);return be&&ln(g,E),S}for(T=c(g,T);!L.done;E++,L=v.next())L=i(T,g,E,L.value,x),L!==null&&(t&&L.alternate!==null&&T.delete(L.key===null?E:L.key),m=y(L,m,E),b===null?S=L:b.sibling=L,b=L);return t&&T.forEach(function(Q){return e(g,Q)}),be&&ln(g,E),S}function l(g,m,v,x){if(typeof v=="object"&&v!==null&&v.type===En&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case tr:e:{for(var S=v.key,b=m;b!==null;){if(b.key===S){if(S=v.type,S===En){if(b.tag===7){n(g,b.sibling),m=p(b,v.props.children),m.return=g,g=m;break e}}else if(b.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Bt&&jl(S)===b.type){n(g,b.sibling),m=p(b,v.props),m.ref=ui(g,b,v),m.return=g,g=m;break e}n(g,b);break}else e(g,b);b=b.sibling}v.type===En?(m=pn(v.props.children,g.mode,x,v.key),m.return=g,g=m):(x=Or(v.type,v.key,v.props,null,g.mode,x),x.ref=ui(g,m,v),x.return=g,g=x)}return w(g);case Pn:e:{for(b=v.key;m!==null;){if(m.key===b)if(m.tag===4&&m.stateNode.containerInfo===v.containerInfo&&m.stateNode.implementation===v.implementation){n(g,m.sibling),m=p(m,v.children||[]),m.return=g,g=m;break e}else{n(g,m);break}else e(g,m);m=m.sibling}m=Ks(v,g.mode,x),m.return=g,g=m}return w(g);case Bt:return b=v._init,l(g,m,b(v._payload),x)}if(gi(v))return o(g,m,v,x);if(si(v))return f(g,m,v,x);dr(g,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,m!==null&&m.tag===6?(n(g,m.sibling),m=p(m,v),m.return=g,g=m):(n(g,m),m=$s(v,g.mode,x),m.return=g,g=m),w(g)):n(g,m)}return l}var Kn=ju(!0),Au=ju(!1),Wr=sn(null),Hr=null,Ln=null,wo=null;function So(){wo=Ln=Hr=null}function Co(t){var e=Wr.current;we(Wr),t._currentValue=e}function Ia(t,e,n){for(;t!==null;){var c=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,c!==null&&(c.childLanes|=e)):c!==null&&(c.childLanes&e)!==e&&(c.childLanes|=e),t===n)break;t=t.return}}function Wn(t,e){Hr=t,wo=Ln=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ke=!0),t.firstContext=null)}function ut(t){var e=t._currentValue;if(wo!==t)if(t={context:t,memoizedValue:e,next:null},Ln===null){if(Hr===null)throw Error(re(308));Ln=t,Hr.dependencies={lanes:0,firstContext:t}}else Ln=Ln.next=t;return e}var fn=null;function bo(t){fn===null?fn=[t]:fn.push(t)}function Mu(t,e,n,c){var p=e.interleaved;return p===null?(n.next=n,bo(e)):(n.next=p.next,p.next=n),e.interleaved=n,Nt(t,c)}function Nt(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ut=!1;function _o(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Du(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function At(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function qt(t,e,n){var c=t.updateQueue;if(c===null)return null;if(c=c.shared,pe&2){var p=c.pending;return p===null?e.next=e:(e.next=p.next,p.next=e),c.pending=e,Nt(t,n)}return p=c.interleaved,p===null?(e.next=e,bo(c)):(e.next=p.next,p.next=e),c.interleaved=e,Nt(t,n)}function br(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,lo(t,n)}}function Al(t,e){var n=t.updateQueue,c=t.alternate;if(c!==null&&(c=c.updateQueue,n===c)){var p=null,y=null;if(n=n.firstBaseUpdate,n!==null){do{var w={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};y===null?p=y=w:y=y.next=w,n=n.next}while(n!==null);y===null?p=y=e:y=y.next=e}else p=y=e;n={baseState:c.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:c.shared,effects:c.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Vr(t,e,n,c){var p=t.updateQueue;Ut=!1;var y=p.firstBaseUpdate,w=p.lastBaseUpdate,d=p.shared.pending;if(d!==null){p.shared.pending=null;var s=d,u=s.next;s.next=null,w===null?y=u:w.next=u,w=s;var h=t.alternate;h!==null&&(h=h.updateQueue,d=h.lastBaseUpdate,d!==w&&(d===null?h.firstBaseUpdate=u:d.next=u,h.lastBaseUpdate=s))}if(y!==null){var r=p.baseState;w=0,h=u=s=null,d=y;do{var a=d.lane,i=d.eventTime;if((c&a)===a){h!==null&&(h=h.next={eventTime:i,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var o=t,f=d;switch(a=e,i=n,f.tag){case 1:if(o=f.payload,typeof o=="function"){r=o.call(i,r,a);break e}r=o;break e;case 3:o.flags=o.flags&-65537|128;case 0:if(o=f.payload,a=typeof o=="function"?o.call(i,r,a):o,a==null)break e;r=ke({},r,a);break e;case 2:Ut=!0}}d.callback!==null&&d.lane!==0&&(t.flags|=64,a=p.effects,a===null?p.effects=[d]:a.push(d))}else i={eventTime:i,lane:a,tag:d.tag,payload:d.payload,callback:d.callback,next:null},h===null?(u=h=i,s=r):h=h.next=i,w|=a;if(d=d.next,d===null){if(d=p.shared.pending,d===null)break;a=d,d=a.next,a.next=null,p.lastBaseUpdate=a,p.shared.pending=null}}while(1);if(h===null&&(s=r),p.baseState=s,p.firstBaseUpdate=u,p.lastBaseUpdate=h,e=p.shared.interleaved,e!==null){p=e;do w|=p.lane,p=p.next;while(p!==e)}else y===null&&(p.shared.lanes=0);wn|=w,t.lanes=w,t.memoizedState=r}}function Ml(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var c=t[e],p=c.callback;if(p!==null){if(c.callback=null,c=n,typeof p!="function")throw Error(re(191,p));p.call(c)}}}var qi={},Tt=sn(qi),Ri=sn(qi),zi=sn(qi);function gn(t){if(t===qi)throw Error(re(174));return t}function To(t,e){switch(ye(zi,e),ye(Ri,t),ye(Tt,qi),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ua(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ua(e,t)}we(Tt),ye(Tt,e)}function qn(){we(Tt),we(Ri),we(zi)}function Nu(t){gn(zi.current);var e=gn(Tt.current),n=ua(e,t.type);e!==n&&(ye(Ri,t),ye(Tt,n))}function ko(t){Ri.current===t&&(we(Tt),we(Ri))}var _e=sn(0);function Xr(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Gs=[];function Po(){for(var t=0;t<Gs.length;t++)Gs[t]._workInProgressVersionPrimary=null;Gs.length=0}var _r=Ft.ReactCurrentDispatcher,Ws=Ft.ReactCurrentBatchConfig,xn=0,Te=null,Ie=null,Me=null,Yr=!1,Ci=!1,Bi=0,Bf=0;function Re(){throw Error(re(321))}function Eo(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!wt(t[n],e[n]))return!1;return!0}function Oo(t,e,n,c,p,y){if(xn=y,Te=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,_r.current=t===null||t.memoizedState===null?Hf:Vf,t=n(c,p),Ci){y=0;do{if(Ci=!1,Bi=0,25<=y)throw Error(re(301));y+=1,Me=Ie=null,e.updateQueue=null,_r.current=Xf,t=n(c,p)}while(Ci)}if(_r.current=$r,e=Ie!==null&&Ie.next!==null,xn=0,Me=Ie=Te=null,Yr=!1,e)throw Error(re(300));return t}function Io(){var t=Bi!==0;return Bi=0,t}function Ct(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?Te.memoizedState=Me=t:Me=Me.next=t,Me}function ht(){if(Ie===null){var t=Te.alternate;t=t!==null?t.memoizedState:null}else t=Ie.next;var e=Me===null?Te.memoizedState:Me.next;if(e!==null)Me=e,Ie=t;else{if(t===null)throw Error(re(310));Ie=t,t={memoizedState:Ie.memoizedState,baseState:Ie.baseState,baseQueue:Ie.baseQueue,queue:Ie.queue,next:null},Me===null?Te.memoizedState=Me=t:Me=Me.next=t}return Me}function Ui(t,e){return typeof e=="function"?e(t):e}function Hs(t){var e=ht(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var c=Ie,p=c.baseQueue,y=n.pending;if(y!==null){if(p!==null){var w=p.next;p.next=y.next,y.next=w}c.baseQueue=p=y,n.pending=null}if(p!==null){y=p.next,c=c.baseState;var d=w=null,s=null,u=y;do{var h=u.lane;if((xn&h)===h)s!==null&&(s=s.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),c=u.hasEagerState?u.eagerState:t(c,u.action);else{var r={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};s===null?(d=s=r,w=c):s=s.next=r,Te.lanes|=h,wn|=h}u=u.next}while(u!==null&&u!==y);s===null?w=c:s.next=d,wt(c,e.memoizedState)||(Ke=!0),e.memoizedState=c,e.baseState=w,e.baseQueue=s,n.lastRenderedState=c}if(t=n.interleaved,t!==null){p=t;do y=p.lane,Te.lanes|=y,wn|=y,p=p.next;while(p!==t)}else p===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Vs(t){var e=ht(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var c=n.dispatch,p=n.pending,y=e.memoizedState;if(p!==null){n.pending=null;var w=p=p.next;do y=t(y,w.action),w=w.next;while(w!==p);wt(y,e.memoizedState)||(Ke=!0),e.memoizedState=y,e.baseQueue===null&&(e.baseState=y),n.lastRenderedState=y}return[y,c]}function Lu(){}function Fu(t,e){var n=Te,c=ht(),p=e(),y=!wt(c.memoizedState,p);if(y&&(c.memoizedState=p,Ke=!0),c=c.queue,jo(Bu.bind(null,n,c,t),[t]),c.getSnapshot!==e||y||Me!==null&&Me.memoizedState.tag&1){if(n.flags|=2048,Gi(9,zu.bind(null,n,c,p,e),void 0,null),De===null)throw Error(re(349));xn&30||Ru(n,e,p)}return p}function Ru(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Te.updateQueue,e===null?(e={lastEffect:null,stores:null},Te.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function zu(t,e,n,c){e.value=n,e.getSnapshot=c,Uu(e)&&Gu(t)}function Bu(t,e,n){return n(function(){Uu(e)&&Gu(t)})}function Uu(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!wt(t,n)}catch{return!0}}function Gu(t){var e=Nt(t,1);e!==null&&xt(e,t,1,-1)}function Dl(t){var e=Ct();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ui,lastRenderedState:t},e.queue=t,t=t.dispatch=Wf.bind(null,Te,t),[e.memoizedState,t]}function Gi(t,e,n,c){return t={tag:t,create:e,destroy:n,deps:c,next:null},e=Te.updateQueue,e===null?(e={lastEffect:null,stores:null},Te.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(c=n.next,n.next=t,t.next=c,e.lastEffect=t)),t}function Wu(){return ht().memoizedState}function Tr(t,e,n,c){var p=Ct();Te.flags|=t,p.memoizedState=Gi(1|e,n,void 0,c===void 0?null:c)}function hs(t,e,n,c){var p=ht();c=c===void 0?null:c;var y=void 0;if(Ie!==null){var w=Ie.memoizedState;if(y=w.destroy,c!==null&&Eo(c,w.deps)){p.memoizedState=Gi(e,n,y,c);return}}Te.flags|=t,p.memoizedState=Gi(1|e,n,y,c)}function Nl(t,e){return Tr(8390656,8,t,e)}function jo(t,e){return hs(2048,8,t,e)}function Hu(t,e){return hs(4,2,t,e)}function Vu(t,e){return hs(4,4,t,e)}function Xu(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Yu(t,e,n){return n=n!=null?n.concat([t]):null,hs(4,4,Xu.bind(null,e,t),n)}function Ao(){}function $u(t,e){var n=ht();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&Eo(e,c[1])?c[0]:(n.memoizedState=[t,e],t)}function Ku(t,e){var n=ht();e=e===void 0?null:e;var c=n.memoizedState;return c!==null&&e!==null&&Eo(e,c[1])?c[0]:(t=t(),n.memoizedState=[t,e],t)}function qu(t,e,n){return xn&21?(wt(n,e)||(n=tu(),Te.lanes|=n,wn|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ke=!0),t.memoizedState=n)}function Uf(t,e){var n=ve;ve=n!==0&&4>n?n:4,t(!0);var c=Ws.transition;Ws.transition={};try{t(!1),e()}finally{ve=n,Ws.transition=c}}function Qu(){return ht().memoizedState}function Gf(t,e,n){var c=Jt(t);if(n={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null},Ju(t))Zu(e,n);else if(n=Mu(t,e,n,c),n!==null){var p=We();xt(n,t,c,p),eh(n,e,c)}}function Wf(t,e,n){var c=Jt(t),p={lane:c,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ju(t))Zu(e,p);else{var y=t.alternate;if(t.lanes===0&&(y===null||y.lanes===0)&&(y=e.lastRenderedReducer,y!==null))try{var w=e.lastRenderedState,d=y(w,n);if(p.hasEagerState=!0,p.eagerState=d,wt(d,w)){var s=e.interleaved;s===null?(p.next=p,bo(e)):(p.next=s.next,s.next=p),e.interleaved=p;return}}catch{}finally{}n=Mu(t,e,p,c),n!==null&&(p=We(),xt(n,t,c,p),eh(n,e,c))}}function Ju(t){var e=t.alternate;return t===Te||e!==null&&e===Te}function Zu(t,e){Ci=Yr=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function eh(t,e,n){if(n&4194240){var c=e.lanes;c&=t.pendingLanes,n|=c,e.lanes=n,lo(t,n)}}var $r={readContext:ut,useCallback:Re,useContext:Re,useEffect:Re,useImperativeHandle:Re,useInsertionEffect:Re,useLayoutEffect:Re,useMemo:Re,useReducer:Re,useRef:Re,useState:Re,useDebugValue:Re,useDeferredValue:Re,useTransition:Re,useMutableSource:Re,useSyncExternalStore:Re,useId:Re,unstable_isNewReconciler:!1},Hf={readContext:ut,useCallback:function(t,e){return Ct().memoizedState=[t,e===void 0?null:e],t},useContext:ut,useEffect:Nl,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Tr(4194308,4,Xu.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Tr(4194308,4,t,e)},useInsertionEffect:function(t,e){return Tr(4,2,t,e)},useMemo:function(t,e){var n=Ct();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var c=Ct();return e=n!==void 0?n(e):e,c.memoizedState=c.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},c.queue=t,t=t.dispatch=Gf.bind(null,Te,t),[c.memoizedState,t]},useRef:function(t){var e=Ct();return t={current:t},e.memoizedState=t},useState:Dl,useDebugValue:Ao,useDeferredValue:function(t){return Ct().memoizedState=t},useTransition:function(){var t=Dl(!1),e=t[0];return t=Uf.bind(null,t[1]),Ct().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var c=Te,p=Ct();if(be){if(n===void 0)throw Error(re(407));n=n()}else{if(n=e(),De===null)throw Error(re(349));xn&30||Ru(c,e,n)}p.memoizedState=n;var y={value:n,getSnapshot:e};return p.queue=y,Nl(Bu.bind(null,c,y,t),[t]),c.flags|=2048,Gi(9,zu.bind(null,c,y,n,e),void 0,null),n},useId:function(){var t=Ct(),e=De.identifierPrefix;if(be){var n=jt,c=It;n=(c&~(1<<32-yt(c)-1)).toString(32)+n,e=":"+e+"R"+n,n=Bi++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Bf++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Vf={readContext:ut,useCallback:$u,useContext:ut,useEffect:jo,useImperativeHandle:Yu,useInsertionEffect:Hu,useLayoutEffect:Vu,useMemo:Ku,useReducer:Hs,useRef:Wu,useState:function(){return Hs(Ui)},useDebugValue:Ao,useDeferredValue:function(t){var e=ht();return qu(e,Ie.memoizedState,t)},useTransition:function(){var t=Hs(Ui)[0],e=ht().memoizedState;return[t,e]},useMutableSource:Lu,useSyncExternalStore:Fu,useId:Qu,unstable_isNewReconciler:!1},Xf={readContext:ut,useCallback:$u,useContext:ut,useEffect:jo,useImperativeHandle:Yu,useInsertionEffect:Hu,useLayoutEffect:Vu,useMemo:Ku,useReducer:Vs,useRef:Wu,useState:function(){return Vs(Ui)},useDebugValue:Ao,useDeferredValue:function(t){var e=ht();return Ie===null?e.memoizedState=t:qu(e,Ie.memoizedState,t)},useTransition:function(){var t=Vs(Ui)[0],e=ht().memoizedState;return[t,e]},useMutableSource:Lu,useSyncExternalStore:Fu,useId:Qu,unstable_isNewReconciler:!1};function mt(t,e){if(t&&t.defaultProps){e=ke({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function ja(t,e,n,c){e=t.memoizedState,n=n(c,e),n=n==null?e:ke({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var ds={isMounted:function(t){return(t=t._reactInternals)?bn(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var c=We(),p=Jt(t),y=At(c,p);y.payload=e,n!=null&&(y.callback=n),e=qt(t,y,p),e!==null&&(xt(e,t,p,c),br(e,t,p))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var c=We(),p=Jt(t),y=At(c,p);y.tag=1,y.payload=e,n!=null&&(y.callback=n),e=qt(t,y,p),e!==null&&(xt(e,t,p,c),br(e,t,p))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=We(),c=Jt(t),p=At(n,c);p.tag=2,e!=null&&(p.callback=e),e=qt(t,p,c),e!==null&&(xt(e,t,c,n),br(e,t,c))}};function Ll(t,e,n,c,p,y,w){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(c,y,w):e.prototype&&e.prototype.isPureReactComponent?!Di(n,c)||!Di(p,y):!0}function th(t,e,n){var c=!1,p=nn,y=e.contextType;return typeof y=="object"&&y!==null?y=ut(y):(p=Qe(e)?vn:Ue.current,c=e.contextTypes,y=(c=c!=null)?Yn(t,p):nn),e=new e(n,y),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ds,t.stateNode=e,e._reactInternals=t,c&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=p,t.__reactInternalMemoizedMaskedChildContext=y),e}function Fl(t,e,n,c){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,c),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,c),e.state!==t&&ds.enqueueReplaceState(e,e.state,null)}function Aa(t,e,n,c){var p=t.stateNode;p.props=n,p.state=t.memoizedState,p.refs={},_o(t);var y=e.contextType;typeof y=="object"&&y!==null?p.context=ut(y):(y=Qe(e)?vn:Ue.current,p.context=Yn(t,y)),p.state=t.memoizedState,y=e.getDerivedStateFromProps,typeof y=="function"&&(ja(t,e,y,n),p.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(e=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),e!==p.state&&ds.enqueueReplaceState(p,p.state,null),Vr(t,n,p,c),p.state=t.memoizedState),typeof p.componentDidMount=="function"&&(t.flags|=4194308)}function Qn(t,e){try{var n="",c=e;do n+=xd(c),c=c.return;while(c);var p=n}catch(y){p=`
Error generating stack: `+y.message+`
`+y.stack}return{value:t,source:e,stack:p,digest:null}}function Xs(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ma(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Yf=typeof WeakMap=="function"?WeakMap:Map;function nh(t,e,n){n=At(-1,n),n.tag=3,n.payload={element:null};var c=e.value;return n.callback=function(){qr||(qr=!0,Wa=c),Ma(t,e)},n}function ih(t,e,n){n=At(-1,n),n.tag=3;var c=t.type.getDerivedStateFromError;if(typeof c=="function"){var p=e.value;n.payload=function(){return c(p)},n.callback=function(){Ma(t,e)}}var y=t.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(n.callback=function(){Ma(t,e),typeof c!="function"&&(Qt===null?Qt=new Set([this]):Qt.add(this));var w=e.stack;this.componentDidCatch(e.value,{componentStack:w!==null?w:""})}),n}function Rl(t,e,n){var c=t.pingCache;if(c===null){c=t.pingCache=new Yf;var p=new Set;c.set(e,p)}else p=c.get(e),p===void 0&&(p=new Set,c.set(e,p));p.has(n)||(p.add(n),t=og.bind(null,t,e,n),e.then(t,t))}function zl(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Bl(t,e,n,c,p){return t.mode&1?(t.flags|=65536,t.lanes=p,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=At(-1,1),e.tag=2,qt(n,e,1))),n.lanes|=1),t)}var $f=Ft.ReactCurrentOwner,Ke=!1;function Ge(t,e,n,c){e.child=t===null?Au(e,null,n,c):Kn(e,t.child,n,c)}function Ul(t,e,n,c,p){n=n.render;var y=e.ref;return Wn(e,p),c=Oo(t,e,n,c,y,p),n=Io(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~p,Lt(t,e,p)):(be&&n&&vo(e),e.flags|=1,Ge(t,e,c,p),e.child)}function Gl(t,e,n,c,p){if(t===null){var y=n.type;return typeof y=="function"&&!Bo(y)&&y.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=y,rh(t,e,y,c,p)):(t=Or(n.type,null,c,e,e.mode,p),t.ref=e.ref,t.return=e,e.child=t)}if(y=t.child,!(t.lanes&p)){var w=y.memoizedProps;if(n=n.compare,n=n!==null?n:Di,n(w,c)&&t.ref===e.ref)return Lt(t,e,p)}return e.flags|=1,t=Zt(y,c),t.ref=e.ref,t.return=e,e.child=t}function rh(t,e,n,c,p){if(t!==null){var y=t.memoizedProps;if(Di(y,c)&&t.ref===e.ref)if(Ke=!1,e.pendingProps=c=y,(t.lanes&p)!==0)t.flags&131072&&(Ke=!0);else return e.lanes=t.lanes,Lt(t,e,p)}return Da(t,e,n,c,p)}function sh(t,e,n){var c=e.pendingProps,p=c.children,y=t!==null?t.memoizedState:null;if(c.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ye(Rn,Ze),Ze|=n;else{if(!(n&1073741824))return t=y!==null?y.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ye(Rn,Ze),Ze|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},c=y!==null?y.baseLanes:n,ye(Rn,Ze),Ze|=c}else y!==null?(c=y.baseLanes|n,e.memoizedState=null):c=n,ye(Rn,Ze),Ze|=c;return Ge(t,e,p,n),e.child}function ah(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Da(t,e,n,c,p){var y=Qe(n)?vn:Ue.current;return y=Yn(e,y),Wn(e,p),n=Oo(t,e,n,c,y,p),c=Io(),t!==null&&!Ke?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~p,Lt(t,e,p)):(be&&c&&vo(e),e.flags|=1,Ge(t,e,n,p),e.child)}function Wl(t,e,n,c,p){if(Qe(n)){var y=!0;Br(e)}else y=!1;if(Wn(e,p),e.stateNode===null)kr(t,e),th(e,n,c),Aa(e,n,c,p),c=!0;else if(t===null){var w=e.stateNode,d=e.memoizedProps;w.props=d;var s=w.context,u=n.contextType;typeof u=="object"&&u!==null?u=ut(u):(u=Qe(n)?vn:Ue.current,u=Yn(e,u));var h=n.getDerivedStateFromProps,r=typeof h=="function"||typeof w.getSnapshotBeforeUpdate=="function";r||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==c||s!==u)&&Fl(e,w,c,u),Ut=!1;var a=e.memoizedState;w.state=a,Vr(e,c,w,p),s=e.memoizedState,d!==c||a!==s||qe.current||Ut?(typeof h=="function"&&(ja(e,n,h,c),s=e.memoizedState),(d=Ut||Ll(e,n,d,c,a,s,u))?(r||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(e.flags|=4194308)):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=c,e.memoizedState=s),w.props=c,w.state=s,w.context=u,c=d):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),c=!1)}else{w=e.stateNode,Du(t,e),d=e.memoizedProps,u=e.type===e.elementType?d:mt(e.type,d),w.props=u,r=e.pendingProps,a=w.context,s=n.contextType,typeof s=="object"&&s!==null?s=ut(s):(s=Qe(n)?vn:Ue.current,s=Yn(e,s));var i=n.getDerivedStateFromProps;(h=typeof i=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(d!==r||a!==s)&&Fl(e,w,c,s),Ut=!1,a=e.memoizedState,w.state=a,Vr(e,c,w,p);var o=e.memoizedState;d!==r||a!==o||qe.current||Ut?(typeof i=="function"&&(ja(e,n,i,c),o=e.memoizedState),(u=Ut||Ll(e,n,u,c,a,o,s)||!1)?(h||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(c,o,s),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(c,o,s)),typeof w.componentDidUpdate=="function"&&(e.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof w.componentDidUpdate!="function"||d===t.memoizedProps&&a===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===t.memoizedProps&&a===t.memoizedState||(e.flags|=1024),e.memoizedProps=c,e.memoizedState=o),w.props=c,w.state=o,w.context=s,c=u):(typeof w.componentDidUpdate!="function"||d===t.memoizedProps&&a===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||d===t.memoizedProps&&a===t.memoizedState||(e.flags|=1024),c=!1)}return Na(t,e,n,c,y,p)}function Na(t,e,n,c,p,y){ah(t,e);var w=(e.flags&128)!==0;if(!c&&!w)return p&&El(e,n,!1),Lt(t,e,y);c=e.stateNode,$f.current=e;var d=w&&typeof n.getDerivedStateFromError!="function"?null:c.render();return e.flags|=1,t!==null&&w?(e.child=Kn(e,t.child,null,y),e.child=Kn(e,null,d,y)):Ge(t,e,d,y),e.memoizedState=c.state,p&&El(e,n,!0),e.child}function oh(t){var e=t.stateNode;e.pendingContext?Pl(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Pl(t,e.context,!1),To(t,e.containerInfo)}function Hl(t,e,n,c,p){return $n(),xo(p),e.flags|=256,Ge(t,e,n,c),e.child}var La={dehydrated:null,treeContext:null,retryLane:0};function Fa(t){return{baseLanes:t,cachePool:null,transitions:null}}function lh(t,e,n){var c=e.pendingProps,p=_e.current,y=!1,w=(e.flags&128)!==0,d;if((d=w)||(d=t!==null&&t.memoizedState===null?!1:(p&2)!==0),d?(y=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(p|=1),ye(_e,p&1),t===null)return Oa(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(w=c.children,t=c.fallback,y?(c=e.mode,y=e.child,w={mode:"hidden",children:w},!(c&1)&&y!==null?(y.childLanes=0,y.pendingProps=w):y=ms(w,c,0,null),t=pn(t,c,n,null),y.return=e,t.return=e,y.sibling=t,e.child=y,e.child.memoizedState=Fa(n),e.memoizedState=La,t):Mo(e,w));if(p=t.memoizedState,p!==null&&(d=p.dehydrated,d!==null))return Kf(t,e,w,c,d,p,n);if(y){y=c.fallback,w=e.mode,p=t.child,d=p.sibling;var s={mode:"hidden",children:c.children};return!(w&1)&&e.child!==p?(c=e.child,c.childLanes=0,c.pendingProps=s,e.deletions=null):(c=Zt(p,s),c.subtreeFlags=p.subtreeFlags&14680064),d!==null?y=Zt(d,y):(y=pn(y,w,n,null),y.flags|=2),y.return=e,c.return=e,c.sibling=y,e.child=c,c=y,y=e.child,w=t.child.memoizedState,w=w===null?Fa(n):{baseLanes:w.baseLanes|n,cachePool:null,transitions:w.transitions},y.memoizedState=w,y.childLanes=t.childLanes&~n,e.memoizedState=La,c}return y=t.child,t=y.sibling,c=Zt(y,{mode:"visible",children:c.children}),!(e.mode&1)&&(c.lanes=n),c.return=e,c.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=c,e.memoizedState=null,c}function Mo(t,e){return e=ms({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function fr(t,e,n,c){return c!==null&&xo(c),Kn(e,t.child,null,n),t=Mo(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Kf(t,e,n,c,p,y,w){if(n)return e.flags&256?(e.flags&=-257,c=Xs(Error(re(422))),fr(t,e,w,c)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(y=c.fallback,p=e.mode,c=ms({mode:"visible",children:c.children},p,0,null),y=pn(y,p,w,null),y.flags|=2,c.return=e,y.return=e,c.sibling=y,e.child=c,e.mode&1&&Kn(e,t.child,null,w),e.child.memoizedState=Fa(w),e.memoizedState=La,y);if(!(e.mode&1))return fr(t,e,w,null);if(p.data==="$!"){if(c=p.nextSibling&&p.nextSibling.dataset,c)var d=c.dgst;return c=d,y=Error(re(419)),c=Xs(y,c,void 0),fr(t,e,w,c)}if(d=(w&t.childLanes)!==0,Ke||d){if(c=De,c!==null){switch(w&-w){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(c.suspendedLanes|w)?0:p,p!==0&&p!==y.retryLane&&(y.retryLane=p,Nt(t,p),xt(c,t,p,-1))}return zo(),c=Xs(Error(re(421))),fr(t,e,w,c)}return p.data==="$?"?(e.flags|=128,e.child=t.child,e=lg.bind(null,t),p._reactRetry=e,null):(t=y.treeContext,et=Kt(p.nextSibling),tt=e,be=!0,vt=null,t!==null&&(at[ot++]=It,at[ot++]=jt,at[ot++]=yn,It=t.id,jt=t.overflow,yn=e),e=Mo(e,c.children),e.flags|=4096,e)}function Vl(t,e,n){t.lanes|=e;var c=t.alternate;c!==null&&(c.lanes|=e),Ia(t.return,e,n)}function Ys(t,e,n,c,p){var y=t.memoizedState;y===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:c,tail:n,tailMode:p}:(y.isBackwards=e,y.rendering=null,y.renderingStartTime=0,y.last=c,y.tail=n,y.tailMode=p)}function ch(t,e,n){var c=e.pendingProps,p=c.revealOrder,y=c.tail;if(Ge(t,e,c.children,n),c=_e.current,c&2)c=c&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Vl(t,n,e);else if(t.tag===19)Vl(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}c&=1}if(ye(_e,c),!(e.mode&1))e.memoizedState=null;else switch(p){case"forwards":for(n=e.child,p=null;n!==null;)t=n.alternate,t!==null&&Xr(t)===null&&(p=n),n=n.sibling;n=p,n===null?(p=e.child,e.child=null):(p=n.sibling,n.sibling=null),Ys(e,!1,p,n,y);break;case"backwards":for(n=null,p=e.child,e.child=null;p!==null;){if(t=p.alternate,t!==null&&Xr(t)===null){e.child=p;break}t=p.sibling,p.sibling=n,n=p,p=t}Ys(e,!0,n,null,y);break;case"together":Ys(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function kr(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Lt(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),wn|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(re(153));if(e.child!==null){for(t=e.child,n=Zt(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Zt(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function qf(t,e,n){switch(e.tag){case 3:oh(e),$n();break;case 5:Nu(e);break;case 1:Qe(e.type)&&Br(e);break;case 4:To(e,e.stateNode.containerInfo);break;case 10:var c=e.type._context,p=e.memoizedProps.value;ye(Wr,c._currentValue),c._currentValue=p;break;case 13:if(c=e.memoizedState,c!==null)return c.dehydrated!==null?(ye(_e,_e.current&1),e.flags|=128,null):n&e.child.childLanes?lh(t,e,n):(ye(_e,_e.current&1),t=Lt(t,e,n),t!==null?t.sibling:null);ye(_e,_e.current&1);break;case 19:if(c=(n&e.childLanes)!==0,t.flags&128){if(c)return ch(t,e,n);e.flags|=128}if(p=e.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),ye(_e,_e.current),c)break;return null;case 22:case 23:return e.lanes=0,sh(t,e,n)}return Lt(t,e,n)}var uh,Ra,hh,dh;uh=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Ra=function(){};hh=function(t,e,n,c){var p=t.memoizedProps;if(p!==c){t=e.stateNode,gn(Tt.current);var y=null;switch(n){case"input":p=aa(t,p),c=aa(t,c),y=[];break;case"select":p=ke({},p,{value:void 0}),c=ke({},c,{value:void 0}),y=[];break;case"textarea":p=ca(t,p),c=ca(t,c),y=[];break;default:typeof p.onClick!="function"&&typeof c.onClick=="function"&&(t.onclick=Rr)}ha(n,c);var w;n=null;for(u in p)if(!c.hasOwnProperty(u)&&p.hasOwnProperty(u)&&p[u]!=null)if(u==="style"){var d=p[u];for(w in d)d.hasOwnProperty(w)&&(n||(n={}),n[w]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Pi.hasOwnProperty(u)?y||(y=[]):(y=y||[]).push(u,null));for(u in c){var s=c[u];if(d=p!=null?p[u]:void 0,c.hasOwnProperty(u)&&s!==d&&(s!=null||d!=null))if(u==="style")if(d){for(w in d)!d.hasOwnProperty(w)||s&&s.hasOwnProperty(w)||(n||(n={}),n[w]="");for(w in s)s.hasOwnProperty(w)&&d[w]!==s[w]&&(n||(n={}),n[w]=s[w])}else n||(y||(y=[]),y.push(u,n)),n=s;else u==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,d=d?d.__html:void 0,s!=null&&d!==s&&(y=y||[]).push(u,s)):u==="children"?typeof s!="string"&&typeof s!="number"||(y=y||[]).push(u,""+s):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Pi.hasOwnProperty(u)?(s!=null&&u==="onScroll"&&xe("scroll",t),y||d===s||(y=[])):(y=y||[]).push(u,s))}n&&(y=y||[]).push("style",n);var u=y;(e.updateQueue=u)&&(e.flags|=4)}};dh=function(t,e,n,c){n!==c&&(e.flags|=4)};function hi(t,e){if(!be)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var c=null;n!==null;)n.alternate!==null&&(c=n),n=n.sibling;c===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:c.sibling=null}}function ze(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,c=0;if(e)for(var p=t.child;p!==null;)n|=p.lanes|p.childLanes,c|=p.subtreeFlags&14680064,c|=p.flags&14680064,p.return=t,p=p.sibling;else for(p=t.child;p!==null;)n|=p.lanes|p.childLanes,c|=p.subtreeFlags,c|=p.flags,p.return=t,p=p.sibling;return t.subtreeFlags|=c,t.childLanes=n,e}function Qf(t,e,n){var c=e.pendingProps;switch(yo(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ze(e),null;case 1:return Qe(e.type)&&zr(),ze(e),null;case 3:return c=e.stateNode,qn(),we(qe),we(Ue),Po(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(t===null||t.child===null)&&(hr(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,vt!==null&&(Xa(vt),vt=null))),Ra(t,e),ze(e),null;case 5:ko(e);var p=gn(zi.current);if(n=e.type,t!==null&&e.stateNode!=null)hh(t,e,n,c,p),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!c){if(e.stateNode===null)throw Error(re(166));return ze(e),null}if(t=gn(Tt.current),hr(e)){c=e.stateNode,n=e.type;var y=e.memoizedProps;switch(c[bt]=e,c[Fi]=y,t=(e.mode&1)!==0,n){case"dialog":xe("cancel",c),xe("close",c);break;case"iframe":case"object":case"embed":xe("load",c);break;case"video":case"audio":for(p=0;p<pi.length;p++)xe(pi[p],c);break;case"source":xe("error",c);break;case"img":case"image":case"link":xe("error",c),xe("load",c);break;case"details":xe("toggle",c);break;case"input":el(c,y),xe("invalid",c);break;case"select":c._wrapperState={wasMultiple:!!y.multiple},xe("invalid",c);break;case"textarea":nl(c,y),xe("invalid",c)}ha(n,y),p=null;for(var w in y)if(y.hasOwnProperty(w)){var d=y[w];w==="children"?typeof d=="string"?c.textContent!==d&&(y.suppressHydrationWarning!==!0&&ur(c.textContent,d,t),p=["children",d]):typeof d=="number"&&c.textContent!==""+d&&(y.suppressHydrationWarning!==!0&&ur(c.textContent,d,t),p=["children",""+d]):Pi.hasOwnProperty(w)&&d!=null&&w==="onScroll"&&xe("scroll",c)}switch(n){case"input":nr(c),tl(c,y,!0);break;case"textarea":nr(c),il(c);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(c.onclick=Rr)}c=p,e.updateQueue=c,c!==null&&(e.flags|=4)}else{w=p.nodeType===9?p:p.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Bc(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=w.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof c.is=="string"?t=w.createElement(n,{is:c.is}):(t=w.createElement(n),n==="select"&&(w=t,c.multiple?w.multiple=!0:c.size&&(w.size=c.size))):t=w.createElementNS(t,n),t[bt]=e,t[Fi]=c,uh(t,e,!1,!1),e.stateNode=t;e:{switch(w=da(n,c),n){case"dialog":xe("cancel",t),xe("close",t),p=c;break;case"iframe":case"object":case"embed":xe("load",t),p=c;break;case"video":case"audio":for(p=0;p<pi.length;p++)xe(pi[p],t);p=c;break;case"source":xe("error",t),p=c;break;case"img":case"image":case"link":xe("error",t),xe("load",t),p=c;break;case"details":xe("toggle",t),p=c;break;case"input":el(t,c),p=aa(t,c),xe("invalid",t);break;case"option":p=c;break;case"select":t._wrapperState={wasMultiple:!!c.multiple},p=ke({},c,{value:void 0}),xe("invalid",t);break;case"textarea":nl(t,c),p=ca(t,c),xe("invalid",t);break;default:p=c}ha(n,p),d=p;for(y in d)if(d.hasOwnProperty(y)){var s=d[y];y==="style"?Wc(t,s):y==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,s!=null&&Uc(t,s)):y==="children"?typeof s=="string"?(n!=="textarea"||s!=="")&&Ei(t,s):typeof s=="number"&&Ei(t,""+s):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(Pi.hasOwnProperty(y)?s!=null&&y==="onScroll"&&xe("scroll",t):s!=null&&no(t,y,s,w))}switch(n){case"input":nr(t),tl(t,c,!1);break;case"textarea":nr(t),il(t);break;case"option":c.value!=null&&t.setAttribute("value",""+tn(c.value));break;case"select":t.multiple=!!c.multiple,y=c.value,y!=null?zn(t,!!c.multiple,y,!1):c.defaultValue!=null&&zn(t,!!c.multiple,c.defaultValue,!0);break;default:typeof p.onClick=="function"&&(t.onclick=Rr)}switch(n){case"button":case"input":case"select":case"textarea":c=!!c.autoFocus;break e;case"img":c=!0;break e;default:c=!1}}c&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ze(e),null;case 6:if(t&&e.stateNode!=null)dh(t,e,t.memoizedProps,c);else{if(typeof c!="string"&&e.stateNode===null)throw Error(re(166));if(n=gn(zi.current),gn(Tt.current),hr(e)){if(c=e.stateNode,n=e.memoizedProps,c[bt]=e,(y=c.nodeValue!==n)&&(t=tt,t!==null))switch(t.tag){case 3:ur(c.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ur(c.nodeValue,n,(t.mode&1)!==0)}y&&(e.flags|=4)}else c=(n.nodeType===9?n:n.ownerDocument).createTextNode(c),c[bt]=e,e.stateNode=c}return ze(e),null;case 13:if(we(_e),c=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(be&&et!==null&&e.mode&1&&!(e.flags&128))Iu(),$n(),e.flags|=98560,y=!1;else if(y=hr(e),c!==null&&c.dehydrated!==null){if(t===null){if(!y)throw Error(re(318));if(y=e.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(re(317));y[bt]=e}else $n(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ze(e),y=!1}else vt!==null&&(Xa(vt),vt=null),y=!0;if(!y)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(c=c!==null,c!==(t!==null&&t.memoizedState!==null)&&c&&(e.child.flags|=8192,e.mode&1&&(t===null||_e.current&1?je===0&&(je=3):zo())),e.updateQueue!==null&&(e.flags|=4),ze(e),null);case 4:return qn(),Ra(t,e),t===null&&Ni(e.stateNode.containerInfo),ze(e),null;case 10:return Co(e.type._context),ze(e),null;case 17:return Qe(e.type)&&zr(),ze(e),null;case 19:if(we(_e),y=e.memoizedState,y===null)return ze(e),null;if(c=(e.flags&128)!==0,w=y.rendering,w===null)if(c)hi(y,!1);else{if(je!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(w=Xr(t),w!==null){for(e.flags|=128,hi(y,!1),c=w.updateQueue,c!==null&&(e.updateQueue=c,e.flags|=4),e.subtreeFlags=0,c=n,n=e.child;n!==null;)y=n,t=c,y.flags&=14680066,w=y.alternate,w===null?(y.childLanes=0,y.lanes=t,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=w.childLanes,y.lanes=w.lanes,y.child=w.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=w.memoizedProps,y.memoizedState=w.memoizedState,y.updateQueue=w.updateQueue,y.type=w.type,t=w.dependencies,y.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ye(_e,_e.current&1|2),e.child}t=t.sibling}y.tail!==null&&Ee()>Jn&&(e.flags|=128,c=!0,hi(y,!1),e.lanes=4194304)}else{if(!c)if(t=Xr(w),t!==null){if(e.flags|=128,c=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),hi(y,!0),y.tail===null&&y.tailMode==="hidden"&&!w.alternate&&!be)return ze(e),null}else 2*Ee()-y.renderingStartTime>Jn&&n!==1073741824&&(e.flags|=128,c=!0,hi(y,!1),e.lanes=4194304);y.isBackwards?(w.sibling=e.child,e.child=w):(n=y.last,n!==null?n.sibling=w:e.child=w,y.last=w)}return y.tail!==null?(e=y.tail,y.rendering=e,y.tail=e.sibling,y.renderingStartTime=Ee(),e.sibling=null,n=_e.current,ye(_e,c?n&1|2:n&1),e):(ze(e),null);case 22:case 23:return Ro(),c=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==c&&(e.flags|=8192),c&&e.mode&1?Ze&1073741824&&(ze(e),e.subtreeFlags&6&&(e.flags|=8192)):ze(e),null;case 24:return null;case 25:return null}throw Error(re(156,e.tag))}function Jf(t,e){switch(yo(e),e.tag){case 1:return Qe(e.type)&&zr(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return qn(),we(qe),we(Ue),Po(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return ko(e),null;case 13:if(we(_e),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(re(340));$n()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return we(_e),null;case 4:return qn(),null;case 10:return Co(e.type._context),null;case 22:case 23:return Ro(),null;case 24:return null;default:return null}}var gr=!1,Be=!1,Zf=typeof WeakSet=="function"?WeakSet:Set,ue=null;function Fn(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(c){Pe(t,e,c)}else n.current=null}function za(t,e,n){try{n()}catch(c){Pe(t,e,c)}}var Xl=!1;function eg(t,e){if(Ca=Nr,t=vu(),po(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var c=n.getSelection&&n.getSelection();if(c&&c.rangeCount!==0){n=c.anchorNode;var p=c.anchorOffset,y=c.focusNode;c=c.focusOffset;try{n.nodeType,y.nodeType}catch{n=null;break e}var w=0,d=-1,s=-1,u=0,h=0,r=t,a=null;t:for(;;){for(var i;r!==n||p!==0&&r.nodeType!==3||(d=w+p),r!==y||c!==0&&r.nodeType!==3||(s=w+c),r.nodeType===3&&(w+=r.nodeValue.length),(i=r.firstChild)!==null;)a=r,r=i;for(;;){if(r===t)break t;if(a===n&&++u===p&&(d=w),a===y&&++h===c&&(s=w),(i=r.nextSibling)!==null)break;r=a,a=r.parentNode}r=i}n=d===-1||s===-1?null:{start:d,end:s}}else n=null}n=n||{start:0,end:0}}else n=null;for(ba={focusedElem:t,selectionRange:n},Nr=!1,ue=e;ue!==null;)if(e=ue,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ue=t;else for(;ue!==null;){e=ue;try{var o=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(o!==null){var f=o.memoizedProps,l=o.memoizedState,g=e.stateNode,m=g.getSnapshotBeforeUpdate(e.elementType===e.type?f:mt(e.type,f),l);g.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(re(163))}}catch(x){Pe(e,e.return,x)}if(t=e.sibling,t!==null){t.return=e.return,ue=t;break}ue=e.return}return o=Xl,Xl=!1,o}function bi(t,e,n){var c=e.updateQueue;if(c=c!==null?c.lastEffect:null,c!==null){var p=c=c.next;do{if((p.tag&t)===t){var y=p.destroy;p.destroy=void 0,y!==void 0&&za(e,n,y)}p=p.next}while(p!==c)}}function fs(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var c=n.create;n.destroy=c()}n=n.next}while(n!==e)}}function Ba(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function fh(t){var e=t.alternate;e!==null&&(t.alternate=null,fh(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[bt],delete e[Fi],delete e[ka],delete e[Lf],delete e[Ff])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function gh(t){return t.tag===5||t.tag===3||t.tag===4}function Yl(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||gh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ua(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Rr));else if(c!==4&&(t=t.child,t!==null))for(Ua(t,e,n),t=t.sibling;t!==null;)Ua(t,e,n),t=t.sibling}function Ga(t,e,n){var c=t.tag;if(c===5||c===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(c!==4&&(t=t.child,t!==null))for(Ga(t,e,n),t=t.sibling;t!==null;)Ga(t,e,n),t=t.sibling}var Ne=null,pt=!1;function zt(t,e,n){for(n=n.child;n!==null;)mh(t,e,n),n=n.sibling}function mh(t,e,n){if(_t&&typeof _t.onCommitFiberUnmount=="function")try{_t.onCommitFiberUnmount(ss,n)}catch{}switch(n.tag){case 5:Be||Fn(n,e);case 6:var c=Ne,p=pt;Ne=null,zt(t,e,n),Ne=c,pt=p,Ne!==null&&(pt?(t=Ne,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ne.removeChild(n.stateNode));break;case 18:Ne!==null&&(pt?(t=Ne,n=n.stateNode,t.nodeType===8?Bs(t.parentNode,n):t.nodeType===1&&Bs(t,n),Ai(t)):Bs(Ne,n.stateNode));break;case 4:c=Ne,p=pt,Ne=n.stateNode.containerInfo,pt=!0,zt(t,e,n),Ne=c,pt=p;break;case 0:case 11:case 14:case 15:if(!Be&&(c=n.updateQueue,c!==null&&(c=c.lastEffect,c!==null))){p=c=c.next;do{var y=p,w=y.destroy;y=y.tag,w!==void 0&&(y&2||y&4)&&za(n,e,w),p=p.next}while(p!==c)}zt(t,e,n);break;case 1:if(!Be&&(Fn(n,e),c=n.stateNode,typeof c.componentWillUnmount=="function"))try{c.props=n.memoizedProps,c.state=n.memoizedState,c.componentWillUnmount()}catch(d){Pe(n,e,d)}zt(t,e,n);break;case 21:zt(t,e,n);break;case 22:n.mode&1?(Be=(c=Be)||n.memoizedState!==null,zt(t,e,n),Be=c):zt(t,e,n);break;default:zt(t,e,n)}}function $l(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Zf),e.forEach(function(c){var p=cg.bind(null,t,c);n.has(c)||(n.add(c),c.then(p,p))})}}function gt(t,e){var n=e.deletions;if(n!==null)for(var c=0;c<n.length;c++){var p=n[c];try{var y=t,w=e,d=w;e:for(;d!==null;){switch(d.tag){case 5:Ne=d.stateNode,pt=!1;break e;case 3:Ne=d.stateNode.containerInfo,pt=!0;break e;case 4:Ne=d.stateNode.containerInfo,pt=!0;break e}d=d.return}if(Ne===null)throw Error(re(160));mh(y,w,p),Ne=null,pt=!1;var s=p.alternate;s!==null&&(s.return=null),p.return=null}catch(u){Pe(p,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)ph(e,t),e=e.sibling}function ph(t,e){var n=t.alternate,c=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(gt(e,t),St(t),c&4){try{bi(3,t,t.return),fs(3,t)}catch(f){Pe(t,t.return,f)}try{bi(5,t,t.return)}catch(f){Pe(t,t.return,f)}}break;case 1:gt(e,t),St(t),c&512&&n!==null&&Fn(n,n.return);break;case 5:if(gt(e,t),St(t),c&512&&n!==null&&Fn(n,n.return),t.flags&32){var p=t.stateNode;try{Ei(p,"")}catch(f){Pe(t,t.return,f)}}if(c&4&&(p=t.stateNode,p!=null)){var y=t.memoizedProps,w=n!==null?n.memoizedProps:y,d=t.type,s=t.updateQueue;if(t.updateQueue=null,s!==null)try{d==="input"&&y.type==="radio"&&y.name!=null&&Rc(p,y),da(d,w);var u=da(d,y);for(w=0;w<s.length;w+=2){var h=s[w],r=s[w+1];h==="style"?Wc(p,r):h==="dangerouslySetInnerHTML"?Uc(p,r):h==="children"?Ei(p,r):no(p,h,r,u)}switch(d){case"input":oa(p,y);break;case"textarea":zc(p,y);break;case"select":var a=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!y.multiple;var i=y.value;i!=null?zn(p,!!y.multiple,i,!1):a!==!!y.multiple&&(y.defaultValue!=null?zn(p,!!y.multiple,y.defaultValue,!0):zn(p,!!y.multiple,y.multiple?[]:"",!1))}p[Fi]=y}catch(f){Pe(t,t.return,f)}}break;case 6:if(gt(e,t),St(t),c&4){if(t.stateNode===null)throw Error(re(162));p=t.stateNode,y=t.memoizedProps;try{p.nodeValue=y}catch(f){Pe(t,t.return,f)}}break;case 3:if(gt(e,t),St(t),c&4&&n!==null&&n.memoizedState.isDehydrated)try{Ai(e.containerInfo)}catch(f){Pe(t,t.return,f)}break;case 4:gt(e,t),St(t);break;case 13:gt(e,t),St(t),p=t.child,p.flags&8192&&(y=p.memoizedState!==null,p.stateNode.isHidden=y,!y||p.alternate!==null&&p.alternate.memoizedState!==null||(Lo=Ee())),c&4&&$l(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(Be=(u=Be)||h,gt(e,t),Be=u):gt(e,t),St(t),c&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!h&&t.mode&1)for(ue=t,h=t.child;h!==null;){for(r=ue=h;ue!==null;){switch(a=ue,i=a.child,a.tag){case 0:case 11:case 14:case 15:bi(4,a,a.return);break;case 1:Fn(a,a.return);var o=a.stateNode;if(typeof o.componentWillUnmount=="function"){c=a,n=a.return;try{e=c,o.props=e.memoizedProps,o.state=e.memoizedState,o.componentWillUnmount()}catch(f){Pe(c,n,f)}}break;case 5:Fn(a,a.return);break;case 22:if(a.memoizedState!==null){ql(r);continue}}i!==null?(i.return=a,ue=i):ql(r)}h=h.sibling}e:for(h=null,r=t;;){if(r.tag===5){if(h===null){h=r;try{p=r.stateNode,u?(y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(d=r.stateNode,s=r.memoizedProps.style,w=s!=null&&s.hasOwnProperty("display")?s.display:null,d.style.display=Gc("display",w))}catch(f){Pe(t,t.return,f)}}}else if(r.tag===6){if(h===null)try{r.stateNode.nodeValue=u?"":r.memoizedProps}catch(f){Pe(t,t.return,f)}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===t)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break e;for(;r.sibling===null;){if(r.return===null||r.return===t)break e;h===r&&(h=null),r=r.return}h===r&&(h=null),r.sibling.return=r.return,r=r.sibling}}break;case 19:gt(e,t),St(t),c&4&&$l(t);break;case 21:break;default:gt(e,t),St(t)}}function St(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(gh(n)){var c=n;break e}n=n.return}throw Error(re(160))}switch(c.tag){case 5:var p=c.stateNode;c.flags&32&&(Ei(p,""),c.flags&=-33);var y=Yl(t);Ga(t,y,p);break;case 3:case 4:var w=c.stateNode.containerInfo,d=Yl(t);Ua(t,d,w);break;default:throw Error(re(161))}}catch(s){Pe(t,t.return,s)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function tg(t,e,n){ue=t,vh(t)}function vh(t,e,n){for(var c=(t.mode&1)!==0;ue!==null;){var p=ue,y=p.child;if(p.tag===22&&c){var w=p.memoizedState!==null||gr;if(!w){var d=p.alternate,s=d!==null&&d.memoizedState!==null||Be;d=gr;var u=Be;if(gr=w,(Be=s)&&!u)for(ue=p;ue!==null;)w=ue,s=w.child,w.tag===22&&w.memoizedState!==null?Ql(p):s!==null?(s.return=w,ue=s):Ql(p);for(;y!==null;)ue=y,vh(y),y=y.sibling;ue=p,gr=d,Be=u}Kl(t)}else p.subtreeFlags&8772&&y!==null?(y.return=p,ue=y):Kl(t)}}function Kl(t){for(;ue!==null;){var e=ue;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Be||fs(5,e);break;case 1:var c=e.stateNode;if(e.flags&4&&!Be)if(n===null)c.componentDidMount();else{var p=e.elementType===e.type?n.memoizedProps:mt(e.type,n.memoizedProps);c.componentDidUpdate(p,n.memoizedState,c.__reactInternalSnapshotBeforeUpdate)}var y=e.updateQueue;y!==null&&Ml(e,y,c);break;case 3:var w=e.updateQueue;if(w!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ml(e,w,n)}break;case 5:var d=e.stateNode;if(n===null&&e.flags&4){n=d;var s=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break;case"img":s.src&&(n.src=s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var r=h.dehydrated;r!==null&&Ai(r)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(re(163))}Be||e.flags&512&&Ba(e)}catch(a){Pe(e,e.return,a)}}if(e===t){ue=null;break}if(n=e.sibling,n!==null){n.return=e.return,ue=n;break}ue=e.return}}function ql(t){for(;ue!==null;){var e=ue;if(e===t){ue=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ue=n;break}ue=e.return}}function Ql(t){for(;ue!==null;){var e=ue;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fs(4,e)}catch(s){Pe(e,n,s)}break;case 1:var c=e.stateNode;if(typeof c.componentDidMount=="function"){var p=e.return;try{c.componentDidMount()}catch(s){Pe(e,p,s)}}var y=e.return;try{Ba(e)}catch(s){Pe(e,y,s)}break;case 5:var w=e.return;try{Ba(e)}catch(s){Pe(e,w,s)}}}catch(s){Pe(e,e.return,s)}if(e===t){ue=null;break}var d=e.sibling;if(d!==null){d.return=e.return,ue=d;break}ue=e.return}}var ng=Math.ceil,Kr=Ft.ReactCurrentDispatcher,Do=Ft.ReactCurrentOwner,ct=Ft.ReactCurrentBatchConfig,pe=0,De=null,Oe=null,Le=0,Ze=0,Rn=sn(0),je=0,Wi=null,wn=0,gs=0,No=0,_i=null,$e=null,Lo=0,Jn=1/0,Et=null,qr=!1,Wa=null,Qt=null,mr=!1,Vt=null,Qr=0,Ti=0,Ha=null,Pr=-1,Er=0;function We(){return pe&6?Ee():Pr!==-1?Pr:Pr=Ee()}function Jt(t){return t.mode&1?pe&2&&Le!==0?Le&-Le:zf.transition!==null?(Er===0&&(Er=tu()),Er):(t=ve,t!==0||(t=window.event,t=t===void 0?16:lu(t.type)),t):1}function xt(t,e,n,c){if(50<Ti)throw Ti=0,Ha=null,Error(re(185));Yi(t,n,c),(!(pe&2)||t!==De)&&(t===De&&(!(pe&2)&&(gs|=n),je===4&&Wt(t,Le)),Je(t,c),n===1&&pe===0&&!(e.mode&1)&&(Jn=Ee()+500,us&&an()))}function Je(t,e){var n=t.callbackNode;Rd(t,e);var c=Dr(t,t===De?Le:0);if(c===0)n!==null&&al(n),t.callbackNode=null,t.callbackPriority=0;else if(e=c&-c,t.callbackPriority!==e){if(n!=null&&al(n),e===1)t.tag===0?Rf(Jl.bind(null,t)):Pu(Jl.bind(null,t)),Df(function(){!(pe&6)&&an()}),n=null;else{switch(nu(c)){case 1:n=oo;break;case 4:n=Zc;break;case 16:n=Mr;break;case 536870912:n=eu;break;default:n=Mr}n=Th(n,yh.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function yh(t,e){if(Pr=-1,Er=0,pe&6)throw Error(re(327));var n=t.callbackNode;if(Hn()&&t.callbackNode!==n)return null;var c=Dr(t,t===De?Le:0);if(c===0)return null;if(c&30||c&t.expiredLanes||e)e=Jr(t,c);else{e=c;var p=pe;pe|=2;var y=wh();(De!==t||Le!==e)&&(Et=null,Jn=Ee()+500,mn(t,e));do try{sg();break}catch(d){xh(t,d)}while(1);So(),Kr.current=y,pe=p,Oe!==null?e=0:(De=null,Le=0,e=je)}if(e!==0){if(e===2&&(p=va(t),p!==0&&(c=p,e=Va(t,p))),e===1)throw n=Wi,mn(t,0),Wt(t,c),Je(t,Ee()),n;if(e===6)Wt(t,c);else{if(p=t.current.alternate,!(c&30)&&!ig(p)&&(e=Jr(t,c),e===2&&(y=va(t),y!==0&&(c=y,e=Va(t,y))),e===1))throw n=Wi,mn(t,0),Wt(t,c),Je(t,Ee()),n;switch(t.finishedWork=p,t.finishedLanes=c,e){case 0:case 1:throw Error(re(345));case 2:cn(t,$e,Et);break;case 3:if(Wt(t,c),(c&130023424)===c&&(e=Lo+500-Ee(),10<e)){if(Dr(t,0)!==0)break;if(p=t.suspendedLanes,(p&c)!==c){We(),t.pingedLanes|=t.suspendedLanes&p;break}t.timeoutHandle=Ta(cn.bind(null,t,$e,Et),e);break}cn(t,$e,Et);break;case 4:if(Wt(t,c),(c&4194240)===c)break;for(e=t.eventTimes,p=-1;0<c;){var w=31-yt(c);y=1<<w,w=e[w],w>p&&(p=w),c&=~y}if(c=p,c=Ee()-c,c=(120>c?120:480>c?480:1080>c?1080:1920>c?1920:3e3>c?3e3:4320>c?4320:1960*ng(c/1960))-c,10<c){t.timeoutHandle=Ta(cn.bind(null,t,$e,Et),c);break}cn(t,$e,Et);break;case 5:cn(t,$e,Et);break;default:throw Error(re(329))}}}return Je(t,Ee()),t.callbackNode===n?yh.bind(null,t):null}function Va(t,e){var n=_i;return t.current.memoizedState.isDehydrated&&(mn(t,e).flags|=256),t=Jr(t,e),t!==2&&(e=$e,$e=n,e!==null&&Xa(e)),t}function Xa(t){$e===null?$e=t:$e.push.apply($e,t)}function ig(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var c=0;c<n.length;c++){var p=n[c],y=p.getSnapshot;p=p.value;try{if(!wt(y(),p))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Wt(t,e){for(e&=~No,e&=~gs,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-yt(e),c=1<<n;t[n]=-1,e&=~c}}function Jl(t){if(pe&6)throw Error(re(327));Hn();var e=Dr(t,0);if(!(e&1))return Je(t,Ee()),null;var n=Jr(t,e);if(t.tag!==0&&n===2){var c=va(t);c!==0&&(e=c,n=Va(t,c))}if(n===1)throw n=Wi,mn(t,0),Wt(t,e),Je(t,Ee()),n;if(n===6)throw Error(re(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,cn(t,$e,Et),Je(t,Ee()),null}function Fo(t,e){var n=pe;pe|=1;try{return t(e)}finally{pe=n,pe===0&&(Jn=Ee()+500,us&&an())}}function Sn(t){Vt!==null&&Vt.tag===0&&!(pe&6)&&Hn();var e=pe;pe|=1;var n=ct.transition,c=ve;try{if(ct.transition=null,ve=1,t)return t()}finally{ve=c,ct.transition=n,pe=e,!(pe&6)&&an()}}function Ro(){Ze=Rn.current,we(Rn)}function mn(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Mf(n)),Oe!==null)for(n=Oe.return;n!==null;){var c=n;switch(yo(c),c.tag){case 1:c=c.type.childContextTypes,c!=null&&zr();break;case 3:qn(),we(qe),we(Ue),Po();break;case 5:ko(c);break;case 4:qn();break;case 13:we(_e);break;case 19:we(_e);break;case 10:Co(c.type._context);break;case 22:case 23:Ro()}n=n.return}if(De=t,Oe=t=Zt(t.current,null),Le=Ze=e,je=0,Wi=null,No=gs=wn=0,$e=_i=null,fn!==null){for(e=0;e<fn.length;e++)if(n=fn[e],c=n.interleaved,c!==null){n.interleaved=null;var p=c.next,y=n.pending;if(y!==null){var w=y.next;y.next=p,c.next=w}n.pending=c}fn=null}return t}function xh(t,e){do{var n=Oe;try{if(So(),_r.current=$r,Yr){for(var c=Te.memoizedState;c!==null;){var p=c.queue;p!==null&&(p.pending=null),c=c.next}Yr=!1}if(xn=0,Me=Ie=Te=null,Ci=!1,Bi=0,Do.current=null,n===null||n.return===null){je=1,Wi=e,Oe=null;break}e:{var y=t,w=n.return,d=n,s=e;if(e=Le,d.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){var u=s,h=d,r=h.tag;if(!(h.mode&1)&&(r===0||r===11||r===15)){var a=h.alternate;a?(h.updateQueue=a.updateQueue,h.memoizedState=a.memoizedState,h.lanes=a.lanes):(h.updateQueue=null,h.memoizedState=null)}var i=zl(w);if(i!==null){i.flags&=-257,Bl(i,w,d,y,e),i.mode&1&&Rl(y,u,e),e=i,s=u;var o=e.updateQueue;if(o===null){var f=new Set;f.add(s),e.updateQueue=f}else o.add(s);break e}else{if(!(e&1)){Rl(y,u,e),zo();break e}s=Error(re(426))}}else if(be&&d.mode&1){var l=zl(w);if(l!==null){!(l.flags&65536)&&(l.flags|=256),Bl(l,w,d,y,e),xo(Qn(s,d));break e}}y=s=Qn(s,d),je!==4&&(je=2),_i===null?_i=[y]:_i.push(y),y=w;do{switch(y.tag){case 3:y.flags|=65536,e&=-e,y.lanes|=e;var g=nh(y,s,e);Al(y,g);break e;case 1:d=s;var m=y.type,v=y.stateNode;if(!(y.flags&128)&&(typeof m.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Qt===null||!Qt.has(v)))){y.flags|=65536,e&=-e,y.lanes|=e;var x=ih(y,d,e);Al(y,x);break e}}y=y.return}while(y!==null)}Ch(n)}catch(S){e=S,Oe===n&&n!==null&&(Oe=n=n.return);continue}break}while(1)}function wh(){var t=Kr.current;return Kr.current=$r,t===null?$r:t}function zo(){(je===0||je===3||je===2)&&(je=4),De===null||!(wn&268435455)&&!(gs&268435455)||Wt(De,Le)}function Jr(t,e){var n=pe;pe|=2;var c=wh();(De!==t||Le!==e)&&(Et=null,mn(t,e));do try{rg();break}catch(p){xh(t,p)}while(1);if(So(),pe=n,Kr.current=c,Oe!==null)throw Error(re(261));return De=null,Le=0,je}function rg(){for(;Oe!==null;)Sh(Oe)}function sg(){for(;Oe!==null&&!Od();)Sh(Oe)}function Sh(t){var e=_h(t.alternate,t,Ze);t.memoizedProps=t.pendingProps,e===null?Ch(t):Oe=e,Do.current=null}function Ch(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Jf(n,e),n!==null){n.flags&=32767,Oe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{je=6,Oe=null;return}}else if(n=Qf(n,e,Ze),n!==null){Oe=n;return}if(e=e.sibling,e!==null){Oe=e;return}Oe=e=t}while(e!==null);je===0&&(je=5)}function cn(t,e,n){var c=ve,p=ct.transition;try{ct.transition=null,ve=1,ag(t,e,n,c)}finally{ct.transition=p,ve=c}return null}function ag(t,e,n,c){do Hn();while(Vt!==null);if(pe&6)throw Error(re(327));n=t.finishedWork;var p=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(re(177));t.callbackNode=null,t.callbackPriority=0;var y=n.lanes|n.childLanes;if(zd(t,y),t===De&&(Oe=De=null,Le=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||mr||(mr=!0,Th(Mr,function(){return Hn(),null})),y=(n.flags&15990)!==0,n.subtreeFlags&15990||y){y=ct.transition,ct.transition=null;var w=ve;ve=1;var d=pe;pe|=4,Do.current=null,eg(t,n),ph(n,t),kf(ba),Nr=!!Ca,ba=Ca=null,t.current=n,tg(n),Id(),pe=d,ve=w,ct.transition=y}else t.current=n;if(mr&&(mr=!1,Vt=t,Qr=p),y=t.pendingLanes,y===0&&(Qt=null),Md(n.stateNode),Je(t,Ee()),e!==null)for(c=t.onRecoverableError,n=0;n<e.length;n++)p=e[n],c(p.value,{componentStack:p.stack,digest:p.digest});if(qr)throw qr=!1,t=Wa,Wa=null,t;return Qr&1&&t.tag!==0&&Hn(),y=t.pendingLanes,y&1?t===Ha?Ti++:(Ti=0,Ha=t):Ti=0,an(),null}function Hn(){if(Vt!==null){var t=nu(Qr),e=ct.transition,n=ve;try{if(ct.transition=null,ve=16>t?16:t,Vt===null)var c=!1;else{if(t=Vt,Vt=null,Qr=0,pe&6)throw Error(re(331));var p=pe;for(pe|=4,ue=t.current;ue!==null;){var y=ue,w=y.child;if(ue.flags&16){var d=y.deletions;if(d!==null){for(var s=0;s<d.length;s++){var u=d[s];for(ue=u;ue!==null;){var h=ue;switch(h.tag){case 0:case 11:case 15:bi(8,h,y)}var r=h.child;if(r!==null)r.return=h,ue=r;else for(;ue!==null;){h=ue;var a=h.sibling,i=h.return;if(fh(h),h===u){ue=null;break}if(a!==null){a.return=i,ue=a;break}ue=i}}}var o=y.alternate;if(o!==null){var f=o.child;if(f!==null){o.child=null;do{var l=f.sibling;f.sibling=null,f=l}while(f!==null)}}ue=y}}if(y.subtreeFlags&2064&&w!==null)w.return=y,ue=w;else e:for(;ue!==null;){if(y=ue,y.flags&2048)switch(y.tag){case 0:case 11:case 15:bi(9,y,y.return)}var g=y.sibling;if(g!==null){g.return=y.return,ue=g;break e}ue=y.return}}var m=t.current;for(ue=m;ue!==null;){w=ue;var v=w.child;if(w.subtreeFlags&2064&&v!==null)v.return=w,ue=v;else e:for(w=m;ue!==null;){if(d=ue,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:fs(9,d)}}catch(S){Pe(d,d.return,S)}if(d===w){ue=null;break e}var x=d.sibling;if(x!==null){x.return=d.return,ue=x;break e}ue=d.return}}if(pe=p,an(),_t&&typeof _t.onPostCommitFiberRoot=="function")try{_t.onPostCommitFiberRoot(ss,t)}catch{}c=!0}return c}finally{ve=n,ct.transition=e}}return!1}function Zl(t,e,n){e=Qn(n,e),e=nh(t,e,1),t=qt(t,e,1),e=We(),t!==null&&(Yi(t,1,e),Je(t,e))}function Pe(t,e,n){if(t.tag===3)Zl(t,t,n);else for(;e!==null;){if(e.tag===3){Zl(e,t,n);break}else if(e.tag===1){var c=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(Qt===null||!Qt.has(c))){t=Qn(n,t),t=ih(e,t,1),e=qt(e,t,1),t=We(),e!==null&&(Yi(e,1,t),Je(e,t));break}}e=e.return}}function og(t,e,n){var c=t.pingCache;c!==null&&c.delete(e),e=We(),t.pingedLanes|=t.suspendedLanes&n,De===t&&(Le&n)===n&&(je===4||je===3&&(Le&130023424)===Le&&500>Ee()-Lo?mn(t,0):No|=n),Je(t,e)}function bh(t,e){e===0&&(t.mode&1?(e=sr,sr<<=1,!(sr&130023424)&&(sr=4194304)):e=1);var n=We();t=Nt(t,e),t!==null&&(Yi(t,e,n),Je(t,n))}function lg(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),bh(t,n)}function cg(t,e){var n=0;switch(t.tag){case 13:var c=t.stateNode,p=t.memoizedState;p!==null&&(n=p.retryLane);break;case 19:c=t.stateNode;break;default:throw Error(re(314))}c!==null&&c.delete(e),bh(t,n)}var _h;_h=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||qe.current)Ke=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ke=!1,qf(t,e,n);Ke=!!(t.flags&131072)}else Ke=!1,be&&e.flags&1048576&&Eu(e,Gr,e.index);switch(e.lanes=0,e.tag){case 2:var c=e.type;kr(t,e),t=e.pendingProps;var p=Yn(e,Ue.current);Wn(e,n),p=Oo(null,e,c,t,p,n);var y=Io();return e.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Qe(c)?(y=!0,Br(e)):y=!1,e.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,_o(e),p.updater=ds,e.stateNode=p,p._reactInternals=e,Aa(e,c,t,n),e=Na(null,e,c,!0,y,n)):(e.tag=0,be&&y&&vo(e),Ge(null,e,p,n),e=e.child),e;case 16:c=e.elementType;e:{switch(kr(t,e),t=e.pendingProps,p=c._init,c=p(c._payload),e.type=c,p=e.tag=hg(c),t=mt(c,t),p){case 0:e=Da(null,e,c,t,n);break e;case 1:e=Wl(null,e,c,t,n);break e;case 11:e=Ul(null,e,c,t,n);break e;case 14:e=Gl(null,e,c,mt(c.type,t),n);break e}throw Error(re(306,c,""))}return e;case 0:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),Da(t,e,c,p,n);case 1:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),Wl(t,e,c,p,n);case 3:e:{if(oh(e),t===null)throw Error(re(387));c=e.pendingProps,y=e.memoizedState,p=y.element,Du(t,e),Vr(e,c,null,n);var w=e.memoizedState;if(c=w.element,y.isDehydrated)if(y={element:c,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},e.updateQueue.baseState=y,e.memoizedState=y,e.flags&256){p=Qn(Error(re(423)),e),e=Hl(t,e,c,n,p);break e}else if(c!==p){p=Qn(Error(re(424)),e),e=Hl(t,e,c,n,p);break e}else for(et=Kt(e.stateNode.containerInfo.firstChild),tt=e,be=!0,vt=null,n=Au(e,null,c,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if($n(),c===p){e=Lt(t,e,n);break e}Ge(t,e,c,n)}e=e.child}return e;case 5:return Nu(e),t===null&&Oa(e),c=e.type,p=e.pendingProps,y=t!==null?t.memoizedProps:null,w=p.children,_a(c,p)?w=null:y!==null&&_a(c,y)&&(e.flags|=32),ah(t,e),Ge(t,e,w,n),e.child;case 6:return t===null&&Oa(e),null;case 13:return lh(t,e,n);case 4:return To(e,e.stateNode.containerInfo),c=e.pendingProps,t===null?e.child=Kn(e,null,c,n):Ge(t,e,c,n),e.child;case 11:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),Ul(t,e,c,p,n);case 7:return Ge(t,e,e.pendingProps,n),e.child;case 8:return Ge(t,e,e.pendingProps.children,n),e.child;case 12:return Ge(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(c=e.type._context,p=e.pendingProps,y=e.memoizedProps,w=p.value,ye(Wr,c._currentValue),c._currentValue=w,y!==null)if(wt(y.value,w)){if(y.children===p.children&&!qe.current){e=Lt(t,e,n);break e}}else for(y=e.child,y!==null&&(y.return=e);y!==null;){var d=y.dependencies;if(d!==null){w=y.child;for(var s=d.firstContext;s!==null;){if(s.context===c){if(y.tag===1){s=At(-1,n&-n),s.tag=2;var u=y.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?s.next=s:(s.next=h.next,h.next=s),u.pending=s}}y.lanes|=n,s=y.alternate,s!==null&&(s.lanes|=n),Ia(y.return,n,e),d.lanes|=n;break}s=s.next}}else if(y.tag===10)w=y.type===e.type?null:y.child;else if(y.tag===18){if(w=y.return,w===null)throw Error(re(341));w.lanes|=n,d=w.alternate,d!==null&&(d.lanes|=n),Ia(w,n,e),w=y.sibling}else w=y.child;if(w!==null)w.return=y;else for(w=y;w!==null;){if(w===e){w=null;break}if(y=w.sibling,y!==null){y.return=w.return,w=y;break}w=w.return}y=w}Ge(t,e,p.children,n),e=e.child}return e;case 9:return p=e.type,c=e.pendingProps.children,Wn(e,n),p=ut(p),c=c(p),e.flags|=1,Ge(t,e,c,n),e.child;case 14:return c=e.type,p=mt(c,e.pendingProps),p=mt(c.type,p),Gl(t,e,c,p,n);case 15:return rh(t,e,e.type,e.pendingProps,n);case 17:return c=e.type,p=e.pendingProps,p=e.elementType===c?p:mt(c,p),kr(t,e),e.tag=1,Qe(c)?(t=!0,Br(e)):t=!1,Wn(e,n),th(e,c,p),Aa(e,c,p,n),Na(null,e,c,!0,t,n);case 19:return ch(t,e,n);case 22:return sh(t,e,n)}throw Error(re(156,e.tag))};function Th(t,e){return Jc(t,e)}function ug(t,e,n,c){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function lt(t,e,n,c){return new ug(t,e,n,c)}function Bo(t){return t=t.prototype,!(!t||!t.isReactComponent)}function hg(t){if(typeof t=="function")return Bo(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ro)return 11;if(t===so)return 14}return 2}function Zt(t,e){var n=t.alternate;return n===null?(n=lt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Or(t,e,n,c,p,y){var w=2;if(c=t,typeof t=="function")Bo(t)&&(w=1);else if(typeof t=="string")w=5;else e:switch(t){case En:return pn(n.children,p,y,e);case io:w=8,p|=8;break;case na:return t=lt(12,n,e,p|2),t.elementType=na,t.lanes=y,t;case ia:return t=lt(13,n,e,p),t.elementType=ia,t.lanes=y,t;case ra:return t=lt(19,n,e,p),t.elementType=ra,t.lanes=y,t;case Nc:return ms(n,p,y,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Mc:w=10;break e;case Dc:w=9;break e;case ro:w=11;break e;case so:w=14;break e;case Bt:w=16,c=null;break e}throw Error(re(130,t==null?t:typeof t,""))}return e=lt(w,n,e,p),e.elementType=t,e.type=c,e.lanes=y,e}function pn(t,e,n,c){return t=lt(7,t,c,e),t.lanes=n,t}function ms(t,e,n,c){return t=lt(22,t,c,e),t.elementType=Nc,t.lanes=n,t.stateNode={isHidden:!1},t}function $s(t,e,n){return t=lt(6,t,null,e),t.lanes=n,t}function Ks(t,e,n){return e=lt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function dg(t,e,n,c,p){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Os(0),this.expirationTimes=Os(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Os(0),this.identifierPrefix=c,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function Uo(t,e,n,c,p,y,w,d,s){return t=new dg(t,e,n,d,s),e===1?(e=1,y===!0&&(e|=8)):e=0,y=lt(3,null,null,e),t.current=y,y.stateNode=t,y.memoizedState={element:c,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},_o(y),t}function fg(t,e,n){var c=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pn,key:c==null?null:""+c,children:t,containerInfo:e,implementation:n}}function kh(t){if(!t)return nn;t=t._reactInternals;e:{if(bn(t)!==t||t.tag!==1)throw Error(re(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(re(171))}if(t.tag===1){var n=t.type;if(Qe(n))return ku(t,n,e)}return e}function Ph(t,e,n,c,p,y,w,d,s){return t=Uo(n,c,!0,t,p,y,w,d,s),t.context=kh(null),n=t.current,c=We(),p=Jt(n),y=At(c,p),y.callback=e??null,qt(n,y,p),t.current.lanes=p,Yi(t,p,c),Je(t,c),t}function ps(t,e,n,c){var p=e.current,y=We(),w=Jt(p);return n=kh(n),e.context===null?e.context=n:e.pendingContext=n,e=At(y,w),e.payload={element:t},c=c===void 0?null:c,c!==null&&(e.callback=c),t=qt(p,e,w),t!==null&&(xt(t,p,w,y),br(t,p,w)),w}function Zr(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function ec(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Go(t,e){ec(t,e),(t=t.alternate)&&ec(t,e)}function gg(){return null}var Eh=typeof reportError=="function"?reportError:function(t){console.error(t)};function Wo(t){this._internalRoot=t}vs.prototype.render=Wo.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(re(409));ps(t,e,null,null)};vs.prototype.unmount=Wo.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Sn(function(){ps(null,t,null,null)}),e[Dt]=null}};function vs(t){this._internalRoot=t}vs.prototype.unstable_scheduleHydration=function(t){if(t){var e=su();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Gt.length&&e!==0&&e<Gt[n].priority;n++);Gt.splice(n,0,t),n===0&&ou(t)}};function Ho(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ys(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function tc(){}function mg(t,e,n,c,p){if(p){if(typeof c=="function"){var y=c;c=function(){var u=Zr(w);y.call(u)}}var w=Ph(e,c,t,0,null,!1,!1,"",tc);return t._reactRootContainer=w,t[Dt]=w.current,Ni(t.nodeType===8?t.parentNode:t),Sn(),w}for(;p=t.lastChild;)t.removeChild(p);if(typeof c=="function"){var d=c;c=function(){var u=Zr(s);d.call(u)}}var s=Uo(t,0,!1,null,null,!1,!1,"",tc);return t._reactRootContainer=s,t[Dt]=s.current,Ni(t.nodeType===8?t.parentNode:t),Sn(function(){ps(e,s,n,c)}),s}function xs(t,e,n,c,p){var y=n._reactRootContainer;if(y){var w=y;if(typeof p=="function"){var d=p;p=function(){var s=Zr(w);d.call(s)}}ps(e,w,t,p)}else w=mg(n,e,t,p,c);return Zr(w)}iu=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=mi(e.pendingLanes);n!==0&&(lo(e,n|1),Je(e,Ee()),!(pe&6)&&(Jn=Ee()+500,an()))}break;case 13:Sn(function(){var c=Nt(t,1);if(c!==null){var p=We();xt(c,t,1,p)}}),Go(t,1)}};co=function(t){if(t.tag===13){var e=Nt(t,134217728);if(e!==null){var n=We();xt(e,t,134217728,n)}Go(t,134217728)}};ru=function(t){if(t.tag===13){var e=Jt(t),n=Nt(t,e);if(n!==null){var c=We();xt(n,t,e,c)}Go(t,e)}};su=function(){return ve};au=function(t,e){var n=ve;try{return ve=t,e()}finally{ve=n}};ga=function(t,e,n){switch(e){case"input":if(oa(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var c=n[e];if(c!==t&&c.form===t.form){var p=cs(c);if(!p)throw Error(re(90));Fc(c),oa(c,p)}}}break;case"textarea":zc(t,n);break;case"select":e=n.value,e!=null&&zn(t,!!n.multiple,e,!1)}};Xc=Fo;Yc=Sn;var pg={usingClientEntryPoint:!1,Events:[Ki,An,cs,Hc,Vc,Fo]},di={findFiberByHostInstance:dn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},vg={bundleType:di.bundleType,version:di.version,rendererPackageName:di.rendererPackageName,rendererConfig:di.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ft.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=qc(t),t===null?null:t.stateNode},findFiberByHostInstance:di.findFiberByHostInstance||gg,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pr.isDisabled&&pr.supportsFiber)try{ss=pr.inject(vg),_t=pr}catch{}}it.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=pg;it.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ho(e))throw Error(re(200));return fg(t,e,null,n)};it.createRoot=function(t,e){if(!Ho(t))throw Error(re(299));var n=!1,c="",p=Eh;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(c=e.identifierPrefix),e.onRecoverableError!==void 0&&(p=e.onRecoverableError)),e=Uo(t,1,!1,null,null,n,!1,c,p),t[Dt]=e.current,Ni(t.nodeType===8?t.parentNode:t),new Wo(e)};it.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(re(188)):(t=Object.keys(t).join(","),Error(re(268,t)));return t=qc(e),t=t===null?null:t.stateNode,t};it.flushSync=function(t){return Sn(t)};it.hydrate=function(t,e,n){if(!ys(e))throw Error(re(200));return xs(null,t,e,!0,n)};it.hydrateRoot=function(t,e,n){if(!Ho(t))throw Error(re(405));var c=n!=null&&n.hydratedSources||null,p=!1,y="",w=Eh;if(n!=null&&(n.unstable_strictMode===!0&&(p=!0),n.identifierPrefix!==void 0&&(y=n.identifierPrefix),n.onRecoverableError!==void 0&&(w=n.onRecoverableError)),e=Ph(e,null,t,1,n??null,p,!1,y,w),t[Dt]=e.current,Ni(t),c)for(t=0;t<c.length;t++)n=c[t],p=n._getVersion,p=p(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,p]:e.mutableSourceEagerHydrationData.push(n,p);return new vs(e)};it.render=function(t,e,n){if(!ys(e))throw Error(re(200));return xs(null,t,e,!1,n)};it.unmountComponentAtNode=function(t){if(!ys(t))throw Error(re(40));return t._reactRootContainer?(Sn(function(){xs(null,null,t,!1,function(){t._reactRootContainer=null,t[Dt]=null})}),!0):!1};it.unstable_batchedUpdates=Fo;it.unstable_renderSubtreeIntoContainer=function(t,e,n,c){if(!ys(n))throw Error(re(200));if(t==null||t._reactInternals===void 0)throw Error(re(38));return xs(t,e,n,!1,c)};it.version="18.3.1-next-f1338f8080-20240426";function Oh(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Oh)}catch(t){console.error(t)}}Oh(),Oc.exports=it;var yg=Oc.exports,nc=yg;ea.createRoot=nc.createRoot,ea.hydrateRoot=nc.hydrateRoot;var xg={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const wg=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Sg=(t,e)=>{const n=fe.forwardRef(({color:c="currentColor",size:p=24,strokeWidth:y=2,absoluteStrokeWidth:w,children:d,...s},u)=>fe.createElement("svg",{ref:u,...xg,width:p,height:p,stroke:c,strokeWidth:w?Number(y)*24/Number(p):y,className:`lucide lucide-${wg(t)}`,...s},[...e.map(([h,r])=>fe.createElement(h,r)),...(Array.isArray(d)?d:[d])||[]]));return n.displayName=`${t}`,n};var ge=Sg;const Cg=ge("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),qs=ge("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),es=ge("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),Ih=ge("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]),bg=ge("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),_g=ge("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Tg=ge("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),kg=ge("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Pg=ge("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Eg=ge("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Og=ge("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),Ig=ge("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),jh=ge("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),jg=ge("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),Ag=ge("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ah=ge("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Mg=ge("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),ic=ge("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),Dg=ge("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Ng=ge("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Ya=ge("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Lg=ge("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Fg=ge("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Rg=ge("Mouse",[["rect",{x:"5",y:"2",width:"14",height:"20",rx:"7",key:"11ol66"}],["path",{d:"M12 6v4",key:"16clxf"}]]),Mh=ge("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),rc=ge("PanelRightClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]),sc=ge("PanelRightOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]),Dh=ge("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),zg=ge("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),ac=ge("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),Bg=ge("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),Ug=ge("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]),Gg=ge("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Zn=ge("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),ts=ge("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Wg=ge("Shuffle",[["path",{d:"M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22",key:"1wmou1"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 6h1.9c1.5 0 2.9.9 3.6 2.2",key:"10bdb2"}],["path",{d:"M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8",key:"vgxac0"}],["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}]]),en=ge("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),Hg=ge("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Nh=ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Vg=ge("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),Lh=ge("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),ns=ge("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),is=ge("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),oc=ge("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);var Ae={};const Xg={},Yg=Object.freeze(Object.defineProperty({__proto__:null,default:Xg},Symbol.toStringTag,{value:"Module"})),Qs=Vh(Yg);(function(t){/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */var e=e||{version:"5.5.2"};if(t.fabric=e,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?e.document=document:e.document=document.implementation.createHTMLDocument(""),e.window=window;else{var n=Qs,c=new n.JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;e.document=c.document,e.jsdomImplForWrapper=Qs.implForWrapper,e.nodeCanvas=Qs.Canvas,e.window=c,DOMParser=e.window.DOMParser}e.isTouchSupported="ontouchstart"in e.window||"ontouchstart"in e.document||e.window&&e.window.navigator&&e.window.navigator.maxTouchPoints>0,e.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",e.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],e.DPI=96,e.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",e.commaWsp="(?:\\s+,?\\s*|,\\s*)",e.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/ig,e.reNonWord=/[ \n\.,;!\?\-]/,e.fontPaths={},e.iMatrix=[1,0,0,1,0,0],e.svgNS="http://www.w3.org/2000/svg",e.perfLimitSizeTotal=2097152,e.maxCacheSideLimit=4096,e.minCacheSideLimit=256,e.charWidthsCache={},e.textureSize=2048,e.disableStyleCopyPaste=!1,e.enableGLFiltering=!0,e.devicePixelRatio=e.window.devicePixelRatio||e.window.webkitDevicePixelRatio||e.window.mozDevicePixelRatio||1,e.browserShadowBlurConstant=1,e.arcToSegmentsCache={},e.boundsOfCurveCache={},e.cachesBoundsOfCurve=!0,e.forceGLPutImageData=!1,e.initFilterBackend=function(){if(e.enableGLFiltering&&e.isWebglSupported&&e.isWebglSupported(e.textureSize))return console.log("max texture size: "+e.maxTextureSize),new e.WebglFilterBackend({tileSize:e.textureSize});if(e.Canvas2dFilterBackend)return new e.Canvas2dFilterBackend},typeof document<"u"&&typeof window<"u"&&(window.fabric=e),function(){function d(i,o){if(this.__eventListeners[i]){var f=this.__eventListeners[i];o?f[f.indexOf(o)]=!1:e.util.array.fill(f,!1)}}function s(i,o){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var f in i)this.on(f,i[f]);else this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(o);return this}function u(i,o){var f=(function(){o.apply(this,arguments),this.off(i,f)}).bind(this);this.on(i,f)}function h(i,o){if(arguments.length===1)for(var f in i)u.call(this,f,i[f]);else u.call(this,i,o);return this}function r(i,o){if(!this.__eventListeners)return this;if(arguments.length===0)for(i in this.__eventListeners)d.call(this,i);else if(arguments.length===1&&typeof arguments[0]=="object")for(var f in i)d.call(this,f,i[f]);else d.call(this,i,o);return this}function a(i,o){if(!this.__eventListeners)return this;var f=this.__eventListeners[i];if(!f)return this;for(var l=0,g=f.length;l<g;l++)f[l]&&f[l].call(this,o||{});return this.__eventListeners[i]=f.filter(function(m){return m!==!1}),this}e.Observable={fire:a,on:s,once:h,off:r}}(),e.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var d=0,s=arguments.length;d<s;d++)this._onObjectAdded(arguments[d]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(d,s,u){var h=this._objects;return u?h[s]=d:h.splice(s,0,d),this._onObjectAdded&&this._onObjectAdded(d),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var d=this._objects,s,u=!1,h=0,r=arguments.length;h<r;h++)s=d.indexOf(arguments[h]),s!==-1&&(u=!0,d.splice(s,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[h]));return this.renderOnAddRemove&&u&&this.requestRenderAll(),this},forEachObject:function(d,s){for(var u=this.getObjects(),h=0,r=u.length;h<r;h++)d.call(s,u[h],h,u);return this},getObjects:function(d){return typeof d>"u"?this._objects.concat():this._objects.filter(function(s){return s.type===d})},item:function(d){return this._objects[d]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(d,s){return this._objects.indexOf(d)>-1?!0:s?this._objects.some(function(u){return typeof u.contains=="function"&&u.contains(d,!0)}):!1},complexity:function(){return this._objects.reduce(function(d,s){return d+=s.complexity?s.complexity():0,d},0)}},e.CommonMethods={_setOptions:function(d){for(var s in d)this.set(s,d[s])},_initGradient:function(d,s){d&&d.colorStops&&!(d instanceof e.Gradient)&&this.set(s,new e.Gradient(d))},_initPattern:function(d,s,u){d&&d.source&&!(d instanceof e.Pattern)?this.set(s,new e.Pattern(d,u)):u&&u()},_setObject:function(d){for(var s in d)this._set(s,d[s])},set:function(d,s){return typeof d=="object"?this._setObject(d):this._set(d,s),this},_set:function(d,s){this[d]=s},toggle:function(d){var s=this.get(d);return typeof s=="boolean"&&this.set(d,!s),this},get:function(d){return this[d]}},function(d){var s=Math.sqrt,u=Math.atan2,h=Math.pow,r=Math.PI/180,a=Math.PI/2;e.util={cos:function(i){if(i===0)return 1;i<0&&(i=-i);var o=i/a;switch(o){case 1:case 3:return 0;case 2:return-1}return Math.cos(i)},sin:function(i){if(i===0)return 0;var o=i/a,f=1;switch(i<0&&(f=-1),o){case 1:return f;case 2:return 0;case 3:return-f}return Math.sin(i)},removeFromArray:function(i,o){var f=i.indexOf(o);return f!==-1&&i.splice(f,1),i},getRandomInt:function(i,o){return Math.floor(Math.random()*(o-i+1))+i},degreesToRadians:function(i){return i*r},radiansToDegrees:function(i){return i/r},rotatePoint:function(i,o,f){var l=new e.Point(i.x-o.x,i.y-o.y),g=e.util.rotateVector(l,f);return new e.Point(g.x,g.y).addEquals(o)},rotateVector:function(i,o){var f=e.util.sin(o),l=e.util.cos(o),g=i.x*l-i.y*f,m=i.x*f+i.y*l;return{x:g,y:m}},createVector:function(i,o){return new e.Point(o.x-i.x,o.y-i.y)},calcAngleBetweenVectors:function(i,o){return Math.acos((i.x*o.x+i.y*o.y)/(Math.hypot(i.x,i.y)*Math.hypot(o.x,o.y)))},getHatVector:function(i){return new e.Point(i.x,i.y).multiply(1/Math.hypot(i.x,i.y))},getBisector:function(i,o,f){var l=e.util.createVector(i,o),g=e.util.createVector(i,f),m=e.util.calcAngleBetweenVectors(l,g),v=e.util.calcAngleBetweenVectors(e.util.rotateVector(l,m),g),x=m*(v===0?1:-1)/2;return{vector:e.util.getHatVector(e.util.rotateVector(l,x)),angle:m}},projectStrokeOnPoints:function(i,o,f){var l=[],g=o.strokeWidth/2,m=o.strokeUniform?new e.Point(1/o.scaleX,1/o.scaleY):new e.Point(1,1),v=function(x){var S=g/Math.hypot(x.x,x.y);return new e.Point(x.x*S*m.x,x.y*S*m.y)};return i.length<=1||i.forEach(function(x,S){var b=new e.Point(x.x,x.y),T,E;S===0?(E=i[S+1],T=f?v(e.util.createVector(E,b)).addEquals(b):i[i.length-1]):S===i.length-1?(T=i[S-1],E=f?v(e.util.createVector(T,b)).addEquals(b):i[0]):(T=i[S-1],E=i[S+1]);var N=e.util.getBisector(b,T,E),L=N.vector,G=N.angle,Q,Z;if(o.strokeLineJoin==="miter"&&(Q=-g/Math.sin(G/2),Z=new e.Point(L.x*Q*m.x,L.y*Q*m.y),Math.hypot(Z.x,Z.y)/g<=o.strokeMiterLimit)){l.push(b.add(Z)),l.push(b.subtract(Z));return}Q=-g*Math.SQRT2,Z=new e.Point(L.x*Q*m.x,L.y*Q*m.y),l.push(b.add(Z)),l.push(b.subtract(Z))}),l},transformPoint:function(i,o,f){return f?new e.Point(o[0]*i.x+o[2]*i.y,o[1]*i.x+o[3]*i.y):new e.Point(o[0]*i.x+o[2]*i.y+o[4],o[1]*i.x+o[3]*i.y+o[5])},makeBoundingBoxFromPoints:function(i,o){if(o)for(var f=0;f<i.length;f++)i[f]=e.util.transformPoint(i[f],o);var l=[i[0].x,i[1].x,i[2].x,i[3].x],g=e.util.array.min(l),m=e.util.array.max(l),v=m-g,x=[i[0].y,i[1].y,i[2].y,i[3].y],S=e.util.array.min(x),b=e.util.array.max(x),T=b-S;return{left:g,top:S,width:v,height:T}},invertTransform:function(i){var o=1/(i[0]*i[3]-i[1]*i[2]),f=[o*i[3],-o*i[1],-o*i[2],o*i[0]],l=e.util.transformPoint({x:i[4],y:i[5]},f,!0);return f[4]=-l.x,f[5]=-l.y,f},toFixed:function(i,o){return parseFloat(Number(i).toFixed(o))},parseUnit:function(i,o){var f=/\D{0,2}$/.exec(i),l=parseFloat(i);switch(o||(o=e.Text.DEFAULT_SVG_FONT_SIZE),f[0]){case"mm":return l*e.DPI/25.4;case"cm":return l*e.DPI/2.54;case"in":return l*e.DPI;case"pt":return l*e.DPI/72;case"pc":return l*e.DPI/72*12;case"em":return l*o;default:return l}},falseFunction:function(){return!1},getKlass:function(i,o){return i=e.util.string.camelize(i.charAt(0).toUpperCase()+i.slice(1)),e.util.resolveNamespace(o)[i]},getSvgAttributes:function(i){var o=["instantiated_by_use","style","id","class"];switch(i){case"linearGradient":o=o.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":o=o.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":o=o.concat(["offset","stop-color","stop-opacity"]);break}return o},resolveNamespace:function(i){if(!i)return e;var o=i.split("."),f=o.length,l,g=d||e.window;for(l=0;l<f;++l)g=g[o[l]];return g},loadImage:function(i,o,f,l){if(!i){o&&o.call(f,i);return}var g=e.util.createImage(),m=function(){o&&o.call(f,g,!1),g=g.onload=g.onerror=null};g.onload=m,g.onerror=function(){e.log("Error loading "+g.src),o&&o.call(f,null,!0),g=g.onload=g.onerror=null},i.indexOf("data")!==0&&l!==void 0&&l!==null&&(g.crossOrigin=l),i.substring(0,14)==="data:image/svg"&&(g.onload=null,e.util.loadImageInDom(g,m)),g.src=i},loadImageInDom:function(i,o){var f=e.document.createElement("div");f.style.width=f.style.height="1px",f.style.left=f.style.top="-100%",f.style.position="absolute",f.appendChild(i),e.document.querySelector("body").appendChild(f),i.onload=function(){o(),f.parentNode.removeChild(f),f=null}},enlivenObjects:function(i,o,f,l){i=i||[];var g=[],m=0,v=i.length;function x(){++m===v&&o&&o(g.filter(function(S){return S}))}if(!v){o&&o(g);return}i.forEach(function(S,b){if(!S||!S.type){x();return}var T=e.util.getKlass(S.type,f);T.fromObject(S,function(E,N){N||(g[b]=E),l&&l(S,E,N),x()})})},enlivenObjectEnlivables:function(i,o,f){var l=e.Object.ENLIVEN_PROPS.filter(function(g){return!!i[g]});e.util.enlivenObjects(l.map(function(g){return i[g]}),function(g){var m={};l.forEach(function(v,x){m[v]=g[x],o&&(o[v]=g[x])}),f&&f(m)})},enlivenPatterns:function(i,o){i=i||[];function f(){++g===m&&o&&o(l)}var l=[],g=0,m=i.length;if(!m){o&&o(l);return}i.forEach(function(v,x){v&&v.source?new e.Pattern(v,function(S){l[x]=S,f()}):(l[x]=v,f())})},groupSVGElements:function(i,o,f){var l;return i&&i.length===1?(typeof f<"u"&&(i[0].sourcePath=f),i[0]):(o&&(o.width&&o.height?o.centerPoint={x:o.width/2,y:o.height/2}:(delete o.width,delete o.height)),l=new e.Group(i,o),typeof f<"u"&&(l.sourcePath=f),l)},populateWithProperties:function(i,o,f){if(f&&Array.isArray(f))for(var l=0,g=f.length;l<g;l++)f[l]in i&&(o[f[l]]=i[f[l]])},createCanvasElement:function(){return e.document.createElement("canvas")},copyCanvasElement:function(i){var o=e.util.createCanvasElement();return o.width=i.width,o.height=i.height,o.getContext("2d").drawImage(i,0,0),o},toDataURL:function(i,o,f){return i.toDataURL("image/"+o,f)},createImage:function(){return e.document.createElement("img")},multiplyTransformMatrices:function(i,o,f){return[i[0]*o[0]+i[2]*o[1],i[1]*o[0]+i[3]*o[1],i[0]*o[2]+i[2]*o[3],i[1]*o[2]+i[3]*o[3],f?0:i[0]*o[4]+i[2]*o[5]+i[4],f?0:i[1]*o[4]+i[3]*o[5]+i[5]]},qrDecompose:function(i){var o=u(i[1],i[0]),f=h(i[0],2)+h(i[1],2),l=s(f),g=(i[0]*i[3]-i[2]*i[1])/l,m=u(i[0]*i[2]+i[1]*i[3],f);return{angle:o/r,scaleX:l,scaleY:g,skewX:m/r,skewY:0,translateX:i[4],translateY:i[5]}},calcRotateMatrix:function(i){if(!i.angle)return e.iMatrix.concat();var o=e.util.degreesToRadians(i.angle),f=e.util.cos(o),l=e.util.sin(o);return[f,l,-l,f,0,0]},calcDimensionsMatrix:function(i){var o=typeof i.scaleX>"u"?1:i.scaleX,f=typeof i.scaleY>"u"?1:i.scaleY,l=[i.flipX?-o:o,0,0,i.flipY?-f:f,0,0],g=e.util.multiplyTransformMatrices,m=e.util.degreesToRadians;return i.skewX&&(l=g(l,[1,0,Math.tan(m(i.skewX)),1],!0)),i.skewY&&(l=g(l,[1,Math.tan(m(i.skewY)),0,1],!0)),l},composeMatrix:function(i){var o=[1,0,0,1,i.translateX||0,i.translateY||0],f=e.util.multiplyTransformMatrices;return i.angle&&(o=f(o,e.util.calcRotateMatrix(i))),(i.scaleX!==1||i.scaleY!==1||i.skewX||i.skewY||i.flipX||i.flipY)&&(o=f(o,e.util.calcDimensionsMatrix(i))),o},resetObjectTransform:function(i){i.scaleX=1,i.scaleY=1,i.skewX=0,i.skewY=0,i.flipX=!1,i.flipY=!1,i.rotate(0)},saveObjectTransform:function(i){return{scaleX:i.scaleX,scaleY:i.scaleY,skewX:i.skewX,skewY:i.skewY,angle:i.angle,left:i.left,flipX:i.flipX,flipY:i.flipY,top:i.top}},isTransparent:function(i,o,f,l){l>0&&(o>l?o-=l:o=0,f>l?f-=l:f=0);var g=!0,m,v,x=i.getImageData(o,f,l*2||1,l*2||1),S=x.data.length;for(m=3;m<S&&(v=x.data[m],g=v<=0,g!==!1);m+=4);return x=null,g},parsePreserveAspectRatioAttribute:function(i){var o="meet",f="Mid",l="Mid",g=i.split(" "),m;return g&&g.length&&(o=g.pop(),o!=="meet"&&o!=="slice"?(m=o,o="meet"):g.length&&(m=g.pop())),f=m!=="none"?m.slice(1,4):"none",l=m!=="none"?m.slice(5,8):"none",{meetOrSlice:o,alignX:f,alignY:l}},clearFabricFontCache:function(i){i=(i||"").toLowerCase(),i?e.charWidthsCache[i]&&delete e.charWidthsCache[i]:e.charWidthsCache={}},limitDimsByArea:function(i,o){var f=Math.sqrt(o*i),l=Math.floor(o/f);return{x:Math.floor(f),y:l}},capValue:function(i,o,f){return Math.max(i,Math.min(o,f))},findScaleToFit:function(i,o){return Math.min(o.width/i.width,o.height/i.height)},findScaleToCover:function(i,o){return Math.max(o.width/i.width,o.height/i.height)},matrixToSVG:function(i){return"matrix("+i.map(function(o){return e.util.toFixed(o,e.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(i,o){var f=e.util.invertTransform(o),l=e.util.multiplyTransformMatrices(f,i.calcOwnMatrix());e.util.applyTransformToObject(i,l)},addTransformToObject:function(i,o){e.util.applyTransformToObject(i,e.util.multiplyTransformMatrices(o,i.calcOwnMatrix()))},applyTransformToObject:function(i,o){var f=e.util.qrDecompose(o),l=new e.Point(f.translateX,f.translateY);i.flipX=!1,i.flipY=!1,i.set("scaleX",f.scaleX),i.set("scaleY",f.scaleY),i.skewX=f.skewX,i.skewY=f.skewY,i.angle=f.angle,i.setPositionByOrigin(l,"center","center")},sizeAfterTransform:function(i,o,f){var l=i/2,g=o/2,m=[{x:-l,y:-g},{x:l,y:-g},{x:-l,y:g},{x:l,y:g}],v=e.util.calcDimensionsMatrix(f),x=e.util.makeBoundingBoxFromPoints(m,v);return{x:x.width,y:x.height}},mergeClipPaths:function(i,o){var f=i,l=o;f.inverted&&!l.inverted&&(f=o,l=i),e.util.applyTransformToObject(l,e.util.multiplyTransformMatrices(e.util.invertTransform(f.calcTransformMatrix()),l.calcTransformMatrix()));var g=f.inverted&&l.inverted;return g&&(f.inverted=l.inverted=!1),new e.Group([f],{clipPath:l,inverted:g})},hasStyleChanged:function(i,o,f){return f=f||!1,i.fill!==o.fill||i.stroke!==o.stroke||i.strokeWidth!==o.strokeWidth||i.fontSize!==o.fontSize||i.fontFamily!==o.fontFamily||i.fontWeight!==o.fontWeight||i.fontStyle!==o.fontStyle||i.textBackgroundColor!==o.textBackgroundColor||i.deltaY!==o.deltaY||f&&(i.overline!==o.overline||i.underline!==o.underline||i.linethrough!==o.linethrough)},stylesToArray:function(f,o){for(var f=e.util.object.clone(f,!0),l=o.split(`
`),g=-1,m={},v=[],x=0;x<l.length;x++){if(!f[x]){g+=l[x].length;continue}for(var S=0;S<l[x].length;S++){g++;var b=f[x][S];if(b&&Object.keys(b).length>0){var T=e.util.hasStyleChanged(m,b,!0);T?v.push({start:g,end:g+1,style:b}):v[v.length-1].end++}m=b||{}}}return v},stylesFromArray:function(i,o){if(!Array.isArray(i))return i;for(var f=o.split(`
`),l=-1,g=0,m={},v=0;v<f.length;v++)for(var x=0;x<f[v].length;x++)l++,i[g]&&i[g].start<=l&&l<i[g].end&&(m[v]=m[v]||{},m[v][x]=Object.assign({},i[g].style),l===i[g].end-1&&g++);return m}}}(t),function(){var d=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},u={m:"l",M:"L"};function h(_,O,A,M,B,P,k,D,F,X,W){var $=e.util.cos(_),q=e.util.sin(_),oe=e.util.cos(O),I=e.util.sin(O),j=A*B*oe-M*P*I+k,R=M*B*oe+A*P*I+D,U=X+F*(-A*B*q-M*P*$),z=W+F*(-M*B*q+A*P*$),H=j+F*(A*B*I+M*P*oe),ee=R+F*(M*B*I-A*P*oe);return["C",U,z,H,ee,j,R]}function r(_,O,A,M,B,P,k){var D=Math.PI,F=k*D/180,X=e.util.sin(F),W=e.util.cos(F),$=0,q=0;A=Math.abs(A),M=Math.abs(M);var oe=-W*_*.5-X*O*.5,I=-W*O*.5+X*_*.5,j=A*A,R=M*M,U=I*I,z=oe*oe,H=j*R-j*U-R*z,ee=0;if(H<0){var ae=Math.sqrt(1-H/(j*R));A*=ae,M*=ae}else ee=(B===P?-1:1)*Math.sqrt(H/(j*U+R*z));var se=ee*A*I/M,V=-ee*M*oe/A,ce=W*se-X*V+_*.5,J=X*se+W*V+O*.5,ie=a(1,0,(oe-se)/A,(I-V)/M),he=a((oe-se)/A,(I-V)/M,(-oe-se)/A,(-I-V)/M);P===0&&he>0?he-=2*D:P===1&&he<0&&(he+=2*D);for(var de=Math.ceil(Math.abs(he/D*2)),Se=[],Ce=he/de,kt=8/3*Math.sin(Ce/4)*Math.sin(Ce/4)/Math.sin(Ce/2),on=ie+Ce,st=0;st<de;st++)Se[st]=h(ie,on,W,X,A,M,ce,J,kt,$,q),$=Se[st][5],q=Se[st][6],ie=on,on+=Ce;return Se}function a(_,O,A,M){var B=Math.atan2(O,_),P=Math.atan2(M,A);return P>=B?P-B:2*Math.PI-(B-P)}function i(_,O,A,M,B,P,k,D){var F;if(e.cachesBoundsOfCurve&&(F=d.call(arguments),e.boundsOfCurveCache[F]))return e.boundsOfCurveCache[F];var X=Math.sqrt,W=Math.min,$=Math.max,q=Math.abs,oe=[],I=[[],[]],j,R,U,z,H,ee,ae,se;R=6*_-12*A+6*B,j=-3*_+9*A-9*B+3*k,U=3*A-3*_;for(var V=0;V<2;++V){if(V>0&&(R=6*O-12*M+6*P,j=-3*O+9*M-9*P+3*D,U=3*M-3*O),q(j)<1e-12){if(q(R)<1e-12)continue;z=-U/R,0<z&&z<1&&oe.push(z);continue}ae=R*R-4*U*j,!(ae<0)&&(se=X(ae),H=(-R+se)/(2*j),0<H&&H<1&&oe.push(H),ee=(-R-se)/(2*j),0<ee&&ee<1&&oe.push(ee))}for(var ce,J,ie=oe.length,he=ie,de;ie--;)z=oe[ie],de=1-z,ce=de*de*de*_+3*de*de*z*A+3*de*z*z*B+z*z*z*k,I[0][ie]=ce,J=de*de*de*O+3*de*de*z*M+3*de*z*z*P+z*z*z*D,I[1][ie]=J;I[0][he]=_,I[1][he]=O,I[0][he+1]=k,I[1][he+1]=D;var Se=[{x:W.apply(null,I[0]),y:W.apply(null,I[1])},{x:$.apply(null,I[0]),y:$.apply(null,I[1])}];return e.cachesBoundsOfCurve&&(e.boundsOfCurveCache[F]=Se),Se}function o(_,O,A){for(var M=A[1],B=A[2],P=A[3],k=A[4],D=A[5],F=A[6],X=A[7],W=r(F-_,X-O,M,B,k,D,P),$=0,q=W.length;$<q;$++)W[$][1]+=_,W[$][2]+=O,W[$][3]+=_,W[$][4]+=O,W[$][5]+=_,W[$][6]+=O;return W}function f(_){var O=0,A=0,M=_.length,B=0,P=0,k,D,F,X=[],W,$,q;for(D=0;D<M;++D){switch(F=!1,k=_[D].slice(0),k[0]){case"l":k[0]="L",k[1]+=O,k[2]+=A;case"L":O=k[1],A=k[2];break;case"h":k[1]+=O;case"H":k[0]="L",k[2]=A,O=k[1];break;case"v":k[1]+=A;case"V":k[0]="L",A=k[1],k[1]=O,k[2]=A;break;case"m":k[0]="M",k[1]+=O,k[2]+=A;case"M":O=k[1],A=k[2],B=k[1],P=k[2];break;case"c":k[0]="C",k[1]+=O,k[2]+=A,k[3]+=O,k[4]+=A,k[5]+=O,k[6]+=A;case"C":$=k[3],q=k[4],O=k[5],A=k[6];break;case"s":k[0]="S",k[1]+=O,k[2]+=A,k[3]+=O,k[4]+=A;case"S":W==="C"?($=2*O-$,q=2*A-q):($=O,q=A),O=k[3],A=k[4],k[0]="C",k[5]=k[3],k[6]=k[4],k[3]=k[1],k[4]=k[2],k[1]=$,k[2]=q,$=k[3],q=k[4];break;case"q":k[0]="Q",k[1]+=O,k[2]+=A,k[3]+=O,k[4]+=A;case"Q":$=k[1],q=k[2],O=k[3],A=k[4];break;case"t":k[0]="T",k[1]+=O,k[2]+=A;case"T":W==="Q"?($=2*O-$,q=2*A-q):($=O,q=A),k[0]="Q",O=k[1],A=k[2],k[1]=$,k[2]=q,k[3]=O,k[4]=A;break;case"a":k[0]="A",k[6]+=O,k[7]+=A;case"A":F=!0,X=X.concat(o(O,A,k)),O=k[6],A=k[7];break;case"z":case"Z":O=B,A=P;break}F||X.push(k),W=k[0]}return X}function l(_,O,A,M){return Math.sqrt((A-_)*(A-_)+(M-O)*(M-O))}function g(_){return _*_*_}function m(_){return 3*_*_*(1-_)}function v(_){return 3*_*(1-_)*(1-_)}function x(_){return(1-_)*(1-_)*(1-_)}function S(_,O,A,M,B,P,k,D){return function(F){var X=g(F),W=m(F),$=v(F),q=x(F);return{x:k*X+B*W+A*$+_*q,y:D*X+P*W+M*$+O*q}}}function b(_,O,A,M,B,P,k,D){return function(F){var X=1-F,W=3*X*X*(A-_)+6*X*F*(B-A)+3*F*F*(k-B),$=3*X*X*(M-O)+6*X*F*(P-M)+3*F*F*(D-P);return Math.atan2($,W)}}function T(_){return _*_}function E(_){return 2*_*(1-_)}function N(_){return(1-_)*(1-_)}function L(_,O,A,M,B,P){return function(k){var D=T(k),F=E(k),X=N(k);return{x:B*D+A*F+_*X,y:P*D+M*F+O*X}}}function G(_,O,A,M,B,P){return function(k){var D=1-k,F=2*D*(A-_)+2*k*(B-A),X=2*D*(M-O)+2*k*(P-M);return Math.atan2(X,F)}}function Q(_,O,A){var M={x:O,y:A},B,P=0,k;for(k=1;k<=100;k+=1)B=_(k/100),P+=l(M.x,M.y,B.x,B.y),M=B;return P}function Z(_,O){for(var A=0,M=0,B=_.iterator,P={x:_.x,y:_.y},k,D,F=.01,X=_.angleFinder,W;M<O&&F>1e-4;)k=B(A),W=A,D=l(P.x,P.y,k.x,k.y),D+M>O?(A-=F,F/=2):(P=k,A+=F,M+=D);return k.angle=X(W),k}function te(_){for(var O=0,A=_.length,M,B=0,P=0,k=0,D=0,F=[],X,W,$,q=0;q<A;q++){switch(M=_[q],W={x:B,y:P,command:M[0]},M[0]){case"M":W.length=0,k=B=M[1],D=P=M[2];break;case"L":W.length=l(B,P,M[1],M[2]),B=M[1],P=M[2];break;case"C":X=S(B,P,M[1],M[2],M[3],M[4],M[5],M[6]),$=b(B,P,M[1],M[2],M[3],M[4],M[5],M[6]),W.iterator=X,W.angleFinder=$,W.length=Q(X,B,P),B=M[5],P=M[6];break;case"Q":X=L(B,P,M[1],M[2],M[3],M[4]),$=G(B,P,M[1],M[2],M[3],M[4]),W.iterator=X,W.angleFinder=$,W.length=Q(X,B,P),B=M[3],P=M[4];break;case"Z":case"z":W.destX=k,W.destY=D,W.length=l(B,P,k,D),B=k,P=D;break}O+=W.length,F.push(W)}return F.push({length:O,x:B,y:P}),F}function K(_,O,A){A||(A=te(_));for(var M=0;O-A[M].length>0&&M<A.length-2;)O-=A[M].length,M++;var B=A[M],P=O/B.length,k=B.command,D=_[M],F;switch(k){case"M":return{x:B.x,y:B.y,angle:0};case"Z":case"z":return F=new e.Point(B.x,B.y).lerp(new e.Point(B.destX,B.destY),P),F.angle=Math.atan2(B.destY-B.y,B.destX-B.x),F;case"L":return F=new e.Point(B.x,B.y).lerp(new e.Point(D[1],D[2]),P),F.angle=Math.atan2(D[2]-B.y,D[1]-B.x),F;case"C":return Z(B,O);case"Q":return Z(B,O)}}function ne(_){var O=[],A=[],M,B,P=e.rePathCommand,k="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",D="("+k+")"+e.commaWsp,F="([01])"+e.commaWsp+"?",X=D+"?"+D+"?"+D+F+F+D+"?("+k+")",W=new RegExp(X,"g"),$,q,oe;if(!_||!_.match)return O;oe=_.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);for(var I=0,j,R=oe.length;I<R;I++){M=oe[I],q=M.slice(1).trim(),A.length=0;var U=M.charAt(0);if(j=[U],U.toLowerCase()==="a")for(var z;z=W.exec(q);)for(var H=1;H<z.length;H++)A.push(z[H]);else for(;$=P.exec(q);)A.push($[0]);for(var H=0,ee=A.length;H<ee;H++)B=parseFloat(A[H]),isNaN(B)||j.push(B);var ae=s[U.toLowerCase()],se=u[U]||U;if(j.length-1>ae)for(var V=1,ce=j.length;V<ce;V+=ae)O.push([U].concat(j.slice(V,V+ae))),U=se;else O.push(j)}return O}function le(_,O){var A=[],M,B=new e.Point(_[0].x,_[0].y),P=new e.Point(_[1].x,_[1].y),k=_.length,D=1,F=0,X=k>2;for(O=O||0,X&&(D=_[2].x<P.x?-1:_[2].x===P.x?0:1,F=_[2].y<P.y?-1:_[2].y===P.y?0:1),A.push(["M",B.x-D*O,B.y-F*O]),M=1;M<k;M++){if(!B.eq(P)){var W=B.midPointFrom(P);A.push(["Q",B.x,B.y,W.x,W.y])}B=_[M],M+1<_.length&&(P=_[M+1])}return X&&(D=B.x>_[M-2].x?1:B.x===_[M-2].x?0:-1,F=B.y>_[M-2].y?1:B.y===_[M-2].y?0:-1),A.push(["L",B.x+D*O,B.y+F*O]),A}function Y(_,O,A){return A&&(O=e.util.multiplyTransformMatrices(O,[1,0,0,1,-A.x,-A.y])),_.map(function(M){for(var B=M.slice(0),P={},k=1;k<M.length-1;k+=2)P.x=M[k],P.y=M[k+1],P=e.util.transformPoint(P,O),B[k]=P.x,B[k+1]=P.y;return B})}e.util.joinPath=function(_){return _.map(function(O){return O.join(" ")}).join(" ")},e.util.parsePath=ne,e.util.makePathSimpler=f,e.util.getSmoothPathFromPoints=le,e.util.getPathSegmentsInfo=te,e.util.getBoundsOfCurve=i,e.util.getPointOnPath=K,e.util.transformPath=Y}(),function(){var d=Array.prototype.slice;function s(i,o){for(var f=d.call(arguments,2),l=[],g=0,m=i.length;g<m;g++)l[g]=f.length?i[g][o].apply(i[g],f):i[g][o].call(i[g]);return l}function u(i,o){return a(i,o,function(f,l){return f>=l})}function h(i,o){return a(i,o,function(f,l){return f<l})}function r(i,o){for(var f=i.length;f--;)i[f]=o;return i}function a(i,o,f){if(!(!i||i.length===0)){var l=i.length-1,g=o?i[l][o]:i[l];if(o)for(;l--;)f(i[l][o],g)&&(g=i[l][o]);else for(;l--;)f(i[l],g)&&(g=i[l]);return g}}e.util.array={fill:r,invoke:s,min:h,max:u}}(),function(){function d(u,h,r){if(r)if(!e.isLikelyNode&&h instanceof Element)u=h;else if(h instanceof Array){u=[];for(var a=0,i=h.length;a<i;a++)u[a]=d({},h[a],r)}else if(h&&typeof h=="object")for(var o in h)o==="canvas"||o==="group"?u[o]=null:h.hasOwnProperty(o)&&(u[o]=d({},h[o],r));else u=h;else for(var o in h)u[o]=h[o];return u}function s(u,h){return d({},u,h)}e.util.object={extend:d,clone:s},e.util.object.extend(e.util,e.Observable)}(),function(){function d(a){return a.replace(/-+(.)?/g,function(i,o){return o?o.toUpperCase():""})}function s(a,i){return a.charAt(0).toUpperCase()+(i?a.slice(1):a.slice(1).toLowerCase())}function u(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function h(a){var i=0,o,f=[];for(i=0,o;i<a.length;i++)(o=r(a,i))!==!1&&f.push(o);return f}function r(a,i){var o=a.charCodeAt(i);if(isNaN(o))return"";if(o<55296||o>57343)return a.charAt(i);if(55296<=o&&o<=56319){if(a.length<=i+1)throw"High surrogate without following low surrogate";var f=a.charCodeAt(i+1);if(56320>f||f>57343)throw"High surrogate without following low surrogate";return a.charAt(i)+a.charAt(i+1)}if(i===0)throw"Low surrogate without preceding high surrogate";var l=a.charCodeAt(i-1);if(55296>l||l>56319)throw"Low surrogate without preceding high surrogate";return!1}e.util.string={camelize:d,capitalize:s,escapeXml:u,graphemeSplit:h}}(),function(){var d=Array.prototype.slice,s=function(){},u=function(){for(var o in{toString:1})if(o==="toString")return!1;return!0}(),h=function(o,f,l){for(var g in f)g in o.prototype&&typeof o.prototype[g]=="function"&&(f[g]+"").indexOf("callSuper")>-1?o.prototype[g]=function(m){return function(){var v=this.constructor.superclass;this.constructor.superclass=l;var x=f[m].apply(this,arguments);if(this.constructor.superclass=v,m!=="initialize")return x}}(g):o.prototype[g]=f[g],u&&(f.toString!==Object.prototype.toString&&(o.prototype.toString=f.toString),f.valueOf!==Object.prototype.valueOf&&(o.prototype.valueOf=f.valueOf))};function r(){}function a(o){for(var f=null,l=this;l.constructor.superclass;){var g=l.constructor.superclass.prototype[o];if(l[o]!==g){f=g;break}l=l.constructor.superclass.prototype}return f?arguments.length>1?f.apply(this,d.call(arguments,1)):f.call(this):console.log("tried to callSuper "+o+", method not found in prototype chain",this)}function i(){var o=null,f=d.call(arguments,0);typeof f[0]=="function"&&(o=f.shift());function l(){this.initialize.apply(this,arguments)}l.superclass=o,l.subclasses=[],o&&(r.prototype=o.prototype,l.prototype=new r,o.subclasses.push(l));for(var g=0,m=f.length;g<m;g++)h(l,f[g],o);return l.prototype.initialize||(l.prototype.initialize=s),l.prototype.constructor=l,l.prototype.callSuper=a,l}e.util.createClass=i}(),function(){var d=!!e.document.createElement("div").attachEvent,s=["touchstart","touchmove","touchend"];e.util.addListener=function(h,r,a,i){h&&h.addEventListener(r,a,d?!1:i)},e.util.removeListener=function(h,r,a,i){h&&h.removeEventListener(r,a,d?!1:i)};function u(h){var r=h.changedTouches;return r&&r[0]?r[0]:h}e.util.getPointer=function(h){var r=h.target,a=e.util.getScrollLeftTop(r),i=u(h);return{x:i.clientX+a.left,y:i.clientY+a.top}},e.util.isTouchEvent=function(h){return s.indexOf(h.type)>-1||h.pointerType==="touch"}}(),function(){function d(i,o){var f=i.style;if(!f)return i;if(typeof o=="string")return i.style.cssText+=";"+o,o.indexOf("opacity")>-1?a(i,o.match(/opacity:\s*(\d?\.?\d*)/)[1]):i;for(var l in o)if(l==="opacity")a(i,o[l]);else{var g=l==="float"||l==="cssFloat"?typeof f.styleFloat>"u"?"cssFloat":"styleFloat":l;f.setProperty(g,o[l])}return i}var s=e.document.createElement("div"),u=typeof s.style.opacity=="string",h=typeof s.style.filter=="string",r=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,a=function(i){return i};u?a=function(i,o){return i.style.opacity=o,i}:h&&(a=function(i,o){var f=i.style;return i.currentStyle&&!i.currentStyle.hasLayout&&(f.zoom=1),r.test(f.filter)?(o=o>=.9999?"":"alpha(opacity="+o*100+")",f.filter=f.filter.replace(r,o)):f.filter+=" alpha(opacity="+o*100+")",i}),e.util.setStyle=d}(),function(){var d=Array.prototype.slice;function s(x){return typeof x=="string"?e.document.getElementById(x):x}var u,h=function(x){return d.call(x,0)};try{u=h(e.document.childNodes)instanceof Array}catch{}u||(h=function(x){for(var S=new Array(x.length),b=x.length;b--;)S[b]=x[b];return S});function r(x,S){var b=e.document.createElement(x);for(var T in S)T==="class"?b.className=S[T]:T==="for"?b.htmlFor=S[T]:b.setAttribute(T,S[T]);return b}function a(x,S){x&&(" "+x.className+" ").indexOf(" "+S+" ")===-1&&(x.className+=(x.className?" ":"")+S)}function i(x,S,b){return typeof S=="string"&&(S=r(S,b)),x.parentNode&&x.parentNode.replaceChild(S,x),S.appendChild(x),S}function o(x){for(var S=0,b=0,T=e.document.documentElement,E=e.document.body||{scrollLeft:0,scrollTop:0};x&&(x.parentNode||x.host)&&(x=x.parentNode||x.host,x===e.document?(S=E.scrollLeft||T.scrollLeft||0,b=E.scrollTop||T.scrollTop||0):(S+=x.scrollLeft||0,b+=x.scrollTop||0),!(x.nodeType===1&&x.style.position==="fixed")););return{left:S,top:b}}function f(x){var S,b=x&&x.ownerDocument,T={left:0,top:0},E={left:0,top:0},N,L={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!b)return E;for(var G in L)E[L[G]]+=parseInt(l(x,G),10)||0;return S=b.documentElement,typeof x.getBoundingClientRect<"u"&&(T=x.getBoundingClientRect()),N=o(x),{left:T.left+N.left-(S.clientLeft||0)+E.left,top:T.top+N.top-(S.clientTop||0)+E.top}}var l;e.document.defaultView&&e.document.defaultView.getComputedStyle?l=function(x,S){var b=e.document.defaultView.getComputedStyle(x,null);return b?b[S]:void 0}:l=function(x,S){var b=x.style[S];return!b&&x.currentStyle&&(b=x.currentStyle[S]),b},function(){var x=e.document.documentElement.style,S="userSelect"in x?"userSelect":"MozUserSelect"in x?"MozUserSelect":"WebkitUserSelect"in x?"WebkitUserSelect":"KhtmlUserSelect"in x?"KhtmlUserSelect":"";function b(E){return typeof E.onselectstart<"u"&&(E.onselectstart=e.util.falseFunction),S?E.style[S]="none":typeof E.unselectable=="string"&&(E.unselectable="on"),E}function T(E){return typeof E.onselectstart<"u"&&(E.onselectstart=null),S?E.style[S]="":typeof E.unselectable=="string"&&(E.unselectable=""),E}e.util.makeElementUnselectable=b,e.util.makeElementSelectable=T}();function g(x){var S=e.jsdomImplForWrapper(x);return S._canvas||S._image}function m(x){if(e.isLikelyNode){var S=e.jsdomImplForWrapper(x);S&&(S._image=null,S._canvas=null,S._currentSrc=null,S._attributes=null,S._classList=null)}}function v(x,S){x.imageSmoothingEnabled=x.imageSmoothingEnabled||x.webkitImageSmoothingEnabled||x.mozImageSmoothingEnabled||x.msImageSmoothingEnabled||x.oImageSmoothingEnabled,x.imageSmoothingEnabled=S}e.util.setImageSmoothing=v,e.util.getById=s,e.util.toArray=h,e.util.addClass=a,e.util.makeElement=r,e.util.wrapElement=i,e.util.getScrollLeftTop=o,e.util.getElementOffset=f,e.util.getNodeCanvas=g,e.util.cleanUpJsdomNode=m}(),function(){function d(h,r){return h+(/\?/.test(h)?"&":"?")+r}function s(){}function u(h,r){r||(r={});var a=r.method?r.method.toUpperCase():"GET",i=r.onComplete||function(){},o=new e.window.XMLHttpRequest,f=r.body||r.parameters;return o.onreadystatechange=function(){o.readyState===4&&(i(o),o.onreadystatechange=s)},a==="GET"&&(f=null,typeof r.parameters=="string"&&(h=d(h,r.parameters))),o.open(a,h,!0),(a==="POST"||a==="PUT")&&o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(f),o}e.util.request=u}(),e.log=console.log,e.warn=console.warn,function(){var d=e.util.object.extend,s=e.util.object.clone,u=[];e.util.object.extend(u,{cancelAll:function(){var g=this.splice(0);return g.forEach(function(m){m.cancel()}),g},cancelByCanvas:function(g){if(!g)return[];var m=this.filter(function(v){return typeof v.target=="object"&&v.target.canvas===g});return m.forEach(function(v){v.cancel()}),m},cancelByTarget:function(g){var m=this.findAnimationsByTarget(g);return m.forEach(function(v){v.cancel()}),m},findAnimationIndex:function(g){return this.indexOf(this.findAnimation(g))},findAnimation:function(g){return this.find(function(m){return m.cancel===g})},findAnimationsByTarget:function(g){return g?this.filter(function(m){return m.target===g}):[]}});function h(){return!1}function r(g,m,v,x){return-v*Math.cos(g/x*(Math.PI/2))+v+m}function a(g){g||(g={});var m=!1,v,x=function(){var S=e.runningAnimations.indexOf(v);return S>-1&&e.runningAnimations.splice(S,1)[0]};return v=d(s(g),{cancel:function(){return m=!0,x()},currentValue:"startValue"in g?g.startValue:0,completionRate:0,durationRate:0}),e.runningAnimations.push(v),f(function(S){var b=S||+new Date,T=g.duration||500,E=b+T,N,L=g.onChange||h,G=g.abort||h,Q=g.onComplete||h,Z=g.easing||r,te="startValue"in g?g.startValue.length>0:!1,K="startValue"in g?g.startValue:0,ne="endValue"in g?g.endValue:100,le=g.byValue||(te?K.map(function(Y,_){return ne[_]-K[_]}):ne-K);g.onStart&&g.onStart(),function Y(_){N=_||+new Date;var O=N>E?T:N-b,A=O/T,M=te?K.map(function(P,k){return Z(O,K[k],le[k],T)}):Z(O,K,le,T),B=Math.abs(te?(M[0]-K[0])/le[0]:(M-K)/le);if(v.currentValue=te?M.slice():M,v.completionRate=B,v.durationRate=A,!m){if(G(M,B,A)){x();return}if(N>E){v.currentValue=te?ne.slice():ne,v.completionRate=1,v.durationRate=1,L(te?ne.slice():ne,1,1),Q(ne,1,1),x();return}else L(M,B,A),f(Y)}}(b)}),v.cancel}var i=e.window.requestAnimationFrame||e.window.webkitRequestAnimationFrame||e.window.mozRequestAnimationFrame||e.window.oRequestAnimationFrame||e.window.msRequestAnimationFrame||function(g){return e.window.setTimeout(g,1e3/60)},o=e.window.cancelAnimationFrame||e.window.clearTimeout;function f(){return i.apply(e.window,arguments)}function l(){return o.apply(e.window,arguments)}e.util.animate=a,e.util.requestAnimFrame=f,e.util.cancelAnimFrame=l,e.runningAnimations=u}(),function(){function d(u,h,r){var a="rgba("+parseInt(u[0]+r*(h[0]-u[0]),10)+","+parseInt(u[1]+r*(h[1]-u[1]),10)+","+parseInt(u[2]+r*(h[2]-u[2]),10);return a+=","+(u&&h?parseFloat(u[3]+r*(h[3]-u[3])):1),a+=")",a}function s(u,h,r,a){var i=new e.Color(u).getSource(),o=new e.Color(h).getSource(),f=a.onComplete,l=a.onChange;return a=a||{},e.util.animate(e.util.object.extend(a,{duration:r||500,startValue:i,endValue:o,byValue:o,easing:function(g,m,v,x){var S=a.colorEasing?a.colorEasing(g,x):1-Math.cos(g/x*(Math.PI/2));return d(m,v,S)},onComplete:function(g,m,v){if(f)return f(d(o,o,0),m,v)},onChange:function(g,m,v){if(l){if(Array.isArray(g))return l(d(g,g,0),m,v);l(g,m,v)}}}))}e.util.animateColor=s}(),function(){function d(_,O,A,M){return _<Math.abs(O)?(_=O,M=A/4):O===0&&_===0?M=A/(2*Math.PI)*Math.asin(1):M=A/(2*Math.PI)*Math.asin(O/_),{a:_,c:O,p:A,s:M}}function s(_,O,A){return _.a*Math.pow(2,10*(O-=1))*Math.sin((O*A-_.s)*(2*Math.PI)/_.p)}function u(_,O,A,M){return A*((_=_/M-1)*_*_+1)+O}function h(_,O,A,M){return _/=M/2,_<1?A/2*_*_*_+O:A/2*((_-=2)*_*_+2)+O}function r(_,O,A,M){return A*(_/=M)*_*_*_+O}function a(_,O,A,M){return-A*((_=_/M-1)*_*_*_-1)+O}function i(_,O,A,M){return _/=M/2,_<1?A/2*_*_*_*_+O:-A/2*((_-=2)*_*_*_-2)+O}function o(_,O,A,M){return A*(_/=M)*_*_*_*_+O}function f(_,O,A,M){return A*((_=_/M-1)*_*_*_*_+1)+O}function l(_,O,A,M){return _/=M/2,_<1?A/2*_*_*_*_*_+O:A/2*((_-=2)*_*_*_*_+2)+O}function g(_,O,A,M){return-A*Math.cos(_/M*(Math.PI/2))+A+O}function m(_,O,A,M){return A*Math.sin(_/M*(Math.PI/2))+O}function v(_,O,A,M){return-A/2*(Math.cos(Math.PI*_/M)-1)+O}function x(_,O,A,M){return _===0?O:A*Math.pow(2,10*(_/M-1))+O}function S(_,O,A,M){return _===M?O+A:A*(-Math.pow(2,-10*_/M)+1)+O}function b(_,O,A,M){return _===0?O:_===M?O+A:(_/=M/2,_<1?A/2*Math.pow(2,10*(_-1))+O:A/2*(-Math.pow(2,-10*--_)+2)+O)}function T(_,O,A,M){return-A*(Math.sqrt(1-(_/=M)*_)-1)+O}function E(_,O,A,M){return A*Math.sqrt(1-(_=_/M-1)*_)+O}function N(_,O,A,M){return _/=M/2,_<1?-A/2*(Math.sqrt(1-_*_)-1)+O:A/2*(Math.sqrt(1-(_-=2)*_)+1)+O}function L(_,O,A,M){var B=1.70158,P=0,k=A;if(_===0)return O;if(_/=M,_===1)return O+A;P||(P=M*.3);var D=d(k,A,P,B);return-s(D,_,M)+O}function G(_,O,A,M){var B=1.70158,P=0,k=A;if(_===0)return O;if(_/=M,_===1)return O+A;P||(P=M*.3);var D=d(k,A,P,B);return D.a*Math.pow(2,-10*_)*Math.sin((_*M-D.s)*(2*Math.PI)/D.p)+D.c+O}function Q(_,O,A,M){var B=1.70158,P=0,k=A;if(_===0)return O;if(_/=M/2,_===2)return O+A;P||(P=M*(.3*1.5));var D=d(k,A,P,B);return _<1?-.5*s(D,_,M)+O:D.a*Math.pow(2,-10*(_-=1))*Math.sin((_*M-D.s)*(2*Math.PI)/D.p)*.5+D.c+O}function Z(_,O,A,M,B){return B===void 0&&(B=1.70158),A*(_/=M)*_*((B+1)*_-B)+O}function te(_,O,A,M,B){return B===void 0&&(B=1.70158),A*((_=_/M-1)*_*((B+1)*_+B)+1)+O}function K(_,O,A,M,B){return B===void 0&&(B=1.70158),_/=M/2,_<1?A/2*(_*_*(((B*=1.525)+1)*_-B))+O:A/2*((_-=2)*_*(((B*=1.525)+1)*_+B)+2)+O}function ne(_,O,A,M){return A-le(M-_,0,A,M)+O}function le(_,O,A,M){return(_/=M)<1/2.75?A*(7.5625*_*_)+O:_<2/2.75?A*(7.5625*(_-=1.5/2.75)*_+.75)+O:_<2.5/2.75?A*(7.5625*(_-=2.25/2.75)*_+.9375)+O:A*(7.5625*(_-=2.625/2.75)*_+.984375)+O}function Y(_,O,A,M){return _<M/2?ne(_*2,0,A,M)*.5+O:le(_*2-M,0,A,M)*.5+A*.5+O}e.util.ease={easeInQuad:function(_,O,A,M){return A*(_/=M)*_+O},easeOutQuad:function(_,O,A,M){return-A*(_/=M)*(_-2)+O},easeInOutQuad:function(_,O,A,M){return _/=M/2,_<1?A/2*_*_+O:-A/2*(--_*(_-2)-1)+O},easeInCubic:function(_,O,A,M){return A*(_/=M)*_*_+O},easeOutCubic:u,easeInOutCubic:h,easeInQuart:r,easeOutQuart:a,easeInOutQuart:i,easeInQuint:o,easeOutQuint:f,easeInOutQuint:l,easeInSine:g,easeOutSine:m,easeInOutSine:v,easeInExpo:x,easeOutExpo:S,easeInOutExpo:b,easeInCirc:T,easeOutCirc:E,easeInOutCirc:N,easeInElastic:L,easeOutElastic:G,easeInOutElastic:Q,easeInBack:Z,easeOutBack:te,easeInOutBack:K,easeInBounce:ne,easeOutBounce:le,easeInOutBounce:Y}}(),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend,h=s.util.object.clone,r=s.util.toFixed,a=s.util.parseUnit,i=s.util.multiplyTransformMatrices,o=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],f=["symbol","image","marker","pattern","view","svg"],l=["pattern","defs","symbol","metadata","clipPath","mask","desc"],g=["symbol","g","a","svg","clipPath","defs"],m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},v={stroke:"strokeOpacity",fill:"fillOpacity"},x="font-size",S="clip-path";s.svgValidTagNamesRegEx=E(o),s.svgViewBoxElementsRegEx=E(f),s.svgInvalidAncestorsRegEx=E(l),s.svgValidParentsRegEx=E(g),s.cssRules={},s.gradientDefs={},s.clipPaths={};function b(P){return P in m?m[P]:P}function T(P,k,D,F){var X=Array.isArray(k),W;if((P==="fill"||P==="stroke")&&k==="none")k="";else{if(P==="strokeUniform")return k==="non-scaling-stroke";if(P==="strokeDashArray")k==="none"?k=null:k=k.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(P==="transformMatrix")D&&D.transformMatrix?k=i(D.transformMatrix,s.parseTransformAttribute(k)):k=s.parseTransformAttribute(k);else if(P==="visible")k=k!=="none"&&k!=="hidden",D&&D.visible===!1&&(k=!1);else if(P==="opacity")k=parseFloat(k),D&&typeof D.opacity<"u"&&(k*=D.opacity);else if(P==="textAnchor")k=k==="start"?"left":k==="end"?"right":"center";else if(P==="charSpacing")W=a(k,F)/F*1e3;else if(P==="paintFirst"){var $=k.indexOf("fill"),q=k.indexOf("stroke"),k="fill";($>-1&&q>-1&&q<$||$===-1&&q>-1)&&(k="stroke")}else{if(P==="href"||P==="xlink:href"||P==="font")return k;if(P==="imageSmoothing")return k==="optimizeQuality";W=X?k.map(a):a(k,F)}}return!X&&isNaN(W)?k:W}function E(P){return new RegExp("^("+P.join("|")+")\\b","i")}function N(P){for(var k in v)if(!(typeof P[v[k]]>"u"||P[k]==="")){if(typeof P[k]>"u"){if(!s.Object.prototype[k])continue;P[k]=s.Object.prototype[k]}if(P[k].indexOf("url(")!==0){var D=new s.Color(P[k]);P[k]=D.setAlpha(r(D.getAlpha()*P[v[k]],2)).toRgba()}}return P}function L(P,k){var D,F=[],X,W,$;for(W=0,$=k.length;W<$;W++)D=k[W],X=P.getElementsByTagName(D),F=F.concat(Array.prototype.slice.call(X));return F}s.parseTransformAttribute=function(){function P(V,ce){var J=s.util.cos(ce[0]),ie=s.util.sin(ce[0]),he=0,de=0;ce.length===3&&(he=ce[1],de=ce[2]),V[0]=J,V[1]=ie,V[2]=-ie,V[3]=J,V[4]=he-(J*he-ie*de),V[5]=de-(ie*he+J*de)}function k(V,ce){var J=ce[0],ie=ce.length===2?ce[1]:ce[0];V[0]=J,V[3]=ie}function D(V,ce,J){V[J]=Math.tan(s.util.degreesToRadians(ce[0]))}function F(V,ce){V[4]=ce[0],ce.length===2&&(V[5]=ce[1])}var X=s.iMatrix,W=s.reNum,$=s.commaWsp,q="(?:(skewX)\\s*\\(\\s*("+W+")\\s*\\))",oe="(?:(skewY)\\s*\\(\\s*("+W+")\\s*\\))",I="(?:(rotate)\\s*\\(\\s*("+W+")(?:"+$+"("+W+")"+$+"("+W+"))?\\s*\\))",j="(?:(scale)\\s*\\(\\s*("+W+")(?:"+$+"("+W+"))?\\s*\\))",R="(?:(translate)\\s*\\(\\s*("+W+")(?:"+$+"("+W+"))?\\s*\\))",U="(?:(matrix)\\s*\\(\\s*("+W+")"+$+"("+W+")"+$+"("+W+")"+$+"("+W+")"+$+"("+W+")"+$+"("+W+")\\s*\\))",z="(?:"+U+"|"+R+"|"+j+"|"+I+"|"+q+"|"+oe+")",H="(?:"+z+"(?:"+$+"*"+z+")*)",ee="^\\s*(?:"+H+"?)\\s*$",ae=new RegExp(ee),se=new RegExp(z,"g");return function(V){var ce=X.concat(),J=[];if(!V||V&&!ae.test(V))return ce;V.replace(se,function(he){var de=new RegExp(z).exec(he).filter(function(kt){return!!kt}),Se=de[1],Ce=de.slice(2).map(parseFloat);switch(Se){case"translate":F(ce,Ce);break;case"rotate":Ce[0]=s.util.degreesToRadians(Ce[0]),P(ce,Ce);break;case"scale":k(ce,Ce);break;case"skewX":D(ce,Ce,2);break;case"skewY":D(ce,Ce,1);break;case"matrix":ce=Ce;break}J.push(ce.concat()),ce=X.concat()});for(var ie=J[0];J.length>1;)J.shift(),ie=s.util.multiplyTransformMatrices(ie,J[0]);return ie}}();function G(P,k){var D,F;P.replace(/;\s*$/,"").split(";").forEach(function(X){var W=X.split(":");D=W[0].trim().toLowerCase(),F=W[1].trim(),k[D]=F})}function Q(P,k){var D,F;for(var X in P)typeof P[X]>"u"||(D=X.toLowerCase(),F=P[X],k[D]=F)}function Z(P,k){var D={};for(var F in s.cssRules[k])if(te(P,F.split(" ")))for(var X in s.cssRules[k][F])D[X]=s.cssRules[k][F][X];return D}function te(P,k){var D,F=!0;return D=ne(P,k.pop()),D&&k.length&&(F=K(P,k)),D&&F&&k.length===0}function K(P,k){for(var D,F=!0;P.parentNode&&P.parentNode.nodeType===1&&k.length;)F&&(D=k.pop()),P=P.parentNode,F=ne(P,D);return k.length===0}function ne(P,k){var D=P.nodeName,F=P.getAttribute("class"),X=P.getAttribute("id"),W,$;if(W=new RegExp("^"+D,"i"),k=k.replace(W,""),X&&k.length&&(W=new RegExp("#"+X+"(?![a-zA-Z\\-]+)","i"),k=k.replace(W,"")),F&&k.length)for(F=F.split(" "),$=F.length;$--;)W=new RegExp("\\."+F[$]+"(?![a-zA-Z\\-]+)","i"),k=k.replace(W,"");return k.length===0}function le(P,k){var D;if(P.getElementById&&(D=P.getElementById(k)),D)return D;var F,X,W,$=P.getElementsByTagName("*");for(X=0,W=$.length;X<W;X++)if(F=$[X],k===F.getAttribute("id"))return F}function Y(P){for(var k=L(P,["use","svg:use"]),D=0;k.length&&D<k.length;){var F=k[D],X=F.getAttribute("xlink:href")||F.getAttribute("href");if(X===null)return;var W=X.slice(1),$=F.getAttribute("x")||0,q=F.getAttribute("y")||0,oe=le(P,W).cloneNode(!0),I=(oe.getAttribute("transform")||"")+" translate("+$+", "+q+")",j,R=k.length,U,z,H,ee,ae=s.svgNS;if(O(oe),/^svg$/i.test(oe.nodeName)){var se=oe.ownerDocument.createElementNS(ae,"g");for(z=0,H=oe.attributes,ee=H.length;z<ee;z++)U=H.item(z),se.setAttributeNS(ae,U.nodeName,U.nodeValue);for(;oe.firstChild;)se.appendChild(oe.firstChild);oe=se}for(z=0,H=F.attributes,ee=H.length;z<ee;z++)U=H.item(z),!(U.nodeName==="x"||U.nodeName==="y"||U.nodeName==="xlink:href"||U.nodeName==="href")&&(U.nodeName==="transform"?I=U.nodeValue+" "+I:oe.setAttribute(U.nodeName,U.nodeValue));oe.setAttribute("transform",I),oe.setAttribute("instantiated_by_use","1"),oe.removeAttribute("id"),j=F.parentNode,j.replaceChild(oe,F),k.length===R&&D++}}var _=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function O(P){if(!s.svgViewBoxElementsRegEx.test(P.nodeName))return{};var k=P.getAttribute("viewBox"),D=1,F=1,X=0,W=0,$,q,oe,I,j=P.getAttribute("width"),R=P.getAttribute("height"),U=P.getAttribute("x")||0,z=P.getAttribute("y")||0,H=P.getAttribute("preserveAspectRatio")||"",ee=!k||!(k=k.match(_)),ae=!j||!R||j==="100%"||R==="100%",se=ee&&ae,V={},ce="",J=0,ie=0;if(V.width=0,V.height=0,V.toBeParsed=se,ee&&(U||z)&&P.parentNode&&P.parentNode.nodeName!=="#document"&&(ce=" translate("+a(U)+" "+a(z)+") ",oe=(P.getAttribute("transform")||"")+ce,P.setAttribute("transform",oe),P.removeAttribute("x"),P.removeAttribute("y")),se)return V;if(ee)return V.width=a(j),V.height=a(R),V;if(X=-parseFloat(k[1]),W=-parseFloat(k[2]),$=parseFloat(k[3]),q=parseFloat(k[4]),V.minX=X,V.minY=W,V.viewBoxWidth=$,V.viewBoxHeight=q,ae?(V.width=$,V.height=q):(V.width=a(j),V.height=a(R),D=V.width/$,F=V.height/q),H=s.util.parsePreserveAspectRatioAttribute(H),H.alignX!=="none"&&(H.meetOrSlice==="meet"&&(F=D=D>F?F:D),H.meetOrSlice==="slice"&&(F=D=D>F?D:F),J=V.width-$*D,ie=V.height-q*D,H.alignX==="Mid"&&(J/=2),H.alignY==="Mid"&&(ie/=2),H.alignX==="Min"&&(J=0),H.alignY==="Min"&&(ie=0)),D===1&&F===1&&X===0&&W===0&&U===0&&z===0)return V;if((U||z)&&P.parentNode.nodeName!=="#document"&&(ce=" translate("+a(U)+" "+a(z)+") "),oe=ce+" matrix("+D+" 0 0 "+F+" "+(X*D+J)+" "+(W*F+ie)+") ",P.nodeName==="svg"){for(I=P.ownerDocument.createElementNS(s.svgNS,"g");P.firstChild;)I.appendChild(P.firstChild);P.appendChild(I)}else I=P,I.removeAttribute("x"),I.removeAttribute("y"),oe=I.getAttribute("transform")+oe;return I.setAttribute("transform",oe),V}function A(P,k){for(;P&&(P=P.parentNode);)if(P.nodeName&&k.test(P.nodeName.replace("svg:",""))&&!P.getAttribute("instantiated_by_use"))return!0;return!1}s.parseSVGDocument=function(P,k,D,F){if(P){Y(P);var X=s.Object.__uid++,W,$,q=O(P),oe=s.util.toArray(P.getElementsByTagName("*"));if(q.crossOrigin=F&&F.crossOrigin,q.svgUid=X,oe.length===0&&s.isLikelyNode){oe=P.selectNodes('//*[name(.)!="svg"]');var I=[];for(W=0,$=oe.length;W<$;W++)I[W]=oe[W];oe=I}var j=oe.filter(function(U){return O(U),s.svgValidTagNamesRegEx.test(U.nodeName.replace("svg:",""))&&!A(U,s.svgInvalidAncestorsRegEx)});if(!j||j&&!j.length){k&&k([],{});return}var R={};oe.filter(function(U){return U.nodeName.replace("svg:","")==="clipPath"}).forEach(function(U){var z=U.getAttribute("id");R[z]=s.util.toArray(U.getElementsByTagName("*")).filter(function(H){return s.svgValidTagNamesRegEx.test(H.nodeName.replace("svg:",""))})}),s.gradientDefs[X]=s.getGradientDefs(P),s.cssRules[X]=s.getCSSRules(P),s.clipPaths[X]=R,s.parseElements(j,function(U,z){k&&(k(U,q,z,oe),delete s.gradientDefs[X],delete s.cssRules[X],delete s.clipPaths[X])},h(q),D,F)}};function M(P,k){var D=["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"],F="xlink:href",X=k.getAttribute(F).slice(1),W=le(P,X);if(W&&W.getAttribute(F)&&M(P,W),D.forEach(function(q){W&&!k.hasAttribute(q)&&W.hasAttribute(q)&&k.setAttribute(q,W.getAttribute(q))}),!k.children.length)for(var $=W.cloneNode(!0);$.firstChild;)k.appendChild($.firstChild);k.removeAttribute(F)}var B=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");u(s,{parseFontDeclaration:function(P,k){var D=P.match(B);if(D){var F=D[1],X=D[3],W=D[4],$=D[5],q=D[6];F&&(k.fontStyle=F),X&&(k.fontWeight=isNaN(parseFloat(X))?X:parseFloat(X)),W&&(k.fontSize=a(W)),q&&(k.fontFamily=q),$&&(k.lineHeight=$==="normal"?1:$)}},getGradientDefs:function(P){var k=["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"],D=L(P,k),F,X=0,W={};for(X=D.length;X--;)F=D[X],F.getAttribute("xlink:href")&&M(P,F),W[F.getAttribute("id")]=F;return W},parseAttributes:function(P,k,D){if(P){var F,X={},W,$;typeof D>"u"&&(D=P.getAttribute("svgUid")),P.parentNode&&s.svgValidParentsRegEx.test(P.parentNode.nodeName)&&(X=s.parseAttributes(P.parentNode,k,D));var q=k.reduce(function(H,ee){return F=P.getAttribute(ee),F&&(H[ee]=F),H},{}),oe=u(Z(P,D),s.parseStyleAttribute(P));q=u(q,oe),oe[S]&&P.setAttribute(S,oe[S]),W=$=X.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,q[x]&&(q[x]=W=a(q[x],$));var I,j,R={};for(var U in q)I=b(U),j=T(I,q[U],X,W),R[I]=j;R&&R.font&&s.parseFontDeclaration(R.font,R);var z=u(X,R);return s.svgValidParentsRegEx.test(P.nodeName)?z:N(z)}},parseElements:function(P,k,D,F,X){new s.ElementsParser(P,k,D,F,X).parse()},parseStyleAttribute:function(P){var k={},D=P.getAttribute("style");return D&&(typeof D=="string"?G(D,k):Q(D,k)),k},parsePointsAttribute:function(P){if(!P)return null;P=P.replace(/,/g," ").trim(),P=P.split(/\s+/);var k=[],D,F;for(D=0,F=P.length;D<F;D+=2)k.push({x:parseFloat(P[D]),y:parseFloat(P[D+1])});return k},getCSSRules:function(P){var k=P.getElementsByTagName("style"),D,F,X={},W;for(D=0,F=k.length;D<F;D++){var $=k[D].textContent;$=$.replace(/\/\*[\s\S]*?\*\//g,""),$.trim()!==""&&(W=$.split("}"),W=W.filter(function(q){return q.trim()}),W.forEach(function(q){var oe=q.split("{"),I={},j=oe[1].trim(),R=j.split(";").filter(function(ee){return ee.trim()});for(D=0,F=R.length;D<F;D++){var U=R[D].split(":"),z=U[0].trim(),H=U[1].trim();I[z]=H}q=oe[0].trim(),q.split(",").forEach(function(ee){ee=ee.replace(/^svg/i,"").trim(),ee!==""&&(X[ee]?s.util.object.extend(X[ee],I):X[ee]=s.util.object.clone(I))})}))}return X},loadSVGFromURL:function(P,k,D,F){P=P.replace(/^\n\s*/,"").trim(),new s.util.request(P,{method:"get",onComplete:X});function X(W){var $=W.responseXML;if(!$||!$.documentElement)return k&&k(null),!1;s.parseSVGDocument($.documentElement,function(q,oe,I,j){k&&k(q,oe,I,j)},D,F)}},loadSVGFromString:function(P,k,D,F){var X=new s.window.DOMParser,W=X.parseFromString(P.trim(),"text/xml");s.parseSVGDocument(W.documentElement,function($,q,oe,I){k($,q,oe,I)},D,F)}})}(t),e.ElementsParser=function(d,s,u,h,r,a){this.elements=d,this.callback=s,this.options=u,this.reviver=h,this.svgUid=u&&u.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=a},function(d){d.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},d.createObjects=function(){var s=this;this.elements.forEach(function(u,h){u.setAttribute("svgUid",s.svgUid),s.createObject(u,h)})},d.findTag=function(s){return e[e.util.string.capitalize(s.tagName.replace("svg:",""))]},d.createObject=function(s,u){var h=this.findTag(s);if(h&&h.fromElement)try{h.fromElement(s,this.createCallback(u,s),this.options)}catch(r){e.log(r)}else this.checkIfDone()},d.createCallback=function(s,u){var h=this;return function(r){var a;h.resolveGradient(r,u,"fill"),h.resolveGradient(r,u,"stroke"),r instanceof e.Image&&r._originalElement&&(a=r.parsePreserveAspectRatioAttribute(u)),r._removeTransformMatrix(a),h.resolveClipPath(r,u),h.reviver&&h.reviver(u,r),h.instances[s]=r,h.checkIfDone()}},d.extractPropertyDefinition=function(s,u,h){var r=s[u],a=this.regexUrl;if(a.test(r)){a.lastIndex=0;var i=a.exec(r)[1];return a.lastIndex=0,e[h][this.svgUid][i]}},d.resolveGradient=function(s,u,h){var r=this.extractPropertyDefinition(s,h,"gradientDefs");if(r){var a=u.getAttribute(h+"-opacity"),i=e.Gradient.fromElement(r,s,a,this.options);s.set(h,i)}},d.createClipPathCallback=function(s,u){return function(h){h._removeTransformMatrix(),h.fillRule=h.clipRule,u.push(h)}},d.resolveClipPath=function(s,u){var h=this.extractPropertyDefinition(s,"clipPath","clipPaths"),r,a,i,o,f,l;if(h){o=[],i=e.util.invertTransform(s.calcTransformMatrix());for(var g=h[0].parentNode,m=u;m.parentNode&&m.getAttribute("clip-path")!==s.clipPath;)m=m.parentNode;m.parentNode.appendChild(g);for(var v=0;v<h.length;v++)r=h[v],a=this.findTag(r),a.fromElement(r,this.createClipPathCallback(s,o),this.options);o.length===1?h=o[0]:h=new e.Group(o),f=e.util.multiplyTransformMatrices(i,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,m);var l=e.util.qrDecompose(f);h.flipX=!1,h.flipY=!1,h.set("scaleX",l.scaleX),h.set("scaleY",l.scaleY),h.angle=l.angle,h.skewX=l.skewX,h.skewY=0,h.setPositionByOrigin({x:l.translateX,y:l.translateY},"center","center"),s.clipPath=h}else delete s.clipPath},d.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(s){return s!=null}),this.callback(this.instances,this.elements))}}(e.ElementsParser.prototype),function(d){var s=d.fabric||(d.fabric={});if(s.Point){s.warn("fabric.Point is already defined");return}s.Point=u;function u(h,r){this.x=h,this.y=r}u.prototype={type:"point",constructor:u,add:function(h){return new u(this.x+h.x,this.y+h.y)},addEquals:function(h){return this.x+=h.x,this.y+=h.y,this},scalarAdd:function(h){return new u(this.x+h,this.y+h)},scalarAddEquals:function(h){return this.x+=h,this.y+=h,this},subtract:function(h){return new u(this.x-h.x,this.y-h.y)},subtractEquals:function(h){return this.x-=h.x,this.y-=h.y,this},scalarSubtract:function(h){return new u(this.x-h,this.y-h)},scalarSubtractEquals:function(h){return this.x-=h,this.y-=h,this},multiply:function(h){return new u(this.x*h,this.y*h)},multiplyEquals:function(h){return this.x*=h,this.y*=h,this},divide:function(h){return new u(this.x/h,this.y/h)},divideEquals:function(h){return this.x/=h,this.y/=h,this},eq:function(h){return this.x===h.x&&this.y===h.y},lt:function(h){return this.x<h.x&&this.y<h.y},lte:function(h){return this.x<=h.x&&this.y<=h.y},gt:function(h){return this.x>h.x&&this.y>h.y},gte:function(h){return this.x>=h.x&&this.y>=h.y},lerp:function(h,r){return typeof r>"u"&&(r=.5),r=Math.max(Math.min(1,r),0),new u(this.x+(h.x-this.x)*r,this.y+(h.y-this.y)*r)},distanceFrom:function(h){var r=this.x-h.x,a=this.y-h.y;return Math.sqrt(r*r+a*a)},midPointFrom:function(h){return this.lerp(h)},min:function(h){return new u(Math.min(this.x,h.x),Math.min(this.y,h.y))},max:function(h){return new u(Math.max(this.x,h.x),Math.max(this.y,h.y))},toString:function(){return this.x+","+this.y},setXY:function(h,r){return this.x=h,this.y=r,this},setX:function(h){return this.x=h,this},setY:function(h){return this.y=h,this},setFromPoint:function(h){return this.x=h.x,this.y=h.y,this},swap:function(h){var r=this.x,a=this.y;this.x=h.x,this.y=h.y,h.x=r,h.y=a},clone:function(){return new u(this.x,this.y)}}}(t),function(d){var s=d.fabric||(d.fabric={});if(s.Intersection){s.warn("fabric.Intersection is already defined");return}function u(h){this.status=h,this.points=[]}s.Intersection=u,s.Intersection.prototype={constructor:u,appendPoint:function(h){return this.points.push(h),this},appendPoints:function(h){return this.points=this.points.concat(h),this}},s.Intersection.intersectLineLine=function(h,r,a,i){var o,f=(i.x-a.x)*(h.y-a.y)-(i.y-a.y)*(h.x-a.x),l=(r.x-h.x)*(h.y-a.y)-(r.y-h.y)*(h.x-a.x),g=(i.y-a.y)*(r.x-h.x)-(i.x-a.x)*(r.y-h.y);if(g!==0){var m=f/g,v=l/g;0<=m&&m<=1&&0<=v&&v<=1?(o=new u("Intersection"),o.appendPoint(new s.Point(h.x+m*(r.x-h.x),h.y+m*(r.y-h.y)))):o=new u}else f===0||l===0?o=new u("Coincident"):o=new u("Parallel");return o},s.Intersection.intersectLinePolygon=function(h,r,a){var i=new u,o=a.length,f,l,g,m;for(m=0;m<o;m++)f=a[m],l=a[(m+1)%o],g=u.intersectLineLine(h,r,f,l),i.appendPoints(g.points);return i.points.length>0&&(i.status="Intersection"),i},s.Intersection.intersectPolygonPolygon=function(h,r){var a=new u,i=h.length,o;for(o=0;o<i;o++){var f=h[o],l=h[(o+1)%i],g=u.intersectLinePolygon(f,l,r);a.appendPoints(g.points)}return a.points.length>0&&(a.status="Intersection"),a},s.Intersection.intersectPolygonRectangle=function(h,r,a){var i=r.min(a),o=r.max(a),f=new s.Point(o.x,i.y),l=new s.Point(i.x,o.y),g=u.intersectLinePolygon(i,f,h),m=u.intersectLinePolygon(f,o,h),v=u.intersectLinePolygon(o,l,h),x=u.intersectLinePolygon(l,i,h),S=new u;return S.appendPoints(g.points),S.appendPoints(m.points),S.appendPoints(v.points),S.appendPoints(x.points),S.points.length>0&&(S.status="Intersection"),S}}(t),function(d){var s=d.fabric||(d.fabric={});if(s.Color){s.warn("fabric.Color is already defined.");return}function u(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}s.Color=u,s.Color.prototype={_tryParsingColor:function(r){var a;r in u.colorNameMap&&(r=u.colorNameMap[r]),r==="transparent"&&(a=[255,255,255,0]),a||(a=u.sourceFromHex(r)),a||(a=u.sourceFromRgb(r)),a||(a=u.sourceFromHsl(r)),a||(a=[0,0,0,1]),a&&this.setSource(a)},_rgbToHsl:function(r,a,i){r/=255,a/=255,i/=255;var o,f,l,g=s.util.array.max([r,a,i]),m=s.util.array.min([r,a,i]);if(l=(g+m)/2,g===m)o=f=0;else{var v=g-m;switch(f=l>.5?v/(2-g-m):v/(g+m),g){case r:o=(a-i)/v+(a<i?6:0);break;case a:o=(i-r)/v+2;break;case i:o=(r-a)/v+4;break}o/=6}return[Math.round(o*360),Math.round(f*100),Math.round(l*100)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),a=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+a[0]+","+a[1]+"%,"+a[2]+"%)"},toHsla:function(){var r=this.getSource(),a=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+a[0]+","+a[1]+"%,"+a[2]+"%,"+r[3]+")"},toHex:function(){var r=this.getSource(),a,i,o;return a=r[0].toString(16),a=a.length===1?"0"+a:a,i=r[1].toString(16),i=i.length===1?"0"+i:i,o=r[2].toString(16),o=o.length===1?"0"+o:o,a.toUpperCase()+i.toUpperCase()+o.toUpperCase()},toHexa:function(){var r=this.getSource(),a;return a=Math.round(r[3]*255),a=a.toString(16),a=a.length===1?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var a=this.getSource();return a[3]=r,this.setSource(a),this},toGrayscale:function(){var r=this.getSource(),a=parseInt((r[0]*.3+r[1]*.59+r[2]*.11).toFixed(0),10),i=r[3];return this.setSource([a,a,a,i]),this},toBlackWhite:function(r){var a=this.getSource(),i=(a[0]*.3+a[1]*.59+a[2]*.11).toFixed(0),o=a[3];return r=r||127,i=Number(i)<Number(r)?0:255,this.setSource([i,i,i,o]),this},overlayWith:function(r){r instanceof u||(r=new u(r));var a=[],i=this.getAlpha(),o=.5,f=this.getSource(),l=r.getSource(),g;for(g=0;g<3;g++)a.push(Math.round(f[g]*(1-o)+l[g]*o));return a[3]=i,this.setSource(a),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"};function h(r,a,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?r+(a-r)*6*i:i<1/2?a:i<2/3?r+(a-r)*(2/3-i)*6:r}s.Color.fromRgb=function(r){return u.fromSource(u.sourceFromRgb(r))},s.Color.sourceFromRgb=function(r){var a=r.match(u.reRGBa);if(a){var i=parseInt(a[1],10)/(/%$/.test(a[1])?100:1)*(/%$/.test(a[1])?255:1),o=parseInt(a[2],10)/(/%$/.test(a[2])?100:1)*(/%$/.test(a[2])?255:1),f=parseInt(a[3],10)/(/%$/.test(a[3])?100:1)*(/%$/.test(a[3])?255:1);return[parseInt(i,10),parseInt(o,10),parseInt(f,10),a[4]?parseFloat(a[4]):1]}},s.Color.fromRgba=u.fromRgb,s.Color.fromHsl=function(r){return u.fromSource(u.sourceFromHsl(r))},s.Color.sourceFromHsl=function(r){var a=r.match(u.reHSLa);if(a){var i=(parseFloat(a[1])%360+360)%360/360,o=parseFloat(a[2])/(/%$/.test(a[2])?100:1),f=parseFloat(a[3])/(/%$/.test(a[3])?100:1),l,g,m;if(o===0)l=g=m=f;else{var v=f<=.5?f*(o+1):f+o-f*o,x=f*2-v;l=h(x,v,i+1/3),g=h(x,v,i),m=h(x,v,i-1/3)}return[Math.round(l*255),Math.round(g*255),Math.round(m*255),a[4]?parseFloat(a[4]):1]}},s.Color.fromHsla=u.fromHsl,s.Color.fromHex=function(r){return u.fromSource(u.sourceFromHex(r))},s.Color.sourceFromHex=function(r){if(r.match(u.reHex)){var a=r.slice(r.indexOf("#")+1),i=a.length===3||a.length===4,o=a.length===8||a.length===4,f=i?a.charAt(0)+a.charAt(0):a.substring(0,2),l=i?a.charAt(1)+a.charAt(1):a.substring(2,4),g=i?a.charAt(2)+a.charAt(2):a.substring(4,6),m=o?i?a.charAt(3)+a.charAt(3):a.substring(6,8):"FF";return[parseInt(f,16),parseInt(l,16),parseInt(g,16),parseFloat((parseInt(m,16)/255).toFixed(2))]}},s.Color.fromSource=function(r){var a=new u;return a.setSource(r),a}}(t),function(d){var s=d.fabric||(d.fabric={}),u=["e","se","s","sw","w","nw","n","ne","e"],h=["ns","nesw","ew","nwse"],r={},a="left",i="top",o="right",f="bottom",l="center",g={top:f,bottom:i,left:o,right:a,center:l},m=s.util.radiansToDegrees,v=Math.sign||function(I){return(I>0)-(I<0)||+I};function x(I,j){var R=I.angle+m(Math.atan2(j.y,j.x))+360;return Math.round(R%360/45)}function S(I,j){var R=j.transform.target,U=R.canvas,z=s.util.object.clone(j);z.target=R,U&&U.fire("object:"+I,z),R.fire(I,j)}function b(I,j){var R=j.canvas,U=R.uniScaleKey,z=I[U];return R.uniformScaling&&!z||!R.uniformScaling&&z}function T(I){return I.originX===l&&I.originY===l}function E(I,j,R){var U=I.lockScalingX,z=I.lockScalingY;return!!(U&&z||!j&&(U||z)&&R||U&&j==="x"||z&&j==="y")}function N(I,j,R){var U="not-allowed",z=b(I,R),H="";if(j.x!==0&&j.y===0?H="x":j.x===0&&j.y!==0&&(H="y"),E(R,H,z))return U;var ee=x(R,j);return u[ee]+"-resize"}function L(I,j,R){var U="not-allowed";if(j.x!==0&&R.lockSkewingY||j.y!==0&&R.lockSkewingX)return U;var z=x(R,j)%4;return h[z]+"-resize"}function G(I,j,R){return I[R.canvas.altActionKey]?r.skewCursorStyleHandler(I,j,R):r.scaleCursorStyleHandler(I,j,R)}function Q(I,j,R){var U=I[R.canvas.altActionKey];if(j.x===0)return U?"skewX":"scaleY";if(j.y===0)return U?"skewY":"scaleX"}function Z(I,j,R){return R.lockRotation?"not-allowed":j.cursorStyle}function te(I,j,R,U){return{e:I,transform:j,pointer:{x:R,y:U}}}function K(I){return function(j,R,U,z){var H=R.target,ee=H.getCenterPoint(),ae=H.translateToOriginPoint(ee,R.originX,R.originY),se=I(j,R,U,z);return H.setPositionByOrigin(ae,R.originX,R.originY),se}}function ne(I,j){return function(R,U,z,H){var ee=j(R,U,z,H);return ee&&S(I,te(R,U,z,H)),ee}}function le(I,j,R,U,z){var H=I.target,ee=H.controls[I.corner],ae=H.canvas.getZoom(),se=H.padding/ae,V=H.toLocalPoint(new s.Point(U,z),j,R);return V.x>=se&&(V.x-=se),V.x<=-se&&(V.x+=se),V.y>=se&&(V.y-=se),V.y<=se&&(V.y+=se),V.x-=ee.offsetX,V.y-=ee.offsetY,V}function Y(I){return I.flipX!==I.flipY}function _(I,j,R,U,z){if(I[j]!==0){var H=I._getTransformedDimensions()[U],ee=z/H*I[R];I.set(R,ee)}}function O(I,j,R,U){var z=j.target,H=z._getTransformedDimensions(0,z.skewY),ee=le(j,j.originX,j.originY,R,U),ae=Math.abs(ee.x*2)-H.x,se=z.skewX,V;ae<2?V=0:(V=m(Math.atan2(ae/z.scaleX,H.y/z.scaleY)),j.originX===a&&j.originY===f&&(V=-V),j.originX===o&&j.originY===i&&(V=-V),Y(z)&&(V=-V));var ce=se!==V;if(ce){var J=z._getTransformedDimensions().y;z.set("skewX",V),_(z,"skewY","scaleY","y",J)}return ce}function A(I,j,R,U){var z=j.target,H=z._getTransformedDimensions(z.skewX,0),ee=le(j,j.originX,j.originY,R,U),ae=Math.abs(ee.y*2)-H.y,se=z.skewY,V;ae<2?V=0:(V=m(Math.atan2(ae/z.scaleY,H.x/z.scaleX)),j.originX===a&&j.originY===f&&(V=-V),j.originX===o&&j.originY===i&&(V=-V),Y(z)&&(V=-V));var ce=se!==V;if(ce){var J=z._getTransformedDimensions().x;z.set("skewY",V),_(z,"skewX","scaleX","x",J)}return ce}function M(I,j,R,U){var z=j.target,H=z.skewX,ee,ae=j.originY;if(z.lockSkewingX)return!1;if(H===0){var se=le(j,l,l,R,U);se.x>0?ee=a:ee=o}else H>0&&(ee=ae===i?a:o),H<0&&(ee=ae===i?o:a),Y(z)&&(ee=ee===a?o:a);j.originX=ee;var V=ne("skewing",K(O));return V(I,j,R,U)}function B(I,j,R,U){var z=j.target,H=z.skewY,ee,ae=j.originX;if(z.lockSkewingY)return!1;if(H===0){var se=le(j,l,l,R,U);se.y>0?ee=i:ee=f}else H>0&&(ee=ae===a?i:f),H<0&&(ee=ae===a?f:i),Y(z)&&(ee=ee===i?f:i);j.originY=ee;var V=ne("skewing",K(A));return V(I,j,R,U)}function P(I,j,R,U){var z=j,H=z.target,ee=H.translateToOriginPoint(H.getCenterPoint(),z.originX,z.originY);if(H.lockRotation)return!1;var ae=Math.atan2(z.ey-ee.y,z.ex-ee.x),se=Math.atan2(U-ee.y,R-ee.x),V=m(se-ae+z.theta),ce=!0;if(H.snapAngle>0){var J=H.snapAngle,ie=H.snapThreshold||J,he=Math.ceil(V/J)*J,de=Math.floor(V/J)*J;Math.abs(V-de)<ie?V=de:Math.abs(V-he)<ie&&(V=he)}return V<0&&(V=360+V),V%=360,ce=H.angle!==V,H.angle=V,ce}function k(I,j,R,U,z){z=z||{};var H=j.target,ee=H.lockScalingX,ae=H.lockScalingY,se=z.by,V,ce,J,ie,he=b(I,H),de=E(H,se,he),Se,Ce,kt=j.gestureScale;if(de)return!1;if(kt)ce=j.scaleX*kt,J=j.scaleY*kt;else{if(V=le(j,j.originX,j.originY,R,U),Se=se!=="y"?v(V.x):1,Ce=se!=="x"?v(V.y):1,j.signX||(j.signX=Se),j.signY||(j.signY=Ce),H.lockScalingFlip&&(j.signX!==Se||j.signY!==Ce))return!1;if(ie=H._getTransformedDimensions(),he&&!se){var on=Math.abs(V.x)+Math.abs(V.y),st=j.original,bs=Math.abs(ie.x*st.scaleX/H.scaleX)+Math.abs(ie.y*st.scaleY/H.scaleY),dt=on/bs;ce=st.scaleX*dt,J=st.scaleY*dt}else ce=Math.abs(V.x*H.scaleX/ie.x),J=Math.abs(V.y*H.scaleY/ie.y);T(j)&&(ce*=2,J*=2),j.signX!==Se&&se!=="y"&&(j.originX=g[j.originX],ce*=-1,j.signX=Se),j.signY!==Ce&&se!=="x"&&(j.originY=g[j.originY],J*=-1,j.signY=Ce)}var Rt=H.scaleX,ri=H.scaleY;return se?(se==="x"&&H.set("scaleX",ce),se==="y"&&H.set("scaleY",J)):(!ee&&H.set("scaleX",ce),!ae&&H.set("scaleY",J)),Rt!==H.scaleX||ri!==H.scaleY}function D(I,j,R,U){return k(I,j,R,U)}function F(I,j,R,U){return k(I,j,R,U,{by:"x"})}function X(I,j,R,U){return k(I,j,R,U,{by:"y"})}function W(I,j,R,U){return I[j.target.canvas.altActionKey]?r.skewHandlerX(I,j,R,U):r.scalingY(I,j,R,U)}function $(I,j,R,U){return I[j.target.canvas.altActionKey]?r.skewHandlerY(I,j,R,U):r.scalingX(I,j,R,U)}function q(I,j,R,U){var z=j.target,H=le(j,j.originX,j.originY,R,U),ee=z.strokeWidth/(z.strokeUniform?z.scaleX:1),ae=T(j)?2:1,se=z.width,V=Math.abs(H.x*ae/z.scaleX)-ee;return z.set("width",Math.max(V,0)),se!==V}function oe(I,j,R,U){var z=j.target,H=R-j.offsetX,ee=U-j.offsetY,ae=!z.get("lockMovementX")&&z.left!==H,se=!z.get("lockMovementY")&&z.top!==ee;return ae&&z.set("left",H),se&&z.set("top",ee),(ae||se)&&S("moving",te(I,j,R,U)),ae||se}r.scaleCursorStyleHandler=N,r.skewCursorStyleHandler=L,r.scaleSkewCursorStyleHandler=G,r.rotationWithSnapping=ne("rotating",K(P)),r.scalingEqually=ne("scaling",K(D)),r.scalingX=ne("scaling",K(F)),r.scalingY=ne("scaling",K(X)),r.scalingYOrSkewingX=W,r.scalingXOrSkewingY=$,r.changeWidth=ne("resizing",K(q)),r.skewHandlerX=M,r.skewHandlerY=B,r.dragHandler=oe,r.scaleOrSkewActionName=Q,r.rotationStyleHandler=Z,r.fireEvent=S,r.wrapWithFixedAnchor=K,r.wrapWithFireEvent=ne,r.getLocalPoint=le,s.controlsUtils=r}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.degreesToRadians,h=s.controlsUtils;function r(i,o,f,l,g){l=l||{};var m=this.sizeX||l.cornerSize||g.cornerSize,v=this.sizeY||l.cornerSize||g.cornerSize,x=typeof l.transparentCorners<"u"?l.transparentCorners:g.transparentCorners,S=x?"stroke":"fill",b=!x&&(l.cornerStrokeColor||g.cornerStrokeColor),T=o,E=f,N;i.save(),i.fillStyle=l.cornerColor||g.cornerColor,i.strokeStyle=l.cornerStrokeColor||g.cornerStrokeColor,m>v?(N=m,i.scale(1,v/m),E=f*m/v):v>m?(N=v,i.scale(m/v,1),T=o*v/m):N=m,i.lineWidth=1,i.beginPath(),i.arc(T,E,N/2,0,2*Math.PI,!1),i[S](),b&&i.stroke(),i.restore()}function a(i,o,f,l,g){l=l||{};var m=this.sizeX||l.cornerSize||g.cornerSize,v=this.sizeY||l.cornerSize||g.cornerSize,x=typeof l.transparentCorners<"u"?l.transparentCorners:g.transparentCorners,S=x?"stroke":"fill",b=!x&&(l.cornerStrokeColor||g.cornerStrokeColor),T=m/2,E=v/2;i.save(),i.fillStyle=l.cornerColor||g.cornerColor,i.strokeStyle=l.cornerStrokeColor||g.cornerStrokeColor,i.lineWidth=1,i.translate(o,f),i.rotate(u(g.angle)),i[S+"Rect"](-T,-E,m,v),b&&i.strokeRect(-T,-E,m,v),i.restore()}h.renderCircleControl=r,h.renderSquareControl=a}(t),function(d){var s=d.fabric||(d.fabric={});function u(h){for(var r in h)this[r]=h[r]}s.Control=u,s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(h,r){return r.cursorStyle},getActionName:function(h,r){return r.actionName},getVisibility:function(h,r){var a=h._controlsVisibility;return a&&typeof a[r]<"u"?a[r]:this.visible},setVisibility:function(h){this.visible=h},positionHandler:function(h,r){var a=s.util.transformPoint({x:this.x*h.x+this.offsetX,y:this.y*h.y+this.offsetY},r);return a},calcCornerCoords:function(h,r,a,i,o){var f,l,g,m,v=o?this.touchSizeX:this.sizeX,x=o?this.touchSizeY:this.sizeY;if(v&&x&&v!==x){var S=Math.atan2(x,v),b=Math.sqrt(v*v+x*x)/2,T=S-s.util.degreesToRadians(h),E=Math.PI/2-S-s.util.degreesToRadians(h);f=b*s.util.cos(T),l=b*s.util.sin(T),g=b*s.util.cos(E),m=b*s.util.sin(E)}else{var N=v&&x?v:r;b=N*.7071067812;var T=s.util.degreesToRadians(45-h);f=g=b*s.util.cos(T),l=m=b*s.util.sin(T)}return{tl:{x:a-m,y:i-g},tr:{x:a+f,y:i-l},bl:{x:a-f,y:i+l},br:{x:a+m,y:i+g}}},render:function(h,r,a,i,o){switch(i=i||{},i.cornerStyle||o.cornerStyle){case"circle":s.controlsUtils.renderCircleControl.call(this,h,r,a,i,o);break;default:s.controlsUtils.renderSquareControl.call(this,h,r,a,i,o)}}}}(t),function(){function d(a,i){var o=a.getAttribute("style"),f=a.getAttribute("offset")||0,l,g,m,v;if(f=parseFloat(f)/(/%$/.test(f)?100:1),f=f<0?0:f>1?1:f,o){var x=o.split(/\s*;\s*/);for(x[x.length-1]===""&&x.pop(),v=x.length;v--;){var S=x[v].split(/\s*:\s*/),b=S[0].trim(),T=S[1].trim();b==="stop-color"?l=T:b==="stop-opacity"&&(m=T)}}return l||(l=a.getAttribute("stop-color")||"rgb(0,0,0)"),m||(m=a.getAttribute("stop-opacity")),l=new e.Color(l),g=l.getAlpha(),m=isNaN(parseFloat(m))?1:parseFloat(m),m*=g*i,{offset:f,color:l.toRgb(),opacity:m}}function s(a){return{x1:a.getAttribute("x1")||0,y1:a.getAttribute("y1")||0,x2:a.getAttribute("x2")||"100%",y2:a.getAttribute("y2")||0}}function u(a){return{x1:a.getAttribute("fx")||a.getAttribute("cx")||"50%",y1:a.getAttribute("fy")||a.getAttribute("cy")||"50%",r1:0,x2:a.getAttribute("cx")||"50%",y2:a.getAttribute("cy")||"50%",r2:a.getAttribute("r")||"50%"}}var h=e.util.object.clone;e.Gradient=e.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var i,o=this;Object.keys(a).forEach(function(f){o[f]=a[f]}),this.id?this.id+="_"+e.Object.__uid++:this.id=e.Object.__uid++,i={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(i.r1=a.coords.r1||0,i.r2=a.coords.r2||0),this.coords=i,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var i in a){var o=new e.Color(a[i]);this.colorStops.push({offset:parseFloat(i),color:o.toRgb(),opacity:o.getAlpha()})}return this},toObject:function(a){var i={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return e.util.populateWithProperties(this,i,a),i},toSVG:function(a,g){var o=h(this.coords,!0),f,l,g=g||{},m,v,x=h(this.colorStops,!0),S=o.r1>o.r2,b=this.gradientTransform?this.gradientTransform.concat():e.iMatrix.concat(),T=-this.offsetX,E=-this.offsetY,N=!!g.additionalTransform,L=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(x.sort(function(K,ne){return K.offset-ne.offset}),L==="objectBoundingBox"?(T/=a.width,E/=a.height):(T+=a.width/2,E+=a.height/2),a.type==="path"&&this.gradientUnits!=="percentage"&&(T-=a.pathOffset.x,E-=a.pathOffset.y),b[4]-=T,b[5]-=E,v='id="SVGID_'+this.id+'" gradientUnits="'+L+'"',v+=' gradientTransform="'+(N?g.additionalTransform+" ":"")+e.util.matrixToSVG(b)+'" ',this.type==="linear"?m=["<linearGradient ",v,' x1="',o.x1,'" y1="',o.y1,'" x2="',o.x2,'" y2="',o.y2,`">
`]:this.type==="radial"&&(m=["<radialGradient ",v,' cx="',S?o.x1:o.x2,'" cy="',S?o.y1:o.y2,'" r="',S?o.r1:o.r2,'" fx="',S?o.x2:o.x1,'" fy="',S?o.y2:o.y1,`">
`]),this.type==="radial"){if(S)for(x=x.concat(),x.reverse(),f=0,l=x.length;f<l;f++)x[f].offset=1-x[f].offset;var G=Math.min(o.r1,o.r2);if(G>0){var Q=Math.max(o.r1,o.r2),Z=G/Q;for(f=0,l=x.length;f<l;f++)x[f].offset+=Z*(1-x[f].offset)}}for(f=0,l=x.length;f<l;f++){var te=x[f];m.push("<stop ",'offset="',te.offset*100+"%",'" style="stop-color:',te.color,typeof te.opacity<"u"?";stop-opacity: "+te.opacity:";",`"/>
`)}return m.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),m.join("")},toLive:function(a){var i,o=e.util.object.clone(this.coords),f,l;if(this.type){for(this.type==="linear"?i=a.createLinearGradient(o.x1,o.y1,o.x2,o.y2):this.type==="radial"&&(i=a.createRadialGradient(o.x1,o.y1,o.r1,o.x2,o.y2,o.r2)),f=0,l=this.colorStops.length;f<l;f++){var g=this.colorStops[f].color,m=this.colorStops[f].opacity,v=this.colorStops[f].offset;typeof m<"u"&&(g=new e.Color(g).setAlpha(m).toRgba()),i.addColorStop(v,g)}return i}}}),e.util.object.extend(e.Gradient,{fromElement:function(a,i,o,f){var l=parseFloat(o)/(/%$/.test(o)?100:1);l=l<0?0:l>1?1:l,isNaN(l)&&(l=1);var g=a.getElementsByTagName("stop"),m,v=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",x=a.getAttribute("gradientTransform")||"",S=[],b,T,E=0,N=0,L;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(m="linear",b=s(a)):(m="radial",b=u(a)),T=g.length;T--;)S.push(d(g[T],l));L=e.parseTransformAttribute(x),r(i,b,f,v),v==="pixels"&&(E=-i.left,N=-i.top);var G=new e.Gradient({id:a.getAttribute("id"),type:m,coords:b,colorStops:S,gradientUnits:v,gradientTransform:L,offsetX:E,offsetY:N});return G}});function r(a,i,o,f){var l,g;Object.keys(i).forEach(function(m){l=i[m],l==="Infinity"?g=1:l==="-Infinity"?g=0:(g=parseFloat(i[m],10),typeof l=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(l)&&(g*=.01,f==="pixels"&&((m==="x1"||m==="x2"||m==="r2")&&(g*=o.viewBoxWidth||o.width),(m==="y1"||m==="y2")&&(g*=o.viewBoxHeight||o.height)))),i[m]=g})}}(),function(){var d=e.util.toFixed;e.Pattern=e.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(s,u){if(s||(s={}),this.id=e.Object.__uid++,this.setOptions(s),!s.source||s.source&&typeof s.source!="string"){u&&u(this);return}else{var h=this;this.source=e.util.createImage(),e.util.loadImage(s.source,function(r,a){h.source=r,u&&u(h,a)},null,this.crossOrigin)}},toObject:function(s){var u=e.Object.NUM_FRACTION_DIGITS,h,r;return typeof this.source.src=="string"?h=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(h=this.source.toDataURL()),r={type:"pattern",source:h,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:d(this.offsetX,u),offsetY:d(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},e.util.populateWithProperties(this,r,s),r},toSVG:function(s){var u=typeof this.source=="function"?this.source():this.source,h=u.width/s.width,r=u.height/s.height,a=this.offsetX/s.width,i=this.offsetY/s.height,o="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(r=1,i&&(r+=Math.abs(i))),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(h=1,a&&(h+=Math.abs(a))),u.src?o=u.src:u.toDataURL&&(o=u.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+i+'" width="'+h+'" height="'+r+`">
<image x="0" y="0" width="`+u.width+'" height="'+u.height+'" xlink:href="'+o+`"></image>
</pattern>
`},setOptions:function(s){for(var u in s)this[u]=s[u]},toLive:function(s){var u=this.source;return!u||typeof u.src<"u"&&(!u.complete||u.naturalWidth===0||u.naturalHeight===0)?"":s.createPattern(u,this.repeat)}})}(),function(d){var s=d.fabric||(d.fabric={}),u=s.util.toFixed;if(s.Shadow){s.warn("fabric.Shadow is already defined.");return}s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(h){typeof h=="string"&&(h=this._parseShadow(h));for(var r in h)this[r]=h[r];this.id=s.Object.__uid++},_parseShadow:function(h){var r=h.trim(),a=s.Shadow.reOffsetsAndBlur.exec(r)||[],i=r.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseFloat(a[1],10)||0,offsetY:parseFloat(a[2],10)||0,blur:parseFloat(a[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(h){var r=40,a=40,i=s.Object.NUM_FRACTION_DIGITS,o=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-h.angle)),f=20,l=new s.Color(this.color);return h.width&&h.height&&(r=u((Math.abs(o.x)+this.blur)/h.width,i)*100+f,a=u((Math.abs(o.y)+this.blur)/h.height,i)*100+f),h.flipX&&(o.x*=-1),h.flipY&&(o.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+a+'%" height="'+(100+2*a)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+u(this.blur?this.blur/2:0,i)+`"></feGaussianBlur>
	<feOffset dx="`+u(o.x,i)+'" dy="'+u(o.y,i)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+l.toRgb()+'" flood-opacity="'+l.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var h={},r=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(a){this[a]!==r[a]&&(h[a]=this[a])},this),h}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/}(t),function(){if(e.StaticCanvas){e.warn("fabric.StaticCanvas is already defined.");return}var d=e.util.object.extend,s=e.util.getElementOffset,u=e.util.removeFromArray,h=e.util.toFixed,r=e.util.transformPoint,a=e.util.invertTransform,i=e.util.getNodeCanvas,o=e.util.createCanvasElement,f=new Error("Could not initialize `canvas` element");e.StaticCanvas=e.util.createClass(e.CommonMethods,{initialize:function(l,g){g||(g={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(l,g)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:e.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(l,g){var m=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(l),this._initOptions(g),this.interactive||this._initRetinaScaling(),g.overlayImage&&this.setOverlayImage(g.overlayImage,m),g.backgroundImage&&this.setBackgroundImage(g.backgroundImage,m),g.backgroundColor&&this.setBackgroundColor(g.backgroundColor,m),g.overlayColor&&this.setOverlayColor(g.overlayColor,m),this.calcOffset()},_isRetinaScaling:function(){return e.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,e.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var l=e.devicePixelRatio;this.__initRetinaScaling(l,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(l,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(l,g,m){g.setAttribute("width",this.width*l),g.setAttribute("height",this.height*l),m.scale(l,l)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(l,g,m){return this.__setBgOverlayImage("overlayImage",l,g,m)},setBackgroundImage:function(l,g,m){return this.__setBgOverlayImage("backgroundImage",l,g,m)},setOverlayColor:function(l,g){return this.__setBgOverlayColor("overlayColor",l,g)},setBackgroundColor:function(l,g){return this.__setBgOverlayColor("backgroundColor",l,g)},__setBgOverlayImage:function(l,g,m,v){return typeof g=="string"?e.util.loadImage(g,function(x,S){if(x){var b=new e.Image(x,v);this[l]=b,b.canvas=this}m&&m(x,S)},this,v&&v.crossOrigin):(v&&g.setOptions(v),this[l]=g,g&&(g.canvas=this),m&&m(g,!1)),this},__setBgOverlayColor:function(l,g,m){return this[l]=g,this._initGradient(g,l),this._initPattern(g,l,m),this},_createCanvasElement:function(){var l=o();if(!l||(l.style||(l.style={}),typeof l.getContext>"u"))throw f;return l},_initOptions:function(l){var g=this.lowerCanvasEl;this._setOptions(l),this.width=this.width||parseInt(g.width,10)||0,this.height=this.height||parseInt(g.height,10)||0,this.lowerCanvasEl.style&&(g.width=this.width,g.height=this.height,g.style.width=this.width+"px",g.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(l){l&&l.getContext?this.lowerCanvasEl=l:this.lowerCanvasEl=e.util.getById(l)||this._createCanvasElement(),e.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(l,g){return this.setDimensions({width:l},g)},setHeight:function(l,g){return this.setDimensions({height:l},g)},setDimensions:function(l,g){var m;g=g||{};for(var v in l)m=l[v],g.cssOnly||(this._setBackstoreDimension(v,l[v]),m+="px",this.hasLostContext=!0),g.backstoreOnly||this._setCssDimension(v,m);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),g.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(l,g){return this.lowerCanvasEl[l]=g,this.upperCanvasEl&&(this.upperCanvasEl[l]=g),this.cacheCanvasEl&&(this.cacheCanvasEl[l]=g),this[l]=g,this},_setCssDimension:function(l,g){return this.lowerCanvasEl.style[l]=g,this.upperCanvasEl&&(this.upperCanvasEl.style[l]=g),this.wrapperEl&&(this.wrapperEl.style[l]=g),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(l){var g=this._activeObject,m=this.backgroundImage,v=this.overlayImage,x,S,b;for(this.viewportTransform=l,S=0,b=this._objects.length;S<b;S++)x=this._objects[S],x.group||x.setCoords(!0);return g&&g.setCoords(),m&&m.setCoords(!0),v&&v.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(l,g){var m=l,v=this.viewportTransform.slice(0);l=r(l,a(this.viewportTransform)),v[0]=g,v[3]=g;var x=r(l,v);return v[4]+=m.x-x.x,v[5]+=m.y-x.y,this.setViewportTransform(v)},setZoom:function(l){return this.zoomToPoint(new e.Point(0,0),l),this},absolutePan:function(l){var g=this.viewportTransform.slice(0);return g[4]=-l.x,g[5]=-l.y,this.setViewportTransform(g)},relativePan:function(l){return this.absolutePan(new e.Point(-l.x-this.viewportTransform[4],-l.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(l){this.stateful&&l.setupState(),l._set("canvas",this),l.setCoords(),this.fire("object:added",{target:l}),l.fire("added")},_onObjectRemoved:function(l){this.fire("object:removed",{target:l}),l.fire("removed"),delete l.canvas},clearContext:function(l){return l.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var l=this.contextContainer;return this.renderCanvas(l,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=e.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var l={},g=this.width,m=this.height,v=a(this.viewportTransform);return l.tl=r({x:0,y:0},v),l.br=r({x:g,y:m},v),l.tr=new e.Point(l.br.x,l.tl.y),l.bl=new e.Point(l.tl.x,l.br.y),this.vptCoords=l,l},cancelRequestedRender:function(){this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(l,g){var m=this.viewportTransform,v=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(l),e.util.setImageSmoothing(l,this.imageSmoothingEnabled),this.fire("before:render",{ctx:l}),this._renderBackground(l),l.save(),l.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._renderObjects(l,g),l.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(l),v&&(v.canvas=this,v.shouldCache(),v._transformDone=!0,v.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(l)),this._renderOverlay(l),this.controlsAboveOverlay&&this.interactive&&this.drawControls(l),this.fire("after:render",{ctx:l})},drawClipPathOnCanvas:function(l){var g=this.viewportTransform,m=this.clipPath;l.save(),l.transform(g[0],g[1],g[2],g[3],g[4],g[5]),l.globalCompositeOperation="destination-in",m.transform(l),l.scale(1/m.zoomX,1/m.zoomY),l.drawImage(m._cacheCanvas,-m.cacheTranslationX,-m.cacheTranslationY),l.restore()},_renderObjects:function(l,g){var m,v;for(m=0,v=g.length;m<v;++m)g[m]&&g[m].render(l)},_renderBackgroundOrOverlay:function(l,g){var m=this[g+"Color"],v=this[g+"Image"],x=this.viewportTransform,S=this[g+"Vpt"];if(!(!m&&!v)){if(m){l.save(),l.beginPath(),l.moveTo(0,0),l.lineTo(this.width,0),l.lineTo(this.width,this.height),l.lineTo(0,this.height),l.closePath(),l.fillStyle=m.toLive?m.toLive(l,this):m,S&&l.transform(x[0],x[1],x[2],x[3],x[4],x[5]),l.transform(1,0,0,1,m.offsetX||0,m.offsetY||0);var b=m.gradientTransform||m.patternTransform;b&&l.transform(b[0],b[1],b[2],b[3],b[4],b[5]),l.fill(),l.restore()}if(v){l.save();var T=this.skipOffscreen;this.skipOffscreen=S,S&&l.transform(x[0],x[1],x[2],x[3],x[4],x[5]),v.render(l),this.skipOffscreen=T,l.restore()}}},_renderBackground:function(l){this._renderBackgroundOrOverlay(l,"background")},_renderOverlay:function(l){this._renderBackgroundOrOverlay(l,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new e.Point(this.width/2,this.height/2)},centerObjectH:function(l){return this._centerObject(l,new e.Point(this.getCenterPoint().x,l.getCenterPoint().y))},centerObjectV:function(l){return this._centerObject(l,new e.Point(l.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(l){var g=this.getCenterPoint();return this._centerObject(l,g)},viewportCenterObject:function(l){var g=this.getVpCenter();return this._centerObject(l,g)},viewportCenterObjectH:function(l){var g=this.getVpCenter();return this._centerObject(l,new e.Point(g.x,l.getCenterPoint().y)),this},viewportCenterObjectV:function(l){var g=this.getVpCenter();return this._centerObject(l,new e.Point(l.getCenterPoint().x,g.y))},getVpCenter:function(){var l=this.getCenterPoint(),g=a(this.viewportTransform);return r(l,g)},_centerObject:function(l,g){return l.setPositionByOrigin(g,"center","center"),l.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(l){return this.toDatalessObject(l)},toObject:function(l){return this._toObjectMethod("toObject",l)},toDatalessObject:function(l){return this._toObjectMethod("toDatalessObject",l)},_toObjectMethod:function(l,g){var m=this.clipPath,v={version:e.version,objects:this._toObjects(l,g)};return m&&!m.excludeFromExport&&(v.clipPath=this._toObject(this.clipPath,l,g)),d(v,this.__serializeBgOverlay(l,g)),e.util.populateWithProperties(this,v,g),v},_toObjects:function(l,g){return this._objects.filter(function(m){return!m.excludeFromExport}).map(function(m){return this._toObject(m,l,g)},this)},_toObject:function(l,g,m){var v;this.includeDefaultValues||(v=l.includeDefaultValues,l.includeDefaultValues=!1);var x=l[g](m);return this.includeDefaultValues||(l.includeDefaultValues=v),x},__serializeBgOverlay:function(l,g){var m={},v=this.backgroundImage,x=this.overlayImage,S=this.backgroundColor,b=this.overlayColor;return S&&S.toObject?S.excludeFromExport||(m.background=S.toObject(g)):S&&(m.background=S),b&&b.toObject?b.excludeFromExport||(m.overlay=b.toObject(g)):b&&(m.overlay=b),v&&!v.excludeFromExport&&(m.backgroundImage=this._toObject(v,l,g)),x&&!x.excludeFromExport&&(m.overlayImage=this._toObject(x,l,g)),m},svgViewportTransformation:!0,toSVG:function(l,g){l||(l={}),l.reviver=g;var m=[];return this._setSVGPreamble(m,l),this._setSVGHeader(m,l),this.clipPath&&m.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(m,"background"),this._setSVGBgOverlayImage(m,"backgroundImage",g),this._setSVGObjects(m,g),this.clipPath&&m.push(`</g>
`),this._setSVGBgOverlayColor(m,"overlay"),this._setSVGBgOverlayImage(m,"overlayImage",g),m.push("</svg>"),m.join("")},_setSVGPreamble:function(l,g){g.suppressPreamble||l.push('<?xml version="1.0" encoding="',g.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(l,g){var m=g.width||this.width,v=g.height||this.height,x,S='viewBox="0 0 '+this.width+" "+this.height+'" ',b=e.Object.NUM_FRACTION_DIGITS;g.viewBox?S='viewBox="'+g.viewBox.x+" "+g.viewBox.y+" "+g.viewBox.width+" "+g.viewBox.height+'" ':this.svgViewportTransformation&&(x=this.viewportTransform,S='viewBox="'+h(-x[4]/x[0],b)+" "+h(-x[5]/x[3],b)+" "+h(this.width/x[0],b)+" "+h(this.height/x[3],b)+'" '),l.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',m,'" ','height="',v,'" ',S,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",e.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(g),`</defs>
`)},createSVGClipPathMarkup:function(l){var g=this.clipPath;return g?(g.clipPathId="CLIPPATH_"+e.Object.__uid++,'<clipPath id="'+g.clipPathId+`" >
`+this.clipPath.toClipPathSVG(l.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var l=this,g=["background","overlay"].map(function(m){var v=l[m+"Color"];if(v&&v.toLive){var x=l[m+"Vpt"],S=l.viewportTransform,b={width:l.width/(x?S[0]:1),height:l.height/(x?S[3]:1)};return v.toSVG(b,{additionalTransform:x?e.util.matrixToSVG(S):""})}});return g.join("")},createSVGFontFacesMarkup:function(){var l="",g={},m,v,x,S,b,T,E,N,L,G=e.fontPaths,Q=[];for(this._objects.forEach(function te(K){Q.push(K),K._objects&&K._objects.forEach(te)}),N=0,L=Q.length;N<L;N++)if(m=Q[N],v=m.fontFamily,!(m.type.indexOf("text")===-1||g[v]||!G[v])&&(g[v]=!0,!!m.styles)){x=m.styles;for(b in x){S=x[b];for(E in S)T=S[E],v=T.fontFamily,!g[v]&&G[v]&&(g[v]=!0)}}for(var Z in g)l+=[`		@font-face {
`,"			font-family: '",Z,`';
`,"			src: url('",G[Z],`');
`,`		}
`].join("");return l&&(l=['	<style type="text/css">',`<![CDATA[
`,l,"]]>",`</style>
`].join("")),l},_setSVGObjects:function(l,g){var m,v,x,S=this._objects;for(v=0,x=S.length;v<x;v++)m=S[v],!m.excludeFromExport&&this._setSVGObject(l,m,g)},_setSVGObject:function(l,g,m){l.push(g.toSVG(m))},_setSVGBgOverlayImage:function(l,g,m){this[g]&&!this[g].excludeFromExport&&this[g].toSVG&&l.push(this[g].toSVG(m))},_setSVGBgOverlayColor:function(l,g){var m=this[g+"Color"],v=this.viewportTransform,x=this.width,S=this.height;if(m)if(m.toLive){var b=m.repeat,T=e.util.invertTransform(v),E=this[g+"Vpt"],N=E?e.util.matrixToSVG(T):"";l.push('<rect transform="'+N+" translate(",x/2,",",S/2,')"',' x="',m.offsetX-x/2,'" y="',m.offsetY-S/2,'" ','width="',b==="repeat-y"||b==="no-repeat"?m.source.width:x,'" height="',b==="repeat-x"||b==="no-repeat"?m.source.height:S,'" fill="url(#SVGID_'+m.id+')"',`></rect>
`)}else l.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',m,'"',`></rect>
`)},sendToBack:function(l){if(!l)return this;var g=this._activeObject,m,v,x;if(l===g&&l.type==="activeSelection")for(x=g._objects,m=x.length;m--;)v=x[m],u(this._objects,v),this._objects.unshift(v);else u(this._objects,l),this._objects.unshift(l);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(l){if(!l)return this;var g=this._activeObject,m,v,x;if(l===g&&l.type==="activeSelection")for(x=g._objects,m=0;m<x.length;m++)v=x[m],u(this._objects,v),this._objects.push(v);else u(this._objects,l),this._objects.push(l);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(l,g){if(!l)return this;var m=this._activeObject,v,x,S,b,T,E=0;if(l===m&&l.type==="activeSelection")for(T=m._objects,v=0;v<T.length;v++)x=T[v],S=this._objects.indexOf(x),S>0+E&&(b=S-1,u(this._objects,x),this._objects.splice(b,0,x)),E++;else S=this._objects.indexOf(l),S!==0&&(b=this._findNewLowerIndex(l,S,g),u(this._objects,l),this._objects.splice(b,0,l));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(l,g,m){var v,x;if(m)for(v=g,x=g-1;x>=0;--x){var S=l.intersectsWithObject(this._objects[x])||l.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(l);if(S){v=x;break}}else v=g-1;return v},bringForward:function(l,g){if(!l)return this;var m=this._activeObject,v,x,S,b,T,E=0;if(l===m&&l.type==="activeSelection")for(T=m._objects,v=T.length;v--;)x=T[v],S=this._objects.indexOf(x),S<this._objects.length-1-E&&(b=S+1,u(this._objects,x),this._objects.splice(b,0,x)),E++;else S=this._objects.indexOf(l),S!==this._objects.length-1&&(b=this._findNewUpperIndex(l,S,g),u(this._objects,l),this._objects.splice(b,0,l));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(l,g,m){var v,x,S;if(m)for(v=g,x=g+1,S=this._objects.length;x<S;++x){var b=l.intersectsWithObject(this._objects[x])||l.isContainedWithinObject(this._objects[x])||this._objects[x].isContainedWithinObject(l);if(b){v=x;break}}else v=g+1;return v},moveTo:function(l,g){return u(this._objects,l),this._objects.splice(g,0,l),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(e.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(l){l.dispose&&l.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),e.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),e.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),d(e.StaticCanvas.prototype,e.Observable),d(e.StaticCanvas.prototype,e.Collection),d(e.StaticCanvas.prototype,e.DataURLExporter),d(e.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(l){var g=o();if(!g||!g.getContext)return null;var m=g.getContext("2d");if(!m)return null;switch(l){case"setLineDash":return typeof m.setLineDash<"u";default:return null}}}),e.StaticCanvas.prototype.toJSON=e.StaticCanvas.prototype.toObject,e.isLikelyNode&&(e.StaticCanvas.prototype.createPNGStream=function(){var l=i(this.lowerCanvasEl);return l&&l.createPNGStream()},e.StaticCanvas.prototype.createJPEGStream=function(l){var g=i(this.lowerCanvasEl);return g&&g.createJPEGStream(l)})}(),e.BaseBrush=e.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(d){d.strokeStyle=this.color,d.lineWidth=this.width,d.lineCap=this.strokeLineCap,d.miterLimit=this.strokeMiterLimit,d.lineJoin=this.strokeLineJoin,d.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(d){var s=this.canvas.viewportTransform;d.save(),d.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var d=this.canvas,s=this.shadow,u=d.contextTop,h=d.getZoom();d&&d._isRetinaScaling()&&(h*=e.devicePixelRatio),u.shadowColor=s.color,u.shadowBlur=s.blur*h,u.shadowOffsetX=s.offsetX*h,u.shadowOffsetY=s.offsetY*h}},needsFullRender:function(){var d=new e.Color(this.color);return d.getAlpha()<1||!!this.shadow},_resetShadow:function(){var d=this.canvas.contextTop;d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0},_isOutSideCanvas:function(d){return d.x<0||d.x>this.canvas.getWidth()||d.y<0||d.y>this.canvas.getHeight()}}),function(){e.PencilBrush=e.util.createClass(e.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(d){this.canvas=d,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(d,s,u){var h=s.midPointFrom(u);return d.quadraticCurveTo(s.x,s.y,h.x,h.y),h},onMouseDown:function(d,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(d),this._captureDrawingPath(d),this._render())},onMouseMove:function(d,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],!(this.limitedToCanvasSize===!0&&this._isOutSideCanvas(d))&&this._captureDrawingPath(d)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var u=this._points,h=u.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,u[h-2],u[h-1],!0),r.stroke(),r.restore()}},onMouseUp:function(d){return this.canvas._isMainEvent(d.e)?(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1):!0},_prepareForDrawing:function(d){var s=new e.Point(d.x,d.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(d){return this._points.length>1&&d.eq(this._points[this._points.length-1])?!1:(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(d),!0)},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(d){var s=new e.Point(d.x,d.y);return this._addPoint(s)},_render:function(d){var s,u,h=this._points[0],r=this._points[1];if(d=d||this.canvas.contextTop,this._saveAndTransform(d),d.beginPath(),this._points.length===2&&h.x===r.x&&h.y===r.y){var a=this.width/1e3;h=new e.Point(h.x,h.y),r=new e.Point(r.x,r.y),h.x-=a,r.x+=a}for(d.moveTo(h.x,h.y),s=1,u=this._points.length;s<u;s++)this._drawSegment(d,h,r),h=this._points[s],r=this._points[s+1];d.lineTo(h.x,h.y),d.stroke(),d.restore()},convertPointsToSVGPath:function(d){var s=this.width/1e3;return e.util.getSmoothPathFromPoints(d,s)},_isEmptySVGPath:function(d){var s=e.util.joinPath(d);return s==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(d){var s=new e.Path(d,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new e.Shadow(this.shadow)),s},decimatePoints:function(d,s){if(d.length<=2)return d;var u=this.canvas.getZoom(),h=Math.pow(s/u,2),r,a=d.length-1,i=d[0],o=[i],f;for(r=1;r<a-1;r++)f=Math.pow(i.x-d[r].x,2)+Math.pow(i.y-d[r].y,2),f>=h&&(i=d[r],o.push(i));return o.push(d[a]),o},_finalizeAndAddPath:function(){var d=this.canvas.contextTop;d.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var s=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(s)){this.canvas.requestRenderAll();return}var u=this.createPath(s);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.requestRenderAll(),u.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:u})}})}(),e.CircleBrush=e.util.createClass(e.BaseBrush,{width:10,initialize:function(d){this.canvas=d,this.points=[]},drawDot:function(d){var s=this.addPoint(d),u=this.canvas.contextTop;this._saveAndTransform(u),this.dot(u,s),u.restore()},dot:function(d,s){d.fillStyle=s.fill,d.beginPath(),d.arc(s.x,s.y,s.radius,0,Math.PI*2,!1),d.closePath(),d.fill()},onMouseDown:function(d){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(d)},_render:function(){var d=this.canvas.contextTop,s,u,h=this.points;for(this._saveAndTransform(d),s=0,u=h.length;s<u;s++)this.dot(d,h[s]);d.restore()},onMouseMove:function(d){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(d)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(d),this._render()):this.drawDot(d))},onMouseUp:function(){var d=this.canvas.renderOnAddRemove,s,u;this.canvas.renderOnAddRemove=!1;var h=[];for(s=0,u=this.points.length;s<u;s++){var r=this.points[s],a=new e.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(a.shadow=new e.Shadow(this.shadow)),h.push(a)}var i=new e.Group(h);i.canvas=this.canvas,this.canvas.fire("before:path:created",{path:i}),this.canvas.add(i),this.canvas.fire("path:created",{path:i}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=d,this.canvas.requestRenderAll()},addPoint:function(d){var s=new e.Point(d.x,d.y),u=e.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,h=new e.Color(this.color).setAlpha(e.util.getRandomInt(0,100)/100).toRgba();return s.radius=u,s.fill=h,this.points.push(s),s}}),e.SprayBrush=e.util.createClass(e.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(d){this.canvas=d,this.sprayChunks=[]},onMouseDown:function(d){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(d),this.render(this.sprayChunkPoints)},onMouseMove:function(d){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(d)||(this.addSprayChunk(d),this.render(this.sprayChunkPoints))},onMouseUp:function(){var d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],u=0,h=this.sprayChunks.length;u<h;u++)for(var r=this.sprayChunks[u],a=0,i=r.length;a<i;a++){var o=new e.Rect({width:r[a].width,height:r[a].width,left:r[a].x+1,top:r[a].y+1,originX:"center",originY:"center",fill:this.color});s.push(o)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var f=new e.Group(s);this.shadow&&f.set("shadow",new e.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.fire("path:created",{path:f}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=d,this.canvas.requestRenderAll()},_getOptimizedRects:function(d){var s={},u,h,r;for(h=0,r=d.length;h<r;h++)u=d[h].left+""+d[h].top,s[u]||(s[u]=d[h]);var a=[];for(u in s)a.push(s[u]);return a},render:function(d){var s=this.canvas.contextTop,u,h;for(s.fillStyle=this.color,this._saveAndTransform(s),u=0,h=d.length;u<h;u++){var r=d[u];typeof r.opacity<"u"&&(s.globalAlpha=r.opacity),s.fillRect(r.x,r.y,r.width,r.width)}s.restore()},_render:function(){var d=this.canvas.contextTop,s,u;for(d.fillStyle=this.color,this._saveAndTransform(d),s=0,u=this.sprayChunks.length;s<u;s++)this.render(this.sprayChunks[s]);d.restore()},addSprayChunk:function(d){this.sprayChunkPoints=[];var s,u,h,r=this.width/2,a;for(a=0;a<this.density;a++){s=e.util.getRandomInt(d.x-r,d.x+r),u=e.util.getRandomInt(d.y-r,d.y+r),this.dotWidthVariance?h=e.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):h=this.dotWidth;var i=new e.Point(s,u);i.width=h,this.randomOpacity&&(i.opacity=e.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i)}this.sprayChunks.push(this.sprayChunkPoints)}}),e.PatternBrush=e.util.createClass(e.PencilBrush,{getPatternSrc:function(){var d=20,s=5,u=e.util.createCanvasElement(),h=u.getContext("2d");return u.width=u.height=d+s,h.fillStyle=this.color,h.beginPath(),h.arc(d/2,d/2,d/2,0,Math.PI*2,!1),h.closePath(),h.fill(),u},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(d){return d.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(d){this.callSuper("_setBrushStyles",d),d.strokeStyle=this.getPattern(d)},createPath:function(d){var s=this.callSuper("createPath",d),u=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new e.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-u.x,offsetY:-u.y}),s}}),function(){var d=e.util.getPointer,s=e.util.degreesToRadians,u=e.util.isTouchEvent;e.Canvas=e.util.createClass(e.StaticCanvas,{initialize:function(r,a){a||(a={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,a),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=e.PencilBrush&&new e.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r=this.getActiveObjects(),a,i,o;if(r.length>0&&!this.preserveObjectStacking){i=[],o=[];for(var f=0,l=this._objects.length;f<l;f++)a=this._objects[f],r.indexOf(a)===-1?i.push(a):o.push(a);r.length>1&&(this._activeObject._objects=o),i.push.apply(i,o)}else i=this._objects;return i},renderAll:function(){this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,a){var i=r.calcTransformMatrix(),o=e.util.invertTransform(i),f=this.restorePointerVpt(a);return e.util.transformPoint(f,o)},isTargetTransparent:function(r,a,i){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var o=this._normalizePointer(r,{x:a,y:i}),f=Math.max(r.cacheTranslationX+o.x*r.zoomX,0),l=Math.max(r.cacheTranslationY+o.y*r.zoomY,0),x=e.util.isTransparent(r._cacheContext,Math.round(f),Math.round(l),this.targetFindTolerance);return x}var g=this.contextCache,m=r.selectionBackgroundColor,v=this.viewportTransform;r.selectionBackgroundColor="",this.clearContext(g),g.save(),g.transform(v[0],v[1],v[2],v[3],v[4],v[5]),r.render(g),g.restore(),r.selectionBackgroundColor=m;var x=e.util.isTransparent(g,a,i,this.targetFindTolerance);return x},_isSelectionKeyPressed:function(r){var a=!1;return Array.isArray(this.selectionKey)?a=!!this.selectionKey.find(function(i){return r[i]===!0}):a=r[this.selectionKey],a},_shouldClearSelection:function(r,a){var i=this.getActiveObjects(),o=this._activeObject;return!a||a&&o&&i.length>1&&i.indexOf(a)===-1&&o!==a&&!this._isSelectionKeyPressed(r)||a&&!a.evented||a&&!a.selectable&&o&&o!==a},_shouldCenterTransform:function(r,a,i){if(r){var o;return a==="scale"||a==="scaleX"||a==="scaleY"||a==="resizing"?o=this.centeredScaling||r.centeredScaling:a==="rotate"&&(o=this.centeredRotation||r.centeredRotation),o?!i:i}},_getOriginFromCorner:function(r,a){var i={x:r.originX,y:r.originY};return a==="ml"||a==="tl"||a==="bl"?i.x="right":(a==="mr"||a==="tr"||a==="br")&&(i.x="left"),a==="tl"||a==="mt"||a==="tr"?i.y="bottom":(a==="bl"||a==="mb"||a==="br")&&(i.y="top"),i},_getActionFromCorner:function(r,a,i,o){if(!a||!r)return"drag";var f=o.controls[a];return f.getActionName(i,f,o)},_setupCurrentTransform:function(r,a,i){if(a){var o=this.getPointer(r),f=a.__corner,l=a.controls[f],g=i&&f?l.getActionHandler(r,a,l):e.controlsUtils.dragHandler,m=this._getActionFromCorner(i,f,r,a),v=this._getOriginFromCorner(a,f),x=r[this.centeredKey],S={target:a,action:m,actionHandler:g,corner:f,scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,offsetX:o.x-a.left,offsetY:o.y-a.top,originX:v.x,originY:v.y,ex:o.x,ey:o.y,lastX:o.x,lastY:o.y,theta:s(a.angle),width:a.width*a.scaleX,shiftKey:r.shiftKey,altKey:x,original:e.util.saveObjectTransform(a)};this._shouldCenterTransform(a,m,x)&&(S.originX="center",S.originY="center"),S.original.originX=v.x,S.original.originY=v.y,this._currentTransform=S,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var a=this._groupSelector,i=new e.Point(a.ex,a.ey),o=e.util.transformPoint(i,this.viewportTransform),f=new e.Point(a.ex+a.left,a.ey+a.top),l=e.util.transformPoint(f,this.viewportTransform),g=Math.min(o.x,l.x),m=Math.min(o.y,l.y),v=Math.max(o.x,l.x),x=Math.max(o.y,l.y),S=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(g,m,v-g,x-m)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,g+=S,m+=S,v-=S,x-=S,e.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(g,m,v-g,x-m))},findTarget:function(r,a){if(!this.skipTargetFind){var i=!0,o=this.getPointer(r,i),f=this._activeObject,l=this.getActiveObjects(),g,m,v=u(r),x=l.length>1&&!a||l.length===1;if(this.targets=[],x&&f._findTargetCorner(o,v)||l.length>1&&!a&&f===this._searchPossibleTargets([f],o))return f;if(l.length===1&&f===this._searchPossibleTargets([f],o))if(this.preserveObjectStacking)g=f,m=this.targets,this.targets=[];else return f;var S=this._searchPossibleTargets(this._objects,o);return r[this.altSelectionKey]&&S&&g&&S!==g&&(S=g,this.targets=m),S}},_checkTarget:function(r,a,i){if(a&&a.visible&&a.evented&&a.containsPoint(r))if((this.perPixelTargetFind||a.perPixelTargetFind)&&!a.isEditing){var o=this.isTargetTransparent(a,i.x,i.y);if(!o)return!0}else return!0},_searchPossibleTargets:function(r,a){for(var i,o=r.length,f;o--;){var l=r[o],g=l.group?this._normalizePointer(l.group,a):a;if(this._checkTarget(g,l,a)){i=r[o],i.subTargetCheck&&i instanceof e.Group&&(f=this._searchPossibleTargets(i._objects,a),f&&this.targets.push(f));break}}return i},restorePointerVpt:function(r){return e.util.transformPoint(r,e.util.invertTransform(this.viewportTransform))},getPointer:function(r,a){if(this._absolutePointer&&!a)return this._absolutePointer;if(this._pointer&&a)return this._pointer;var i=d(r),o=this.upperCanvasEl,f=o.getBoundingClientRect(),l=f.width||0,g=f.height||0,m;(!l||!g)&&("top"in f&&"bottom"in f&&(g=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(l=Math.abs(f.right-f.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,a||(i=this.restorePointerVpt(i));var v=this.getRetinaScaling();return v!==1&&(i.x/=v,i.y/=v),l===0||g===0?m={width:1,height:1}:m={width:o.width/l,height:o.height/g},{x:i.x*m.width,y:i.y*m.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),a=this.lowerCanvasEl,i=this.upperCanvasEl;i?i.className="":(i=this._createCanvasElement(),this.upperCanvasEl=i),e.util.addClass(i,"upper-canvas "+r),this.wrapperEl.appendChild(i),this._copyCanvasStyle(a,i),this._applyCanvasStyle(i),this.contextTop=i.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=e.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),e.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),e.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var a=this.width||r.width,i=this.height||r.height;e.util.setStyle(r,{position:"absolute",width:a+"px",height:i+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=a,r.height=i,e.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,a){a.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,a){var i=!1,o=this.getActiveObjects(),f=[],l=[];r.forEach(function(g){o.indexOf(g)===-1&&(i=!0,g.fire("deselected",{e:a,target:g}),l.push(g))}),o.forEach(function(g){r.indexOf(g)===-1&&(i=!0,g.fire("selected",{e:a,target:g}),f.push(g))}),r.length>0&&o.length>0?i&&this.fire("selection:updated",{e:a,selected:f,deselected:l}):o.length>0?this.fire("selection:created",{e:a,selected:f}):r.length>0&&this.fire("selection:cleared",{e:a,deselected:l})},setActiveObject:function(r,a){var i=this.getActiveObjects();return this._setActiveObject(r,a),this._fireSelectionEvents(i,a),this},_setActiveObject:function(r,a){return this._activeObject===r||!this._discardActiveObject(a,r)||r.onSelect({e:a})?!1:(this._activeObject=r,!0)},_discardActiveObject:function(r,a){var i=this._activeObject;if(i){if(i.onDeselect({e:r,object:a}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var a=this.getActiveObjects(),i=this.getActiveObject();return a.length&&this.fire("before:selection:cleared",{target:i,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(a,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(a){e.util.cleanUpJsdomNode(this[a]),this[a]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,e.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var a=this._activeObject;a&&a._renderControls(r)},_toObject:function(r,a,i){var o=this._realizeGroupTransformOnObject(r),f=this.callSuper("_toObject",r,a,i);return this._unwindGroupTransformOnObject(r,o),f},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var a=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],i={};return a.forEach(function(o){i[o]=r[o]}),e.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),i}else return null},_unwindGroupTransformOnObject:function(r,a){a&&r.set(a)},_setSVGObject:function(r,a,i){var o=this._realizeGroupTransformOnObject(a);this.callSuper("_setSVGObject",r,a,i),this._unwindGroupTransformOnObject(a,o)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),e.StaticCanvas.prototype.setViewportTransform.call(this,r)}});for(var h in e.StaticCanvas)h!=="prototype"&&(e.Canvas[h]=e.StaticCanvas[h])}(),function(){var d=e.util.addListener,s=e.util.removeListener,u=3,h=2,r=1,a={passive:!1};function i(o,f){return o.button&&o.button===f-1}e.util.object.extend(e.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(d,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(o,f){var l=this.upperCanvasEl,g=this._getEventPrefix();o(e.window,"resize",this._onResize),o(l,g+"down",this._onMouseDown),o(l,g+"move",this._onMouseMove,a),o(l,g+"out",this._onMouseOut),o(l,g+"enter",this._onMouseEnter),o(l,"wheel",this._onMouseWheel),o(l,"contextmenu",this._onContextMenu),o(l,"dblclick",this._onDoubleClick),o(l,"dragover",this._onDragOver),o(l,"dragenter",this._onDragEnter),o(l,"dragleave",this._onDragLeave),o(l,"drop",this._onDrop),this.enablePointerEvents||o(l,"touchstart",this._onTouchStart,a),typeof eventjs<"u"&&f in eventjs&&(eventjs[f](l,"gesture",this._onGesture),eventjs[f](l,"drag",this._onDrag),eventjs[f](l,"orientation",this._onOrientationChange),eventjs[f](l,"shake",this._onShake),eventjs[f](l,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var o=this._getEventPrefix();s(e.document,o+"up",this._onMouseUp),s(e.document,"touchend",this._onTouchEnd,a),s(e.document,o+"move",this._onMouseMove,a),s(e.document,"touchmove",this._onMouseMove,a)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(o,f){this.__onTransformGesture&&this.__onTransformGesture(o,f)},_onDrag:function(o,f){this.__onDrag&&this.__onDrag(o,f)},_onMouseWheel:function(o){this.__onMouseWheel(o)},_onMouseOut:function(o){var f=this._hoveredTarget;this.fire("mouse:out",{target:f,e:o}),this._hoveredTarget=null,f&&f.fire("mouseout",{e:o});var l=this;this._hoveredTargets.forEach(function(g){l.fire("mouse:out",{target:g,e:o}),g&&g.fire("mouseout",{e:o})}),this._hoveredTargets=[]},_onMouseEnter:function(o){!this._currentTransform&&!this.findTarget(o)&&(this.fire("mouse:over",{target:null,e:o}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(o,f){this.__onOrientationChange&&this.__onOrientationChange(o,f)},_onShake:function(o,f){this.__onShake&&this.__onShake(o,f)},_onLongPress:function(o,f){this.__onLongPress&&this.__onLongPress(o,f)},_onDragOver:function(o){o.preventDefault();var f=this._simpleEventHandler("dragover",o);this._fireEnterLeaveEvents(f,o)},_onDrop:function(o){return this._simpleEventHandler("drop:before",o),this._simpleEventHandler("drop",o)},_onContextMenu:function(o){return this.stopContextMenu&&(o.stopPropagation(),o.preventDefault()),!1},_onDoubleClick:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"dblclick"),this._resetTransformEventData(o)},getPointerId:function(o){var f=o.changedTouches;return f?f[0]&&f[0].identifier:this.enablePointerEvents?o.pointerId:-1},_isMainEvent:function(o){return o.isPrimary===!0?!0:o.isPrimary===!1?!1:o.type==="touchend"&&o.touches.length===0?!0:o.changedTouches?o.changedTouches[0].identifier===this.mainTouchId:!0},_onTouchStart:function(o){o.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(o)),this.__onMouseDown(o),this._resetTransformEventData();var f=this.upperCanvasEl,l=this._getEventPrefix();d(e.document,"touchend",this._onTouchEnd,a),d(e.document,"touchmove",this._onMouseMove,a),s(f,l+"down",this._onMouseDown)},_onMouseDown:function(o){this.__onMouseDown(o),this._resetTransformEventData();var f=this.upperCanvasEl,l=this._getEventPrefix();s(f,l+"move",this._onMouseMove,a),d(e.document,l+"up",this._onMouseUp),d(e.document,l+"move",this._onMouseMove,a)},_onTouchEnd:function(o){if(!(o.touches.length>0)){this.__onMouseUp(o),this._resetTransformEventData(),this.mainTouchId=null;var f=this._getEventPrefix();s(e.document,"touchend",this._onTouchEnd,a),s(e.document,"touchmove",this._onMouseMove,a);var l=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){d(l.upperCanvasEl,f+"down",l._onMouseDown),l._willAddMouseDown=0},400)}},_onMouseUp:function(o){this.__onMouseUp(o),this._resetTransformEventData();var f=this.upperCanvasEl,l=this._getEventPrefix();this._isMainEvent(o)&&(s(e.document,l+"up",this._onMouseUp),s(e.document,l+"move",this._onMouseMove,a),d(f,l+"move",this._onMouseMove,a))},_onMouseMove:function(o){!this.allowTouchScrolling&&o.preventDefault&&o.preventDefault(),this.__onMouseMove(o)},_onResize:function(){this.calcOffset()},_shouldRender:function(o){var f=this._activeObject;return!!f!=!!o||f&&o&&f!==o?!0:(f&&f.isEditing,!1)},__onMouseUp:function(o){var f,l=this._currentTransform,g=this._groupSelector,m=!1,v=!g||g.left===0&&g.top===0;if(this._cacheTransformEventData(o),f=this._target,this._handleEvent(o,"up:before"),i(o,u)){this.fireRightClick&&this._handleEvent(o,"up",u,v);return}if(i(o,h)){this.fireMiddleClick&&this._handleEvent(o,"up",h,v),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(o);return}if(this._isMainEvent(o)){if(l&&(this._finalizeCurrentTransform(o),m=l.actionPerformed),!v){var x=f===this._activeObject;this._maybeGroupObjects(o),m||(m=this._shouldRender(f)||!x&&f===this._activeObject)}var S,b;if(f){if(S=f._findTargetCorner(this.getPointer(o,!0),e.util.isTouchEvent(o)),f.selectable&&f!==this._activeObject&&f.activeOn==="up")this.setActiveObject(f,o),m=!0;else{var T=f.controls[S],E=T&&T.getMouseUpHandler(o,f,T);E&&(b=this.getPointer(o),E(o,l,b.x,b.y))}f.isMoving=!1}if(l&&(l.target!==f||l.corner!==S)){var N=l.target&&l.target.controls[l.corner],L=N&&N.getMouseUpHandler(o,f,T);b=b||this.getPointer(o),L&&L(o,l,b.x,b.y)}this._setCursorFromEvent(o,f),this._handleEvent(o,"up",r,v),this._groupSelector=null,this._currentTransform=null,f&&(f.__corner=0),m?this.requestRenderAll():v||this.renderTop()}},_simpleEventHandler:function(o,f){var l=this.findTarget(f),g=this.targets,m={e:f,target:l,subTargets:g};if(this.fire(o,m),l&&l.fire(o,m),!g)return l;for(var v=0;v<g.length;v++)g[v].fire(o,m);return l},_handleEvent:function(o,f,l,g){var m=this._target,v=this.targets||[],x={e:o,target:m,subTargets:v,button:l||r,isClick:g||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};f==="up"&&(x.currentTarget=this.findTarget(o),x.currentSubTargets=this.targets),this.fire("mouse:"+f,x),m&&m.fire("mouse"+f,x);for(var S=0;S<v.length;S++)v[S].fire("mouse"+f,x)},_finalizeCurrentTransform:function(o){var f=this._currentTransform,l=f.target,g={e:o,target:l,transform:f,action:f.action};l._scaling&&(l._scaling=!1),l.setCoords(),(f.actionPerformed||this.stateful&&l.hasStateChanged())&&this._fire("modified",g)},_onMouseDownInDrawingMode:function(o){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(o).requestRenderAll();var f=this.getPointer(o);this.freeDrawingBrush.onMouseDown(f,{e:o,pointer:f}),this._handleEvent(o,"down")},_onMouseMoveInDrawingMode:function(o){if(this._isCurrentlyDrawing){var f=this.getPointer(o);this.freeDrawingBrush.onMouseMove(f,{e:o,pointer:f})}this.setCursor(this.freeDrawingCursor),this._handleEvent(o,"move")},_onMouseUpInDrawingMode:function(o){var f=this.getPointer(o);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:o,pointer:f}),this._handleEvent(o,"up")},__onMouseDown:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"down:before");var f=this._target;if(i(o,u)){this.fireRightClick&&this._handleEvent(o,"down",u);return}if(i(o,h)){this.fireMiddleClick&&this._handleEvent(o,"down",h);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(o);return}if(this._isMainEvent(o)&&!this._currentTransform){var l=this._pointer;this._previousPointer=l;var g=this._shouldRender(f),m=this._shouldGroup(o,f);if(this._shouldClearSelection(o,f)?this.discardActiveObject(o):m&&(this._handleGrouping(o,f),f=this._activeObject),this.selection&&(!f||!f.selectable&&!f.isEditing&&f!==this._activeObject)&&(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),f){var v=f===this._activeObject;f.selectable&&f.activeOn==="down"&&this.setActiveObject(f,o);var x=f._findTargetCorner(this.getPointer(o,!0),e.util.isTouchEvent(o));if(f.__corner=x,f===this._activeObject&&(x||!m)){this._setupCurrentTransform(o,f,v);var S=f.controls[x],l=this.getPointer(o),b=S&&S.getMouseDownHandler(o,f,S);b&&b(o,this._currentTransform,l.x,l.y)}}this._handleEvent(o,"down"),(g||m)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(o){this._resetTransformEventData(),this._pointer=this.getPointer(o,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(o)||null},_beforeTransform:function(o){var f=this._currentTransform;this.stateful&&f.target.saveState(),this.fire("before:transform",{e:o,transform:f})},__onMouseMove:function(o){this._handleEvent(o,"move:before"),this._cacheTransformEventData(o);var f,l;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(o);return}if(this._isMainEvent(o)){var g=this._groupSelector;g?(l=this._absolutePointer,g.left=l.x-g.ex,g.top=l.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(o):(f=this.findTarget(o)||null,this._setCursorFromEvent(o,f),this._fireOverOutEvents(f,o)),this._handleEvent(o,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(o,f){var l=this._hoveredTarget,g=this._hoveredTargets,m=this.targets,v=Math.max(g.length,m.length);this.fireSyntheticInOutEvents(o,f,{oldTarget:l,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var x=0;x<v;x++)this.fireSyntheticInOutEvents(m[x],f,{oldTarget:g[x],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(o,f){var l=this._draggedoverTarget,g=this._hoveredTargets,m=this.targets,v=Math.max(g.length,m.length);this.fireSyntheticInOutEvents(o,f,{oldTarget:l,evtOut:"dragleave",evtIn:"dragenter"});for(var x=0;x<v;x++)this.fireSyntheticInOutEvents(m[x],f,{oldTarget:g[x],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=o},fireSyntheticInOutEvents:function(o,f,l){var g,m,v=l.oldTarget,x,S,b=v!==o,T=l.canvasEvtIn,E=l.canvasEvtOut;b&&(g={e:f,target:o,previousTarget:v},m={e:f,target:v,nextTarget:o}),S=o&&b,x=v&&b,x&&(E&&this.fire(E,m),v.fire(l.evtOut,m)),S&&(T&&this.fire(T,g),o.fire(l.evtIn,g))},__onMouseWheel:function(o){this._cacheTransformEventData(o),this._handleEvent(o,"wheel"),this._resetTransformEventData()},_transformObject:function(o){var f=this.getPointer(o),l=this._currentTransform;l.reset=!1,l.shiftKey=o.shiftKey,l.altKey=o[this.centeredKey],this._performTransformAction(o,l,f),l.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(o,f,l){var g=l.x,m=l.y,v=f.action,x=!1,S=f.actionHandler;S&&(x=S(o,f,g,m)),v==="drag"&&x&&(f.target.isMoving=!0,this.setCursor(f.target.moveCursor||this.moveCursor)),f.actionPerformed=f.actionPerformed||x},_fire:e.controlsUtils.fireEvent,_setCursorFromEvent:function(o,f){if(!f)return this.setCursor(this.defaultCursor),!1;var l=f.hoverCursor||this.hoverCursor,g=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,m=(!g||!g.contains(f))&&f._findTargetCorner(this.getPointer(o,!0));m?this.setCursor(this.getCornerCursor(m,f,o)):(f.subTargetCheck&&this.targets.concat().reverse().map(function(v){l=v.hoverCursor||l}),this.setCursor(l))},getCornerCursor:function(o,f,l){var g=f.controls[o];return g.cursorStyleHandler(l,g,f)}})}(),function(){var d=Math.min,s=Math.max;e.util.object.extend(e.Canvas.prototype,{_shouldGroup:function(u,h){var r=this._activeObject;return r&&this._isSelectionKeyPressed(u)&&h&&h.selectable&&this.selection&&(r!==h||r.type==="activeSelection")&&!h.onSelect({e:u})},_handleGrouping:function(u,h){var r=this._activeObject;r.__corner||h===r&&(h=this.findTarget(u,!0),!h||!h.selectable)||(r&&r.type==="activeSelection"?this._updateActiveSelection(h,u):this._createActiveSelection(h,u))},_updateActiveSelection:function(u,h){var r=this._activeObject,a=r._objects.slice(0);r.contains(u)?(r.removeWithUpdate(u),this._hoveredTarget=u,this._hoveredTargets=this.targets.concat(),r.size()===1&&this._setActiveObject(r.item(0),h)):(r.addWithUpdate(u),this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(a,h)},_createActiveSelection:function(u,h){var r=this.getActiveObjects(),a=this._createGroup(u);this._hoveredTarget=a,this._setActiveObject(a,h),this._fireSelectionEvents(r,h)},_createGroup:function(u){var h=this._objects,r=h.indexOf(this._activeObject)<h.indexOf(u),a=r?[this._activeObject,u]:[u,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new e.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(u){var h=this._collectObjects(u),r;h.length===1?this.setActiveObject(h[0],u):h.length>1&&(r=new e.ActiveSelection(h.reverse(),{canvas:this}),this.setActiveObject(r,u))},_collectObjects:function(u){for(var h=[],r,a=this._groupSelector.ex,i=this._groupSelector.ey,o=a+this._groupSelector.left,f=i+this._groupSelector.top,l=new e.Point(d(a,o),d(i,f)),g=new e.Point(s(a,o),s(i,f)),m=!this.selectionFullyContained,v=a===o&&i===f,x=this._objects.length;x--&&(r=this._objects[x],!(!(!r||!r.selectable||!r.visible)&&(m&&r.intersectsWithRect(l,g,!0)||r.isContainedWithinRect(l,g,!0)||m&&r.containsPoint(l,null,!0)||m&&r.containsPoint(g,null,!0))&&(h.push(r),v))););return h.length>1&&(h=h.filter(function(S){return!S.onSelect({e:u})})),h},_maybeGroupObjects:function(u){this.selection&&this._groupSelector&&this._groupSelectedObjects(u),this.setCursor(this.defaultCursor),this._groupSelector=null}})}(),function(){e.util.object.extend(e.StaticCanvas.prototype,{toDataURL:function(d){d||(d={});var s=d.format||"png",u=d.quality||1,h=(d.multiplier||1)*(d.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(h,d);return e.util.toDataURL(r,s,u)},toCanvasElement:function(d,s){d=d||1,s=s||{};var u=(s.width||this.width)*d,h=(s.height||this.height)*d,r=this.getZoom(),a=this.width,i=this.height,o=r*d,f=this.viewportTransform,l=(f[4]-(s.left||0))*d,g=(f[5]-(s.top||0))*d,m=this.interactive,v=[o,0,0,o,l,g],x=this.enableRetinaScaling,S=e.util.createCanvasElement(),b=this.contextTop;return S.width=u,S.height=h,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=v,this.width=u,this.height=h,this.calcViewportBoundaries(),this.renderCanvas(S.getContext("2d"),this._objects),this.viewportTransform=f,this.width=a,this.height=i,this.calcViewportBoundaries(),this.interactive=m,this.enableRetinaScaling=x,this.contextTop=b,S}})}(),e.util.object.extend(e.StaticCanvas.prototype,{loadFromJSON:function(d,s,u){if(d){var h=typeof d=="string"?JSON.parse(d):e.util.object.clone(d),r=this,a=h.clipPath,i=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete h.clipPath,this._enlivenObjects(h.objects,function(o){r.clear(),r._setBgOverlay(h,function(){a?r._enlivenObjects([a],function(f){r.clipPath=f[0],r.__setupCanvas.call(r,h,o,i,s)}):r.__setupCanvas.call(r,h,o,i,s)})},u),this}},__setupCanvas:function(d,s,u,h){var r=this;s.forEach(function(a,i){r.insertAt(a,i)}),this.renderOnAddRemove=u,delete d.objects,delete d.backgroundImage,delete d.overlayImage,delete d.background,delete d.overlay,this._setOptions(d),this.renderAll(),h&&h()},_setBgOverlay:function(d,s){var u={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!d.backgroundImage&&!d.overlayImage&&!d.background&&!d.overlay){s&&s();return}var h=function(){u.backgroundImage&&u.overlayImage&&u.backgroundColor&&u.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",d.backgroundImage,u,h),this.__setBgOverlay("overlayImage",d.overlayImage,u,h),this.__setBgOverlay("backgroundColor",d.background,u,h),this.__setBgOverlay("overlayColor",d.overlay,u,h)},__setBgOverlay:function(d,s,u,h){var r=this;if(!s){u[d]=!0,h&&h();return}d==="backgroundImage"||d==="overlayImage"?e.util.enlivenObjects([s],function(a){r[d]=a[0],u[d]=!0,h&&h()}):this["set"+e.util.string.capitalize(d,!0)](s,function(){u[d]=!0,h&&h()})},_enlivenObjects:function(d,s,u){if(!d||d.length===0){s&&s([]);return}e.util.enlivenObjects(d,function(h){s&&s(h)},null,u)},_toDataURL:function(d,s){this.clone(function(u){s(u.toDataURL(d))})},_toDataURLWithMultiplier:function(d,s,u){this.clone(function(h){u(h.toDataURLWithMultiplier(d,s))})},clone:function(d,s){var u=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(h){h.loadFromJSON(u,function(){d&&d(h)})})},cloneWithoutData:function(d){var s=e.util.createCanvasElement();s.width=this.width,s.height=this.height;var u=new e.Canvas(s);this.backgroundImage?(u.setBackgroundImage(this.backgroundImage.src,function(){u.renderAll(),d&&d(u)}),u.backgroundImageOpacity=this.backgroundImageOpacity,u.backgroundImageStretch=this.backgroundImageStretch):d&&d(u)}}),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend,h=s.util.object.clone,r=s.util.toFixed,a=s.util.string.capitalize,i=s.util.degreesToRadians,o=!s.isLikelyNode,f=2;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:o,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(l){l&&this.setOptions(l)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(l){var g=s.perfLimitSizeTotal,m=l.width,v=l.height,x=s.maxCacheSideLimit,S=s.minCacheSideLimit;if(m<=x&&v<=x&&m*v<=g)return m<S&&(l.width=S),v<S&&(l.height=S),l;var b=m/v,T=s.util.limitDimsByArea(b,g),E=s.util.capValue,N=E(S,T.x,x),L=E(S,T.y,x);return m>N&&(l.zoomX/=m/N,l.width=N,l.capped=!0),v>L&&(l.zoomY/=v/L,l.height=L,l.capped=!0),l},_getCacheCanvasDimensions:function(){var l=this.getTotalObjectScaling(),g=this._getTransformedDimensions(0,0),m=g.x*l.scaleX/this.scaleX,v=g.y*l.scaleY/this.scaleY;return{width:Math.ceil(m+f),height:Math.ceil(v+f),zoomX:l.scaleX,zoomY:l.scaleY,x:m,y:v}},_updateCacheCanvas:function(){var l=this.canvas;if(this.noScaleCache&&l&&l._currentTransform){var g=l._currentTransform.target,m=l._currentTransform.action;if(this===g&&m.slice&&m.slice(0,5)==="scale")return!1}var v=this._cacheCanvas,x=this._limitCacheSize(this._getCacheCanvasDimensions()),S=x.width,b=x.height,T,E,N=x.zoomX,L=x.zoomY,G=S!==this.cacheWidth||b!==this.cacheHeight,Q=this.zoomX!==N||this.zoomY!==L,Z=G||Q;return Z?(G?(v.width=S,v.height=b):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,v.width,v.height)),T=x.x/2,E=x.y/2,this.cacheTranslationX=Math.round(v.width/2-T)+T,this.cacheTranslationY=Math.round(v.height/2-E)+E,this.cacheWidth=S,this.cacheHeight=b,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(N,L),this.zoomX=N,this.zoomY=L,!0):!1},setOptions:function(l){this._setOptions(l),this._initGradient(l.fill,"fill"),this._initGradient(l.stroke,"stroke"),this._initPattern(l.fill,"fill"),this._initPattern(l.stroke,"stroke")},transform:function(l){var g=this.group&&!this.group._transformDone||this.group&&this.canvas&&l===this.canvas.contextTop,m=this.calcTransformMatrix(!g);l.transform(m[0],m[1],m[2],m[3],m[4],m[5])},toObject:function(l){var g=s.Object.NUM_FRACTION_DIGITS,m={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:r(this.left,g),top:r(this.top,g),width:r(this.width,g),height:r(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,g),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,g),scaleX:r(this.scaleX,g),scaleY:r(this.scaleY,g),angle:r(this.angle,g),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,g),skewY:r(this.skewY,g)};return this.clipPath&&!this.clipPath.excludeFromExport&&(m.clipPath=this.clipPath.toObject(l),m.clipPath.inverted=this.clipPath.inverted,m.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,m,l),this.includeDefaultValues||(m=this._removeDefaultValues(m)),m},toDatalessObject:function(l){return this.toObject(l)},_removeDefaultValues:function(l){var g=s.util.getKlass(l.type).prototype,m=g.stateProperties;return m.forEach(function(v){v==="left"||v==="top"||(l[v]===g[v]&&delete l[v],Array.isArray(l[v])&&Array.isArray(g[v])&&l[v].length===0&&g[v].length===0&&delete l[v])}),l},toString:function(){return"#<fabric."+a(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var l=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(l.scaleX),scaleY:Math.abs(l.scaleY)}},getTotalObjectScaling:function(){var l=this.getObjectScaling(),g=l.scaleX,m=l.scaleY;if(this.canvas){var v=this.canvas.getZoom(),x=this.canvas.getRetinaScaling();g*=v*x,m*=v*x}return{scaleX:g,scaleY:m}},getObjectOpacity:function(){var l=this.opacity;return this.group&&(l*=this.group.getObjectOpacity()),l},_set:function(l,g){var m=l==="scaleX"||l==="scaleY",v=this[l]!==g,x=!1;return m&&(g=this._constrainScale(g)),l==="scaleX"&&g<0?(this.flipX=!this.flipX,g*=-1):l==="scaleY"&&g<0?(this.flipY=!this.flipY,g*=-1):l==="shadow"&&g&&!(g instanceof s.Shadow)?g=new s.Shadow(g):l==="dirty"&&this.group&&this.group.set("dirty",g),this[l]=g,v&&(x=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(l)>-1?(this.dirty=!0,x&&this.group.set("dirty",!0)):x&&this.stateProperties.indexOf(l)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(l){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(l.save(),this._setupCompositeOperation(l),this.drawSelectionBackground(l),this.transform(l),this._setOpacity(l),this._setShadow(l,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(l)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(l),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),l.restore())},renderCache:function(l){l=l||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,l.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(l,g){if(l.save(),g.inverted?l.globalCompositeOperation="destination-out":l.globalCompositeOperation="destination-in",g.absolutePositioned){var m=s.util.invertTransform(this.calcTransformMatrix());l.transform(m[0],m[1],m[2],m[3],m[4],m[5])}g.transform(l),l.scale(1/g.zoomX,1/g.zoomY),l.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),l.restore()},drawObject:function(l,g){var m=this.fill,v=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(l)):this._renderBackground(l),this._render(l),this._drawClipPath(l,this.clipPath),this.fill=m,this.stroke=v},_drawClipPath:function(l,g){g&&(g.canvas=this.canvas,g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(l,g))},drawCacheOnCanvas:function(l){l.scale(1/this.zoomX,1/this.zoomY),l.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(l){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!l&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!l){var g=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-m/2,g,m)}return!0}return!1},_renderBackground:function(l){if(this.backgroundColor){var g=this._getNonTransformedDimensions();l.fillStyle=this.backgroundColor,l.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(l)}},_setOpacity:function(l){this.group&&!this.group._transformDone?l.globalAlpha=this.getObjectOpacity():l.globalAlpha*=this.opacity},_setStrokeStyles:function(l,g){var m=g.stroke;m&&(l.lineWidth=g.strokeWidth,l.lineCap=g.strokeLineCap,l.lineDashOffset=g.strokeDashOffset,l.lineJoin=g.strokeLineJoin,l.miterLimit=g.strokeMiterLimit,m.toLive?m.gradientUnits==="percentage"||m.gradientTransform||m.patternTransform?this._applyPatternForTransformedGradient(l,m):(l.strokeStyle=m.toLive(l,this),this._applyPatternGradientTransform(l,m)):l.strokeStyle=g.stroke)},_setFillStyles:function(l,g){var m=g.fill;m&&(m.toLive?(l.fillStyle=m.toLive(l,this),this._applyPatternGradientTransform(l,g.fill)):l.fillStyle=m)},_setClippingProperties:function(l){l.globalAlpha=1,l.strokeStyle="transparent",l.fillStyle="#000000"},_setLineDash:function(l,g){!g||g.length===0||(1&g.length&&g.push.apply(g,g),l.setLineDash(g))},_renderControls:function(l,g){var m=this.getViewportTransform(),v=this.calcTransformMatrix(),x,S,b;g=g||{},S=typeof g.hasBorders<"u"?g.hasBorders:this.hasBorders,b=typeof g.hasControls<"u"?g.hasControls:this.hasControls,v=s.util.multiplyTransformMatrices(m,v),x=s.util.qrDecompose(v),l.save(),l.translate(x.translateX,x.translateY),l.lineWidth=1*this.borderScaleFactor,this.group||(l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(x.angle-=180),l.rotate(i(this.group?x.angle:this.angle)),g.forActiveSelection||this.group?S&&this.drawBordersInGroup(l,x,g):S&&this.drawBorders(l,g),b&&this.drawControls(l,g),l.restore()},_setShadow:function(l){if(this.shadow){var g=this.shadow,m=this.canvas,v,x=m&&m.viewportTransform[0]||1,S=m&&m.viewportTransform[3]||1;g.nonScaling?v={scaleX:1,scaleY:1}:v=this.getObjectScaling(),m&&m._isRetinaScaling()&&(x*=s.devicePixelRatio,S*=s.devicePixelRatio),l.shadowColor=g.color,l.shadowBlur=g.blur*s.browserShadowBlurConstant*(x+S)*(v.scaleX+v.scaleY)/4,l.shadowOffsetX=g.offsetX*x*v.scaleX,l.shadowOffsetY=g.offsetY*S*v.scaleY}},_removeShadow:function(l){this.shadow&&(l.shadowColor="",l.shadowBlur=l.shadowOffsetX=l.shadowOffsetY=0)},_applyPatternGradientTransform:function(l,g){if(!g||!g.toLive)return{offsetX:0,offsetY:0};var m=g.gradientTransform||g.patternTransform,v=-this.width/2+g.offsetX||0,x=-this.height/2+g.offsetY||0;return g.gradientUnits==="percentage"?l.transform(this.width,0,0,this.height,v,x):l.transform(1,0,0,1,v,x),m&&l.transform(m[0],m[1],m[2],m[3],m[4],m[5]),{offsetX:v,offsetY:x}},_renderPaintInOrder:function(l){this.paintFirst==="stroke"?(this._renderStroke(l),this._renderFill(l)):(this._renderFill(l),this._renderStroke(l))},_render:function(){},_renderFill:function(l){this.fill&&(l.save(),this._setFillStyles(l,this),this.fillRule==="evenodd"?l.fill("evenodd"):l.fill(),l.restore())},_renderStroke:function(l){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(l),l.save(),this.strokeUniform&&this.group){var g=this.getObjectScaling();l.scale(1/g.scaleX,1/g.scaleY)}else this.strokeUniform&&l.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(l,this.strokeDashArray),this._setStrokeStyles(l,this),l.stroke(),l.restore()}},_applyPatternForTransformedGradient:function(l,g){var m=this._limitCacheSize(this._getCacheCanvasDimensions()),v=s.util.createCanvasElement(),x,S=this.canvas.getRetinaScaling(),b=m.x/this.scaleX/S,T=m.y/this.scaleY/S;v.width=Math.ceil(b),v.height=Math.ceil(T),x=v.getContext("2d"),x.beginPath(),x.moveTo(0,0),x.lineTo(b,0),x.lineTo(b,T),x.lineTo(0,T),x.closePath(),x.translate(b/2,T/2),x.scale(m.zoomX/this.scaleX/S,m.zoomY/this.scaleY/S),this._applyPatternGradientTransform(x,g),x.fillStyle=g.toLive(l),x.fill(),l.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),l.scale(S*this.scaleX/m.zoomX,S*this.scaleY/m.zoomY),l.strokeStyle=x.createPattern(v,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var l=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",l.scaleX),this.set("scaleY",l.scaleY),this.angle=l.angle,this.skewX=l.skewX,this.skewY=0}},_removeTransformMatrix:function(l){var g=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),g=s.util.transformPoint(g,this.transformMatrix)),this.transformMatrix=null,l&&(this.scaleX*=l.scaleX,this.scaleY*=l.scaleY,this.cropX=l.cropX,this.cropY=l.cropY,g.x+=l.offsetLeft,g.y+=l.offsetTop,this.width=l.width,this.height=l.height),this.setPositionByOrigin(g,"center","center")},clone:function(l,g){var m=this.toObject(g);this.constructor.fromObject?this.constructor.fromObject(m,l):s.Object._fromObject("Object",m,l)},cloneAsImage:function(l,g){var m=this.toCanvasElement(g);return l&&l(new s.Image(m)),this},toCanvasElement:function(l){l||(l={});var g=s.util,m=g.saveObjectTransform(this),v=this.group,x=this.shadow,S=Math.abs,b=(l.multiplier||1)*(l.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,l.withoutTransform&&g.resetObjectTransform(this),l.withoutShadow&&(this.shadow=null);var T=s.util.createCanvasElement(),E=this.getBoundingRect(!0,!0),N=this.shadow,L,G={x:0,y:0},Q,Z,te;N&&(Q=N.blur,N.nonScaling?L={scaleX:1,scaleY:1}:L=this.getObjectScaling(),G.x=2*Math.round(S(N.offsetX)+Q)*S(L.scaleX),G.y=2*Math.round(S(N.offsetY)+Q)*S(L.scaleY)),Z=E.width+G.x,te=E.height+G.y,T.width=Math.ceil(Z),T.height=Math.ceil(te);var K=new s.StaticCanvas(T,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});l.format==="jpeg"&&(K.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(K.width/2,K.height/2),"center","center");var ne=this.canvas;K.add(this);var le=K.toCanvasElement(b||1,l);return this.shadow=x,this.set("canvas",ne),v&&(this.group=v),this.set(m).setCoords(),K._objects=[],K.dispose(),K=null,le},toDataURL:function(l){return l||(l={}),s.util.toDataURL(this.toCanvasElement(l),l.format||"png",l.quality||1)},isType:function(l){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===l},complexity:function(){return 1},toJSON:function(l){return this.toObject(l)},rotate:function(l){var g=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return g&&this._setOriginToCenter(),this.set("angle",l),g&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(l,g){g=g||this.canvas.getPointer(l);var m=new s.Point(g.x,g.y),v=this._getLeftTopCoords();return this.angle&&(m=s.util.rotatePoint(m,v,i(-this.angle))),{x:m.x-v.x,y:m.y-v.y}},_setupCompositeOperation:function(l){this.globalCompositeOperation&&(l.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),u(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(l,g,m,v){var x=s[l];g=h(g,!0),s.util.enlivenPatterns([g.fill,g.stroke],function(S){typeof S[0]<"u"&&(g.fill=S[0]),typeof S[1]<"u"&&(g.stroke=S[1]),s.util.enlivenObjectEnlivables(g,g,function(){var b=v?new x(g[v],g):new x(g);m&&m(b)})})},s.Object.__uid=0)}(t),function(){var d=e.util.degreesToRadians,s={left:-.5,center:0,right:.5},u={top:-.5,center:0,bottom:.5};e.util.object.extend(e.Object.prototype,{translateToGivenOrigin:function(h,r,a,i,o){var f=h.x,l=h.y,g,m,v;return typeof r=="string"?r=s[r]:r-=.5,typeof i=="string"?i=s[i]:i-=.5,g=i-r,typeof a=="string"?a=u[a]:a-=.5,typeof o=="string"?o=u[o]:o-=.5,m=o-a,(g||m)&&(v=this._getTransformedDimensions(),f=h.x+g*v.x,l=h.y+m*v.y),new e.Point(f,l)},translateToCenterPoint:function(h,r,a){var i=this.translateToGivenOrigin(h,r,a,"center","center");return this.angle?e.util.rotatePoint(i,h,d(this.angle)):i},translateToOriginPoint:function(h,r,a){var i=this.translateToGivenOrigin(h,"center","center",r,a);return this.angle?e.util.rotatePoint(i,h,d(this.angle)):i},getCenterPoint:function(){var h=new e.Point(this.left,this.top);return this.translateToCenterPoint(h,this.originX,this.originY)},getPointByOrigin:function(h,r){var a=this.getCenterPoint();return this.translateToOriginPoint(a,h,r)},toLocalPoint:function(h,r,a){var i=this.getCenterPoint(),o,f;return typeof r<"u"&&typeof a<"u"?o=this.translateToGivenOrigin(i,"center","center",r,a):o=new e.Point(this.left,this.top),f=new e.Point(h.x,h.y),this.angle&&(f=e.util.rotatePoint(f,i,-d(this.angle))),f.subtractEquals(o)},setPositionByOrigin:function(h,r,a){var i=this.translateToCenterPoint(h,r,a),o=this.translateToOriginPoint(i,this.originX,this.originY);this.set("left",o.x),this.set("top",o.y)},adjustPosition:function(h){var r=d(this.angle),a=this.getScaledWidth(),i=e.util.cos(r)*a,o=e.util.sin(r)*a,f,l;typeof this.originX=="string"?f=s[this.originX]:f=this.originX-.5,typeof h=="string"?l=s[h]:l=h-.5,this.left+=i*(l-f),this.top+=o*(l-f),this.setCoords(),this.originX=h},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var h=this.getCenterPoint();this.originX="center",this.originY="center",this.left=h.x,this.top=h.y},_resetOrigin:function(){var h=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=h.x,this.top=h.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}(),function(){function d(a){return[new e.Point(a.tl.x,a.tl.y),new e.Point(a.tr.x,a.tr.y),new e.Point(a.br.x,a.br.y),new e.Point(a.bl.x,a.bl.y)]}var s=e.util,u=s.degreesToRadians,h=s.multiplyTransformMatrices,r=s.transformPoint;s.object.extend(e.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(a,i){return i?a?this.calcACoords():this.calcLineCoords():((!this.aCoords||!this.lineCoords)&&this.setCoords(!0),a?this.aCoords:this.lineCoords)},getCoords:function(a,i){return d(this._getCoords(a,i))},intersectsWithRect:function(a,i,o,f){var l=this.getCoords(o,f),g=e.Intersection.intersectPolygonRectangle(l,a,i);return g.status==="Intersection"},intersectsWithObject:function(a,i,o){var f=e.Intersection.intersectPolygonPolygon(this.getCoords(i,o),a.getCoords(i,o));return f.status==="Intersection"||a.isContainedWithinObject(this,i,o)||this.isContainedWithinObject(a,i,o)},isContainedWithinObject:function(a,i,o){for(var f=this.getCoords(i,o),l=i?a.aCoords:a.lineCoords,g=0,m=a._getImageLines(l);g<4;g++)if(!a.containsPoint(f[g],m))return!1;return!0},isContainedWithinRect:function(a,i,o,f){var l=this.getBoundingRect(o,f);return l.left>=a.x&&l.left+l.width<=i.x&&l.top>=a.y&&l.top+l.height<=i.y},containsPoint:function(a,g,o,f){var l=this._getCoords(o,f),g=g||this._getImageLines(l),m=this._findCrossPoints(a,g);return m!==0&&m%2===1},isOnScreen:function(a){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br,f=this.getCoords(!0,a);return f.some(function(l){return l.x<=o.x&&l.x>=i.x&&l.y<=o.y&&l.y>=i.y})||this.intersectsWithRect(i,o,!0,a)?!0:this._containsCenterOfCanvas(i,o,a)},_containsCenterOfCanvas:function(a,i,o){var f={x:(a.x+i.x)/2,y:(a.y+i.y)/2};return!!this.containsPoint(f,null,!0,o)},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var i=this.canvas.vptCoords.tl,o=this.canvas.vptCoords.br;if(this.intersectsWithRect(i,o,!0,a))return!0;var f=this.getCoords(!0,a).every(function(l){return(l.x>=o.x||l.x<=i.x)&&(l.y>=o.y||l.y<=i.y)});return f&&this._containsCenterOfCanvas(i,o,a)},_getImageLines:function(a){var i={topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}};return i},_findCrossPoints:function(a,i){var o,f,l,g,m,v=0,x;for(var S in i)if(x=i[S],!(x.o.y<a.y&&x.d.y<a.y)&&!(x.o.y>=a.y&&x.d.y>=a.y)&&(x.o.x===x.d.x&&x.o.x>=a.x?m=x.o.x:(o=0,f=(x.d.y-x.o.y)/(x.d.x-x.o.x),l=a.y-o*a.x,g=x.o.y-f*x.o.x,m=-(l-g)/(o-f)),m>=a.x&&(v+=1),v===2))break;return v},getBoundingRect:function(a,i){var o=this.getCoords(a,i);return s.makeBoundingBoxFromPoints(o)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:a===0?1e-4:a},scale:function(a){return this._set("scaleX",a),this._set("scaleY",a),this.setCoords()},scaleToWidth:function(a,i){var o=this.getBoundingRect(i).width/this.getScaledWidth();return this.scale(a/this.width/o)},scaleToHeight:function(a,i){var o=this.getBoundingRect(i).height/this.getScaledHeight();return this.scale(a/this.height/o)},calcLineCoords:function(){var a=this.getViewportTransform(),i=this.padding,o=u(this.angle),f=s.cos(o),l=s.sin(o),g=f*i,m=l*i,v=g+m,x=g-m,S=this.calcACoords(),b={tl:r(S.tl,a),tr:r(S.tr,a),bl:r(S.bl,a),br:r(S.br,a)};return i&&(b.tl.x-=x,b.tl.y-=v,b.tr.x+=v,b.tr.y-=x,b.bl.x-=v,b.bl.y+=x,b.br.x+=x,b.br.y+=v),b},calcOCoords:function(){var a=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=this.getViewportTransform(),f=h(o,i),l=h(f,a),l=h(l,[1/o[0],0,0,1/o[3],0,0]),g=this._calculateCurrentDimensions(),m={};return this.forEachControl(function(v,x,S){m[x]=v.positionHandler(g,l,S)}),m},calcACoords:function(){var a=this._calcRotateMatrix(),i=this._calcTranslateMatrix(),o=h(i,a),f=this._getTransformedDimensions(),l=f.x/2,g=f.y/2;return{tl:r({x:-l,y:-g},o),tr:r({x:l,y:-g},o),bl:r({x:-l,y:g},o),br:r({x:l,y:g},o)}},setCoords:function(a){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),a?this:(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords(),this)},_calcRotateMatrix:function(){return s.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var i="_",o="";return!a&&this.group&&(o=this.group.transformMatrixKey(a)+i),o+this.top+i+this.left+i+this.scaleX+i+this.scaleY+i+this.skewX+i+this.skewY+i+this.angle+i+this.originX+i+this.originY+i+this.width+i+this.height+i+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){var i=this.calcOwnMatrix();if(a||!this.group)return i;var o=this.transformMatrixKey(a),f=this.matrixCache||(this.matrixCache={});return f.key===o?f.value:(this.group&&(i=h(this.group.calcTransformMatrix(!1),i)),f.key=o,f.value=i,i)},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),i=this.ownMatrixCache||(this.ownMatrixCache={});if(i.key===a)return i.value;var o=this._calcTranslateMatrix(),f={angle:this.angle,translateX:o[4],translateY:o[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return i.key=a,i.value=s.composeMatrix(f),i.value},_getNonTransformedDimensions:function(){var a=this.strokeWidth,i=this.width+a,o=this.height+a;return{x:i,y:o}},_getTransformedDimensions:function(a,i){typeof a>"u"&&(a=this.skewX),typeof i>"u"&&(i=this.skewY);var o,f,l,g=a===0&&i===0;if(this.strokeUniform?(f=this.width,l=this.height):(o=this._getNonTransformedDimensions(),f=o.x,l=o.y),g)return this._finalizeDimensions(f*this.scaleX,l*this.scaleY);var m=s.sizeAfterTransform(f,l,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:a,skewY:i});return this._finalizeDimensions(m.x,m.y)},_finalizeDimensions:function(a,i){return this.strokeUniform?{x:a+this.strokeWidth,y:i+this.strokeWidth}:{x:a,y:i}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),i=this._getTransformedDimensions(),o=r(i,a,!0);return o.scalarAdd(2*this.padding)}})}(),e.util.object.extend(e.Object.prototype,{sendToBack:function(){return this.group?e.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?e.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(d){return this.group?e.StaticCanvas.prototype.sendBackwards.call(this.group,this,d):this.canvas&&this.canvas.sendBackwards(this,d),this},bringForward:function(d){return this.group?e.StaticCanvas.prototype.bringForward.call(this.group,this,d):this.canvas&&this.canvas.bringForward(this,d),this},moveTo:function(d){return this.group&&this.group.type!=="activeSelection"?e.StaticCanvas.prototype.moveTo.call(this.group,this,d):this.canvas&&this.canvas.moveTo(this,d),this}}),function(){function d(u,h){if(h){if(h.toLive)return u+": url(#SVGID_"+h.id+"); ";var r=new e.Color(h),a=u+": "+r.toRgb()+"; ",i=r.getAlpha();return i!==1&&(a+=u+"-opacity: "+i.toString()+"; "),a}else return u+": none; "}var s=e.util.toFixed;e.util.object.extend(e.Object.prototype,{getSvgStyles:function(u){var h=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",a=this.strokeDashArray?this.strokeDashArray.join(" "):"none",i=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",l=this.strokeMiterLimit?this.strokeMiterLimit:"4",g=typeof this.opacity<"u"?this.opacity:"1",m=this.visible?"":" visibility: hidden;",v=u?"":this.getSvgFilter(),x=d("fill",this.fill),S=d("stroke",this.stroke);return[S,"stroke-width: ",r,"; ","stroke-dasharray: ",a,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",i,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",l,"; ",x,"fill-rule: ",h,"; ","opacity: ",g,";",v,m].join("")},getSvgSpanStyles:function(u,h){var r="; ",i=u.fontFamily?"font-family: "+(u.fontFamily.indexOf("'")===-1&&u.fontFamily.indexOf('"')===-1?"'"+u.fontFamily+"'":u.fontFamily)+r:"",a=u.strokeWidth?"stroke-width: "+u.strokeWidth+r:"",i=i,o=u.fontSize?"font-size: "+u.fontSize+"px"+r:"",f=u.fontStyle?"font-style: "+u.fontStyle+r:"",l=u.fontWeight?"font-weight: "+u.fontWeight+r:"",g=u.fill?d("fill",u.fill):"",m=u.stroke?d("stroke",u.stroke):"",v=this.getSvgTextDecoration(u),x=u.deltaY?"baseline-shift: "+-u.deltaY+"; ":"";return v&&(v="text-decoration: "+v+r),[m,a,i,o,f,l,v,g,x,h?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(u){return["overline","underline","line-through"].filter(function(h){return u[h.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(u,h){var r=u?this.calcTransformMatrix():this.calcOwnMatrix(),a='transform="'+e.util.matrixToSVG(r);return a+(h||"")+'" '},_setSVGBg:function(u){if(this.backgroundColor){var h=e.Object.NUM_FRACTION_DIGITS;u.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,h),'" y="',s(-this.height/2,h),'" width="',s(this.width,h),'" height="',s(this.height,h),`"></rect>
`)}},toSVG:function(u){return this._createBaseSVGMarkup(this._toSVG(u),{reviver:u})},toClipPathSVG:function(u){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(u),{reviver:u})},_createBaseClipPathSVGMarkup:function(u,h){h=h||{};var r=h.reviver,a=h.additionalTransform||"",i=[this.getSvgTransform(!0,a),this.getSvgCommons()].join(""),o=u.indexOf("COMMON_PARTS");return u[o]=i,r?r(u.join("")):u.join("")},_createBaseSVGMarkup:function(u,h){h=h||{};var r=h.noStyle,a=h.reviver,i=r?"":'style="'+this.getSvgStyles()+'" ',o=h.withShadow?'style="'+this.getSvgFilter()+'" ':"",f=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",g=f&&f.absolutePositioned,m=this.stroke,v=this.fill,x=this.shadow,S,b=[],T,E=u.indexOf("COMMON_PARTS"),N=h.additionalTransform;return f&&(f.clipPathId="CLIPPATH_"+e.Object.__uid++,T='<clipPath id="'+f.clipPathId+`" >
`+f.toClipPathSVG(a)+`</clipPath>
`),g&&b.push("<g ",o,this.getSvgCommons(),` >
`),b.push("<g ",this.getSvgTransform(!1),g?"":o+this.getSvgCommons(),` >
`),S=[i,l,r?"":this.addPaintOrder()," ",N?'transform="'+N+'" ':""].join(""),u[E]=S,v&&v.toLive&&b.push(v.toSVG(this)),m&&m.toLive&&b.push(m.toSVG(this)),x&&b.push(x.toSVG(this)),f&&b.push(T),b.push(u.join("")),b.push(`</g>
`),g&&b.push(`</g>
`),a?a(b.join("")):b.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var d=e.util.object.extend,s="stateProperties";function u(r,a,i){var o={},f=!0;i.forEach(function(l){o[l]=r[l]}),d(r[a],o,f)}function h(r,a,i){if(r===a)return!0;if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(var o=0,f=r.length;o<f;o++)if(!h(r[o],a[o]))return!1;return!0}else if(r&&typeof r=="object"){var l=Object.keys(r),g;if(!a||typeof a!="object"||!i&&l.length!==Object.keys(a).length)return!1;for(var o=0,f=l.length;o<f;o++)if(g=l[o],!(g==="canvas"||g==="group")&&!h(r[g],a[g]))return!1;return!0}}e.util.object.extend(e.Object.prototype,{hasStateChanged:function(r){r=r||s;var a="_"+r;return Object.keys(this[a]).length<this[r].length?!0:!h(this[a],this,!0)},saveState:function(r){var a=r&&r.propertySet||s,i="_"+a;return this[i]?(u(this,i,this[a]),r&&r.stateProperties&&u(this,i,r.stateProperties),this):this.setupState(r)},setupState:function(r){r=r||{};var a=r.propertySet||s;return r.propertySet=a,this["_"+a]={},this.saveState(r),this}})}(),function(){var d=e.util.degreesToRadians;e.util.object.extend(e.Object.prototype,{_findTargetCorner:function(s,u){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var h=s.x,r=s.y,a,i,o=Object.keys(this.oCoords),f=o.length-1,l;for(this.__corner=0;f>=0;f--)if(l=o[f],!!this.isControlVisible(l)&&(i=this._getImageLines(u?this.oCoords[l].touchCorner:this.oCoords[l].corner),a=this._findCrossPoints({x:h,y:r},i),a!==0&&a%2===1))return this.__corner=l,l;return!1},forEachControl:function(s){for(var u in this.controls)s(this.controls[u],u,this)},_setCornerCoords:function(){var s=this.oCoords;for(var u in s){var h=this.controls[u];s[u].corner=h.calcCornerCoords(this.angle,this.cornerSize,s[u].x,s[u].y,!1),s[u].touchCorner=h.calcCornerCoords(this.angle,this.touchCornerSize,s[u].x,s[u].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var u=this.getCenterPoint(),h=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return s.translate(u.x,u.y),s.scale(1/r[0],1/r[3]),s.rotate(d(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-h.x/2,-h.y/2,h.x,h.y),s.restore(),this},drawBorders:function(s,u){u=u||{};var h=this._calculateCurrentDimensions(),r=this.borderScaleFactor,a=h.x+r,i=h.y+r,o=typeof u.hasControls<"u"?u.hasControls:this.hasControls,f=!1;return s.save(),s.strokeStyle=u.borderColor||this.borderColor,this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeRect(-a/2,-i/2,a,i),o&&(s.beginPath(),this.forEachControl(function(l,g,m){l.withConnection&&l.getVisibility(m,g)&&(f=!0,s.moveTo(l.x*a,l.y*i),s.lineTo(l.x*a+l.offsetX,l.y*i+l.offsetY))}),f&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,u,h){h=h||{};var r=e.util.sizeAfterTransform(this.width,this.height,u),a=this.strokeWidth,i=this.strokeUniform,o=this.borderScaleFactor,f=r.x+a*(i?this.canvas.getZoom():u.scaleX)+o,l=r.y+a*(i?this.canvas.getZoom():u.scaleY)+o;return s.save(),this._setLineDash(s,h.borderDashArray||this.borderDashArray),s.strokeStyle=h.borderColor||this.borderColor,s.strokeRect(-f/2,-l/2,f,l),s.restore(),this},drawControls:function(s,u){u=u||{},s.save();var h=1,r,a;return this.canvas&&(h=this.canvas.getRetinaScaling()),s.setTransform(h,0,0,h,0,0),s.strokeStyle=s.fillStyle=u.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=u.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,u.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(r=this.group.calcTransformMatrix()),this.forEachControl(function(i,o,f){a=f.oCoords[o],i.getVisibility(f,o)&&(r&&(a=e.util.transformPoint(a,r)),i.render(s,a.x,a.y,u,f))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,u){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=u,this},setControlsVisibility:function(s){s||(s={});for(var u in s)this.setControlVisible(u,s[u]);return this},onDeselect:function(){},onSelect:function(){}})}(),e.util.object.extend(e.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(d,s){s=s||{};var u=function(){},h=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:d.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(i){d.set("left",i),a.requestRenderAll(),r()},onComplete:function(){d.setCoords(),h()}})},fxCenterObjectV:function(d,s){s=s||{};var u=function(){},h=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:d.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(i){d.set("top",i),a.requestRenderAll(),r()},onComplete:function(){d.setCoords(),h()}})},fxRemove:function(d,s){s=s||{};var u=function(){},h=s.onComplete||u,r=s.onChange||u,a=this;return e.util.animate({target:this,startValue:d.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(i){d.set("opacity",i),a.requestRenderAll(),r()},onComplete:function(){a.remove(d),h()}})}}),e.util.object.extend(e.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var d=[],s,u,h=[];for(s in arguments[0])d.push(s);for(var r=0,a=d.length;r<a;r++)s=d[r],u=r!==a-1,h.push(this._animate(s,arguments[0][s],arguments[1],u));return h}else return this._animate.apply(this,arguments)},_animate:function(d,s,u,h){var r=this,a;s=s.toString(),u?u=e.util.object.clone(u):u={},~d.indexOf(".")&&(a=d.split("."));var i=r.colorProperties.indexOf(d)>-1||a&&r.colorProperties.indexOf(a[1])>-1,o=a?this.get(a[0])[a[1]]:this.get(d);"from"in u||(u.from=o),i||(~s.indexOf("=")?s=o+parseFloat(s.replace("=","")):s=parseFloat(s));var f={target:this,startValue:u.from,endValue:s,byValue:u.by,easing:u.easing,duration:u.duration,abort:u.abort&&function(l,g,m){return u.abort.call(r,l,g,m)},onChange:function(l,g,m){a?r[a[0]][a[1]]=l:r.set(d,l),!h&&u.onChange&&u.onChange(l,g,m)},onComplete:function(l,g,m){h||(r.setCoords(),u.onComplete&&u.onComplete(l,g,m))}};return i?e.util.animateColor(f.startValue,f.endValue,f.duration,f):e.util.animate(f)}}),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend,h=s.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};if(s.Line){s.warn("fabric.Line is already defined");return}s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(i,o){i||(i=[0,0,0,0]),this.callSuper("initialize",o),this.set("x1",i[0]),this.set("y1",i[1]),this.set("x2",i[2]),this.set("y2",i[3]),this._setWidthHeight(o)},_setWidthHeight:function(i){i||(i={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in i?i.left:this._getLeftToOriginX(),this.top="top"in i?i.top:this._getTopToOriginY()},_set:function(i,o){return this.callSuper("_set",i,o),typeof r[i]<"u"&&this._setWidthHeight(),this},_getLeftToOriginX:a({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:a({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(i){i.beginPath();var o=this.calcLinePoints();i.moveTo(o.x1,o.y1),i.lineTo(o.x2,o.y2),i.lineWidth=this.strokeWidth;var f=i.strokeStyle;i.strokeStyle=this.stroke||i.fillStyle,this.stroke&&this._renderStroke(i),i.strokeStyle=f},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(i){return u(this.callSuper("toObject",i),this.calcLinePoints())},_getNonTransformedDimensions:function(){var i=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(i.y-=this.strokeWidth),this.height===0&&(i.x-=this.strokeWidth)),i},calcLinePoints:function(){var i=this.x1<=this.x2?-1:1,o=this.y1<=this.y2?-1:1,f=i*this.width*.5,l=o*this.height*.5,g=i*this.width*-.5,m=o*this.height*-.5;return{x1:f,x2:g,y1:l,y2:m}},_toSVG:function(){var i=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',i.x1,'" y1="',i.y1,'" x2="',i.x2,'" y2="',i.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(i,o,f){f=f||{};var l=s.parseAttributes(i,s.Line.ATTRIBUTE_NAMES),g=[l.x1||0,l.y1||0,l.x2||0,l.y2||0];o(new s.Line(g,u(l,f)))},s.Line.fromObject=function(i,o){function f(g){delete g.points,o&&o(g)}var l=h(i,!0);l.points=[i.x1,i.y1,i.x2,i.y2],s.Object._fromObject("Line",l,f,"points")};function a(i,o){var f=i.origin,l=i.axis1,g=i.axis2,m=i.dimension,v=o.nearest,x=o.center,S=o.farthest;return function(){switch(this.get(f)){case v:return Math.min(this.get(l),this.get(g));case x:return Math.min(this.get(l),this.get(g))+.5*this.get(m);case S:return Math.max(this.get(l),this.get(g))}}}}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.degreesToRadians;if(s.Circle){s.warn("fabric.Circle is already defined.");return}s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(r,a){return this.callSuper("_set",r,a),r==="radius"&&this.setRadius(a),this},toObject:function(r){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(r))},_toSVG:function(){var r,a=0,i=0,o=(this.endAngle-this.startAngle)%360;if(o===0)r=["<circle ","COMMON_PARTS",'cx="'+a+'" cy="'+i+'" ','r="',this.radius,`" />
`];else{var f=u(this.startAngle),l=u(this.endAngle),g=this.radius,m=s.util.cos(f)*g,v=s.util.sin(f)*g,x=s.util.cos(l)*g,S=s.util.sin(l)*g,b=o>180?"1":"0";r=['<path d="M '+m+" "+v," A "+g+" "+g," 0 ",+b+" 1"," "+x+" "+S,'" ',"COMMON_PARTS",` />
`]}return r},_render:function(r){r.beginPath(),r.arc(0,0,this.radius,u(this.startAngle),u(this.endAngle),!1),this._renderPaintInOrder(r)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(r){return this.radius=r,this.set("width",r*2).set("height",r*2)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(r,a){var i=s.parseAttributes(r,s.Circle.ATTRIBUTE_NAMES);if(!h(i))throw new Error("value of `r` attribute is required and can not be negative");i.left=(i.left||0)-i.radius,i.top=(i.top||0)-i.radius,a(new s.Circle(i))};function h(r){return"radius"in r&&r.radius>=0}s.Circle.fromObject=function(r,a){s.Object._fromObject("Circle",r,a)}}(t),function(d){var s=d.fabric||(d.fabric={});if(s.Triangle){s.warn("fabric.Triangle is already defined");return}s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(u){var h=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-h,r),u.lineTo(0,-r),u.lineTo(h,r),u.closePath(),this._renderPaintInOrder(u)},_toSVG:function(){var u=this.width/2,h=this.height/2,r=[-u+" "+h,"0 "+-h,u+" "+h].join(",");return["<polygon ","COMMON_PARTS",'points="',r,'" />']}}),s.Triangle.fromObject=function(u,h){return s.Object._fromObject("Triangle",u,h)}}(t),function(d){var s=d.fabric||(d.fabric={}),u=Math.PI*2;if(s.Ellipse){s.warn("fabric.Ellipse is already defined.");return}s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this.set("rx",h&&h.rx||0),this.set("ry",h&&h.ry||0)},_set:function(h,r){switch(this.callSuper("_set",h,r),h){case"rx":this.rx=r,this.set("width",r*2);break;case"ry":this.ry=r,this.set("height",r*2);break}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(h){h.beginPath(),h.save(),h.transform(1,0,0,this.ry/this.rx,0,0),h.arc(0,0,this.rx,0,u,!1),h.restore(),this._renderPaintInOrder(h)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(h,r){var a=s.parseAttributes(h,s.Ellipse.ATTRIBUTE_NAMES);a.left=(a.left||0)-a.rx,a.top=(a.top||0)-a.ry,r(new s.Ellipse(a))},s.Ellipse.fromObject=function(h,r){s.Object._fromObject("Ellipse",h,r)}}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend;if(s.Rect){s.warn("fabric.Rect is already defined");return}s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(h){this.callSuper("initialize",h),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(h){var r=this.rx?Math.min(this.rx,this.width/2):0,a=this.ry?Math.min(this.ry,this.height/2):0,i=this.width,o=this.height,f=-this.width/2,l=-this.height/2,g=r!==0||a!==0,m=1-.5522847498;h.beginPath(),h.moveTo(f+r,l),h.lineTo(f+i-r,l),g&&h.bezierCurveTo(f+i-m*r,l,f+i,l+m*a,f+i,l+a),h.lineTo(f+i,l+o-a),g&&h.bezierCurveTo(f+i,l+o-m*a,f+i-m*r,l+o,f+i-r,l+o),h.lineTo(f+r,l+o),g&&h.bezierCurveTo(f+m*r,l+o,f,l+o-m*a,f,l+o-a),h.lineTo(f,l+a),g&&h.bezierCurveTo(f,l+m*a,f+m*r,l,f+r,l),h.closePath(),this._renderPaintInOrder(h)},toObject:function(h){return this.callSuper("toObject",["rx","ry"].concat(h))},_toSVG:function(){var h=-this.width/2,r=-this.height/2;return["<rect ","COMMON_PARTS",'x="',h,'" y="',r,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(h,r,a){if(!h)return r(null);a=a||{};var i=s.parseAttributes(h,s.Rect.ATTRIBUTE_NAMES);i.left=i.left||0,i.top=i.top||0,i.height=i.height||0,i.width=i.width||0;var o=new s.Rect(u(a?s.util.object.clone(a):{},i));o.visible=o.visible&&o.width>0&&o.height>0,r(o)},s.Rect.fromObject=function(h,r){return s.Object._fromObject("Rect",h,r)}}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend,h=s.util.array.min,r=s.util.array.max,a=s.util.toFixed,i=s.util.projectStrokeOnPoints;if(s.Polyline){s.warn("fabric.Polyline is already defined");return}s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(o,f){f=f||{},this.points=o||[],this.callSuper("initialize",f),this._setPositionDimensions(f)},_projectStrokeOnPoints:function(){return i(this.points,this,!0)},_setPositionDimensions:function(o){var f=this._calcDimensions(o),l,g=this.exactBoundingBox?this.strokeWidth:0;this.width=f.width-g,this.height=f.height-g,o.fromSVG||(l=this.translateToGivenOrigin({x:f.left-this.strokeWidth/2+g/2,y:f.top-this.strokeWidth/2+g/2},"left","top",this.originX,this.originY)),typeof o.left>"u"&&(this.left=o.fromSVG?f.left:l.x),typeof o.top>"u"&&(this.top=o.fromSVG?f.top:l.y),this.pathOffset={x:f.left+this.width/2+g/2,y:f.top+this.height/2+g/2}},_calcDimensions:function(){var o=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,f=h(o,"x")||0,l=h(o,"y")||0,g=r(o,"x")||0,m=r(o,"y")||0,v=g-f,x=m-l;return{left:f,top:l,width:v,height:x}},toObject:function(o){return u(this.callSuper("toObject",o),{points:this.points.concat()})},_toSVG:function(){for(var o=[],f=this.pathOffset.x,l=this.pathOffset.y,g=s.Object.NUM_FRACTION_DIGITS,m=0,v=this.points.length;m<v;m++)o.push(a(this.points[m].x-f,g),",",a(this.points[m].y-l,g)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',o.join(""),`" />
`]},commonRender:function(o){var f,l=this.points.length,g=this.pathOffset.x,m=this.pathOffset.y;if(!l||isNaN(this.points[l-1].y))return!1;o.beginPath(),o.moveTo(this.points[0].x-g,this.points[0].y-m);for(var v=0;v<l;v++)f=this.points[v],o.lineTo(f.x-g,f.y-m);return!0},_render:function(o){this.commonRender(o)&&this._renderPaintInOrder(o)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(o){return function(f,l,g){if(!f)return l(null);g||(g={});var m=s.parsePointsAttribute(f.getAttribute("points")),v=s.parseAttributes(f,s[o].ATTRIBUTE_NAMES);v.fromSVG=!0,l(new s[o](m,u(v,g)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(o,f){return s.Object._fromObject("Polyline",o,f,"points")}}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.projectStrokeOnPoints;if(s.Polygon){s.warn("fabric.Polygon is already defined");return}s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return u(this.points,this)},_render:function(h){this.commonRender(h)&&(h.closePath(),this._renderPaintInOrder(h))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(h,r){s.Object._fromObject("Polygon",h,r,"points")}}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.array.min,h=s.util.array.max,r=s.util.object.extend,a=s.util.object.clone,i=s.util.toFixed;if(s.Path){s.warn("fabric.Path is already defined");return}s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(o,f){f=a(f||{}),delete f.path,this.callSuper("initialize",f),this._setPath(o||[],f)},_setPath:function(o,f){this.path=s.util.makePathSimpler(Array.isArray(o)?o:s.util.parsePath(o)),s.Polyline.prototype._setPositionDimensions.call(this,f||{})},_renderPathCommands:function(o){var f,l=0,g=0,m=0,v=0,x=0,S=0,b=-this.pathOffset.x,T=-this.pathOffset.y;o.beginPath();for(var E=0,N=this.path.length;E<N;++E)switch(f=this.path[E],f[0]){case"L":m=f[1],v=f[2],o.lineTo(m+b,v+T);break;case"M":m=f[1],v=f[2],l=m,g=v,o.moveTo(m+b,v+T);break;case"C":m=f[5],v=f[6],x=f[3],S=f[4],o.bezierCurveTo(f[1]+b,f[2]+T,x+b,S+T,m+b,v+T);break;case"Q":o.quadraticCurveTo(f[1]+b,f[2]+T,f[3]+b,f[4]+T),m=f[3],v=f[4],x=f[1],S=f[2];break;case"z":case"Z":m=l,v=g,o.closePath();break}},_render:function(o){this._renderPathCommands(o),this._renderPaintInOrder(o)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(o){return r(this.callSuper("toObject",o),{path:this.path.map(function(f){return f.slice()})})},toDatalessObject:function(o){var f=this.toObject(["sourcePath"].concat(o));return f.sourcePath&&delete f.path,f},_toSVG:function(){var o=s.util.joinPath(this.path);return["<path ","COMMON_PARTS",'d="',o,'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var o=s.Object.NUM_FRACTION_DIGITS;return" translate("+i(-this.pathOffset.x,o)+", "+i(-this.pathOffset.y,o)+")"},toClipPathSVG:function(o){var f=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:f})},toSVG:function(o){var f=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,additionalTransform:f})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var o=[],f=[],l,g=0,m=0,v=0,x=0,S,b=0,T=this.path.length;b<T;++b){switch(l=this.path[b],l[0]){case"L":v=l[1],x=l[2],S=[];break;case"M":v=l[1],x=l[2],g=v,m=x,S=[];break;case"C":S=s.util.getBoundsOfCurve(v,x,l[1],l[2],l[3],l[4],l[5],l[6]),v=l[5],x=l[6];break;case"Q":S=s.util.getBoundsOfCurve(v,x,l[1],l[2],l[1],l[2],l[3],l[4]),v=l[3],x=l[4];break;case"z":case"Z":v=g,x=m;break}S.forEach(function(te){o.push(te.x),f.push(te.y)}),o.push(v),f.push(x)}var E=u(o)||0,N=u(f)||0,L=h(o)||0,G=h(f)||0,Q=L-E,Z=G-N;return{left:E,top:N,width:Q,height:Z}}}),s.Path.fromObject=function(o,f){if(typeof o.sourcePath=="string"){var l=o.sourcePath;s.loadSVGFromURL(l,function(g){var m=g[0];m.setOptions(o),o.clipPath?s.util.enlivenObjects([o.clipPath],function(v){m.clipPath=v[0],f&&f(m)}):f&&f(m)})}else s.Object._fromObject("Path",o,f,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(o,f,l){var g=s.parseAttributes(o,s.Path.ATTRIBUTE_NAMES);g.fromSVG=!0,f(new s.Path(g.d,r(g,l)))}}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.array.min,h=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,a,i){a=a||{},this._objects=[],i&&this.callSuper("initialize",a),this._objects=r||[];for(var o=this._objects.length;o--;)this._objects[o].group=this;if(i)this._updateObjectsACoords();else{var f=a&&a.centerPoint;a.originX!==void 0&&(this.originX=a.originX),a.originY!==void 0&&(this.originY=a.originY),f||this._calcBounds(),this._updateObjectsCoords(f),delete a.centerPoint,this.callSuper("initialize",a)}this.setCoords()},_updateObjectsACoords:function(){for(var r=!0,a=this._objects.length;a--;)this._objects[a].setCoords(r)},_updateObjectsCoords:function(a){for(var a=a||this.getCenterPoint(),i=this._objects.length;i--;)this._updateObjectCoords(this._objects[i],a)},_updateObjectCoords:function(r,a){var i=r.left,o=r.top,f=!0;r.set({left:i-a.x,top:o-a.y}),r.group=this,r.setCoords(f)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var a=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),r&&(a&&s.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,a?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,a){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(r,a);if(r==="canvas")for(;i--;)this._objects[i]._set(r,a);s.Object.prototype._set.call(this,r,a)},toObject:function(r){var a=this.includeDefaultValues,i=this._objects.filter(function(f){return!f.excludeFromExport}).map(function(f){var l=f.includeDefaultValues;f.includeDefaultValues=a;var g=f.toObject(r);return f.includeDefaultValues=l,g}),o=s.Object.prototype.toObject.call(this,r);return o.objects=i,o},toDatalessObject:function(r){var a,i=this.sourcePath;if(i)a=i;else{var o=this.includeDefaultValues;a=this._objects.map(function(l){var g=l.includeDefaultValues;l.includeDefaultValues=o;var m=l.toDatalessObject(r);return l.includeDefaultValues=g,m})}var f=s.Object.prototype.toDatalessObject.call(this,r);return f.objects=a,f},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=s.Object.prototype.shouldCache.call(this);if(r){for(var a=0,i=this._objects.length;a<i;a++)if(this._objects[a].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,a=this._objects.length;r<a;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var a=0,i=this._objects.length;a<i;a++)this._objects[a].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var a=0,i=this._objects.length;a<i;a++)if(this._objects[a].isCacheDirty(!0)){if(this._cacheCanvas){var o=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-o/2,-f/2,o,f)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(a){s.util.addTransformToObject(a,r),delete a.group,a.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,a=this.canvas;this._objects=[];var i=this.toObject();delete i.objects;var o=new s.ActiveSelection([]);return o.set(i),o.type="activeSelection",a.remove(this),r.forEach(function(f){f.group=o,f.dirty=!0,a.add(f)}),o.canvas=a,o._objects=r,a._activeObject=o,o.setCoords(),o}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var r=!0;return this.forEachObject(function(a){a.setCoords(r)}),this},_calcBounds:function(r){for(var a=[],i=[],o,f,l,g=["tr","br","bl","tl"],m=0,v=this._objects.length,x,S=g.length;m<v;++m){for(o=this._objects[m],l=o.calcACoords(),x=0;x<S;x++)f=g[x],a.push(l[f].x),i.push(l[f].y);o.aCoords=l}this._getBounds(a,i,r)},_getBounds:function(r,a,i){var o=new s.Point(u(r),u(a)),f=new s.Point(h(r),h(a)),l=o.y||0,g=o.x||0,m=f.x-o.x||0,v=f.y-o.y||0;this.width=m,this.height=v,i||this.setPositionByOrigin({x:g,y:l},"left","top")},_toSVG:function(r){for(var a=["<g ","COMMON_PARTS",` >
`],i=0,o=this._objects.length;i<o;i++)a.push("		",this._objects[i].toSVG(r));return a.push(`</g>
`),a},getSvgStyles:function(){var r=typeof this.opacity<"u"&&this.opacity!==1?"opacity: "+this.opacity+";":"",a=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),a].join("")},toClipPathSVG:function(r){for(var a=[],i=0,o=this._objects.length;i<o;i++)a.push("	",this._objects[i].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(a,{reviver:r})}}),s.Group.fromObject=function(r,a){var i=r.objects,o=s.util.object.clone(r,!0);if(delete o.objects,typeof i=="string"){s.loadSVGFromURL(i,function(f){var l=s.util.groupSVGElements(f,r,i),g=o.clipPath;delete o.clipPath,l.set(o),g?s.util.enlivenObjects([g],function(m){l.clipPath=m[0],a&&a(l)}):a&&a(l)});return}s.util.enlivenObjects(i,function(f){s.util.enlivenObjectEnlivables(r,o,function(){a&&a(new s.Group(f,o,!0))})})})}(t),function(d){var s=d.fabric||(d.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(u,h){h=h||{},this._objects=u||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;h.originX&&(this.originX=h.originX),h.originY&&(this.originY=h.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,h),this.setCoords()},toGroup:function(){var u=this._objects.concat();this._objects=[];var h=s.Object.prototype.toObject.call(this),r=new s.Group([]);if(delete h.type,r.set(h),u.forEach(function(i){i.canvas.remove(i),i.group=r}),r._objects=u,!this.canvas)return r;var a=this.canvas;return a.add(r),a._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(u,h,r){u.save(),u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,r=r||{},typeof r.hasControls>"u"&&(r.hasControls=!1),r.forActiveSelection=!0;for(var a=0,i=this._objects.length;a<i;a++)this._objects[a]._renderControls(u,r);this.callSuper("_renderControls",u,h),u.restore()}}),s.ActiveSelection.fromObject=function(u,h){s.util.enlivenObjects(u.objects,function(r){delete u.objects,h&&h(new s.ActiveSelection(r,u,!0))})})}(t),function(d){var s=e.util.object.extend;if(d.fabric||(d.fabric={}),d.fabric.Image){e.warn("fabric.Image is already defined.");return}e.Image=e.util.createClass(e.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:e.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:e.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(u,h){h||(h={}),this.filters=[],this.cacheKey="texture"+e.Object.__uid++,this.callSuper("initialize",h),this._initElement(u,h)},getElement:function(){return this._element||{}},setElement:function(u,h){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=u,this._originalElement=u,this._initConfig(h),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(u){var h=e.filterBackend;h&&h.evictCachesForKey&&h.evictCachesForKey(u)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(u){e.util.cleanUpJsdomNode(this[u]),this[u]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var u=this.getElement();return{width:u.naturalWidth||u.width,height:u.naturalHeight||u.height}},_stroke:function(u){if(!(!this.stroke||this.strokeWidth===0)){var h=this.width/2,r=this.height/2;u.beginPath(),u.moveTo(-h,-r),u.lineTo(h,-r),u.lineTo(h,r),u.lineTo(-h,r),u.lineTo(-h,-r),u.closePath()}},toObject:function(u){var h=[];this.filters.forEach(function(a){a&&h.push(a.toObject())});var r=s(this.callSuper("toObject",["cropX","cropY"].concat(u)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:h});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var u=[],h=[],r,a=this._element,i=-this.width/2,o=-this.height/2,f="",l="";if(!a)return[];if(this.hasCrop()){var g=e.Object.__uid++;u.push('<clipPath id="imageCrop_'+g+`">
`,'	<rect x="'+i+'" y="'+o+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),f=' clip-path="url(#imageCrop_'+g+')" '}if(this.imageSmoothing||(l='" image-rendering="optimizeSpeed'),h.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',o-this.cropY,'" width="',a.width||a.naturalWidth,'" height="',a.height||a.height,l,'"',f,`></image>
`),this.stroke||this.strokeDashArray){var m=this.fill;this.fill=null,r=["	<rect ",'x="',i,'" y="',o,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=m}return this.paintFirst!=="fill"?u=u.concat(r,h):u=u.concat(h,r),u},getSrc:function(u){var h=u?this._element:this._originalElement;return h?h.toDataURL?h.toDataURL():this.srcFromAttribute?h.getAttribute("src"):h.src:this.src||""},setSrc:function(u,h,r){return e.util.loadImage(u,function(a,i){this.setElement(a,r),this._setWidthHeight(),h&&h(this,i)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var u=this.resizeFilter,h=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),a=r.scaleX,i=r.scaleY,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!u||a>h&&i>h){this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=a,this._lastScaleY=i;return}e.filterBackend||(e.filterBackend=e.initFilterBackend());var f=e.util.createCanvasElement(),l=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,g=o.width,m=o.height;f.width=g,f.height=m,this._element=f,this._lastScaleX=u.scaleX=a,this._lastScaleY=u.scaleY=i,e.filterBackend.applyFilters([u],o,g,m,this._element,l),this._filterScalingX=f.width/this._originalElement.width,this._filterScalingY=f.height/this._originalElement.height},applyFilters:function(u){if(u=u||this.filters||[],u=u.filter(function(o){return o&&!o.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),u.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var h=this._originalElement,r=h.naturalWidth||h.width,a=h.naturalHeight||h.height;if(this._element===this._originalElement){var i=e.util.createCanvasElement();i.width=r,i.height=a,this._element=i,this._filteredEl=i}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,a),this._lastScaleX=1,this._lastScaleY=1;return e.filterBackend||(e.filterBackend=e.initFilterBackend()),e.filterBackend.applyFilters(u,this._originalElement,r,a,this._element,this.cacheKey),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(u),this._renderPaintInOrder(u)},drawCacheOnCanvas:function(u){e.util.setImageSmoothing(u,this.imageSmoothing),e.Object.prototype.drawCacheOnCanvas.call(this,u)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(u){var h=this._element;if(h){var r=this._filterScalingX,a=this._filterScalingY,i=this.width,o=this.height,f=Math.min,l=Math.max,g=l(this.cropX,0),m=l(this.cropY,0),v=h.naturalWidth||h.width,x=h.naturalHeight||h.height,S=g*r,b=m*a,T=f(i*r,v-S),E=f(o*a,x-b),N=-i/2,L=-o/2,G=f(i,v/r-g),Q=f(o,x/a-m);h&&u.drawImage(h,S,b,T,E,N,L,G,Q)}},_needsResize:function(){var u=this.getTotalObjectScaling();return u.scaleX!==this._lastScaleX||u.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(u,h){this.setElement(e.util.getById(u),h),e.util.addClass(this.getElement(),e.Image.CSS_CANVAS)},_initConfig:function(u){u||(u={}),this.setOptions(u),this._setWidthHeight(u)},_initFilters:function(u,h){u&&u.length?e.util.enlivenObjects(u,function(r){h&&h(r)},"fabric.Image.filters"):h&&h()},_setWidthHeight:function(u){u||(u={});var h=this.getElement();this.width=u.width||h.naturalWidth||h.width||0,this.height=u.height||h.naturalHeight||h.height||0},parsePreserveAspectRatioAttribute:function(){var u=e.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),h=this._element.width,r=this._element.height,a=1,i=1,o=0,f=0,l=0,g=0,m,v=this.width,x=this.height,S={width:v,height:x};return u&&(u.alignX!=="none"||u.alignY!=="none")?(u.meetOrSlice==="meet"&&(a=i=e.util.findScaleToFit(this._element,S),m=(v-h*a)/2,u.alignX==="Min"&&(o=-m),u.alignX==="Max"&&(o=m),m=(x-r*i)/2,u.alignY==="Min"&&(f=-m),u.alignY==="Max"&&(f=m)),u.meetOrSlice==="slice"&&(a=i=e.util.findScaleToCover(this._element,S),m=h-v/a,u.alignX==="Mid"&&(l=m/2),u.alignX==="Max"&&(l=m),m=r-x/i,u.alignY==="Mid"&&(g=m/2),u.alignY==="Max"&&(g=m),h=v/a,r=x/i)):(a=v/h,i=x/r),{width:h,height:r,scaleX:a,scaleY:i,offsetLeft:o,offsetTop:f,cropX:l,cropY:g}}}),e.Image.CSS_CANVAS="canvas-img",e.Image.prototype.getSvgSrc=e.Image.prototype.getSrc,e.Image.fromObject=function(u,h){var r=e.util.object.clone(u);e.util.loadImage(r.src,function(a,i){if(i){h&&h(null,!0);return}e.Image.prototype._initFilters.call(r,r.filters,function(o){r.filters=o||[],e.Image.prototype._initFilters.call(r,[r.resizeFilter],function(f){r.resizeFilter=f[0],e.util.enlivenObjectEnlivables(r,r,function(){var l=new e.Image(a,r);h(l,!1)})})})},null,r.crossOrigin)},e.Image.fromURL=function(u,h,r){e.util.loadImage(u,function(a,i){h&&h(new e.Image(a,r),i)},null,r&&r.crossOrigin)},e.Image.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),e.Image.fromElement=function(u,h,r){var a=e.parseAttributes(u,e.Image.ATTRIBUTE_NAMES);e.Image.fromURL(a["xlink:href"],h,s(r?e.util.object.clone(r):{},a))}}(t),e.util.object.extend(e.Object.prototype,{_getAngleValueForStraighten:function(){var d=this.angle%360;return d>0?Math.round((d-1)/90)*90:Math.round(d/90)*90},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(d){d=d||{};var s=function(){},u=d.onComplete||s,h=d.onChange||s,r=this;return e.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(a){r.rotate(a),h()},onComplete:function(){r.setCoords(),u()}})}}),e.util.object.extend(e.StaticCanvas.prototype,{straightenObject:function(d){return d.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(d){return d.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function d(u,h){var r="precision "+h+` float;
void main(){}`,a=u.createShader(u.FRAGMENT_SHADER);return u.shaderSource(a,r),u.compileShader(a),!!u.getShaderParameter(a,u.COMPILE_STATUS)}e.isWebglSupported=function(u){if(e.isLikelyNode)return!1;u=u||e.WebglFilterBackend.prototype.tileSize;var h=document.createElement("canvas"),r=h.getContext("webgl")||h.getContext("experimental-webgl"),a=!1;if(r){e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),a=e.maxTextureSize>=u;for(var i=["highp","mediump","lowp"],o=0;o<3;o++)if(d(r,i[o])){e.webGlPrecision=i[o];break}}return this.isSupported=a,a},e.WebglFilterBackend=s;function s(u){u&&u.tileSize&&(this.tileSize=u.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}s.prototype={tileSize:2048,resources:{},setupGLContext:function(u,h){this.dispose(),this.createWebGLCanvas(u,h),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(u,h)},chooseFastestCopyGLTo2DMethod:function(u,h){var r=typeof window.performance<"u",a;try{new ImageData(1,1),a=!0}catch{a=!1}var i=typeof ArrayBuffer<"u",o=typeof Uint8ClampedArray<"u";if(r&&a&&i&&o){var f=e.util.createCanvasElement(),l=new ArrayBuffer(u*h*4);if(e.forceGLPutImageData){this.imageBuffer=l,this.copyGLTo2D=w;return}var g={imageBuffer:l,destinationWidth:u,destinationHeight:h,targetCanvas:f},m,v,x;f.width=u,f.height=h,m=window.performance.now(),y.call(g,this.gl,g),v=window.performance.now()-m,m=window.performance.now(),w.call(g,this.gl,g),x=window.performance.now()-m,v>x?(this.imageBuffer=l,this.copyGLTo2D=w):this.copyGLTo2D=y}},createWebGLCanvas:function(u,h){var r=e.util.createCanvasElement();r.width=u,r.height=h;var a={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},i=r.getContext("webgl",a);i||(i=r.getContext("experimental-webgl",a)),i&&(i.clearColor(0,0,0,0),this.canvas=r,this.gl=i)},applyFilters:function(u,h,r,a,i,o){var f=this.gl,l;o&&(l=this.getCachedTexture(o,h));var g={originalWidth:h.width||h.originalWidth,originalHeight:h.height||h.originalHeight,sourceWidth:r,sourceHeight:a,destinationWidth:r,destinationHeight:a,context:f,sourceTexture:this.createTexture(f,r,a,!l&&h),targetTexture:this.createTexture(f,r,a),originalTexture:l||this.createTexture(f,r,a,!l&&h),passes:u.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:i},m=f.createFramebuffer();return f.bindFramebuffer(f.FRAMEBUFFER,m),u.forEach(function(v){v&&v.applyTo(g)}),p(g),this.copyGLTo2D(f,g),f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(g.sourceTexture),f.deleteTexture(g.targetTexture),f.deleteFramebuffer(m),i.getContext("2d").setTransform(1,0,0,1,0,0),g},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(u,h,r,a,i){var o=u.createTexture();return u.bindTexture(u.TEXTURE_2D,o),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,i||u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),a?u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,a):u.texImage2D(u.TEXTURE_2D,0,u.RGBA,h,r,0,u.RGBA,u.UNSIGNED_BYTE,null),o},getCachedTexture:function(u,h){if(this.textureCache[u])return this.textureCache[u];var r=this.createTexture(this.gl,h.width,h.height,h);return this.textureCache[u]=r,r},evictCachesForKey:function(u){this.textureCache[u]&&(this.gl.deleteTexture(this.textureCache[u]),delete this.textureCache[u])},copyGLTo2D:y,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var u=this.gl,h={renderer:"",vendor:""};if(!u)return h;var r=u.getExtension("WEBGL_debug_renderer_info");if(r){var a=u.getParameter(r.UNMASKED_RENDERER_WEBGL),i=u.getParameter(r.UNMASKED_VENDOR_WEBGL);a&&(h.renderer=a.toLowerCase()),i&&(h.vendor=i.toLowerCase())}return this.gpuInfo=h,h}}}();function p(d){var s=d.targetCanvas,u=s.width,h=s.height,r=d.destinationWidth,a=d.destinationHeight;(u!==r||h!==a)&&(s.width=r,s.height=a)}function y(d,s){var u=d.canvas,h=s.targetCanvas,r=h.getContext("2d");r.translate(0,h.height),r.scale(1,-1);var a=u.height-h.height;r.drawImage(u,0,a,h.width,h.height,0,0,h.width,h.height)}function w(d,s){var u=s.targetCanvas,h=u.getContext("2d"),r=s.destinationWidth,a=s.destinationHeight,i=r*a*4,o=new Uint8Array(this.imageBuffer,0,i),f=new Uint8ClampedArray(this.imageBuffer,0,i);d.readPixels(0,0,r,a,d.RGBA,d.UNSIGNED_BYTE,o);var l=new ImageData(f,r,a);h.putImageData(l,0,0)}(function(){var d=function(){};e.Canvas2dFilterBackend=s;function s(){}s.prototype={evictCachesForKey:d,dispose:d,clearWebGLCaches:d,resources:{},applyFilters:function(u,h,r,a,i){var o=i.getContext("2d");o.drawImage(h,0,0,r,a);var f=o.getImageData(0,0,r,a),l=o.getImageData(0,0,r,a),g={sourceWidth:r,sourceHeight:a,imageData:f,originalEl:h,originalImageData:l,canvasEl:i,ctx:o,filterBackend:this};return u.forEach(function(m){m.applyTo(g)}),(g.imageData.width!==r||g.imageData.height!==a)&&(i.width=g.imageData.width,i.height=g.imageData.height),o.putImageData(g.imageData,0,0),g}}})(),e.Image=e.Image||{},e.Image.filters=e.Image.filters||{},e.Image.filters.BaseFilter=e.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(d){d&&this.setOptions(d)},setOptions:function(d){for(var s in d)this[s]=d[s]},createProgram:function(d,s,u){s=s||this.fragmentSource,u=u||this.vertexSource,e.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+e.webGlPrecision+" float"));var h=d.createShader(d.VERTEX_SHADER);if(d.shaderSource(h,u),d.compileShader(h),!d.getShaderParameter(h,d.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+d.getShaderInfoLog(h));var r=d.createShader(d.FRAGMENT_SHADER);if(d.shaderSource(r,s),d.compileShader(r),!d.getShaderParameter(r,d.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+d.getShaderInfoLog(r));var a=d.createProgram();if(d.attachShader(a,h),d.attachShader(a,r),d.linkProgram(a),!d.getProgramParameter(a,d.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+d.getProgramInfoLog(a));var i=this.getAttributeLocations(d,a),o=this.getUniformLocations(d,a)||{};return o.uStepW=d.getUniformLocation(a,"uStepW"),o.uStepH=d.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:i,uniformLocations:o}},getAttributeLocations:function(d,s){return{aPosition:d.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(d,s,u){var h=s.aPosition,r=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,r),d.enableVertexAttribArray(h),d.vertexAttribPointer(h,2,d.FLOAT,!1,0,0),d.bufferData(d.ARRAY_BUFFER,u,d.STATIC_DRAW)},_setupFrameBuffer:function(d){var s=d.context,u,h;d.passes>1?(u=d.destinationWidth,h=d.destinationHeight,(d.sourceWidth!==u||d.sourceHeight!==h)&&(s.deleteTexture(d.targetTexture),d.targetTexture=d.filterBackend.createTexture(s,u,h)),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,d.targetTexture,0)):(s.bindFramebuffer(s.FRAMEBUFFER,null),s.finish())},_swapTextures:function(d){d.passes--,d.pass++;var s=d.targetTexture;d.targetTexture=d.sourceTexture,d.sourceTexture=s},isNeutralState:function(){var d=this.mainParameter,s=e.Image.filters[this.type].prototype;if(d)if(Array.isArray(s[d])){for(var u=s[d].length;u--;)if(this[d][u]!==s[d][u])return!1;return!0}else return s[d]===this[d];else return!1},applyTo:function(d){d.webgl?(this._setupFrameBuffer(d),this.applyToWebGL(d),this._swapTextures(d)):this.applyTo2d(d)},retrieveShader:function(d){return d.programCache.hasOwnProperty(this.type)||(d.programCache[this.type]=this.createProgram(d.context)),d.programCache[this.type]},applyToWebGL:function(d){var s=d.context,u=this.retrieveShader(d);d.pass===0&&d.originalTexture?s.bindTexture(s.TEXTURE_2D,d.originalTexture):s.bindTexture(s.TEXTURE_2D,d.sourceTexture),s.useProgram(u.program),this.sendAttributeData(s,u.attributeLocations,d.aPosition),s.uniform1f(u.uniformLocations.uStepW,1/d.sourceWidth),s.uniform1f(u.uniformLocations.uStepH,1/d.sourceHeight),this.sendUniformData(s,u.uniformLocations),s.viewport(0,0,d.destinationWidth,d.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(d,s,u){d.activeTexture(u),d.bindTexture(d.TEXTURE_2D,s),d.activeTexture(d.TEXTURE0)},unbindAdditionalTexture:function(d,s){d.activeTexture(s),d.bindTexture(d.TEXTURE_2D,null),d.activeTexture(d.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(d){this[this.mainParameter]=d},sendUniformData:function(){},createHelpLayer:function(d){if(!d.helpLayer){var s=document.createElement("canvas");s.width=d.sourceWidth,s.height=d.sourceHeight,d.helpLayer=s}},toObject:function(){var d={type:this.type},s=this.mainParameter;return s&&(d[s]=this[s]),d},toJSON:function(){return this.toObject()}}),e.Image.filters.BaseFilter.fromObject=function(d,s){var u=new e.Image.filters[d.type](d);return s&&s(u),u},function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.ColorMatrix=h(u.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var a=r.imageData,i=a.data,o=i.length,f=this.matrix,l,g,m,v,x,S=this.colorsOnly;for(x=0;x<o;x+=4)l=i[x],g=i[x+1],m=i[x+2],S?(i[x]=l*f[0]+g*f[1]+m*f[2]+f[4]*255,i[x+1]=l*f[5]+g*f[6]+m*f[7]+f[9]*255,i[x+2]=l*f[10]+g*f[11]+m*f[12]+f[14]*255):(v=i[x+3],i[x]=l*f[0]+g*f[1]+m*f[2]+v*f[3]+f[4]*255,i[x+1]=l*f[5]+g*f[6]+m*f[7]+v*f[8]+f[9]*255,i[x+2]=l*f[10]+g*f[11]+m*f[12]+v*f[13]+f[14]*255,i[x+3]=l*f[15]+g*f[16]+m*f[17]+v*f[18]+f[19]*255)},getUniformLocations:function(r,a){return{uColorMatrix:r.getUniformLocation(a,"uColorMatrix"),uConstants:r.getUniformLocation(a,"uConstants")}},sendUniformData:function(r,a){var i=this.matrix,o=[i[0],i[1],i[2],i[3],i[5],i[6],i[7],i[8],i[10],i[11],i[12],i[13],i[15],i[16],i[17],i[18]],f=[i[4],i[9],i[14],i[19]];r.uniformMatrix4fv(a.uColorMatrix,!1,o),r.uniform4fv(a.uConstants,f)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Brightness=h(u.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var a=r.imageData,i=a.data,o,f=i.length,l=Math.round(this.brightness*255);for(o=0;o<f;o+=4)i[o]=i[o]+l,i[o+1]=i[o+1]+l,i[o+2]=i[o+2]+l}},getUniformLocations:function(r,a){return{uBrightness:r.getUniformLocation(a,"uBrightness")}},sendUniformData:function(r,a){r.uniform1f(a.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend,h=s.Image.filters,r=s.util.createClass;h.Convolute=r(h.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(a){var i=Math.sqrt(this.matrix.length),o=this.type+"_"+i+"_"+(this.opaque?1:0),f=this.fragmentSource[o];return a.programCache.hasOwnProperty(o)||(a.programCache[o]=this.createProgram(a.context,f)),a.programCache[o]},applyTo2d:function(a){var i=a.imageData,o=i.data,f=this.matrix,l=Math.round(Math.sqrt(f.length)),g=Math.floor(l/2),m=i.width,v=i.height,x=a.ctx.createImageData(m,v),S=x.data,b=this.opaque?1:0,T,E,N,L,G,Q,Z,te,K,ne,le,Y,_;for(le=0;le<v;le++)for(ne=0;ne<m;ne++){for(G=(le*m+ne)*4,T=0,E=0,N=0,L=0,_=0;_<l;_++)for(Y=0;Y<l;Y++)Z=le+_-g,Q=ne+Y-g,!(Z<0||Z>=v||Q<0||Q>=m)&&(te=(Z*m+Q)*4,K=f[_*l+Y],T+=o[te]*K,E+=o[te+1]*K,N+=o[te+2]*K,b||(L+=o[te+3]*K));S[G]=T,S[G+1]=E,S[G+2]=N,b?S[G+3]=o[G+3]:S[G+3]=L}a.imageData=x},getUniformLocations:function(a,i){return{uMatrix:a.getUniformLocation(i,"uMatrix"),uOpaque:a.getUniformLocation(i,"uOpaque"),uHalfSize:a.getUniformLocation(i,"uHalfSize"),uSize:a.getUniformLocation(i,"uSize")}},sendUniformData:function(a,i){a.uniform1fv(i.uMatrix,this.matrix)},toObject:function(){return u(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Grayscale=h(u.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var a=r.imageData,i=a.data,o,f=i.length,l,g=this.mode;for(o=0;o<f;o+=4)g==="average"?l=(i[o]+i[o+1]+i[o+2])/3:g==="lightness"?l=(Math.min(i[o],i[o+1],i[o+2])+Math.max(i[o],i[o+1],i[o+2]))/2:g==="luminosity"&&(l=.21*i[o]+.72*i[o+1]+.07*i[o+2]),i[o]=l,i[o+1]=l,i[o+2]=l},retrieveShader:function(r){var a=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(a)){var i=this.fragmentSource[this.mode];r.programCache[a]=this.createProgram(r.context,i)}return r.programCache[a]},getUniformLocations:function(r,a){return{uMode:r.getUniformLocation(a,"uMode")}},sendUniformData:function(r,a){var i=1;r.uniform1i(a.uMode,i)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Invert=h(u.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var a=r.imageData,i=a.data,o,f=i.length;for(o=0;o<f;o+=4)i[o]=255-i[o],i[o+1]=255-i[o+1],i[o+2]=255-i[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,a){return{uInvert:r.getUniformLocation(a,"uInvert")}},sendUniformData:function(r,a){r.uniform1i(a.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend,h=s.Image.filters,r=s.util.createClass;h.Noise=r(h.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(a){if(this.noise!==0){var i=a.imageData,o=i.data,f,l=o.length,g=this.noise,m;for(f=0,l=o.length;f<l;f+=4)m=(.5-Math.random())*g,o[f]+=m,o[f+1]+=m,o[f+2]+=m}},getUniformLocations:function(a,i){return{uNoise:a.getUniformLocation(i,"uNoise"),uSeed:a.getUniformLocation(i,"uSeed")}},sendUniformData:function(a,i){a.uniform1f(i.uNoise,this.noise/255),a.uniform1f(i.uSeed,Math.random())},toObject:function(){return u(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Pixelate=h(u.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var a=r.imageData,i=a.data,o=a.height,f=a.width,l,g,m,v,x,S,b,T,E,N,L;for(g=0;g<o;g+=this.blocksize)for(m=0;m<f;m+=this.blocksize)for(l=g*4*f+m*4,v=i[l],x=i[l+1],S=i[l+2],b=i[l+3],N=Math.min(g+this.blocksize,o),L=Math.min(m+this.blocksize,f),T=g;T<N;T++)for(E=m;E<L;E++)l=T*4*f+E*4,i[l]=v,i[l+1]=x,i[l+2]=S,i[l+3]=b},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,a){return{uBlocksize:r.getUniformLocation(a,"uBlocksize"),uStepW:r.getUniformLocation(a,"uStepW"),uStepH:r.getUniformLocation(a,"uStepH")}},sendUniformData:function(r,a){r.uniform1f(a.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.extend,h=s.Image.filters,r=s.util.createClass;h.RemoveColor=r(h.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(a){var i=a.imageData,o=i.data,f,l=this.distance*255,g,m,v,x=new s.Color(this.color).getSource(),S=[x[0]-l,x[1]-l,x[2]-l],b=[x[0]+l,x[1]+l,x[2]+l];for(f=0;f<o.length;f+=4)g=o[f],m=o[f+1],v=o[f+2],g>S[0]&&m>S[1]&&v>S[2]&&g<b[0]&&m<b[1]&&v<b[2]&&(o[f+3]=0)},getUniformLocations:function(a,i){return{uLow:a.getUniformLocation(i,"uLow"),uHigh:a.getUniformLocation(i,"uHigh")}},sendUniformData:function(a,i){var o=new s.Color(this.color).getSource(),f=parseFloat(this.distance),l=[0+o[0]/255-f,0+o[1]/255-f,0+o[2]/255-f,1],g=[o[0]/255+f,o[1]/255+f,o[2]/255+f,1];a.uniform4fv(i.uLow,l),a.uniform4fv(i.uHigh,g)},toObject:function(){return u(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var a in r)u[a]=h(u.ColorMatrix,{type:a,matrix:r[a],mainParameter:!1,colorsOnly:!0}),s.Image.filters[a].fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric,u=s.Image.filters,h=s.util.createClass;u.BlendColor=h(u.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var a=this.type+"_"+this.mode,i;return r.programCache.hasOwnProperty(a)||(i=this.buildSource(this.mode),r.programCache[a]=this.createProgram(r.context,i)),r.programCache[a]},applyTo2d:function(r){var a=r.imageData,i=a.data,o=i.length,f,l,g,m,v,x,S,b=1-this.alpha;S=new s.Color(this.color).getSource(),f=S[0]*this.alpha,l=S[1]*this.alpha,g=S[2]*this.alpha;for(var T=0;T<o;T+=4)switch(m=i[T],v=i[T+1],x=i[T+2],this.mode){case"multiply":i[T]=m*f/255,i[T+1]=v*l/255,i[T+2]=x*g/255;break;case"screen":i[T]=255-(255-m)*(255-f)/255,i[T+1]=255-(255-v)*(255-l)/255,i[T+2]=255-(255-x)*(255-g)/255;break;case"add":i[T]=m+f,i[T+1]=v+l,i[T+2]=x+g;break;case"diff":case"difference":i[T]=Math.abs(m-f),i[T+1]=Math.abs(v-l),i[T+2]=Math.abs(x-g);break;case"subtract":i[T]=m-f,i[T+1]=v-l,i[T+2]=x-g;break;case"darken":i[T]=Math.min(m,f),i[T+1]=Math.min(v,l),i[T+2]=Math.min(x,g);break;case"lighten":i[T]=Math.max(m,f),i[T+1]=Math.max(v,l),i[T+2]=Math.max(x,g);break;case"overlay":i[T]=f<128?2*m*f/255:255-2*(255-m)*(255-f)/255,i[T+1]=l<128?2*v*l/255:255-2*(255-v)*(255-l)/255,i[T+2]=g<128?2*x*g/255:255-2*(255-x)*(255-g)/255;break;case"exclusion":i[T]=f+m-2*f*m/255,i[T+1]=l+v-2*l*v/255,i[T+2]=g+x-2*g*x/255;break;case"tint":i[T]=f+m*b,i[T+1]=l+v*b,i[T+2]=g+x*b}},getUniformLocations:function(r,a){return{uColor:r.getUniformLocation(a,"uColor")}},sendUniformData:function(r,a){var i=new s.Color(this.color).getSource();i[0]=this.alpha*i[0]/255,i[1]=this.alpha*i[1]/255,i[2]=this.alpha*i[2]/255,i[3]=this.alpha,r.uniform4fv(a.uColor,i)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric,u=s.Image.filters,h=s.util.createClass;u.BlendImage=h(u.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var a=this.type+"_"+this.mode,i=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(a)||(r.programCache[a]=this.createProgram(r.context,i)),r.programCache[a]},applyToWebGL:function(r){var a=r.context,i=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(a,i,a.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(a,a.TEXTURE1)},createTexture:function(r,a){return r.getCachedTexture(a.cacheKey,a._element)},calculateMatrix:function(){var r=this.image,a=r._element.width,i=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/a,-r.top/i,1]},applyTo2d:function(r){var a=r.imageData,i=r.filterBackend.resources,o=a.data,f=o.length,l=a.width,g=a.height,m,v,x,S,b,T,E,N,L,G,Q=this.image,Z;i.blendImage||(i.blendImage=s.util.createCanvasElement()),L=i.blendImage,G=L.getContext("2d"),L.width!==l||L.height!==g?(L.width=l,L.height=g):G.clearRect(0,0,l,g),G.setTransform(Q.scaleX,0,0,Q.scaleY,Q.left,Q.top),G.drawImage(Q._element,0,0,l,g),Z=G.getImageData(0,0,l,g).data;for(var te=0;te<f;te+=4)switch(b=o[te],T=o[te+1],E=o[te+2],N=o[te+3],m=Z[te],v=Z[te+1],x=Z[te+2],S=Z[te+3],this.mode){case"multiply":o[te]=b*m/255,o[te+1]=T*v/255,o[te+2]=E*x/255,o[te+3]=N*S/255;break;case"mask":o[te+3]=S;break}},getUniformLocations:function(r,a){return{uTransformMatrix:r.getUniformLocation(a,"uTransformMatrix"),uImage:r.getUniformLocation(a,"uImage")}},sendUniformData:function(r,a){var i=this.calculateMatrix();r.uniform1i(a.uImage,1),r.uniformMatrix3fv(a.uTransformMatrix,!1,i)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(r,a){s.Image.fromObject(r.image,function(i){var o=s.util.object.clone(r);o.image=i,a(new s.Image.filters.BlendImage(o))})}}(t),function(d){var s=d.fabric||(d.fabric={}),u=Math.pow,h=Math.floor,r=Math.sqrt,a=Math.abs,i=Math.round,o=Math.sin,f=Math.ceil,l=s.Image.filters,g=s.util.createClass;l.Resize=g(l.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(m,v){return{uDelta:m.getUniformLocation(v,"uDelta"),uTaps:m.getUniformLocation(v,"uTaps")}},sendUniformData:function(m,v){m.uniform2fv(v.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),m.uniform1fv(v.uTaps,this.taps)},retrieveShader:function(m){var v=this.getFilterWindow(),x=this.type+"_"+v;if(!m.programCache.hasOwnProperty(x)){var S=this.generateShader(v);m.programCache[x]=this.createProgram(m.context,S)}return m.programCache[x]},getFilterWindow:function(){var m=this.tempScale;return Math.ceil(this.lanczosLobes/m)},getTaps:function(){for(var m=this.lanczosCreate(this.lanczosLobes),v=this.tempScale,x=this.getFilterWindow(),S=new Array(x),b=1;b<=x;b++)S[b-1]=m(b*v);return S},generateShader:function(S){for(var v=new Array(S),x=this.fragmentSourceTOP,S,b=1;b<=S;b++)v[b-1]=b+".0 * uDelta";return x+="uniform float uTaps["+S+`];
`,x+=`void main() {
`,x+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,x+=`  float sum = 1.0;
`,v.forEach(function(T,E){x+="  color += texture2D(uTexture, vTexCoord + "+T+") * uTaps["+E+`];
`,x+="  color += texture2D(uTexture, vTexCoord - "+T+") * uTaps["+E+`];
`,x+="  sum += 2.0 * uTaps["+E+`];
`}),x+=`  gl_FragColor = color / sum;
`,x+="}",x},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(m){m.webgl?(m.passes++,this.width=m.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=m.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),m.destinationWidth=this.dW,this._setupFrameBuffer(m),this.applyToWebGL(m),this._swapTextures(m),m.sourceWidth=m.destinationWidth,this.height=m.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),m.destinationHeight=this.dH,this._setupFrameBuffer(m),this.applyToWebGL(m),this._swapTextures(m),m.sourceHeight=m.destinationHeight):this.applyTo2d(m)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(m){return function(v){if(v>=m||v<=-m)return 0;if(v<11920929e-14&&v>-11920929e-14)return 1;v*=Math.PI;var x=v/m;return o(v)/v*o(x)/x}},applyTo2d:function(m){var v=m.imageData,x=this.scaleX,S=this.scaleY;this.rcpScaleX=1/x,this.rcpScaleY=1/S;var b=v.width,T=v.height,E=i(b*x),N=i(T*S),L;this.resizeType==="sliceHack"?L=this.sliceByTwo(m,b,T,E,N):this.resizeType==="hermite"?L=this.hermiteFastResize(m,b,T,E,N):this.resizeType==="bilinear"?L=this.bilinearFiltering(m,b,T,E,N):this.resizeType==="lanczos"&&(L=this.lanczosResize(m,b,T,E,N)),m.imageData=L},sliceByTwo:function(m,v,x,S,b){var T=m.imageData,E=.5,N=!1,L=!1,G=v*E,Q=x*E,Z=s.filterBackend.resources,te,K,ne=0,le=0,Y=v,_=0;for(Z.sliceByTwo||(Z.sliceByTwo=document.createElement("canvas")),te=Z.sliceByTwo,(te.width<v*1.5||te.height<x)&&(te.width=v*1.5,te.height=x),K=te.getContext("2d"),K.clearRect(0,0,v*1.5,x),K.putImageData(T,0,0),S=h(S),b=h(b);!N||!L;)v=G,x=Q,S<h(G*E)?G=h(G*E):(G=S,N=!0),b<h(Q*E)?Q=h(Q*E):(Q=b,L=!0),K.drawImage(te,ne,le,v,x,Y,_,G,Q),ne=Y,le=_,_+=Q;return K.getImageData(ne,le,S,b)},lanczosResize:function(m,v,x,S,b){function T(A){var M,B,P,k,D,F,X,W,$,q,oe;for(_.x=(A+.5)*Q,O.x=h(_.x),M=0;M<b;M++){for(_.y=(M+.5)*Z,O.y=h(_.y),D=0,F=0,X=0,W=0,$=0,B=O.x-ne;B<=O.x+ne;B++)if(!(B<0||B>=v)){q=h(1e3*a(B-_.x)),Y[q]||(Y[q]={});for(var I=O.y-le;I<=O.y+le;I++)I<0||I>=x||(oe=h(1e3*a(I-_.y)),Y[q][oe]||(Y[q][oe]=G(r(u(q*te,2)+u(oe*K,2))/1e3)),P=Y[q][oe],P>0&&(k=(I*v+B)*4,D+=P,F+=P*E[k],X+=P*E[k+1],W+=P*E[k+2],$+=P*E[k+3]))}k=(M*S+A)*4,L[k]=F/D,L[k+1]=X/D,L[k+2]=W/D,L[k+3]=$/D}return++A<S?T(A):N}var E=m.imageData.data,N=m.ctx.createImageData(S,b),L=N.data,G=this.lanczosCreate(this.lanczosLobes),Q=this.rcpScaleX,Z=this.rcpScaleY,te=2/this.rcpScaleX,K=2/this.rcpScaleY,ne=f(Q*this.lanczosLobes/2),le=f(Z*this.lanczosLobes/2),Y={},_={},O={};return T(0)},bilinearFiltering:function(m,v,x,S,b){var T,E,N,L,G,Q,Z,te,K,ne,le,Y,_=0,O,A=this.rcpScaleX,M=this.rcpScaleY,B=4*(v-1),P=m.imageData,k=P.data,D=m.ctx.createImageData(S,b),F=D.data;for(Z=0;Z<b;Z++)for(te=0;te<S;te++)for(G=h(A*te),Q=h(M*Z),K=A*te-G,ne=M*Z-Q,O=4*(Q*v+G),le=0;le<4;le++)T=k[O+le],E=k[O+4+le],N=k[O+B+le],L=k[O+B+4+le],Y=T*(1-K)*(1-ne)+E*K*(1-ne)+N*ne*(1-K)+L*K*ne,F[_++]=Y;return D},hermiteFastResize:function(m,v,x,S,b){for(var T=this.rcpScaleX,E=this.rcpScaleY,N=f(T/2),L=f(E/2),G=m.imageData,Q=G.data,Z=m.ctx.createImageData(S,b),te=Z.data,K=0;K<b;K++)for(var ne=0;ne<S;ne++){for(var le=(ne+K*S)*4,Y=0,_=0,O=0,A=0,M=0,B=0,P=0,k=(K+.5)*E,D=h(K*E);D<(K+1)*E;D++)for(var F=a(k-(D+.5))/L,X=(ne+.5)*T,W=F*F,$=h(ne*T);$<(ne+1)*T;$++){var q=a(X-($+.5))/N,oe=r(W+q*q);oe>1&&oe<-1||(Y=2*oe*oe*oe-3*oe*oe+1,Y>0&&(q=4*($+D*v),P+=Y*Q[q+3],O+=Y,Q[q+3]<255&&(Y=Y*Q[q+3]/250),A+=Y*Q[q],M+=Y*Q[q+1],B+=Y*Q[q+2],_+=Y))}te[le]=A/_,te[le+1]=M/_,te[le+2]=B/_,te[le+3]=P/O}return Z},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Contrast=h(u.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var a=r.imageData,i,f,o=a.data,f=o.length,l=Math.floor(this.contrast*255),g=259*(l+255)/(255*(259-l));for(i=0;i<f;i+=4)o[i]=g*(o[i]-128)+128,o[i+1]=g*(o[i+1]-128)+128,o[i+2]=g*(o[i+2]-128)+128}},getUniformLocations:function(r,a){return{uContrast:r.getUniformLocation(a,"uContrast")}},sendUniformData:function(r,a){r.uniform1f(a.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Saturation=h(u.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var a=r.imageData,i=a.data,o=i.length,f=-this.saturation,l,g;for(l=0;l<o;l+=4)g=Math.max(i[l],i[l+1],i[l+2]),i[l]+=g!==i[l]?(g-i[l])*f:0,i[l+1]+=g!==i[l+1]?(g-i[l+1])*f:0,i[l+2]+=g!==i[l+2]?(g-i[l+2])*f:0}},getUniformLocations:function(r,a){return{uSaturation:r.getUniformLocation(a,"uSaturation")}},sendUniformData:function(r,a){r.uniform1f(a.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Vibrance=h(u.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var a=r.imageData,i=a.data,o=i.length,f=-this.vibrance,l,g,m,v;for(l=0;l<o;l+=4)g=Math.max(i[l],i[l+1],i[l+2]),m=(i[l]+i[l+1]+i[l+2])/3,v=Math.abs(g-m)*2/255*f,i[l]+=g!==i[l]?(g-i[l])*v:0,i[l+1]+=g!==i[l+1]?(g-i[l+1])*v:0,i[l+2]+=g!==i[l+2]?(g-i[l+2])*v:0}},getUniformLocations:function(r,a){return{uVibrance:r.getUniformLocation(a,"uVibrance")}},sendUniformData:function(r,a){r.uniform1f(a.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Blur=h(u.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var a=r.filterBackend.resources,i,o,f=r.imageData.width,l=r.imageData.height;a.blurLayer1||(a.blurLayer1=s.util.createCanvasElement(),a.blurLayer2=s.util.createCanvasElement()),i=a.blurLayer1,o=a.blurLayer2,(i.width!==f||i.height!==l)&&(o.width=i.width=f,o.height=i.height=l);var g=i.getContext("2d"),m=o.getContext("2d"),v=15,x,S,b,T,E=this.blur*.06*.5;for(g.putImageData(r.imageData,0,0),m.clearRect(0,0,f,l),T=-v;T<=v;T++)x=(Math.random()-.5)/4,S=T/v,b=E*S*f+x,m.globalAlpha=1-Math.abs(S),m.drawImage(i,b,x),g.drawImage(o,0,0),m.globalAlpha=1,m.clearRect(0,0,o.width,o.height);for(T=-v;T<=v;T++)x=(Math.random()-.5)/4,S=T/v,b=E*S*l+x,m.globalAlpha=1-Math.abs(S),m.drawImage(i,x,b),g.drawImage(o,0,0),m.globalAlpha=1,m.clearRect(0,0,o.width,o.height);r.ctx.drawImage(i,0,0);var N=r.ctx.getImageData(0,0,i.width,i.height);return g.globalAlpha=1,g.clearRect(0,0,i.width,i.height),N},getUniformLocations:function(r,a){return{delta:r.getUniformLocation(a,"uDelta")}},sendUniformData:function(r,a){var i=this.chooseRightDelta();r.uniform2fv(a.delta,i)},chooseRightDelta:function(){var r=1,a=[0,0],i;return this.horizontal?this.aspectRatio>1&&(r=1/this.aspectRatio):this.aspectRatio<1&&(r=this.aspectRatio),i=r*this.blur*.12,this.horizontal?a[0]=i:a[1]=i,a}}),u.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Gamma=h(u.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],u.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var a=r.imageData,i=a.data,o=this.gamma,f=i.length,l=1/o[0],g=1/o[1],m=1/o[2],v;for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),v=0,f=256;v<f;v++)this.rVals[v]=Math.pow(v/255,l)*255,this.gVals[v]=Math.pow(v/255,g)*255,this.bVals[v]=Math.pow(v/255,m)*255;for(v=0,f=i.length;v<f;v+=4)i[v]=this.rVals[i[v]],i[v+1]=this.gVals[i[v+1]],i[v+2]=this.bVals[i[v+2]]},getUniformLocations:function(r,a){return{uGamma:r.getUniformLocation(a,"uGamma")}},sendUniformData:function(r,a){r.uniform3fv(a.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.Composed=h(u.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(a){a.applyTo(r)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(r,a){var i=r.subFilters||[],o=i.map(function(l){return new s.Image.filters[l.type](l)}),f=new s.Image.filters.Composed({subFilters:o});return a&&a(f),f}}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.Image.filters,h=s.util.createClass;u.HueRotation=h(u.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,a=s.util.cos(r),i=s.util.sin(r),o=1/3,f=Math.sqrt(o)*i,l=1-a;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=a+l/3,this.matrix[1]=o*l-f,this.matrix[2]=o*l+f,this.matrix[5]=o*l+f,this.matrix[6]=a+o*l,this.matrix[7]=o*l-f,this.matrix[10]=o*l-f,this.matrix[11]=o*l+f,this.matrix[12]=a+o*l},isNeutralState:function(r){return this.calculateMatrix(),u.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),u.BaseFilter.prototype.applyTo.call(this,r)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(t),function(d){var s=d.fabric||(d.fabric={}),u=s.util.object.clone;if(s.Text){s.warn("fabric.Text is already defined");return}var h="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(h),cacheProperties:s.Object.prototype.cacheProperties.concat(h),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,a){this.styles=a?a.styles||{}:{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",a),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=s.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){if(!this.__skipDimension){if(this._splitText(),this._clearCache(),this.path){var r=this.getHeightOfLine(0)*1.1;this.width=this.path.width+r,this.height=this.path.height+r}else this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight();this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"})}},enlargeSpaces:function(){for(var r,a,i,o,f,l,g,m=0,v=this._textLines.length;m<v;m++)if(!(this.textAlign!=="justify"&&(m===v-1||this.isEndOfWrapping(m)))&&(o=0,f=this._textLines[m],a=this.getLineWidth(m),a<this.width&&(g=this.textLines[m].match(this._reSpacesAndTabs)))){i=g.length,r=(this.width-a)/i;for(var x=0,S=f.length;x<=S;x++)l=this.__charBounds[m][x],this._reSpaceAndTab.test(f[x])?(l.width+=r,l.kernedWidth+=r,l.left+=o,o+=r):l.left+=o}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),a=this.fontSize;return r.width+=a*r.zoomX,r.height+=a*r.zoomY,r},_render:function(r){var a=this.path;a&&!a.isNotVisible()&&a._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,a,i){if(r.textBaseline="alphabetic",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom";break}r.font=this._getFontDeclaration(a,i)},calcTextWidth:function(){for(var r=this.getLineWidth(0),a=1,i=this._textLines.length;a<i;a++){var o=this.getLineWidth(a);o>r&&(r=o)}return r},_renderTextLine:function(r,a,i,o,f,l){this._renderChars(r,a,i,o,f,l)},_renderTextLinesBackground:function(r){if(!(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))){for(var a,i,o=r.fillStyle,f,l,g=this._getLeftOffset(),m=this._getTopOffset(),v=0,x=0,S,b,T=this.path,E,N=0,L=this._textLines.length;N<L;N++){if(a=this.getHeightOfLine(N),!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",N)){m+=a;continue}f=this._textLines[N],i=this._getLineLeftOffset(N),x=0,v=0,l=this.getValueOfPropertyAt(N,0,"textBackgroundColor");for(var G=0,Q=f.length;G<Q;G++)S=this.__charBounds[N][G],b=this.getValueOfPropertyAt(N,G,"textBackgroundColor"),T?(r.save(),r.translate(S.renderLeft,S.renderTop),r.rotate(S.angle),r.fillStyle=b,b&&r.fillRect(-S.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),S.width,a/this.lineHeight),r.restore()):b!==l?(E=g+i+v,this.direction==="rtl"&&(E=this.width-E-x),r.fillStyle=l,l&&r.fillRect(E,m,x,a/this.lineHeight),v=S.left,x=S.width,l=b):x+=S.kernedWidth;b&&!T&&(E=g+i+v,this.direction==="rtl"&&(E=this.width-E-x),r.fillStyle=b,r.fillRect(E,m,x,a/this.lineHeight)),m+=a}r.fillStyle=o,this._removeShadow(r)}},getFontCache:function(r){var a=r.fontFamily.toLowerCase();s.charWidthsCache[a]||(s.charWidthsCache[a]={});var i=s.charWidthsCache[a],o=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return i[o]||(i[o]={}),i[o]},_measureChar:function(r,a,i,o){var f=this.getFontCache(a),l=this._getFontDeclaration(a),g=this._getFontDeclaration(o),m=i+r,v=l===g,x,S,b,T=a.fontSize/this.CACHE_FONT_SIZE,E;if(i&&f[i]!==void 0&&(b=f[i]),f[r]!==void 0&&(E=x=f[r]),v&&f[m]!==void 0&&(S=f[m],E=S-b),x===void 0||b===void 0||S===void 0){var N=this.getMeasuringContext();this._setTextStyles(N,a,!0)}return x===void 0&&(E=x=N.measureText(r).width,f[r]=x),b===void 0&&v&&i&&(b=N.measureText(i).width,f[i]=b),v&&S===void 0&&(S=N.measureText(m).width,f[m]=S,E=S-b),{width:x*T,kernedWidth:E*T}},getHeightOfChar:function(r,a){return this.getValueOfPropertyAt(r,a,"fontSize")},measureLine:function(r){var a=this._measureLine(r);return this.charSpacing!==0&&(a.width-=this._getWidthOfCharSpacing()),a.width<0&&(a.width=0),a},_measureLine:function(r){var a=0,i,o,f=this._textLines[r],l,g,m=0,v=new Array(f.length),x=0,S,b,T=this.path,E=this.pathSide==="right";for(this.__charBounds[r]=v,i=0;i<f.length;i++)o=f[i],g=this._getGraphemeBox(o,r,i,l),v[i]=g,a+=g.kernedWidth,l=o;if(v[i]={left:g?g.left+g.width:0,width:0,kernedWidth:0,height:this.fontSize},T){switch(b=T.segmentsInfo[T.segmentsInfo.length-1].length,S=s.util.getPointOnPath(T.path,0,T.segmentsInfo),S.x+=T.pathOffset.x,S.y+=T.pathOffset.y,this.textAlign){case"left":x=E?b-a:0;break;case"center":x=(b-a)/2;break;case"right":x=E?0:b-a;break}for(x+=this.pathStartOffset*(E?-1:1),i=E?f.length-1:0;E?i>=0:i<f.length;E?i--:i++)g=v[i],x>b?x%=b:x<0&&(x+=b),this._setGraphemeOnPath(x,g,S),x+=g.kernedWidth}return{width:a,numOfSpaces:m}},_setGraphemeOnPath:function(r,a,i){var o=r+a.kernedWidth/2,f=this.path,l=s.util.getPointOnPath(f.path,o,f.segmentsInfo);a.renderLeft=l.x-i.x,a.renderTop=l.y-i.y,a.angle=l.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,a,i,o,f){var l=this.getCompleteStyleDeclaration(a,i),g=o?this.getCompleteStyleDeclaration(a,i-1):{},m=this._measureChar(r,l,o,g),v=m.kernedWidth,x=m.width,S;this.charSpacing!==0&&(S=this._getWidthOfCharSpacing(),x+=S,v+=S);var b={width:x,left:0,height:l.fontSize,kernedWidth:v,deltaY:l.deltaY};if(i>0&&!f){var T=this.__charBounds[a][i-1];b.left=T.left+T.width+m.kernedWidth-m.width}return b},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var a=this._textLines[r],i=this.getHeightOfChar(r,0),o=1,f=a.length;o<f;o++)i=Math.max(this.getHeightOfChar(r,o),i);return this.__lineHeights[r]=i*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,a=0,i=0,o=this._textLines.length;i<o;i++)r=this.getHeightOfLine(i),a+=i===o-1?r/this.lineHeight:r;return a},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,a){r.save();for(var i=0,o=this._getLeftOffset(),f=this._getTopOffset(),l=0,g=this._textLines.length;l<g;l++){var m=this.getHeightOfLine(l),v=m/this.lineHeight,x=this._getLineLeftOffset(l);this._renderTextLine(a,r,this._textLines[l],o+x,f+i+v,l),i+=m}r.restore()},_renderTextFill:function(r){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,a,i,o,f,l){var g=this.getHeightOfLine(l),m=this.textAlign.indexOf("justify")!==-1,v,x,S="",b,T=0,E,N=this.path,L=!m&&this.charSpacing===0&&this.isEmptyStyles(l)&&!N,G=this.direction==="ltr",Q=this.direction==="ltr"?1:-1,Z,te=a.canvas.getAttribute("dir");if(a.save(),te!==this.direction&&(a.canvas.setAttribute("dir",G?"ltr":"rtl"),a.direction=G?"ltr":"rtl",a.textAlign=G?"left":"right"),f-=g*this._fontSizeFraction/this.lineHeight,L){this._renderChar(r,a,l,0,i.join(""),o,f,g),a.restore();return}for(var K=0,ne=i.length-1;K<=ne;K++)E=K===ne||this.charSpacing||N,S+=i[K],b=this.__charBounds[l][K],T===0?(o+=Q*(b.kernedWidth-b.width),T+=b.width):T+=b.kernedWidth,m&&!E&&this._reSpaceAndTab.test(i[K])&&(E=!0),E||(v=v||this.getCompleteStyleDeclaration(l,K),x=this.getCompleteStyleDeclaration(l,K+1),E=s.util.hasStyleChanged(v,x,!1)),E&&(N?(a.save(),a.translate(b.renderLeft,b.renderTop),a.rotate(b.angle),this._renderChar(r,a,l,K,S,-T/2,0,g),a.restore()):(Z=o,this._renderChar(r,a,l,K,S,Z,f,g)),S="",v=x,o+=Q*T,T=0);a.restore()},_applyPatternGradientTransformText:function(r){var a=s.util.createCanvasElement(),i,o=this.width+this.strokeWidth,f=this.height+this.strokeWidth;return a.width=o,a.height=f,i=a.getContext("2d"),i.beginPath(),i.moveTo(0,0),i.lineTo(o,0),i.lineTo(o,f),i.lineTo(0,f),i.closePath(),i.translate(o/2,f/2),i.fillStyle=r.toLive(i),this._applyPatternGradientTransform(i,r),i.fill(),i.createPattern(a,"no-repeat")},handleFiller:function(r,a,i){var o,f;return i.toLive?i.gradientUnits==="percentage"||i.gradientTransform||i.patternTransform?(o=-this.width/2,f=-this.height/2,r.translate(o,f),r[a]=this._applyPatternGradientTransformText(i),{offsetX:o,offsetY:f}):(r[a]=i.toLive(r,this),this._applyPatternGradientTransform(r,i)):(r[a]=i,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,a){return r.lineWidth=a.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",a.stroke)},_setFillStyles:function(r,a){return this.handleFiller(r,"fillStyle",a.fill)},_renderChar:function(r,a,i,o,f,l,g){var m=this._getStyleDeclaration(i,o),v=this.getCompleteStyleDeclaration(i,o),x=r==="fillText"&&v.fill,S=r==="strokeText"&&v.stroke&&v.strokeWidth,b,T;!S&&!x||(a.save(),x&&(b=this._setFillStyles(a,v)),S&&(T=this._setStrokeStyles(a,v)),a.font=this._getFontDeclaration(v),m&&m.textBackgroundColor&&this._removeShadow(a),m&&m.deltaY&&(g+=m.deltaY),x&&a.fillText(f,l-b.offsetX,g-b.offsetY),S&&a.strokeText(f,l-T.offsetX,g-T.offsetY),a.restore())},setSuperscript:function(r,a){return this._setScript(r,a,this.superscript)},setSubscript:function(r,a){return this._setScript(r,a,this.subscript)},_setScript:function(r,a,i){var o=this.get2DCursorLocation(r,!0),f=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"fontSize"),l=this.getValueOfPropertyAt(o.lineIndex,o.charIndex,"deltaY"),g={fontSize:f*i.size,deltaY:l+f*i.baseline};return this.setSelectionStyles(g,r,a),this},_getLineLeftOffset:function(r){var a=this.getLineWidth(r),i=this.width-a,o=this.textAlign,f=this.direction,g,l=0,g=this.isEndOfWrapping(r);return o==="justify"||o==="justify-center"&&!g||o==="justify-right"&&!g||o==="justify-left"&&!g?0:(o==="center"&&(l=i/2),o==="right"&&(l=i),o==="justify-center"&&(l=i/2),o==="justify-right"&&(l=i),f==="rtl"&&(l-=i),l)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var a=this.measureLine(r),i=a.width;return this.__lineWidths[r]=i,i},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,a,i){var o=this._getStyleDeclaration(r,a);return o&&typeof o[i]<"u"?o[i]:this[i]},_renderTextDecoration:function(r,a){if(!(!this[a]&&!this.styleHas(a))){r.save(),(a==="overline"||a==="linethrough")&&this._removeShadow(r);for(var i,o,f,l,g,m,v,x,S=this._getLeftOffset(),b=this._getTopOffset(),T,E,N,L,G,Q,Z,te,K=this.path,ne=this._getWidthOfCharSpacing(),le=this.offsets[a],Y=0,_=this._textLines.length;Y<_;Y++){if(i=this.getHeightOfLine(Y),!this[a]&&!this.styleHas(a,Y)){b+=i;continue}v=this._textLines[Y],Q=i/this.lineHeight,l=this._getLineLeftOffset(Y),E=0,N=0,x=this.getValueOfPropertyAt(Y,0,a),te=this.getValueOfPropertyAt(Y,0,"fill"),T=b+Q*(1-this._fontSizeFraction),o=this.getHeightOfChar(Y,0),g=this.getValueOfPropertyAt(Y,0,"deltaY");for(var O=0,A=v.length;O<A;O++)if(L=this.__charBounds[Y][O],G=this.getValueOfPropertyAt(Y,O,a),Z=this.getValueOfPropertyAt(Y,O,"fill"),f=this.getHeightOfChar(Y,O),m=this.getValueOfPropertyAt(Y,O,"deltaY"),K&&G&&Z)r.save(),r.fillStyle=te,r.translate(L.renderLeft,L.renderTop),r.rotate(L.angle),r.fillRect(-L.kernedWidth/2,le*f+m,L.kernedWidth,this.fontSize/15),r.restore();else if((G!==x||Z!==te||f!==o||m!==g)&&N>0){var M=S+l+E;this.direction==="rtl"&&(M=this.width-M-N),x&&te&&(r.fillStyle=te,r.fillRect(M,T+le*o+g,N,this.fontSize/15)),E=L.left,N=L.width,x=G,te=Z,o=f,g=m}else N+=L.kernedWidth;var M=S+l+E;this.direction==="rtl"&&(M=this.width-M-N),r.fillStyle=Z,G&&Z&&r.fillRect(M,T+le*o+g,N-ne,this.fontSize/15),b+=i}r.restore()}},_getFontDeclaration:function(r,a){var i=r||this,o=this.fontFamily,f=s.Text.genericFonts.indexOf(o.toLowerCase())>-1,l=o===void 0||o.indexOf("'")>-1||o.indexOf(",")>-1||o.indexOf('"')>-1||f?i.fontFamily:'"'+i.fontFamily+'"';return[s.isLikelyNode?i.fontWeight:i.fontStyle,s.isLikelyNode?i.fontStyle:i.fontWeight,a?this.CACHE_FONT_SIZE+"px":i.fontSize+"px",l].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var a=r.split(this._reNewline),i=new Array(a.length),o=[`
`],f=[],l=0;l<a.length;l++)i[l]=s.util.string.graphemeSplit(a[l]),f=f.concat(i[l],o);return f.pop(),{_unwrappedLines:i,lines:a,graphemeText:f,graphemeLines:i}},toObject:function(r){var a=h.concat(r),i=this.callSuper("toObject",a);return i.styles=s.util.stylesToArray(this.styles,this.text),i.path&&(i.path=this.path.toObject()),i},set:function(r,a){this.callSuper("set",r,a);var i=!1,o=!1;if(typeof r=="object")for(var f in r)f==="path"&&this.setPathInfo(),i=i||this._dimensionAffectingProps.indexOf(f)!==-1,o=o||f==="path";else i=this._dimensionAffectingProps.indexOf(r)!==-1,o=r==="path";return o&&this.setPathInfo(),i&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(r,a,i){if(!r)return a(null);var o=s.parseAttributes(r,s.Text.ATTRIBUTE_NAMES),f=o.textAnchor||"left";if(i=s.util.object.extend(i?u(i):{},o),i.top=i.top||0,i.left=i.left||0,o.textDecoration){var l=o.textDecoration;l.indexOf("underline")!==-1&&(i.underline=!0),l.indexOf("overline")!==-1&&(i.overline=!0),l.indexOf("line-through")!==-1&&(i.linethrough=!0),delete i.textDecoration}"dx"in o&&(i.left+=o.dx),"dy"in o&&(i.top+=o.dy),"fontSize"in i||(i.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var g="";"textContent"in r?g=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(g=r.firstChild.data),g=g.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var m=i.strokeWidth;i.strokeWidth=0;var v=new s.Text(g,i),x=v.getScaledHeight()/v.height,S=(v.height+v.strokeWidth)*v.lineHeight-v.height,b=S*x,T=v.getScaledHeight()+b,E=0;f==="center"&&(E=v.getScaledWidth()/2),f==="right"&&(E=v.getScaledWidth()),v.set({left:v.left-E,top:v.top-(T-v.fontSize*(.07+v._fontSizeFraction))/v.lineHeight,strokeWidth:typeof m<"u"?m:1}),a(v)},s.Text.fromObject=function(r,a){var i=u(r),o=r.path;return delete i.path,s.Object._fromObject("Text",i,function(f){f.styles=s.util.stylesFromArray(r.styles,r.text),o?s.Object._fromObject("Path",o,function(l){f.set("path",l),a(f)},"path"):a(f)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}(t),function(){e.util.object.extend(e.Text.prototype,{isEmptyStyles:function(d){if(!this.styles||typeof d<"u"&&!this.styles[d])return!0;var s=typeof d>"u"?this.styles:{line:this.styles[d]};for(var u in s)for(var h in s[u])for(var r in s[u][h])return!1;return!0},styleHas:function(d,s){if(!this.styles||!d||d===""||typeof s<"u"&&!this.styles[s])return!1;var u=typeof s>"u"?this.styles:{0:this.styles[s]};for(var h in u)for(var r in u[h])if(typeof u[h][r][d]<"u")return!0;return!1},cleanStyle:function(d){if(!this.styles||!d||d==="")return!1;var s=this.styles,u=0,h,r,a=!0,i=0,o;for(var f in s){h=0;for(var l in s[f]){var o=s[f][l],g=o.hasOwnProperty(d);u++,g?(r?o[d]!==r&&(a=!1):r=o[d],o[d]===this[d]&&delete o[d]):a=!1,Object.keys(o).length!==0?h++:delete s[f][l]}h===0&&delete s[f]}for(var m=0;m<this._textLines.length;m++)i+=this._textLines[m].length;a&&u===i&&(this[d]=r,this.removeStyle(d))},removeStyle:function(d){if(!(!this.styles||!d||d==="")){var s=this.styles,u,h,r;for(h in s){u=s[h];for(r in u)delete u[r][d],Object.keys(u[r]).length===0&&delete u[r];Object.keys(u).length===0&&delete s[h]}}},_extendStyles:function(d,s){var u=this.get2DCursorLocation(d);this._getLineStyle(u.lineIndex)||this._setLineStyle(u.lineIndex),this._getStyleDeclaration(u.lineIndex,u.charIndex)||this._setStyleDeclaration(u.lineIndex,u.charIndex,{}),e.util.object.extend(this._getStyleDeclaration(u.lineIndex,u.charIndex),s)},get2DCursorLocation:function(d,s){typeof d>"u"&&(d=this.selectionStart);for(var u=s?this._unwrappedTextLines:this._textLines,h=u.length,r=0;r<h;r++){if(d<=u[r].length)return{lineIndex:r,charIndex:d};d-=u[r].length+this.missingNewlineOffset(r,s)}return{lineIndex:r-1,charIndex:u[r-1].length<d?u[r-1].length:d}},getSelectionStyles:function(d,s,u){typeof d>"u"&&(d=this.selectionStart||0),typeof s>"u"&&(s=this.selectionEnd||d);for(var h=[],r=d;r<s;r++)h.push(this.getStyleAtPosition(r,u));return h},getStyleAtPosition:function(d,s){var u=this.get2DCursorLocation(d),h=s?this.getCompleteStyleDeclaration(u.lineIndex,u.charIndex):this._getStyleDeclaration(u.lineIndex,u.charIndex);return h||{}},setSelectionStyles:function(d,s,u){typeof s>"u"&&(s=this.selectionStart||0),typeof u>"u"&&(u=this.selectionEnd||s);for(var h=s;h<u;h++)this._extendStyles(h,d);return this._forceClearCache=!0,this},_getStyleDeclaration:function(d,s){var u=this.styles&&this.styles[d];return u?u[s]:null},getCompleteStyleDeclaration:function(d,s){for(var u=this._getStyleDeclaration(d,s)||{},h={},r,a=0;a<this._styleProperties.length;a++)r=this._styleProperties[a],h[r]=typeof u[r]>"u"?this[r]:u[r];return h},_setStyleDeclaration:function(d,s,u){this.styles[d][s]=u},_deleteStyleDeclaration:function(d,s){delete this.styles[d][s]},_getLineStyle:function(d){return!!this.styles[d]},_setLineStyle:function(d){this.styles[d]={}},_deleteLineStyle:function(d){delete this.styles[d]}})}(),function(){function d(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}e.IText=e.util.createClass(e.Text,e.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,u){this.callSuper("initialize",s,u),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,u){this[s]!==u&&(this._fireSelectionChanged(),this[s]=u),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var u=this.canvas.contextTop,h=this.canvas.viewportTransform;u.save(),u.transform(h[0],h[1],h[2],h[3],h[4],h[5]),this.transform(u),this._clearTextArea(u),s||u.restore()}},renderCursorOrSelection:function(){if(!(!this.isEditing||!this.canvas||!this.canvas.contextTop)){var s=this._getCursorBoundaries(),u=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,u):this.renderSelection(s,u),u.restore()}},_clearTextArea:function(s){var u=this.width+4,h=this.height+4;s.clearRect(-u/2,-h/2,u,h)},_getCursorBoundaries:function(s){typeof s>"u"&&(s=this.selectionStart);var u=this._getLeftOffset(),h=this._getTopOffset(),r=this._getCursorBoundariesOffsets(s);return{left:u,top:h,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var u,h,r,a=0,i=0,o,f=this.get2DCursorLocation(s);r=f.charIndex,h=f.lineIndex;for(var l=0;l<h;l++)a+=this.getHeightOfLine(l);u=this._getLineLeftOffset(h);var g=this.__charBounds[h][r];return g&&(i=g.left),this.charSpacing!==0&&r===this._textLines[h].length&&(i-=this._getWidthOfCharSpacing()),o={top:a,left:u+(i>0?i:0)},this.direction==="rtl"&&(o.left*=-1),this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(s,u){var h=this.get2DCursorLocation(),r=h.lineIndex,a=h.charIndex>0?h.charIndex-1:0,i=this.getValueOfPropertyAt(r,a,"fontSize"),o=this.scaleX*this.canvas.getZoom(),f=this.cursorWidth/o,l=s.topOffset,g=this.getValueOfPropertyAt(r,a,"deltaY");l+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-i*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,u),u.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,a,"fill"),u.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,u.fillRect(s.left+s.leftOffset-f/2,l+s.top+g,f,i)},renderSelection:function(s,u){for(var h=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,a=this.textAlign.indexOf("justify")!==-1,i=this.get2DCursorLocation(h),o=this.get2DCursorLocation(r),f=i.lineIndex,l=o.lineIndex,g=i.charIndex<0?0:i.charIndex,m=o.charIndex<0?0:o.charIndex,v=f;v<=l;v++){var x=this._getLineLeftOffset(v)||0,S=this.getHeightOfLine(v),b=0,T=0,E=0;if(v===f&&(T=this.__charBounds[f][g].left),v>=f&&v<l)E=a&&!this.isEndOfWrapping(v)?this.width:this.getLineWidth(v)||5;else if(v===l)if(m===0)E=this.__charBounds[l][m].left;else{var N=this._getWidthOfCharSpacing();E=this.__charBounds[l][m-1].left+this.__charBounds[l][m-1].width-N}b=S,(this.lineHeight<1||v===l&&this.lineHeight>1)&&(S/=this.lineHeight);var L=s.left+x+T,G=E-T,Q=S,Z=0;this.inCompositionMode?(u.fillStyle=this.compositionColor||"black",Q=1,Z=S):u.fillStyle=this.selectionColor,this.direction==="rtl"&&(L=this.width-L-G),u.fillRect(L,s.top+s.topOffset+Z,G,Q),s.topOffset+=b}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),u=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:u}}}),e.IText.fromObject=function(s,u){var h=e.util.stylesFromArray(s.styles,s.text),r=Object.assign({},s,{styles:h});if(delete r.path,d(r),r.styles)for(var a in r.styles)for(var i in r.styles[a])d(r.styles[a][i]);e.Object._fromObject("IText",r,function(o){s.path?e.Object._fromObject("Path",s.path,function(f){o.set("path",f),u(o)},"path"):u(o)},"text")}}(),function(){var d=e.util.object.clone;e.util.object.extend(e.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var s=this;this.on("added",function(){var u=s.canvas;u&&(u._hasITextHandlers||(u._hasITextHandlers=!0,s._initCanvasHandlers(u)),u._iTextInstances=u._iTextInstances||[],u._iTextInstances.push(s))})},initRemovedHandler:function(){var s=this;this.on("removed",function(){var u=s.canvas;u&&(u._iTextInstances=u._iTextInstances||[],e.util.removeFromArray(u._iTextInstances,s),u._iTextInstances.length===0&&(u._hasITextHandlers=!1,s._removeCanvasHandlers(u)))})},_initCanvasHandlers:function(s){s._mouseUpITextHandler=function(){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.__isMousedown=!1})},s.on("mouse:up",s._mouseUpITextHandler)},_removeCanvasHandlers:function(s){s.off("mouse:up",s._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(s,u,h,r){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},s.animate("_currentCursorOpacity",u,{duration:h,onComplete:function(){a.isAborted||s[r]()},onChange:function(){s.canvas&&s.selectionStart===s.selectionEnd&&s.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var s=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){s._currentTickCompleteState=s._animateCursor(s,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(s){var u=this,h=s?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){u._tick()},h)},abortCursorAnimation:function(){var s=this._currentTickState||this._currentTickCompleteState,u=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,s&&u&&u.clearContext(u.contextTop||u.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(s){var u=0,h=s-1;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)u++,h--;for(;/\S/.test(this._text[h])&&h>-1;)u++,h--;return s-u},findWordBoundaryRight:function(s){var u=0,h=s;if(this._reSpace.test(this._text[h]))for(;this._reSpace.test(this._text[h]);)u++,h++;for(;/\S/.test(this._text[h])&&h<this._text.length;)u++,h++;return s+u},findLineBoundaryLeft:function(s){for(var u=0,h=s-1;!/\n/.test(this._text[h])&&h>-1;)u++,h--;return s-u},findLineBoundaryRight:function(s){for(var u=0,h=s;!/\n/.test(this._text[h])&&h<this._text.length;)u++,h++;return s+u},searchWordBoundary:function(s,u){for(var h=this._text,r=this._reSpace.test(h[s])?s-1:s,a=h[r],i=e.reNonWord;!i.test(a)&&r>0&&r<h.length;)r+=u,a=h[r];return i.test(a)&&(r+=u===1?0:1),r},selectWord:function(s){s=s||this.selectionStart;var u=this.searchWordBoundary(s,-1),h=this.searchWordBoundary(s,1);this.selectionStart=u,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(s){s=s||this.selectionStart;var u=this.findLineBoundaryLeft(s),h=this.findLineBoundaryRight(s);return this.selectionStart=u,this.selectionEnd=h,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(s){if(!(this.isEditing||!this.editable))return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(s),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(s){s._iTextInstances&&s._iTextInstances.forEach(function(u){u.selected=!1,u.isEditing&&u.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(s){if(!(!this.__isMousedown||!this.isEditing)){document.activeElement!==this.hiddenTextarea&&this.hiddenTextarea.focus();var u=this.getSelectionStartFromPointer(s.e),h=this.selectionStart,r=this.selectionEnd;(u!==this.__selectionStartOnMouseDown||h===r)&&(h===u||r===u)||(u>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=u):(this.selectionStart=u,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==h||this.selectionEnd!==r)&&(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(s,u,h){var r=h.slice(0,s),a=e.util.string.graphemeSplit(r).length;if(s===u)return{selectionStart:a,selectionEnd:a};var i=h.slice(s,u),o=e.util.string.graphemeSplit(i).length;return{selectionStart:a,selectionEnd:a+o}},fromGraphemeToStringSelection:function(s,u,h){var r=h.slice(0,s),a=r.join("").length;if(s===u)return{selectionStart:a,selectionEnd:a};var i=h.slice(s,u),o=i.join("").length;return{selectionStart:a,selectionEnd:a+o}},_updateTextarea:function(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){var s=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=s.selectionStart,this.hiddenTextarea.selectionEnd=s.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var s=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=s.selectionEnd,this.inCompositionMode||(this.selectionStart=s.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var s=this._calcTextareaPosition();this.hiddenTextarea.style.left=s.left,this.hiddenTextarea.style.top=s.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var s=this.inCompositionMode?this.compositionStart:this.selectionStart,u=this._getCursorBoundaries(s),h=this.get2DCursorLocation(s),r=h.lineIndex,a=h.charIndex,i=this.getValueOfPropertyAt(r,a,"fontSize")*this.lineHeight,o=u.leftOffset,f=this.calcTransformMatrix(),l={x:u.left+o,y:u.top+u.topOffset+i},g=this.canvas.getRetinaScaling(),m=this.canvas.upperCanvasEl,v=m.width/g,x=m.height/g,S=v-i,b=x-i,T=m.clientWidth/v,E=m.clientHeight/x;return l=e.util.transformPoint(l,f),l=e.util.transformPoint(l,this.canvas.viewportTransform),l.x*=T,l.y*=E,l.x<0&&(l.x=0),l.x>S&&(l.x=S),l.y<0&&(l.y=0),l.y>b&&(l.y=b),l.x+=this.canvas._offset.left,l.y+=this.canvas._offset.top,{left:l.x+"px",top:l.y+"px",fontSize:i+"px",charHeight:i}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var s=this._textBeforeEdit!==this.text,u=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,u&&(u.blur&&u.blur(),u.parentNode&&u.parentNode.removeChild(u)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),s&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),s&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var s in this.styles)this._textLines[s]||delete this.styles[s]},removeStyleFromTo:function(s,u){var h=this.get2DCursorLocation(s,!0),r=this.get2DCursorLocation(u,!0),a=h.lineIndex,i=h.charIndex,o=r.lineIndex,f=r.charIndex,l,g;if(a!==o){if(this.styles[a])for(l=i;l<this._unwrappedTextLines[a].length;l++)delete this.styles[a][l];if(this.styles[o])for(l=f;l<this._unwrappedTextLines[o].length;l++)g=this.styles[o][l],g&&(this.styles[a]||(this.styles[a]={}),this.styles[a][i+l-f]=g);for(l=a+1;l<=o;l++)delete this.styles[l];this.shiftLineStyles(o,a-o)}else if(this.styles[a]){g=this.styles[a];var m=f-i,v,x;for(l=i;l<f;l++)delete g[l];for(x in this.styles[a])v=parseInt(x,10),v>=f&&(g[v-m]=g[x],delete g[x])}},shiftLineStyles:function(s,u){var h=d(this.styles);for(var r in this.styles){var a=parseInt(r,10);a>s&&(this.styles[a+u]=h[a],h[a-u]||delete this.styles[a])}},restartCursorIfNeeded:function(){(!this._currentTickState||this._currentTickState.isAborted||!this._currentTickCompleteState||this._currentTickCompleteState.isAborted)&&this.initDelayedCursor()},insertNewlineStyleObject:function(s,u,h,r){var a,i={},o=!1,f=this._unwrappedTextLines[s].length,l=f===u;h||(h=1),this.shiftLineStyles(s,h),this.styles[s]&&(a=this.styles[s][u===0?u:u-1]);for(var g in this.styles[s]){var m=parseInt(g,10);m>=u&&(o=!0,i[m-u]=this.styles[s][g],l&&u===0||delete this.styles[s][g])}var v=!1;for(o&&!l&&(this.styles[s+h]=i,v=!0),(v||f>u)&&h--;h>0;)r&&r[h-1]?this.styles[s+h]={0:d(r[h-1])}:a?this.styles[s+h]={0:d(a)}:delete this.styles[s+h],h--;this._forceClearCache=!0},insertCharStyleObject:function(s,u,h,r){this.styles||(this.styles={});var a=this.styles[s],i=a?d(a):{};h||(h=1);for(var o in i){var f=parseInt(o,10);f>=u&&(a[f+h]=i[f],i[f-h]||delete a[f])}if(this._forceClearCache=!0,r){for(;h--;)Object.keys(r[h]).length&&(this.styles[s]||(this.styles[s]={}),this.styles[s][u+h]=d(r[h]));return}if(a)for(var l=a[u?u-1:1];l&&h--;)this.styles[s][u+h]=d(l)},insertNewStyleBlock:function(s,u,h){for(var r=this.get2DCursorLocation(u,!0),a=[0],i=0,o=0;o<s.length;o++)s[o]===`
`?(i++,a[i]=0):a[i]++;a[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,a[0],h),h=h&&h.slice(a[0]+1)),i&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+a[0],i);for(var o=1;o<i;o++)a[o]>0?this.insertCharStyleObject(r.lineIndex+o,0,a[o],h):h&&this.styles[r.lineIndex+o]&&h[0]&&(this.styles[r.lineIndex+o][0]=h[0]),h=h&&h.slice(a[o]+1);a[o]>0&&this.insertCharStyleObject(r.lineIndex+o,0,a[o],h)},setSelectionStartEndWithShift:function(s,u,h){h<=s?(u===s?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=s),this.selectionStart=h):h>s&&h<u?this._selectionDirection==="right"?this.selectionEnd=h:this.selectionStart=h:(u===s?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=u),this.selectionEnd=h)},setSelectionInBoundaries:function(){var s=this.text.length;this.selectionStart>s?this.selectionStart=s:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>s?this.selectionEnd=s:this.selectionEnd<0&&(this.selectionEnd=0)}})}(),e.util.object.extend(e.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(d){if(this.canvas){this.__newClickTime=+new Date;var s=d.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",d),this._stopEvent(d.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(d){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===d.x&&this.__lastPointer.y===d.y},_stopEvent:function(d){d.preventDefault&&d.preventDefault(),d.stopPropagation&&d.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(d){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(d.e))},tripleClickHandler:function(d){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(d.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(d){!this.canvas||!this.editable||d.e.button&&d.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(d.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(d){!this.canvas||!this.editable||d.e.button&&d.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(d){if(this.__isMousedown=!1,!(!this.editable||this.group||d.transform&&d.transform.actionPerformed||d.e.button&&d.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(d.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(d){var s=this.getSelectionStartFromPointer(d),u=this.selectionStart,h=this.selectionEnd;d.shiftKey?this.setSelectionStartEndWithShift(u,h,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(d){for(var s=this.getLocalPointer(d),u=0,h=0,r=0,a=0,i=0,o,f,l=0,g=this._textLines.length;l<g&&r<=s.y;l++)r+=this.getHeightOfLine(l)*this.scaleY,i=l,l>0&&(a+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));o=this._getLineLeftOffset(i),h=o*this.scaleX,f=this._textLines[i],this.direction==="rtl"&&(s.x=this.width*this.scaleX-s.x+h);for(var m=0,v=f.length;m<v&&(u=h,h+=this.__charBounds[i][m].kernedWidth*this.scaleX,h<=s.x);m++)a++;return this._getNewSelectionStartFromOffset(s,u,h,a,v)},_getNewSelectionStartFromOffset:function(d,s,u,h,r){var a=d.x-s,i=u-d.x,o=i>a||i<0?0:1,f=h+o;return this.flipX&&(f=r-f),f>this._text.length&&(f=this._text.length),f}}),e.util.object.extend(e.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=e.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var d=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+d.top+"; left: "+d.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: "+d.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):e.document.body.appendChild(this.hiddenTextarea),e.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),e.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),e.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),e.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),e.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),e.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(e.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(d){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(d.keyCode in s)this[s[d.keyCode]](d);else if(d.keyCode in this.ctrlKeysMapDown&&(d.ctrlKey||d.metaKey))this[this.ctrlKeysMapDown[d.keyCode]](d);else return;d.stopImmediatePropagation(),d.preventDefault(),d.keyCode>=33&&d.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(d){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(d.keyCode in this.ctrlKeysMapUp&&(d.ctrlKey||d.metaKey))this[this.ctrlKeysMapUp[d.keyCode]](d);else return;d.stopImmediatePropagation(),d.preventDefault(),this.canvas&&this.canvas.requestRenderAll()},onInput:function(d){var s=this.fromPaste;if(this.fromPaste=!1,d&&d.stopPropagation(),!!this.isEditing){var u=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,h=this._text.length,r=u.length,a,i,o=r-h,f=this.selectionStart,l=this.selectionEnd,g=f!==l,m,v,x;if(this.hiddenTextarea.value===""){this.styles={},this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll());return}var S=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),b=f>S.selectionStart;g?(a=this._text.slice(f,l),o+=l-f):r<h&&(b?a=this._text.slice(l+o,l):a=this._text.slice(f,f-o)),i=u.slice(S.selectionEnd-o,S.selectionEnd),a&&a.length&&(i.length&&(m=this.getSelectionStyles(f,f+1,!1),m=i.map(function(){return m[0]})),g?(v=f,x=l):b?(v=l-a.length,x=l):(v=l,x=l+a.length),this.removeStyleFromTo(v,x)),i.length&&(s&&i.join("")===e.copiedText&&!e.disableStyleCopyPaste&&(m=e.copiedTextStyle),this.insertNewStyleBlock(i,f,m)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(d){this.compositionStart=d.target.selectionStart,this.compositionEnd=d.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(e.copiedText=this.getSelectedText(),e.disableStyleCopyPaste?e.copiedTextStyle=null:e.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(d){return d&&d.clipboardData||e.window.clipboardData},_getWidthBeforeCursor:function(d,s){var u=this._getLineLeftOffset(d),h;return s>0&&(h=this.__charBounds[d][s-1],u+=h.left+h.width),u},getDownCursorOffset:function(d,s){var u=this._getSelectionForOffset(d,s),h=this.get2DCursorLocation(u),r=h.lineIndex;if(r===this._textLines.length-1||d.metaKey||d.keyCode===34)return this._text.length-u;var a=h.charIndex,i=this._getWidthBeforeCursor(r,a),o=this._getIndexOnLine(r+1,i),f=this._textLines[r].slice(a);return f.length+o+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(d,s){return d.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(d,s){var u=this._getSelectionForOffset(d,s),h=this.get2DCursorLocation(u),r=h.lineIndex;if(r===0||d.metaKey||d.keyCode===33)return-u;var a=h.charIndex,i=this._getWidthBeforeCursor(r,a),o=this._getIndexOnLine(r-1,i),f=this._textLines[r].slice(0,a),l=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+o-f.length+(1-l)},_getIndexOnLine:function(d,s){for(var u=this._textLines[d],h=this._getLineLeftOffset(d),r=h,a=0,i,o,f=0,l=u.length;f<l;f++)if(i=this.__charBounds[d][f].width,r+=i,r>s){o=!0;var g=r-i,m=r,v=Math.abs(g-s),x=Math.abs(m-s);a=x<v?f:f-1;break}return o||(a=u.length-1),a},moveCursorDown:function(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",d)},moveCursorUp:function(d){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",d)},_moveCursorUpOrDown:function(d,s){var u="get"+d+"CursorOffset",h=this[u](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(h):this.moveCursorWithoutShift(h),h!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(d){var s=this._selectionDirection==="left"?this.selectionStart+d:this.selectionEnd+d;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),d!==0},moveCursorWithoutShift:function(d){return d<0?(this.selectionStart+=d,this.selectionEnd=this.selectionStart):(this.selectionEnd+=d,this.selectionStart=this.selectionEnd),d!==0},moveCursorLeft:function(d){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",d)},_move:function(d,s,u){var h;if(d.altKey)h=this["findWordBoundary"+u](this[s]);else if(d.metaKey||d.keyCode===35||d.keyCode===36)h=this["findLineBoundary"+u](this[s]);else return this[s]+=u==="Left"?-1:1,!0;if(typeof h<"u"&&this[s]!==h)return this[s]=h,!0},_moveLeft:function(d,s){return this._move(d,s,"Left")},_moveRight:function(d,s){return this._move(d,s,"Right")},moveCursorLeftWithoutShift:function(d){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(d,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(d){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd)return this._moveLeft(d,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection="left",this._moveLeft(d,"selectionStart")},moveCursorRight:function(d){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",d)},_moveCursorLeftOrRight:function(d,s){var u="moveCursor"+d+"With";this._currentCursorOpacity=1,s.shiftKey?u+="Shift":u+="outShift",this[u](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(d){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd)return this._moveRight(d,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection="right",this._moveRight(d,"selectionEnd")},moveCursorRightWithoutShift:function(d){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(d,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(d,s){typeof s>"u"&&(s=d+1),this.removeStyleFromTo(d,s),this._text.splice(d,s-d),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(d,s,u,h){typeof h>"u"&&(h=u),h>u&&this.removeStyleFromTo(u,h);var r=e.util.string.graphemeSplit(d);this.insertNewStyleBlock(r,u,s),this._text=[].concat(this._text.slice(0,u),r,this._text.slice(h)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var d=e.util.toFixed,s=e.util.radiansToDegrees,u=e.util.calcRotateMatrix,h=e.util.transformPoint,r=/  +/g;e.util.object.extend(e.Text.prototype,{_toSVG:function(){var a=this._getSVGLeftTopOffsets(),i=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(i)},toSVG:function(a){var i=this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0}),o=this.path;return o?i+o._createBaseSVGMarkup(o._toSVG(),{reviver:a,withShadow:!0}):i},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var i=!0,o=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",o?'text-decoration="'+o+'" ':"",'style="',this.getSvgStyles(i),'"',this.addPaintOrder()," >",a.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(a,i){var o=[],f=[],l=a,g;this._setSVGBg(f);for(var m=0,v=this._textLines.length;m<v;m++)g=this._getLineLeftOffset(m),(this.textBackgroundColor||this.styleHas("textBackgroundColor",m))&&this._setSVGTextLineBg(f,m,i+g,l),this._setSVGTextLineText(o,m,i+g,l),l+=this.getHeightOfLine(m);return{textSpans:o,textBgRects:f}},_createTextCharSpan:function(a,i,o,f,l){var g=a!==a.trim()||a.match(r),m=this.getSvgSpanStyles(i,g),v=m?'style="'+m+'"':"",x=i.deltaY,S="",b=e.Object.NUM_FRACTION_DIGITS,T="";if(x&&(S=' dy="'+d(x,b)+'" '),l.renderLeft!==void 0){var E=l.angle;T=' rotate="'+d(s(E),e.Object.NUM_FRACTION_DIGITS)+'" ';var N=l.width/2,L=u({angle:s(E)});L[4]=l.renderLeft,L[5]=l.renderTop;var G=h({x:-N,y:0},L);o=G.x,f=G.y}return['<tspan x="',d(o,b),'" y="',d(f,b),'" ',S,v,T,">",e.util.string.escapeXml(a),"</tspan>"].join("")},_setSVGTextLineText:function(a,i,o,f){var l=this.getHeightOfLine(i),g=this.textAlign.indexOf("justify")!==-1,m,v,x="",S,b,T=0,E=this._textLines[i],N;f+=l*(1-this._fontSizeFraction)/this.lineHeight;for(var L=0,G=E.length-1;L<=G;L++)N=L===G||this.charSpacing||this.path,x+=E[L],S=this.__charBounds[i][L],T===0?(o+=S.kernedWidth-S.width,T+=S.width):T+=S.kernedWidth,g&&!N&&this._reSpaceAndTab.test(E[L])&&(N=!0),N||(m=m||this.getCompleteStyleDeclaration(i,L),v=this.getCompleteStyleDeclaration(i,L+1),N=e.util.hasStyleChanged(m,v,!0)),N&&(b=this._getStyleDeclaration(i,L)||{},a.push(this._createTextCharSpan(x,b,o,f,S)),x="",m=v,o+=T,T=0)},_pushTextBgRect:function(a,i,o,f,l,g){var m=e.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(i),' x="',d(o,m),'" y="',d(f,m),'" width="',d(l,m),'" height="',d(g,m),`"></rect>
`)},_setSVGTextLineBg:function(a,i,o,f){for(var l=this._textLines[i],g=this.getHeightOfLine(i)/this.lineHeight,m=0,v=0,x,S,b=this.getValueOfPropertyAt(i,0,"textBackgroundColor"),T=0,E=l.length;T<E;T++)x=this.__charBounds[i][T],S=this.getValueOfPropertyAt(i,T,"textBackgroundColor"),S!==b?(b&&this._pushTextBgRect(a,b,o+v,f,m,g),v=x.left,m=x.width,b=S):m+=x.kernedWidth;S&&this._pushTextBgRect(a,S,o+v,f,m,g)},_getFillAttributes:function(a){var i=a&&typeof a=="string"?new e.Color(a):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+a+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_getSVGLineTopOffset:function(a){for(var i=0,o=0,f=0;f<a;f++)i+=this.getHeightOfLine(f);return o=this.getHeightOfLine(f),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*o/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){var i=e.Object.prototype.getSvgStyles.call(this,a);return i+" white-space: pre;"}})}(),function(d){var s=d.fabric||(d.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(u){for(var h=0,r=0,a=0,i={},o=0;o<u.graphemeLines.length;o++)u.graphemeText[a]===`
`&&o>0?(r=0,a++,h++):!this.splitByGrapheme&&this._reSpaceAndTab.test(u.graphemeText[a])&&o>0&&(r++,a++),i[o]={line:h,offset:r},a+=u.graphemeLines[o].length,r+=u.graphemeLines[o].length;return i},styleHas:function(u,h){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[h];r&&(h=r.line)}return s.Text.prototype.styleHas.call(this,u,h)},isEmptyStyles:function(u){if(!this.styles)return!0;var h=0,r=u+1,a,i,o=!1,f=this._styleMap[u],l=this._styleMap[u+1];f&&(u=f.line,h=f.offset),l&&(r=l.line,o=r===u,a=l.offset),i=typeof u>"u"?this.styles:{line:this.styles[u]};for(var g in i)for(var m in i[g])if(m>=h&&(!o||m<a))for(var v in i[g][m])return!1;return!0},_getStyleDeclaration:function(u,h){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];if(!r)return null;u=r.line,h=r.offset+h}return this.callSuper("_getStyleDeclaration",u,h)},_setStyleDeclaration:function(u,h,r){var a=this._styleMap[u];u=a.line,h=a.offset+h,this.styles[u][h]=r},_deleteStyleDeclaration:function(u,h){var r=this._styleMap[u];u=r.line,h=r.offset+h,delete this.styles[u][h]},_getLineStyle:function(u){var h=this._styleMap[u];return!!this.styles[h.line]},_setLineStyle:function(u){var h=this._styleMap[u];this.styles[h.line]={}},_wrapText:function(u,h){var r=[],a;for(this.isWrapping=!0,a=0;a<u.length;a++)r=r.concat(this._wrapLine(u[a],a,h));return this.isWrapping=!1,r},_measureWord:function(u,h,r){var a=0,i,o=!0;r=r||0;for(var f=0,l=u.length;f<l;f++){var g=this._getGraphemeBox(u[f],h,f+r,i,o);a+=g.kernedWidth,i=u[f]}return a},_wrapLine:function(u,h,r,L){var i=0,o=this.splitByGrapheme,f=[],l=[],g=o?s.util.string.graphemeSplit(u):u.split(this._wordJoiners),m="",v=0,x=o?"":" ",S=0,b=0,T=0,E=!0,N=this._getWidthOfCharSpacing(),L=L||0;g.length===0&&g.push([]),r-=L;for(var G=0;G<g.length;G++)m=o?g[G]:s.util.string.graphemeSplit(g[G]),S=this._measureWord(m,h,v),v+=m.length,i+=b+S-N,i>r&&!E?(f.push(l),l=[],i=S,E=!0):i+=N,!E&&!o&&l.push(x),l=l.concat(m),b=o?0:this._measureWord([x],h,v),v++,E=!1,S>T&&(T=S);return G&&f.push(l),T+L>this.dynamicMinWidth&&(this.dynamicMinWidth=T-N+L),f},isEndOfWrapping:function(u){return!this._styleMap[u+1]||this._styleMap[u+1].line!==this._styleMap[u].line},missingNewlineOffset:function(u,h){return this.splitByGrapheme&&!h?this.isEndOfWrapping(u)?1:0:1},_splitTextIntoLines:function(u){for(var h=s.Text.prototype._splitTextIntoLines.call(this,u),r=this._wrapText(h.lines,this.width),a=new Array(r.length),i=0;i<r.length;i++)a[i]=r[i].join("");return h.lines=a,h.graphemeLines=r,h},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var u={};for(var h in this._styleMap)this._textLines[h]&&(u[this._styleMap[h].line]=1);for(var h in this.styles)u[h]||delete this.styles[h]},toObject:function(u){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(u))}}),s.Textbox.fromObject=function(u,h){var r=s.util.stylesFromArray(u.styles,u.text),a=Object.assign({},u,{styles:r});return delete a.path,s.Object._fromObject("Textbox",a,function(i){u.path?s.Object._fromObject("Path",u.path,function(o){i.set("path",o),h(i)},"path"):h(i)},"text")}}(t),function(){var d=e.controlsUtils,s=d.scaleSkewCursorStyleHandler,u=d.scaleCursorStyleHandler,h=d.scalingEqually,r=d.scalingYOrSkewingX,a=d.scalingXOrSkewingY,i=d.scaleOrSkewActionName,o=e.Object.prototype.controls;if(o.ml=new e.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:a,getActionName:i}),o.mr=new e.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:a,getActionName:i}),o.mb=new e.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),o.mt=new e.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:r,getActionName:i}),o.tl=new e.Control({x:-.5,y:-.5,cursorStyleHandler:u,actionHandler:h}),o.tr=new e.Control({x:.5,y:-.5,cursorStyleHandler:u,actionHandler:h}),o.bl=new e.Control({x:-.5,y:.5,cursorStyleHandler:u,actionHandler:h}),o.br=new e.Control({x:.5,y:.5,cursorStyleHandler:u,actionHandler:h}),o.mtr=new e.Control({x:0,y:-.5,actionHandler:d.rotationWithSnapping,cursorStyleHandler:d.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),e.Textbox){var f=e.Textbox.prototype.controls={};f.mtr=o.mtr,f.tr=o.tr,f.br=o.br,f.tl=o.tl,f.bl=o.bl,f.mt=o.mt,f.mb=o.mb,f.mr=new e.Control({x:.5,y:0,actionHandler:d.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),f.ml=new e.Control({x:-.5,y:0,actionHandler:d.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()})(Ae);const lc=t=>{let e;const n=new Set,c=(h,r)=>{const a=typeof h=="function"?h(e):h;if(!Object.is(a,e)){const i=e;e=r??(typeof a!="object"||a===null)?a:Object.assign({},e,a),n.forEach(o=>o(e,i))}},p=()=>e,s={setState:c,getState:p,getInitialState:()=>u,subscribe:h=>(n.add(h),()=>n.delete(h)),destroy:()=>{n.clear()}},u=e=t(c,p,s);return s},$g=t=>t?lc(t):lc;var Fh={exports:{}},Rh={},zh={exports:{}},Bh={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ei=fe;function Kg(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var qg=typeof Object.is=="function"?Object.is:Kg,Qg=ei.useState,Jg=ei.useEffect,Zg=ei.useLayoutEffect,em=ei.useDebugValue;function tm(t,e){var n=e(),c=Qg({inst:{value:n,getSnapshot:e}}),p=c[0].inst,y=c[1];return Zg(function(){p.value=n,p.getSnapshot=e,Js(p)&&y({inst:p})},[t,n,e]),Jg(function(){return Js(p)&&y({inst:p}),t(function(){Js(p)&&y({inst:p})})},[t]),em(n),n}function Js(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!qg(t,n)}catch{return!0}}function nm(t,e){return e()}var im=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?nm:tm;Bh.useSyncExternalStore=ei.useSyncExternalStore!==void 0?ei.useSyncExternalStore:im;zh.exports=Bh;var rm=zh.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ws=fe,sm=rm;function am(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var om=typeof Object.is=="function"?Object.is:am,lm=sm.useSyncExternalStore,cm=ws.useRef,um=ws.useEffect,hm=ws.useMemo,dm=ws.useDebugValue;Rh.useSyncExternalStoreWithSelector=function(t,e,n,c,p){var y=cm(null);if(y.current===null){var w={hasValue:!1,value:null};y.current=w}else w=y.current;y=hm(function(){function s(i){if(!u){if(u=!0,h=i,i=c(i),p!==void 0&&w.hasValue){var o=w.value;if(p(o,i))return r=o}return r=i}if(o=r,om(h,i))return o;var f=c(i);return p!==void 0&&p(o,f)?(h=i,o):(h=i,r=f)}var u=!1,h,r,a=n===void 0?null:n;return[function(){return s(e())},a===null?void 0:function(){return s(a())}]},[e,n,c,p]);var d=lm(t,y[0],y[1]);return um(function(){w.hasValue=!0,w.value=d},[d]),dm(d),d};Fh.exports=Rh;var fm=Fh.exports;const gm=pc(fm),{useDebugValue:mm}=Pc,{useSyncExternalStoreWithSelector:pm}=gm;const vm=t=>t;function ym(t,e=vm,n){const c=pm(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return mm(c),c}const cc=t=>{const e=typeof t=="function"?$g(t):t,n=(c,p)=>ym(e,c,p);return Object.assign(n,e),n},Ss=t=>t?cc(t):cc,ki=Ss((t,e)=>({canvas:null,tool:"select",brushSize:5,brushColor:"#000000",isDrawing:!1,history:[],historyIndex:-1,zoom:1,panX:0,panY:0,setCanvas:n=>t({canvas:n}),setTool:n=>{const c=e(),p=c.canvas,y=c.brushSize,w=c.brushColor;if(p){switch(n){case"select":p.isDrawingMode=!1,p.selection=!0,p.getContext().globalCompositeOperation="source-over";break;case"brush":p.isDrawingMode=!0,p.selection=!1,p.freeDrawingBrush=new Ae.fabric.PencilBrush(p),p.freeDrawingBrush.width=y,p.freeDrawingBrush.color=w,p.getContext().globalCompositeOperation="source-over";break;case"eraser":p.isDrawingMode=!0,p.selection=!1,p.freeDrawingBrush=new Ae.fabric.PencilBrush(p),p.freeDrawingBrush.width=y(p.getContext()).globalCompositeOperation="destination-out",p.freeDrawingBrush.color="rgba(0,0,0,1)";break;default:p.isDrawingMode=!1,p.selection=!0}t({tool:n})}},setBrushSize:n=>{const{canvas:c,tool:p}=e();c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=n,p==="eraser"?c.getContext().globalCompositeOperation="destination-out":c.getContext().globalCompositeOperation="source-over"),t({brushSize:n})},setBrushColor:n=>{const{canvas:c,tool:p}=e();c&&c.freeDrawingBrush&&p!=="eraser"&&(c.freeDrawingBrush.color=n),t({brushColor:n})},setIsDrawing:n=>t({isDrawing:n}),addToHistory:n=>{const{history:c,historyIndex:p}=e(),y={id:Date.now().toString(),timestamp:Date.now(),data:n},s=[...c.slice(0,p+1),y].slice(-50);t({history:s,historyIndex:s.length-1})},undo:()=>{const{canvas:n,history:c,historyIndex:p}=e();if(!n||p<=0)return;const y=c[p-1];n._skipHistory=!0,n.loadFromJSON(y.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:p-1})},redo:()=>{const{canvas:n,history:c,historyIndex:p}=e();if(!n||p>=c.length-1)return;const y=c[p+1];n._skipHistory=!0,n.loadFromJSON(y.data,()=>{n.renderAll(),setTimeout(()=>{delete n._skipHistory},100)}),t({historyIndex:p+1})},canUndo:()=>{const{historyIndex:n}=e();return n>0},canRedo:()=>{const{history:n,historyIndex:c}=e();return c<n.length-1},clearCanvas:()=>{const{canvas:n}=e();if(n){n.clear(),n.backgroundColor="#ffffff",n.renderAll();const c=JSON.stringify(n.toJSON());e().addToHistory(c)}},exportCanvas:n=>{const{canvas:c}=e();if(!c)return null;switch(n){case"png":return c.toDataURL({format:"png",quality:1,multiplier:2});case"jpg":return c.toDataURL({format:"jpeg",quality:.9,multiplier:2});case"pdf":return console.warn("PDF export not yet implemented"),null;default:return null}},importImage:async(n,c)=>{const{canvas:p}=e();if(p){if(console.log(" Importing image to canvas:",typeof n=="string"?n.substring(0,50)+"...":n),typeof n!="string")throw console.error(" Invalid imageUrl type:",typeof n,n),new Error(`Invalid imageUrl: expected string, got ${typeof n}`);if(!n||n.length===0)throw console.error(" Empty imageUrl provided"),new Error("Empty imageUrl provided");return new Promise((y,w)=>{try{Ae.fabric.Image.fromURL(n,d=>{try{if(d&&d.width&&d.height){console.log(" Image loaded successfully:",d.width,"x",d.height);const s=d.width||1,u=d.height||1,h=Math.max(s,u);console.log(" Original AI image size:",s,"x",u);const r=600;let a=1;if(h>r?(a=r/h,console.log(" Scaling down large AI image:",a)):console.log(" Using original AI image size (good quality)"),d.scale(a),console.log(" Final AI image display size:",(s*a).toFixed(0),"x",(u*a).toFixed(0)),(c==null?void 0:c.x)!==void 0&&(c==null?void 0:c.y)!==void 0)d.set({left:c.x,top:c.y}),console.log(" Positioned image at:",c.x,c.y);else{const o=p.viewportTransform,f=p.getElement();console.log(" AI IMAGE POSITIONING - TIMESTAMP:",new Date().toISOString());const l=["div",'[class*="panel"]','[class*="sidebar"]','[class*="assistant"]',".ai-assistant-panel",".right-panel","[data-panel]","aside","section",'[style*="position: fixed"]','[style*="position: absolute"]'];let g=null,m=0;for(const Z of l){const te=document.querySelectorAll(Z);for(const K of te){const ne=K.getBoundingClientRect(),le=ne.width>250&&ne.width<window.innerWidth*.6,Y=ne.right>=window.innerWidth-100,_=ne.width<window.innerWidth-100,O=ne.height>300;if(le&&Y&&_&&O){g=K,m=ne.width,console.log(" AI - Found right panel:",Z,"class:",K.className,"width:",m);break}}if(g)break}g||console.log(" AI - No right panel detected, using full viewport");const v=window.innerWidth-m,x=window.innerHeight,S=v/2,b=x/2,T=o[0],E=o[3],N=o[4],L=o[5],G=(S-N)/T,Q=(b-L)/E;console.log(" AI CALCULATION RESULT:",G.toFixed(0),Q.toFixed(0)),console.log(" AI Transform values: scale=",T.toFixed(2),E.toFixed(2),"translate=",N.toFixed(0),L.toFixed(0)),console.log(" AI VIEWPORT vs CANVAS SIZE:"),console.log("   - Window size:",window.innerWidth,"x",window.innerHeight,"(full window)"),console.log("   - Right panel width:",m,"(detected panel)"),console.log("   - Available viewport size:",v,"x",x,"(available canvas area)"),console.log("   - Viewport center:",S,b),d.set({left:G,top:Q,originX:"center",originY:"center"}),console.log(" AI Image positioned at viewport center:",{finalPosition:{x:G.toFixed(0),y:Q.toFixed(0)},vpt:p.viewportTransform,canvasSize:{width:f.width,height:f.height},zoom:p.getZoom()})}try{n.startsWith("data:image/")&&(d.set("isAIGenerated",!0),d.set("imageId",`ai_generated_${Date.now()}`))}catch(o){console.warn("Failed to set metadata:",o)}p.add(d),p.renderAll(),console.log(" Image added to canvas and rendered");const i=JSON.stringify(p.toJSON());e().addToHistory(i),y()}else console.error(" Failed to load image - img object is null or has no dimensions"),w(new Error("Failed to load image - invalid image data"))}catch(s){console.error(" Error in image load callback:",s),w(s)}},{crossOrigin:"anonymous"})}catch(d){console.error(" Error calling fabric.Image.fromURL:",d),w(d)}})}},updateBrushSettings:n=>{const{canvas:c,brushSize:p,brushColor:y}=e(),w=n.size??p,d=n.color??y;c&&c.freeDrawingBrush&&(c.freeDrawingBrush.width=w,c.freeDrawingBrush.color=d,n.opacity),t({brushSize:w,brushColor:d})},setZoom:n=>{const{canvas:c}=e();if(c){const p=c.getCenter();c.zoomToPoint(new Ae.fabric.Point(p.left,p.top),n),c.renderAll()}t({zoom:n})},setPan:(n,c)=>{const{canvas:p}=e();p&&(p.absolutePan(new Ae.fabric.Point(n,c)),p.renderAll()),t({panX:n,panY:c})},zoomIn:()=>{const{zoom:n,setZoom:c}=e(),p=Math.min(n*1.2,5);c(p)},zoomOut:()=>{const{zoom:n,setZoom:c}=e(),p=Math.max(n/1.2,.1);c(p)},resetView:()=>{const{canvas:n,setZoom:c,setPan:p}=e();n&&(c(1),p(0,0),n.setViewportTransform([1,0,0,1,0,0]),n.renderAll())},getSelectedImages:()=>{const{canvas:n}=e();if(console.log(" Canvas selection check:",{hasCanvas:!!n}),!n)return[];const c=n.getActiveObjects();console.log(" Active objects:",{count:c.length,objects:c});const p=[];return c.forEach((y,w)=>{var d,s,u,h,r,a;console.log(` Object ${w}:`,{type:y.type,hasElement:!!y._element,hasSrc:!!((d=y._element)!=null&&d.src),src:typeof((s=y._element)==null?void 0:s.src)=="string"?((h=(u=y._element)==null?void 0:u.src)==null?void 0:h.substring(0,50))+"...":(r=y._element)==null?void 0:r.src}),y.type==="image"&&((a=y._element)!=null&&a.src)&&p.push(y._element.src)}),console.log(" Selected image URLs:",{count:p.length}),p}})),Vo=Ss((t,e)=>({images:[],selectedImages:[],isMultiSelectMode:!1,canvas:null,setCanvas:n=>t({canvas:n}),addImages:async(n,c={autoArrange:!1,spacing:20})=>{const{canvas:p,images:y}=e();if(!p)return;const w=[],d=Array.from(n);for(let s=0;s<d.length;s++){const u=d[s];if(u.type.startsWith("image/"))try{const h=await new Promise(B=>{const P=new FileReader;P.onload=k=>{var D;return B((D=k.target)==null?void 0:D.result)},P.readAsDataURL(u)}),r=await new Promise((B,P)=>{Ae.fabric.Image.fromURL(h,k=>{k?(k.set({selectable:!0,hasControls:!0,hasBorders:!0,cornerColor:"#2563eb",cornerStyle:"circle",borderColor:"#2563eb"}),B(k)):P(new Error("Failed to load image"))})}),a=r.width||1,i=r.height||1,o=Math.max(a,i);console.log(" Original image size:",a,"x",i);const f=600;let l=1;o>f?(l=f/o,console.log(" Scaling down large image:",l)):console.log(" Using original size (good quality)"),r.scale(l),console.log(" Final display size:",(a*l).toFixed(0),"x",(i*l).toFixed(0));const g=a*l,m=i*l,v=c.spacing||100,x=p.getZoom(),S=p.viewportTransform,b=p.getElement();console.log(" EXECUTING MANUAL MATRIX CALCULATION - TIMESTAMP:",new Date().toISOString());const T=document.querySelectorAll("*"),E=[];for(const B of T){const P=B.getBoundingClientRect();P.width>250&&P.right>=window.innerWidth-100&&P.height>300&&E.push({tag:B.tagName,className:B.className,id:B.id,width:P.width,height:P.height,right:P.right,left:P.left})}console.log(" All potential right-side panels found:",E);const N=["div",'[class*="panel"]','[class*="sidebar"]','[class*="assistant"]',".ai-assistant-panel",".right-panel","[data-panel]","aside","section",'[style*="position: fixed"]','[style*="position: absolute"]'];let L=null,G=0;for(const B of N){const P=document.querySelectorAll(B);for(const k of P){const D=k.getBoundingClientRect(),F=D.width>250&&D.width<window.innerWidth*.6,X=D.right>=window.innerWidth-100,W=D.width<window.innerWidth-100,$=D.height>300;if(F&&X&&W&&$){L=k,G=D.width,console.log(" Found right panel:",B,"class:",k.className,"width:",G,"rect:",D);break}}if(L)break}L||(console.log(" No right panel detected, using full viewport"),console.log("   - Window dimensions:",window.innerWidth,"x",window.innerHeight),console.log("   - Checked",E.length,"potential elements"));const Q=window.innerWidth-G,Z=window.innerHeight,te=Q/2,K=Z/2,ne=S[0],le=S[3],Y=S[4],_=S[5],O=(te-Y)/ne,A=(K-_)/le;if(console.log(" MANUAL CALCULATION RESULT:",O.toFixed(0),A.toFixed(0)),console.log(" Transform values: scale=",ne.toFixed(2),le.toFixed(2),"translate=",Y.toFixed(0),_.toFixed(0)),console.log(" VIEWPORT vs CANVAS SIZE:"),console.log("   - Window size:",window.innerWidth,"x",window.innerHeight,"(full window)"),console.log("   - Right panel width:",G,"(detected panel)"),console.log("   - Available viewport size:",Q,"x",Z,"(available canvas area)"),console.log("   - Canvas element size:",b.width,"x",b.height,"(canvas element)"),console.log("   - Viewport center:",te,K),console.log(" USING FABRIC.JS BUILT-IN TRANSFORMATION - SHOULD BE CORRECT NOW!"),console.log(" Using Method 2 (direct calculation) for positioning"),console.log(" Transform matrix details:"),console.log("   - Canvas size:",b.width,"x",b.height),console.log("   - Screen center:",b.width/2,b.height/2),console.log("   - Transform scale:",S[0],S[3]),console.log("   - Transform translate:",S[4],S[5]),console.log(" DETAILED Viewport center calculation:",{zoom:x,canvasSize:{width:b.width,height:b.height},vpt:{full:S,scaleX:S[0],scaleY:S[3],translateX:S[4],translateY:S[5]},screenCenter:{x:b.width/2,y:b.height/2},invertedTransform:Ae.fabric.util.invertTransform(S),finalCalculatedCenter:{x:O.toFixed(0),y:A.toFixed(0)},fileArrayLength:d.length,autoArrangeEnabled:c.autoArrange,willUseGridLayout:c.autoArrange&&d.length>1}),c.autoArrange&&d.length>1){const B=Math.ceil(Math.sqrt(d.length)),P=Math.floor(s/B),k=s%B,D=B*(g+v)-v,F=Math.ceil(d.length/B)*(m+v)-v,X=O-D/2,W=A-F/2,$=X+k*(g+v),q=W+P*(m+v);r.set({left:$+g/2,top:q+m/2,originX:"center",originY:"center"}),console.log(` Positioned image ${s+1} at viewport-centered grid:`,$.toFixed(0),q.toFixed(0))}else r.set({left:O,top:A,originX:"center",originY:"center"}),console.log(" Centered image at viewport center:",O.toFixed(0),A.toFixed(0)),console.log(" Raw viewport transform values:",{vpt_array:S,scaleX:S[0],skewY:S[1],skewX:S[2],scaleY:S[3],translateX:S[4],translateY:S[5]}),console.log(" Canvas element size:",{width:b.width,height:b.height}),console.log(" Center point calculation:",{x:b.width/2,y:b.height/2});p.add(r);const M={id:`img_${Date.now()}_${s}`,name:u.name,url:h,fabricObject:r,width:r.width||0,height:r.height||0,selected:!1,position:{x:r.left||0,y:r.top||0},scale:l,thumbnail:h};w.push(M)}catch(h){console.error(`Failed to load image ${u.name}:`,h)}}p.renderAll(),t({images:[...y,...w]}),p&&w.length>0&&console.log("Added",w.length,"images to canvas")},removeImage:n=>{const{canvas:c,images:p,selectedImages:y}=e();if(!c)return;const w=p.find(d=>d.id===n);w&&w.fabricObject&&(c.remove(w.fabricObject),c.renderAll()),t({images:p.filter(d=>d.id!==n),selectedImages:y.filter(d=>d!==n)})},selectImage:(n,c=!1)=>{const{selectedImages:p,isMultiSelectMode:y}=e();if(c||y){const s=p.includes(n)?p.filter(u=>u!==n):[...p,n];t({selectedImages:s})}else t({selectedImages:[n]});const{images:w,canvas:d}=e();if(d){const s=e().selectedImages;w.forEach(u=>{if(u.fabricObject){const h=s.includes(u.id);u.fabricObject.set({borderColor:h?"#ef4444":"#2563eb",cornerColor:h?"#ef4444":"#2563eb"})}}),d.renderAll()}},selectAllImages:()=>{const{images:n}=e();t({selectedImages:n.map(p=>p.id)});const{canvas:c}=e();c&&(n.forEach(p=>{p.fabricObject&&p.fabricObject.set({borderColor:"#ef4444",cornerColor:"#ef4444"})}),c.renderAll())},clearSelection:()=>{t({selectedImages:[]});const{images:n,canvas:c}=e();c&&(n.forEach(p=>{p.fabricObject&&p.fabricObject.set({borderColor:"#2563eb",cornerColor:"#2563eb"})}),c.renderAll())},deleteSelectedImages:()=>{const{selectedImages:n}=e();n.forEach(c=>{e().removeImage(c)}),t({selectedImages:[]})},toggleMultiSelectMode:()=>{const{isMultiSelectMode:n}=e();t({isMultiSelectMode:!n}),n||e().clearSelection()},arrangeImages:n=>{const{images:c,canvas:p}=e();if(!p||c.length===0)return;const y=p.width||800,w=p.height||600,d=20,s=y-d*2,u=w-d*2;c.forEach((h,r)=>{if(!h.fabricObject)return;let a=d,i=d;switch(n){case"grid":const o=Math.ceil(Math.sqrt(c.length)),f=s/o,l=u/Math.ceil(c.length/o);a=d+r%o*f+f/2,i=d+Math.floor(r/o)*l+l/2;break;case"horizontal":const g=s/c.length;a=d+r*g+g/2,i=w/2;break;case"vertical":const m=u/c.length;a=y/2,i=d+r*m+m/2;break}h.fabricObject.set({left:a,top:i}),h.position={x:a,y:i}}),p.renderAll()},getSelectedImages:()=>{const{images:n,selectedImages:c}=e();return n.filter(p=>c.includes(p.id))},getSelectionBounds:()=>{const n=e().getSelectedImages();if(n.length===0)return null;const c=n.map(y=>y.fabricObject).filter(y=>y!==null);if(c.length===0)return null;const p={left:Math.min(...c.map(y=>y.left||0)),top:Math.min(...c.map(y=>y.top||0)),right:Math.max(...c.map(y=>(y.left||0)+(y.width||0)*(y.scaleX||1))),bottom:Math.max(...c.map(y=>(y.top||0)+(y.height||0)*(y.scaleY||1)))};return{images:n,bounds:{left:p.left,top:p.top,width:p.right-p.left,height:p.bottom-p.top}}}}));function Vn(t){const e=t.split(",")[1]||t;return Math.floor(e.length*.75)}async function Pt(t,e={}){const{maxWidth:n=1024,maxHeight:c=1024,quality:p=.8,maxSizeKB:y=3500,format:w="jpeg"}=e,d=Vn(t);return new Promise((s,u)=>{const h=new Image;h.onload=async()=>{try{const r=document.createElement("canvas"),a=r.getContext("2d");let{width:i,height:o}=xm(h.width,h.height,n,c);r.width=i,r.height=o,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(h,0,0,i,o);let f=p,l,g;do l=r.toDataURL(`image/${w}`,f),g=Vn(l),console.log(` Compression attempt: ${Math.round(g/1024)}KB at quality ${f}`),g>y*1024&&(f>.3?f-=.1:(i=Math.floor(i*.8),o=Math.floor(o*.8),r.width=i,r.height=o,a.clearRect(0,0,i,o),a.drawImage(h,0,0,i,o),f=.7));while(g>y*1024&&(f>.2||i>200));const m=d/g;console.log(` Image compressed: ${Math.round(d/1024)}KB  ${Math.round(g/1024)}KB (${Math.round(m*100)/100}x reduction)`),s({dataURL:l,originalSize:d,compressedSize:g,compressionRatio:m})}catch(r){u(r)}},h.onerror=()=>u(new Error("Failed to load image for compression")),h.src=t})}function xm(t,e,n,c){let p=t,y=e;return p>n&&(y=y*n/p,p=n),y>c&&(p=p*c/y,y=c),{width:Math.floor(p),height:Math.floor(y)}}async function vr(t,e={}){const n=[];for(const c of t)try{const p=await Pt(c,e);n.push(p)}catch(p){console.error("Failed to compress image:",p);const y=Vn(c);n.push({dataURL:c,originalSize:y,compressedSize:y,compressionRatio:1})}return n}function wm(t,e){let n;try{n=t()}catch{return}return{getItem:p=>{var y;const w=s=>s===null?null:JSON.parse(s,e==null?void 0:e.reviver),d=(y=n.getItem(p))!=null?y:null;return d instanceof Promise?d.then(w):w(d)},setItem:(p,y)=>n.setItem(p,JSON.stringify(y,e==null?void 0:e.replacer)),removeItem:p=>n.removeItem(p)}}const Hi=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(c){return Hi(c)(n)},catch(c){return this}}}catch(n){return{then(c){return this},catch(c){return Hi(c)(n)}}}},Sm=(t,e)=>(n,c,p)=>{let y={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:l=>l,version:0,merge:(l,g)=>({...g,...l}),...e},w=!1;const d=new Set,s=new Set;let u;try{u=y.getStorage()}catch{}if(!u)return t((...l)=>{console.warn(`[zustand persist middleware] Unable to update item '${y.name}', the given storage is currently unavailable.`),n(...l)},c,p);const h=Hi(y.serialize),r=()=>{const l=y.partialize({...c()});let g;const m=h({state:l,version:y.version}).then(v=>u.setItem(y.name,v)).catch(v=>{g=v});if(g)throw g;return m},a=p.setState;p.setState=(l,g)=>{a(l,g),r()};const i=t((...l)=>{n(...l),r()},c,p);let o;const f=()=>{var l;if(!u)return;w=!1,d.forEach(m=>m(c()));const g=((l=y.onRehydrateStorage)==null?void 0:l.call(y,c()))||void 0;return Hi(u.getItem.bind(u))(y.name).then(m=>{if(m)return y.deserialize(m)}).then(m=>{if(m)if(typeof m.version=="number"&&m.version!==y.version){if(y.migrate)return y.migrate(m.state,m.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return m.state}).then(m=>{var v;return o=y.merge(m,(v=c())!=null?v:i),n(o,!0),r()}).then(()=>{g==null||g(o,void 0),w=!0,s.forEach(m=>m(o))}).catch(m=>{g==null||g(void 0,m)})};return p.persist={setOptions:l=>{y={...y,...l},l.getStorage&&(u=l.getStorage())},clearStorage:()=>{u==null||u.removeItem(y.name)},getOptions:()=>y,rehydrate:()=>f(),hasHydrated:()=>w,onHydrate:l=>(d.add(l),()=>{d.delete(l)}),onFinishHydration:l=>(s.add(l),()=>{s.delete(l)})},f(),o||i},Cm=(t,e)=>(n,c,p)=>{let y={storage:wm(()=>localStorage),partialize:f=>f,version:0,merge:(f,l)=>({...l,...f}),...e},w=!1;const d=new Set,s=new Set;let u=y.storage;if(!u)return t((...f)=>{console.warn(`[zustand persist middleware] Unable to update item '${y.name}', the given storage is currently unavailable.`),n(...f)},c,p);const h=()=>{const f=y.partialize({...c()});return u.setItem(y.name,{state:f,version:y.version})},r=p.setState;p.setState=(f,l)=>{r(f,l),h()};const a=t((...f)=>{n(...f),h()},c,p);p.getInitialState=()=>a;let i;const o=()=>{var f,l;if(!u)return;w=!1,d.forEach(m=>{var v;return m((v=c())!=null?v:a)});const g=((l=y.onRehydrateStorage)==null?void 0:l.call(y,(f=c())!=null?f:a))||void 0;return Hi(u.getItem.bind(u))(y.name).then(m=>{if(m)if(typeof m.version=="number"&&m.version!==y.version){if(y.migrate)return[!0,y.migrate(m.state,m.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,m.state];return[!1,void 0]}).then(m=>{var v;const[x,S]=m;if(i=y.merge(S,(v=c())!=null?v:a),n(i,!0),x)return h()}).then(()=>{g==null||g(i,void 0),i=c(),w=!0,s.forEach(m=>m(i))}).catch(m=>{g==null||g(void 0,m)})};return p.persist={setOptions:f=>{y={...y,...f},f.storage&&(u=f.storage)},clearStorage:()=>{u==null||u.removeItem(y.name)},getOptions:()=>y,rehydrate:()=>o(),hasHydrated:()=>w,onHydrate:f=>(d.add(f),()=>{d.delete(f)}),onFinishHydration:f=>(s.add(f),()=>{s.delete(f)})},y.skipHydration||o(),i||a},bm=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?Sm(t,e):Cm(t,e),Uh=bm,_m=t=>!t||t.length<=8?"":`${t.slice(0,4)}${t.slice(-4)}`,uc=t=>t.trim().replace(/[\x00-\x1F\x7F]/g,""),hc=(t,e)=>{if(!/^[a-zA-Z0-9\-_]+$/.test(e))return!1;switch(t){case"gemini":return/^AIza[a-zA-Z0-9\-_]{35}$/.test(e);default:return!1}},Tm=async t=>{try{const n=new TextEncoder().encode(t),c=window.location.origin.repeat(Math.ceil(t.length/window.location.origin.length)),p=Array.from(n).map((y,w)=>y^c.charCodeAt(w%c.length));return btoa(String.fromCharCode(...p))}catch{return btoa(t)}},km=async t=>{try{const e=atob(t),n=Array.from(e).map(w=>w.charCodeAt(0)),c=window.location.origin.repeat(Math.ceil(n.length/window.location.origin.length)),p=n.map((w,d)=>w^c.charCodeAt(d%c.length));return new TextDecoder().decode(new Uint8Array(p))}catch{try{return atob(t)}catch{return""}}},Xo=Ss()(Uh((t,e)=>({apiKeys:{},isConfigured:!1,setAPIKey:(n,c)=>{const p=uc(c);if(!hc(n,p)){console.error(`Invalid API key format for ${n}`);return}t(y=>({apiKeys:{...y.apiKeys,[n]:p},isConfigured:!0}))},removeAPIKey:n=>{t(c=>{const p={...c.apiKeys};return delete p[n],{apiKeys:p,isConfigured:Object.keys(p).length>0}})},clearAllKeys:()=>{t({apiKeys:{},isConfigured:!1}),localStorage.removeItem("api-keys-storage")},validateAPIKey:async(n,c)=>{const p=uc(c);return!!hc(n,p)},getObfuscatedKey:n=>{const c=e().apiKeys[n];return c?_m(c):void 0}}),{name:"api-keys-storage",storage:{getItem:async t=>{const e=localStorage.getItem(t);if(!e)return null;try{const n=JSON.parse(e),c=await km(n.state);return{state:JSON.parse(c)}}catch(n){return console.error("Failed to decrypt API keys:",n),localStorage.removeItem(t),null}},setItem:async(t,e)=>{try{const n=await Tm(JSON.stringify(e.state));localStorage.setItem(t,JSON.stringify({state:n,version:"1.0",timestamp:Date.now()}))}catch(n){console.error("Failed to encrypt API keys:",n)}},removeItem:t=>{localStorage.removeItem(t)}}}));class Pm{constructor(){ft(this,"config");this.config={baseUrl:"https://omnicanvas-backend.vercel.app/api",endpoints:{generateImage:"/ai/generate-image",mergeImages:"/ai/merge-images",transferStyle:"/ai/transfer-style",generateSimilar:"/ai/generate-similar",elevenlabs:"/ai/elevenlabs",generateComic:"/ai/generate-comic",editWithWords:"/ai/edit-with-words",blendProduct:"/ai/blend-product",generateVideo:"/ai/generate-video",generateText:"/ai/generate-text",nanoBananaPhotoToVideo:"/ai/nano-banana-photo-to-video",nanoBananaImageFusion:"/ai/nano-banana-image-fusion"}}}configure(e){e&&(this.config.baseUrl=e)}getGeminiAPIKey(){const e=Xo.getState().apiKeys.gemini;if(!e)throw new Error("Please configure your Gemini API key in Settings to use AI features");return e}getRequestHeaders(){return{"Content-Type":"application/json","X-API-Key":this.getGeminiAPIKey()}}async generateImage(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({prompt:e.prompt,width:e.width||512,height:e.height||512,provider:"gemini"})});if(!n.ok){const p=await n.text();throw new Error(`Backend API error: ${n.status} - ${p}`)}const c=await n.json();return{url:c.imageUrl||c.url,width:c.width||e.width||512,height:c.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",...c.metadata}}}catch(n){throw console.error("Image generation error:",n),n}}async imageToImage(e){try{console.log(" Frontend AI Image-to-Image called!"),console.log(" Request details:",{prompt:typeof e.prompt=="string"?e.prompt.substring(0,100)+"...":e.prompt,imageUrl:typeof e.imageUrl=="string"?e.imageUrl.substring(0,50)+"...":e.imageUrl,width:e.width,height:e.height,strength:e.strength});let n=e.imageUrl;if(e.imageUrl.startsWith("data:")){console.log(" Compressing reference image for image-to-image...");const w=Vn(e.imageUrl);console.log(` Original image size: ${Math.round(w/1024)}KB`);const d=await Pt(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3});n=d.dataURL,console.log(` Compressed image size: ${Math.round(d.compressedSize/1024)}KB`)}const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateImage}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({prompt:e.prompt,imageUrl:n,width:e.width||512,height:e.height||512,strength:e.strength||.7,provider:"gemini",mode:"image-to-image"})});if(!c.ok){const w=await c.text();throw new Error(`Backend API error: ${c.status} - ${w}`)}const p=await c.json();console.log(" Backend response received:",{hasImageUrl:!!p.imageUrl,hasUrl:!!p.url,imageUrlType:typeof p.imageUrl,urlType:typeof p.url,dataKeys:Object.keys(p)});let y=p.imageUrl||p.url;if(!y)throw console.error(" No imageUrl or url found in response:",p),new Error("Backend did not return a valid image URL");if(typeof y!="string")throw console.error(" imageUrl is not a string:",typeof y,y),new Error(`Invalid imageUrl type: expected string, got ${typeof y}`);if(y.length===0)throw console.error(" imageUrl is empty string"),new Error("Backend returned empty imageUrl");return console.log(" Successfully extracted imageUrl:",y.substring(0,50)+"..."),{url:y,width:p.width||e.width||512,height:p.height||e.height||512,prompt:e.prompt,provider:"gemini",metadata:{timestamp:Date.now(),model:"gemini-2.5-flash-image",mode:"image-to-image",referenceImage:e.imageUrl,strength:e.strength||.7,...p.metadata}}}catch(n){throw console.error("Image-to-image generation error:",n),n}}async mergeImages(e,n){try{console.log(" Backend AI Merge - Images:",e.length,"Prompt:",n);const c=e.filter(u=>u.startsWith("data:")),p=e.filter(u=>!u.startsWith("data:"));let y=[...p];if(c.length>0){console.log(" Compressing",c.length,"data URLs on client side...");const h=c.map(o=>Vn(o)).reduce((o,f)=>o+f,0);console.log(` Original total size: ${Math.round(h/1024)}KB`);const r=await vr(c,{maxWidth:800,maxHeight:800,quality:.6,format:"jpeg",maxSizeKB:1500}),a=r.map(o=>o.dataURL),i=r.reduce((o,f)=>o+f.compressedSize,0);console.log(` Compressed total size: ${Math.round(i/1024)}KB (${Math.round(h/i*100)/100}x reduction)`),y=[...p,...a]}const w=await fetch(`${this.config.baseUrl}${this.config.endpoints.mergeImages}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrls:y,prompt:n,provider:"gemini"})});if(!w.ok){const u=await w.text();throw console.error("Backend merge error:",u),new Error(`Backend merge error: ${w.status}`)}const d=await w.json();console.log(" Backend merge successful:",d),console.log(" Merge response received:",{hasImageUrl:!!d.imageUrl,hasUrl:!!d.url,imageUrlType:typeof d.imageUrl,urlType:typeof d.url,dataKeys:Object.keys(d)});let s=d.imageUrl||d.url;if(!s)throw console.error(" No imageUrl or url found in merge response:",d),new Error("Backend merge did not return a valid image URL");if(typeof s!="string")throw console.error(" Merge imageUrl is not a string:",typeof s,s),new Error(`Invalid merge imageUrl type: expected string, got ${typeof s}`);if(s.length===0)throw console.error(" Merge imageUrl is empty string"),new Error("Backend merge returned empty imageUrl");return console.log(" Successfully extracted merge imageUrl:",s.substring(0,50)+"..."),s}catch(c){throw console.error("Backend merge failed:",c),c}}async transferStyle(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.transferStyle}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrl:e.imageUrl,style:e.style,provider:"gemini"})});if(!n.ok){const p=await n.text();throw new Error(`Style transfer error: ${n.status} - ${p}`)}const c=await n.json();return c.imageUrl||c.url}catch(n){throw console.error("Style transfer error:",n),n}}async generateSimilar(e){try{console.log(" Calling generateSimilar API with",e.images.length,"images");const n=e.images.filter(d=>d.startsWith("data:")),c=e.images.filter(d=>!d.startsWith("data:"));let p=[...c];if(n.length>0){console.log(" Compressing",n.length,"data URLs for generateSimilar...");const s=(await vr(n,{maxWidth:768,maxHeight:768,quality:.7,format:"jpeg",maxSizeKB:1800})).map(u=>u.dataURL);p=[...c,...s]}const y=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateSimilar}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrls:p,prompt:e.prompt,aspectRatio:e.aspectRatio||"1:1",provider:"gemini"})});if(!y.ok){const d=await y.text();throw console.error("Generate similar API error:",d),new Error(`Generate similar error: ${y.status} - ${d}`)}const w=await y.json();return console.log(" Generate similar API response:",w),w.imageUrl||w.url}catch(n){throw console.error("Generate similar error:",n),n}}async generateVoice(e,n){try{const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.elevenlabs}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({text:e,voiceId:n||"default",provider:"elevenlabs"})});if(!c.ok){const y=await c.text();throw new Error(`Voice generation error: ${c.status} - ${y}`)}const p=await c.json();return p.audioUrl||p.url}catch(c){throw console.error("Voice generation error:",c),c}}async generateComic(e){try{console.log(" Generating comic with StoryShop API");let n=e.characterImage,c=e.productImage;if(e.characterImage&&e.characterImage.startsWith("data:")){console.log(" Compressing character image for comic generation...");const w=await Pt(e.characterImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});n=w.dataURL,console.log(` Character image compressed: ${Math.round(w.compressedSize/1024)}KB`)}if(e.productImage&&e.productImage.startsWith("data:")){console.log(" Compressing product image for comic generation...");const w=await Pt(e.productImage,{maxWidth:512,maxHeight:512,quality:.7,format:"jpeg",maxSizeKB:1200});c=w.dataURL,console.log(` Product image compressed: ${Math.round(w.compressedSize/1024)}KB`)}const p=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateComic}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({storyPrompt:e.storyPrompt,characterImage:n,productImage:c,style:e.style,panelCount:e.panelCount||4,provider:"gemini"})});if(!p.ok){const w=await p.text();throw new Error(`Comic generation error: ${p.status} - ${w}`)}return(await p.json()).panelUrls||[]}catch(n){throw console.error("Comic generation error:",n),n}}async editWithWords(e){try{let n=e.imageUrl,c=e.maskUrl;e.imageUrl.startsWith("data:")&&(console.log(" Compressing image for editWithWords..."),n=(await Pt(e.imageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.maskUrl&&e.maskUrl.startsWith("data:")&&(console.log(" Compressing mask for editWithWords..."),c=(await Pt(e.maskUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"png",maxSizeKB:1e3})).dataURL);const p=await fetch(`${this.config.baseUrl}${this.config.endpoints.editWithWords}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrl:n,editPrompt:e.editPrompt,maskUrl:c,provider:"gemini"})});if(!p.ok){const w=await p.text();throw new Error(`Edit with words error: ${p.status} - ${w}`)}const y=await p.json();return y.imageUrl||y.url}catch(n){throw console.error("Edit with words error:",n),n}}async blendProduct(e){try{let n=e.sceneImageUrl,c=e.productImageUrl;e.sceneImageUrl.startsWith("data:")&&(console.log(" Compressing scene image for blendProduct..."),n=(await Pt(e.sceneImageUrl,{maxWidth:768,maxHeight:768,quality:.8,format:"jpeg",maxSizeKB:2e3})).dataURL),e.productImageUrl.startsWith("data:")&&(console.log(" Compressing product image for blendProduct..."),c=(await Pt(e.productImageUrl,{maxWidth:512,maxHeight:512,quality:.8,format:"jpeg",maxSizeKB:1500})).dataURL);const p=await fetch(`${this.config.baseUrl}${this.config.endpoints.blendProduct}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({sceneImageUrl:n,productImageUrl:c,blendPrompt:e.blendPrompt,provider:"gemini"})});if(!p.ok){const w=await p.text();throw new Error(`Product blend error: ${p.status} - ${w}`)}const y=await p.json();return y.imageUrl||y.url}catch(n){throw console.error("Product blend error:",n),n}}async generateVideoFromPanels(e){try{console.log(" Generating video from panels...");const n=e.panelUrls.filter(d=>d.startsWith("data:")),c=e.panelUrls.filter(d=>!d.startsWith("data:"));let p=[...c];if(n.length>0){console.log(" Compressing",n.length,"panel images for video generation...");const s=n.map(a=>Vn(a)).reduce((a,i)=>a+i,0);console.log(` Original panels total size: ${Math.round(s/1024)}KB`);const u=await vr(n,{maxWidth:720,maxHeight:720,quality:.75,format:"jpeg",maxSizeKB:1e3}),h=u.map(a=>a.dataURL),r=u.reduce((a,i)=>a+i.compressedSize,0);console.log(` Compressed panels total size: ${Math.round(r/1024)}KB (${Math.round(s/r*100)/100}x reduction)`),p=[...c,...h]}const y=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateVideo}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({panelUrls:p,narrationText:e.narrationText,voiceId:e.voiceId||"default",duration:e.duration||8,provider:"fal-ai"})});if(!y.ok){const d=await y.text();throw new Error(`Video generation error: ${y.status} - ${d}`)}const w=await y.json();return w.videoUrl||w.url}catch(n){throw console.error("Video generation error:",n),n}}async generateText(e){try{const n=await fetch(`${this.config.baseUrl}${this.config.endpoints.generateText}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({prompt:e.prompt,maxLength:e.maxLength||100})});if(!n.ok){const p=await n.text();throw new Error(`Text generation error: ${n.status} - ${p}`)}return(await n.json()).text}catch(n){throw console.error("Text generation error:",n),n}}async nanoBananaPhotoToVideo(e){try{console.log(" Nano Banana: Converting photo to 8-second video...");let n=e.imageUrl;if(e.imageUrl.startsWith("data:")){console.log(" Compressing image for Nano Banana video generation...");const y=await Pt(e.imageUrl,{maxWidth:720,maxHeight:720,quality:.8,format:"jpeg",maxSizeKB:2e3});n=y.dataURL,console.log(` Compressed for video: ${Math.round(y.compressedSize/1024)}KB`)}const c=await fetch(`${this.config.baseUrl}${this.config.endpoints.nanoBananaPhotoToVideo}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrl:n,prompt:e.prompt||"Create an 8-second animated video with natural movement and depth",duration:e.duration||8,quality:e.quality||"720p",provider:"gemini-nano-banana"})});if(!c.ok){const y=await c.text();throw new Error(`Nano Banana photo to video error: ${c.status} - ${y}`)}const p=await c.json();return console.log(" Nano Banana video generated successfully!"),p.videoUrl||p.url}catch(n){throw console.error("Nano Banana photo to video error:",n),n}}async nanoBananaImageFusion(e){try{console.log(" Nano Banana: Fusing",e.imageUrls.length,"images...");const n=e.imageUrls.filter(d=>d.startsWith("data:")),c=e.imageUrls.filter(d=>!d.startsWith("data:"));let p=[...c];if(n.length>0){console.log(" Compressing",n.length,"images for Nano Banana fusion...");const d=await vr(n,{maxWidth:512,maxHeight:512,quality:.8,format:"jpeg",maxSizeKB:1500}),s=d.map(h=>h.dataURL);p=[...c,...s];const u=d.reduce((h,r)=>h+r.compressedSize,0);console.log(` Compressed for fusion: ${Math.round(u/1024)}KB total`)}const y=await fetch(`${this.config.baseUrl}${this.config.endpoints.nanoBananaImageFusion}`,{method:"POST",headers:this.getRequestHeaders(),body:JSON.stringify({imageUrls:p,prompt:e.prompt||"Create a natural and seamless fusion blending all images harmoniously",style:e.style||"natural",maxImages:8,provider:"gemini-nano-banana"})});if(!y.ok){const d=await y.text();throw new Error(`Nano Banana image fusion error: ${y.status} - ${d}`)}const w=await y.json();return console.log(" Nano Banana image fusion completed successfully!"),w.imageUrl||w.url}catch(n){throw console.error("Nano Banana image fusion error:",n),n}}async testConnection(){try{return(await fetch(`${this.config.baseUrl}/health`,{method:"GET"})).ok}catch(e){return console.error("Backend connection test failed:",e),!1}}}const Xe=new Pm,Em=()=>{var t;try{const e=navigator.language||((t=navigator.languages)==null?void 0:t[0])||"en",n={zh:"zh-TW","zh-TW":"zh-TW","zh-CN":"zh-TW","zh-HK":"zh-TW",es:"es","es-ES":"es","es-MX":"es",ja:"ja","ja-JP":"ja",fr:"fr","fr-FR":"fr",en:"en","en-US":"en","en-GB":"en"};if(n[e])return console.log(" Language detected:",e,"",n[e]),n[e];const c=e.substring(0,2);return n[c]?(console.log(" Language detected (prefix):",c,"",n[c]),n[c]):(console.log(" Language defaulted to English for:",e),"en")}catch(e){return console.log(" Language detection failed, defaulting to English:",e),"en"}},Qi=Ss()(Uh((t,e)=>({currentLanguage:"en",isInitialized:!1,setLanguage:n=>t({currentLanguage:n}),initializeLanguage:()=>{if(!e().isInitialized){const c=Em();t({currentLanguage:c,isInitialized:!0})}}}),{name:"language-storage",partialize:t=>({currentLanguage:t.currentLanguage})})),Ji={en:{settings:{title:"API Configuration",apiConfiguration:"AI Service Configuration",importantNotice:{title:"Important: Use Your Own Gemini API Key",description:"OmniCanvas uses Google Gemini for AI image generation. Your API key is stored securely and processed through our backend for better security."},apiKeys:{title:"Gemini API Key Configuration",services:{gemini:{name:"Google Gemini",description:"For AI image generation and creative tools",placeholder:"AIza..."}},required:"Required",optional:"Optional",valid:"Valid",invalid:"Invalid",current:"Current",save:"Save",openSettings:"Open Settings",rateLimitExceeded:"Rate limit exceeded. Please wait a moment before trying again."},gettingStarted:{title:"Getting Started:",steps:["Visit Google AI Studio to get your free API key","Copy your Gemini API key from the dashboard","Paste it below and save your configuration","Start creating amazing AI-powered content!"],getApiKeyButton:"Get Free Gemini API Key"},security:{title:"Security & Privacy",benefits:["Your API key is encrypted and stored locally","All AI requests are processed securely through our backend","You maintain full control over your API usage and costs","No API keys are stored on our servers","Enhanced security compared to direct frontend API calls"]}}},"zh-TW":{settings:{title:"API ",apiConfiguration:"AI ",importantNotice:{title:" Gemini API ",description:"OmniCanvas  Google Gemini  AI  API "},apiKeys:{title:"Gemini API ",services:{gemini:{name:"Google Gemini",description:" AI ",placeholder:"AIza..."}},required:"",optional:"",valid:"",invalid:"",current:"",save:"",openSettings:"",rateLimitExceeded:""},gettingStarted:{title:"",steps:[" Google AI Studio  API "," Gemini API ",""," AI "],getApiKeyButton:" Gemini API "},security:{title:"",benefits:[" API "," AI "," API "," API "," API "]}}},es:{settings:{title:"Configuracin de API",apiConfiguration:"Configuracin de Servicios de IA",importantNotice:{title:"Importante: Use Su Propia Clave API de Gemini",description:"OmniCanvas utiliza Google Gemini para la generacin de imgenes con IA. Su clave API se almacena de forma segura y se procesa a travs de nuestro backend para mayor seguridad."},apiKeys:{title:"Configuracin de Clave API de Gemini",services:{gemini:{name:"Google Gemini",description:"Para generacin de imgenes con IA y herramientas creativas",placeholder:"AIza..."}},required:"Requerido",optional:"Opcional",valid:"Vlido",invalid:"Invlido",current:"Actual",save:"Guardar",openSettings:"Abrir Configuracin",rateLimitExceeded:"Lmite de velocidad excedido. Espere un momento antes de intentar nuevamente."},gettingStarted:{title:"Primeros pasos:",steps:["Visite Google AI Studio para obtener su clave API gratuita","Copie su clave API de Gemini desde el panel de control","Pguela abajo y guarde su configuracin","Comience a crear contenido increible con IA!"],getApiKeyButton:"Obtener Clave API de Gemini Gratis"},security:{title:"Seguridad y Privacidad",benefits:["Su clave API se cifra y almacena localmente","Todas las solicitudes de IA se procesan de forma segura a travs de nuestro backend","Mantiene control total sobre el uso y los costos de su API","No se almacenan claves API en nuestros servidores","Seguridad mejorada comparada con llamadas directas de API desde el frontend"]}}},ja:{settings:{title:"API",apiConfiguration:"AI",importantNotice:{title:"Gemini API",description:"OmniCanvasGoogle GeminiAIAPI"},apiKeys:{title:"Gemini API",services:{gemini:{name:"Google Gemini",description:"AI",placeholder:"AIza..."}},required:"",optional:"",valid:"",invalid:"",current:"",save:"",openSettings:"",rateLimitExceeded:""},gettingStarted:{title:"",steps:["Google AI StudioAPI","Gemini API","","AI"],getApiKeyButton:"Gemini API"},security:{title:"",benefits:["API","AI","API","API","API"]}}},fr:{settings:{title:"Configuration API",apiConfiguration:"Configuration des Services IA",importantNotice:{title:"Important : Utilisez Votre Propre Cl API Gemini",description:"OmniCanvas utilise Google Gemini pour la gnration d'images IA. Votre cl API est stocke en scurit et traite via notre backend pour une meilleure scurit."},apiKeys:{title:"Configuration de la Cl API Gemini",services:{gemini:{name:"Google Gemini",description:"Pour la gnration d'images IA et les outils cratifs",placeholder:"AIza..."}},required:"Requis",optional:"Optionnel",valid:"Valide",invalid:"Invalide",current:"Actuel",save:"Sauvegarder",openSettings:"Ouvrir les Paramtres",rateLimitExceeded:"Limite de dbit dpasse. Veuillez attendre un moment avant de ressayer."},gettingStarted:{title:"Commencer :",steps:["Visitez Google AI Studio pour obtenir votre cl API gratuite","Copiez votre cl API Gemini depuis le tableau de bord","Collez-la ci-dessous et sauvegardez votre configuration","Commencez  crer du contenu IA incroyable !"],getApiKeyButton:"Obtenir une Cl API Gemini Gratuite"},security:{title:"Scurit et Confidentialit",benefits:["Votre cl API est chiffre et stocke localement","Toutes les requtes IA sont traites en scurit via notre backend","Vous maintenez un contrle total sur l'utilisation et les cots de votre API","Aucune cl API n'est stocke sur nos serveurs","Scurit amliore compare aux appels API directs depuis le frontend"]}}}},Om={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"AI Assistant",tabs:{storyMaker:"Story Maker",generate:"Generate"},generate:{tabs:{generate:"Generate",enhance:"Enhance",video:"Video"},validation:{generateMessage:"Generate supports any number of reference images or none for fresh creation",styleMessage:"Style transfer requires exactly 1 image",mergeMessage:"Merge requires 2+ images"},processing:{analyzing:"Analyzing your request...",composing:"Creating beautiful compositions...",rendering:"Rendering high-quality images...",finalizing:"Adding final touches..."},templates:{title:"Popular Nano Banana Templates (Click to use)",withSelection:"+ Selected Images",categories:{all:"All",creative:" Creative",professional:" Professional",fun:" Fun"},items:{figurine:{title:"3D Figurine",description:"Desktop model"},handDrawn:{title:"Hand-drawn Process",description:"Sketch to final"},crossSection:{title:"3D Cross-section",description:"Internal structure"},restoration:{title:"Photo Restoration",description:"Colorize & repair"},idPhoto:{title:"Professional ID",description:"Business portrait"},product:{title:"Product Shot",description:"E-commerce photo"},interior:{title:"Interior Design",description:"Space makeover"},marketing:{title:"Marketing Material",description:"Social media"},tryOn:{title:"Virtual Try-on",description:"Outfit swap"},timeTravel:{title:"Time Travel",description:"Different eras"},petAdventure:{title:"Pet Adventures",description:"Fun scenarios"},ingredients:{title:"Food Breakdown",description:"Recipe guide"}},applied:" Template applied! You can generate directly or modify the prompt above"},placeholder:"Describe what you want to generate...",generateButton:"Generate with Nano Banana",generating:"Generating with Nano Banana...",imageToImageMode:" Image-to-Image Mode",imageToImageDescription:"Your selected images will be combined with your prompt/template to generate new images.",quickEnhancements:" Quick Enhancements (Click to toggle)",enhancementItems:["viral meme style","4K ultra HD","cinematic lighting","trending on artstation","octane render"],selectedImages:"images selected from canvas",invalidForTab:"Invalid for"},enhance:{selectImages:"Select Images to Enhance",selectImagesDescription:"Please select one or more images from the canvas to enhance",enhancementReady:"Enhancement Ready",willBeProcessed:"Your selected images will be processed and enhanced with AI technology.",enhancementOptions:"Enhancement Options",aiUpscale:"AI Upscale",upscaleDescription:"Increase image resolution using AI upscaling technology",backgroundRemoval:"Background Removal",backgroundRemovalDescription:"Automatically remove background and create transparent PNG",qualityEnhancement:"Quality Enhancement",qualityEnhancementDescription:"Improve overall image quality, reduce noise and artifacts",enhancementSummary:"Enhancement Summary",upscaleTo:"Upscale to",removeBackground:"Remove background (transparent PNG)",enhancedQuality:"Enhanced quality and noise reduction",processing:"Processing",enhanceButton:"Enhance Images",enhancing:"Enhancing...",resolutions:{"2x":"2x Resolution","4x":"4x Resolution","8x":"8x Resolution"}},selected:"selected",selectedFromCanvas:"selected from canvas",invalidFor:"Invalid for",selectedImagesNote:"Selected images will be automatically included in the AI request",generateBasedOn:"Generate new images based on your",selectedImage:"selected image",generateWithGemini:"Generate images with Gemini 2.5 Flash (Nano Banana)",imageToImageMode:"Image-to-Image Mode",active:"ACTIVE",selectedImagesCombined:"Your selected images will be combined with your prompt/template to generate new images.",useTemplate:"Use Template",close:"Close",image:"image",images:"images",storyMaker:{title:"Story Maker",description:"Create 4-panel comic stories with consistent characters",styleLabel:"Art Style",characterLabel:"Main Character",productLabel:"Featured Product",storyPromptLabel:"Story Concept",generateButton:"Generate 4-Panel Comic",useFromCanvas:"Use from Canvas",uploadImage:"Upload Image",generating:"Generating panel",placeholder:`Describe your story in one sentence...

Examples:
 A coffee shop encounter on a snowy Christmas night
 Finding the perfect gift during holiday shopping
 A friendship that blooms in a cozy bookstore`,styles:{comic:"Comic Book",manga:"Manga Style",watercolor:"Watercolor",oil:"Oil Painting",sketch:"Pencil Sketch"},characterSection:{title:"Main Character",description:"Upload or select the main character for your story",required:"Required",optional:"Optional"},productSection:{title:"Featured Product",description:"Add a product to feature in your story (optional)",optional:"Optional"},storySection:{title:"Story Concept",description:"Describe your story idea in one sentence",examples:["A coffee shop encounter on a snowy Christmas night","Finding the perfect gift during holiday shopping","A friendship that blooms in a cozy bookstore"]},generatingPanels:"Generating comic panels...",panelComplete:"Panel completed",storyComplete:"Comic story completed!",errors:{noStory:"Please enter a story prompt first!",characterRequired:"Please upload or select a character image!",generationFailed:"Comic generation failed. Please try again."}}},loadingIndicator:{stages:{analyzing:{text:"Analyzing...",description:"Understanding your creative needs"},composing:{text:"Composing...",description:"Designing creative concepts"},rendering:{text:"Rendering...",description:"Drawing beautiful images"},finalizing:{text:"Finalizing...",description:"Final touches"}}},nanoBananaPrompt:{title:" Nano Banana Prompt Input",selectedObjects:"objects selected",stabilityTip:{title:"Object Stability Tip",description:'We recommend including phrases like "keep main objects unchanged" or "maintain original features" in your prompt to ensure all important elements like people, furniture, and products remain stable and consistent.'},inputModes:{text:" Text Input",voice:" Voice Input"},voiceNotSupported:" Your browser does not support voice recognition",voiceStatus:{listening:" Listening, please speak...",clickToStart:"Click the microphone to start voice input"},promptLabel:"Prompt Content",promptPlaceholder:"For example: Change the background to a beach, keep main objects unchanged; Move the sofa to the living room, maintain sofa features...",quickExamples:"Quick Examples",examples:["Change the background to a beach, keep main objects unchanged","Move the sofa to the living room, maintain sofa features","Add stars to the sky, keep all objects consistent","Change to snowy background, furniture features unchanged","Make the room brighter, keep items as they are","Change to wooden floor, object appearance stable"],submit:"Execute Command",cancel:"Cancel"},contextMenu:{header:" AI Actions",playVideo:" Play Video",aiSmartCompose:" AI Smart Compose",creativeBlend:" Creative Blend",generateSimilar:" Generate Similar",nanoBananaPrompt:" Nano Banana Prompt Input",saveSelected:"Save Selected",duplicate:"Duplicate",duplicateMultiple:"Duplicate",delete:"Delete",deleteMultiple:"Delete"},serviceGuide:{title:"Service Guide",subtitle:"Learn how to use OmniCanvas features",quickStart:"Quick Start",quickActions:{generate:"Start Creating",generateDesc:"Open AI generation panel",enhance:"Enhance Images",enhanceDesc:"Improve your images with AI",settings:"Configure API",settingsDesc:"Set up your API keys"},overview:{title:"Overview",whatIs:{title:"What is OmniCanvas?",description:"OmniCanvas is an AI-powered creative platform that combines digital drawing, AI image generation, and multi-modal content integration.",features:{unlimited:"Unlimited creative canvas",aiPowered:"AI-powered generation and enhancement",multilingual:"Support for 5 languages",privacy:"Privacy-first with your own API keys"}}},aiGeneration:{title:"AI Image Generation",textToImage:{title:"Text-to-Image",description:"Generate images from text descriptions using Gemini 2.5 Flash.",steps:{openPanel:"Open the AI panel",writePrompt:"Write your description",selectTemplate:"Choose a template (optional)",generate:"Click Generate to create"}},imageToImage:{title:"Image-to-Image",description:"Create new images based on existing reference images.",steps:{selectImages:"Select reference images on canvas",openPanel:"Open AI panel",writePrompt:"Add your creative instructions",generate:"Generate new variations"}}},enhancement:{title:"AI Enhancement",aiUpscale:{title:"AI Upscaling",description:"Increase image resolution up to 8x using AI technology.",features:{resolution:"2x, 4x, 8x resolution options",quality:"Enhanced detail preservation",details:"Smart edge enhancement"}},backgroundRemoval:{title:"Background Removal",description:"Automatically remove backgrounds and create transparent PNGs.",features:{automatic:"One-click background removal",transparent:"True transparent PNG output",precise:"Accurate edge detection"}}},canvas:{title:"Canvas Navigation",navigation:{title:"Navigation Controls",description:"Learn how to navigate the infinite canvas.",controls:{zoom:"Zoom in/out",pan:"Pan around",select:"Select objects",multiSelect:"Multi-select"}},layers:{title:"Layer Management",description:"Organize your artwork with layers.",features:{unlimited:"Unlimited layers",visibility:"Show/hide layers",reorder:"Drag to reorder",lock:"Lock for protection"}}},contextMenu:{title:"Smart Context Menu",smartCompose:{title:"AI Composition",description:"Right-click on selected images to access AI composition tools.",options:{intelligent:"Intelligent auto-compose",accessory:"Accessory integration",scene:"Scene composition",creative:"Creative blending"}},voiceCommand:{title:"Voice Commands",description:"Use voice input for creative instructions.",features:{multilingual:"Multiple language support",intelligent:"AI understanding of creative intent",realtime:"Real-time processing"}}},settings:{title:"Settings & Configuration",apiKey:{title:"API Key Setup",description:"Configure your Gemini API key for AI features.",steps:{getKey:"Get API key from ai.google.dev",openSettings:"Open Settings panel",enterKey:"Enter your API key",save:"Save configuration"}},language:{title:"Language Settings",description:"Choose your preferred interface language."}},needHelp:{title:"Need Help?",description:"Get support from our community or contact us directly.",contact:"Contact Support",community:"Join Community"}},common:{loading:"Loading...",error:"Error",success:"Success",cancel:"Cancel",confirm:"Confirm",save:"Save",delete:"Delete",edit:"Edit",close:"Close",settings:"Settings"},alerts:{imageGenerationFailed:"Image generation failed: ",mergeSelectMinImages:"Please select at least 2 images to merge",mergeEnterInstructions:'Please enter merge instructions, e.g., "Blend these images into an artistic collage"',mergeFailed:"Image merging failed: ",styleSelectImage:"Please select an image to apply style",styleEnterDescription:'Please enter style description, e.g., "Van Gogh Starry Night style"',styleTransferComplete:"Style transfer complete!",styleTransferFailed:"Style transfer failed: ",comicGenerationFailed:"Comic generation failed. Please try again!",enterEditInstructions:"Please enter edit instructions!",generateComicFirst:"Generate a comic first!",panelEditingFailed:"Panel editing failed. Please try again!",storyGenerationFailed:"Story idea generation failed. Please try again!",selectImagesFirst:"Please select images on the canvas or generate a comic first!",magicEraserSelectImage:"Please select an image to use Magic Eraser",magicEraserComplete:" Magic Eraser complete! Unwanted objects removed.",magicEraserFailed:"Magic eraser failed: ",backgroundRemovalSelectImage:"Please select an image to remove background",backgroundRemovalComplete:" Background removed successfully!",backgroundRemovalFailed:"Background removal failed: ",avatarSelectPhoto:"Please select a photo to generate avatar",avatarGenerationFailed:"Avatar generation failed: ",mergedImagesSuccess:"Successfully merged {count} images!"},...Ji.en},Im={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"AI ",tabs:{storyMaker:"",generate:""},generate:{tabs:{generate:"",enhance:"",video:""},validation:{generateMessage:"",styleMessage:" 1 ",mergeMessage:" 2 "},processing:{analyzing:"...",composing:"...",rendering:"...",finalizing:"..."},templates:{title:"Nano Banana  ()",withSelection:"+ ",categories:{all:"",creative:" ",professional:" ",fun:" "},items:{figurine:{title:"3D ",description:""},handDrawn:{title:"",description:""},crossSection:{title:"3D ",description:""},restoration:{title:"",description:""},idPhoto:{title:"",description:""},product:{title:"",description:""},interior:{title:"",description:""},marketing:{title:"",description:""},tryOn:{title:"",description:""},timeTravel:{title:"",description:""},petAdventure:{title:"",description:""},ingredients:{title:"",description:""}},applied:" "},placeholder:"...",generateButton:" Nano Banana ",generating:" Nano Banana ...",imageToImageMode:" ",imageToImageDescription:"/",quickEnhancements:"  ()",enhancementItems:["","4K ","","","Octane "],selectedImages:"",invalidForTab:""},enhance:{selectImages:"",selectImagesDescription:"",enhancementReady:"",willBeProcessed:" AI ",enhancementOptions:"",aiUpscale:"AI ",upscaleDescription:" AI ",backgroundRemoval:"",backgroundRemovalDescription:" PNG",qualityEnhancement:"",qualityEnhancementDescription:"",enhancementSummary:"",upscaleTo:"",removeBackground:" ( PNG)",enhancedQuality:"",processing:"",enhanceButton:"",enhancing:"...",resolutions:{"2x":"2 ","4x":"4 ","8x":"8 "}},selected:"",selectedFromCanvas:"",invalidFor:"",selectedImagesNote:" AI ",generateBasedOn:"",selectedImage:"",generateWithGemini:" Gemini 2.5 Flash  (Nano Banana)",imageToImageMode:"",active:"",selectedImagesCombined:"/",useTemplate:"",close:"",image:"",images:"",storyMaker:{title:"",description:"",styleLabel:"",characterLabel:"",productLabel:"",storyPromptLabel:"",generateButton:"",useFromCanvas:"",uploadImage:"",generating:"",placeholder:`...


 
 
 `,styles:{comic:"",manga:"",watercolor:"",oil:"",sketch:""},characterSection:{title:"",description:"",required:"",optional:""},productSection:{title:"",description:"",optional:""},storySection:{title:"",description:"",examples:["","",""]},generatingPanels:"...",panelComplete:"",storyComplete:"",errors:{noStory:"",characterRequired:"",generationFailed:""}}},loadingIndicator:{stages:{analyzing:{text:"...",description:""},composing:{text:"...",description:""},rendering:{text:"...",description:""},finalizing:{text:"...",description:""}}},nanoBananaPrompt:{title:" Nano Banana ",selectedObjects:"",stabilityTip:{title:"",description:""},inputModes:{text:" ",voice:" "},voiceNotSupported:" ",voiceStatus:{listening:" ...",clickToStart:""},promptLabel:"",promptPlaceholder:"...",quickExamples:"",examples:["","","","","",""],submit:"",cancel:""},contextMenu:{header:" AI ",playVideo:" ",aiSmartCompose:" AI ",creativeBlend:" ",generateSimilar:" ",nanoBananaPrompt:" Nano Banana ",saveSelected:"",duplicate:"",duplicateMultiple:"",delete:"",deleteMultiple:""},serviceGuide:{title:"",subtitle:" OmniCanvas ",quickStart:"",quickActions:{generate:"",generateDesc:" AI ",enhance:"",enhanceDesc:" AI ",settings:" API",settingsDesc:" API "},overview:{title:"",whatIs:{title:" OmniCanvas",description:"OmniCanvas  AI AI ",features:{unlimited:"",aiPowered:"AI ",multilingual:" 5 ",privacy:" API "}}},aiGeneration:{title:"AI ",textToImage:{title:"",description:" Gemini 2.5 Flash ",steps:{openPanel:" AI ",writePrompt:"",selectTemplate:"",generate:""}},imageToImage:{title:"",description:"",steps:{selectImages:"",openPanel:" AI ",writePrompt:"",generate:""}}},enhancement:{title:"AI ",aiUpscale:{title:"AI ",description:" AI  8 ",features:{resolution:"2x4x8x ",quality:"",details:""}},backgroundRemoval:{title:"",description:" PNG",features:{automatic:"",transparent:" PNG ",precise:""}}},canvas:{title:"",navigation:{title:"",description:"",controls:{zoom:"",pan:"",select:"",multiSelect:""}},layers:{title:"",description:"",features:{unlimited:"",visibility:"/",reorder:"",lock:""}}},contextMenu:{title:"",smartCompose:{title:"AI ",description:" AI ",options:{intelligent:"",accessory:"",scene:"",creative:""}},voiceCommand:{title:"",description:"",features:{multilingual:"",intelligent:"AI ",realtime:""}}},settings:{title:"",apiKey:{title:"API ",description:" Gemini API  AI ",steps:{getKey:" ai.google.dev  API ",openSettings:"",enterKey:" API ",save:""}},language:{title:"",description:""}},needHelp:{title:"",description:"",contact:"",community:""}},common:{loading:"...",error:"",success:"",cancel:"",confirm:"",save:"",delete:"",edit:"",close:"",settings:""},alerts:{imageGenerationFailed:"",mergeSelectMinImages:" 2 ",mergeEnterInstructions:"",mergeFailed:"",styleSelectImage:"",styleEnterDescription:"",styleTransferComplete:"",styleTransferFailed:"",comicGenerationFailed:"",enterEditInstructions:"",generateComicFirst:"",panelEditingFailed:"",storyGenerationFailed:"",selectImagesFirst:"",magicEraserSelectImage:"",magicEraserComplete:" ",magicEraserFailed:"",backgroundRemovalSelectImage:"",backgroundRemovalComplete:" ",backgroundRemovalFailed:"",avatarSelectPhoto:"",avatarGenerationFailed:"",mergedImagesSuccess:" {count} "},...Ji["zh-TW"]},jm={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"Asistente IA",tabs:{storyMaker:"Creador de Historias",generate:"Generar"},generate:{tabs:{generate:"Generar",enhance:"Mejorar",video:"Video"},validation:{generateMessage:"Generar soporta cualquier nmero de imgenes de referencia o ninguna para creacin nueva",styleMessage:"Transferencia de estilo requiere exactamente 1 imagen",mergeMessage:"Fusionar requiere 2+ imgenes"},processing:{analyzing:"Analizando tu solicitud...",composing:"Creando composiciones hermosas...",rendering:"Renderizando imgenes de alta calidad...",finalizing:"Aadiendo toques finales..."},templates:{title:"Plantillas Populares de Nano Banana (Clic para usar)",withSelection:"+ Imgenes Seleccionadas",categories:{all:"Todas",creative:" Creativo",professional:" Profesional",fun:" Diversin"},items:{figurine:{title:"Figura 3D",description:"Modelo de escritorio"},handDrawn:{title:"Proceso Dibujado",description:"Boceto a final"},crossSection:{title:"Seccin 3D",description:"Estructura interna"},restoration:{title:"Restaurar Foto",description:"Colorear y reparar"},idPhoto:{title:"ID Profesional",description:"Retrato empresarial"},product:{title:"Foto de Producto",description:"Foto e-commerce"},interior:{title:"Diseo Interior",description:"Renovacin espacial"},marketing:{title:"Material Marketing",description:"Redes sociales"},tryOn:{title:"Prueba Virtual",description:"Cambio de ropa"},timeTravel:{title:"Viaje en el Tiempo",description:"Diferentes pocas"},petAdventure:{title:"Aventuras Mascota",description:"Escenas divertidas"},ingredients:{title:"Desglose Comida",description:"Gua de receta"}},applied:" Plantilla aplicada! Puedes generar directamente o modificar el prompt arriba"},placeholder:"Describe lo que quieres generar...",generateButton:"Generar con Nano Banana",generating:"Generando con Nano Banana...",imageToImageMode:" Modo Imagen a Imagen",imageToImageDescription:"Tus imgenes seleccionadas se combinarn con tu prompt/plantilla para generar nuevas imgenes.",quickEnhancements:" Mejoras Rpidas (Clic para alternar)",enhancementItems:["estilo meme viral","4K ultra HD","iluminacin cinematogrfica","tendencia en artstation","render octane"],selectedImages:"imgenes seleccionadas del lienzo",invalidForTab:"No vlido para"},enhance:{selectImages:"Seleccionar Imgenes para Mejorar",selectImagesDescription:"Por favor selecciona una o ms imgenes del lienzo para mejorar",enhancementReady:"Mejora Lista",willBeProcessed:"Tus imgenes seleccionadas sern procesadas y mejoradas con tecnologa IA.",enhancementOptions:"Opciones de Mejora",aiUpscale:"Escalado IA",upscaleDescription:"Aumentar resolucin de imagen usando tecnologa de escalado IA",backgroundRemoval:"Eliminacin de Fondo",backgroundRemovalDescription:"Remover automticamente el fondo y crear PNG transparente",qualityEnhancement:"Mejora de Calidad",qualityEnhancementDescription:"Mejorar la calidad general de imagen, reducir ruido y artefactos",enhancementSummary:"Resumen de Mejora",upscaleTo:"Escalar a",removeBackground:"Remover fondo (PNG transparente)",enhancedQuality:"Calidad mejorada y reduccin de ruido",processing:"Procesando",enhanceButton:"Mejorar Imgenes",enhancing:"Mejorando...",resolutions:{"2x":"Resolucin 2x","4x":"Resolucin 4x","8x":"Resolucin 8x"}},selected:"seleccionado",selectedFromCanvas:"seleccionado del lienzo",invalidFor:"No vlido para",selectedImagesNote:"Las imgenes seleccionadas se incluirn automticamente en la solicitud de IA",generateBasedOn:"Generar nuevas imgenes basadas en tu",selectedImage:"imagen seleccionada",generateWithGemini:"Generar imgenes con Gemini 2.5 Flash (Nano Banana)",imageToImageMode:"Modo Imagen a Imagen",active:"ACTIVO",selectedImagesCombined:"Tus imgenes seleccionadas se combinarn con tu prompt/plantilla para generar nuevas imgenes.",useTemplate:"Usar Plantilla",close:"Cerrar",image:"imagen",images:"imgenes",storyMaker:{title:"Creador de Historias",description:"Crea historias de cmic de 4 paneles con personajes consistentes",styleLabel:"Estilo Artstico",characterLabel:"Personaje Principal",productLabel:"Producto Destacado",storyPromptLabel:"Concepto de Historia",generateButton:"Generar Cmic de 4 Paneles",useFromCanvas:"Usar del Lienzo",uploadImage:"Subir Imagen",generating:"Generando panel",placeholder:`Describe tu historia en una oracin...

Ejemplos:
 Un encuentro en una cafetera en una noche navidea nevada
 Encontrar el regalo perfecto durante las compras navideas
 Una amistad que florece en una acogedora librera`,styles:{comic:"Cmic",manga:"Estilo Manga",watercolor:"Acuarela",oil:"Pintura al leo",sketch:"Boceto a Lpiz"},characterSection:{title:"Personaje Principal",description:"Sube o selecciona el personaje principal de tu historia",required:"Requerido",optional:"Opcional"},productSection:{title:"Producto Destacado",description:"Agrega un producto para destacar en tu historia (opcional)",optional:"Opcional"},storySection:{title:"Concepto de Historia",description:"Describe tu idea de historia en una oracin",examples:["Un encuentro en una cafetera en una noche navidea nevada","Encontrar el regalo perfecto durante las compras navideas","Una amistad que florece en una acogedora librera"]},generatingPanels:"Generando paneles de cmic...",panelComplete:"Panel completado",storyComplete:"Historia de cmic completada!",errors:{noStory:"Por favor ingresa una propuesta de historia primero!",characterRequired:"Por favor sube o selecciona una imagen de personaje!",generationFailed:"La generacin del cmic fall. Por favor intenta de nuevo."}}},loadingIndicator:{stages:{analyzing:{text:"Analizando...",description:"Entendiendo tus necesidades creativas"},composing:{text:"Componiendo...",description:"Diseando conceptos creativos"},rendering:{text:"Renderizando...",description:"Dibujando imgenes hermosas"},finalizing:{text:"Finalizando...",description:"Toques finales"}}},nanoBananaPrompt:{title:" Entrada de Comando Nano Banana",selectedObjects:"objetos seleccionados",stabilityTip:{title:"Consejo de Estabilidad de Objetos",description:'Recomendamos incluir frases como "mantener objetos principales sin cambios" o "conservar caractersticas originales" en tu comando para asegurar que todos los elementos importantes como personas, muebles y productos permanezcan estables y consistentes.'},inputModes:{text:" Entrada de Texto",voice:" Entrada de Voz"},voiceNotSupported:" Tu navegador no soporta reconocimiento de voz",voiceStatus:{listening:" Escuchando, por favor habla...",clickToStart:"Haz clic en el micrfono para iniciar entrada de voz"},promptLabel:"Contenido del Comando",promptPlaceholder:"Por ejemplo: Cambiar el fondo a una playa, mantener objetos principales sin cambios; Mover el sof a la sala, conservar caractersticas del sof...",quickExamples:"Ejemplos Rpidos",examples:["Cambiar el fondo a una playa, mantener objetos principales sin cambios","Mover el sof a la sala, conservar caractersticas del sof","Agregar estrellas al cielo, mantener todos los objetos consistentes","Cambiar a fondo nevado, caractersticas de muebles sin cambios","Hacer la habitacin ms brillante, mantener elementos como estn","Cambiar a piso de madera, apariencia de objetos estable"],submit:"Ejecutar Comando",cancel:"Cancelar"},contextMenu:{header:" Acciones IA",playVideo:" Reproducir Video",aiSmartCompose:" Composicin Inteligente IA",creativeBlend:" Mezcla Creativa",generateSimilar:" Generar Similar",nanoBananaPrompt:" Entrada de Comando Nano Banana",saveSelected:"Guardar Seleccionados",duplicate:"Duplicar",duplicateMultiple:"Duplicar",delete:"Eliminar",deleteMultiple:"Eliminar"},common:{loading:"Cargando...",error:"Error",success:"xito",cancel:"Cancelar",confirm:"Confirmar",save:"Guardar",delete:"Eliminar",edit:"Editar",close:"Cerrar",settings:"Configuracin"},alerts:{imageGenerationFailed:"La generacin de imgenes fall: ",mergeSelectMinImages:"Por favor selecciona al menos 2 imgenes para fusionar",mergeEnterInstructions:'Por favor ingresa instrucciones de fusin, ej: "Mezcla estas imgenes en un collage artstico"',mergeFailed:"La fusin de imgenes fall: ",styleSelectImage:"Por favor selecciona una imagen para aplicar estilo",styleEnterDescription:'Por favor ingresa descripcin de estilo, ej: "Estilo Noche Estrellada de Van Gogh"',styleTransferComplete:"Transferencia de estilo completa!",styleTransferFailed:"La transferencia de estilo fall: ",comicGenerationFailed:"La generacin del cmic fall. Por favor intntalo de nuevo!",enterEditInstructions:"Por favor ingresa instrucciones de edicin!",generateComicFirst:"Genera un cmic primero!",panelEditingFailed:"La edicin del panel fall. Por favor intntalo de nuevo!",storyGenerationFailed:"La generacin de historia fall. Por favor intntalo de nuevo!",selectImagesFirst:"Por favor selecciona imgenes en el lienzo o genera un cmic primero!",magicEraserSelectImage:"Por favor selecciona una imagen para usar la Goma Mgica",magicEraserComplete:" Goma Mgica completa! Objetos no deseados eliminados.",magicEraserFailed:"La goma mgica fall: ",backgroundRemovalSelectImage:"Por favor selecciona una imagen para quitar el fondo",backgroundRemovalComplete:" Fondo eliminado exitosamente!",backgroundRemovalFailed:"La eliminacin del fondo fall: ",avatarSelectPhoto:"Por favor selecciona una foto para generar avatar",avatarGenerationFailed:"La generacin del avatar fall: ",mergedImagesSuccess:"Fusionadas exitosamente {count} imgenes!"},serviceGuide:{title:"Gua de Servicio",subtitle:"Aprende a usar las funciones de OmniCanvas",quickStart:"Inicio Rpido",quickActions:{generate:"Comenzar a Crear",generateDesc:"Abrir panel de generacin IA",enhance:"Mejorar Imgenes",enhanceDesc:"Mejora tus imgenes con IA",settings:"Configurar API",settingsDesc:"Configura tus claves API"},overview:{title:"Resumen",whatIs:{title:"Qu es OmniCanvas?",description:"OmniCanvas es una plataforma creativa impulsada por IA que combina dibujo digital, generacin de imgenes IA e integracin de contenido multimodal.",features:{unlimited:"Lienzo creativo ilimitado",aiPowered:"Generacin y mejora impulsada por IA",multilingual:"Soporte para 5 idiomas",privacy:"Privacidad primero con tus propias claves API"}}},aiGeneration:{title:"Generacin de Imgenes IA",textToImage:{title:"Texto a Imagen",description:"Genera imgenes desde descripciones de texto usando Gemini 2.5 Flash.",steps:{openPanel:"Abre el panel IA",writePrompt:"Escribe tu descripcin",selectTemplate:"Elige una plantilla (opcional)",generate:"Haz clic en Generar para crear"}},imageToImage:{title:"Imagen a Imagen",description:"Crea nuevas imgenes basadas en imgenes de referencia existentes.",steps:{selectImages:"Selecciona imgenes de referencia en el lienzo",openPanel:"Abre el panel IA",writePrompt:"Aade tus instrucciones creativas",generate:"Genera nuevas variaciones"}}},enhancement:{title:"Mejora IA",aiUpscale:{title:"Escalado IA",description:"Aumenta la resolucin de imagen hasta 8x usando tecnologa IA.",features:{resolution:"Opciones de resolucin 2x, 4x, 8x",quality:"Preservacin mejorada de detalles",details:"Mejora inteligente de bordes"}},backgroundRemoval:{title:"Eliminacin de Fondo",description:"Elimina automticamente fondos y crea PNGs transparentes.",features:{automatic:"Eliminacin de fondo con un clic",transparent:"Salida PNG verdaderamente transparente",precise:"Deteccin precisa de bordes"}}},canvas:{title:"Navegacin del Lienzo",navigation:{title:"Controles de Navegacin",description:"Aprende a navegar el lienzo infinito.",controls:{zoom:"Acercar/alejar",pan:"Panormica",select:"Seleccionar objetos",multiSelect:"Seleccin mltiple"}},layers:{title:"Gestin de Capas",description:"Organiza tu arte con capas.",features:{unlimited:"Capas ilimitadas",visibility:"Mostrar/ocultar capas",reorder:"Arrastra para reordenar",lock:"Bloquear para proteccin"}}},contextMenu:{title:"Men Contextual Inteligente",smartCompose:{title:"Composicin IA",description:"Haz clic derecho en imgenes seleccionadas para acceder a herramientas de composicin IA.",options:{intelligent:"Composicin inteligente automtica",accessory:"Aadir accesorios relacionados",scene:"Crear escena envolvente",creative:"Mezcla artstica creativa"}},voiceCommand:{title:"Comando de Voz",description:"Usa comandos de voz para crear y editar contenido.",features:{multilingual:"Reconocimiento multiidioma",intelligent:"Comprensin de contexto inteligente",realtime:"Procesamiento en tiempo real"}}},settings:{title:"Configuracin",apiKey:{title:"Configuracin de Clave API",description:"Configura tu clave API de Gemini para usar funciones IA.",steps:{getKey:"Obtn una clave API de Google AI Studio",openSettings:"Abre la configuracin",enterKey:"Ingresa tu clave API",save:"Guarda la configuracin"}},language:{title:"Configuracin de Idioma",description:"Cambia el idioma de la interfaz segn tu preferencia."}},needHelp:{title:"Necesitas Ayuda?",description:"Estamos aqu para ayudarte con cualquier pregunta.",contact:"Contactar Soporte",community:"Unirse a la Comunidad"}},...Ji.es},Am={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"AI",tabs:{storyMaker:"",generate:""},generate:{tabs:{generate:"",enhance:"",video:""},validation:{generateMessage:"",styleMessage:"1",mergeMessage:"2"},processing:{analyzing:"...",composing:"...",rendering:"...",finalizing:"..."},templates:{title:"Nano Banana ",withSelection:"+ ",categories:{all:"",creative:" ",professional:" ",fun:" "},items:{figurine:{title:"3D",description:""},handDrawn:{title:"",description:""},crossSection:{title:"3D",description:""},restoration:{title:"",description:""},idPhoto:{title:"ID",description:""},product:{title:"",description:"EC"},interior:{title:"",description:""},marketing:{title:"",description:""},tryOn:{title:"",description:""},timeTravel:{title:"",description:""},petAdventure:{title:"",description:""},ingredients:{title:"",description:""}},applied:" "},placeholder:"...",generateButton:"Nano Banana",generating:"Nano Banana...",imageToImageMode:" ",imageToImageDescription:"/",quickEnhancements:" ",enhancementItems:["","4K HD","","artstation ","octane "],selectedImages:"",invalidForTab:""},enhance:{selectImages:"",selectImagesDescription:"1",enhancementReady:"",willBeProcessed:"AI",enhancementOptions:"",aiUpscale:"AI",upscaleDescription:"AI",backgroundRemoval:"",backgroundRemovalDescription:"PNG",qualityEnhancement:"",qualityEnhancementDescription:"",enhancementSummary:"",upscaleTo:"",removeBackground:"PNG",enhancedQuality:"",processing:"",enhanceButton:"",enhancing:"...",resolutions:{"2x":"2","4x":"4","8x":"8"}},selected:"",selectedFromCanvas:"",invalidFor:"",selectedImagesNote:"AI",generateBasedOn:"",selectedImage:"",generateWithGemini:"Gemini 2.5 Flash  (Nano Banana)",imageToImageMode:"",active:"",selectedImagesCombined:"/",useTemplate:"",close:"",image:"",images:"",storyMaker:{title:"",description:"4",styleLabel:"",characterLabel:"",productLabel:"",storyPromptLabel:"",generateButton:"4",useFromCanvas:"",uploadImage:"",generating:"",placeholder:`...


 
 
 `,styles:{comic:"",manga:"",watercolor:"",oil:"",sketch:""},characterSection:{title:"",description:"",required:"",optional:""},productSection:{title:"",description:"",optional:""},storySection:{title:"",description:"",examples:["","",""]},generatingPanels:"...",panelComplete:"",storyComplete:"",errors:{noStory:"",characterRequired:"",generationFailed:""}}},loadingIndicator:{stages:{analyzing:{text:"...",description:""},composing:{text:"...",description:""},rendering:{text:"...",description:""},finalizing:{text:"...",description:""}}},nanoBananaPrompt:{title:" Nano Banana ",selectedObjects:"",stabilityTip:{title:"",description:""},inputModes:{text:" ",voice:" "},voiceNotSupported:" ",voiceStatus:{listening:" ...",clickToStart:""},promptLabel:"",promptPlaceholder:"...",quickExamples:"",examples:["","","","","",""],submit:"",cancel:""},contextMenu:{header:" AI",playVideo:" ",aiSmartCompose:" AI",creativeBlend:" ",generateSimilar:" ",nanoBananaPrompt:" Nano Banana ",saveSelected:"",duplicate:"",duplicateMultiple:"",delete:"",deleteMultiple:""},common:{loading:"...",error:"",success:"",cancel:"",confirm:"",save:"",delete:"",edit:"",close:"",settings:""},alerts:{imageGenerationFailed:"",mergeSelectMinImages:"2",mergeEnterInstructions:"",mergeFailed:"",styleSelectImage:"",styleEnterDescription:"",styleTransferComplete:"",styleTransferFailed:"",comicGenerationFailed:"",enterEditInstructions:"",generateComicFirst:"",panelEditingFailed:"",storyGenerationFailed:"",selectImagesFirst:"",magicEraserSelectImage:"",magicEraserComplete:" ",magicEraserFailed:"",backgroundRemovalSelectImage:"",backgroundRemovalComplete:" ",backgroundRemovalFailed:"",avatarSelectPhoto:"",avatarGenerationFailed:"",mergedImagesSuccess:"{count}"},serviceGuide:{title:"",subtitle:"OmniCanvas",quickStart:"",quickActions:{generate:"",generateDesc:"AI",enhance:"",enhanceDesc:"AI",settings:"API",settingsDesc:"API"},overview:{title:"",whatIs:{title:"OmniCanvas",description:"OmniCanvasAIAI",features:{unlimited:"",aiPowered:"AI",multilingual:"5",privacy:"API"}}},aiGeneration:{title:"AI",textToImage:{title:"",description:"Gemini 2.5 Flash",steps:{openPanel:"AI",writePrompt:"",selectTemplate:"",generate:""}},imageToImage:{title:"",description:"",steps:{selectImages:"",openPanel:"AI",writePrompt:"",generate:""}}},enhancement:{title:"AI",aiUpscale:{title:"AI",description:"AI8",features:{resolution:"248",quality:"",details:""}},backgroundRemoval:{title:"",description:"PNG",features:{automatic:"",transparent:"PNG",precise:""}}},canvas:{title:"",navigation:{title:"",description:"",controls:{zoom:"/",pan:"",select:"",multiSelect:""}},layers:{title:"",description:"",features:{unlimited:"",visibility:"/",reorder:"",lock:""}}},contextMenu:{title:"",smartCompose:{title:"AI",description:"AI",options:{intelligent:"",accessory:"",scene:"",creative:""}},voiceCommand:{title:"",description:"",features:{multilingual:"",intelligent:"",realtime:""}}},settings:{title:"",apiKey:{title:"API",description:"AIGemini API",steps:{getKey:"Google AI StudioAPI",openSettings:"",enterKey:"API",save:""}},language:{title:"",description:""}},needHelp:{title:"",description:"",contact:"",community:""}},...Ji.ja},Mm={language:{en:"English",zhTW:"",es:"Espaol",ja:"",fr:"Franais"},aiPanel:{title:"Assistant IA",tabs:{storyMaker:"Crateur d'Histoires",generate:"Gnrer"},generate:{tabs:{generate:"Gnrer",enhance:"Amliorer",video:"Vido"},validation:{generateMessage:"Gnrer supporte n'importe quel nombre d'images de rfrence ou aucune pour une cration frache",styleMessage:"Le transfert de style ncessite exactement 1 image",mergeMessage:"Fusionner ncessite 2+ images"},processing:{analyzing:"Analyse de votre demande...",composing:"Cration de belles compositions...",rendering:"Rendu d'images haute qualit...",finalizing:"Ajout des touches finales..."},templates:{title:"Modles Populaires Nano Banana (Cliquer pour utiliser)",withSelection:"+ Images Slectionnes",categories:{all:"Tous",creative:" Cratif",professional:" Professionnel",fun:" Amusant"},items:{figurine:{title:"Figurine 3D",description:"Modle de bureau"},handDrawn:{title:"Processus Dessin",description:"Croquis au final"},crossSection:{title:"Coupe 3D",description:"Structure interne"},restoration:{title:"Restauration Photo",description:"Coloriser et rparer"},idPhoto:{title:"ID Professionnel",description:"Portrait d'affaires"},product:{title:"Photo Produit",description:"Photo e-commerce"},interior:{title:"Design Intrieur",description:"Relooking espace"},marketing:{title:"Matriel Marketing",description:"Mdias sociaux"},tryOn:{title:"Essai Virtuel",description:"Changement tenue"},timeTravel:{title:"Voyage Temporel",description:"poques diffrentes"},petAdventure:{title:"Aventures Animaux",description:"Scnes amusantes"},ingredients:{title:"Dcomposition Plat",description:"Guide recette"}},applied:" Modle appliqu! Vous pouvez gnrer directement ou modifier le prompt ci-dessus"},placeholder:"Dcrivez ce que vous voulez gnrer...",generateButton:"Gnrer avec Nano Banana",generating:"Gnration avec Nano Banana...",imageToImageMode:" Mode Image  Image",imageToImageDescription:"Vos images slectionnes seront combines avec votre prompt/modle pour gnrer de nouvelles images.",quickEnhancements:" Amliorations Rapides (Cliquer pour basculer)",enhancementItems:["style mme viral","4K ultra HD","clairage cinmatographique","tendance sur artstation","rendu octane"],selectedImages:"images slectionnes du canevas",invalidForTab:"Non valide pour"},enhance:{selectImages:"Slectionner Images  Amliorer",selectImagesDescription:"Veuillez slectionner une ou plusieurs images du canevas  amliorer",enhancementReady:"Amlioration Prte",willBeProcessed:"Vos images slectionnes seront traites et amliores avec la technologie IA.",enhancementOptions:"Options d'Amlioration",aiUpscale:"Mise  l'chelle IA",upscaleDescription:"Augmenter la rsolution d'image en utilisant la technologie de mise  l'chelle IA",backgroundRemoval:"Suppression d'Arrire-plan",backgroundRemovalDescription:"Supprimer automatiquement l'arrire-plan et crer un PNG transparent",qualityEnhancement:"Amlioration de Qualit",qualityEnhancementDescription:"Amliorer la qualit gnrale de l'image, rduire le bruit et les artefacts",enhancementSummary:"Rsum d'Amlioration",upscaleTo:"Mise  l'chelle vers",removeBackground:"Supprimer l'arrire-plan (PNG transparent)",enhancedQuality:"Qualit amliore et rduction du bruit",processing:"Traitement",enhanceButton:"Amliorer Images",enhancing:"Amlioration...",resolutions:{"2x":"Rsolution 2x","4x":"Rsolution 4x","8x":"Rsolution 8x"}},selected:"slectionn",selectedFromCanvas:"slectionn du canevas",invalidFor:"Non valide pour",selectedImagesNote:"Les images slectionnes seront automatiquement incluses dans la demande IA",generateBasedOn:"Gnrer de nouvelles images bases sur votre",selectedImage:"image slectionne",generateWithGemini:"Gnrer des images avec Gemini 2.5 Flash (Nano Banana)",imageToImageMode:"Mode Image vers Image",active:"ACTIF",selectedImagesCombined:"Vos images slectionnes seront combines avec votre prompt/modle pour gnrer de nouvelles images.",useTemplate:"Utiliser le Modle",close:"Fermer",image:"image",images:"images",storyMaker:{title:"Crateur d'Histoires",description:"Crez des histoires de bande dessine  4 panneaux avec des personnages cohrents",styleLabel:"Style Artistique",characterLabel:"Personnage Principal",productLabel:"Produit Vedette",storyPromptLabel:"Concept d'Histoire",generateButton:"Gnrer BD 4 Panneaux",useFromCanvas:"Utiliser du Canevas",uploadImage:"Tlcharger Image",generating:"Gnration panneau",placeholder:`Dcrivez votre histoire en une phrase...

Exemples :
 Une rencontre dans un caf par une nuit de Nol enneige
 Trouver le cadeau parfait pendant les achats des ftes
 Une amiti qui s'panouit dans une librairie douillette`,styles:{comic:"Bande Dessine",manga:"Style Manga",watercolor:"Aquarelle",oil:"Peinture  l'Huile",sketch:"Croquis au Crayon"},characterSection:{title:"Personnage Principal",description:"Tlchargez ou slectionnez le personnage principal de votre histoire",required:"Requis",optional:"Optionnel"},productSection:{title:"Produit Vedette",description:"Ajoutez un produit  mettre en vedette dans votre histoire (optionnel)",optional:"Optionnel"},storySection:{title:"Concept d'Histoire",description:"Dcrivez votre ide d'histoire en une phrase",examples:["Une rencontre dans un caf par une nuit de Nol enneige","Trouver le cadeau parfait pendant les achats des ftes","Une amiti qui s'panouit dans une librairie douillette"]},generatingPanels:"Gnration des panneaux de BD...",panelComplete:"Panneau termin",storyComplete:"Histoire de BD termine !",errors:{noStory:"Veuillez d'abord entrer une proposition d'histoire !",characterRequired:"Veuillez tlcharger ou slectionner une image de personnage !",generationFailed:"La gnration de la BD a chou. Veuillez ressayer."}}},loadingIndicator:{stages:{analyzing:{text:"Analyse...",description:"Comprhension de vos besoins cratifs"},composing:{text:"Composition...",description:"Conception de concepts cratifs"},rendering:{text:"Rendu...",description:"Dessin d'images magnifiques"},finalizing:{text:"Finalisation...",description:"Touches finales"}}},nanoBananaPrompt:{title:" Saisie de Commande Nano Banana",selectedObjects:"objets slectionns",stabilityTip:{title:"Astuce de Stabilit d'Objets",description:`Nous recommandons d'inclure des phrases comme "maintenir les objets principaux inchangs" ou "conserver les caractristiques originales" dans votre commande pour assurer que tous les lments importants comme les personnes, meubles et produits restent stables et cohrents.`},inputModes:{text:" Saisie Texte",voice:" Saisie Vocale"},voiceNotSupported:" Votre navigateur ne supporte pas la reconnaissance vocale",voiceStatus:{listening:" coute en cours, veuillez parler...",clickToStart:"Cliquez sur le microphone pour commencer la saisie vocale"},promptLabel:"Contenu de la Commande",promptPlaceholder:"Par exemple : Changer l'arrire-plan en plage, garder les objets principaux inchangs ; Dplacer le canap au salon, maintenir les caractristiques du canap...",quickExamples:"Exemples Rapides",examples:["Changer l'arrire-plan en plage, garder les objets principaux inchangs","Dplacer le canap au salon, maintenir les caractristiques du canap","Ajouter des toiles au ciel, garder tous les objets cohrents","Changer en arrire-plan neigeux, caractristiques des meubles inchanges","Rendre la pice plus lumineuse, garder les lments comme ils sont","Changer en sol en bois, apparence des objets stable"],submit:"Excuter la Commande",cancel:"Annuler"},contextMenu:{header:" Actions IA",playVideo:" Lire Vido",aiSmartCompose:" Composition Intelligente IA",creativeBlend:" Mlange Cratif",generateSimilar:" Gnrer Similaire",nanoBananaPrompt:" Saisie de Commande Nano Banana",saveSelected:"Sauvegarder Slectionns",duplicate:"Dupliquer",duplicateMultiple:"Dupliquer",delete:"Supprimer",deleteMultiple:"Supprimer"},common:{loading:"Chargement...",error:"Erreur",success:"Succs",cancel:"Annuler",confirm:"Confirmer",save:"Sauvegarder",delete:"Supprimer",edit:"Modifier",close:"Fermer",settings:"Paramtres"},alerts:{imageGenerationFailed:"La gnration d'image a chou : ",mergeSelectMinImages:"Veuillez slectionner au moins 2 images  fusionner",mergeEnterInstructions:'Veuillez entrer des instructions de fusion, ex : "Mlanger ces images en collage artistique"',mergeFailed:"La fusion d'images a chou : ",styleSelectImage:"Veuillez slectionner une image pour appliquer un style",styleEnterDescription:'Veuillez entrer une description de style, ex : "Style Nuit toile de Van Gogh"',styleTransferComplete:"Transfert de style termin !",styleTransferFailed:"Le transfert de style a chou : ",comicGenerationFailed:"La gnration de BD a chou. Veuillez ressayer !",enterEditInstructions:"Veuillez entrer des instructions d'dition !",generateComicFirst:"Gnrez d'abord une BD !",panelEditingFailed:"L'dition du panneau a chou. Veuillez ressayer !",storyGenerationFailed:"La gnration d'histoire a chou. Veuillez ressayer !",selectImagesFirst:"Veuillez slectionner des images sur le canevas ou gnrer une BD d'abord !",magicEraserSelectImage:"Veuillez slectionner une image pour utiliser la Gomme Magique",magicEraserComplete:" Gomme Magique termine ! Objets indsirables supprims.",magicEraserFailed:"La gomme magique a chou : ",backgroundRemovalSelectImage:"Veuillez slectionner une image pour supprimer l'arrire-plan",backgroundRemovalComplete:" Arrire-plan supprim avec succs !",backgroundRemovalFailed:"La suppression de l'arrire-plan a chou : ",avatarSelectPhoto:"Veuillez slectionner une photo pour gnrer un avatar",avatarGenerationFailed:"La gnration d'avatar a chou : ",mergedImagesSuccess:"{count} images fusionnes avec succs !"},serviceGuide:{title:"Guide de Service",subtitle:"Apprendre  utiliser les fonctionnalits d'OmniCanvas",quickStart:"Dmarrage Rapide",quickActions:{generate:"Commencer  Crer",generateDesc:"Ouvrir le panneau de gnration IA",enhance:"Amliorer les Images",enhanceDesc:"Amliorez vos images avec l'IA",settings:"Configurer l'API",settingsDesc:"Configurez vos cls API"},overview:{title:"Aperu",whatIs:{title:"Qu'est-ce qu'OmniCanvas ?",description:"OmniCanvas est une plateforme crative alimente par l'IA qui combine le dessin numrique, la gnration d'images IA et l'intgration de contenu multimodal.",features:{unlimited:"Toile crative illimite",aiPowered:"Gnration et amlioration alimentes par l'IA",multilingual:"Support de 5 langues",privacy:"Confidentialit d'abord avec vos propres cls API"}}},aiGeneration:{title:"Gnration d'Images IA",textToImage:{title:"Texte vers Image",description:"Gnrez des images  partir de descriptions textuelles en utilisant Gemini 2.5 Flash.",steps:{openPanel:"Ouvrir le panneau IA",writePrompt:"crivez votre description",selectTemplate:"Choisissez un modle (optionnel)",generate:"Cliquez sur Gnrer pour crer"}},imageToImage:{title:"Image vers Image",description:"Crez de nouvelles images bases sur des images de rfrence existantes.",steps:{selectImages:"Slectionnez les images de rfrence sur la toile",openPanel:"Ouvrir le panneau IA",writePrompt:"Ajoutez vos instructions cratives",generate:"Gnrer de nouvelles variations"}}},enhancement:{title:"Amlioration IA",aiUpscale:{title:"Mise  l'chelle IA",description:"Augmentez la rsolution d'image jusqu' 8x en utilisant la technologie IA.",features:{resolution:"Options de rsolution 2x, 4x, 8x",quality:"Prservation amliore des dtails",details:"Amlioration intelligente des bords"}},backgroundRemoval:{title:"Suppression d'Arrire-plan",description:"Supprimez automatiquement les arrire-plans et crez des PNG transparents.",features:{automatic:"Suppression d'arrire-plan en un clic",transparent:"Sortie PNG vraiment transparente",precise:"Dtection prcise des bords"}}},canvas:{title:"Navigation de Toile",navigation:{title:"Contrles de Navigation",description:"Apprenez  naviguer sur la toile infinie.",controls:{zoom:"Zoomer/Dzoomer",pan:"Panoramique",select:"Slectionner des objets",multiSelect:"Multi-slection"}},layers:{title:"Gestion des Calques",description:"Organisez votre uvre d'art avec des calques.",features:{unlimited:"Calques illimits",visibility:"Afficher/masquer les calques",reorder:"Glisser pour rorganiser",lock:"Verrouiller pour protection"}}},contextMenu:{title:"Menu Contextuel Intelligent",smartCompose:{title:"Composition IA",description:"Cliquez droit sur les images slectionnes pour accder aux outils de composition IA.",options:{intelligent:"Composition intelligente automatique",accessory:"Ajouter des accessoires connexes",scene:"Crer une scne enveloppante",creative:"Mlange artistique cratif"}},voiceCommand:{title:"Commande Vocale",description:"Utilisez des commandes vocales pour crer et diter du contenu.",features:{multilingual:"Reconnaissance multilingue",intelligent:"Comprhension intelligente du contexte",realtime:"Traitement en temps rel"}}},settings:{title:"Paramtres",apiKey:{title:"Configuration de Cl API",description:"Configurez votre cl API Gemini pour utiliser les fonctionnalits IA.",steps:{getKey:"Obtenez une cl API de Google AI Studio",openSettings:"Ouvrir les paramtres",enterKey:"Entrez votre cl API",save:"Sauvegarder la configuration"}},language:{title:"Paramtres de Langue",description:"Changez la langue de l'interface selon votre prfrence."}},needHelp:{title:"Besoin d'Aide ?",description:"Nous sommes l pour vous aider avec toute question.",contact:"Contacter le Support",community:"Rejoindre la Communaut"}},...Ji.fr},dc={en:Om,"zh-TW":Im,es:jm,ja:Am,fr:Mm};function Yo(t){return dc[t]||dc.en}function _n(){const{currentLanguage:t}=Qi();return Yo(t)}const Dm=({x:t,y:e,visible:n,selectedCount:c,onClose:p,onMergeImages:y,onStyleTransfer:w,onDuplicate:d,onDelete:s,onBringToFront:u,onSendToBack:h,onRotate:r,onGenerateSimilar:a,onExportSelected:i,onGroupSelection:o,onIntelligentCompose:f,onWearAccessory:l,onSceneCompose:g,onCreativeBlend:m,onPlayVideo:v,hasVideoThumbnail:x,onVoicePrompt:S})=>{const b=_n();if(!n)return null;console.log(" NEW AI CONTEXT MENU RENDERING! Time:",new Date().toLocaleTimeString()),console.log(" NewContextMenu props:",{visible:n,x:t,y:e,selectedCount:c}),console.log(" AI handlers available:",{onIntelligentCompose:!!f,onWearAccessory:!!l,onSceneCompose:!!g,onCreativeBlend:!!m});const T=[...x&&c===1&&v?[{icon:Dh,label:b.contextMenu.playVideo,onClick:v,className:"text-orange-600 hover:bg-orange-50 font-semibold",separator:!0}]:[],...c>=2?[{icon:Ih,label:`${b.contextMenu.aiSmartCompose} (${c})`,onClick:f,className:"text-blue-600 hover:bg-blue-50 font-semibold",separator:!1},{icon:Lh,label:b.contextMenu.creativeBlend,onClick:m,className:"text-pink-600 hover:bg-pink-50",separator:!0}]:[],...c>=1?[{icon:en,label:b.contextMenu.generateSimilar,onClick:a,className:"text-green-600 hover:bg-green-50",separator:!1}]:[],...c>=1&&S?[{icon:Ya,label:b.contextMenu.nanoBananaPrompt,onClick:S,className:"text-purple-600 hover:bg-purple-50 font-semibold",separator:!0}]:[],...c>=1?[{icon:Eg,label:b.contextMenu.saveSelected,onClick:i,className:"text-blue-600 hover:bg-blue-50",separator:!1},{icon:Pg,label:c>1?`${b.contextMenu.duplicateMultiple} ${c}`:b.contextMenu.duplicate,onClick:d,className:"hover:bg-gray-50",separator:!1},{icon:Nh,label:c>1?`${b.contextMenu.deleteMultiple} ${c}`:b.contextMenu.delete,onClick:s,className:"text-red-600 hover:bg-red-50",separator:!1}]:[]],E={left:Math.min(t,window.innerWidth-250),top:Math.min(e,window.innerHeight-T.length*40)};return C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"fixed inset-0 z-10",onClick:p}),C.jsxs("div",{className:"fixed z-20 bg-white border border-gray-200 rounded-lg shadow-xl py-1 min-w-[200px]",style:E,onClick:N=>N.stopPropagation(),children:[C.jsxs("div",{className:"px-3 py-2 text-xs font-medium text-gray-500 bg-gradient-to-r from-blue-50 to-purple-50",children:[b.contextMenu.header," - ",c," selected"]}),T.map((N,L)=>{const G=N.icon;return C.jsxs("div",{children:[C.jsxs("button",{onClick:Q=>{Q.stopPropagation(),N.onClick(),p()},className:`w-full px-3 py-2 text-left text-sm flex items-center space-x-2 transition-colors ${N.className}`,children:[C.jsx(G,{className:"w-4 h-4 flex-shrink-0"}),C.jsx("span",{className:"flex-1",children:N.label})]}),N.separator&&C.jsx("div",{className:"border-t border-gray-100 my-1"})]},L)})]})]})},Nm=({visible:t,onClose:e,onSubmit:n,selectedCount:c})=>{const p=_n(),[y,w]=fe.useState(""),[d,s]=fe.useState(!1),[u,h]=fe.useState("text"),[r,a]=fe.useState(!1),[i,o]=fe.useState(!1),[f,l]=fe.useState(""),g=fe.useRef(null);fe.useEffect(()=>{const L=window.SpeechRecognition||window.webkitSpeechRecognition;if(L){a(!0);const G=new L;G.continuous=!1,G.interimResults=!1,G.lang="zh-TW",G.onstart=()=>{console.log(" "),s(!0)},G.onresult=Q=>{const Z=Q.results[0][0].transcript;console.log(" :",Z),w(Z),s(!1)},G.onerror=Q=>{console.error(" :",Q.error),s(!1);let Z="Voice recognition failed";switch(Q.error){case"no-speech":Z="No speech detected, please try again";break;case"audio-capture":Z="Cannot access microphone";break;case"not-allowed":Z="Microphone permission denied";break;case"network":Z="Network error, please check connection";break}alert(Z)},G.onend=()=>{console.log(" "),s(!1)},g.current=G}else a(!1),console.warn("");return()=>{g.current&&g.current.stop()}},[]);const m=()=>{if(!(!g.current||d))try{g.current.start()}catch(L){console.error(":",L),alert("Unable to start voice recognition, please try again")}},v=()=>{g.current&&d&&g.current.stop()},x=()=>{y.trim()&&(n(y.trim(),u==="voice"),w(""),e())},S=()=>{d&&v(),w(""),e()},b=L=>{w(L),h("text")},T=()=>{if(!y.trim())return;const L=["","","","",""],G=L[Math.floor(Math.random()*L.length)],Q=y+G;l(Q),o(!0)},E=()=>{w(f),o(!1),l("")},N=()=>{const L=p.nanoBananaPrompt.examples,G=L[Math.floor(Math.random()*L.length)];w(G)};return t?C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:S}),C.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:C.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full max-h-[90vh] flex flex-col",children:[C.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-blue-500 text-white p-4 flex items-center justify-between flex-shrink-0",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(Ya,{className:"w-5 h-5"}),C.jsx("h3",{className:"font-semibold",children:p.nanoBananaPrompt.title})]}),C.jsx("button",{onClick:S,className:"p-1 hover:bg-white hover:bg-opacity-20 rounded transition-colors",children:C.jsx(ns,{className:"w-5 h-5"})})]}),C.jsxs("div",{className:"p-4 space-y-4 overflow-y-auto flex-1",children:[C.jsxs("div",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded",children:[c," ",p.nanoBananaPrompt.selectedObjects]}),C.jsx("div",{className:"text-sm text-purple-700 bg-purple-50 p-3 rounded-lg border border-purple-200",children:C.jsxs("div",{className:"flex items-start space-x-2",children:[C.jsx("span",{className:"text-purple-500",children:""}),C.jsxs("div",{children:[C.jsx("div",{className:"font-medium mb-1",children:p.nanoBananaPrompt.stabilityTip.title}),C.jsx("div",{className:"text-xs",children:p.nanoBananaPrompt.stabilityTip.description})]})]})}),C.jsxs("div",{className:"flex space-x-2",children:[C.jsx("button",{onClick:()=>h("text"),className:`flex-1 p-2 rounded-lg border transition-colors ${u==="text"?"bg-blue-100 border-blue-300 text-blue-700":"bg-gray-50 border-gray-200 text-gray-600"}`,children:p.nanoBananaPrompt.inputModes.text}),C.jsx("button",{onClick:()=>h("voice"),disabled:!r,className:`flex-1 p-2 rounded-lg border transition-colors ${u==="voice"?"bg-purple-100 border-purple-300 text-purple-700":r?"bg-gray-50 border-gray-200 text-gray-600":"bg-gray-100 border-gray-200 text-gray-400 cursor-not-allowed"}`,children:p.nanoBananaPrompt.inputModes.voice})]}),!r&&C.jsx("div",{className:"text-sm text-amber-600 bg-amber-50 p-2 rounded",children:p.nanoBananaPrompt.voiceNotSupported}),u==="voice"&&r&&C.jsxs("div",{className:"space-y-3",children:[C.jsx("div",{className:"text-center",children:C.jsx("button",{onClick:d?v:m,className:`p-4 rounded-full transition-all ${d?"bg-red-500 hover:bg-red-600 text-white animate-pulse":"bg-purple-500 hover:bg-purple-600 text-white"}`,children:d?C.jsx(Lg,{className:"w-6 h-6"}):C.jsx(Fg,{className:"w-6 h-6"})})}),C.jsx("p",{className:"text-center text-sm text-gray-600",children:d?p.nanoBananaPrompt.voiceStatus.listening:p.nanoBananaPrompt.voiceStatus.clickToStart})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700",children:p.nanoBananaPrompt.promptLabel}),C.jsxs("div",{className:"flex space-x-2",children:[C.jsxs("button",{onClick:T,disabled:!y.trim(),className:`text-xs px-2 py-1 rounded-lg transition-colors ${y.trim()?"bg-purple-100 text-purple-700 hover:bg-purple-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:[C.jsx(en,{className:"w-3 h-3 inline mr-1"}),""]}),C.jsxs("button",{onClick:N,className:"text-xs px-2 py-1 bg-green-100 text-green-700 hover:bg-green-200 rounded-lg transition-colors",children:[C.jsx(Wg,{className:"w-3 h-3 inline mr-1"}),""]})]})]}),C.jsx("textarea",{value:y,onChange:L=>w(L.target.value),placeholder:p.nanoBananaPrompt.promptPlaceholder,className:"w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3}),i&&f&&C.jsx("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-3",children:C.jsxs("div",{className:"flex items-start space-x-2",children:[C.jsx(Dg,{className:"w-4 h-4 text-purple-600 mt-0.5 flex-shrink-0"}),C.jsxs("div",{className:"flex-1",children:[C.jsx("div",{className:"text-sm font-medium text-purple-700 mb-1",children:""}),C.jsx("div",{className:"text-sm text-purple-600 mb-3",children:f}),C.jsxs("div",{className:"flex space-x-2",children:[C.jsxs("button",{onClick:E,className:"text-xs px-3 py-1 bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors",children:[C.jsx(Hg,{className:"w-3 h-3 inline mr-1"}),""]}),C.jsx("button",{onClick:()=>o(!1),className:"text-xs px-3 py-1 bg-gray-200 text-gray-600 rounded hover:bg-gray-300 transition-colors",children:""})]})]})]})})]}),C.jsxs("div",{className:"space-y-2",children:[C.jsx("label",{className:"block text-sm font-medium text-gray-700",children:p.nanoBananaPrompt.quickExamples}),C.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-32 overflow-y-auto",children:p.nanoBananaPrompt.examples.map((L,G)=>C.jsxs("button",{onClick:()=>b(L),className:"p-2 text-xs bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg hover:from-blue-100 hover:to-purple-100 transition-all text-left flex items-center",children:[C.jsx(Ya,{className:"w-3 h-3 text-blue-500 mr-2 flex-shrink-0"}),C.jsx("span",{className:"truncate",children:L})]},G))})]})]}),C.jsxs("div",{className:"flex justify-end space-x-3 p-4 border-t bg-gray-50 flex-shrink-0",children:[C.jsx("button",{onClick:S,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:p.nanoBananaPrompt.cancel}),C.jsxs("button",{onClick:x,disabled:!y.trim(),className:`px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors ${y.trim()?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[C.jsx(Gg,{className:"w-4 h-4"}),C.jsx("span",{children:p.nanoBananaPrompt.submit})]})]})]})})]}):null},Lm={width:5e3,height:5e3,backgroundColor:"#ffffff",selection:!0,renderOnAddRemove:!0,centeredScaling:!0,centeredRotation:!0},Fm=()=>{const t=fe.useRef(null),e=fe.useRef(null),[n,c]=fe.useState({visible:!1,x:0,y:0,selectedObjects:[]}),[p,y]=fe.useState({visible:!1,selectedObjects:[]}),[w,d]=fe.useState({x:0,y:0}),[s,u]=fe.useState({x:0,y:0}),[h,r]=fe.useState(!1),a=()=>{i&&(i.absolutePan(new Ae.fabric.Point(0,0)),i.setZoom(1),N(1),i.renderAll())},{canvas:i,setCanvas:o,tool:f,brushSize:l,brushColor:g,setIsDrawing:m,addToHistory:v,importImage:x,zoom:S,zoomIn:b,zoomOut:T,resetView:E,setZoom:N}=ki(),{setCanvas:L,selectImage:G,isMultiSelectMode:Q}=Vo();fe.useEffect(()=>{if(!t.current||!e.current)return;const I=new Ae.fabric.Canvas(t.current,{...Lm,width:e.current.clientWidth,height:e.current.clientHeight,selection:!0,preserveObjectStacking:!0,fireRightClick:!0,fireMiddleClick:!0,skipTargetFind:!1,targetFindTolerance:4,perPixelTargetFind:!1,uniformScaling:!0,stopContextMenu:!1,selectionBorderColor:"rgba(46, 115, 252, 0.8)",selectionLineWidth:2,selectionDashArray:[5,5]});I.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),I.selection=!0,I.preserveObjectStacking=!0,console.log("Canvas initialized with multi-selection enabled:",I.selection),I.on("object:added",J=>{const ie=J.target;console.log(" Object added to canvas:",ie.type),ie&&typeof ie.set=="function"&&(ie.set({selectable:!0,evented:!0,hasControls:!0,hasBorders:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,hoverCursor:"move",moveCursor:"move"}),console.log(" Object configured for selection:",ie.type,"selectable:",ie.selectable))}),I.setWidth(e.current.clientWidth),I.setHeight(e.current.clientHeight),I.freeDrawingBrush=new Ae.fabric.PencilBrush(I),I.freeDrawingBrush.width=l,I.freeDrawingBrush.color=g,o(I),L(I);let j=null;const R=()=>{I._skipHistory||(j&&clearTimeout(j),j=setTimeout(()=>{const J=JSON.stringify(I.toJSON());v(J)},300))};I.on("path:created",J=>{console.log(" Path created"),R()}),I.on("object:modified",R),I.on("selection:created",J=>{var ie;console.log(" Selection created:",((ie=J.selected)==null?void 0:ie.length)||0,"objects"),J.selected&&J.selected.forEach(he=>{console.log("  - Selected object type:",he.type)}),Q&&J.selected&&J.selected.forEach(he=>{if(he.type==="image"){const de=he.imageId||`img_${he.cacheKey}`;G(de,!0)}})}),I.on("selection:updated",J=>{var ie;console.log(" Selection updated:",((ie=J.selected)==null?void 0:ie.length)||0,"objects"),J.selected&&J.selected.forEach(he=>{console.log("  - Updated selection object type:",he.type)})}),I.on("selection:cleared",()=>{console.log(" Selection cleared"),c(J=>({...J,selectedObjects:[]}))}),I.on("mouse:down",J=>{const ie=J.e;if(console.log(" Mouse down - Button:",ie.button,"Shift:",ie.shiftKey,"Ctrl:",ie.ctrlKey,"Cmd:",ie.metaKey),m(!0),ie.button===2){console.log(" RIGHT CLICK DETECTED! Preventing default..."),ie.preventDefault(),ie.stopPropagation();const he=I.getActiveObject(),de=he?[he]:[];if(he&&he.type==="activeSelection"){const Se=he;de.length=0,Se.forEachObject(Ce=>de.push(Ce))}console.log(" SHOWING CONTEXT MENU! activeObject:",he,"selectedObjects:",de.length),c({visible:!0,x:ie.clientX,y:ie.clientY,selectedObjects:de})}else{c(de=>({...de,visible:!1}));const he=I.findTarget(ie,!1);console.log(" Target found:",(he==null?void 0:he.type)||"none"),ie.shiftKey&&!he?(console.log(" Starting pan mode (Shift+drag on empty space)"),se=!0,I.isDragging=!0,I.selection=!1,V=ie.clientX,ce=ie.clientY):(console.log(" Ensuring selection is enabled for multi-selection"),I.selection=!0,I.isDragging=!1,(ie.ctrlKey||ie.metaKey)&&console.log(" Ctrl/Cmd detected - multi-selection should work!"))}}),I.on("mouse:up",()=>{m(!1),se&&(console.log(" Ending pan mode"),se=!1,I.isDragging=!1,I.selection=!0)});const U=I.getElement(),z=U.parentElement,H=J=>(console.log(" PREVENTING CONTEXT MENU on:",J.target),J.preventDefault(),J.stopPropagation(),!1);U.addEventListener("contextmenu",H),z&&z.addEventListener("contextmenu",H),e.current&&e.current.addEventListener("contextmenu",H);const ee=()=>{e.current&&(I.setDimensions({width:e.current.clientWidth,height:e.current.clientHeight}),I.renderAll())};window.addEventListener("resize",ee);const ae=J=>{const ie=J.e;if(ie.ctrlKey||ie.metaKey){ie.preventDefault();const he=ie.deltaY;let de=I.getZoom();de*=.999**he,de>5&&(de=5),de<.1&&(de=.1);const Se=new Ae.fabric.Point(J.e.offsetX,J.e.offsetY);I.zoomToPoint(Se,de),N(de)}};I.on("mouse:wheel",ae);let se=!1,V=0,ce=0;return I.on("mouse:move",J=>{const ie=I.getPointer(J.e);d({x:Math.round(ie.x),y:Math.round(ie.y)});const he=I.getCenter();if(u({x:Math.round(he.left),y:Math.round(he.top)}),se){const de=J.e,Se=I.viewportTransform;Se[4]+=de.clientX-V,Se[5]+=de.clientY-ce,I.requestRenderAll(),V=de.clientX,ce=de.clientY}}),I.on("mouse:wheel",J=>{const ie=J.e;if(!ie.ctrlKey&&!ie.metaKey){ie.preventDefault();const he=I.viewportTransform;he[4]-=ie.deltaX||0,he[5]-=ie.deltaY||0,I.requestRenderAll()}}),()=>{window.removeEventListener("resize",ee),I.dispose()}},[]),fe.useEffect(()=>{i&&i.freeDrawingBrush&&(i.freeDrawingBrush.width=l,i.freeDrawingBrush.color=g),console.log(" Canvas tool changed to:",f)},[i,l,g,f]),fe.useEffect(()=>{const I=j=>{if(i){if((j.ctrlKey||j.metaKey)&&["z","y","a","c","v","x","+","-","=","0"].includes(j.key.toLowerCase())&&j.preventDefault(),(j.ctrlKey||j.metaKey)&&j.key==="z"&&!j.shiftKey)ki.getState().undo();else if((j.ctrlKey||j.metaKey)&&j.key==="y"||(j.ctrlKey||j.metaKey)&&j.shiftKey&&j.key==="Z")ki.getState().redo();else if((j.ctrlKey||j.metaKey)&&j.key==="a"){const R=i.getObjects();i.discardActiveObject();const U=new Ae.fabric.ActiveSelection(R,{canvas:i});i.setActiveObject(U),i.requestRenderAll()}else if((j.ctrlKey||j.metaKey)&&(j.key==="+"||j.key==="="))b();else if((j.ctrlKey||j.metaKey)&&j.key==="-")T();else if((j.ctrlKey||j.metaKey)&&j.key==="0")E();else if(j.key==="Delete"||j.key==="Backspace"){const R=document.activeElement;if(!(R&&(R.tagName==="INPUT"||R.tagName==="TEXTAREA"||R.getAttribute("contenteditable")==="true"))){const z=i.getActiveObject();z&&(z.type==="activeSelection"?(z.forEachObject(ee=>{i.remove(ee)}),i.discardActiveObject()):i.remove(z),i.requestRenderAll())}}}};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[i]);const Z=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(U=>U.type==="image").map(U=>{var z;return((z=U._originalElement)==null?void 0:z.src)||U.src}).filter(Boolean);if(I.length<2){alert(" 2 ");return}const j=window.prompt("","");if(!j)return;const R=await Xe.mergeImages(I,j);await x(R),alert("")}catch(I){console.error(":",I),alert(": "+I)}},te=async()=>{var R;if(n.selectedObjects.length===0)return;const I=n.selectedObjects.find(U=>U.type==="image");if(!I){alert("");return}const j=window.prompt("","");if(j)try{const U=((R=I._originalElement)==null?void 0:R.src)||I.src,z=await Xe.transferStyle({imageUrl:U,style:j});await x(z),alert("")}catch(U){alert(": "+U)}},K=()=>{!i||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{I.clone(j=>{j.set({left:(j.left||0)+20,top:(j.top||0)+20}),i.add(j)})}),i.renderAll())},ne=()=>{!i||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{i.remove(I)}),i.renderAll())},le=()=>{!i||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{i.bringToFront(I)}),i.renderAll())},Y=()=>{!i||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{i.sendToBack(I)}),i.renderAll())},_=()=>{!i||n.selectedObjects.length===0||(n.selectedObjects.forEach(I=>{const j=I.angle||0;I.set({angle:j+90})}),i.renderAll())},O=async()=>{var j;if(n.selectedObjects.length===0)return;console.log(" Generating similar images from selected objects:",n.selectedObjects.length);const I="Generate a very similar object or item with the same category, style, and visual characteristics. Keep the same type of object, similar colors, materials, and overall appearance. Maintain the same scene context and background style.";try{const R=M(" Analyzing selected objects and generating similar content...",1),U=[];for(const H of n.selectedObjects)if(H.type==="image"){const ee=H;let ae;ee.getSrc&&typeof ee.getSrc=="function"?ae=ee.getSrc():(j=H._originalElement)!=null&&j.src?ae=H._originalElement.src:H.src&&(ae=H.src),typeof ae=="string"&&ae.length>0&&U.push(ae)}if(U.length===0){B(),alert("Please select at least one image to generate similar content");return}console.log(" Using images for similarity generation:",U.length);const z=await Xe.generateSimilar({images:U,prompt:`Create an image of the exact same type of object/item as shown in the reference image(s). If it's sunglasses, generate different sunglasses. If it's a car, generate a different car. ${I}. Do NOT change the object category - keep it as the same type of item but with variations in design, color, or style.`,aspectRatio:"1:1"});B(),z?(await x(z),console.log(" Similar image generated and added to canvas!")):(console.error(" No image generated from similarity API"),alert("Failed to generate similar image - no result returned"))}catch(R){console.error(" Generate similar error:",R),B(),alert("Failed to generate similar image: "+R)}},A=async()=>{if(!(!i||n.selectedObjects.length===0)){console.log(" Exporting selected objects:",n.selectedObjects.length);try{let I=1/0,j=1/0,R=-1/0,U=-1/0;n.selectedObjects.forEach(J=>{const ie=J.getBoundingRect(!0);I=Math.min(I,ie.left),j=Math.min(j,ie.top),R=Math.max(R,ie.left+ie.width),U=Math.max(U,ie.top+ie.height)});const z=20,H=R-I+z*2,ee=U-j+z*2;console.log(" Export bounds:",{minX:I,minY:j,maxX:R,maxY:U,exportWidth:H,exportHeight:ee,objectCount:n.selectedObjects.length});const ae=document.createElement("canvas");ae.width=H,ae.height=ee;const se=new Ae.fabric.Canvas(ae);se.setWidth(H),se.setHeight(ee),se.backgroundColor="transparent";const V=ae.getContext("2d");V&&V.clearRect(0,0,H,ee);const ce=n.selectedObjects.map(J=>new Promise(ie=>{J.clone(he=>{const de=J.getBoundingRect(!0),Se=de.left-I+z,Ce=de.top-j+z,kt=J.left||0,on=J.top||0,st=de.left+de.width/2,bs=de.top+de.height/2;if(he.set({left:Se+(kt-st)+de.width/2,top:Ce+(on-bs)+de.height/2,scaleX:J.scaleX,scaleY:J.scaleY,angle:J.angle,flipX:J.flipX,flipY:J.flipY,skewX:J.skewX,skewY:J.skewY,opacity:J.opacity}),he.type==="image"){const dt=he;if(dt._originalElement){const Rt=document.createElement("canvas"),ri=Rt.getContext("2d");if(ri&&dt._originalElement){Rt.width=dt._originalElement.width||dt.width||100,Rt.height=dt._originalElement.height||dt.height||100,ri.clearRect(0,0,Rt.width,Rt.height),ri.drawImage(dt._originalElement,0,0);const Zi=new Image;Zi.crossOrigin="anonymous",Zi.onload=()=>{dt.setElement(Zi),se.add(he),console.log(" Cloned image with transparency preserved:",he.type,"from",J.left,J.top,"to",he.left,he.top),ie()},Zi.src=Rt.toDataURL("image/png");return}}}se.add(he),console.log(" Cloned object:",he.type,"from",J.left,J.top,"to",he.left,he.top),ie()})}));await Promise.all(ce),se.renderAll(),setTimeout(()=>{const J=se.toDataURL({format:"png",quality:1,multiplier:2,enableRetinaScaling:!1,withoutTransform:!1,backgroundColor:"transparent"});if(J&&J!=="data:,"){const ie=document.createElement("a");ie.download=`selected-objects-${Date.now()}.png`,ie.href=J,document.body.appendChild(ie),ie.click(),document.body.removeChild(ie),console.log(" Export completed successfully")}else console.error(" Failed to generate image data"),alert("");se.dispose()},500)}catch(I){console.error(" Export error:",I),alert(""+I)}}},M=(I,j=0)=>{if(!i)return null;const R=i.viewportTransform,U=i.getZoom(),z=i.getElement().parentElement,H=(z==null?void 0:z.clientWidth)||i.getWidth(),ee=(z==null?void 0:z.clientHeight)||i.getHeight(),ae=Ae.fabric.util.transformPoint({x:H/2,y:ee/2},Ae.fabric.util.invertTransform(R));console.log(" PROGRESS INDICATOR optimized center:",{centerPoint:{x:ae.x.toFixed(0),y:ae.y.toFixed(0)},containerSize:{width:H,height:ee},zoom:U,vpt:R});const se=`
      <svg width="300" height="120" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="progress-bg" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#1e293b;stop-opacity:0.95" />
            <stop offset="100%" style="stop-color:#334155;stop-opacity:0.95" />
          </linearGradient>
          <linearGradient id="progress-bar" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
          </linearGradient>
          <filter id="glow">
            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>

        <!-- Background with modern styling -->
        <rect width="100%" height="100%" rx="16" fill="url(#progress-bg)" stroke="#64748b" stroke-width="1"/>

        <!-- Spinner -->
        <circle cx="60" cy="60" r="18" fill="none" stroke="#3b82f6" stroke-width="3" stroke-linecap="round" opacity="0.3"/>
        <circle cx="60" cy="60" r="18" fill="none" stroke="#60a5fa" stroke-width="3" stroke-linecap="round"
                stroke-dasharray="56.5" stroke-dashoffset="56.5">
          <animate attributeName="stroke-dasharray" values="0 56.5;42 14.5;42 14.5;0 56.5" dur="1.5s" repeatCount="indefinite"/>
          <animate attributeName="stroke-dashoffset" values="0;-14.5;-28.5;-42.5" dur="1.5s" repeatCount="indefinite"/>
        </circle>

        <!-- Message -->
        <text x="110" y="55" fill="#f1f5f9" font-family="system-ui, -apple-system, sans-serif" font-size="13" font-weight="500">
          ${I}
        </text>

        <!-- Progress bar -->
        <rect x="110" y="70" width="160" height="6" rx="3" fill="rgba(255,255,255,0.1)"/>
        <rect x="110" y="70" width="${Math.max(6,j*160)}" height="6" rx="3" fill="url(#progress-bar)" filter="url(#glow)">
          <animate attributeName="width" values="${j*160};${Math.min(160,(j+.1)*160)};${j*160}" dur="2s" repeatCount="indefinite"/>
        </rect>

        <!-- Percentage -->
        <text x="280" y="85" fill="#94a3b8" font-family="system-ui, -apple-system, sans-serif" font-size="11" text-anchor="end">
          ${Math.round(j*100)}%
        </text>
      </svg>
    `,V=`data:image/svg+xml,${encodeURIComponent(se)}`;return new Promise(ce=>{Ae.fabric.Image.fromURL(V,J=>{J&&(J.set({left:ae.x,top:ae.y,originX:"center",originY:"center",selectable:!1,evented:!1,isProgressImage:!0,scaleX:1/U,scaleY:1/U}),i.add(J),i.bringToFront(J),i.renderAll(),ce(J))})})},B=()=>{if(!i)return;i.getObjects().filter(j=>j.isProgressImage).forEach(j=>i.remove(j)),i.renderAll()},P=async(I,j,R)=>{if(!(!i||!I))return i.remove(I),await M(j,R)},k=async()=>{if(n.selectedObjects.length<2)return;let I,j=null;try{const R=n.selectedObjects.filter(z=>z.type==="image").map(z=>{var H;return((H=z._originalElement)==null?void 0:H.src)||z.src}).filter(Boolean);if(R.length<2){alert("Please select at least 2 images for AI composition");return}c(z=>({...z,visible:!1})),j=await M(`Analyzing ${R.length} images`,.1),I=setTimeout(()=>{console.warn(" Progress timeout - removing progress image"),B(),alert("AI processing took too long - please try again")},3e4),setTimeout(async()=>{j&&(j=await P(j,"AI is composing your masterpiece",.4))},1e3),setTimeout(async()=>{j&&(j=await P(j,"Rendering high-quality result",.7))},2e3);const U=await Xe.mergeImages(R,"Intelligent auto-compose - merge the key subjects and elements naturally into a cohesive, professional composition");clearTimeout(I),j&&(j=await P(j,"Adding final touches",.9)),setTimeout(async()=>{try{B(),await x(U),console.log(` AI Smart Composition completed! Merged ${R.length} images intelligently.`)}catch(z){console.error("Failed to import generated image:",z),B(),alert("Image generation completed but failed to display on canvas: "+z)}},500)}catch(R){console.error("AI Composition failed:",R),I&&clearTimeout(I),B(),alert("AI Composition failed: "+R)}},D=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(R=>R.type==="image").map(R=>{var U;return((U=R._originalElement)==null?void 0:U.src)||R.src}).filter(Boolean);if(I.length<2)return;c(R=>({...R,visible:!1}));const j=await Xe.mergeImages(I,"Make the person wear or use the accessories/items naturally. Ensure realistic lighting, shadows, and proportions.");await x(j),alert(" Accessory composition completed! Items naturally integrated.")}catch(I){console.error("Accessory composition failed:",I),alert("Accessory composition failed: "+I)}},F=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(R=>R.type==="image").map(R=>{var U;return((U=R._originalElement)==null?void 0:U.src)||R.src}).filter(Boolean);if(I.length<2)return;c(R=>({...R,visible:!1}));const j=await Xe.mergeImages(I,"Create a realistic scene by placing subjects into backgrounds naturally. Match lighting, shadows, and perspective perfectly.");await x(j),alert(" Scene integration completed! Objects naturally placed in scene.")}catch(I){console.error("Scene composition failed:",I),alert("Scene composition failed: "+I)}},X=async()=>{if(!(n.selectedObjects.length<2))try{const I=n.selectedObjects.filter(R=>R.type==="image").map(R=>{var U;return((U=R._originalElement)==null?void 0:U.src)||R.src}).filter(Boolean);if(I.length<2)return;c(R=>({...R,visible:!1}));const j=await Xe.mergeImages(I,"Create an artistic, creative blend that combines the best elements from all images in an innovative and visually stunning way.");await x(j),alert(" Creative blend completed! Innovative artistic fusion created.")}catch(I){console.error("Creative blend failed:",I),alert("Creative blend failed: "+I)}},W=()=>{if(!i||n.selectedObjects.length<=1)return;const I=new Ae.fabric.Group(n.selectedObjects,{left:Math.min(...n.selectedObjects.map(j=>j.left||0)),top:Math.min(...n.selectedObjects.map(j=>j.top||0))});n.selectedObjects.forEach(j=>i.remove(j)),i.add(I),i.setActiveObject(I),i.renderAll()},$=()=>{n.selectedObjects.length!==0&&(console.log(" Opening voice prompt modal for",n.selectedObjects.length,"objects"),y({visible:!0,selectedObjects:[...n.selectedObjects]}),c(I=>({...I,visible:!1})))},q=async(I,j)=>{if(!I.trim()||p.selectedObjects.length===0)return;let R=null;try{console.log(" Processing voice/text prompt:",I),console.log(" Selected objects:",p.selectedObjects.length),R=await M(j?" Processing voice command...":" Processing text command...",.1);const U=p.selectedObjects.filter(ae=>ae.type==="image").map(ae=>{var ce;const se=ae;let V;if(se.getSrc&&typeof se.getSrc=="function"?V=se.getSrc():(ce=ae._originalElement)!=null&&ce.src?V=ae._originalElement.src:ae.src&&(V=ae.src),typeof V=="string"&&V.length>0)try{return typeof V.indexOf=="function"?V:(console.warn("String URL does not support indexOf method:",typeof V),null)}catch(J){return console.warn("Error validating image URL:",J),null}return console.warn("URL:",ae),null}).filter(ae=>typeof ae=="string"&&ae.length>0);if(console.log(" URLs:",U),U.length===0){B(),alert("");return}R&&(R=await P(R,"AI ...",.4));let z;if(U.length===1){console.log(" Single image voice command processing");const ae=U[0];if(console.log(" Debug - imageUrl type:",typeof ae,"value:",ae),typeof ae!="string")throw new Error(`Invalid imageUrl type: expected string, got ${typeof ae}`);z=await Xe.imageToImage({imageUrl:ae,prompt:`${I}. IMPORTANT: Preserve the exact features, identity, and characteristics of ALL main subjects and objects in the image (people, furniture, vehicles, animals, products, etc.). Maintain the original style, quality, shape, texture, color, and distinctive details of all important elements while making only the requested changes naturally. Keep the core identity and recognizable features of every main object completely consistent.`,strength:.5,width:512,height:512})}else{console.log(" Multi-image voice command processing"),console.log(" Debug - imageUrls types:",U.map((se,V)=>`[${V}]: ${typeof se}`)),console.log(" Debug - imageUrls values:",U.map((se,V)=>`[${V}]: ${se}`));const ae=U.filter(se=>typeof se!="string");if(ae.length>0)throw new Error(`Invalid imageUrl types in array: ${ae.map(se=>typeof se).join(", ")}`);z=await Xe.mergeImages(U,`${I}. IMPORTANT: Preserve the exact features, identity, and characteristics of ALL main subjects and objects in all images (people, furniture, vehicles, animals, products, etc.). Maintain consistent shape, texture, color, distinctive details, and core identity of every important element. Apply this instruction to combine and edit the images naturally while keeping all main subjects and objects completely recognizable and stable.`)}R&&(R=await P(R," Finalizing your creation...",.9));const H=typeof z=="string"?z:z.url;if(console.log(" Debug - final imageUrl type:",typeof H,"value:",typeof H=="string"?H.substring(0,50)+"...":H),typeof H!="string")throw new Error(`Invalid final imageUrl type: expected string, got ${typeof H}`);await x(H),B(),console.log(" Voice/text command completed successfully!");const ee=j?` ${I}`:` ${I}`;setTimeout(()=>{alert(ee)},500)}catch(U){console.error(" Voice/text prompt failed:",U),console.error(" Error details:",{message:U.message,stack:U.stack,name:U.name}),B();let z=j?"":"";U.message&&U.message.includes("indexOf")?z+=": ":U.message?z+=`: ${U.message}`:z+=`: ${U}`,alert(z)}},oe=()=>{y({visible:!1,selectedObjects:[]})};return C.jsxs("div",{ref:e,className:"canvas-container flex-1 relative",onContextMenu:I=>(console.log(" CONTAINER RIGHT CLICK!"),I.preventDefault(),I.stopPropagation(),!1),onMouseDown:I=>{console.log(" CONTAINER MOUSE DOWN - Button:",I.button),I.button===2&&(console.log(" CONTAINER RIGHT CLICK DETECTED!"),I.preventDefault(),I.stopPropagation(),c({visible:!0,x:I.clientX,y:I.clientY,selectedObjects:(i==null?void 0:i.getActiveObjects())||[]}))},children:[C.jsx("canvas",{ref:t}),C.jsx("div",{className:"absolute top-4 left-4 md:top-4 md:right-4 md:left-auto bg-white bg-opacity-90 rounded-lg px-2 md:px-3 py-1.5 md:py-2 shadow-lg border border-gray-200 z-10",children:C.jsxs("div",{className:"space-y-1 text-xs text-gray-600",children:[C.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[C.jsx("span",{className:"hidden md:inline",children:" Mouse:"}),C.jsx("span",{className:"md:hidden",children:""}),C.jsxs("span",{className:"font-mono bg-gray-100 px-1.5 md:px-2 py-0.5 rounded text-xs",children:["x:",w.x," y:",w.y]})]}),C.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[C.jsx("span",{className:"hidden md:inline",children:" Center:"}),C.jsx("span",{className:"md:hidden",children:""}),C.jsxs("span",{className:"font-mono bg-blue-100 px-1.5 md:px-2 py-0.5 rounded text-xs",children:["x:",s.x," y:",s.y]})]}),C.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[C.jsxs("button",{onClick:a,className:"text-xs px-1.5 md:px-2 py-1 bg-green-100 hover:bg-green-200 active:bg-green-300 text-green-700 rounded transition-colors touch-manipulation",title:"Go to origin (0,0)",children:[C.jsx("span",{className:"hidden md:inline",children:" Origin"}),C.jsx("span",{className:"md:hidden",children:""})]}),C.jsxs("button",{onClick:()=>r(!h),className:`text-xs px-1.5 md:px-2 py-1 rounded transition-colors touch-manipulation ${h?"bg-purple-200 text-purple-700":"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-700"}`,title:"Toggle grid",children:[C.jsx("span",{className:"hidden md:inline",children:" Grid"}),C.jsx("span",{className:"md:hidden",children:""})]})]})]})}),C.jsxs("div",{className:"absolute bottom-4 right-4 flex items-center space-x-1 md:space-x-2",children:[C.jsx("button",{onClick:T,className:"bg-white bg-opacity-90 hover:bg-opacity-100 active:bg-gray-100 rounded p-2 md:p-2.5 text-gray-600 transition-all shadow-md touch-manipulation",title:"Zoom out (Ctrl+Mouse wheel)",children:C.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:C.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})})}),C.jsxs("button",{onClick:E,className:"bg-white bg-opacity-90 hover:bg-opacity-100 active:bg-gray-100 rounded px-2 md:px-3 py-1 md:py-1.5 text-xs md:text-sm text-gray-600 min-w-[50px] md:min-w-[60px] transition-all shadow-md touch-manipulation font-mono",title:"Reset zoom and pan",children:[Math.round(S*100),"%"]}),C.jsx("button",{onClick:b,className:"bg-white bg-opacity-90 hover:bg-opacity-100 active:bg-gray-100 rounded p-2 md:p-2.5 text-gray-600 transition-all shadow-md touch-manipulation",title:"Zoom in (Ctrl+Mouse wheel)",children:C.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:C.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})})})]}),C.jsx("div",{className:"absolute bottom-4 left-4 bg-white bg-opacity-90 rounded-lg px-3 py-2 text-xs text-gray-600 shadow-lg border border-gray-200",children:C.jsxs("div",{className:"space-y-1",children:[C.jsxs("div",{children:[" ",C.jsx("kbd",{className:"px-1 py-0.5 bg-gray-100 rounded text-xs",children:"Cmd"})," + Trackpad: Zoom"]}),C.jsx("div",{children:" Trackpad: Move canvas"}),C.jsxs("div",{children:[" ",C.jsx("kbd",{className:"px-1 py-0.5 bg-blue-100 rounded text-xs",children:"Shift"})," + Click: Multi-select"]}),C.jsxs("div",{children:[" ",C.jsx("kbd",{className:"px-1 py-0.5 bg-purple-100 rounded text-xs",children:"Cmd"})," + Click: Add/Remove selection"]})]})}),C.jsx(Dm,{x:n.x,y:n.y,visible:n.visible,selectedCount:n.selectedObjects.length,onClose:()=>c(I=>({...I,visible:!1})),onMergeImages:Z,onStyleTransfer:te,onDuplicate:K,onDelete:ne,onBringToFront:le,onSendToBack:Y,onRotate:_,onGenerateSimilar:O,onExportSelected:A,onIntelligentCompose:k,onWearAccessory:D,onSceneCompose:F,onCreativeBlend:X,onGroupSelection:W,onVoicePrompt:$}),C.jsx(Nm,{visible:p.visible,selectedCount:p.selectedObjects.length,onClose:oe,onSubmit:q})]})},Rm=[],zm=()=>{fe.useState(!1);const{tool:t,setTool:e,undo:n,redo:c,canUndo:p,canRedo:y,clearCanvas:w,getSelectedImages:d}=ki(),{addImages:s}=Vo(),u=r=>{e(r)},h=()=>{const r=document.createElement("input");r.type="file",r.accept="image/*",r.multiple=!0,r.onchange=async a=>{const i=a.target.files;i&&i.length>0&&await s(i,{autoArrange:i.length>1,spacing:20,maxWidth:200,maxHeight:200})},r.click()};return C.jsx("div",{className:"tool-panel relative",children:C.jsxs("div",{className:"w-12 md:w-16 flex flex-col items-center py-2 md:py-4 space-y-1 md:space-y-2",children:[C.jsx("div",{className:"flex flex-col space-y-1",children:C.jsx("button",{onClick:h,className:"w-8 h-8 md:w-10 md:h-10 rounded-lg bg-blue-100 hover:bg-blue-200 active:bg-blue-300 text-blue-600 flex items-center justify-center transition-all duration-200 touch-manipulation",title:"Import Multiple Images",children:C.jsx(Ah,{className:"w-4 h-4 md:w-5 md:h-5"})})}),C.jsx("div",{className:"w-6 md:w-8 h-px bg-gray-300 my-1 md:my-2"}),C.jsx("div",{className:"flex flex-col space-y-1",children:Rm.map(r=>{const a=r.icon,i=t===r.id;return C.jsx("button",{onClick:()=>u(r.id),className:`
                w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center transition-all duration-200 touch-manipulation
                ${i?"bg-primary-600 text-white shadow-md":"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-600"}
              `,title:`${r.label} (${r.shortcut})`,children:C.jsx(a,{className:"w-4 h-4 md:w-5 md:h-5"})},r.id)})}),C.jsxs("div",{className:"flex flex-col space-y-1",children:[C.jsx("button",{onClick:n,disabled:!p(),className:`
            w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center transition-all duration-200 touch-manipulation
            ${p()?"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Undo (Ctrl+Z)",children:C.jsx(Vg,{className:"w-4 h-4 md:w-5 md:h-5"})}),C.jsx("button",{onClick:c,disabled:!y(),className:`
            w-8 h-8 md:w-10 md:h-10 rounded-lg flex items-center justify-center transition-all duration-200 touch-manipulation
            ${y()?"bg-gray-100 hover:bg-gray-200 active:bg-gray-300 text-gray-600":"bg-gray-50 text-gray-300 cursor-not-allowed"}
          `,title:"Redo (Ctrl+Y)",children:C.jsx(zg,{className:"w-4 h-4 md:w-5 md:h-5"})})]}),C.jsx("div",{className:"w-6 md:w-8 h-px bg-gray-300 my-1 md:my-2"}),C.jsx("div",{className:"flex flex-col space-y-1",children:C.jsx("button",{onClick:w,className:"w-8 h-8 md:w-10 md:h-10 rounded-lg bg-red-100 hover:bg-red-200 active:bg-red-300 text-red-600 flex items-center justify-center transition-all duration-200 touch-manipulation",title:"Clear Canvas",children:C.jsx(Nh,{className:"w-4 h-4 md:w-5 md:h-5"})})})]})})},$a=[{id:"figurine",category:"creative",icon:"",previewImage:"https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=600&h=400&fit=crop&q=80",withSelection:{en:"Transform the person from the reference image into a hyper-realistic 1/7 scale figurine, placed on an iMac computer desk with a white Apple keyboard. The figurine perfectly captures the person's appearance, clothing, and personality. The figurine stands on a transparent acrylic base. The iMac screen shows the ZBrush modeling process. Next to it is a packaging box designed to match the person's style theme.","zh-TW":"1/7iMacAppleiMacZBrush",es:"Transforma a la persona de la imagen de referencia en una figurita hiperrealista a escala 1/7, colocada en un escritorio de iMac con un teclado Apple blanco. La figurita captura perfectamente la apariencia, ropa y personalidad de la persona. La figurita est sobre una base acrlica transparente. La pantalla del iMac muestra el proceso de modelado en ZBrush. Junto a ella hay una caja de embalaje diseada para coincidir con el tema de estilo de la persona.",ja:"AppleiMac1/7iMacZBrush",fr:"Transformez la personne de l'image de rfrence en une figurine hyperraliste  l'chelle 1/7, place sur un bureau iMac avec un clavier Apple blanc. La figurine capture parfaitement l'apparence, les vtements et la personnalit de la personne. La figurine se dresse sur une base acrylique transparente. L'cran iMac affiche le processus de modlisation ZBrush.  ct se trouve une bote d'emballage conue pour correspondre au thme de style de la personne."},withoutSelection:{en:"Create an exquisite anime character 1/7 scale figurine, placed on a work desk, professional studio lighting, showcasing figurine details.","zh-TW":"1/7",es:"Crea una exquisita figurita de personaje de anime a escala 1/7, colocada en un escritorio de trabajo, iluminacin de estudio profesional, mostrando los detalles de la figurita.",ja:"1/7",fr:"Crez une figurine de personnage d'anime exquise  l'chelle 1/7, place sur un bureau de travail, clairage de studio professionnel, mettant en valeur les dtails de la figurine."}},{id:"handDrawn",category:"creative",icon:"",previewImage:"https://images.unsplash.com/photo-1609845234176-c1b46ccc3ecc?w=600&h=400&fit=crop&q=80",withSelection:{en:"Transform the image into a 4-stage hand-drawn illustration process: 1. Pencil sketch outline 2. Add basic lines 3. Add details and shadows 4. Complete color illustration. Show the drawing steps from sketch to finished artwork.","zh-TW":"41. 2. 3. 4.",es:"Transforma la imagen en un proceso de ilustracin dibujada a mano de 4 etapas: 1. Contorno de boceto a lpiz 2. Agregar lneas bsicas 3. Agregar detalles y sombras 4. Ilustracin completa en color. Muestra los pasos de dibujo desde el boceto hasta la obra terminada.",ja:"41. 2. 3. 4.",fr:"Transformez l'image en un processus d'illustration dessine  la main en 4 tapes : 1. Contour de croquis au crayon 2. Ajouter des lignes de base 3. Ajouter des dtails et des ombres 4. Illustration couleur complte. Montrez les tapes de dessin du croquis  l'uvre finie."},withoutSelection:{en:"Create a character's 4-stage hand-drawing process, from simple sketch to complete color illustration","zh-TW":"4",es:"Crea el proceso de dibujo a mano de 4 etapas de un personaje, desde un boceto simple hasta una ilustracin completa en color",ja:"4",fr:"Crez le processus de dessin  la main en 4 tapes d'un personnage, du croquis simple  l'illustration couleur complte"}},{id:"crossSection",category:"creative",icon:"",withSelection:{en:"Create a 3D cross-section diagram of the object, showing internal structure and components, technical diagram style, labeling each part, engineering drawing style","zh-TW":"3D",es:"Crea un diagrama de seccin transversal 3D del objeto, mostrando la estructura interna y los componentes, estilo de diagrama tcnico, etiquetando cada parte, estilo de dibujo de ingeniera",ja:"3D",fr:"Crez un diagramme de coupe transversale 3D de l'objet, montrant la structure interne et les composants, style de diagramme technique, tiquetant chaque partie, style de dessin d'ingnierie"},withoutSelection:{en:"Generate a 3D cross-section diagram of a building, showing internal floor structure","zh-TW":"3D",es:"Genera un diagrama de seccin transversal 3D de un edificio, mostrando la estructura interna del piso",ja:"3D",fr:"Gnrez un diagramme de coupe transversale 3D d'un btiment, montrant la structure interne du plancher"}},{id:"restoration",category:"creative",icon:"",previewImage:"https://images.unsplash.com/photo-1579952363873-27d3bfad9c0d?w=600&h=400&fit=crop&q=80",withSelection:{en:"Restore and colorize this old photo, remove scratches, stains and fading, enhance details, add natural colors, maintain original composition and character features","zh-TW":"",es:"Restaura y colorea esta foto antigua, elimina rayones, manchas y decoloracin, mejora los detalles, agrega colores naturales, mantiene la composicin original y las caractersticas del personaje",ja:"",fr:"Restaurez et coloriez cette vieille photo, supprimez les rayures, les taches et la dcoloration, amliorez les dtails, ajoutez des couleurs naturelles, maintenez la composition originale et les caractristiques du personnage"},withoutSelection:{en:"Restore a 1950s black and white family photo, add colors","zh-TW":"1950",es:"Restaura una foto familiar en blanco y negro de los aos 1950, agrega colores",ja:"1950",fr:"Restaurez une photo de famille en noir et blanc des annes 1950, ajoutez des couleurs"}},{id:"idPhoto",category:"professional",icon:"",previewImage:"https://images.unsplash.com/photo-1607706189992-eae578626c86?w=600&h=400&fit=crop&q=80",withSelection:{en:"Transform the person into a professional ID photo: white background, formal attire, confident expression, ID photo format, professional studio lighting, maintain person's facial features","zh-TW":"",es:"Transforma a la persona en una foto de identificacin profesional: fondo blanco, vestimenta formal, expresin confiada, formato de foto de identificacin, iluminacin de estudio profesional, mantn las caractersticas faciales de la persona",ja:"IDID",fr:"Transformez la personne en photo d'identit professionnelle : arrire-plan blanc, tenue formelle, expression confiante, format de photo d'identit, clairage de studio professionnel, maintenez les traits du visage de la personne"},withoutSelection:{en:"Generate professional business ID photo, white background, formal attire","zh-TW":"",es:"Genera una foto de identificacin comercial profesional, fondo blanco, vestimenta formal",ja:"ID",fr:"Gnrez une photo d'identit commerciale professionnelle, arrire-plan blanc, tenue formelle"}},{id:"product",category:"professional",icon:"",withSelection:{en:"Transform the product into professional e-commerce photography: pure white background, multi-angle display, professional lighting, showcase product details and texture","zh-TW":"",es:"Transforma el producto en fotografa profesional de comercio electrnico: fondo blanco puro, exhibicin en mltiples ngulos, iluminacin profesional, muestra los detalles y textura del producto",ja:"e",fr:"Transformez le produit en photographie professionnelle de commerce lectronique : arrire-plan blanc pur, affichage multi-angles, clairage professionnel, mettez en valeur les dtails et la texture du produit"},withoutSelection:{en:"Create professional product photography, suitable for e-commerce platforms","zh-TW":"",es:"Crea fotografa profesional de productos, adecuada para plataformas de comercio electrnico",ja:"e",fr:"Crez une photographie de produit professionnelle, adapte aux plateformes de commerce lectronique"}},{id:"interior",category:"professional",icon:"",withSelection:{en:"Redesign the space: add modern furniture, change wall colors, add decorations, professional interior design style","zh-TW":"",es:"Redisea el espacio: agrega muebles modernos, cambia los colores de las paredes, agrega decoraciones, estilo de diseo de interiores profesional",ja:"",fr:"Redessinez l'espace : ajoutez des meubles modernes, changez les couleurs des murs, ajoutez des dcorations, style de design d'intrieur professionnel"},withoutSelection:{en:"Design modern minimalist living room, including sofa, coffee table and decorations","zh-TW":"",es:"Disea una sala de estar minimalista moderna, incluyendo sof, mesa de caf y decoraciones",ja:"",fr:"Concevez un salon minimaliste moderne, comprenant un canap, une table basse et des dcorations"}},{id:"marketing",category:"professional",icon:"",withSelection:{en:"Create social media marketing material: add attractive background, text space, brand colors, suitable for Instagram posting","zh-TW":"Instagram",es:"Crea material de marketing para redes sociales: agrega fondo atractivo, espacio de texto, colores de marca, adecuado para publicar en Instagram",ja:"Instagram",fr:"Crez du matriel de marketing pour les mdias sociaux : ajoutez un arrire-plan attrayant, un espace de texte, des couleurs de marque, adapt  la publication Instagram"},withoutSelection:{en:"Design eye-catching social media advertising images","zh-TW":"",es:"Disea imgenes publicitarias llamativas para redes sociales",ja:"",fr:"Concevez des images publicitaires accrocheuses pour les mdias sociaux"}},{id:"tryOn",category:"fun",icon:"",withSelection:{en:"Dress the person from the first image in the clothing from the second image, keep the person's pose and background unchanged, clothing should fit naturally","zh-TW":"",es:"Viste a la persona de la primera imagen con la ropa de la segunda imagen, mantn la pose y el fondo de la persona sin cambios, la ropa debe quedar naturalmente",ja:"2",fr:"Habillez la personne de la premire image avec les vtements de la deuxime image, gardez la pose et l'arrire-plan de la personne inchangs, les vtements doivent s'ajuster naturellement"},withoutSelection:{en:"Show model trying on different style outfits","zh-TW":"",es:"Muestra un modelo probndose diferentes estilos de conjuntos",ja:"",fr:"Montrez un modle essayant diffrents styles de tenues"}},{id:"timeTravel",category:"fun",icon:"",withSelection:{en:"Place the person in different eras: 1920s vintage style, 1960s hippie style, 1980s disco, 2000s Y2K style, maintain person's features","zh-TW":"1920196019802000Y2K",es:"Coloca a la persona en diferentes pocas: estilo vintage de los aos 1920, estilo hippie de los aos 1960, disco de los aos 1980, estilo Y2K de los aos 2000, mantn las caractersticas de la persona",ja:"1920196019802000Y2K",fr:"Placez la personne dans diffrentes poques : style vintage des annes 1920, style hippie des annes 1960, disco des annes 1980, style Y2K des annes 2000, maintenez les caractristiques de la personne"},withoutSelection:{en:"Show the same character in different historical period styles","zh-TW":"",es:"Muestra el mismo personaje en estilos de diferentes perodos histricos",ja:"",fr:"Montrez le mme personnage dans des styles de diffrentes priodes historiques"}},{id:"petAdventure",category:"fun",icon:"",withSelection:{en:"Place the pet in adventure scenes: astronaut costume on the moon, pirate captain on a ship, superhero flying, knight armor in a castle","zh-TW":"",es:"Coloca a la mascota en escenas de aventura: disfraz de astronauta en la luna, capitn pirata en un barco, superhroe volando, armadura de caballero en un castillo",ja:"",fr:"Placez l'animal dans des scnes d'aventure : costume d'astronaute sur la lune, capitaine pirate sur un navire, super-hros volant, armure de chevalier dans un chteau"},withoutSelection:{en:"Create fantasy adventure scenes for pets","zh-TW":"",es:"Crea escenas de aventura fantstica para mascotas",ja:"",fr:"Crez des scnes d'aventure fantastique pour animaux de compagnie"}},{id:"ingredients",category:"fun",icon:"",withSelection:{en:"Break down the food into ingredients: each ingredient in separate bowls, label names and quantities, cooking tutorial style arrangement","zh-TW":"",es:"Descompn la comida en ingredientes: cada ingrediente en tazones separados, etiqueta nombres y cantidades, disposicin estilo tutorial de cocina",ja:"",fr:"Dcomposez la nourriture en ingrdients : chaque ingrdient dans des bols spars, tiquetez les noms et les quantits, arrangement de style tutoriel de cuisine"},withoutSelection:{en:"Display all ingredients and seasonings for a dish","zh-TW":"",es:"Muestra todos los ingredientes y condimentos para un plato",ja:"",fr:"Affichez tous les ingrdients et assaisonnements pour un plat"}}];function fc(t,e,n){const c=$a.find(y=>y.id===t);if(!c)return"";const p=e?c.withSelection:c.withoutSelection;return p[n]||p.en}const Bm={analyzing:{icon:Ih,color:"text-blue-500",bgColor:"bg-blue-50",borderColor:"border-blue-200"},composing:{icon:Mh,color:"text-purple-500",bgColor:"bg-purple-50",borderColor:"border-purple-200"},rendering:{icon:Ah,color:"text-orange-500",bgColor:"bg-orange-50",borderColor:"border-orange-200"},finalizing:{icon:en,color:"text-green-500",bgColor:"bg-green-50",borderColor:"border-green-200"}},Um=({isVisible:t,stage:e="analyzing",className:n=""})=>{const c=_n(),[p,y]=fe.useState({x:0,y:0});if(fe.useEffect(()=>{if(!t)return;const u=()=>{console.log(" CANVAS LOADING INDICATOR -  - TIMESTAMP:",new Date().toISOString());const r=["div",'[class*="panel"]','[class*="sidebar"]','[class*="assistant"]',".ai-assistant-panel",".right-panel","[data-panel]","aside","section",'[style*="position: fixed"]','[style*="position: absolute"]'];let a=null,i=0;for(const m of r){const v=document.querySelectorAll(m);for(const x of v){const S=x.getBoundingClientRect(),b=S.width>250&&S.width<window.innerWidth*.6,T=S.right>=window.innerWidth-100,E=S.width<window.innerWidth-100,N=S.height>300;if(b&&T&&E&&N){a=x,i=S.width,console.log(" Loading Indicator - :",m,"class:",x.className,"width:",i);break}}if(a)break}a||console.log(" Loading Indicator - ");const o=window.innerWidth-i,f=window.innerHeight,l=o/2,g=f/2;console.log(" Loading Indicator :"),console.log("   - :",window.innerWidth,"x",window.innerHeight),console.log("   - :",i),console.log("   - :",o),console.log("   - :",l.toFixed(0),g.toFixed(0)),y({x:l,y:g})};u();const h=()=>u();return window.addEventListener("resize",h),()=>{window.removeEventListener("resize",h)}},[t]),!t)return null;const w=Bm[e],d=w.icon,s=c.loadingIndicator.stages[e];return C.jsxs("div",{className:`
        fixed z-50 pointer-events-none transform -translate-x-1/2 -translate-y-1/2
        ${n}
      `,style:{left:p.x,top:p.y},children:[C.jsxs("div",{className:`
        ${w.bgColor} ${w.borderColor}
        border-2 rounded-lg shadow-lg backdrop-blur-sm
        p-4 min-w-[200px]
        animate-pulse
      `,children:[C.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[C.jsx("div",{className:`${w.color} p-2 rounded-full bg-white shadow-sm`,children:C.jsx(d,{className:"w-5 h-5"})}),C.jsxs("div",{children:[C.jsx("div",{className:`font-medium ${w.color}`,children:s.text}),C.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})]}),C.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3",children:C.jsx("div",{className:`h-2 rounded-full transition-all duration-1000 ${e==="analyzing"?"bg-blue-500 w-1/4":e==="composing"?"bg-purple-500 w-1/2":e==="rendering"?"bg-orange-500 w-3/4":"bg-green-500 w-full"}`})}),C.jsx("div",{className:"flex justify-center space-x-1",children:[0,1,2].map(u=>C.jsx("div",{className:`w-2 h-2 ${w.color.replace("text-","bg-")} rounded-full animate-bounce`,style:{animationDelay:`${u*.2}s`,animationDuration:"1s"}},u))})]}),C.jsx("div",{className:"absolute inset-0 pointer-events-none",children:[...Array(6)].map((u,h)=>C.jsx("div",{className:"absolute w-1 h-1 bg-yellow-400 rounded-full animate-ping",style:{left:`${20+h*15}%`,top:`${10+h%3*30}%`,animationDelay:`${h*.3}s`,animationDuration:"2s"}},h))})]})},Cs=()=>{const n={enabled:!1,environment:"production",googleAnalyticsId:{}.VITE_GA_TRACKING_ID,features:{pageTracking:!0,eventTracking:!0,errorTracking:!0,performanceTracking:!0},privacy:{anonymizeIP:!0,respectDoNotTrack:!0,cookieConsent:!0}};return n.googleAnalyticsId&&(n.enabled=!0),n},Zs=t=>{const e=Cs();return e.enabled&&e.features[t]},Gm=()=>(Cs(),navigator.doNotTrack==="1"),Wm=()=>{const t=Cs();return Gm()?(console.log(" Analytics disabled due to privacy settings"),!1):!t.enabled||!t.googleAnalyticsId?(console.log(" Analytics not initialized - missing configuration"),!1):!0};class Hm{constructor(){ft(this,"isEnabled",!1);ft(this,"gaTrackingId",null);ft(this,"currentSession",null);this.initializeSession(),this.safeInitialize()}safeInitialize(){try{const e=Cs();if(!Wm()){console.log(" Analytics initialization skipped");return}e.googleAnalyticsId&&this.init(e.googleAnalyticsId)}catch(e){console.warn(" Analytics initialization failed safely:",e),this.isEnabled=!1}}init(e){this.gaTrackingId=e,this.isEnabled=!0,this.loadGoogleAnalytics(e),Zs("pageTracking")&&this.trackPageView(window.location.pathname),console.log(" Analytics initialized with tracking ID:",e)}loadGoogleAnalytics(e){const n=document.createElement("script");n.async=!0,n.src=`https://www.googletagmanager.com/gtag/js?id=${e}`,document.head.appendChild(n);const c=document.createElement("script");c.innerHTML=`
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '${e}', {
        page_title: 'OmniCanvas - AI Creative Canvas',
        custom_map: {'custom_parameter_1': 'ai_feature'}
      });
    `,document.head.appendChild(c),window.gtag=(...p)=>{window.dataLayer=window.dataLayer||[],window.dataLayer.push(arguments)}}initializeSession(){this.currentSession={session_id:this.generateSessionId(),start_time:Date.now(),page_views:0,events:[]}}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}trackPageView(e){if(!(!this.isEnabled||!Zs("pageTracking")))try{this.currentSession&&this.currentSession.page_views++,window.gtag&&window.gtag("config",this.gaTrackingId,{page_path:e,page_title:`OmniCanvas - ${e}`}),console.log(" Page view tracked:",e)}catch(n){console.warn(" Page view tracking failed safely:",n)}}trackEvent(e){var n;if(!(!this.isEnabled||!Zs("eventTracking")))try{this.currentSession&&this.currentSession.events.push({...e,custom_parameters:{...e.custom_parameters,timestamp:Date.now(),session_id:this.currentSession.session_id}}),window.gtag&&window.gtag("event",e.action,{event_category:e.category,event_label:e.label,value:e.value,custom_parameter_1:(n=e.custom_parameters)==null?void 0:n.ai_feature,...e.custom_parameters}),console.log(" Event tracked:",e)}catch(c){console.warn(" Event tracking failed safely:",c)}}trackAIGeneration(e){this.trackEvent({action:"ai_generation",category:"AI Features",label:e.type,value:e.processingTime,custom_parameters:{ai_feature:e.type,template_used:e.template,has_image_selection:e.hasSelection,prompt_length:e.promptLength,generation_mode:e.hasSelection?"image-to-image":"text-to-image"}})}trackTemplateUsage(e,n){this.trackEvent({action:"template_selected",category:"Templates",label:e,custom_parameters:{template_id:e,template_category:n,ai_feature:"template_usage"}})}trackFeatureUsage(e,n){this.trackEvent({action:"feature_used",category:"User Interaction",label:e,custom_parameters:{feature_name:e,...n,ai_feature:"general_usage"}})}trackError(e,n){this.trackEvent({action:"error_occurred",category:"Errors",label:e,custom_parameters:{error_message:e,error_context:n,ai_feature:"error_tracking"}})}getSessionStats(){return this.currentSession}trackUserEngagement(){if(!this.currentSession)return;const e=Date.now()-this.currentSession.start_time,n=this.currentSession.events.length;this.trackEvent({action:"session_engagement",category:"User Behavior",label:"session_summary",value:Math.round(e/1e3),custom_parameters:{session_duration_ms:e,total_events:n,page_views:this.currentSession.page_views,events_per_minute:n/(e/6e4),ai_feature:"engagement_metrics"}})}disable(){this.isEnabled=!1,console.log(" Analytics disabled")}enable(){this.isEnabled=!0,console.log(" Analytics enabled")}}const Ye=new Hm,Vm=({onOpenSettings:t})=>{var _,O,A,M,B;const e=_n(),{currentLanguage:n}=Qi(),{isConfigured:c}=Xo(),{getSelectedImages:p}=Vo(),{importImage:y,getSelectedImages:w}=ki(),[d,s]=fe.useState(!1),[u,h]=fe.useState("composing"),[r,a]=fe.useState(""),[i,o]=fe.useState(""),[f,l]=fe.useState("generate"),[g,m]=fe.useState(null),[v,x]=fe.useState(null),[S,b]=fe.useState("all"),[T,E]=fe.useState([]),[N,L]=fe.useState(null);fe.useState(null);const[G,Q]=fe.useState({upscaleLevel:"4x",removeBackground:!0,enhanceQuality:!0}),Z=w(),te=p(),K=Z.length>0?Z.map(P=>({url:P})):te,ne=K.length>0,le={generate:{maxImages:10,message:e.aiPanel.generate.validation.generateMessage,canUse:!0},enhance:{maxImages:10,message:e.aiPanel.enhance.selectImagesDescription,canUse:K.length>0},style:{maxImages:1,message:e.aiPanel.generate.validation.styleMessage,canUse:K.length===1},merge:{maxImages:10,message:e.aiPanel.generate.validation.mergeMessage,canUse:K.length>=2}},Y=async()=>{if(!i.trim()&&f==="generate")return;const P=Date.now();console.log(" Starting generation process..."),console.log(" State check:",{activeTab:f,hasSelection:ne,selectedImagesCount:K.length,canvasSelectedImages:w(),imageStoreImages:p(),selectedImages:K.map(D=>({url:typeof D.url=="string"?D.url.substring(0,50)+"...":D.url}))});const k=f==="enhance"?"enhancement":ne?"image-to-image":"text-to-image";Ye.trackAIGeneration({type:k,template:v||void 0,hasSelection:ne,promptLength:i.length}),s(!0),h("analyzing"),a(e.aiPanel.generate.processing.analyzing);try{setTimeout(()=>{h("composing"),a(e.aiPanel.generate.processing.composing)},1e3),setTimeout(()=>{h("rendering"),a(e.aiPanel.generate.processing.rendering)},3e3),setTimeout(()=>{h("finalizing"),a(e.aiPanel.generate.processing.finalizing)},5e3);let D;if(f==="generate")if(ne&&K.length>0){console.log(" Using Image-to-Image mode!");const W=K.map($=>$.url);K.length===1?(console.log(" Single image generation with:",typeof W[0]=="string"?W[0].substring(0,50)+"...":W[0]),D=await Xe.imageToImage({prompt:i,imageUrl:W[0],width:512,height:512,strength:.7})):(console.log(" Multi-image merge with",K.length,"images"),D=await Xe.imageToImage({prompt:`Merge these ${K.length} images: ${i}`,imageUrl:W[0],width:512,height:512,strength:.5})),console.log(` Generated ${K.length===1?"image-to-image":"merged"} result based on selection`)}else console.log(" Using Text-to-Image mode (no images selected)"),D=await Xe.generateImage({prompt:i,width:512,height:512}),console.log(" Generated image from text prompt:",D);else if(f==="enhance"){console.log(" Enhancement mode with settings:",G);const W=K.map($=>$.url);if(W.length>0){console.log(" Enhancing images with settings:",G);let $="";G.enhanceQuality&&!G.removeBackground?$="preserve original appearance, enhance clarity, reduce noise, maintain exact same composition and features":G.removeBackground&&!G.enhanceQuality?$="REMOVE ALL BACKGROUND completely, make background fully transparent, isolate main subject only, cutout style, PNG with alpha channel, white background becomes transparent, solid subject with clean edges, preserve subject 100% unchanged":G.enhanceQuality&&G.removeBackground?$="REMOVE ALL BACKGROUND make fully transparent, isolate main subject, enhance subject clarity slightly while preserving original appearance exactly, cutout style PNG with alpha transparency":$="upscale image, preserve original appearance completely, no changes to subject";let q=.15;G.removeBackground?q=.8:G.enhanceQuality&&(q=.3),D=await Xe.imageToImage({prompt:$,imageUrl:W[0],width:parseInt(G.upscaleLevel)*128,height:parseInt(G.upscaleLevel)*128,strength:q}),console.log(" Enhanced image:",D)}}else D=await Xe.generateImage({prompt:i,width:512,height:512}),console.log("Generated image from text prompt in",f,"tab:",D);const F=typeof D=="string"?D:D.url;await y(F),m(F),f==="generate"&&o("");const X=Date.now()-P;Ye.trackAIGeneration({type:k,template:v||void 0,hasSelection:ne,promptLength:i.length,processingTime:X}),Ye.trackEvent({action:"ai_generation_success",category:"AI Features",label:k,value:X,custom_parameters:{generation_successful:!0,processing_time_ms:X,template_used:v,ai_feature:"generation_completion"}})}catch(D){console.error("Image processing failed:",D),Ye.trackError(`AI generation failed: ${D}`,`${k}_generation`),alert(e.alerts.imageGenerationFailed+D)}finally{s(!1)}};return C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"flex h-full flex-col bg-gradient-to-br from-white to-purple-50 min-h-0",children:[C.jsx("div",{className:"p-3 border-b border-gray-200 bg-white/90 backdrop-blur-sm flex-shrink-0",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx("div",{className:"p-1.5 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg",children:C.jsx(Lh,{className:"w-4 h-4 text-white"})}),C.jsx("h3",{className:"text-sm font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent",children:e.aiPanel.title})]}),C.jsx("div",{className:"flex items-center space-x-1",children:ne&&C.jsxs("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${(_=le[f])!=null&&_.canUse?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"}`,children:[" ",K.length," ",e.aiPanel.selected]})})]})}),C.jsx("div",{className:"border-b border-gray-200 bg-white/90 backdrop-blur-sm flex-shrink-0",children:C.jsxs("div",{className:"flex space-x-1 p-2",children:[C.jsxs("button",{onClick:()=>l("generate"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${f==="generate"?"bg-purple-100 text-purple-700 border border-purple-300":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[C.jsx(en,{className:"w-4 h-4"}),C.jsx("span",{children:e.aiPanel.generate.tabs.generate})]}),C.jsxs("button",{onClick:()=>l("enhance"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-all ${f==="enhance"?"bg-green-100 text-green-700 border border-green-300":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[C.jsx(is,{className:"w-4 h-4"}),C.jsx("span",{children:e.aiPanel.generate.tabs.enhance})]})]})}),C.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:[C.jsxs("div",{className:"p-3 md:p-4 flex-1 overflow-y-auto pb-safe",children:[!c&&C.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:C.jsxs("div",{className:"flex items-start space-x-2",children:[C.jsx(Zn,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),C.jsxs("div",{children:[C.jsx("p",{className:"text-sm font-medium text-amber-900 mb-1",children:e.settings.apiKeys.required}),C.jsx("p",{className:"text-xs text-amber-800",children:e.settings.importantNotice.description}),C.jsx("button",{onClick:t,className:"mt-2 text-xs px-3 py-1 bg-amber-600 hover:bg-amber-700 text-white rounded-lg transition-colors",children:e.settings.apiKeys.openSettings})]})]})}),ne&&C.jsxs("div",{className:`mb-3 p-2 rounded-lg border ${(O=le[f])!=null&&O.canUse?"bg-blue-50 border-blue-200":"bg-orange-50 border-orange-200"}`,children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("span",{className:"text-xs font-medium text-gray-700",children:[" ",K.length," ",K.length!==1?e.aiPanel.images:e.aiPanel.image," ",e.aiPanel.selectedFromCanvas]}),!((A=le[f])!=null&&A.canUse)&&C.jsxs("span",{className:"text-xs text-orange-600 font-medium",children:[" ",e.aiPanel.invalidFor," ",f]})]}),C.jsx("p",{className:"text-xs text-gray-600 mt-1",children:(M=le[f])==null?void 0:M.message})]}),f==="generate"&&C.jsxs("div",{className:"mb-3",children:[C.jsx("textarea",{value:i,onChange:P=>{o(P.target.value),x(null),E([])},placeholder:e.aiPanel.generate.placeholder,className:"w-full h-20 p-2 text-sm border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",disabled:d}),ne&&C.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:[" ",e.aiPanel.selectedImagesNote]})]}),f==="generate"&&C.jsxs("div",{className:"space-y-3",children:[C.jsx("p",{className:"text-xs text-gray-600",children:ne?`${e.aiPanel.generateBasedOn} ${K.length} ${K.length!==1?e.aiPanel.selectedImages:e.aiPanel.selectedImage}`:e.aiPanel.generateWithGemini}),ne&&C.jsxs("div",{className:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 mb-3",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[C.jsxs("span",{className:"text-sm font-bold text-blue-700",children:[" ",e.aiPanel.imageToImageMode]}),C.jsx("span",{className:"text-xs px-2 py-0.5 bg-blue-200 text-blue-800 rounded-full",children:e.aiPanel.active})]}),C.jsx("p",{className:"text-xs text-blue-700",children:e.aiPanel.selectedImagesCombined})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("p",{className:"text-xs font-bold text-purple-700 flex items-center",children:[" ",e.aiPanel.generate.templates.title]}),ne&&C.jsx("span",{className:"text-xs text-blue-600 font-medium",children:e.aiPanel.generate.templates.withSelection})]}),C.jsxs("div",{className:"flex gap-2 mb-2 flex-wrap",children:[C.jsx("button",{onClick:()=>b("all"),className:`px-2 py-1 text-xs rounded-full transition-all ${S==="all"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.all}),C.jsx("button",{onClick:()=>b("creative"),className:`px-2 py-1 text-xs rounded-full transition-all ${S==="creative"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.creative}),C.jsx("button",{onClick:()=>b("professional"),className:`px-2 py-1 text-xs rounded-full transition-all ${S==="professional"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.professional}),C.jsx("button",{onClick:()=>b("fun"),className:`px-2 py-1 text-xs rounded-full transition-all ${S==="fun"?"bg-purple-600 text-white":"bg-purple-100 text-purple-700 hover:bg-purple-200"}`,children:e.aiPanel.generate.templates.categories.fun})]}),C.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-96 overflow-y-auto",children:$a.filter(P=>S==="all"||P.category===S).map(P=>{var k,D;return C.jsxs("button",{onClick:()=>{const F=fc(P.id,ne,n);o(F),x(P.id),Ye.trackTemplateUsage(P.id,P.category),Ye.trackFeatureUsage("template_selected",{template_id:P.id,template_category:P.category,has_selection:ne,timestamp:Date.now()})},className:`p-2 rounded-lg border text-left transition-all ${v===P.id?"bg-gradient-to-r from-orange-100 to-yellow-100 border-orange-400 ring-1 ring-orange-300":"bg-white hover:bg-gray-50 border-gray-200"}`,children:[C.jsx("div",{className:"text-lg mb-1",children:P.icon}),C.jsx("div",{className:"text-xs font-bold text-gray-800",children:(k=e.aiPanel.generate.templates.items[P.id])==null?void 0:k.title}),C.jsx("div",{className:"text-xs text-gray-600 mt-0.5",children:(D=e.aiPanel.generate.templates.items[P.id])==null?void 0:D.description})]},P.id)})}),v&&C.jsx("div",{className:"p-2 bg-purple-50 rounded-lg border border-purple-200",children:C.jsx("p",{className:"text-xs text-purple-700",children:e.aiPanel.generate.templates.applied})})]}),C.jsxs("div",{className:"mt-2 p-2 bg-purple-50 rounded-lg",children:[C.jsxs("p",{className:"text-xs font-medium text-purple-700 mb-1",children:[" ",e.aiPanel.generate.quickEnhancements]}),C.jsx("div",{className:"flex flex-wrap gap-1",children:e.aiPanel.generate.enhancementItems.map(P=>{const k=T.includes(P);return C.jsx("button",{onClick:()=>{const D=k?T.filter(W=>W!==P):[...T,P];E(D);const F=i.split(",").filter(W=>!e.aiPanel.generate.enhancementItems.includes(W.trim())).join(",").trim(),X=F+(D.length>0?(F?", ":"")+D.join(", "):"");o(X)},className:`text-xs px-2 py-1 rounded border transition-all ${k?"bg-purple-200 border-purple-500 text-purple-800 ring-1 ring-purple-400":"bg-white hover:bg-purple-100 border-purple-300 text-gray-700"}`,children:P},P)})})]})]}),f==="enhance"&&C.jsx("div",{className:"space-y-4",children:ne?C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[C.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[C.jsxs("span",{className:"text-sm font-bold text-green-700",children:[" ",e.aiPanel.enhance.enhancementReady]}),C.jsxs("span",{className:"text-xs px-2 py-0.5 bg-green-200 text-green-800 rounded-full",children:[K.length," ",K.length!==1?e.aiPanel.images:e.aiPanel.image]})]}),C.jsx("p",{className:"text-xs text-green-700",children:e.aiPanel.enhance.willBeProcessed})]}),C.jsxs("div",{className:"space-y-3",children:[C.jsx("h4",{className:"text-sm font-bold text-gray-800",children:e.aiPanel.enhance.enhancementOptions}),C.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[C.jsxs("div",{className:"flex items-center justify-between mb-2",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(oc,{className:"w-4 h-4 text-blue-600"}),C.jsx("span",{className:"text-sm font-medium text-gray-800",children:e.aiPanel.enhance.aiUpscale})]}),C.jsxs("select",{value:G.upscaleLevel,onChange:P=>Q(k=>({...k,upscaleLevel:P.target.value})),className:"text-xs border border-gray-300 rounded px-2 py-1",children:[C.jsx("option",{value:"2x",children:e.aiPanel.enhance.resolutions["2x"]}),C.jsx("option",{value:"4x",children:e.aiPanel.enhance.resolutions["4x"]}),C.jsx("option",{value:"8x",children:e.aiPanel.enhance.resolutions["8x"]})]})]}),C.jsx("p",{className:"text-xs text-gray-600",children:e.aiPanel.enhance.upscaleDescription})]}),C.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[C.jsxs("div",{className:"flex items-center justify-between mb-2",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(Ug,{className:"w-4 h-4 text-purple-600"}),C.jsx("span",{className:"text-sm font-medium text-gray-800",children:e.aiPanel.enhance.backgroundRemoval})]}),C.jsxs("label",{className:"flex items-center cursor-pointer",children:[C.jsx("input",{type:"checkbox",checked:G.removeBackground,onChange:P=>Q(k=>({...k,removeBackground:P.target.checked})),className:"sr-only"}),C.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center ${G.removeBackground?"bg-purple-600 border-purple-600":"border-gray-300"}`,children:G.removeBackground&&C.jsx("div",{className:"w-2 h-2 bg-white rounded-sm"})})]})]}),C.jsx("p",{className:"text-xs text-gray-600",children:e.aiPanel.enhance.backgroundRemovalDescription})]}),C.jsxs("div",{className:"p-3 border border-gray-200 rounded-lg",children:[C.jsxs("div",{className:"flex items-center justify-between mb-2",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(en,{className:"w-4 h-4 text-amber-600"}),C.jsx("span",{className:"text-sm font-medium text-gray-800",children:e.aiPanel.enhance.qualityEnhancement})]}),C.jsxs("label",{className:"flex items-center cursor-pointer",children:[C.jsx("input",{type:"checkbox",checked:G.enhanceQuality,onChange:P=>Q(k=>({...k,enhanceQuality:P.target.checked})),className:"sr-only"}),C.jsx("div",{className:`w-4 h-4 rounded border-2 flex items-center justify-center ${G.enhanceQuality?"bg-amber-600 border-amber-600":"border-gray-300"}`,children:G.enhanceQuality&&C.jsx("div",{className:"w-2 h-2 bg-white rounded-sm"})})]})]}),C.jsx("p",{className:"text-xs text-gray-600",children:e.aiPanel.enhance.qualityEnhancementDescription})]})]}),C.jsxs("div",{className:"p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-green-200",children:[C.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-2",children:e.aiPanel.enhance.enhancementSummary}),C.jsxs("div",{className:"space-y-1 text-xs text-gray-700",children:[C.jsxs("div",{children:[" ",e.aiPanel.enhance.upscaleTo," ",G.upscaleLevel," ",e.aiPanel.enhance.resolutions[G.upscaleLevel]]}),G.removeBackground&&C.jsxs("div",{children:[" ",e.aiPanel.enhance.removeBackground]}),G.enhanceQuality&&C.jsxs("div",{children:[" ",e.aiPanel.enhance.enhancedQuality]}),C.jsxs("div",{className:"text-green-700 font-medium mt-2",children:[e.aiPanel.enhance.processing," ",K.length," ",K.length!==1?e.aiPanel.images:e.aiPanel.image]})]})]})]}):C.jsxs("div",{className:"text-center py-8",children:[C.jsx(oc,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),C.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:e.aiPanel.enhance.selectImages}),C.jsx("p",{className:"text-xs text-gray-600",children:e.aiPanel.enhance.selectImagesDescription})]})})]}),(f==="generate"||f==="enhance"&&ne)&&C.jsxs("div",{className:"sticky bottom-0 p-3 md:p-4 border-t border-gray-200 bg-white/98 backdrop-blur-sm flex-shrink-0 shadow-lg md:shadow-none",children:[C.jsx("button",{onClick:Y,disabled:d||f==="generate"&&(!i.trim()||!((B=le[f])!=null&&B.canUse))||f==="enhance"&&!ne,className:`w-full py-4 md:py-3 px-4 bg-gradient-to-r ${f==="enhance"?"from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 active:from-green-800 active:to-emerald-800":"from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 active:from-purple-800 active:to-pink-800"} disabled:from-gray-300 disabled:to-gray-400 text-white text-sm md:text-base rounded-xl transition-all flex items-center justify-center space-x-2 font-bold shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 disabled:scale-100 touch-manipulation`,children:d?C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"animate-spin rounded-full h-4 w-4 md:h-5 md:w-5 border-b-2 border-white"}),C.jsx("span",{children:f==="enhance"?e.aiPanel.enhance.enhancing:e.aiPanel.generate.generating})]}):C.jsxs(C.Fragment,{children:[f==="enhance"?C.jsx(is,{className:"w-4 h-4 md:w-5 md:h-5"}):C.jsx(en,{className:"w-4 h-4 md:w-5 md:h-5"}),C.jsx("span",{children:f==="enhance"?e.aiPanel.enhance.enhanceButton:e.aiPanel.generate.generateButton})]})}),C.jsx("div",{className:"md:hidden mt-2 text-center",children:C.jsx("p",{className:"text-xs text-gray-500",children:f==="generate"?"  Google Gemini  AI ":" "})})]})]}),N&&C.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:()=>L(null),children:C.jsx("div",{className:"bg-white rounded-xl p-4 max-w-md w-full mx-4",onClick:P=>P.stopPropagation(),children:(()=>{var k,D;const P=$a.find(F=>F.id===N);return P?C.jsxs(C.Fragment,{children:[C.jsxs("div",{className:"flex items-center justify-between mb-3",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx("div",{className:"text-2xl",children:P.icon}),C.jsx("h3",{className:"text-lg font-bold text-gray-800",children:(k=e.aiPanel.generate.templates.items[P.id])==null?void 0:k.title})]}),C.jsx("button",{onClick:()=>L(null),className:"text-gray-400 hover:text-gray-600 text-xl font-bold",children:""})]}),P.previewImage&&C.jsx("div",{className:"mb-3",children:C.jsx("img",{src:P.previewImage,alt:`${P.id} preview`,className:"w-full h-48 object-cover rounded-lg shadow-lg",loading:"lazy",onError:F=>{F.currentTarget.style.display="none"}})}),C.jsx("p",{className:"text-sm text-gray-600 mb-4",children:(D=e.aiPanel.generate.templates.items[P.id])==null?void 0:D.description}),C.jsxs("div",{className:"flex gap-2",children:[C.jsx("button",{onClick:()=>{const F=fc(P.id,ne,n);o(F),x(P.id),L(null)},className:"flex-1 py-2 px-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white text-sm rounded-lg transition-all font-medium",children:e.aiPanel.useTemplate}),C.jsx("button",{onClick:()=>L(null),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm rounded-lg transition-colors",children:e.aiPanel.close})]})]}):null})()})})]}),C.jsx(Um,{isVisible:d,stage:u})]})},Gh={enableCSP:!0,enableXSSProtection:!0,enableExtensionDetection:!0,strictMode:!0},un=class un{constructor(){ft(this,"isInitialized",!1)}static getInstance(){return un.instance||(un.instance=new un),un.instance}initializeCSP(e={}){if(this.isInitialized)return;const n={...Gh,...e};if(!n.enableCSP)return;const c=["default-src 'self'","script-src 'self' 'unsafe-inline' 'unsafe-eval' https://vercel.live","style-src 'self' 'unsafe-inline' https://fonts.googleapis.com","font-src 'self' https://fonts.gstatic.com","img-src 'self' data: blob: https: http:","media-src 'self' data: blob: https:","connect-src 'self' https: wss: ws:","object-src 'none'","base-uri 'self'","form-action 'self'","frame-ancestors 'none'",n.strictMode?"upgrade-insecure-requests":""].filter(Boolean).join("; ");this.insertCSPMeta(c),this.setupCSPViolationReporting(),this.isInitialized=!0,console.log(" CSP initialized:",c)}insertCSPMeta(e){const n=document.createElement("meta");n.httpEquiv="Content-Security-Policy",n.content=e,document.head.appendChild(n)}setupCSPViolationReporting(){document.addEventListener("securitypolicyviolation",e=>{console.warn(" CSP Violation detected:",{blockedURI:e.blockedURI,violatedDirective:e.violatedDirective,originalPolicy:e.originalPolicy,sourceFile:e.sourceFile,lineNumber:e.lineNumber}),this.reportViolation({type:"csp_violation",blockedURI:e.blockedURI,directive:e.violatedDirective,timestamp:Date.now(),userAgent:navigator.userAgent})})}reportViolation(e){}};ft(un,"instance");let Ka=un;class gc{static sanitizeHTML(e){const n=document.createElement("div");return n.textContent=e,n.innerHTML}static sanitizeURL(e){try{const n=new URL(e);if(!["http:","https:","data:"].includes(n.protocol))throw new Error("Invalid protocol");return n.toString()}catch{return""}}static sanitizeInput(e){return e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim()}static detectXSS(e){return[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe/gi,/<object/gi,/<embed/gi,/expression\s*\(/gi,/vbscript:/gi].some(c=>c.test(e))}static safeSetInnerHTML(e,n){if(this.detectXSS(n)){console.warn(" XSS attempt blocked:",n.substring(0,100)),e.textContent="Content blocked for security reasons";return}e.innerHTML=this.sanitizeHTML(n)}}class kn{static async detectExtensions(){const e=[];await this.checkForExtension("chrome-extension://fmkadmapgofadopljbjfkapdkoienihi/")&&e.push("React Developer Tools"),this.checkAdBlocker()&&e.push("Ad Blocker"),this.checkPasswordManager()&&e.push("Password Manager");const n=this.checkMaliciousIndicators();return n.length>0&&e.push(...n),this.detectedExtensions=new Set(e),e}static async checkForExtension(e){try{return(await fetch(e,{method:"HEAD"})).ok}catch{return!1}}static checkAdBlocker(){const e=document.createElement("div");e.innerHTML="&nbsp;",e.className="adsbox",e.style.position="absolute",e.style.left="-10000px",document.body.appendChild(e);const n=e.offsetHeight===0;return document.body.removeChild(e),n}static checkPasswordManager(){return["data-lastpass-icon-root","data-dashlane-rid","_1PasswordExtension","bitwarden-browser-action-handler"].some(n=>document.querySelector(`[${n}]`)!==null)}static checkMaliciousIndicators(){const e=[];return["webpackChunkJsonp","__REACT_DEVTOOLS_GLOBAL_HOOK__"].forEach(c=>{window[c]&&typeof window[c]!="function"&&e.push(`Suspicious Global: ${c}`)}),this.checkDOMModification()&&e.push("Suspicious DOM Modification"),e}static checkDOMModification(){const e=document.scripts.length;return setTimeout(()=>{if(document.scripts.length>e+5)return console.warn(" Suspicious script injection detected"),!0},1e3),!1}static getDetectedExtensions(){return Array.from(this.detectedExtensions)}static hasPotentialThreats(){return this.getDetectedExtensions().filter(n=>n.includes("Suspicious")||n.includes("Malicious")).length>0}}ft(kn,"detectedExtensions",new Set);const hn=class hn{constructor(e={}){ft(this,"isInitialized",!1);ft(this,"config");this.config={...Gh,...e}}static getInstance(e){return hn.instance||(hn.instance=new hn(e)),hn.instance}async initialize(){this.isInitialized||(console.log(" Initializing OmniCanvas Security Manager..."),this.config.enableCSP&&Ka.getInstance().initializeCSP(this.config),this.config.enableXSSProtection&&this.setupXSSProtection(),this.config.enableExtensionDetection&&await this.performExtensionDetection(),this.setupSecurityHeaders(),this.setupSecurityMonitoring(),this.isInitialized=!0,console.log(" Security Manager initialized successfully"))}setupXSSProtection(){document.addEventListener("input",e=>{const n=e.target;n.value&&gc.detectXSS(n.value)&&(console.warn(" XSS attempt detected in input field"),n.value=gc.sanitizeInput(n.value))}),console.log(" XSS Protection enabled")}async performExtensionDetection(){try{const e=await kn.detectExtensions();e.length>0&&(console.log(" Browser extensions detected:",e),kn.hasPotentialThreats()&&(console.warn(" Potential security threats detected!"),this.handleSecurityThreat("malicious_extension",e)))}catch(e){console.error("Extension detection failed:",e)}}setupSecurityHeaders(){window.self!==window.top&&console.warn(" Application running in iframe - potential security risk"),this.config.strictMode&&document.addEventListener("contextmenu",e=>{e.preventDefault()})}setupSecurityMonitoring(){let e=0;const n=window.fetch;window.fetch=async(...c)=>(e++,e>100&&(console.warn(" High frequency requests detected"),this.handleSecurityThreat("high_frequency_requests",{count:e})),n.apply(window,c)),console.log(" Security monitoring enabled")}handleSecurityThreat(e,n){const c={type:e,details:n,timestamp:Date.now(),userAgent:navigator.userAgent,url:window.location.href};console.error(" Security threat detected:",c)}getSecurityReport(){return{initialized:this.isInitialized,config:this.config,detectedExtensions:kn.getDetectedExtensions(),hasPotentialThreats:kn.hasPotentialThreats(),timestamp:Date.now()}}async performSecurityCheck(){console.log(" Performing security check..."),await this.performExtensionDetection();const e=kn.hasPotentialThreats();return console.log(e?" Security issues found":" Security check passed"),!e}};ft(hn,"instance");let Vi=hn;const Xm=async t=>{await Vi.getInstance(t).initialize()},Ym=()=>Vi.getInstance().getSecurityReport(),$m=({className:t})=>{_n();const[e,n]=fe.useState(null),[c,p]=fe.useState(!1),[y,w]=fe.useState(null),d=async()=>{p(!0);try{await Vi.getInstance().performSecurityCheck();const o=Ym();n(o),w(new Date)}catch(i){console.error("Failed to load security report:",i)}finally{p(!1)}};fe.useEffect(()=>{d()},[]);const s=()=>e?e.hasPotentialThreats?"danger":e.detectedExtensions.length>5?"warning":"safe":"unknown",u=i=>{switch(i){case"safe":return"text-green-600 bg-green-100";case"warning":return"text-yellow-600 bg-yellow-100";case"danger":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},h=i=>{switch(i){case"safe":return bg;case"warning":return qs;case"danger":return qs;default:return ts}},r=s(),a=h(r);return C.jsxs("div",{className:`bg-white rounded-lg border border-gray-200 p-4 ${t}`,children:[C.jsxs("div",{className:"flex items-center justify-between mb-4",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(ts,{className:"w-5 h-5 text-blue-600"}),C.jsx("h3",{className:"font-semibold text-gray-800",children:""})]}),C.jsx("button",{onClick:d,disabled:c,className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors disabled:opacity-50",title:"",children:C.jsx(ac,{className:`w-4 h-4 ${c?"animate-spin":""}`})})]}),C.jsxs("div",{className:`flex items-center space-x-3 p-3 rounded-lg mb-4 ${u(r)}`,children:[C.jsx(a,{className:"w-5 h-5"}),C.jsxs("div",{children:[C.jsxs("div",{className:"font-medium",children:[r==="safe"&&"",r==="warning"&&"",r==="danger"&&"",r==="unknown"&&"..."]}),C.jsxs("div",{className:"text-xs opacity-75",children:[r==="safe"&&"",r==="warning"&&"",r==="danger"&&"",r==="unknown"&&"..."]})]})]}),e&&C.jsxs("div",{className:"space-y-3",children:[C.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[C.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center",children:[C.jsx(Mg,{className:"w-4 h-4 mr-2"}),""]}),C.jsxs("div",{className:"space-y-1 text-sm",children:[C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-gray-600",children:"CSP :"}),C.jsx("span",{className:e.config.enableCSP?"text-green-600":"text-red-600",children:e.config.enableCSP?"":""})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-gray-600",children:"XSS :"}),C.jsx("span",{className:e.config.enableXSSProtection?"text-green-600":"text-red-600",children:e.config.enableXSSProtection?"":""})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-gray-600",children:":"}),C.jsx("span",{className:e.config.enableExtensionDetection?"text-green-600":"text-red-600",children:e.config.enableExtensionDetection?"":""})]}),C.jsxs("div",{className:"flex justify-between",children:[C.jsx("span",{className:"text-gray-600",children:":"}),C.jsx("span",{className:e.config.strictMode?"text-green-600":"text-yellow-600",children:e.config.strictMode?"":""})]})]})]}),e.detectedExtensions.length>0&&C.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[C.jsxs("h4",{className:"font-medium text-gray-800 mb-2 flex items-center",children:[C.jsx(jh,{className:"w-4 h-4 mr-2"})," (",e.detectedExtensions.length,")"]}),C.jsx("div",{className:"space-y-1 text-xs",children:e.detectedExtensions.map((i,o)=>C.jsx("div",{className:`p-2 rounded ${i.includes("Suspicious")||i.includes("Malicious")?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"}`,children:i},o))})]}),e.hasPotentialThreats&&C.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:[C.jsxs("h4",{className:"font-medium text-red-800 mb-2 flex items-center",children:[C.jsx(qs,{className:"w-4 h-4 mr-2"}),""]}),C.jsx("p",{className:"text-red-700 text-sm",children:""})]}),C.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[C.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:""}),C.jsxs("ul",{className:"text-blue-700 text-xs space-y-1",children:[C.jsx("li",{children:" "}),C.jsx("li",{children:"  API Key "}),C.jsx("li",{children:" "}),C.jsx("li",{children:" "})]})]}),y&&C.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[": ",y.toLocaleString()]})]}),c&&!e&&C.jsxs("div",{className:"flex items-center justify-center py-8",children:[C.jsx(ac,{className:"w-6 h-6 animate-spin text-blue-600"}),C.jsx("span",{className:"ml-2 text-gray-600",children:"..."})]})]})},Km=({isOpen:t,setIsOpen:e})=>{const{currentLanguage:n}=Qi(),c=Yo(n),{apiKeys:p,setAPIKey:y,removeAPIKey:w,validateAPIKey:d,getObfuscatedKey:s,isConfigured:u}=Xo(),[h,r]=fe.useState({}),[a,i]=fe.useState({}),[o,f]=fe.useState({}),[l,g]=fe.useState("apikeys");fe.useEffect(()=>{r(p);const b={};Object.keys(p).forEach(T=>{b[T]="unchecked"}),f(b)},[p]);const m=(b,T)=>{r(E=>({...E,[b]:T})),f(E=>({...E,[b]:"unchecked"}))},v=async b=>{const T=h[b];if(!T){w(b),f(N=>({...N,[b]:"unchecked"}));return}await d(b,T)?(y(b,T),f(N=>({...N,[b]:"valid"}))):f(N=>({...N,[b]:"invalid"}))},x=b=>{i(T=>({...T,[b]:!T[b]}))},S=[{key:"gemini",name:c.settings.apiKeys.services.gemini.name,placeholder:c.settings.apiKeys.services.gemini.placeholder,description:c.settings.apiKeys.services.gemini.description,required:!0}];return C.jsx(C.Fragment,{children:t&&C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:()=>e(!1)}),C.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[C.jsxs("div",{className:"flex items-center justify-between mb-4",children:[C.jsxs("div",{className:"flex items-center space-x-2",children:[C.jsx(Zn,{className:"w-5 h-5 text-blue-600"}),C.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:c.settings.title})]}),C.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-gray-600",children:C.jsx(ns,{className:"w-5 h-5"})})]}),C.jsxs("div",{className:"flex space-x-1 border-b border-gray-200 mb-4",children:[C.jsxs("button",{onClick:()=>g("apikeys"),className:`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${l==="apikeys"?"bg-blue-50 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"}`,children:[C.jsx(ic,{className:"w-4 h-4 inline mr-2"}),"API "]}),C.jsxs("button",{onClick:()=>g("security"),className:`px-4 py-2 text-sm font-medium rounded-t-lg transition-colors ${l==="security"?"bg-blue-50 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"}`,children:[C.jsx(ts,{className:"w-4 h-4 inline mr-2"}),""]})]}),C.jsxs("div",{className:"space-y-4",children:[l==="apikeys"&&C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"bg-amber-50 p-4 rounded-lg border border-amber-200",children:C.jsxs("div",{className:"flex items-start",children:[C.jsx(Cg,{className:"w-5 h-5 text-amber-600 mr-2 flex-shrink-0 mt-0.5"}),C.jsxs("div",{children:[C.jsx("h3",{className:"text-sm font-medium text-amber-900 mb-1",children:c.settings.importantNotice.title}),C.jsx("p",{className:"text-xs text-amber-800",children:c.settings.importantNotice.description})]})]})}),C.jsxs("div",{className:"space-y-4",children:[C.jsxs("h3",{className:"text-sm font-semibold text-gray-900 flex items-center",children:[C.jsx(ic,{className:"w-4 h-4 mr-2"}),c.settings.apiKeys.title]}),S.map(b=>C.jsxs("div",{className:"space-y-2 p-4 bg-gray-50 rounded-lg",children:[C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[b.name,b.required&&C.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),o[b.key]==="valid"&&C.jsxs("span",{className:"text-xs text-green-600 flex items-center",children:[C.jsx(_g,{className:"w-3 h-3 mr-1"})," ",c.settings.apiKeys.valid]}),o[b.key]==="invalid"&&C.jsxs("span",{className:"text-xs text-red-600 flex items-center",children:[C.jsx(ns,{className:"w-3 h-3 mr-1"})," ",c.settings.apiKeys.invalid]})]}),C.jsx("p",{className:"text-xs text-gray-600",children:b.description}),C.jsxs("div",{className:"flex space-x-2",children:[C.jsxs("div",{className:"flex-1 relative",children:[C.jsx("input",{type:a[b.key]?"text":"password",value:h[b.key]||"",onChange:T=>m(b.key,T.target.value),onKeyDown:T=>{(T.metaKey||T.ctrlKey)&&T.key==="v"&&(T.preventDefault(),navigator.clipboard.readText().then(E=>{m(b.key,E)}).catch(()=>{T.preventDefault=()=>{}}))},placeholder:b.placeholder,className:"w-full text-sm border border-gray-300 rounded px-3 py-2 pr-10 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",autoComplete:"off"}),C.jsx("button",{type:"button",onClick:()=>x(b.key),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700",children:a[b.key]?C.jsx(Ig,{className:"w-4 h-4"}):C.jsx(jh,{className:"w-4 h-4"})})]}),C.jsx("button",{onClick:()=>v(b.key),className:"px-4 py-2 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded transition-colors flex items-center",children:C.jsx(Bg,{className:"w-4 h-4"})})]}),p[b.key]&&C.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.settings.apiKeys.current,": ",s(b.key)]})]},b.key))]}),C.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[C.jsxs("div",{className:"flex items-center justify-between mb-2",children:[C.jsx("h3",{className:"text-sm font-medium text-blue-900",children:c.settings.gettingStarted.title}),C.jsxs("a",{href:"https://aistudio.google.com/app/apikey",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1 text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md transition-colors",children:[c.settings.gettingStarted.getApiKeyButton,C.jsx(Og,{className:"w-3 h-3 ml-1"})]})]}),C.jsx("ol",{className:"text-xs text-blue-800 space-y-1",children:c.settings.gettingStarted.steps.map((b,T)=>C.jsxs("li",{children:[T+1,". ",b]},T))})]}),C.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[C.jsxs("h3",{className:"text-sm font-medium text-green-900 mb-2 flex items-center",children:[C.jsx(ts,{className:"w-4 h-4 mr-2"}),c.settings.security.title]}),C.jsx("ul",{className:"text-xs text-green-800 space-y-1",children:c.settings.security.benefits.map((b,T)=>C.jsxs("li",{children:[" ",b]},T))})]})]}),l==="security"&&C.jsx($m,{}),C.jsx("div",{className:"flex justify-end space-x-2 pt-4",children:C.jsx("button",{onClick:()=>e(!1),className:"px-4 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors",children:c.common.close})})]})]})]})})},qm=({onOpenSettings:t,onOpenAIPanel:e,onClose:n})=>{const c=_n(),[p,y]=fe.useState("overview"),w=h=>{y(p===h?null:h)},d=h=>{switch(h){case"open_settings":t==null||t(),n==null||n();break;case"open_ai_panel":e==null||e(),n==null||n();break;case"open_enhancement":e==null||e(),n==null||n();break;default:console.log("Unknown action:",h)}},s=[{id:"overview",icon:es,title:c.serviceGuide.overview.title,content:[{title:c.serviceGuide.overview.whatIs.title,description:c.serviceGuide.overview.whatIs.description,features:[c.serviceGuide.overview.whatIs.features.unlimited,c.serviceGuide.overview.whatIs.features.aiPowered,c.serviceGuide.overview.whatIs.features.multilingual,c.serviceGuide.overview.whatIs.features.privacy]}]},{id:"aiGeneration",icon:en,title:c.serviceGuide.aiGeneration.title,content:[{title:c.serviceGuide.aiGeneration.textToImage.title,description:c.serviceGuide.aiGeneration.textToImage.description,steps:[c.serviceGuide.aiGeneration.textToImage.steps.openPanel,c.serviceGuide.aiGeneration.textToImage.steps.writePrompt,c.serviceGuide.aiGeneration.textToImage.steps.selectTemplate,c.serviceGuide.aiGeneration.textToImage.steps.generate]},{title:c.serviceGuide.aiGeneration.imageToImage.title,description:c.serviceGuide.aiGeneration.imageToImage.description,steps:[c.serviceGuide.aiGeneration.imageToImage.steps.selectImages,c.serviceGuide.aiGeneration.imageToImage.steps.openPanel,c.serviceGuide.aiGeneration.imageToImage.steps.writePrompt,c.serviceGuide.aiGeneration.imageToImage.steps.generate]}]},{id:"enhancement",icon:is,title:c.serviceGuide.enhancement.title,content:[{title:c.serviceGuide.enhancement.aiUpscale.title,description:c.serviceGuide.enhancement.aiUpscale.description,features:[c.serviceGuide.enhancement.aiUpscale.features.resolution,c.serviceGuide.enhancement.aiUpscale.features.quality,c.serviceGuide.enhancement.aiUpscale.features.details]},{title:c.serviceGuide.enhancement.backgroundRemoval.title,description:c.serviceGuide.enhancement.backgroundRemoval.description,features:[c.serviceGuide.enhancement.backgroundRemoval.features.automatic,c.serviceGuide.enhancement.backgroundRemoval.features.transparent,c.serviceGuide.enhancement.backgroundRemoval.features.precise]}]},{id:"canvas",icon:Mh,title:c.serviceGuide.canvas.title,content:[{title:c.serviceGuide.canvas.navigation.title,description:c.serviceGuide.canvas.navigation.description,controls:[{key:c.serviceGuide.canvas.navigation.controls.zoom,value:"Ctrl/Cmd + "},{key:c.serviceGuide.canvas.navigation.controls.pan,value:" / Shift + "},{key:c.serviceGuide.canvas.navigation.controls.select,value:""},{key:c.serviceGuide.canvas.navigation.controls.multiSelect,value:"Ctrl/Cmd + "}]},{title:c.serviceGuide.canvas.layers.title,description:c.serviceGuide.canvas.layers.description,features:[c.serviceGuide.canvas.layers.features.unlimited,c.serviceGuide.canvas.layers.features.visibility,c.serviceGuide.canvas.layers.features.reorder,c.serviceGuide.canvas.layers.features.lock]}]},{id:"contextMenu",icon:Rg,title:c.serviceGuide.contextMenu.title,content:[{title:c.serviceGuide.contextMenu.smartCompose.title,description:c.serviceGuide.contextMenu.smartCompose.description,options:[c.serviceGuide.contextMenu.smartCompose.options.intelligent,c.serviceGuide.contextMenu.smartCompose.options.accessory,c.serviceGuide.contextMenu.smartCompose.options.scene,c.serviceGuide.contextMenu.smartCompose.options.creative]},{title:c.serviceGuide.contextMenu.voiceCommand.title,description:c.serviceGuide.contextMenu.voiceCommand.description,features:[c.serviceGuide.contextMenu.voiceCommand.features.multilingual,c.serviceGuide.contextMenu.voiceCommand.features.intelligent,c.serviceGuide.contextMenu.voiceCommand.features.realtime]}]},{id:"settings",icon:Zn,title:c.serviceGuide.settings.title,content:[{title:c.serviceGuide.settings.apiKey.title,description:c.serviceGuide.settings.apiKey.description,steps:[c.serviceGuide.settings.apiKey.steps.getKey,c.serviceGuide.settings.apiKey.steps.openSettings,c.serviceGuide.settings.apiKey.steps.enterKey,c.serviceGuide.settings.apiKey.steps.save]},{title:c.serviceGuide.settings.language.title,description:c.serviceGuide.settings.language.description,languages:["","English","","Espaol","Franais"]}]}],u=[{icon:Zn,title:c.serviceGuide.quickActions.settings,description:c.serviceGuide.quickActions.settingsDesc,action:"open_settings"},{icon:en,title:c.serviceGuide.quickActions.generate,description:c.serviceGuide.quickActions.generateDesc,action:"open_ai_panel"},{icon:is,title:c.serviceGuide.quickActions.enhance,description:c.serviceGuide.quickActions.enhanceDesc,action:"open_enhancement"}];return C.jsxs("div",{className:"h-full flex flex-col bg-gradient-to-br from-white to-blue-50",children:[C.jsx("div",{className:"p-3 md:p-4 border-b border-gray-200 bg-white/90 backdrop-blur-sm",children:C.jsxs("div",{className:"flex items-center space-x-3",children:[C.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:C.jsx(es,{className:"w-4 h-4 md:w-5 md:h-5 text-white"})}),C.jsxs("div",{children:[C.jsx("h2",{className:"text-base md:text-lg font-bold text-gray-800",children:c.serviceGuide.title}),C.jsx("p",{className:"text-xs md:text-sm text-gray-600",children:c.serviceGuide.subtitle})]})]})}),C.jsxs("div",{className:"flex-1 overflow-y-auto",children:[C.jsxs("div",{className:"p-3 md:p-4 border-b border-gray-100",children:[C.jsxs("h3",{className:"text-sm font-bold text-gray-800 mb-3 flex items-center",children:[C.jsx(Dh,{className:"w-4 h-4 mr-2 text-green-600"}),c.serviceGuide.quickStart]}),C.jsx("div",{className:"grid grid-cols-1 gap-3",children:u.map((h,r)=>C.jsx("button",{onClick:()=>d(h.action),className:"p-4 bg-white border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-all text-left group active:bg-blue-100 touch-manipulation",children:C.jsxs("div",{className:"flex items-start space-x-3",children:[C.jsx(h.icon,{className:"w-5 h-5 text-blue-600 mt-0.5 group-hover:text-blue-700 flex-shrink-0"}),C.jsxs("div",{className:"min-w-0 flex-1",children:[C.jsx("div",{className:"text-sm font-medium text-gray-800 group-hover:text-blue-800 leading-5",children:h.title}),C.jsx("div",{className:"text-xs text-gray-600 group-hover:text-blue-600 mt-1 leading-4",children:h.description})]})]})},r))})]}),C.jsx("div",{className:"p-3 md:p-4 space-y-3",children:s.map(h=>C.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[C.jsx("button",{onClick:()=>w(h.id),className:"w-full p-4 text-left hover:bg-gray-50 transition-colors active:bg-gray-100 touch-manipulation",children:C.jsxs("div",{className:"flex items-center justify-between",children:[C.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[C.jsx(h.icon,{className:"w-5 h-5 text-blue-600 flex-shrink-0"}),C.jsx("span",{className:"font-medium text-gray-800 text-sm md:text-base truncate",children:h.title})]}),p===h.id?C.jsx(Tg,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):C.jsx(kg,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})}),p===h.id&&C.jsx("div",{className:"px-3 md:px-4 pb-4 border-t border-gray-100",children:h.content.map((r,a)=>C.jsxs("div",{className:"mt-4",children:[C.jsx("h4",{className:"font-medium text-gray-800 mb-3 text-sm md:text-base",children:r.title}),C.jsx("p",{className:"text-xs md:text-sm text-gray-600 mb-3 leading-relaxed",children:r.description}),r.features&&C.jsx("ul",{className:"space-y-3",children:r.features.map((i,o)=>C.jsxs("li",{className:"flex items-start space-x-3 text-xs md:text-sm text-gray-600",children:[C.jsx("div",{className:"w-1.5 h-1.5 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),C.jsx("span",{className:"leading-relaxed",children:i})]},o))}),r.steps&&C.jsx("ol",{className:"space-y-3",children:r.steps.map((i,o)=>C.jsxs("li",{className:"flex items-start space-x-3 text-xs md:text-sm text-gray-600",children:[C.jsx("span",{className:"w-6 h-6 bg-blue-100 text-blue-600 rounded-full text-xs flex items-center justify-center font-medium flex-shrink-0",children:o+1}),C.jsx("span",{className:"leading-relaxed pt-0.5",children:i})]},o))}),r.controls&&C.jsx("div",{className:"space-y-3",children:r.controls.map((i,o)=>C.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center py-2 space-y-1 sm:space-y-0",children:[C.jsx("span",{className:"text-xs md:text-sm text-gray-600 font-medium",children:i.key}),C.jsx("code",{className:"text-xs bg-gray-100 px-3 py-2 rounded font-mono self-start sm:self-auto",children:i.value})]},o))}),r.options&&C.jsx("div",{className:"grid grid-cols-1 gap-3 mt-3",children:r.options.map((i,o)=>C.jsx("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:C.jsx("span",{className:"text-xs md:text-sm text-blue-800 leading-relaxed",children:i})},o))}),r.languages&&C.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:r.languages.map((i,o)=>C.jsx("span",{className:"px-3 py-2 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:i},o))})]},a))})]},h.id))}),C.jsx("div",{className:"p-4 bg-gradient-to-r from-purple-50 to-blue-50 border-t border-gray-200",children:C.jsxs("div",{className:"flex items-start space-x-3",children:[C.jsx(Ag,{className:"w-5 h-5 text-purple-600 mt-0.5 flex-shrink-0"}),C.jsxs("div",{className:"min-w-0 flex-1",children:[C.jsx("h3",{className:"text-sm font-medium text-purple-800 mb-2",children:c.serviceGuide.needHelp.title}),C.jsx("p",{className:"text-xs text-purple-600 mb-4 leading-relaxed",children:c.serviceGuide.needHelp.description}),C.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[C.jsx("button",{onClick:()=>window.location.href="mailto:joeylaijal@gmail.com",className:"px-4 py-2 bg-purple-600 text-white text-xs font-medium rounded-lg hover:bg-purple-700 transition-colors active:bg-purple-800 touch-manipulation",children:c.serviceGuide.needHelp.contact}),C.jsx("button",{className:"px-4 py-2 bg-white text-purple-600 text-xs font-medium rounded-lg border border-purple-200 hover:bg-purple-50 transition-colors active:bg-purple-100 touch-manipulation",children:c.serviceGuide.needHelp.community})]}),C.jsx("p",{className:"text-xs text-purple-500 mt-3 break-all",children:"Support: joeylaijal@gmail.com"})]})]})})]})]})},mc=()=>{const{currentLanguage:t,setLanguage:e}=Qi(),[n,c]=fe.useState(!1),p=Yo(t),y=[{code:"en",flag:"",name:p.language.en},{code:"zh-TW",flag:"",name:p.language.zhTW},{code:"es",flag:"",name:p.language.es},{code:"ja",flag:"",name:p.language.ja},{code:"fr",flag:"",name:p.language.fr}],w=y.find(d=>d.code===t)||y[0];return C.jsxs("div",{className:"relative",children:[C.jsxs("button",{onClick:()=>c(!n),className:"flex items-center space-x-2 px-3 py-2 text-sm text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200",children:[C.jsx(jg,{className:"w-4 h-4"}),C.jsx("span",{className:"text-lg",children:w.flag}),C.jsx("span",{className:"hidden sm:inline",children:w.name}),C.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${n?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:C.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&C.jsxs(C.Fragment,{children:[C.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),C.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 z-20 overflow-hidden",children:y.map(d=>C.jsxs("button",{onClick:()=>{e(d.code),c(!1)},className:`w-full flex items-center space-x-3 px-4 py-3 text-sm hover:bg-gray-50 transition-colors duration-150 ${t===d.code?"bg-blue-50 text-blue-700 border-r-4 border-blue-500":"text-gray-700"}`,children:[C.jsx("span",{className:"text-lg",children:d.flag}),C.jsx("span",{className:"font-medium",children:d.name}),t===d.code&&C.jsx("div",{className:"ml-auto w-2 h-2 bg-blue-500 rounded-full"})]},d.code))})]})]})};function Qm(){const t=_n(),{initializeLanguage:e}=Qi(),[n,c]=fe.useState(!1),[p,y]=fe.useState(!1),[w,d]=fe.useState(!0),[s,u]=fe.useState(!1);fe.useEffect(()=>{e(),!localStorage.getItem("omnicanvas_visited")&&(localStorage.setItem("omnicanvas_visited","true"),Ye.trackFeatureUsage("first_visit",{detected_language:navigator.language,user_agent:navigator.userAgent,timestamp:Date.now()}),setTimeout(()=>{y(!0)},1500))},[e]),fe.useEffect(()=>{Ye.trackPageView("/"),Ye.trackFeatureUsage("app_loaded",{timestamp:Date.now(),user_agent:navigator.userAgent,viewport:`${window.innerWidth}x${window.innerHeight}`});const r=()=>{Ye.trackUserEngagement()};return window.addEventListener("beforeunload",r),()=>window.removeEventListener("beforeunload",r)},[]),fe.useEffect(()=>{const r=setTimeout(()=>{window.dispatchEvent(new Event("resize"))},300);return()=>clearTimeout(r)},[w]),fe.useEffect(()=>{Ye.trackFeatureUsage("panel_toggle",{panel_state:w?"open":"closed",timestamp:Date.now()})},[w]);const h=()=>{d(!0),Ye.trackFeatureUsage("ai_panel_opened_from_guide",{source:"service_guide",timestamp:Date.now()})};return C.jsxs("div",{className:"h-screen w-screen flex flex-col bg-gray-100",children:[C.jsxs("header",{className:"bg-white border-b border-gray-200 px-3 py-2 flex items-center justify-between relative",children:[C.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[C.jsx("h1",{className:"text-lg md:text-xl font-bold text-gray-900 truncate",children:"OmniCanvas"}),C.jsx("span",{className:"text-xs md:text-sm text-gray-500 hidden sm:block",children:"AI Creative Canvas"})]}),C.jsxs("div",{className:"hidden md:flex items-center space-x-2",children:[C.jsx(mc,{}),C.jsxs("button",{onClick:()=>{c(!0),Ye.trackFeatureUsage("settings_opened",{source:"desktop_header",timestamp:Date.now()})},className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[C.jsx(Zn,{className:"w-4 h-4"}),C.jsx("span",{children:t.common.settings})]}),C.jsxs("button",{onClick:()=>{y(!0),Ye.trackFeatureUsage("service_guide_opened",{source:"desktop_header",timestamp:Date.now()})},className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",children:[C.jsx(es,{className:"w-4 h-4"}),C.jsx("span",{children:t.serviceGuide.title})]}),C.jsxs("button",{onClick:()=>d(!w),className:"flex items-center space-x-2 px-3 py-1.5 text-sm bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:w?"Hide AI Assistant":"Show AI Assistant",children:[w?C.jsx(rc,{className:"w-4 h-4"}):C.jsx(sc,{className:"w-4 h-4"}),C.jsx("span",{children:w?"Hide Panel":"Show Panel"})]})]}),C.jsxs("div",{className:"md:hidden flex items-center space-x-2",children:[C.jsx(mc,{}),C.jsx("button",{onClick:()=>d(!w),className:"p-2 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg transition-colors",title:w?"Hide AI Assistant":"Show AI Assistant",children:w?C.jsx(rc,{className:"w-5 h-5"}):C.jsx(sc,{className:"w-5 h-5"})}),C.jsx("button",{onClick:()=>u(!s),className:"p-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:s?C.jsx(ns,{className:"w-5 h-5"}):C.jsx(Ng,{className:"w-5 h-5"})})]}),s&&C.jsx("div",{className:"absolute top-full left-0 right-0 z-40 bg-white border-b border-gray-200 shadow-lg md:hidden",children:C.jsxs("div",{className:"p-4 space-y-3",children:[C.jsxs("button",{onClick:()=>{c(!0),u(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition-colors",children:[C.jsx(Zn,{className:"w-4 h-4"}),C.jsx("span",{children:t.common.settings})]}),C.jsxs("button",{onClick:()=>{y(!0),u(!1)},className:"w-full flex items-center space-x-3 px-3 py-2 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",children:[C.jsx(es,{className:"w-4 h-4"}),C.jsx("span",{children:t.serviceGuide.title})]})]})})]}),C.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[C.jsx("div",{className:`${w?"hidden md:block":"block"}`,children:C.jsx(zm,{})}),C.jsx("div",{className:`flex-1 flex flex-col min-w-0 ${w?"hidden md:flex":"flex"}`,children:C.jsx(Fm,{})}),w&&C.jsx("div",{className:"w-full md:w-80 lg:w-96 xl:w-[420px] bg-white border-l border-gray-200 flex flex-col overflow-hidden flex-shrink-0 transition-all duration-300 ease-in-out h-full md:h-auto",children:C.jsx("div",{className:"flex-1 flex flex-col min-h-0 h-full",children:C.jsx(Vm,{onOpenSettings:()=>c(!0)})})})]}),C.jsx(Km,{isOpen:n,setIsOpen:c}),p&&C.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4",children:C.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl h-full max-h-[90vh] flex flex-col",children:[C.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[C.jsx("h2",{className:"text-xl font-bold text-gray-800",children:t.serviceGuide.title}),C.jsx("button",{onClick:()=>y(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",children:C.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:C.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),C.jsx("div",{className:"flex-1 overflow-hidden",children:C.jsx(qm,{onOpenSettings:()=>c(!0),onOpenAIPanel:h,onClose:()=>y(!1)})})]})})]})}Xm({enableCSP:!0,enableXSSProtection:!0,enableExtensionDetection:!0,strictMode:!0}).then(()=>{console.log(" Security initialized, starting application...")}).catch(t=>{console.error(" Security initialization failed:",t)});ea.createRoot(document.getElementById("root")).render(C.jsx(Pc.StrictMode,{children:C.jsx(Qm,{})}));
